"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[23659],{79320:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var t=r(85893),i=r(11151);const o={title:"Row Format",sidebar_position:11,id:"row_format",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},a=void 0,s={id:"guide/python/row_format",title:"Row Format",description:"Apache Fory\u2122 provides a random-access row format that enables reading nested fields from binary data without full deserialization.",source:"@site/versioned_docs/version-0.15/guide/python/row-format.md",sourceDirName:"guide/python",slug:"/guide/python/row_format",permalink:"/docs/guide/python/row_format",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/docs/guide/python/row-format.md",tags:[],version:"0.15",sidebarPosition:11,frontMatter:{title:"Row Format",sidebar_position:11,id:"row_format",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"Cross-Language Serialization",permalink:"/docs/guide/python/cross_language"},next:{title:"Migration Guide",permalink:"/docs/guide/python/migration"}},c={},l=[{value:"Overview",id:"overview",level:2},{value:"Basic Usage",id:"basic-usage",level:2},{value:"Cross-Language Compatibility",id:"cross-language-compatibility",level:2},{value:"Java",id:"java",level:3},{value:"C++",id:"c",level:3},{value:"Installation",id:"installation",level:2},{value:"When to Use Row Format",id:"when-to-use-row-format",level:2},{value:"Related Topics",id:"related-topics",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Apache Fory\u2122 provides a random-access row format that enables reading nested fields from binary data without full deserialization."}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"Row format drastically reduces overhead when working with large objects where only partial data access is needed. It also supports memory-mapped files for ultra-low memory footprint."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Key Benefits:"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Feature"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Zero-Copy Access"}),(0,t.jsx)(n.td,{children:"Read nested fields without deserializing entire object"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Memory Efficiency"}),(0,t.jsx)(n.td,{children:"Memory-map large datasets directly from disk"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Cross-Language"}),(0,t.jsx)(n.td,{children:"Binary format compatible between Python, Java, C++"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Partial Deserialization"}),(0,t.jsx)(n.td,{children:"Deserialize only specific elements you need"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"High Performance"}),(0,t.jsx)(n.td,{children:"Skip unnecessary data parsing for analytics workloads"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'import pyfory\nimport pyarrow as pa\nfrom dataclasses import dataclass\nfrom typing import List, Dict\n\n@dataclass\nclass Bar:\n    f1: str\n    f2: List[pa.int64]\n\n@dataclass\nclass Foo:\n    f1: pa.int32\n    f2: List[pa.int32]\n    f3: Dict[str, pa.int32]\n    f4: List[Bar]\n\n# Create encoder for row format\nencoder = pyfory.encoder(Foo)\n\n# Create large dataset\nfoo = Foo(\n    f1=10,\n    f2=list(range(1_000_000)),\n    f3={f"k{i}": i for i in range(1_000_000)},\n    f4=[Bar(f1=f"s{i}", f2=list(range(10))) for i in range(1_000_000)]\n)\n\n# Encode to row format\nbinary: bytes = encoder.to_row(foo).to_bytes()\n\n# Zero-copy access - no full deserialization needed!\nfoo_row = pyfory.RowData(encoder.schema, binary)\nprint(foo_row.f2[100000])              # Access 100,000th element directly\nprint(foo_row.f4[100000].f1)           # Access nested field directly\nprint(foo_row.f4[200000].f2[5])        # Access deeply nested field directly\n'})}),"\n",(0,t.jsx)(n.h2,{id:"cross-language-compatibility",children:"Cross-Language Compatibility"}),"\n",(0,t.jsx)(n.p,{children:"Row format works seamlessly across languages. The same binary data can be accessed from Java and C++."}),"\n",(0,t.jsx)(n.h3,{id:"java",children:"Java"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-java",children:"public class Bar {\n  String f1;\n  List<Long> f2;\n}\n\npublic class Foo {\n  int f1;\n  List<Integer> f2;\n  Map<String, Integer> f3;\n  List<Bar> f4;\n}\n\nRowEncoder<Foo> encoder = Encoders.bean(Foo.class);\n\n// Encode to row format (cross-language compatible with Python)\nBinaryRow binaryRow = encoder.toRow(foo);\n\n// Zero-copy random access without full deserialization\nBinaryArray f2Array = binaryRow.getArray(1);              // Access f2 list\nBinaryArray f4Array = binaryRow.getArray(3);              // Access f4 list\nBinaryRow bar10 = f4Array.getStruct(10);                  // Access 11th Bar\nlong value = bar10.getArray(1).getInt64(5);               // Access 6th element of bar.f2\n\n// Partial deserialization - only deserialize what you need\nRowEncoder<Bar> barEncoder = Encoders.bean(Bar.class);\nBar bar1 = barEncoder.fromRow(f4Array.getStruct(10));     // Deserialize 11th Bar only\nBar bar2 = barEncoder.fromRow(f4Array.getStruct(20));     // Deserialize 21st Bar only\n"})}),"\n",(0,t.jsx)(n.h3,{id:"c",children:"C++"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:'#include "fory/encoder/row_encoder.h"\n#include "fory/row/writer.h"\n\nstruct Bar {\n  std::string f1;\n  std::vector<int64_t> f2;\n  FORY_STRUCT(Bar, f1, f2);\n};\n\nstruct Foo {\n  int32_t f1;\n  std::vector<int32_t> f2;\n  std::map<std::string, int32_t> f3;\n  std::vector<Bar> f4;\n  FORY_STRUCT(Foo, f1, f2, f3, f4);\n};\n\nfory::encoder::RowEncoder<Foo> encoder;\nencoder.Encode(foo);\nauto row = encoder.GetWriter().ToRow();\n\n// Zero-copy random access without full deserialization\nauto f2_array = row->GetArray(1);                    // Access f2 list\nauto f4_array = row->GetArray(3);                    // Access f4 list\nauto bar10 = f4_array->GetStruct(10);                // Access 11th Bar\nint64_t value = bar10->GetArray(1)->GetInt64(5);    // Access 6th element of bar.f2\nstd::string str = bar10->GetString(0);               // Access bar.f1\n'})}),"\n",(0,t.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,t.jsx)(n.p,{children:"Row format requires Apache Arrow:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"pip install pyfory[format]\n"})}),"\n",(0,t.jsx)(n.h2,{id:"when-to-use-row-format",children:"When to Use Row Format"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Analytics workloads"}),": When you only need to access specific fields"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Large datasets"}),": When full deserialization is too expensive"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Memory-mapped files"}),": Working with data larger than RAM"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Data pipelines"}),": Processing data without full object reconstruction"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Cross-language data sharing"}),": When data needs to be accessed from multiple languages"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"related-topics",children:"Related Topics"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/guide/python/cross_language",children:"Cross-Language Serialization"})," - XLANG mode"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/guide/python/basic_serialization",children:"Basic Serialization"})," - Object serialization"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"https://fory.apache.org/docs/specification/row_format_spec",children:"Row Format Specification"})," - Protocol details"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},11151:(e,n,r)=>{r.d(n,{Z:()=>s,a:()=>a});var t=r(67294);const i={},o=t.createContext(i);function a(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);