"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[4802],{97977:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>d});var o=r(85893),i=r(11151);const a={title:"Row Format",sidebar_position:60,id:"row_format",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},t=void 0,s={id:"guide/xlang/row_format",title:"Row Format",description:"Fory Row Format is a cache-friendly binary format designed for efficient random access and partial serialization. Unlike object graph serialization, row format allows you to read individual fields without deserializing the entire object.",source:"@site/versioned_docs/version-0.15/guide/xlang/row_format.md",sourceDirName:"guide/xlang",slug:"/guide/xlang/row_format",permalink:"/docs/guide/xlang/row_format",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/docs/guide/xlang/row_format.md",tags:[],version:"0.15",sidebarPosition:60,frontMatter:{title:"Row Format",sidebar_position:60,id:"row_format",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"Zero-Copy Serialization",permalink:"/docs/guide/xlang/zero_copy"},next:{title:"Troubleshooting",permalink:"/docs/guide/xlang/troubleshooting"}},c={},d=[{value:"Features",id:"features",level:2},{value:"Java",id:"java",level:2},{value:"Python",id:"python",level:2},{value:"Apache Arrow Support",id:"apache-arrow-support",level:2},{value:"Java",id:"java-1",level:3},{value:"Python",id:"python-1",level:3},{value:"Support for Interface and Extension Types",id:"support-for-interface-and-extension-types",level:2},{value:"Example: Interface Mapping with RowEncoder",id:"example-interface-mapping-with-rowencoder",level:3},{value:"Example: Extension Type with RowEncoder",id:"example-extension-type-with-rowencoder",level:3},{value:"See Also",id:"see-also",level:2}];function l(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"Fory Row Format is a cache-friendly binary format designed for efficient random access and partial serialization. Unlike object graph serialization, row format allows you to read individual fields without deserializing the entire object."}),"\n",(0,o.jsx)(n.h2,{id:"features",children:"Features"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Zero-Copy Random Access"}),": Read specific fields directly from binary data"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Partial Serialization"}),": Skip unnecessary fields during serialization"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Cross-Language Compatible"}),": Row format data can be shared between Java, Python, and C++"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Apache Arrow Integration"}),": Convert row format to/from Arrow RecordBatch for analytics (Java/Python)"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"java",children:"Java"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",children:'public class Bar {\n  String f1;\n  List<Long> f2;\n}\n\npublic class Foo {\n  int f1;\n  List<Integer> f2;\n  Map<String, Integer> f3;\n  List<Bar> f4;\n}\n\nRowEncoder<Foo> encoder = Encoders.bean(Foo.class);\nFoo foo = new Foo();\nfoo.f1 = 10;\nfoo.f2 = IntStream.range(0, 1000000).boxed().collect(Collectors.toList());\nfoo.f3 = IntStream.range(0, 1000000).boxed().collect(Collectors.toMap(i -> "k"+i, i->i));\nList<Bar> bars = new ArrayList<>(1000000);\nfor (int i = 0; i < 1000000; i++) {\n  Bar bar = new Bar();\n  bar.f1 = "s"+i;\n  bar.f2 = LongStream.range(0, 10).boxed().collect(Collectors.toList());\n  bars.add(bar);\n}\nfoo.f4 = bars;\n// Can be zero-copy read by Python\nBinaryRow binaryRow = encoder.toRow(foo);\n// Can be data from Python\nFoo newFoo = encoder.fromRow(binaryRow);\n// Zero-copy read List<Integer> f2\nBinaryArray binaryArray2 = binaryRow.getArray(1);\n// Zero-copy read List<Bar> f4\nBinaryArray binaryArray4 = binaryRow.getArray(3);\n// Zero-copy read 11th element of List<Bar> f4\nBinaryRow barStruct = binaryArray4.getStruct(10);\n\n// Zero-copy read 6th element of f2 of 11th element of List<Bar> f4\nbarStruct.getArray(1).getInt64(5);\nRowEncoder<Bar> barEncoder = Encoders.bean(Bar.class);\n// Deserialize part of data\nBar newBar = barEncoder.fromRow(barStruct);\nBar newBar2 = barEncoder.fromRow(binaryArray4.getStruct(20));\n'})}),"\n",(0,o.jsx)(n.h2,{id:"python",children:"Python"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:'@dataclass\nclass Bar:\n    f1: str\n    f2: List[pa.int64]\n@dataclass\nclass Foo:\n    f1: pa.int32\n    f2: List[pa.int32]\n    f3: Dict[str, pa.int32]\n    f4: List[Bar]\n\nencoder = pyfory.encoder(Foo)\nfoo = Foo(f1=10, f2=list(range(1000_000)),\n         f3={f"k{i}": i for i in range(1000_000)},\n         f4=[Bar(f1=f"s{i}", f2=list(range(10))) for i in range(1000_000)])\nbinary: bytes = encoder.to_row(foo).to_bytes()\nprint(f"start: {datetime.datetime.now()}")\nfoo_row = pyfory.RowData(encoder.schema, binary)\nprint(foo_row.f2[100000], foo_row.f4[100000].f1, foo_row.f4[200000].f2[5])\nprint(f"end: {datetime.datetime.now()}")\n\nbinary = pickle.dumps(foo)\nprint(f"pickle start: {datetime.datetime.now()}")\nnew_foo = pickle.loads(binary)\nprint(new_foo.f2[100000], new_foo.f4[100000].f1, new_foo.f4[200000].f2[5])\nprint(f"pickle end: {datetime.datetime.now()}")\n'})}),"\n",(0,o.jsx)(n.h2,{id:"apache-arrow-support",children:"Apache Arrow Support"}),"\n",(0,o.jsx)(n.p,{children:"Fory Row Format supports automatic conversion from/to Arrow Table/RecordBatch for analytics workloads."}),"\n",(0,o.jsx)(n.h3,{id:"java-1",children:"Java"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",children:"Schema schema = TypeInference.inferSchema(BeanA.class);\nArrowWriter arrowWriter = ArrowUtils.createArrowWriter(schema);\nEncoder<BeanA> encoder = Encoders.rowEncoder(BeanA.class);\nfor (int i = 0; i < 10; i++) {\n  BeanA beanA = BeanA.createBeanA(2);\n  arrowWriter.write(encoder.toRow(beanA));\n}\nreturn arrowWriter.finishAsRecordBatch();\n"})}),"\n",(0,o.jsx)(n.h3,{id:"python-1",children:"Python"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-python",children:"import pyfory\nencoder = pyfory.encoder(Foo)\nencoder.to_arrow_record_batch([foo] * 10000)\nencoder.to_arrow_table([foo] * 10000)\n"})}),"\n",(0,o.jsx)(n.h2,{id:"support-for-interface-and-extension-types",children:"Support for Interface and Extension Types"}),"\n",(0,o.jsxs)(n.p,{children:["Fory supports row format mapping for Java ",(0,o.jsx)(n.code,{children:"interface"})," types and subclassed (",(0,o.jsx)(n.code,{children:"extends"}),") types, enabling more dynamic and flexible data schemas."]}),"\n",(0,o.jsxs)(n.p,{children:["These enhancements were introduced in ",(0,o.jsx)(n.a,{href:"https://github.com/apache/fory/pull/2243",children:"#2243"}),", ",(0,o.jsx)(n.a,{href:"https://github.com/apache/fory/pull/2250",children:"#2250"}),", and ",(0,o.jsx)(n.a,{href:"https://github.com/apache/fory/pull/2256",children:"#2256"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"example-interface-mapping-with-rowencoder",children:"Example: Interface Mapping with RowEncoder"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",children:'public interface Animal {\n  String speak();\n}\n\npublic class Dog implements Animal {\n  public String name;\n\n  @Override\n  public String speak() {\n    return "Woof";\n  }\n}\n\n// Encode and decode using RowEncoder with interface type\nRowEncoder<Animal> encoder = Encoders.bean(Animal.class);\nDog dog = new Dog();\ndog.name = "Bingo";\nBinaryRow row = encoder.toRow(dog);\nAnimal decoded = encoder.fromRow(row);\nSystem.out.println(decoded.speak()); // Woof\n'})}),"\n",(0,o.jsx)(n.h3,{id:"example-extension-type-with-rowencoder",children:"Example: Extension Type with RowEncoder"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",children:'public class Parent {\n    public String parentField;\n}\n\npublic class Child extends Parent {\n    public String childField;\n}\n\n// Encode and decode using RowEncoder with parent class type\nRowEncoder<Parent> encoder = Encoders.bean(Parent.class);\nChild child = new Child();\nchild.parentField = "Hello";\nchild.childField = "World";\nBinaryRow row = encoder.toRow(child);\nParent decoded = encoder.fromRow(row);\n'})}),"\n",(0,o.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"https://fory.apache.org/docs/next/specification/fory_row_format_spec",children:"Row Format Specification"})," - Binary format details"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/docs/guide/java/row_format",children:"Java Row Format Guide"})," - Java-specific row format documentation"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/docs/guide/python/row_format",children:"Python Row Format Guide"})," - Python-specific row format documentation"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},11151:(e,n,r)=>{r.d(n,{Z:()=>s,a:()=>t});var o=r(67294);const i={},a=o.createContext(i);function t(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);