"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[44631],{61133:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>r,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>l,toc:()=>d});var s=i(85893),t=i(11151);const o={title:"Schema Evolution",sidebar_position:6,id:"schema_evolution",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},a=void 0,l={id:"guide/python/schema_evolution",title:"Schema Evolution",description:"Apache Fory\u2122 supports schema evolution in Compatible mode, allowing fields to be added/removed while maintaining compatibility.",source:"@site/versioned_docs/version-0.15/guide/python/schema-evolution.md",sourceDirName:"guide/python",slug:"/guide/python/schema_evolution",permalink:"/docs/guide/python/schema_evolution",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/docs/guide/python/schema-evolution.md",tags:[],version:"0.15",sidebarPosition:6,frontMatter:{title:"Schema Evolution",sidebar_position:6,id:"schema_evolution",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"Python Native Mode",permalink:"/docs/guide/python/native_mode"},next:{title:"Out-of-Band Serialization",permalink:"/docs/guide/python/out_of_band"}},r={},d=[{value:"Enable Compatible Mode",id:"enable-compatible-mode",level:2},{value:"Disable Evolution for Stable Classes",id:"disable-evolution-for-stable-classes",level:2},{value:"Schema Evolution Example",id:"schema-evolution-example",level:2},{value:"Supported Changes",id:"supported-changes",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Related Topics",id:"related-topics",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Apache Fory\u2122 supports schema evolution in Compatible mode, allowing fields to be added/removed while maintaining compatibility."}),"\n",(0,s.jsx)(n.h2,{id:"enable-compatible-mode",children:"Enable Compatible Mode"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import pyfory\n\nf = pyfory.Fory(xlang=True, compatible=True)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"disable-evolution-for-stable-classes",children:"Disable Evolution for Stable Classes"}),"\n",(0,s.jsxs)(n.p,{children:["If a dataclass schema is stable and will not change, you can disable evolution for that class to avoid compatible metadata overhead. Use ",(0,s.jsx)(n.code,{children:"pyfory.dataclass"})," with ",(0,s.jsx)(n.code,{children:"evolving=False"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import pyfory\n\n@pyfory.dataclass(evolving=False)\nclass StableMessage:\n    id: int\n    name: str\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"pyfory.dataclass"})," also supports ",(0,s.jsx)(n.code,{children:"slots=True"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"@pyfory.dataclass(slots=True)\nclass SlotMessage:\n    id: int\n"})}),"\n",(0,s.jsx)(n.h2,{id:"schema-evolution-example",children:"Schema Evolution Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'import pyfory\nfrom dataclasses import dataclass\n\n# Version 1: Original class\n@dataclass\nclass User:\n    name: str\n    age: int\n\nf = pyfory.Fory(xlang=True, compatible=True)\nf.register(User, typename="User")\ndata = f.dumps(User("Alice", 30))\n\n# Version 2: Add new field (backward compatible)\n@dataclass\nclass User:\n    name: str\n    age: int\n    email: str = "unknown@example.com"  # New field with default\n\n# Can still deserialize old data\nuser = f.loads(data)\nprint(user.email)  # "unknown@example.com"\n'})}),"\n",(0,s.jsx)(n.h2,{id:"supported-changes",children:"Supported Changes"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Add new fields"}),": With default values"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Remove fields"}),": Old data with extra fields will be skipped"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Reorder fields"}),": Fields are matched by name, not position"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Always provide default values"})," for new fields"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Use typename for cross-language compatibility"})}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Test schema changes"})," before deploying"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Document schema versions"})," for your team"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"related-topics",children:"Related Topics"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/guide/python/configuration",children:"Configuration"})," - Compatible mode settings"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/guide/python/cross_language",children:"Cross-Language"})," - Schema evolution across languages"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/guide/python/type_registration",children:"Type Registration"})," - Registration patterns"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},11151:(e,n,i)=>{i.d(n,{Z:()=>l,a:()=>a});var s=i(67294);const t={},o=s.createContext(t);function a(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);