"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[11821],{7214:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>a,metadata:()=>s,toc:()=>f});var r=i(85893),t=i(11151);const a={title:"Out-of-Band Serialization",sidebar_position:7,id:"out_of_band",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},o=void 0,s={id:"guide/python/out_of_band",title:"Out-of-Band Serialization",description:"Fory supports pickle5-compatible out-of-band buffer serialization for efficient zero-copy handling of large data structures.",source:"@site/versioned_docs/version-0.15/guide/python/out-of-band.md",sourceDirName:"guide/python",slug:"/guide/python/out_of_band",permalink:"/docs/guide/python/out_of_band",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/docs/guide/python/out-of-band.md",tags:[],version:"0.15",sidebarPosition:7,frontMatter:{title:"Out-of-Band Serialization",sidebar_position:7,id:"out_of_band",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"Schema Evolution",permalink:"/docs/guide/python/schema_evolution"},next:{title:"NumPy & Pandas",permalink:"/docs/guide/python/numpy_integration"}},l={},f=[{value:"Overview",id:"overview",level:2},{value:"Basic Out-of-Band Serialization",id:"basic-out-of-band-serialization",level:2},{value:"Out-of-Band with Pandas DataFrames",id:"out-of-band-with-pandas-dataframes",level:2},{value:"Selective Out-of-Band Serialization",id:"selective-out-of-band-serialization",level:2},{value:"Pickle5 Compatibility",id:"pickle5-compatibility",level:2},{value:"Writing Buffers to Different Streams",id:"writing-buffers-to-different-streams",level:2},{value:"Related Topics",id:"related-topics",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Fory supports pickle5-compatible out-of-band buffer serialization for efficient zero-copy handling of large data structures."}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(n.p,{children:"Out-of-band serialization separates metadata from the actual data buffers, allowing for:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Zero-copy transfers"})," when sending data over networks or IPC using ",(0,r.jsx)(n.code,{children:"memoryview"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Improved performance"})," for large datasets"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Pickle5 compatibility"})," using ",(0,r.jsx)(n.code,{children:"pickle.PickleBuffer"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Flexible stream support"})," - write to any writable object (files, BytesIO, sockets, etc.)"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"basic-out-of-band-serialization",children:"Basic Out-of-Band Serialization"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import pyfory\nimport numpy as np\n\nfory = pyfory.Fory(xlang=False, ref=False, strict=False)\n\n# Large numpy array\narray = np.arange(10000, dtype=np.float64)\n\n# Serialize with out-of-band buffers\nbuffer_objects = []\nserialized_data = fory.serialize(array, buffer_callback=buffer_objects.append)\n\n# Convert buffer objects to memoryview for zero-copy transmission\n# For contiguous buffers (bytes, numpy arrays), this is zero-copy\n# For non-contiguous data, a copy may be created to ensure contiguity\nbuffers = [obj.getbuffer() for obj in buffer_objects]\n\n# Deserialize with out-of-band buffers (accepts memoryview, bytes, or Buffer)\ndeserialized_array = fory.deserialize(serialized_data, buffers=buffers)\n\nassert np.array_equal(array, deserialized_array)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"out-of-band-with-pandas-dataframes",children:"Out-of-Band with Pandas DataFrames"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import pyfory\nimport pandas as pd\nimport numpy as np\n\nfory = pyfory.Fory(xlang=False, ref=False, strict=False)\n\n# Create a DataFrame with numeric columns\ndf = pd.DataFrame({\n    'a': np.arange(1000, dtype=np.float64),\n    'b': np.arange(1000, dtype=np.int64),\n    'c': ['text'] * 1000\n})\n\n# Serialize with out-of-band buffers\nbuffer_objects = []\nserialized_data = fory.serialize(df, buffer_callback=buffer_objects.append)\nbuffers = [obj.getbuffer() for obj in buffer_objects]\n\n# Deserialize\ndeserialized_df = fory.deserialize(serialized_data, buffers=buffers)\n\nassert df.equals(deserialized_df)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"selective-out-of-band-serialization",children:"Selective Out-of-Band Serialization"}),"\n",(0,r.jsxs)(n.p,{children:["Control which buffers go out-of-band by providing a callback that returns ",(0,r.jsx)(n.code,{children:"True"})," to keep data in-band or ",(0,r.jsx)(n.code,{children:"False"})," to send it out-of-band:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import pyfory\nimport numpy as np\n\nfory = pyfory.Fory(xlang=False, ref=True, strict=False)\n\narr1 = np.arange(1000, dtype=np.float64)\narr2 = np.arange(2000, dtype=np.float64)\ndata = [arr1, arr2]\n\nbuffer_objects = []\ncounter = 0\n\ndef selective_callback(buffer_object):\n    global counter\n    counter += 1\n    # Only send even-numbered buffers out-of-band\n    if counter % 2 == 0:\n        buffer_objects.append(buffer_object)\n        return False  # Out-of-band\n    return True  # In-band\n\nserialized = fory.serialize(data, buffer_callback=selective_callback)\nbuffers = [obj.getbuffer() for obj in buffer_objects]\ndeserialized = fory.deserialize(serialized, buffers=buffers)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"pickle5-compatibility",children:"Pickle5 Compatibility"}),"\n",(0,r.jsx)(n.p,{children:"Fory's out-of-band serialization is fully compatible with pickle protocol 5:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'import pyfory\nimport pickle\n\nfory = pyfory.Fory(xlang=False, ref=False, strict=False)\n\n# PickleBuffer objects are automatically supported\ndata = b"Large binary data"\npickle_buffer = pickle.PickleBuffer(data)\n\n# Serialize with buffer callback for out-of-band handling\nbuffer_objects = []\nserialized = fory.serialize(pickle_buffer, buffer_callback=buffer_objects.append)\nbuffers = [obj.getbuffer() for obj in buffer_objects]\n\n# Deserialize with buffers\ndeserialized = fory.deserialize(serialized, buffers=buffers)\nassert bytes(deserialized.raw()) == data\n'})}),"\n",(0,r.jsx)(n.h2,{id:"writing-buffers-to-different-streams",children:"Writing Buffers to Different Streams"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"BufferObject.write_to()"})," method accepts any writable stream object:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:"import pyfory\nimport numpy as np\nimport io\n\nfory = pyfory.Fory(xlang=False, ref=False, strict=False)\n\narray = np.arange(1000, dtype=np.float64)\n\n# Collect out-of-band buffers\nbuffer_objects = []\nserialized = fory.serialize(array, buffer_callback=buffer_objects.append)\n\n# Write to different stream types\nfor buffer_obj in buffer_objects:\n    # Write to BytesIO (in-memory stream)\n    bytes_stream = io.BytesIO()\n    buffer_obj.write_to(bytes_stream)\n\n    # Write to file\n    with open('/tmp/buffer_data.bin', 'wb') as f:\n        buffer_obj.write_to(f)\n\n    # Get zero-copy memoryview (for contiguous buffers)\n    mv = buffer_obj.getbuffer()\n    assert isinstance(mv, memoryview)\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note"}),": For contiguous memory buffers (like bytes, numpy arrays), ",(0,r.jsx)(n.code,{children:"getbuffer()"})," returns a zero-copy ",(0,r.jsx)(n.code,{children:"memoryview"}),". For non-contiguous data, a copy may be created to ensure contiguity."]}),"\n",(0,r.jsx)(n.h2,{id:"related-topics",children:"Related Topics"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/guide/python/numpy_integration",children:"NumPy Integration"})," - NumPy array serialization"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/guide/python/basic_serialization",children:"Basic Serialization"})," - Standard serialization"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/guide/python/configuration",children:"Configuration"})," - Fory parameters"]}),"\n"]})]})}function c(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},11151:(e,n,i)=>{i.d(n,{Z:()=>s,a:()=>o});var r=i(67294);const t={},a=r.createContext(t);function o(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);