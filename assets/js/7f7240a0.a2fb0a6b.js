"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[96488],{58008:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var i=r(85893),t=r(11151);const a={title:"Row Format",sidebar_position:9,id:"row_format",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},o=void 0,s={id:"guide/java/row_format",title:"Row Format",description:"Apache Fory\u2122 provides a random-access row format that enables reading nested fields from binary data without full deserialization. This drastically reduces overhead when working with large objects where only partial data access is needed.",source:"@site/versioned_docs/version-0.14/guide/java/row-format.md",sourceDirName:"guide/java",slug:"/guide/java/row_format",permalink:"/docs/0.14/guide/java/row_format",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/docs/guide/java/row-format.md",tags:[],version:"0.14",sidebarPosition:9,frontMatter:{title:"Row Format",sidebar_position:9,id:"row_format",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"Cross-Language Serialization",permalink:"/docs/0.14/guide/java/cross_language"},next:{title:"Migration Guide",permalink:"/docs/0.14/guide/java/migration"}},c={},l=[{value:"Overview",id:"overview",level:2},{value:"Basic Usage",id:"basic-usage",level:2},{value:"Key Benefits",id:"key-benefits",level:2},{value:"When to Use Row Format",id:"when-to-use-row-format",level:2},{value:"Cross-Language Compatibility",id:"cross-language-compatibility",level:2},{value:"Python",id:"python",level:3},{value:"C++",id:"c",level:3},{value:"Performance Comparison",id:"performance-comparison",level:2},{value:"Related Topics",id:"related-topics",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Apache Fory\u2122 provides a random-access row format that enables reading nested fields from binary data without full deserialization. This drastically reduces overhead when working with large objects where only partial data access is needed."}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"Row format is a cache-friendly binary random access format that supports:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Zero-copy access"}),": Read fields directly from binary without allocating objects"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Partial deserialization"}),": Access only the fields you need"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Skipping serialization"}),": Skip serialization of fields you don't need"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cross-language compatibility"}),": Works across Python, Java, C++, and other languages"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Column format conversion"}),": Can convert to Apache Arrow columnar format automatically"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'public class Bar {\n  String f1;\n  List<Long> f2;\n}\n\npublic class Foo {\n  int f1;\n  List<Integer> f2;\n  Map<String, Integer> f3;\n  List<Bar> f4;\n}\n\nRowEncoder<Foo> encoder = Encoders.bean(Foo.class);\n\n// Create large dataset\nFoo foo = new Foo();\nfoo.f1 = 10;\nfoo.f2 = IntStream.range(0, 1_000_000).boxed().collect(Collectors.toList());\nfoo.f3 = IntStream.range(0, 1_000_000).boxed().collect(Collectors.toMap(i -> "k" + i, i -> i));\nList<Bar> bars = new ArrayList<>(1_000_000);\nfor (int i = 0; i < 1_000_000; i++) {\n  Bar bar = new Bar();\n  bar.f1 = "s" + i;\n  bar.f2 = LongStream.range(0, 10).boxed().collect(Collectors.toList());\n  bars.add(bar);\n}\nfoo.f4 = bars;\n\n// Encode to row format (cross-language compatible with Python/C++)\nBinaryRow binaryRow = encoder.toRow(foo);\n\n// Zero-copy random access without full deserialization\nBinaryArray f2Array = binaryRow.getArray(1);              // Access f2 list\nBinaryArray f4Array = binaryRow.getArray(3);              // Access f4 list\nBinaryRow bar10 = f4Array.getStruct(10);                  // Access 11th Bar\nlong value = bar10.getArray(1).getInt64(5);               // Access 6th element of bar.f2\n\n// Partial deserialization - only deserialize what you need\nRowEncoder<Bar> barEncoder = Encoders.bean(Bar.class);\nBar bar1 = barEncoder.fromRow(f4Array.getStruct(10));     // Deserialize 11th Bar only\nBar bar2 = barEncoder.fromRow(f4Array.getStruct(20));     // Deserialize 21st Bar only\n\n// Full deserialization when needed\nFoo newFoo = encoder.fromRow(binaryRow);\n'})}),"\n",(0,i.jsx)(n.h2,{id:"key-benefits",children:"Key Benefits"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Feature"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Zero-Copy Access"}),(0,i.jsx)(n.td,{children:"Read nested fields without deserializing entire object"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Memory Efficiency"}),(0,i.jsx)(n.td,{children:"Memory-map large datasets directly from disk"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Cross-Language"}),(0,i.jsx)(n.td,{children:"Binary format compatible between Java, Python, C++"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Partial Deserialization"}),(0,i.jsx)(n.td,{children:"Deserialize only specific elements you need"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"High Performance"}),(0,i.jsx)(n.td,{children:"Skip unnecessary data parsing for analytics workloads"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"when-to-use-row-format",children:"When to Use Row Format"}),"\n",(0,i.jsx)(n.p,{children:"Row format is ideal for:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Analytics workloads"}),": When you only need to access specific fields"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Large datasets"}),": When full deserialization is too expensive"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Memory-mapped files"}),": Working with data larger than RAM"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Data pipelines"}),": Processing data without full object reconstruction"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cross-language data sharing"}),": When data needs to be accessed from multiple languages"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"cross-language-compatibility",children:"Cross-Language Compatibility"}),"\n",(0,i.jsx)(n.p,{children:"Row format works seamlessly across languages. The same binary data can be accessed from:"}),"\n",(0,i.jsx)(n.h3,{id:"python",children:"Python"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import pyfory\nimport pyarrow as pa\nfrom dataclasses import dataclass\nfrom typing import List, Dict\n\n@dataclass\nclass Bar:\n    f1: str\n    f2: List[pa.int64]\n\n@dataclass\nclass Foo:\n    f1: pa.int32\n    f2: List[pa.int32]\n    f3: Dict[str, pa.int32]\n    f4: List[Bar]\n\nencoder = pyfory.encoder(Foo)\nbinary: bytes = encoder.to_row(foo).to_bytes()\n\n# Zero-copy access\nfoo_row = pyfory.RowData(encoder.schema, binary)\nprint(foo_row.f2[100000])\nprint(foo_row.f4[100000].f1)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"c",children:"C++"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:'#include "fory/encoder/row_encoder.h"\n#include "fory/row/writer.h"\n\nstruct Bar {\n  std::string f1;\n  std::vector<int64_t> f2;\n};\n\nFORY_FIELD_INFO(Bar, f1, f2);\n\nstruct Foo {\n  int32_t f1;\n  std::vector<int32_t> f2;\n  std::map<std::string, int32_t> f3;\n  std::vector<Bar> f4;\n};\n\nFORY_FIELD_INFO(Foo, f1, f2, f3, f4);\n\nfory::encoder::RowEncoder<Foo> encoder;\nencoder.Encode(foo);\nauto row = encoder.GetWriter().ToRow();\n\n// Zero-copy random access\nauto f2_array = row->GetArray(1);\nauto f4_array = row->GetArray(3);\nauto bar10 = f4_array->GetStruct(10);\nint64_t value = bar10->GetArray(1)->GetInt64(5);\nstd::string str = bar10->GetString(0);\n'})}),"\n",(0,i.jsx)(n.h2,{id:"performance-comparison",children:"Performance Comparison"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Operation"}),(0,i.jsx)(n.th,{children:"Object Format"}),(0,i.jsx)(n.th,{children:"Row Format"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Full deserialization"}),(0,i.jsx)(n.td,{children:"Allocates all objects"}),(0,i.jsx)(n.td,{children:"Zero allocation"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Single field access"}),(0,i.jsx)(n.td,{children:"Full deserialization required"}),(0,i.jsx)(n.td,{children:"Direct offset read"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Memory usage"}),(0,i.jsx)(n.td,{children:"Full object graph in memory"}),(0,i.jsx)(n.td,{children:"Only accessed fields"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Suitable for"}),(0,i.jsx)(n.td,{children:"Small objects, full access"}),(0,i.jsx)(n.td,{children:"Large objects, selective access"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"related-topics",children:"Related Topics"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/0.14/guide/java/cross_language",children:"Cross-Language Serialization"})," - XLANG mode"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/0.14/guide/java/advanced_features",children:"Advanced Features"})," - Zero-copy serialization"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://fory.apache.org/docs/specification/row_format_spec",children:"Row Format Specification"})," - Protocol details"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},11151:(e,n,r)=>{r.d(n,{Z:()=>s,a:()=>o});var i=r(67294);const t={},a=i.createContext(t);function o(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);