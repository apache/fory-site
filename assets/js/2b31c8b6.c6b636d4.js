"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[31803],{38412:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>d,metadata:()=>o,toc:()=>c});var i=r(85893),s=r(11151);const d={title:"Protobuf IDL Support",sidebar_position:10,id:"protobuf_idl_support",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},t=void 0,o={id:"compiler/protobuf_idl_support",title:"Protobuf IDL Support",description:"This page explains how Apache Fory works with Protocol Buffers (.proto) schemas,",source:"@site/docs/compiler/protobuf-idl.md",sourceDirName:"compiler",slug:"/compiler/protobuf_idl_support",permalink:"/docs/next/compiler/protobuf_idl_support",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/docs/compiler/protobuf-idl.md",tags:[],version:"current",sidebarPosition:10,frontMatter:{title:"Protobuf IDL Support",sidebar_position:10,id:"protobuf_idl_support",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"FlatBuffers IDL Support",permalink:"/docs/next/compiler/flatbuffers_idl"},next:{title:"Java Serialization Guide",permalink:"/docs/next/guide/java/"}},l={},c=[{value:"What This Page Covers",id:"what-this-page-covers",level:2},{value:"Quick Decision Guide",id:"quick-decision-guide",level:2},{value:"Protobuf vs Fory at a Glance",id:"protobuf-vs-fory-at-a-glance",level:2},{value:"Why Use Apache Fory",id:"why-use-apache-fory",level:2},{value:"Syntax and Semantic Mapping",id:"syntax-and-semantic-mapping",level:2},{value:"Package and File Options",id:"package-and-file-options",level:3},{value:"Message and Enum Definitions",id:"message-and-enum-definitions",level:3},{value:"<code>oneof</code> to <code>union</code>",id:"oneof-to-union",level:3},{value:"Imports and Well-Known Types",id:"imports-and-well-known-types",level:3},{value:"Type Mapping Highlights",id:"type-mapping-highlights",level:2},{value:"Fory Extension Options (Protobuf)",id:"fory-extension-options-protobuf",level:2},{value:"File-Level Options",id:"file-level-options",level:3},{value:"Message and Enum Options",id:"message-and-enum-options",level:3},{value:"Field-Level Options",id:"field-level-options",level:3},{value:"Option Examples by Shape",id:"option-examples-by-shape",level:3},{value:"Reference Tracking vs Protobuf IDs",id:"reference-tracking-vs-protobuf-ids",level:2},{value:"Migration Guide: Protobuf to Fory",id:"migration-guide-protobuf-to-fory",level:2},{value:"Step 1: Translate Schema Syntax",id:"step-1-translate-schema-syntax",level:3},{value:"Step 2: Convert <code>oneof</code> and Special Types",id:"step-2-convert-oneof-and-special-types",level:3},{value:"Step 3: Replace Protobuf Workarounds with <code>ref</code>",id:"step-3-replace-protobuf-workarounds-with-ref",level:3},{value:"Step 4: Update Build/Codegen",id:"step-4-update-buildcodegen",level:3},{value:"Step 5: Run Compatibility Checks",id:"step-5-run-compatibility-checks",level:3},{value:"Coexistence Strategy",id:"coexistence-strategy",level:2},{value:"Performance References",id:"performance-references",level:2},{value:"Summary",id:"summary",level:2}];function a(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["This page explains how Apache Fory works with Protocol Buffers (",(0,i.jsx)(n.code,{children:".proto"}),") schemas,\nhow protobuf concepts map to Fory, and how to use protobuf-only Fory extension options."]}),"\n",(0,i.jsx)(n.h2,{id:"what-this-page-covers",children:"What This Page Covers"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Choosing protobuf vs Fory for your use case"}),"\n",(0,i.jsx)(n.li,{children:"Syntax and semantic differences that matter during migration"}),"\n",(0,i.jsx)(n.li,{children:"Supported Fory extension options in protobuf files"}),"\n",(0,i.jsx)(n.li,{children:"Practical migration patterns from protobuf to Fory"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"quick-decision-guide",children:"Quick Decision Guide"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Situation"}),(0,i.jsx)(n.th,{children:"Recommended Format"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"You are building gRPC APIs and rely on protobuf tooling"}),(0,i.jsx)(n.td,{children:"Protocol Buffers"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"You need maximum object-graph performance and ref tracking"}),(0,i.jsx)(n.td,{children:"Fory"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"You need circular/shared references in serialized data"}),(0,i.jsx)(n.td,{children:"Fory"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"You need strong unknown-field behavior for wire compatibility"}),(0,i.jsx)(n.td,{children:"Protocol Buffers"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"You need native structs/classes instead of protobuf wrappers"}),(0,i.jsx)(n.td,{children:"Fory"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"protobuf-vs-fory-at-a-glance",children:"Protobuf vs Fory at a Glance"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Aspect"}),(0,i.jsx)(n.th,{children:"Protocol Buffers"}),(0,i.jsx)(n.th,{children:"Fory"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Primary purpose"}),(0,i.jsx)(n.td,{children:"RPC/message contracts"}),(0,i.jsx)(n.td,{children:"High-performance object serialization"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Encoding model"}),(0,i.jsx)(n.td,{children:"Tag-length-value"}),(0,i.jsx)(n.td,{children:"Fory binary protocol"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Reference tracking"}),(0,i.jsx)(n.td,{children:"Not built-in"}),(0,i.jsxs)(n.td,{children:["First-class (",(0,i.jsx)(n.code,{children:"ref"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Circular refs"}),(0,i.jsx)(n.td,{children:"Not supported"}),(0,i.jsx)(n.td,{children:"Supported"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Unknown fields"}),(0,i.jsx)(n.td,{children:"Preserved"}),(0,i.jsx)(n.td,{children:"Not preserved"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Generated types"}),(0,i.jsx)(n.td,{children:"Protobuf-specific model types"}),(0,i.jsx)(n.td,{children:"Native language constructs"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"gRPC ecosystem"}),(0,i.jsx)(n.td,{children:"Native"}),(0,i.jsx)(n.td,{children:"In progress (active development)"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"Fory gRPC support is under active development. For production gRPC\nworkflows today, protobuf remains the mature/default choice."}),"\n",(0,i.jsx)(n.h2,{id:"why-use-apache-fory",children:"Why Use Apache Fory"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Idiomatic generated code: Fory IDL generates language-idiomatic classes and\nstructs that can be used directly as domain objects."}),"\n",(0,i.jsx)(n.li,{children:"Faster serialization: In Fory benchmarks, Fory can be around 10x faster than\nprotobuf for object serialization workloads."}),"\n",(0,i.jsx)(n.li,{children:"Better graph modeling: Shared and circular references are first-class features\ninstead of application-level ID-link workarounds."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["See benchmark details under ",(0,i.jsx)(n.a,{href:"#performance-references",children:"Performance References"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"syntax-and-semantic-mapping",children:"Syntax and Semantic Mapping"}),"\n",(0,i.jsx)(n.h3,{id:"package-and-file-options",children:"Package and File Options"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Protocol Buffers"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-protobuf",children:'syntax = "proto3";\npackage example.models;\noption java_package = "com.example.models";\noption go_package = "example.com/models";\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Fory"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-protobuf",children:"package example.models;\n"})}),"\n",(0,i.jsx)(n.p,{children:"Fory uses one package namespace for cross-language registration. Language-specific\npackage placement is still configurable in code generation."}),"\n",(0,i.jsx)(n.h3,{id:"message-and-enum-definitions",children:"Message and Enum Definitions"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Protocol Buffers"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-protobuf",children:"message User {\n  string id = 1;\n  string name = 2;\n  optional string email = 3;\n  int32 age = 4;\n  repeated string tags = 5;\n  map<string, string> metadata = 6;\n}\n\nenum Status {\n  STATUS_UNSPECIFIED = 0;\n  STATUS_ACTIVE = 1;\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Fory"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-protobuf",children:"message User [id=101] {\n    string id = 1;\n    string name = 2;\n    optional string email = 3;\n    int32 age = 4;\n    list<string> tags = 5;\n    map<string, string> metadata = 6;\n}\n\nenum Status [id=102] {\n    UNKNOWN = 0;\n    ACTIVE = 1;\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Key differences:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Fory can assign stable type IDs directly (",(0,i.jsx)(n.code,{children:"[id=...]"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Fory uses ",(0,i.jsx)(n.code,{children:"list<T>"})," (with ",(0,i.jsx)(n.code,{children:"repeated T"})," as alias)."]}),"\n",(0,i.jsx)(n.li,{children:"Enum naming conventions are language-driven instead of protobuf prefix style."}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"oneof-to-union",children:[(0,i.jsx)(n.code,{children:"oneof"})," to ",(0,i.jsx)(n.code,{children:"union"})]}),"\n",(0,i.jsxs)(n.p,{children:["Protobuf ",(0,i.jsx)(n.code,{children:"oneof"})," is translated to a nested Fory ",(0,i.jsx)(n.code,{children:"union"})," plus an optional field\nreferencing that union."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Protocol Buffers"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-protobuf",children:"message Event {\n  oneof payload {\n    string text = 1;\n    int32 number = 2;\n  }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Fory-style shape after translation"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-protobuf",children:"message Event {\n    union payload {\n        string text = 1;\n        int32 number = 2;\n    }\n    optional payload payload = 1;\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Notes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Union case IDs are derived from the original ",(0,i.jsx)(n.code,{children:"oneof"})," field numbers."]}),"\n",(0,i.jsxs)(n.li,{children:["The synthetic union field uses the smallest ",(0,i.jsx)(n.code,{children:"oneof"})," case number."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"imports-and-well-known-types",children:"Imports and Well-Known Types"}),"\n",(0,i.jsx)(n.p,{children:"Protobuf imports are supported. Common well-known types map directly:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"google.protobuf.Timestamp"})," -> ",(0,i.jsx)(n.code,{children:"timestamp"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"google.protobuf.Duration"})," -> ",(0,i.jsx)(n.code,{children:"duration"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"google.protobuf.Any"})," -> ",(0,i.jsx)(n.code,{children:"any"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"type-mapping-highlights",children:"Type Mapping Highlights"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Protobuf Type"}),(0,i.jsx)(n.th,{children:"Fory Mapping"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"bool"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"bool"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"int32"}),", ",(0,i.jsx)(n.code,{children:"uint32"})]}),(0,i.jsx)(n.td,{children:"variable-length 32-bit integer kinds"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sint32"})}),(0,i.jsx)(n.td,{children:"zigzag 32-bit integer"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"int64"}),", ",(0,i.jsx)(n.code,{children:"uint64"})]}),(0,i.jsx)(n.td,{children:"variable-length 64-bit integer kinds"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sint64"})}),(0,i.jsx)(n.td,{children:"zigzag 64-bit integer"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"fixed32"}),", ",(0,i.jsx)(n.code,{children:"fixed64"})]}),(0,i.jsx)(n.td,{children:"fixed-width unsigned integer kinds"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"sfixed32"}),", ",(0,i.jsx)(n.code,{children:"sfixed64"})]}),(0,i.jsx)(n.td,{children:"fixed-width signed integer kinds"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"float"}),", ",(0,i.jsx)(n.code,{children:"double"})]}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"float32"}),", ",(0,i.jsx)(n.code,{children:"float64"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"string"}),", ",(0,i.jsx)(n.code,{children:"bytes"})]}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"string"}),", ",(0,i.jsx)(n.code,{children:"bytes"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"repeated T"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"list<T>"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"map<K, V>"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"map<K, V>"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"optional T"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"optional T"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"oneof"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"union"})," + optional union reference field"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'int64 [(fory).type = "tagged_int64"]'})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"tagged_int64"})," encoding"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:'uint64 [(fory).type = "tagged_uint64"]'})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"tagged_uint64"})," encoding"]})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"fory-extension-options-protobuf",children:"Fory Extension Options (Protobuf)"}),"\n",(0,i.jsxs)(n.p,{children:["Fory-specific options in ",(0,i.jsx)(n.code,{children:".proto"})," use the ",(0,i.jsx)(n.code,{children:"(fory)."})," prefix."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-protobuf",children:"option (fory).enable_auto_type_id = true;\n\nmessage TreeNode {\n  TreeNode parent = 1 [(fory).weak_ref = true];\n  repeated TreeNode children = 2 [(fory).ref = true];\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"file-level-options",children:"File-Level Options"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Option"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(fory).use_record_for_java_message"})}),(0,i.jsx)(n.td,{children:"bool"}),(0,i.jsx)(n.td,{children:"Generate Java records for all messages in this file"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(fory).polymorphism"})}),(0,i.jsx)(n.td,{children:"bool"}),(0,i.jsx)(n.td,{children:"Enable polymorphic serialization metadata by default"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(fory).enable_auto_type_id"})}),(0,i.jsx)(n.td,{children:"bool"}),(0,i.jsx)(n.td,{children:"Auto-generate type IDs when omitted (compiler default is true)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(fory).evolving"})}),(0,i.jsx)(n.td,{children:"bool"}),(0,i.jsx)(n.td,{children:"Default schema-evolution behavior for messages"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(fory).go_nested_type_style"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsxs)(n.td,{children:["Go nested naming style: ",(0,i.jsx)(n.code,{children:"underscore"})," (default) or ",(0,i.jsx)(n.code,{children:"camelcase"})]})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"message-and-enum-options",children:"Message and Enum Options"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Option"}),(0,i.jsx)(n.th,{children:"Applies To"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(fory).id"})}),(0,i.jsx)(n.td,{children:"message, enum"}),(0,i.jsx)(n.td,{children:"int"}),(0,i.jsx)(n.td,{children:"Explicit type ID for registration"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(fory).alias"})}),(0,i.jsx)(n.td,{children:"message, enum"}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Alternate name used for auto-ID hashing"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(fory).evolving"})}),(0,i.jsx)(n.td,{children:"message"}),(0,i.jsx)(n.td,{children:"bool"}),(0,i.jsx)(n.td,{children:"Override file-level evolution setting"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(fory).use_record_for_java"})}),(0,i.jsx)(n.td,{children:"message"}),(0,i.jsx)(n.td,{children:"bool"}),(0,i.jsx)(n.td,{children:"Generate Java record for this message"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(fory).deprecated"})}),(0,i.jsx)(n.td,{children:"message, enum"}),(0,i.jsx)(n.td,{children:"bool"}),(0,i.jsx)(n.td,{children:"Mark type as deprecated"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(fory).namespace"})}),(0,i.jsx)(n.td,{children:"message"}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"Override default package-based namespace"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"field-level-options",children:"Field-Level Options"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Option"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(fory).ref"})}),(0,i.jsx)(n.td,{children:"bool"}),(0,i.jsx)(n.td,{children:"Enable reference tracking for this field"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(fory).nullable"})}),(0,i.jsx)(n.td,{children:"bool"}),(0,i.jsxs)(n.td,{children:["Treat field as nullable (",(0,i.jsx)(n.code,{children:"optional"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(fory).weak_ref"})}),(0,i.jsx)(n.td,{children:"bool"}),(0,i.jsx)(n.td,{children:"Generate weak pointer semantics (C++/Rust codegen)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(fory).thread_safe_pointer"})}),(0,i.jsx)(n.td,{children:"bool"}),(0,i.jsxs)(n.td,{children:["Rust pointer flavor for ref fields (",(0,i.jsx)(n.code,{children:"Arc"})," vs ",(0,i.jsx)(n.code,{children:"Rc"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(fory).deprecated"})}),(0,i.jsx)(n.td,{children:"bool"}),(0,i.jsx)(n.td,{children:"Mark field as deprecated"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"(fory).type"})}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsxs)(n.td,{children:["Primitive override, currently ",(0,i.jsx)(n.code,{children:"tagged_int64"}),"/",(0,i.jsx)(n.code,{children:"tagged_uint64"})]})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"Reference option behavior:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"weak_ref = true"})," implies ref tracking."]}),"\n",(0,i.jsxs)(n.li,{children:["For ",(0,i.jsx)(n.code,{children:"repeated"})," fields, ",(0,i.jsx)(n.code,{children:"(fory).ref = true"})," applies to list elements."]}),"\n",(0,i.jsxs)(n.li,{children:["For ",(0,i.jsx)(n.code,{children:"map<K, V>"})," fields, ",(0,i.jsx)(n.code,{children:"(fory).ref = true"})," applies to map values."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"weak_ref"})," and ",(0,i.jsx)(n.code,{children:"thread_safe_pointer"})," are codegen hints for C++/Rust."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"option-examples-by-shape",children:"Option Examples by Shape"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-protobuf",children:"message Graph {\n  Node root = 1 [(fory).ref = true, (fory).thread_safe_pointer = false];\n  repeated Node nodes = 2 [(fory).ref = true];\n  map<string, Node> cache = 3 [(fory).ref = true];\n  Node parent = 4 [(fory).weak_ref = true];\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"reference-tracking-vs-protobuf-ids",children:"Reference Tracking vs Protobuf IDs"}),"\n",(0,i.jsx)(n.p,{children:"Protobuf itself does not preserve shared/cyclic object graphs. With Fory\nprotobuf extensions, you can opt into graph semantics."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Without Fory ref options (protobuf-style IDs):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-protobuf",children:"message TreeNode {\n  string id = 1;\n  string parent_id = 2;\n  repeated string child_ids = 3;\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"With Fory ref options (object graph):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-protobuf",children:"message TreeNode {\n  TreeNode parent = 1 [(fory).weak_ref = true];\n  repeated TreeNode children = 2 [(fory).ref = true];\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"migration-guide-protobuf-to-fory",children:"Migration Guide: Protobuf to Fory"}),"\n",(0,i.jsx)(n.h3,{id:"step-1-translate-schema-syntax",children:"Step 1: Translate Schema Syntax"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Keep package names stable."}),"\n",(0,i.jsxs)(n.li,{children:["Replace ",(0,i.jsx)(n.code,{children:"repeated T"})," with ",(0,i.jsx)(n.code,{children:"list<T>"})," (or keep ",(0,i.jsx)(n.code,{children:"repeated"})," alias)."]}),"\n",(0,i.jsxs)(n.li,{children:["Add explicit ",(0,i.jsx)(n.code,{children:"[id=...]"})," where you need stable numeric registration."]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"step-2-convert-oneof-and-special-types",children:["Step 2: Convert ",(0,i.jsx)(n.code,{children:"oneof"})," and Special Types"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"oneof"})," -> ",(0,i.jsx)(n.code,{children:"union"})," + optional union field."]}),"\n",(0,i.jsxs)(n.li,{children:["Map protobuf well-known types to Fory primitives (",(0,i.jsx)(n.code,{children:"timestamp"}),", ",(0,i.jsx)(n.code,{children:"duration"}),", ",(0,i.jsx)(n.code,{children:"any"}),")."]}),"\n"]}),"\n",(0,i.jsxs)(n.h3,{id:"step-3-replace-protobuf-workarounds-with-ref",children:["Step 3: Replace Protobuf Workarounds with ",(0,i.jsx)(n.code,{children:"ref"})]}),"\n",(0,i.jsxs)(n.p,{children:["Where protobuf used manual ID links for object graphs, switch to Fory ",(0,i.jsx)(n.code,{children:"ref"}),"\nmodifiers (and optional ",(0,i.jsx)(n.code,{children:"ref(weak=true)"})," where needed)."]}),"\n",(0,i.jsx)(n.h3,{id:"step-4-update-buildcodegen",children:"Step 4: Update Build/Codegen"}),"\n",(0,i.jsx)(n.p,{children:"Replace protobuf generation steps with the Fory compiler invocation for target\nlanguages."}),"\n",(0,i.jsx)(n.h3,{id:"step-5-run-compatibility-checks",children:"Step 5: Run Compatibility Checks"}),"\n",(0,i.jsx)(n.p,{children:"For staged migrations, keep both formats in parallel and verify payload-level\nparity with integration tests."}),"\n",(0,i.jsx)(n.h2,{id:"coexistence-strategy",children:"Coexistence Strategy"}),"\n",(0,i.jsx)(n.p,{children:"You can run protobuf and Fory in parallel during migration:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"public byte[] serialize(Object obj, Format format) {\n    if (format == Format.PROTOBUF) {\n        return ((MessageLite) obj).toByteArray();\n    }\n    return fory.serialize(obj);\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Use translators at service boundaries while internal object-graph heavy paths\nmigrate first."}),"\n",(0,i.jsx)(n.h2,{id:"performance-references",children:"Performance References"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Benchmarks: ",(0,i.jsx)(n.a,{href:"https://fory.apache.org/docs/introduction/benchmark",children:"https://fory.apache.org/docs/introduction/benchmark"})]}),"\n",(0,i.jsxs)(n.li,{children:["Benchmark code: ",(0,i.jsx)(n.a,{href:"https://github.com/apache/fory/tree/main/benchmarks",children:"https://github.com/apache/fory/tree/main/benchmarks"})]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:"Use protobuf when your primary concern is API contracts and gRPC ecosystem\nintegration. Use Fory when object-graph performance, native models, and\nreference semantics are the primary concern."})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},11151:(e,n,r)=>{r.d(n,{Z:()=>o,a:()=>t});var i=r(67294);const s={},d=i.createContext(s);function t(e){const n=i.useContext(d);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(d.Provider,{value:n},e.children)}}}]);