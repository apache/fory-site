"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[42238],{79137:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>c});var s=i(85893),o=i(11151);const a={title:"Python Native Mode",sidebar_position:5,id:"native_mode",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},r=void 0,t={id:"guide/python/native_mode",title:"Python Native Mode",description:"pyfory provides a Python-native serialization mode that offers the same functionality as pickle/cloudpickle, but with significantly better performance, smaller data size, and enhanced security features.",source:"@site/versioned_docs/version-0.15/guide/python/python-native.md",sourceDirName:"guide/python",slug:"/guide/python/native_mode",permalink:"/docs/guide/python/native_mode",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/docs/guide/python/python-native.md",tags:[],version:"0.15",sidebarPosition:5,frontMatter:{title:"Python Native Mode",sidebar_position:5,id:"native_mode",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"Field Configuration",permalink:"/docs/guide/python/field_configuration"},next:{title:"Schema Evolution",permalink:"/docs/guide/python/schema_evolution"}},l={},c=[{value:"Overview",id:"overview",level:2},{value:"Drop-in Replacement for Pickle/Cloudpickle",id:"drop-in-replacement-for-picklecloudpickle",level:2},{value:"Common Usage",id:"common-usage",level:3},{value:"Serialize Global Functions",id:"serialize-global-functions",level:2},{value:"Serialize Local Functions/Lambdas",id:"serialize-local-functionslambdas",level:2},{value:"Serialize Global Classes/Methods",id:"serialize-global-classesmethods",level:2},{value:"Serialize Local Classes/Methods",id:"serialize-local-classesmethods",level:2},{value:"Performance Comparison",id:"performance-comparison",level:2},{value:"Related Topics",id:"related-topics",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"pyfory"})," provides a Python-native serialization mode that offers the same functionality as pickle/cloudpickle, but with ",(0,s.jsx)(n.strong,{children:"significantly better performance, smaller data size, and enhanced security features"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsxs)(n.p,{children:["The binary protocol and API are similar to Fory's xlang mode, but Python-native mode can serialize any Python object\u2014including global functions, local functions, lambdas, local classes and types with customized serialization using ",(0,s.jsx)(n.code,{children:"__getstate__/__reduce__/__reduce_ex__"}),", which are not allowed in xlang mode."]}),"\n",(0,s.jsxs)(n.p,{children:["To use Python-native mode, create ",(0,s.jsx)(n.code,{children:"Fory"})," with ",(0,s.jsx)(n.code,{children:"xlang=False"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import pyfory\nfory = pyfory.Fory(xlang=False, ref=False, strict=True)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"drop-in-replacement-for-picklecloudpickle",children:"Drop-in Replacement for Pickle/Cloudpickle"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"pyfory"})," can serialize any Python object with the following configuration:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"For circular references"}),": Set ",(0,s.jsx)(n.code,{children:"ref=True"})," to enable reference tracking"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"For functions/classes"}),": Set ",(0,s.jsx)(n.code,{children:"strict=False"})," to allow deserialization of dynamic types"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"\u26a0\ufe0f Security Warning"}),": When ",(0,s.jsx)(n.code,{children:"strict=False"}),", Fory will deserialize arbitrary types, which can pose security risks if data comes from untrusted sources. Only use ",(0,s.jsx)(n.code,{children:"strict=False"})," in controlled environments where you trust the data source completely."]}),"\n",(0,s.jsx)(n.h3,{id:"common-usage",children:"Common Usage"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'import pyfory\n\n# Create Fory instance\nfory = pyfory.Fory(xlang=False, ref=True, strict=False)\n\n# serialize common Python objects\ndata = fory.dumps({"name": "Alice", "age": 30, "scores": [95, 87, 92]})\nprint(fory.loads(data))\n\n# serialize custom objects\nfrom dataclasses import dataclass\n\n@dataclass\nclass Person:\n    name: str\n    age: int\n\nperson = Person("Bob", 25)\ndata = fory.dumps(person)\nprint(fory.loads(data))  # Person(name=\'Bob\', age=25)\n'})}),"\n",(0,s.jsx)(n.h2,{id:"serialize-global-functions",children:"Serialize Global Functions"}),"\n",(0,s.jsx)(n.p,{children:"Capture and serialize functions defined at module level. Fory deserialize and return same function object:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import pyfory\n\nfory = pyfory.Fory(xlang=False, ref=True, strict=False)\n\ndef my_global_function(x):\n    return 10 * x\n\ndata = fory.dumps(my_global_function)\nprint(fory.loads(data)(10))  # 100\n"})}),"\n",(0,s.jsx)(n.h2,{id:"serialize-local-functionslambdas",children:"Serialize Local Functions/Lambdas"}),"\n",(0,s.jsx)(n.p,{children:"Serialize functions with closures and lambda expressions. Fory captures the closure variables automatically:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import pyfory\n\nfory = pyfory.Fory(xlang=False, ref=True, strict=False)\n\n# Local functions with closures\ndef my_function():\n    local_var = 10\n    def local_func(x):\n        return x * local_var\n    return local_func\n\ndata = fory.dumps(my_function())\nprint(fory.loads(data)(10))  # 100\n\n# Lambdas\ndata = fory.dumps(lambda x: 10 * x)\nprint(fory.loads(data)(10))  # 100\n"})}),"\n",(0,s.jsx)(n.h2,{id:"serialize-global-classesmethods",children:"Serialize Global Classes/Methods"}),"\n",(0,s.jsx)(n.p,{children:"Serialize class objects, instance methods, class methods, and static methods:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from dataclasses import dataclass\nimport pyfory\nfory = pyfory.Fory(xlang=False, ref=True, strict=False)\n\n@dataclass\nclass Person:\n    name: str\n    age: int\n\n    def f(self, x):\n        return self.age * x\n\n    @classmethod\n    def g(cls, x):\n        return 10 * x\n\n    @staticmethod\n    def h(x):\n        return 10 * x\n\n# Serialize global class\nprint(fory.loads(fory.dumps(Person))("Bob", 25))  # Person(name=\'Bob\', age=25)\n\n# Serialize instance method\nprint(fory.loads(fory.dumps(Person("Bob", 20).f))(10))  # 200\n\n# Serialize class method\nprint(fory.loads(fory.dumps(Person.g))(10))  # 100\n\n# Serialize static method\nprint(fory.loads(fory.dumps(Person.h))(10))  # 100\n'})}),"\n",(0,s.jsx)(n.h2,{id:"serialize-local-classesmethods",children:"Serialize Local Classes/Methods"}),"\n",(0,s.jsx)(n.p,{children:"Serialize classes defined inside functions along with their methods:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"from dataclasses import dataclass\nimport pyfory\nfory = pyfory.Fory(xlang=False, ref=True, strict=False)\n\ndef create_local_class():\n    class LocalClass:\n        def f(self, x):\n            return 10 * x\n\n        @classmethod\n        def g(cls, x):\n            return 10 * x\n\n        @staticmethod\n        def h(x):\n            return 10 * x\n    return LocalClass\n\n# Serialize local class\ndata = fory.dumps(create_local_class())\nprint(fory.loads(data)().f(10))  # 100\n\n# Serialize local class instance method\ndata = fory.dumps(create_local_class()().f)\nprint(fory.loads(data)(10))  # 100\n\n# Serialize local class method\ndata = fory.dumps(create_local_class().g)\nprint(fory.loads(data)(10))  # 100\n\n# Serialize local class static method\ndata = fory.dumps(create_local_class().h)\nprint(fory.loads(data)(10))  # 100\n"})}),"\n",(0,s.jsx)(n.h2,{id:"performance-comparison",children:"Performance Comparison"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'import pyfory\nimport pickle\nimport timeit\n\nfory = pyfory.Fory(xlang=False, ref=True, strict=False)\n\nobj = {f"key{i}": f"value{i}" for i in range(10000)}\nprint(f"Fory: {timeit.timeit(lambda: fory.dumps(obj), number=1000):.3f}s")\nprint(f"Pickle: {timeit.timeit(lambda: pickle.dumps(obj), number=1000):.3f}s")\n'})}),"\n",(0,s.jsx)(n.h2,{id:"related-topics",children:"Related Topics"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/guide/python/configuration",children:"Configuration"})," - Python mode configuration"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/guide/python/out_of_band",children:"Out-of-Band Serialization"})," - Zero-copy buffers"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/guide/python/security",children:"Security"})," - DeserializationPolicy"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},11151:(e,n,i)=>{i.d(n,{Z:()=>t,a:()=>r});var s=i(67294);const o={},a=s.createContext(o);function r(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);