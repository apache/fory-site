"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[34204],{30063:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>l,toc:()=>c});var s=i(85893),r=i(11151);const t={title:"FlatBuffers IDL Support",sidebar_position:7,id:"flatbuffers_idl",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},d=void 0,l={id:"compiler/flatbuffers_idl",title:"FlatBuffers IDL Support",description:"This page explains how Apache Fory consumes FlatBuffers schemas (.fbs) and",source:"@site/docs/compiler/flatbuffers-idl.md",sourceDirName:"compiler",slug:"/compiler/flatbuffers_idl",permalink:"/docs/next/compiler/flatbuffers_idl",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/docs/compiler/flatbuffers-idl.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{title:"FlatBuffers IDL Support",sidebar_position:7,id:"flatbuffers_idl",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"Generated Code",permalink:"/docs/next/compiler/generated_code"},next:{title:"Protobuf IDL Support",permalink:"/docs/next/compiler/protobuf_idl_support"}},a={},c=[{value:"What This Page Covers",id:"what-this-page-covers",level:2},{value:"Why Use Apache Fory",id:"why-use-apache-fory",level:2},{value:"Quick Decision Guide",id:"quick-decision-guide",level:2},{value:"FlatBuffers to Fory Mapping",id:"flatbuffers-to-fory-mapping",level:2},{value:"Schema-Level Rules",id:"schema-level-rules",level:3},{value:"Field Numbering",id:"field-numbering",level:3},{value:"Scalar Type Mapping",id:"scalar-type-mapping",level:3},{value:"Unions",id:"unions",level:3},{value:"Defaults and Metadata",id:"defaults-and-metadata",level:3},{value:"Fory-Specific Attributes in FlatBuffers",id:"fory-specific-attributes-in-flatbuffers",level:2},{value:"Supported Field Attributes",id:"supported-field-attributes",level:3},{value:"Generated Code Differences",id:"generated-code-differences",level:2},{value:"Usage",id:"usage",level:2},{value:"Migration Notes",id:"migration-notes",level:2},{value:"Summary",id:"summary",level:2}];function o(e){const n={code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["This page explains how Apache Fory consumes FlatBuffers schemas (",(0,s.jsx)(n.code,{children:".fbs"}),") and\ntranslates them into Fory IR for code generation."]}),"\n",(0,s.jsx)(n.h2,{id:"what-this-page-covers",children:"What This Page Covers"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"When to use FlatBuffers input with Fory"}),"\n",(0,s.jsx)(n.li,{children:"Exact FlatBuffers to Fory mapping behavior"}),"\n",(0,s.jsxs)(n.li,{children:["Supported Fory-specific attributes in ",(0,s.jsx)(n.code,{children:".fbs"})]}),"\n",(0,s.jsx)(n.li,{children:"Migration notes and generated-code differences"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"why-use-apache-fory",children:"Why Use Apache Fory"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Idiomatic generated code: Fory generates language-idiomatic classes/structs\nthat can be used directly as domain objects."}),"\n",(0,s.jsx)(n.li,{children:"Java performance: In Java object-serialization workloads, Fory is faster than\nFlatBuffers in Fory benchmarks."}),"\n",(0,s.jsx)(n.li,{children:"Other languages: serialization performance is generally in a similar range."}),"\n",(0,s.jsx)(n.li,{children:"Deserialization in practice: FlatBuffers does not perform native-object deserialization and is\nfaster by default, but if your application needs native objects, it requires\nconversion and that conversion step can dominate read cost. In those cases,\nFory deserialization is often faster end-to-end."}),"\n",(0,s.jsx)(n.li,{children:"Easier APIs: Fory uses direct native objects, so you do not need to\nreverse-build tables or manually manage offsets."}),"\n",(0,s.jsx)(n.li,{children:"Better graph modeling: Shared and circular references are first-class features\nin Fory."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"quick-decision-guide",children:"Quick Decision Guide"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Situation"}),(0,s.jsx)(n.th,{children:"Recommended Path"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:["You already have ",(0,s.jsx)(n.code,{children:".fbs"})," schemas and want Fory runtime/codegen"]}),(0,s.jsx)(n.td,{children:"Use FlatBuffers input"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"You are starting new schema work and want full Fory syntax control"}),(0,s.jsx)(n.td,{children:"Use native Fory IDL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"You need FlatBuffers wire compatibility at runtime"}),(0,s.jsx)(n.td,{children:"Keep FlatBuffers stack"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:["You need Fory object-graph semantics (",(0,s.jsx)(n.code,{children:"ref"}),", weak refs, etc.)"]}),(0,s.jsx)(n.td,{children:"Use Fory"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"flatbuffers-to-fory-mapping",children:"FlatBuffers to Fory Mapping"}),"\n",(0,s.jsx)(n.h3,{id:"schema-level-rules",children:"Schema-Level Rules"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"namespace"})," maps to Fory package namespace."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"include"})," entries map to Fory imports."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"table"})," is translated as ",(0,s.jsx)(n.code,{children:"evolving=true"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"struct"})," is translated as ",(0,s.jsx)(n.code,{children:"evolving=false"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"root_type"})," is parsed but ignored by Fory runtime/codegen."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"file_identifier"})," and ",(0,s.jsx)(n.code,{children:"file_extension"})," are parsed but not used by Fory codegen."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"field-numbering",children:"Field Numbering"}),"\n",(0,s.jsxs)(n.p,{children:["FlatBuffers fields do not have explicit field IDs. Fory assigns field numbers by\nsource declaration order, starting at ",(0,s.jsx)(n.code,{children:"1"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"scalar-type-mapping",children:"Scalar Type Mapping"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"FlatBuffers"}),(0,s.jsx)(n.th,{children:"Fory Type"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"byte"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"int8"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ubyte"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"uint8"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"short"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"int16"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ushort"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"uint16"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"int"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"int32"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"uint"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"uint32"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"long"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"int64"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ulong"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"uint64"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"float"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"float32"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"double"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"float64"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"bool"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"bool"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["Vectors (",(0,s.jsx)(n.code,{children:"[T]"}),") map to Fory lists."]}),"\n",(0,s.jsx)(n.h3,{id:"unions",children:"Unions"}),"\n",(0,s.jsx)(n.p,{children:"FlatBuffers unions map to Fory unions."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Case IDs are assigned by declaration order, starting at ",(0,s.jsx)(n.code,{children:"1"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"Case names are derived from type names using snake_case field naming."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"FlatBuffers"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-fbs",children:"union Payload {\n  Note,\n  Metric\n}\n\ntable Container {\n  payload: Payload;\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Fory shape after translation"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-protobuf",children:"union Payload {\n    Note note = 1;\n    Metric metric = 2;\n}\n\nmessage Container {\n    Payload payload = 1;\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"defaults-and-metadata",children:"Defaults and Metadata"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"FlatBuffers default values are parsed but not applied as Fory runtime defaults."}),"\n",(0,s.jsx)(n.li,{children:"Non-Fory metadata attributes are preserved as generic options in IR and may be\nconsumed by downstream tooling."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"fory-specific-attributes-in-flatbuffers",children:"Fory-Specific Attributes in FlatBuffers"}),"\n",(0,s.jsxs)(n.p,{children:["FlatBuffers metadata attributes use ",(0,s.jsx)(n.code,{children:"key:value"}),". For Fory-specific options, use\n",(0,s.jsx)(n.code,{children:"fory_"})," (or ",(0,s.jsx)(n.code,{children:"fory."}),") prefix in ",(0,s.jsx)(n.code,{children:".fbs"}),"; the prefix is removed during parsing."]}),"\n",(0,s.jsx)(n.h3,{id:"supported-field-attributes",children:"Supported Field Attributes"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"FlatBuffers Attribute"}),(0,s.jsx)(n.th,{children:"Effect in Fory"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"fory_ref:true"})}),(0,s.jsx)(n.td,{children:"Enable reference tracking for the field"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"fory_nullable:true"})}),(0,s.jsx)(n.td,{children:"Mark field optional/nullable"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"fory_weak_ref:true"})}),(0,s.jsxs)(n.td,{children:["Enable weak reference semantics and implies ",(0,s.jsx)(n.code,{children:"ref"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"fory_thread_safe_pointer:false"})}),(0,s.jsx)(n.td,{children:"For ref fields, select non-thread-safe pointer flavor"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"Semantics:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"fory_weak_ref:true"})," implies ",(0,s.jsx)(n.code,{children:"ref"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"fory_thread_safe_pointer"})," only takes effect when the field is ref-tracked."]}),"\n",(0,s.jsxs)(n.li,{children:["For list fields, ",(0,s.jsx)(n.code,{children:"fory_ref:true"})," applies to list elements."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-fbs",children:"table Node {\n  parent: Node (fory_weak_ref: true);\n  children: [Node] (fory_ref: true);\n  cached: Node (fory_ref: true, fory_thread_safe_pointer: false);\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"generated-code-differences",children:"Generated Code Differences"}),"\n",(0,s.jsxs)(n.p,{children:["Using ",(0,s.jsx)(n.code,{children:".fbs"})," as input to Fory still produces normal Fory-generated code, not\nFlatBuffers ",(0,s.jsx)(n.code,{children:"ByteBuffer"}),"-style APIs."]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Java: POJOs/records with Fory metadata"}),"\n",(0,s.jsx)(n.li,{children:"Python: dataclasses plus registration helpers"}),"\n",(0,s.jsx)(n.li,{children:"Go/Rust/C++: native structs and Fory metadata"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"The serialization format is Fory binary protocol, not FlatBuffers wire format."}),"\n",(0,s.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,s.jsx)(n.p,{children:"Compile a FlatBuffers schema directly:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"foryc schema.fbs --lang java,python --output ./generated\n"})}),"\n",(0,s.jsx)(n.p,{children:"Inspect translated schema syntax for debugging:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"foryc schema.fbs --emit-fdl --emit-fdl-path ./translated\n"})}),"\n",(0,s.jsx)(n.h2,{id:"migration-notes",children:"Migration Notes"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Keep existing ",(0,s.jsx)(n.code,{children:"namespace"})," values stable to keep type registration stable."]}),"\n",(0,s.jsx)(n.li,{children:"Review fields that relied on FlatBuffers default literals and set explicit\ndefaults in application code if needed."}),"\n",(0,s.jsxs)(n.li,{children:["Add ",(0,s.jsx)(n.code,{children:"fory_ref"}),"/",(0,s.jsx)(n.code,{children:"fory_weak_ref"})," where object-graph semantics are required."]}),"\n",(0,s.jsx)(n.li,{children:"Validate generated model behavior with roundtrip tests before replacing\nexisting serialization paths."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,s.jsxs)(n.p,{children:["FlatBuffers input lets you reuse existing ",(0,s.jsx)(n.code,{children:".fbs"})," schemas while moving to Fory's\nruntime and code generation model. This is useful for incremental migration,\nwhile preserving schema investment and adopting Fory-native object APIs."]})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},11151:(e,n,i)=>{i.d(n,{Z:()=>l,a:()=>d});var s=i(67294);const r={},t=s.createContext(r);function d(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);