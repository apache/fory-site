"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[36227],{59047:(e,i,s)=>{s.r(i),s.d(i,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>a,toc:()=>c});var n=s(85893),r=s(11151);const t={title:"Troubleshooting",sidebar_position:11,id:"troubleshooting",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},o=void 0,a={id:"guide/java/troubleshooting",title:"Troubleshooting",description:"This page covers common issues and their solutions.",source:"@site/docs/guide/java/troubleshooting.md",sourceDirName:"guide/java",slug:"/guide/java/troubleshooting",permalink:"/docs/next/guide/java/troubleshooting",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/docs/guide/java/troubleshooting.md",tags:[],version:"current",sidebarPosition:11,frontMatter:{title:"Troubleshooting",sidebar_position:11,id:"troubleshooting",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"Migration Guide",permalink:"/docs/next/guide/java/migration"},next:{title:"Python Serialization Guide",permalink:"/docs/next/guide/python/"}},l={},c=[{value:"Class Inconsistency and Class Version Check",id:"class-inconsistency-and-class-version-check",level:2},{value:"Using Wrong API for Deserialization",id:"using-wrong-api-for-deserialization",level:2},{value:"Deserialize POJO into Another Type",id:"deserialize-pojo-into-another-type",level:2},{value:"Common Error Messages",id:"common-error-messages",level:2},{value:"&quot;Class not registered&quot;",id:"class-not-registered",level:3},{value:"&quot;ClassNotCompatibleException&quot;",id:"classnotcompatibleexception",level:3},{value:"&quot;Max depth exceeded&quot;",id:"max-depth-exceeded",level:3},{value:"&quot;Serializer not found&quot;",id:"serializer-not-found",level:3},{value:"Performance Issues",id:"performance-issues",level:2},{value:"Slow Initial Serialization",id:"slow-initial-serialization",level:3},{value:"High Memory Usage",id:"high-memory-usage",level:3},{value:"Large Serialized Size",id:"large-serialized-size",level:3},{value:"Debugging Tips",id:"debugging-tips",level:2},{value:"Related Topics",id:"related-topics",level:2}];function d(e){const i={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.p,{children:"This page covers common issues and their solutions."}),"\n",(0,n.jsx)(i.h2,{id:"class-inconsistency-and-class-version-check",children:"Class Inconsistency and Class Version Check"}),"\n",(0,n.jsxs)(i.p,{children:["If you create Fory without setting ",(0,n.jsx)(i.code,{children:"CompatibleMode"})," to ",(0,n.jsx)(i.code,{children:"org.apache.fory.config.CompatibleMode.COMPATIBLE"}),", and you get a strange serialization error, it may be caused by class inconsistency between the serialization peer and deserialization peer."]}),"\n",(0,n.jsxs)(i.p,{children:["In such cases, you can invoke ",(0,n.jsx)(i.code,{children:"ForyBuilder#withClassVersionCheck"})," to create Fory to validate it. If deserialization throws ",(0,n.jsx)(i.code,{children:"org.apache.fory.exception.ClassNotCompatibleException"}),", it shows classes are inconsistent, and you should create Fory with ",(0,n.jsx)(i.code,{children:"ForyBuilder#withCompatibleMode(CompatibleMode.COMPATIBLE)"}),"."]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-java",children:"// Enable class version check to diagnose issues\nFory fory = Fory.builder()\n  .withLanguage(Language.JAVA)\n  .withClassVersionCheck(true)\n  .build();\n\n// If ClassNotCompatibleException is thrown, use compatible mode\nFory fory = Fory.builder()\n  .withLanguage(Language.JAVA)\n  .withCompatibleMode(CompatibleMode.COMPATIBLE)\n  .build();\n"})}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"Note"}),": ",(0,n.jsx)(i.code,{children:"CompatibleMode.COMPATIBLE"})," has more performance and space cost. Do not set it by default if your classes are always consistent between serialization and deserialization."]}),"\n",(0,n.jsx)(i.h2,{id:"using-wrong-api-for-deserialization",children:"Using Wrong API for Deserialization"}),"\n",(0,n.jsx)(i.p,{children:"Make sure you use the matching API pairs:"}),"\n",(0,n.jsxs)(i.table,{children:[(0,n.jsx)(i.thead,{children:(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.th,{children:"Serialization API"}),(0,n.jsx)(i.th,{children:"Deserialization API"})]})}),(0,n.jsxs)(i.tbody,{children:[(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"Fory#serialize"})}),(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"Fory#deserialize"})})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"Fory#serializeJavaObject"})}),(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"Fory#deserializeJavaObject"})})]}),(0,n.jsxs)(i.tr,{children:[(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"Fory#serializeJavaObjectAndClass"})}),(0,n.jsx)(i.td,{children:(0,n.jsx)(i.code,{children:"Fory#deserializeJavaObjectAndClass"})})]})]})]}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.strong,{children:"Wrong usage examples:"})}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-java",children:"// \u274c Wrong: serialize with serialize, deserialize with deserializeJavaObject\nbyte[] bytes = fory.serialize(object);\nObject result = fory.deserializeJavaObject(bytes, MyClass.class);  // Wrong!\n\n// \u274c Wrong: serialize with serializeJavaObject, deserialize with deserialize\nbyte[] bytes = fory.serializeJavaObject(object);\nObject result = fory.deserialize(bytes);  // Wrong!\n"})}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.strong,{children:"Correct usage:"})}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-java",children:"// \u2705 Correct: matching API pairs\nbyte[] bytes = fory.serialize(object);\nObject result = fory.deserialize(bytes);\n\nbyte[] bytes = fory.serializeJavaObject(object);\nMyClass result = fory.deserializeJavaObject(bytes, MyClass.class);\n\nbyte[] bytes = fory.serializeJavaObjectAndClass(object);\nObject result = fory.deserializeJavaObjectAndClass(bytes);\n"})}),"\n",(0,n.jsx)(i.h2,{id:"deserialize-pojo-into-another-type",children:"Deserialize POJO into Another Type"}),"\n",(0,n.jsxs)(i.p,{children:["If you want to serialize one POJO and deserialize it into a different POJO type, you must use ",(0,n.jsx)(i.code,{children:"CompatibleMode.COMPATIBLE"}),":"]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-java",children:'public class DeserializeIntoType {\n  static class Struct1 {\n    int f1;\n    String f2;\n\n    public Struct1(int f1, String f2) {\n      this.f1 = f1;\n      this.f2 = f2;\n    }\n  }\n\n  static class Struct2 {\n    int f1;\n    String f2;\n    double f3;\n  }\n\n  static ThreadSafeFory fory = Fory.builder()\n    .withCompatibleMode(CompatibleMode.COMPATIBLE).buildThreadSafeFory();\n\n  public static void main(String[] args) {\n    Struct1 struct1 = new Struct1(10, "abc");\n    byte[] data = fory.serializeJavaObject(struct1);\n    Struct2 struct2 = (Struct2) fory.deserializeJavaObject(data, Struct2.class);\n  }\n}\n'})}),"\n",(0,n.jsx)(i.h2,{id:"common-error-messages",children:"Common Error Messages"}),"\n",(0,n.jsx)(i.h3,{id:"class-not-registered",children:'"Class not registered"'}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"Cause"}),": Class registration is required but the class wasn't registered."]}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"Solution"}),": Register the class before serialization:"]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-java",children:"fory.register(MyClass.class);\n// or with explicit ID\nfory.register(MyClass.class, 100);\n"})}),"\n",(0,n.jsx)(i.h3,{id:"classnotcompatibleexception",children:'"ClassNotCompatibleException"'}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"Cause"}),": Class schema differs between serialization and deserialization."]}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"Solution"}),": Use compatible mode:"]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-java",children:"Fory fory = Fory.builder()\n  .withCompatibleMode(CompatibleMode.COMPATIBLE)\n  .build();\n"})}),"\n",(0,n.jsx)(i.h3,{id:"max-depth-exceeded",children:'"Max depth exceeded"'}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"Cause"}),": Object graph is too deep, possibly indicating a circular reference attack."]}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"Solution"}),": Increase max depth if legitimate, or check for malicious data:"]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-java",children:"Fory fory = Fory.builder()\n  .withMaxDepth(100)  // Increase from default 50\n  .build();\n"})}),"\n",(0,n.jsx)(i.h3,{id:"serializer-not-found",children:'"Serializer not found"'}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"Cause"}),": No serializer registered for the type."]}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"Solution"}),": Register a custom serializer:"]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-java",children:"fory.registerSerializer(MyClass.class, new MyClassSerializer(fory));\n"})}),"\n",(0,n.jsx)(i.h2,{id:"performance-issues",children:"Performance Issues"}),"\n",(0,n.jsx)(i.h3,{id:"slow-initial-serialization",children:"Slow Initial Serialization"}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"Cause"}),": JIT compilation happening on first serialization."]}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"Solution"}),": Enable async compilation:"]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-java",children:"Fory fory = Fory.builder()\n  .withAsyncCompilation(true)\n  .build();\n"})}),"\n",(0,n.jsx)(i.h3,{id:"high-memory-usage",children:"High Memory Usage"}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"Cause"}),": Large object graphs or reference tracking overhead."]}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"Solutions"}),":"]}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:["Disable reference tracking if not needed: ",(0,n.jsx)(i.code,{children:".withRefTracking(false)"})]}),"\n",(0,n.jsx)(i.li,{children:"Use custom memory allocator for pooling"}),"\n",(0,n.jsx)(i.li,{children:"Consider row format for large datasets"}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"large-serialized-size",children:"Large Serialized Size"}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"Cause"}),": Metadata overhead or uncompressed data."]}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.strong,{children:"Solutions"}),":"]}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:["Enable compression: ",(0,n.jsx)(i.code,{children:".withIntCompressed(true)"}),", ",(0,n.jsx)(i.code,{children:".withLongCompressed(true)"})]}),"\n",(0,n.jsx)(i.li,{children:"Use compatible mode only when needed"}),"\n",(0,n.jsx)(i.li,{children:"Register classes to avoid class name serialization"}),"\n"]}),"\n",(0,n.jsx)(i.h2,{id:"debugging-tips",children:"Debugging Tips"}),"\n",(0,n.jsxs)(i.ol,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Enable class version check"})," to diagnose schema issues"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Check API pairing"})," - ensure serialize/deserialize APIs match"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Verify registration order"})," - must be consistent across peers"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Enable logging"})," to see internal operations:"]}),"\n"]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-java",children:"LoggerFactory.setLogLevel(LogLevel.DEBUG_LEVEL);\n"})}),"\n",(0,n.jsx)(i.h2,{id:"related-topics",children:"Related Topics"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.a,{href:"/docs/next/guide/java/configuration",children:"Configuration Options"})," - All ForyBuilder options"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.a,{href:"/docs/next/guide/java/schema_evolution",children:"Schema Evolution"})," - Compatible mode details"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.a,{href:"/docs/next/guide/java/type_registration",children:"Type Registration"})," - Registration best practices"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.a,{href:"/docs/next/guide/java/migration",children:"Migration Guide"})," - Upgrading Fory versions"]}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,r.a)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},11151:(e,i,s)=>{s.d(i,{Z:()=>a,a:()=>o});var n=s(67294);const r={},t=n.createContext(r);function o(e){const i=n.useContext(t);return n.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),n.createElement(t.Provider,{value:i},e.children)}}}]);