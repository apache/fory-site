"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[7597],{28557:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>o,default:()=>f,frontMatter:()=>t,metadata:()=>s,toc:()=>c});var i=n(85893),a=n(11151);const t={title:"Zero-Copy Serialization",sidebar_position:50,id:"zero_copy",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},o=void 0,s={id:"guide/xlang/zero_copy",title:"Zero-Copy Serialization",description:"Zero-copy serialization allows large binary data (byte arrays, numeric arrays) to be serialized out-of-band, avoiding memory copies and reducing serialization overhead.",source:"@site/docs/guide/xlang/zero-copy.md",sourceDirName:"guide/xlang",slug:"/guide/xlang/zero_copy",permalink:"/docs/next/guide/xlang/zero_copy",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/docs/guide/xlang/zero-copy.md",tags:[],version:"current",sidebarPosition:50,frontMatter:{title:"Zero-Copy Serialization",sidebar_position:50,id:"zero_copy",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"Field Type Meta",permalink:"/docs/next/guide/xlang/field_type_meta"},next:{title:"Row Format",permalink:"/docs/next/guide/xlang/row_format"}},l={},c=[{value:"When to Use Zero-Copy",id:"when-to-use-zero-copy",level:2},{value:"How It Works",id:"how-it-works",level:2},{value:"Java",id:"java",level:2},{value:"Python",id:"python",level:2},{value:"Go",id:"go",level:2},{value:"JavaScript",id:"javascript",level:2},{value:"Use Cases",id:"use-cases",level:2},{value:"High-Performance Data Transfer",id:"high-performance-data-transfer",level:3},{value:"Memory-Mapped Files",id:"memory-mapped-files",level:3},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"See Also",id:"see-also",level:2}];function d(e){const r={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.p,{children:"Zero-copy serialization allows large binary data (byte arrays, numeric arrays) to be serialized out-of-band, avoiding memory copies and reducing serialization overhead."}),"\n",(0,i.jsx)(r.h2,{id:"when-to-use-zero-copy",children:"When to Use Zero-Copy"}),"\n",(0,i.jsx)(r.p,{children:"Use zero-copy serialization when:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Serializing large byte arrays or binary blobs"}),"\n",(0,i.jsx)(r.li,{children:"Working with numeric arrays (int[], double[], etc.)"}),"\n",(0,i.jsx)(r.li,{children:"Transferring data over high-performance networks"}),"\n",(0,i.jsx)(r.li,{children:"Memory efficiency is critical"}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Serialization"}),": Large buffers are extracted and returned separately via a callback"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Transport"}),": The main serialized data and buffer objects are transmitted separately"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Deserialization"}),": Buffers are provided back to reconstruct the original object"]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"This avoids copying large data into the main serialization buffer."}),"\n",(0,i.jsx)(r.h2,{id:"java",children:"Java"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-java",children:'import org.apache.fory.*;\nimport org.apache.fory.config.*;\nimport org.apache.fory.serializer.BufferObject;\nimport org.apache.fory.memory.MemoryBuffer;\n\nimport java.util.*;\nimport java.util.stream.Collectors;\n\npublic class ZeroCopyExample {\n  public static void main(String[] args) {\n    Fory fory = Fory.builder().withLanguage(Language.XLANG).build();\n\n    // Data with large arrays\n    List<Object> list = List.of(\n        "str",\n        new byte[1000],    // Large byte array\n        new int[100],      // Large int array\n        new double[100]    // Large double array\n    );\n\n    // Collect buffer objects during serialization\n    Collection<BufferObject> bufferObjects = new ArrayList<>();\n    byte[] bytes = fory.serialize(list, e -> !bufferObjects.add(e));\n\n    // Convert to buffers for transport\n    List<MemoryBuffer> buffers = bufferObjects.stream()\n        .map(BufferObject::toBuffer)\n        .collect(Collectors.toList());\n\n    // Deserialize with buffers\n    Object result = fory.deserialize(bytes, buffers);\n    System.out.println(result);\n  }\n}\n'})}),"\n",(0,i.jsx)(r.h2,{id:"python",children:"Python"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:'import array\nimport pyfory\nimport numpy as np\n\nfory = pyfory.Fory(xlang=True)\n\n# Data with large arrays\ndata = [\n    "str",\n    bytes(bytearray(1000)),           # Large byte array\n    array.array("i", range(100)),     # Large int array\n    np.full(100, 0.0, dtype=np.double) # Large numpy array\n]\n\n# Collect buffer objects during serialization\nserialized_objects = []\nserialized_data = fory.serialize(data, buffer_callback=serialized_objects.append)\n\n# Convert to buffers for transport\nbuffers = [obj.to_buffer() for obj in serialized_objects]\n\n# Deserialize with buffers\nresult = fory.deserialize(serialized_data, buffers=buffers)\nprint(result)\n'})}),"\n",(0,i.jsx)(r.h2,{id:"go",children:"Go"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:'package main\n\nimport forygo "github.com/apache/fory/go/fory"\nimport "fmt"\n\nfunc main() {\n  serializer := forygo.NewFory(forygo.WithXlang(true))\n\n  // Data with large arrays\n  list := []any{\n    "str",\n    make([]byte, 1000), // Large byte array\n  }\n\n  buf := forygo.NewByteBuffer(nil)\n  var bufferObjects []forygo.BufferObject\n\n  // Collect buffer objects during serialization\n  if err := serializer.SerializeWithCallback(buf, list, func(o forygo.BufferObject) bool {\n    bufferObjects = append(bufferObjects, o)\n    return false\n  }); err != nil {\n    panic(err)\n  }\n\n  // Convert to buffers for transport\n  var buffers []*forygo.ByteBuffer\n  for _, o := range bufferObjects {\n    buffers = append(buffers, o.ToBuffer())\n  }\n\n  // Deserialize with buffers\n  var newList []any\n  if err := serializer.DeserializeWithCallbackBuffers(buf, &newList, buffers); err != nil {\n    panic(err)\n  }\n  fmt.Println(newList)\n}\n'})}),"\n",(0,i.jsx)(r.h2,{id:"javascript",children:"JavaScript"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-javascript",children:"// Zero-copy support coming soon\n"})}),"\n",(0,i.jsx)(r.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,i.jsx)(r.h3,{id:"high-performance-data-transfer",children:"High-Performance Data Transfer"}),"\n",(0,i.jsx)(r.p,{children:"When sending large datasets over the network:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-java",children:"// Sender\nCollection<BufferObject> buffers = new ArrayList<>();\nbyte[] metadata = fory.serialize(dataObject, e -> !buffers.add(e));\n\n// Send metadata and buffers separately\nnetwork.sendMetadata(metadata);\nfor (BufferObject buf : buffers) {\n    network.sendBuffer(buf.toBuffer());\n}\n\n// Receiver\nbyte[] metadata = network.receiveMetadata();\nList<MemoryBuffer> buffers = network.receiveBuffers();\nObject data = fory.deserialize(metadata, buffers);\n"})}),"\n",(0,i.jsx)(r.h3,{id:"memory-mapped-files",children:"Memory-Mapped Files"}),"\n",(0,i.jsx)(r.p,{children:"Zero-copy works well with memory-mapped files:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-java",children:'// Write\nCollection<BufferObject> buffers = new ArrayList<>();\nbyte[] data = fory.serialize(largeObject, e -> !buffers.add(e));\nwriteToFile("data.bin", data);\nfor (int i = 0; i < buffers.size(); i++) {\n    writeToFile("buffer" + i + ".bin", buffers.get(i).toBuffer());\n}\n\n// Read\nbyte[] data = readFromFile("data.bin");\nList<MemoryBuffer> buffers = readBufferFiles();\nObject result = fory.deserialize(data, buffers);\n'})}),"\n",(0,i.jsx)(r.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Threshold"}),": Small arrays may not benefit from zero-copy due to callback overhead"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Network"}),": Zero-copy is most beneficial when buffers can be sent without copying"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Memory"}),": Reduces peak memory usage by avoiding buffer copies"]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"see-also",children:"See Also"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.a,{href:"/docs/next/guide/xlang/serialization",children:"Serialization"})," - Standard serialization examples"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.a,{href:"/docs/next/guide/python/out_of_band",children:"Python Out-of-Band Guide"})," - Python-specific zero-copy details"]}),"\n"]})]})}function f(e={}){const{wrapper:r}={...(0,a.a)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},11151:(e,r,n)=>{n.d(r,{Z:()=>s,a:()=>o});var i=n(67294);const a={},t=i.createContext(a);function o(e){const r=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function s(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),i.createElement(t.Provider,{value:r},e.children)}}}]);