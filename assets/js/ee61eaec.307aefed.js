"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[89416],{99382:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>l,toc:()=>o});var i=s(85893),r=s(11151);const t={title:"Cross-Language Serialization",sidebar_position:10,id:"cross_language",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},d=void 0,l={id:"guide/cpp/cross_language",title:"Cross-Language Serialization",description:"This page explains how to use Fory for cross-language serialization between C++ and other languages.",source:"@site/docs/guide/cpp/cross-language.md",sourceDirName:"guide/cpp",slug:"/guide/cpp/cross_language",permalink:"/docs/next/guide/cpp/cross_language",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/docs/guide/cpp/cross-language.md",tags:[],version:"current",sidebarPosition:10,frontMatter:{title:"Cross-Language Serialization",sidebar_position:10,id:"cross_language",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"Supported Types",permalink:"/docs/next/guide/cpp/supported_types"},next:{title:"Row Format",permalink:"/docs/next/guide/cpp/row_format"}},c={},o=[{value:"Overview",id:"overview",level:2},{value:"Enabling Cross-Language Mode",id:"enabling-cross-language-mode",level:2},{value:"Cross-Language Example",id:"cross-language-example",level:2},{value:"C++ Producer",id:"c-producer",level:3},{value:"Java Consumer",id:"java-consumer",level:3},{value:"Python Consumer",id:"python-consumer",level:3},{value:"Type Mapping",id:"type-mapping",level:2},{value:"Primitive Types",id:"primitive-types",level:3},{value:"String Types",id:"string-types",level:3},{value:"Collection Types",id:"collection-types",level:3},{value:"Temporal Types",id:"temporal-types",level:3},{value:"Field Order Requirements",id:"field-order-requirements",level:2},{value:"C++",id:"c",level:3},{value:"Java",id:"java",level:3},{value:"Python",id:"python",level:3},{value:"Type ID Consistency",id:"type-id-consistency",level:2},{value:"Compatible Mode",id:"compatible-mode",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Type Mismatch Errors",id:"type-mismatch-errors",level:3},{value:"Encoding Errors",id:"encoding-errors",level:3},{value:"Related Topics",id:"related-topics",level:2}];function a(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"This page explains how to use Fory for cross-language serialization between C++ and other languages."}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"Apache Fory\u2122 enables seamless data exchange between C++, Java, Python, Go, Rust, and JavaScript. The xlang (cross-language) mode ensures binary compatibility across all supported languages."}),"\n",(0,i.jsx)(n.h2,{id:"enabling-cross-language-mode",children:"Enabling Cross-Language Mode"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:'#include "fory/serialization/fory.h"\n\nusing namespace fory::serialization;\n\nauto fory = Fory::builder()\n    .xlang(true)  // Enable cross-language mode\n    .build();\n'})}),"\n",(0,i.jsx)(n.h2,{id:"cross-language-example",children:"Cross-Language Example"}),"\n",(0,i.jsx)(n.h3,{id:"c-producer",children:"C++ Producer"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"#include \"fory/serialization/fory.h\"\n#include <fstream>\n\nusing namespace fory::serialization;\n\nstruct Message {\n  std::string topic;\n  int64_t timestamp;\n  std::map<std::string, std::string> headers;\n  std::vector<uint8_t> payload;\n\n  bool operator==(const Message &other) const {\n    return topic == other.topic && timestamp == other.timestamp &&\n           headers == other.headers && payload == other.payload;\n  }\n};\nFORY_STRUCT(Message, topic, timestamp, headers, payload);\n\nint main() {\n  auto fory = Fory::builder().xlang(true).build();\n  fory.register_struct<Message>(100);\n\n  Message msg{\n      \"events.user\",\n      1699999999000,\n      {{\"content-type\", \"application/json\"}},\n      {'h', 'e', 'l', 'l', 'o'}\n  };\n\n  auto result = fory.serialize(msg);\n  if (result.ok()) {\n    auto bytes = std::move(result).value();\n    // write to file, send over network, etc.\n    std::ofstream file(\"message.bin\", std::ios::binary);\n    file.write(reinterpret_cast<const char*>(bytes.data()), bytes.size());\n  }\n  return 0;\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"java-consumer",children:"Java Consumer"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'import org.apache.fory.Fory;\nimport org.apache.fory.config.Language;\n\npublic class Message {\n    public String topic;\n    public long timestamp;\n    public Map<String, String> headers;\n    public byte[] payload;\n}\n\npublic class Consumer {\n    public static void main(String[] args) throws Exception {\n        Fory fory = Fory.builder()\n            .withLanguage(Language.XLANG)\n            .build();\n        fory.register(Message.class, 100);  // Same ID as C++\n\n        byte[] bytes = Files.readAllBytes(Path.of("message.bin"));\n        Message msg = (Message) fory.deserialize(bytes);\n\n        System.out.println("Topic: " + msg.topic);\n        System.out.println("Timestamp: " + msg.timestamp);\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"python-consumer",children:"Python Consumer"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import pyfory\n\nclass Message:\n    topic: str\n    timestamp: int\n    headers: dict[str, str]\n    payload: bytes\n\nfory = pyfory.Fory(xlang=True)\nfory.register(Message, type_id=100)  # Same ID as C++\n\nwith open("message.bin", "rb") as f:\n    data = f.read()\n\nmsg = fory.deserialize(data)\nprint(f"Topic: {msg.topic}")\nprint(f"Timestamp: {msg.timestamp}")\n'})}),"\n",(0,i.jsx)(n.h2,{id:"type-mapping",children:"Type Mapping"}),"\n",(0,i.jsx)(n.h3,{id:"primitive-types",children:"Primitive Types"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"C++ Type"}),(0,i.jsx)(n.th,{children:"Java Type"}),(0,i.jsx)(n.th,{children:"Python Type"}),(0,i.jsx)(n.th,{children:"Go Type"}),(0,i.jsx)(n.th,{children:"Rust Type"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"bool"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"boolean"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"bool"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"bool"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"bool"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"int8_t"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"byte"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"int"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"int8"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"i8"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"int16_t"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"short"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"int"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"int16"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"i16"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"int32_t"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"int"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"int"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"int32"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"i32"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"int64_t"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"long"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"int"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"int64"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"i64"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"float"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"float"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"float"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"float32"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"f32"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"double"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"double"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"float"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"float64"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"f64"})})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"string-types",children:"String Types"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"C++ Type"}),(0,i.jsx)(n.th,{children:"Java Type"}),(0,i.jsx)(n.th,{children:"Python Type"}),(0,i.jsx)(n.th,{children:"Go Type"}),(0,i.jsx)(n.th,{children:"Rust Type"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"std::string"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"String"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"str"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"string"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"String"})})]})})]}),"\n",(0,i.jsx)(n.h3,{id:"collection-types",children:"Collection Types"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"C++ Type"}),(0,i.jsx)(n.th,{children:"Java Type"}),(0,i.jsx)(n.th,{children:"Python Type"}),(0,i.jsx)(n.th,{children:"Go Type"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"std::vector<T>"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"List<T>"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"list"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"[]T"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"std::set<T>"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Set<T>"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"set"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"map[T]struct{}"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"std::map<K,V>"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Map<K,V>"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"dict"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"map[K]V"})})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"temporal-types",children:"Temporal Types"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"C++ Type"}),(0,i.jsx)(n.th,{children:"Java Type"}),(0,i.jsx)(n.th,{children:"Python Type"}),(0,i.jsx)(n.th,{children:"Go Type"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Timestamp"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Instant"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"datetime"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"time.Time"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Duration"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Duration"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"timedelta"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"time.Duration"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Date"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"LocalDate"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"datetime.date"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"time.Time"})})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"field-order-requirements",children:"Field Order Requirements"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Critical:"})," Fields are sorted by snake_case field name. The converted names must match across languages."]}),"\n",(0,i.jsx)(n.h3,{id:"c",children:"C++"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"struct Person {\n  std::string name;   // Field 0\n  int32_t age;        // Field 1\n  std::string email;  // Field 2\n};\nFORY_STRUCT(Person, name, age, email);  // Order matters!\n"})}),"\n",(0,i.jsx)(n.h3,{id:"java",children:"Java"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"public class Person {\n    public String name;   // Field 0\n    public int age;       // Field 1\n    public String email;  // Field 2\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"python",children:"Python"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"class Person:\n    name: str    # Field 0\n    age: int     # Field 1\n    email: str   # Field 2\n"})}),"\n",(0,i.jsx)(n.h2,{id:"type-id-consistency",children:"Type ID Consistency"}),"\n",(0,i.jsx)(n.p,{children:"All languages must use the same type IDs:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// C++\nfory.register_struct<Person>(100);\nfory.register_struct<Address>(101);\nfory.register_struct<Order>(102);\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"// Java\nfory.register(Person.class, 100);\nfory.register(Address.class, 101);\nfory.register(Order.class, 102);\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Python\nfory.register(Person, type_id=100)\nfory.register(Address, type_id=101)\nfory.register(Order, type_id=102)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"compatible-mode",children:"Compatible Mode"}),"\n",(0,i.jsx)(n.p,{children:"For schema evolution across language boundaries:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// C++ with compatible mode\nauto fory = Fory::builder()\n    .xlang(true)\n    .compatible(true)  // Enable schema evolution\n    .build();\n"})}),"\n",(0,i.jsx)(n.p,{children:"Compatible mode allows:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Adding new fields (with defaults)"}),"\n",(0,i.jsx)(n.li,{children:"Removing unused fields"}),"\n",(0,i.jsx)(n.li,{children:"Reordering fields"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.h3,{id:"type-mismatch-errors",children:"Type Mismatch Errors"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Error: Type mismatch: expected 100, got 101\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution:"})," Ensure type IDs match across all languages."]}),"\n",(0,i.jsx)(n.h3,{id:"encoding-errors",children:"Encoding Errors"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Error: Invalid UTF-8 sequence\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution:"})," Ensure strings are valid UTF-8 in all languages."]}),"\n",(0,i.jsx)(n.h2,{id:"related-topics",children:"Related Topics"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/next/guide/cpp/configuration",children:"Configuration"})," - Builder options"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/next/guide/cpp/type_registration",children:"Type Registration"})," - Registering types"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/next/guide/cpp/supported_types",children:"Supported Types"})," - Type compatibility"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},11151:(e,n,s)=>{s.d(n,{Z:()=>l,a:()=>d});var i=s(67294);const r={},t=i.createContext(r);function d(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);