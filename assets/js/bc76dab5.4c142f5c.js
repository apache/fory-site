"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[2606],{53344:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>d});var a=n(85893),r=n(11151);const s={title:"Java Serialization Guide",sidebar_position:0,id:"serialization_index",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},t=void 0,o={id:"guide/java/serialization_index",title:"Java Serialization Guide",description:"Apache Fory\u2122 provides blazingly fast Java object serialization with JIT compilation and zero-copy techniques. When only Java object serialization is needed, this mode delivers better performance compared to cross-language object graph serialization.",source:"@site/versioned_docs/version-0.14/guide/java/index.md",sourceDirName:"guide/java",slug:"/guide/java/",permalink:"/docs/0.14/guide/java/",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/docs/guide/java/index.md",tags:[],version:"0.14",sidebarPosition:0,frontMatter:{title:"Java Serialization Guide",sidebar_position:0,id:"serialization_index",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"Usage",permalink:"/docs/0.14/start/usage"},next:{title:"Configuration Options",permalink:"/docs/0.14/guide/java/configuration"}},l={},d=[{value:"Features",id:"features",level:2},{value:"High Performance",id:"high-performance",level:3},{value:"Drop-in Replacement",id:"drop-in-replacement",level:3},{value:"Advanced Features",id:"advanced-features",level:3},{value:"Quick Start",id:"quick-start",level:2},{value:"Single-Thread Usage",id:"single-thread-usage",level:3},{value:"Multi-Thread Usage",id:"multi-thread-usage",level:3},{value:"Fory Instance Reuse Pattern",id:"fory-instance-reuse-pattern",level:3},{value:"Thread Safety",id:"thread-safety",level:2},{value:"ThreadLocalFory",id:"threadlocalfory",level:3},{value:"ThreadSafeForyPool",id:"threadsafeforypool",level:3},{value:"Builder Methods",id:"builder-methods",level:3},{value:"Next Steps",id:"next-steps",level:2}];function c(e){const i={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.p,{children:"Apache Fory\u2122 provides blazingly fast Java object serialization with JIT compilation and zero-copy techniques. When only Java object serialization is needed, this mode delivers better performance compared to cross-language object graph serialization."}),"\n",(0,a.jsx)(i.h2,{id:"features",children:"Features"}),"\n",(0,a.jsx)(i.h3,{id:"high-performance",children:"High Performance"}),"\n",(0,a.jsxs)(i.ul,{children:["\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.strong,{children:"JIT Code Generation"}),": Highly-extensible JIT framework generates serializer code at runtime using async multi-threaded compilation, delivering 20-170x speedup through:","\n",(0,a.jsxs)(i.ul,{children:["\n",(0,a.jsx)(i.li,{children:"Inlining variables to reduce memory access"}),"\n",(0,a.jsx)(i.li,{children:"Inlining method calls to eliminate virtual dispatch overhead"}),"\n",(0,a.jsx)(i.li,{children:"Minimizing conditional branching"}),"\n",(0,a.jsx)(i.li,{children:"Eliminating hash lookups"}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.strong,{children:"Zero-Copy"}),": Direct memory access without intermediate buffer copies; row format supports random access and partial serialization"]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.strong,{children:"Variable-Length Encoding"}),": Optimized compression for integers, longs"]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.strong,{children:"Meta Sharing"}),": Cached class metadata reduces redundant type information"]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.strong,{children:"SIMD Acceleration"}),": Java Vector API support for array operations (Java 16+)"]}),"\n"]}),"\n",(0,a.jsx)(i.h3,{id:"drop-in-replacement",children:"Drop-in Replacement"}),"\n",(0,a.jsxs)(i.ul,{children:["\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.strong,{children:"100% JDK Serialization Compatible"}),": Supports ",(0,a.jsx)(i.code,{children:"writeObject"}),"/",(0,a.jsx)(i.code,{children:"readObject"}),"/",(0,a.jsx)(i.code,{children:"writeReplace"}),"/",(0,a.jsx)(i.code,{children:"readResolve"}),"/",(0,a.jsx)(i.code,{children:"readObjectNoData"}),"/",(0,a.jsx)(i.code,{children:"Externalizable"})]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.strong,{children:"Java 8-24 Support"}),": Works across all modern Java versions including Java 17+ records"]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.strong,{children:"GraalVM Native Image"}),": AOT compilation support without reflection configuration"]}),"\n"]}),"\n",(0,a.jsx)(i.h3,{id:"advanced-features",children:"Advanced Features"}),"\n",(0,a.jsxs)(i.ul,{children:["\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.strong,{children:"Reference Tracking"}),": Automatic handling of shared and circular references"]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.strong,{children:"Schema Evolution"}),": Forward/backward compatibility for class schema changes"]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.strong,{children:"Polymorphism"}),": Full support for inheritance hierarchies and interfaces"]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.strong,{children:"Deep Copy"}),": Efficient deep cloning of complex object graphs with reference preservation"]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.strong,{children:"Security"}),": Class registration and configurable deserialization policies"]}),"\n"]}),"\n",(0,a.jsx)(i.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,a.jsxs)(i.p,{children:["Note that Fory creation is not cheap, the ",(0,a.jsx)(i.strong,{children:"Fory instances should be reused between serializations"})," instead of creating it every time. You should keep Fory as a static global variable, or instance variable of some singleton object or limited objects."]}),"\n",(0,a.jsx)(i.h3,{id:"single-thread-usage",children:"Single-Thread Usage"}),"\n",(0,a.jsx)(i.pre,{children:(0,a.jsx)(i.code,{className:"language-java",children:"import java.util.List;\nimport java.util.Arrays;\n\nimport org.apache.fory.*;\nimport org.apache.fory.config.*;\n\npublic class Example {\n  public static void main(String[] args) {\n    SomeClass object = new SomeClass();\n    // Note that Fory instances should be reused between\n    // multiple serializations of different objects.\n    Fory fory = Fory.builder().withLanguage(Language.JAVA)\n      .requireClassRegistration(true)\n      .build();\n    // Registering types can reduce class name serialization overhead, but not mandatory.\n    // If class registration enabled, all custom types must be registered.\n    // Registration order must be consistent if id is not specified\n    fory.register(SomeClass.class);\n    byte[] bytes = fory.serialize(object);\n    System.out.println(fory.deserialize(bytes));\n  }\n}\n"})}),"\n",(0,a.jsx)(i.h3,{id:"multi-thread-usage",children:"Multi-Thread Usage"}),"\n",(0,a.jsx)(i.pre,{children:(0,a.jsx)(i.code,{className:"language-java",children:"import java.util.List;\nimport java.util.Arrays;\n\nimport org.apache.fory.*;\nimport org.apache.fory.config.*;\n\npublic class Example {\n  public static void main(String[] args) {\n    SomeClass object = new SomeClass();\n    // Note that Fory instances should be reused between\n    // multiple serializations of different objects.\n    ThreadSafeFory fory = new ThreadLocalFory(classLoader -> {\n      Fory f = Fory.builder().withLanguage(Language.JAVA)\n        .withClassLoader(classLoader).build();\n      f.register(SomeClass.class, 1);\n      return f;\n    });\n    byte[] bytes = fory.serialize(object);\n    System.out.println(fory.deserialize(bytes));\n  }\n}\n"})}),"\n",(0,a.jsx)(i.h3,{id:"fory-instance-reuse-pattern",children:"Fory Instance Reuse Pattern"}),"\n",(0,a.jsx)(i.pre,{children:(0,a.jsx)(i.code,{className:"language-java",children:"import java.util.List;\nimport java.util.Arrays;\n\nimport org.apache.fory.*;\nimport org.apache.fory.config.*;\n\npublic class Example {\n  // reuse fory.\n  private static final ThreadSafeFory fory = new ThreadLocalFory(classLoader -> {\n    Fory f = Fory.builder().withLanguage(Language.JAVA)\n      .withClassLoader(classLoader).build();\n    f.register(SomeClass.class, 1);\n    return f;\n  });\n\n  public static void main(String[] args) {\n    SomeClass object = new SomeClass();\n    byte[] bytes = fory.serialize(object);\n    System.out.println(fory.deserialize(bytes));\n  }\n}\n"})}),"\n",(0,a.jsx)(i.h2,{id:"thread-safety",children:"Thread Safety"}),"\n",(0,a.jsx)(i.p,{children:"Fory provides multiple options for thread-safe serialization:"}),"\n",(0,a.jsx)(i.h3,{id:"threadlocalfory",children:"ThreadLocalFory"}),"\n",(0,a.jsx)(i.p,{children:"Uses thread-local storage to maintain separate Fory instances per thread:"}),"\n",(0,a.jsx)(i.pre,{children:(0,a.jsx)(i.code,{className:"language-java",children:"ThreadSafeFory fory = new ThreadLocalFory(classLoader -> {\n  Fory f = Fory.builder().withLanguage(Language.JAVA)\n    .withClassLoader(classLoader).build();\n  f.register(SomeClass.class, 1);\n  return f;\n});\nbyte[] bytes = fory.serialize(object);\nSystem.out.println(fory.deserialize(bytes));\n"})}),"\n",(0,a.jsx)(i.h3,{id:"threadsafeforypool",children:"ThreadSafeForyPool"}),"\n",(0,a.jsxs)(i.p,{children:["For virtual threads or environments where thread-local storage is not appropriate, use ",(0,a.jsx)(i.code,{children:"buildThreadSafeForyPool"}),":"]}),"\n",(0,a.jsx)(i.pre,{children:(0,a.jsx)(i.code,{className:"language-java",children:"ThreadSafeFory fory = Fory.builder()\n  .withLanguage(Language.JAVA)\n  .withRefTracking(false)\n  .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT)\n  .withAsyncCompilation(true)\n  .buildThreadSafeForyPool(minPoolSize, maxPoolSize);\n"})}),"\n",(0,a.jsxs)(i.p,{children:["Note that calling ",(0,a.jsx)(i.code,{children:"buildThreadSafeFory()"})," on ",(0,a.jsx)(i.code,{children:"ForyBuilder"})," will create an instance of ",(0,a.jsx)(i.code,{children:"ThreadLocalFory"}),". This may not be appropriate in environments where virtual threads are used, as each thread will create its own Fory instance, a relatively expensive operation. An alternative for virtual threads is to use ",(0,a.jsx)(i.code,{children:"buildThreadSafeForyPool"}),"."]}),"\n",(0,a.jsx)(i.h3,{id:"builder-methods",children:"Builder Methods"}),"\n",(0,a.jsx)(i.pre,{children:(0,a.jsx)(i.code,{className:"language-java",children:"// Single-thread Fory\nFory fory = Fory.builder()\n  .withLanguage(Language.JAVA)\n  .withRefTracking(false)\n  .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT)\n  .withAsyncCompilation(true)\n  .build();\n\n// Thread-safe Fory (ThreadLocalFory)\nThreadSafeFory fory = Fory.builder()\n  .withLanguage(Language.JAVA)\n  .withRefTracking(false)\n  .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT)\n  .withAsyncCompilation(true)\n  .buildThreadSafeFory();\n"})}),"\n",(0,a.jsx)(i.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,a.jsxs)(i.ul,{children:["\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.a,{href:"/docs/0.14/guide/java/configuration",children:"Configuration Options"})," - Learn about ForyBuilder options"]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.a,{href:"/docs/0.14/guide/java/basic_serialization",children:"Basic Serialization"})," - Detailed serialization patterns"]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.a,{href:"/docs/0.14/guide/java/type_registration",children:"Type Registration"})," - Class registration and security"]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.a,{href:"/docs/0.14/guide/java/custom_serializers",children:"Custom Serializers"})," - Implement custom serializers"]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.a,{href:"/docs/0.14/guide/java/cross_language",children:"Cross-Language Serialization"})," - Serialize data for other languages"]}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,r.a)(),...e.components};return i?(0,a.jsx)(i,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},11151:(e,i,n)=>{n.d(i,{Z:()=>o,a:()=>t});var a=n(67294);const r={},s=a.createContext(r);function t(e){const i=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function o(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),a.createElement(s.Provider,{value:i},e.children)}}}]);