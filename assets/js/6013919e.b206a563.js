"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[46248],{36986:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>t,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>c});var l=i(85893),r=i(11151);const s={title:"Field Nullability",sidebar_position:40,id:"field_nullability",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},t=void 0,a={id:"guide/xlang/field_nullability",title:"Field Nullability",description:"This page explains how Fory handles field nullability in cross-language (xlang) serialization mode.",source:"@site/docs/guide/xlang/field-nullability.md",sourceDirName:"guide/xlang",slug:"/guide/xlang/field_nullability",permalink:"/docs/next/guide/xlang/field_nullability",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/docs/guide/xlang/field-nullability.md",tags:[],version:"current",sidebarPosition:40,frontMatter:{title:"Field Nullability",sidebar_position:40,id:"field_nullability",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"Serialization",permalink:"/docs/next/guide/xlang/serialization"},next:{title:"Reference Tracking",permalink:"/docs/next/guide/xlang/reference_tracking"}},d={},c=[{value:"Default Behavior",id:"default-behavior",level:2},{value:"Wire Format",id:"wire-format",level:2},{value:"Nullable vs Reference Tracking",id:"nullable-vs-reference-tracking",level:2},{value:"Language-Specific Examples",id:"language-specific-examples",level:2},{value:"Java",id:"java",level:3},{value:"Python",id:"python",level:3},{value:"Rust",id:"rust",level:3},{value:"Go",id:"go",level:3},{value:"C++",id:"c",level:3},{value:"Customizing Nullability",id:"customizing-nullability",level:2},{value:"Java: @ForyField Annotation",id:"java-foryfield-annotation",level:3},{value:"C++: fory::field Wrapper",id:"c-foryfield-wrapper",level:3},{value:"Null Value Handling",id:"null-value-handling",level:2},{value:"Schema Compatibility",id:"schema-compatibility",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"See Also",id:"see-also",level:2}];function o(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.p,{children:"This page explains how Fory handles field nullability in cross-language (xlang) serialization mode."}),"\n",(0,l.jsx)(n.h2,{id:"default-behavior",children:"Default Behavior"}),"\n",(0,l.jsxs)(n.p,{children:["In xlang mode, ",(0,l.jsx)(n.strong,{children:"fields are non-nullable by default"}),". This means:"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Values must always be present (non-null)"}),"\n",(0,l.jsx)(n.li,{children:"No null flag byte is written for the field"}),"\n",(0,l.jsx)(n.li,{children:"Serialization is more compact"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"The following types are nullable by default:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Optional<T>"})," (Java, C++)"]}),"\n",(0,l.jsxs)(n.li,{children:["Java boxed types (",(0,l.jsx)(n.code,{children:"Integer"}),", ",(0,l.jsx)(n.code,{children:"Long"}),", ",(0,l.jsx)(n.code,{children:"Double"}),", etc.)"]}),"\n",(0,l.jsxs)(n.li,{children:["Go pointer types (",(0,l.jsx)(n.code,{children:"*int32"}),", ",(0,l.jsx)(n.code,{children:"*string"}),", etc.)"]}),"\n",(0,l.jsxs)(n.li,{children:["Rust ",(0,l.jsx)(n.code,{children:"Option<T>"})]}),"\n",(0,l.jsxs)(n.li,{children:["Python ",(0,l.jsx)(n.code,{children:"Optional[T]"})]}),"\n"]}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Field Type"}),(0,l.jsx)(n.th,{children:"Default Nullable"}),(0,l.jsx)(n.th,{children:"Null Flag Written"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsxs)(n.td,{children:["Primitives (",(0,l.jsx)(n.code,{children:"int"}),", ",(0,l.jsx)(n.code,{children:"bool"}),", ",(0,l.jsx)(n.code,{children:"float"}),", etc.)"]}),(0,l.jsx)(n.td,{children:"No"}),(0,l.jsx)(n.td,{children:"No"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"String"})}),(0,l.jsx)(n.td,{children:"No"}),(0,l.jsx)(n.td,{children:"No"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"List<T>"}),", ",(0,l.jsx)(n.code,{children:"Map<K,V>"}),", ",(0,l.jsx)(n.code,{children:"Set<T>"})]}),(0,l.jsx)(n.td,{children:"No"}),(0,l.jsx)(n.td,{children:"No"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Custom structs"}),(0,l.jsx)(n.td,{children:"No"}),(0,l.jsx)(n.td,{children:"No"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Enums"}),(0,l.jsx)(n.td,{children:"No"}),(0,l.jsx)(n.td,{children:"No"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsxs)(n.td,{children:["Java boxed types (",(0,l.jsx)(n.code,{children:"Integer"}),", ",(0,l.jsx)(n.code,{children:"Long"}),", etc.)"]}),(0,l.jsx)(n.td,{children:"Yes"}),(0,l.jsx)(n.td,{children:"Yes"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsxs)(n.td,{children:["Go pointer types (",(0,l.jsx)(n.code,{children:"*int32"}),", ",(0,l.jsx)(n.code,{children:"*string"}),")"]}),(0,l.jsx)(n.td,{children:"Yes"}),(0,l.jsx)(n.td,{children:"Yes"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"Optional<T>"})," / ",(0,l.jsx)(n.code,{children:"Option<T>"})]}),(0,l.jsx)(n.td,{children:"Yes"}),(0,l.jsx)(n.td,{children:"Yes"})]})]})]}),"\n",(0,l.jsx)(n.h2,{id:"wire-format",children:"Wire Format"}),"\n",(0,l.jsxs)(n.p,{children:["The nullable flag controls whether a ",(0,l.jsx)(n.strong,{children:"null flag byte"})," is written before the field value:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"Non-nullable field: [value data]\nNullable field:     [null_flag] [value data if not null]\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Where ",(0,l.jsx)(n.code,{children:"null_flag"})," is:"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"-1"})," (NULL_FLAG): Value is null"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"-2"})," (NOT_NULL_VALUE_FLAG): Value is present"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"nullable-vs-reference-tracking",children:"Nullable vs Reference Tracking"}),"\n",(0,l.jsx)(n.p,{children:"These are related but distinct concepts:"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Concept"}),(0,l.jsx)(n.th,{children:"Purpose"}),(0,l.jsx)(n.th,{children:"Flag Values"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"Nullable"})}),(0,l.jsx)(n.td,{children:"Allow null values for a field"}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"-1"})," (null), ",(0,l.jsx)(n.code,{children:"-2"})," (not null)"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"Reference Tracking"})}),(0,l.jsx)(n.td,{children:"Deduplicate shared object references"}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"-1"})," (null), ",(0,l.jsx)(n.code,{children:"-2"})," (not null), ",(0,l.jsx)(n.code,{children:"\u22650"})," (ref ID)"]})]})]})]}),"\n",(0,l.jsx)(n.p,{children:"Key differences:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Nullable only"}),": Writes ",(0,l.jsx)(n.code,{children:"-1"})," or ",(0,l.jsx)(n.code,{children:"-2"})," flag, no reference deduplication"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Reference tracking"}),": Extends nullable semantics with reference IDs (",(0,l.jsx)(n.code,{children:"\u22650"}),") for previously seen objects"]}),"\n",(0,l.jsx)(n.li,{children:"Both use the same flag byte position\u2014ref tracking is a superset of nullable"}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["When ",(0,l.jsx)(n.code,{children:"refTracking=true"}),", the null flag byte doubles as a ref flag:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"ref_flag = -1  \u2192 null value\nref_flag = -2  \u2192 new object (first occurrence)\nref_flag >= 0  \u2192 reference to object at index ref_flag\n"})}),"\n",(0,l.jsxs)(n.p,{children:["For detailed reference tracking behavior, see ",(0,l.jsx)(n.a,{href:"/docs/next/guide/xlang/reference_tracking",children:"Reference Tracking"}),"."]}),"\n",(0,l.jsx)(n.h2,{id:"language-specific-examples",children:"Language-Specific Examples"}),"\n",(0,l.jsx)(n.h3,{id:"java",children:"Java"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'public class Person {\n    // Non-nullable by default in xlang mode\n    String name;           // Must not be null\n    int age;              // Primitive, always non-nullable\n    List<String> tags;    // Must not be null\n\n    // Explicitly nullable\n    @ForyField(nullable = true)\n    String nickname;      // Can be null\n\n    // Optional wrapper - nullable by default\n    Optional<String> bio; // Can be empty/null\n}\n\nFory fory = Fory.builder()\n    .withLanguage(Language.XLANG)\n    .build();\nfory.register(Person.class, "example.Person");\n'})}),"\n",(0,l.jsx)(n.h3,{id:"python",children:"Python"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'from dataclasses import dataclass\nfrom typing import Optional, List\nimport pyfory\n\n@dataclass\nclass Person:\n    # Non-nullable by default\n    name: str              # Must have a value\n    age: pyfory.int32      # Primitive\n    tags: List[str]        # Must not be None\n\n    # Optional makes it nullable\n    nickname: Optional[str] = None  # Can be None\n    bio: Optional[str] = None       # Can be None\n\nfory = pyfory.Fory(xlang=True)\nfory.register_type(Person, typename="example.Person")\n'})}),"\n",(0,l.jsx)(n.h3,{id:"rust",children:"Rust"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-rust",children:"use fory::{Fory, ForyObject};\n\n#[derive(ForyObject)]\nstruct Person {\n    // Non-nullable by default\n    name: String,\n    age: i32,\n    tags: Vec<String>,\n\n    // Option<T> is nullable\n    nickname: Option<String>,  // Can be None\n    bio: Option<String>,       // Can be None\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"go",children:"Go"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-go",children:'type Person struct {\n    // Non-nullable by default\n    Name string\n    Age  int32\n    Tags []string\n\n    // Pointer types for nullable fields\n    Nickname *string  // Can be nil\n    Bio      *string  // Can be nil\n}\n\nfory := forygo.NewFory(forygo.WithXlang(true))\nfory.RegisterNamedStruct(Person{}, "example.Person")\n'})}),"\n",(0,l.jsx)(n.h3,{id:"c",children:"C++"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cpp",children:"struct Person {\n    // Non-nullable by default\n    std::string name;\n    int32_t age;\n    std::vector<std::string> tags;\n\n    // std::optional for nullable\n    std::optional<std::string> nickname;\n    std::optional<std::string> bio;\n};\nFORY_STRUCT(Person, name, age, tags, nickname, bio);\n"})}),"\n",(0,l.jsx)(n.h2,{id:"customizing-nullability",children:"Customizing Nullability"}),"\n",(0,l.jsx)(n.h3,{id:"java-foryfield-annotation",children:"Java: @ForyField Annotation"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:"public class Config {\n    @ForyField(nullable = true)\n    String optionalSetting;  // Explicitly nullable\n\n    @ForyField(nullable = false)\n    String requiredSetting;  // Explicitly non-nullable (default)\n}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"c-foryfield-wrapper",children:"C++: fory::field Wrapper"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cpp",children:"struct Config {\n    // Explicitly mark as nullable\n    fory::field<std::string, 1, fory::nullable<true>> optional_setting;\n\n    // Explicitly mark as non-nullable (default)\n    fory::field<std::string, 2, fory::nullable<false>> required_setting;\n};\nFORY_STRUCT(Config, optional_setting, required_setting);\n"})}),"\n",(0,l.jsx)(n.h2,{id:"null-value-handling",children:"Null Value Handling"}),"\n",(0,l.jsx)(n.p,{children:"When a non-nullable field receives a null value:"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Language"}),(0,l.jsx)(n.th,{children:"Behavior"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Java"}),(0,l.jsxs)(n.td,{children:["Throws ",(0,l.jsx)(n.code,{children:"NullPointerException"})," or serialization error"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Python"}),(0,l.jsxs)(n.td,{children:["Raises ",(0,l.jsx)(n.code,{children:"TypeError"})," or serialization error"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Rust"}),(0,l.jsx)(n.td,{children:"Compile-time error (non-Option types can't be None)"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Go"}),(0,l.jsx)(n.td,{children:"Zero value is used (empty string, 0, etc.)"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"C++"}),(0,l.jsx)(n.td,{children:"Default-constructed value or undefined behavior"})]})]})]}),"\n",(0,l.jsx)(n.h2,{id:"schema-compatibility",children:"Schema Compatibility"}),"\n",(0,l.jsxs)(n.p,{children:["The nullable flag is part of the struct schema fingerprint. Changing a field's nullability is a ",(0,l.jsx)(n.strong,{children:"breaking change"})," that will cause schema version mismatch errors."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"Schema A: { name: String (non-nullable) }\nSchema B: { name: String (nullable) }\n// These have different fingerprints and are incompatible\n"})}),"\n",(0,l.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Use non-nullable by default"}),": Only make fields nullable when null is a valid semantic value"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Use Optional/Option wrappers"}),": Instead of raw types with nullable annotation"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Be consistent across languages"}),": Use the same nullability for corresponding fields"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Document nullable fields"}),": Make it clear which fields can be null in your API"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/docs/next/guide/xlang/reference_tracking",children:"Reference Tracking"})," - Shared and circular reference handling"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/docs/next/guide/xlang/serialization",children:"Serialization"})," - Basic cross-language serialization"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/docs/next/specification/xlang_type_mapping",children:"Type Mapping"})," - Cross-language type mapping reference"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.a,{href:"/docs/next/specification/xlang_serialization_spec",children:"Xlang Specification"})," - Binary protocol details"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}},11151:(e,n,i)=>{i.d(n,{Z:()=>a,a:()=>t});var l=i(67294);const r={},s=l.createContext(r);function t(e){const n=l.useContext(s);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),l.createElement(s.Provider,{value:n},e.children)}}}]);