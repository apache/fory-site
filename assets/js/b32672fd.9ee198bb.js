"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[82730],{18816:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>d,contentTitle:()=>t,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>l});var r=n(85893),o=n(11151);const a={title:"Migration Guide",sidebar_position:10,id:"migration",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},t=void 0,s={id:"guide/java/migration",title:"Migration Guide",description:"This page covers migration strategies from JDK serialization and upgrading between Fory versions.",source:"@site/versioned_docs/version-0.15/guide/java/migration.md",sourceDirName:"guide/java",slug:"/guide/java/migration",permalink:"/docs/guide/java/migration",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/docs/guide/java/migration.md",tags:[],version:"0.15",sidebarPosition:10,frontMatter:{title:"Migration Guide",sidebar_position:10,id:"migration",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"Row Format",permalink:"/docs/guide/java/row_format"},next:{title:"Troubleshooting",permalink:"/docs/guide/java/troubleshooting"}},d={},l=[{value:"JDK Serialization Migration",id:"jdk-serialization-migration",level:2},{value:"Upgrade Fory",id:"upgrade-fory",level:2},{value:"Minor Version Upgrades",id:"minor-version-upgrades",level:3},{value:"Major Version Upgrades",id:"major-version-upgrades",level:3},{value:"Versioning Serialized Data",id:"versioning-serialized-data",level:3},{value:"Serialization with Version Header",id:"serialization-with-version-header",level:4},{value:"Deserialization with Version Header",id:"deserialization-with-version-header",level:4},{value:"Shading Example",id:"shading-example",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Related Topics",id:"related-topics",level:2}];function c(e){const i={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.p,{children:"This page covers migration strategies from JDK serialization and upgrading between Fory versions."}),"\n",(0,r.jsx)(i.h2,{id:"jdk-serialization-migration",children:"JDK Serialization Migration"}),"\n",(0,r.jsxs)(i.p,{children:["If you use JDK serialization before and can't upgrade your client and server at the same time (which is common for online applications), Fory provides a utility method ",(0,r.jsx)(i.code,{children:"org.apache.fory.serializer.JavaSerializer.serializedByJDK"})," to check whether the binary was generated by JDK serialization."]}),"\n",(0,r.jsx)(i.p,{children:"You can use the following pattern to make existing serialization protocol-aware, then upgrade serialization to Fory in an async rolling-up way:"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-java",children:"if (JavaSerializer.serializedByJDK(bytes)) {\n  ObjectInputStream objectInputStream = xxx;\n  return objectInputStream.readObject();\n} else {\n  return fory.deserialize(bytes);\n}\n"})}),"\n",(0,r.jsx)(i.p,{children:"This allows you to:"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsx)(i.li,{children:"Deploy new code that can read both JDK and Fory serialized data"}),"\n",(0,r.jsx)(i.li,{children:"Gradually migrate serialization to Fory"}),"\n",(0,r.jsx)(i.li,{children:"Eventually remove JDK serialization support"}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"upgrade-fory",children:"Upgrade Fory"}),"\n",(0,r.jsx)(i.h3,{id:"minor-version-upgrades",children:"Minor Version Upgrades"}),"\n",(0,r.jsxs)(i.p,{children:["Currently, binary compatibility is ensured for minor versions only. For example, if you are using Fory ",(0,r.jsx)(i.code,{children:"v0.2.0"}),", binary compatibility will be provided if you upgrade to Fory ",(0,r.jsx)(i.code,{children:"v0.2.1"}),"."]}),"\n",(0,r.jsx)(i.p,{children:"If you upgrade by minor version, or you won't have data serialized by older Fory, you can upgrade Fory directly without any special handling."}),"\n",(0,r.jsx)(i.h3,{id:"major-version-upgrades",children:"Major Version Upgrades"}),"\n",(0,r.jsxs)(i.p,{children:["If you upgrade to Fory ",(0,r.jsx)(i.code,{children:"v0.4.1"})," from ",(0,r.jsx)(i.code,{children:"v0.2.x"}),", no binary compatibility is ensured."]}),"\n",(0,r.jsx)(i.p,{children:"Most of the time there is no need to upgrade Fory to a newer major version\u2014the current version is fast and compact enough, and we provide some minor fixes for recent older versions."}),"\n",(0,r.jsx)(i.h3,{id:"versioning-serialized-data",children:"Versioning Serialized Data"}),"\n",(0,r.jsx)(i.p,{children:"If you do want to upgrade Fory for better performance and smaller size, you need to write the Fory version as a header to serialized data using code like the following to keep binary compatibility:"}),"\n",(0,r.jsx)(i.h4,{id:"serialization-with-version-header",children:"Serialization with Version Header"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-java",children:"MemoryBuffer buffer = xxx;\nbuffer.writeVarInt32(2);  // Write Fory version\nfory.serialize(buffer, obj);\n"})}),"\n",(0,r.jsx)(i.h4,{id:"deserialization-with-version-header",children:"Deserialization with Version Header"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-java",children:"MemoryBuffer buffer = xxx;\nint foryVersion = buffer.readVarInt32();\nFory fory = getFory(foryVersion);\nfory.deserialize(buffer);\n"})}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.code,{children:"getFory"})," is a method to load the corresponding Fory version. You can shade and relocate different versions of Fory to different packages, and load Fory by version."]}),"\n",(0,r.jsx)(i.h3,{id:"shading-example",children:"Shading Example"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-xml",children:"\x3c!-- Maven Shade Plugin configuration for multiple Fory versions --\x3e\n<plugin>\n  <groupId>org.apache.maven.plugins</groupId>\n  <artifactId>maven-shade-plugin</artifactId>\n  <executions>\n    <execution>\n      <id>shade-fory-v1</id>\n      <phase>package</phase>\n      <goals>\n        <goal>shade</goal>\n      </goals>\n      <configuration>\n        <relocations>\n          <relocation>\n            <pattern>org.apache.fory</pattern>\n            <shadedPattern>com.myapp.fory.v1</shadedPattern>\n          </relocation>\n        </relocations>\n      </configuration>\n    </execution>\n  </executions>\n</plugin>\n"})}),"\n",(0,r.jsx)(i.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Test thoroughly before upgrading"}),": Ensure compatibility with existing serialized data"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Use version headers for long-term storage"}),": If data persists across Fory versions"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Maintain backward compatibility"}),": Keep old Fory versions available for reading legacy data"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Monitor after upgrade"}),": Watch for deserialization errors in production"]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"related-topics",children:"Related Topics"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"/docs/guide/java/configuration",children:"Configuration Options"})," - ForyBuilder options"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"/docs/guide/java/schema_evolution",children:"Schema Evolution"})," - Handling class changes"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"/docs/guide/java/troubleshooting",children:"Troubleshooting"})," - Common migration issues"]}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,o.a)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},11151:(e,i,n)=>{n.d(i,{Z:()=>s,a:()=>t});var r=n(67294);const o={},a=r.createContext(o);function t(e){const i=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function s(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),r.createElement(a.Provider,{value:i},e.children)}}}]);