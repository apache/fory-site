"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[66933],{71478:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>s,default:()=>h,frontMatter:()=>a,metadata:()=>l,toc:()=>c});var r=i(85893),t=i(11151);const a={title:"Configuration",sidebar_position:10,id:"configuration",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},s=void 0,l={id:"guide/go/configuration",title:"Configuration",description:"Fory Go uses a functional options pattern for configuration. This allows you to customize serialization behavior while maintaining sensible defaults.",source:"@site/versioned_docs/version-0.15/guide/go/configuration.md",sourceDirName:"guide/go",slug:"/guide/go/configuration",permalink:"/docs/guide/go/configuration",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/docs/guide/go/configuration.md",tags:[],version:"0.15",sidebarPosition:10,frontMatter:{title:"Configuration",sidebar_position:10,id:"configuration",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"Go Serialization Guide",permalink:"/docs/guide/go/"},next:{title:"Basic Serialization",permalink:"/docs/guide/go/basic_serialization"}},o={},c=[{value:"Creating a Fory Instance",id:"creating-a-fory-instance",level:2},{value:"Default Configuration",id:"default-configuration",level:3},{value:"With Options",id:"with-options",level:3},{value:"Configuration Options",id:"configuration-options",level:2},{value:"WithTrackRef",id:"withtrackref",level:3},{value:"WithCompatible",id:"withcompatible",level:3},{value:"WithMaxDepth",id:"withmaxdepth",level:3},{value:"WithXlang",id:"withxlang",level:3},{value:"Thread Safety",id:"thread-safety",level:2},{value:"Global Thread-Safe Instance",id:"global-thread-safe-instance",level:3},{value:"Buffer Management",id:"buffer-management",level:2},{value:"Zero-Copy Behavior",id:"zero-copy-behavior",level:3},{value:"Manual Buffer Control",id:"manual-buffer-control",level:3},{value:"Configuration Examples",id:"configuration-examples",level:2},{value:"Simple Data (Default)",id:"simple-data-default",level:3},{value:"Graph Structures",id:"graph-structures",level:3},{value:"Schema Evolution",id:"schema-evolution",level:3},{value:"High-Performance Concurrent",id:"high-performance-concurrent",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Related Topics",id:"related-topics",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Fory Go uses a functional options pattern for configuration. This allows you to customize serialization behavior while maintaining sensible defaults."}),"\n",(0,r.jsx)(n.h2,{id:"creating-a-fory-instance",children:"Creating a Fory Instance"}),"\n",(0,r.jsx)(n.h3,{id:"default-configuration",children:"Default Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'import "github.com/apache/fory/go/fory"\n\nf := fory.New()\n'})}),"\n",(0,r.jsx)(n.p,{children:"Default settings:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Option"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"TrackRef"}),(0,r.jsx)(n.td,{children:"false"}),(0,r.jsx)(n.td,{children:"Reference tracking disabled"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"MaxDepth"}),(0,r.jsx)(n.td,{children:"20"}),(0,r.jsx)(n.td,{children:"Maximum nesting depth"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"IsXlang"}),(0,r.jsx)(n.td,{children:"false"}),(0,r.jsx)(n.td,{children:"Cross-language mode disabled"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Compatible"}),(0,r.jsx)(n.td,{children:"false"}),(0,r.jsx)(n.td,{children:"Schema evolution mode disabled"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"with-options",children:"With Options"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"f := fory.New(\n    fory.WithTrackRef(true),\n    fory.WithCompatible(true),\n    fory.WithMaxDepth(10),\n)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,r.jsx)(n.h3,{id:"withtrackref",children:"WithTrackRef"}),"\n",(0,r.jsx)(n.p,{children:"Enable reference tracking to handle circular references and shared objects:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"f := fory.New(fory.WithTrackRef(true))\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"When enabled:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Objects appearing multiple times are serialized once"}),"\n",(0,r.jsx)(n.li,{children:"Circular references are handled correctly"}),"\n",(0,r.jsxs)(n.li,{children:["Per-field ",(0,r.jsx)(n.code,{children:'fory:"ref"'})," tags take effect"]}),"\n",(0,r.jsx)(n.li,{children:"Adds overhead for tracking object identity"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"When disabled (default):"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Each object occurrence is serialized independently"}),"\n",(0,r.jsx)(n.li,{children:"Circular references cause stack overflow or max depth error"}),"\n",(0,r.jsxs)(n.li,{children:["Per-field ",(0,r.jsx)(n.code,{children:'fory:"ref"'})," tags are ignored"]}),"\n",(0,r.jsx)(n.li,{children:"Better performance for simple data structures"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Use reference tracking when:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Data contains circular references"}),"\n",(0,r.jsx)(n.li,{children:"Same object is referenced multiple times"}),"\n",(0,r.jsx)(n.li,{children:"Serializing graph structures (trees with parent pointers, linked lists with cycles)"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["See ",(0,r.jsx)(n.a,{href:"/docs/guide/go/references",children:"References"})," for details."]}),"\n",(0,r.jsx)(n.h3,{id:"withcompatible",children:"WithCompatible"}),"\n",(0,r.jsx)(n.p,{children:"Enable compatible mode for schema evolution:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"f := fory.New(fory.WithCompatible(true))\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"When enabled:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Type metadata is written to serialized data"}),"\n",(0,r.jsx)(n.li,{children:"Supports adding/removing fields between versions"}),"\n",(0,r.jsx)(n.li,{children:"Field names or ids are used for matching (order-independent)"}),"\n",(0,r.jsx)(n.li,{children:"Larger serialized output due to metadata"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"When disabled (default):"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Compact serialization without field metadata"}),"\n",(0,r.jsx)(n.li,{children:"Faster serialization and smaller output"}),"\n",(0,r.jsx)(n.li,{children:"Fields matched by sorted order"}),"\n",(0,r.jsx)(n.li,{children:"Requires consistent struct definitions across all services"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["See ",(0,r.jsx)(n.a,{href:"/docs/guide/go/schema_evolution",children:"Schema Evolution"})," for details."]}),"\n",(0,r.jsx)(n.h3,{id:"withmaxdepth",children:"WithMaxDepth"}),"\n",(0,r.jsx)(n.p,{children:"Set the maximum nesting depth to prevent stack overflow:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"f := fory.New(fory.WithMaxDepth(30))\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Default: 20"}),"\n",(0,r.jsx)(n.li,{children:"Protects against deeply nested, recursive structures or malicious data"}),"\n",(0,r.jsx)(n.li,{children:"Serialization fails with error when exceeded"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"withxlang",children:"WithXlang"}),"\n",(0,r.jsx)(n.p,{children:"Enable cross-language serialization mode:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"f := fory.New(fory.WithXlang(true))\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"When enabled:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Uses cross-language type system"}),"\n",(0,r.jsx)(n.li,{children:"Compatible with Java, Python, C++, Rust, JavaScript"}),"\n",(0,r.jsx)(n.li,{children:"Type IDs follow xlang specification"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"When disabled (default):"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Go-native serialization mode"}),"\n",(0,r.jsx)(n.li,{children:"Support more Go-native types"}),"\n",(0,r.jsx)(n.li,{children:"Not compatible with other language implementations"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"thread-safety",children:"Thread Safety"}),"\n",(0,r.jsxs)(n.p,{children:["The default ",(0,r.jsx)(n.code,{children:"Fory"})," instance is ",(0,r.jsx)(n.strong,{children:"NOT thread-safe"}),". For concurrent use, use the thread-safe wrapper:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'import "github.com/apache/fory/go/fory/threadsafe"\n\n// Create thread-safe Fory with same options\nf := threadsafe.New(\n    fory.WithTrackRef(true),\n    fory.WithCompatible(true),\n)\n\n// Safe for concurrent use from multiple goroutines\ngo func() {\n    data, _ := f.Serialize(value1)\n    // data is already copied, safe to use after return\n}()\ngo func() {\n    data, _ := f.Serialize(value2)\n}()\n'})}),"\n",(0,r.jsx)(n.p,{children:"The thread-safe wrapper:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Uses ",(0,r.jsx)(n.code,{children:"sync.Pool"})," internally for efficient instance reuse"]}),"\n",(0,r.jsx)(n.li,{children:"Automatically copies serialized data before returning"}),"\n",(0,r.jsxs)(n.li,{children:["Accepts the same configuration options as ",(0,r.jsx)(n.code,{children:"fory.New()"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"global-thread-safe-instance",children:"Global Thread-Safe Instance"}),"\n",(0,r.jsx)(n.p,{children:"For convenience, the threadsafe package provides global functions:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'import "github.com/apache/fory/go/fory/threadsafe"\n\n// Uses a global thread-safe instance with default configuration\ndata, err := threadsafe.Marshal(&myValue)\nerr = threadsafe.Unmarshal(data, &result)\n'})}),"\n",(0,r.jsxs)(n.p,{children:["See ",(0,r.jsx)(n.a,{href:"/docs/guide/go/thread_safety",children:"Thread Safety"})," for details."]}),"\n",(0,r.jsx)(n.h2,{id:"buffer-management",children:"Buffer Management"}),"\n",(0,r.jsx)(n.h3,{id:"zero-copy-behavior",children:"Zero-Copy Behavior"}),"\n",(0,r.jsxs)(n.p,{children:["The default ",(0,r.jsx)(n.code,{children:"Fory"})," instance reuses its internal buffer:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"f := fory.New()\n\ndata1, _ := f.Serialize(value1)\n// WARNING: data1 becomes invalid after next Serialize call!\ndata2, _ := f.Serialize(value2)\n// data1 now points to invalid memory\n\n// To keep the data, copy it:\nsafeCopy := make([]byte, len(data1))\ncopy(safeCopy, data1)\n"})}),"\n",(0,r.jsx)(n.p,{children:"The thread-safe wrapper automatically copies data, so this is not a concern:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"f := threadsafe.New()\ndata1, _ := f.Serialize(value1)\ndata2, _ := f.Serialize(value2)\n// Both data1 and data2 are valid\n"})}),"\n",(0,r.jsx)(n.h3,{id:"manual-buffer-control",children:"Manual Buffer Control"}),"\n",(0,r.jsx)(n.p,{children:"For high-throughput scenarios, you can manage buffers manually:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"f := fory.New()\nbuf := fory.NewByteBuffer(nil)\n\n// Serialize to existing buffer\nerr := f.SerializeTo(buf, value)\n\n// Get serialized data\ndata := buf.GetByteSlice(0, buf.WriterIndex())\n\n// Process data...\n\n// Reset for next use\nbuf.Reset()\n"})}),"\n",(0,r.jsx)(n.h2,{id:"configuration-examples",children:"Configuration Examples"}),"\n",(0,r.jsx)(n.h3,{id:"simple-data-default",children:"Simple Data (Default)"}),"\n",(0,r.jsx)(n.p,{children:"For simple structs without circular references:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'f := fory.New()\n\ntype Config struct {\n    Host string\n    Port int32\n}\n\nf.RegisterStruct(Config{}, 1)\ndata, _ := f.Serialize(&Config{Host: "localhost", Port: 8080})\n'})}),"\n",(0,r.jsx)(n.h3,{id:"graph-structures",children:"Graph Structures"}),"\n",(0,r.jsx)(n.p,{children:"For data with circular references:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'f := fory.New(fory.WithTrackRef(true))\n\ntype Node struct {\n    Value int32\n    Next  *Node `fory:"ref"`\n}\n\nf.RegisterStruct(Node{}, 1)\nn1 := &Node{Value: 1}\nn2 := &Node{Value: 2}\nn1.Next = n2\nn2.Next = n1  // Circular reference\n\ndata, _ := f.Serialize(n1)\n'})}),"\n",(0,r.jsx)(n.h3,{id:"schema-evolution",children:"Schema Evolution"}),"\n",(0,r.jsx)(n.p,{children:"For data that may evolve over time:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'// V1: original struct\ntype UserV1 struct {\n    ID   int64\n    Name string\n}\n\n// V2: added Email field\ntype UserV2 struct {\n    ID    int64\n    Name  string\n    Email string  // New field\n}\n\n// Serialize with V1\nf1 := fory.New(fory.WithCompatible(true))\nf1.RegisterStruct(UserV1{}, 1)\ndata, _ := f1.Serialize(&UserV1{ID: 1, Name: "Alice"})\n\n// Deserialize into V2 - Email will have zero value\nf2 := fory.New(fory.WithCompatible(true))\nf2.RegisterStruct(UserV2{}, 1)\nvar user UserV2\nf2.Deserialize(data, &user)\n'})}),"\n",(0,r.jsx)(n.h3,{id:"high-performance-concurrent",children:"High-Performance Concurrent"}),"\n",(0,r.jsx)(n.p,{children:"For concurrent high-throughput scenarios:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:"type Request struct {\n    ID      int64\n    Payload string\n}\n\nf := threadsafe.New(\n    fory.WithMaxDepth(30),\n)\nf.RegisterStruct(Request{}, 1)\n\n// Process requests concurrently\nfor req := range requests {\n    go func(r Request) {\n        data, _ := f.Serialize(&r)\n        sendResponse(data)\n    }(req)\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Reuse Fory instances"}),": Creating a Fory instance involves initialization overhead. Create once and reuse."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Use thread-safe wrapper for concurrency"}),": Never share a non-thread-safe Fory instance across goroutines."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Enable reference tracking only when needed"}),": It adds overhead for tracking object identity."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Copy serialized data if keeping it"}),": With the default Fory, the returned byte slice is invalidated on the next operation."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Set appropriate max depth"}),": Increase for deeply nested structures, but be aware of memory usage."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Use compatible mode for evolving schemas"}),": Enable when struct definitions may change between service versions."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"related-topics",children:"Related Topics"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/guide/go/basic_serialization",children:"Basic Serialization"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/guide/go/references",children:"References"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/guide/go/schema_evolution",children:"Schema Evolution"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/guide/go/thread_safety",children:"Thread Safety"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},11151:(e,n,i)=>{i.d(n,{Z:()=>l,a:()=>s});var r=i(67294);const t={},a=r.createContext(t);function s(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);