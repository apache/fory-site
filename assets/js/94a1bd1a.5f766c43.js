"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[77468],{84014:(e,i,s)=>{s.r(i),s.d(i,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>o,toc:()=>c});var r=s(85893),n=s(11151);const t={title:"Type Registration & Security",sidebar_position:3,id:"type_registration",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},a=void 0,o={id:"guide/java/type_registration",title:"Type Registration & Security",description:"This page covers class registration mechanisms and security configurations.",source:"@site/versioned_docs/version-0.14/guide/java/type-registration.md",sourceDirName:"guide/java",slug:"/guide/java/type_registration",permalink:"/docs/0.14/guide/java/type_registration",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/docs/guide/java/type-registration.md",tags:[],version:"0.14",sidebarPosition:3,frontMatter:{title:"Type Registration & Security",sidebar_position:3,id:"type_registration",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"Basic Serialization",permalink:"/docs/0.14/guide/java/basic_serialization"},next:{title:"Custom Serializers",permalink:"/docs/0.14/guide/java/custom_serializers"}},l={},c=[{value:"Class Registration",id:"class-registration",level:2},{value:"Register by ID",id:"register-by-id",level:3},{value:"Register by Name",id:"register-by-name",level:3},{value:"Security Configuration",id:"security-configuration",level:2},{value:"Class Checker",id:"class-checker",level:3},{value:"AllowListChecker",id:"allowlistchecker",level:3},{value:"Limit Max Deserialization Depth",id:"limit-max-deserialization-depth",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Related Topics",id:"related-topics",level:2}];function d(e){const i={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,n.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.p,{children:"This page covers class registration mechanisms and security configurations."}),"\n",(0,r.jsx)(i.h2,{id:"class-registration",children:"Class Registration"}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.code,{children:"ForyBuilder#requireClassRegistration"})," can be used to disable class registration. This will allow deserializing objects of unknown types, which is more flexible but ",(0,r.jsx)(i.strong,{children:"may be insecure if the classes contain malicious code"}),"."]}),"\n",(0,r.jsxs)(i.p,{children:[(0,r.jsx)(i.strong,{children:"Do not disable class registration unless you can ensure your environment is secure"}),". Malicious code in ",(0,r.jsx)(i.code,{children:"init/equals/hashCode"})," can be executed when deserializing unknown/untrusted types when this option is disabled."]}),"\n",(0,r.jsx)(i.p,{children:"Class registration can not only reduce security risks, but also avoid classname serialization cost."}),"\n",(0,r.jsx)(i.h3,{id:"register-by-id",children:"Register by ID"}),"\n",(0,r.jsxs)(i.p,{children:["You can register class with API ",(0,r.jsx)(i.code,{children:"Fory#register"}),":"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-java",children:"Fory fory = xxx;\nfory.register(SomeClass.class);\nfory.register(SomeClass1.class, 1);\n"})}),"\n",(0,r.jsx)(i.p,{children:"Note that class registration order is important. Serialization and deserialization peers should have the same registration order."}),"\n",(0,r.jsx)(i.h3,{id:"register-by-name",children:"Register by Name"}),"\n",(0,r.jsxs)(i.p,{children:["Register class by ID will have better performance and smaller space overhead. But in some cases, management for a bunch of type IDs is complex. In such cases, registering class by name using API ",(0,r.jsx)(i.code,{children:"register(Class<?> cls, String namespace, String typeName)"})," is recommended:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-java",children:'fory.register(Foo.class, "demo", "Foo");\n'})}),"\n",(0,r.jsxs)(i.p,{children:["If there are no duplicate names for types, ",(0,r.jsx)(i.code,{children:"namespace"})," can be left as empty to reduce serialized size."]}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.strong,{children:"Do not use this API to register class since it will increase serialized size a lot compared to registering class by ID."})}),"\n",(0,r.jsx)(i.h2,{id:"security-configuration",children:"Security Configuration"}),"\n",(0,r.jsx)(i.h3,{id:"class-checker",children:"Class Checker"}),"\n",(0,r.jsxs)(i.p,{children:["If you invoke ",(0,r.jsx)(i.code,{children:"ForyBuilder#requireClassRegistration(false)"})," to disable class registration check, you can set ",(0,r.jsx)(i.code,{children:"org.apache.fory.resolver.ClassChecker"})," by ",(0,r.jsx)(i.code,{children:"ClassResolver#setClassChecker"})," to control which classes are allowed for serialization."]}),"\n",(0,r.jsxs)(i.p,{children:["For example, you can allow classes started with ",(0,r.jsx)(i.code,{children:"org.example.*"}),":"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-java",children:'Fory fory = xxx;\nfory.getClassResolver().setClassChecker(\n  (classResolver, className) -> className.startsWith("org.example."));\n'})}),"\n",(0,r.jsx)(i.h3,{id:"allowlistchecker",children:"AllowListChecker"}),"\n",(0,r.jsxs)(i.p,{children:["Fory provides a ",(0,r.jsx)(i.code,{children:"org.apache.fory.resolver.AllowListChecker"})," which is an allowed/disallowed list based checker to simplify the customization of class check mechanism:"]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-java",children:'AllowListChecker checker = new AllowListChecker(AllowListChecker.CheckLevel.STRICT);\nThreadSafeFory fory = new ThreadLocalFory(classLoader -> {\n  Fory f = Fory.builder().requireClassRegistration(true).withClassLoader(classLoader).build();\n  f.getClassResolver().setClassChecker(checker);\n  checker.addListener(f.getClassResolver());\n  return f;\n});\nchecker.allowClass("org.example.*");\n'})}),"\n",(0,r.jsx)(i.p,{children:"You can use this checker or implement a more sophisticated checker by yourself."}),"\n",(0,r.jsx)(i.h2,{id:"limit-max-deserialization-depth",children:"Limit Max Deserialization Depth"}),"\n",(0,r.jsxs)(i.p,{children:["Fory provides ",(0,r.jsx)(i.code,{children:"ForyBuilder#withMaxDepth"})," to limit max deserialization depth. The default max depth is 50."]}),"\n",(0,r.jsxs)(i.p,{children:["If max depth is reached, Fory will throw ",(0,r.jsx)(i.code,{children:"ForyException"}),". This can be used to prevent malicious data from causing stack overflow or other issues."]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-java",children:"Fory fory = Fory.builder()\n  .withLanguage(Language.JAVA)\n  .withMaxDepth(100)  // Set custom max depth\n  .build();\n"})}),"\n",(0,r.jsx)(i.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(i.ol,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Always enable class registration in production"}),": Use ",(0,r.jsx)(i.code,{children:"requireClassRegistration(true)"})]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Use ID-based registration for performance"}),": Numeric IDs are faster than string names"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Maintain consistent registration order"}),": Same order on both serialization and deserialization sides"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Set appropriate max depth"}),": Prevent stack overflow attacks"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.strong,{children:"Use AllowListChecker for fine-grained control"}),": When you need flexible class filtering"]}),"\n"]}),"\n",(0,r.jsx)(i.h2,{id:"related-topics",children:"Related Topics"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"/docs/0.14/guide/java/configuration",children:"Configuration Options"})," - ForyBuilder security options"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"/docs/0.14/guide/java/custom_serializers",children:"Custom Serializers"})," - Register custom serializers"]}),"\n",(0,r.jsxs)(i.li,{children:[(0,r.jsx)(i.a,{href:"/docs/0.14/guide/java/troubleshooting",children:"Troubleshooting"})," - Common registration issues"]}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,n.a)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},11151:(e,i,s)=>{s.d(i,{Z:()=>o,a:()=>a});var r=s(67294);const n={},t=r.createContext(n);function a(e){const i=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function o(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:a(e.components),r.createElement(t.Provider,{value:i},e.children)}}}]);