"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[83930],{34458:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>d});var i=s(85893),r=s(11151);const l={title:"Troubleshooting",sidebar_position:6,id:"xlang_troubleshooting",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},a=void 0,t={id:"guide/xlang/xlang_troubleshooting",title:"Troubleshooting",description:"This page covers common issues and solutions when using cross-language serialization.",source:"@site/versioned_docs/version-0.14/guide/xlang/troubleshooting.md",sourceDirName:"guide/xlang",slug:"/guide/xlang/xlang_troubleshooting",permalink:"/docs/0.14/guide/xlang/xlang_troubleshooting",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/docs/guide/xlang/troubleshooting.md",tags:[],version:"0.14",sidebarPosition:6,frontMatter:{title:"Troubleshooting",sidebar_position:6,id:"xlang_troubleshooting",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"Row Format",permalink:"/docs/0.14/guide/xlang/row_format"},next:{title:"GraalVM Guide",permalink:"/docs/0.14/guide/graalvm_serialization"}},o={},d=[{value:"Type Registration Errors",id:"type-registration-errors",level:2},{value:"&quot;Type not registered&quot; Error",id:"type-not-registered-error",level:3},{value:"&quot;Type ID mismatch&quot; Error",id:"type-id-mismatch-error",level:3},{value:"Type Mapping Issues",id:"type-mapping-issues",level:2},{value:"Integer Overflow",id:"integer-overflow",level:3},{value:"Float Precision Loss",id:"float-precision-loss",level:3},{value:"String Encoding Errors",id:"string-encoding-errors",level:3},{value:"Field Order Issues",id:"field-order-issues",level:2},{value:"&quot;Field mismatch&quot; Error",id:"field-mismatch-error",level:3},{value:"Reference Tracking Issues",id:"reference-tracking-issues",level:2},{value:"Stack Overflow with Circular References",id:"stack-overflow-with-circular-references",level:3},{value:"Duplicate Objects",id:"duplicate-objects",level:3},{value:"Language Mode Issues",id:"language-mode-issues",level:2},{value:"&quot;Invalid magic number&quot; Error",id:"invalid-magic-number-error",level:3},{value:"Incompatible Types in Xlang Mode",id:"incompatible-types-in-xlang-mode",level:3},{value:"Version Compatibility",id:"version-compatibility",level:2},{value:"Serialization Format Changed",id:"serialization-format-changed",level:3},{value:"Debugging Tips",id:"debugging-tips",level:2},{value:"Enable Debug Logging",id:"enable-debug-logging",level:3},{value:"Inspect Serialized Data",id:"inspect-serialized-data",level:3},{value:"Test Round-Trip",id:"test-round-trip",level:3},{value:"Cross-Language Testing",id:"cross-language-testing",level:3},{value:"Common Mistakes",id:"common-mistakes",level:2},{value:"See Also",id:"see-also",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"This page covers common issues and solutions when using cross-language serialization."}),"\n",(0,i.jsx)(n.h2,{id:"type-registration-errors",children:"Type Registration Errors"}),"\n",(0,i.jsx)(n.h3,{id:"type-not-registered-error",children:'"Type not registered" Error'}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Symptom:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Error: Type 'example.Person' is not registered\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cause:"})," The type was not registered before deserialization, or the type name doesn't match."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Ensure the type is registered with the same name on both sides:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// Java\nfory.register(Person.class, "example.Person");\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'# Python\nfory.register_type(Person, typename="example.Person")\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Check for typos or case differences in type names"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Register types before any serialization/deserialization calls"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"type-id-mismatch-error",children:'"Type ID mismatch" Error'}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Symptom:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Error: Expected type ID 100, got 101\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cause:"})," Different type IDs used across languages."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution:"})," Use consistent type IDs:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"// Java\nfory.register(Person.class, 100);\nfory.register(Address.class, 101);\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Python\nfory.register_type(Person, type_id=100)\nfory.register_type(Address, type_id=101)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"type-mapping-issues",children:"Type Mapping Issues"}),"\n",(0,i.jsx)(n.h3,{id:"integer-overflow",children:"Integer Overflow"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Symptom:"})," Values are truncated or wrapped unexpectedly."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cause:"})," Using different integer sizes across languages."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"In Python, use explicit type annotations:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"@dataclass\nclass Data:\n    value: pyfory.Int32Type  # Not just 'int'\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Ensure integer ranges are compatible:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"int8"}),": -128 to 127"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"int16"}),": -32,768 to 32,767"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"int32"}),": -2,147,483,648 to 2,147,483,647"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"float-precision-loss",children:"Float Precision Loss"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Symptom:"})," Float values have unexpected precision."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cause:"})," Mixing ",(0,i.jsx)(n.code,{children:"float32"})," and ",(0,i.jsx)(n.code,{children:"float64"})," types."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Use consistent float types:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"@dataclass\nclass Data:\n    value: pyfory.Float32Type  # Explicit 32-bit float\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Be aware that Python's ",(0,i.jsx)(n.code,{children:"float"})," maps to ",(0,i.jsx)(n.code,{children:"float64"})," by default"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"string-encoding-errors",children:"String Encoding Errors"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Symptom:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Error: Invalid UTF-8 sequence\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cause:"})," Non-UTF-8 encoded strings."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Ensure all strings are valid UTF-8"}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"In Python, decode bytes before serialization:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"text = raw_bytes.decode('utf-8')\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"field-order-issues",children:"Field Order Issues"}),"\n",(0,i.jsx)(n.h3,{id:"field-mismatch-error",children:'"Field mismatch" Error'}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Symptom:"})," Deserialized objects have wrong field values."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cause:"})," Field order differs between languages."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution:"})," Fory sorts fields by their snake_cased names. Ensure field names are consistent:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"// Java - fields will be sorted: age, email, name\npublic class Person {\n    public String name;\n    public int age;\n    public String email;\n}\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Python - same field order\n@dataclass\nclass Person:\n    name: str\n    age: pyfory.Int32Type\n    email: str\n"})}),"\n",(0,i.jsx)(n.h2,{id:"reference-tracking-issues",children:"Reference Tracking Issues"}),"\n",(0,i.jsx)(n.h3,{id:"stack-overflow-with-circular-references",children:"Stack Overflow with Circular References"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Symptom:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"StackOverflowError or RecursionError\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cause:"})," Reference tracking is disabled but data has circular references."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution:"})," Enable reference tracking:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"// Java\nFory fory = Fory.builder()\n    .withLanguage(Language.XLANG)\n    .withRefTracking(true)\n    .build();\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Python\nfory = pyfory.Fory(ref_tracking=True)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"duplicate-objects",children:"Duplicate Objects"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Symptom:"})," Shared objects are duplicated after deserialization."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cause:"})," Reference tracking is disabled."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution:"})," Enable reference tracking if objects are shared within the graph."]}),"\n",(0,i.jsx)(n.h2,{id:"language-mode-issues",children:"Language Mode Issues"}),"\n",(0,i.jsx)(n.h3,{id:"invalid-magic-number-error",children:'"Invalid magic number" Error'}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Symptom:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Error: Invalid magic number in header\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cause:"})," One side is using Java-native mode instead of xlang mode."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution:"})," Ensure both sides use xlang mode:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"// Java - must use Language.XLANG\nFory fory = Fory.builder()\n    .withLanguage(Language.XLANG)\n    .build();\n"})}),"\n",(0,i.jsx)(n.h3,{id:"incompatible-types-in-xlang-mode",children:"Incompatible Types in Xlang Mode"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Symptom:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Error: Type 'Optional' is not supported in xlang mode\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cause:"})," Using Java-specific types that don't have cross-language equivalents."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution:"})," Use compatible types:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"// Instead of Optional<String>\npublic String email;  // nullable\n\n// Instead of BigDecimal\npublic double amount;\n\n// Instead of EnumSet<Status>\npublic Set<Status> statuses;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"version-compatibility",children:"Version Compatibility"}),"\n",(0,i.jsx)(n.h3,{id:"serialization-format-changed",children:"Serialization Format Changed"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Symptom:"})," Deserialization fails after upgrading Fory."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cause:"})," Breaking changes in serialization format."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Ensure all services use compatible Fory versions"}),"\n",(0,i.jsx)(n.li,{children:"Check release notes for breaking changes"}),"\n",(0,i.jsx)(n.li,{children:"Consider using schema evolution (compatible mode) for gradual upgrades"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"debugging-tips",children:"Debugging Tips"}),"\n",(0,i.jsx)(n.h3,{id:"enable-debug-logging",children:"Enable Debug Logging"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Java:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"// Add to JVM options\n-Dfory.debug=true\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Python:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import logging\nlogging.getLogger('pyfory').setLevel(logging.DEBUG)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"inspect-serialized-data",children:"Inspect Serialized Data"}),"\n",(0,i.jsx)(n.p,{children:"Use hex dump to inspect the binary format:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"data = fory.serialize(obj)\nprint(data.hex())\n"})}),"\n",(0,i.jsx)(n.h3,{id:"test-round-trip",children:"Test Round-Trip"}),"\n",(0,i.jsx)(n.p,{children:"Always test round-trip serialization in each language:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"byte[] bytes = fory.serialize(obj);\nObject result = fory.deserialize(bytes);\nassert obj.equals(result);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"cross-language-testing",children:"Cross-Language Testing"}),"\n",(0,i.jsx)(n.p,{children:"Test serialization across all target languages before deployment:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Serialize in Java\njava -jar serializer.jar > data.bin\n\n# Deserialize in Python\npython deserializer.py data.bin\n"})}),"\n",(0,i.jsx)(n.h2,{id:"common-mistakes",children:"Common Mistakes"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Not registering types"}),": Always register custom types before use"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Inconsistent type names/IDs"}),": Use the same names/IDs across all languages"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Forgetting xlang mode"}),": Use ",(0,i.jsx)(n.code,{children:"Language.XLANG"})," in Java"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Wrong type annotations"}),": Use ",(0,i.jsx)(n.code,{children:"pyfory.Int32Type"})," etc. in Python"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Ignoring reference tracking"}),": Enable for circular/shared references"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://fory.apache.org/docs/specification/xlang_type_mapping",children:"Type Mapping"})," - Cross-language type mapping reference"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/0.14/guide/xlang/xlang_getting_started",children:"Getting Started"})," - Setup guide"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/0.14/guide/java/troubleshooting",children:"Java Troubleshooting"})," - Java-specific issues"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/0.14/guide/python/troubleshooting",children:"Python Troubleshooting"})," - Python-specific issues"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},11151:(e,n,s)=>{s.d(n,{Z:()=>t,a:()=>a});var i=s(67294);const r={},l=i.createContext(r);function a(e){const n=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);