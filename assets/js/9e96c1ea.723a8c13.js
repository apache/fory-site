"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[4852],{13095:(e,i,s)=>{s.r(i),s.d(i,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>d});var n=s(85893),t=s(11151);const l={title:"Xlang Implementation Guide",sidebar_position:10,id:"xlang_implementation_guide",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},a=void 0,r={id:"specification/xlang_implementation_guide",title:"Xlang Implementation Guide",description:"Implementation guidelines",source:"@site/versioned_docs/version-0.15/specification/xlang_implementation_guide.md",sourceDirName:"specification",slug:"/specification/xlang_implementation_guide",permalink:"/docs/specification/xlang_implementation_guide",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/docs/specification/xlang_implementation_guide.md",tags:[],version:"0.15",sidebarPosition:10,frontMatter:{title:"Xlang Implementation Guide",sidebar_position:10,id:"xlang_implementation_guide",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"specificationSidebar",previous:{title:"Xlang Type Mapping",permalink:"/docs/specification/xlang_type_mapping"}},c={},d=[{value:"Implementation guidelines",id:"implementation-guidelines",level:2},{value:"How to reduce memory read/write code",id:"how-to-reduce-memory-readwrite-code",level:3},{value:"Fast deserialization for static languages without runtime codegen support",id:"fast-deserialization-for-static-languages-without-runtime-codegen-support",level:3},{value:"Implementation Checklist for New Languages",id:"implementation-checklist-for-new-languages",level:2},{value:"Phase 1: Core Infrastructure",id:"phase-1-core-infrastructure",level:3},{value:"Phase 2: Basic Type Serializers",id:"phase-2-basic-type-serializers",level:3},{value:"Phase 3: Collection Types",id:"phase-3-collection-types",level:3},{value:"Phase 4: Meta String Encoding",id:"phase-4-meta-string-encoding",level:3},{value:"Phase 5: Enum Serialization",id:"phase-5-enum-serialization",level:3},{value:"Phase 6: Struct Serialization",id:"phase-6-struct-serialization",level:3},{value:"Phase 7: Other types",id:"phase-7-other-types",level:3},{value:"Testing Strategy",id:"testing-strategy",level:3},{value:"Language-Specific Implementation Notes",id:"language-specific-implementation-notes",level:2},{value:"Java",id:"java",level:3},{value:"Python",id:"python",level:3},{value:"C++",id:"c",level:3},{value:"Rust",id:"rust",level:3},{value:"Go",id:"go",level:3}];function o(e){const i={code:"code",h2:"h2",h3:"h3",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.h2,{id:"implementation-guidelines",children:"Implementation guidelines"}),"\n",(0,n.jsx)(i.h3,{id:"how-to-reduce-memory-readwrite-code",children:"How to reduce memory read/write code"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Try to merge multiple bytes into an int/long write before writing to reduce memory IO and bound check cost."}),"\n",(0,n.jsx)(i.li,{children:"Read multiple bytes as an int/long, then split into multiple bytes to reduce memory IO and bound check cost."}),"\n",(0,n.jsx)(i.li,{children:"Try to use one varint/long to write flags and length together to save one byte cost and reduce memory io."}),"\n",(0,n.jsx)(i.li,{children:"Condition branches are less expensive compared to memory IO cost unless there are too many branches."}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"fast-deserialization-for-static-languages-without-runtime-codegen-support",children:"Fast deserialization for static languages without runtime codegen support"}),"\n",(0,n.jsx)(i.p,{children:"For type evolution, the serializer will encode the type meta into the serialized data. The deserializer will compare\nthis meta with class meta in the current process, and use the diff to determine how to deserialize the data."}),"\n",(0,n.jsx)(i.p,{children:"For java/javascript/python, we can use the diff to generate serializer code at runtime and load it as class/function for\ndeserialization. In this way, the type evolution will be as fast as type consist mode."}),"\n",(0,n.jsx)(i.p,{children:"For C++/Rust, we can't generate the serializer code at runtime. So we need to generate the code at compile-time using\nmeta programming. But at that time, we don't know the type schema in other processes, so we can't generate the\nserializer code for such inconsistent types. We may need to generate the code which has a loop and compare field name\none by one to decide whether to deserialize and assign the field or skip the field value."}),"\n",(0,n.jsxs)(i.p,{children:["One fast way is that we can optimize the string comparison into ",(0,n.jsx)(i.code,{children:"jump"})," instructions:"]}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:["Assume the current type has ",(0,n.jsx)(i.code,{children:"n"})," fields, and the peer type has ",(0,n.jsx)(i.code,{children:"n1"})," fields."]}),"\n",(0,n.jsxs)(i.li,{children:["Generate an auto growing ",(0,n.jsx)(i.code,{children:"field id"})," from ",(0,n.jsx)(i.code,{children:"0"})," for every sorted field in the current type at the compile time."]}),"\n",(0,n.jsxs)(i.li,{children:["Compare the received type meta with current type, generate same id if the field name is same, otherwise generate an\nauto growing id starting from ",(0,n.jsx)(i.code,{children:"n"}),", cache this meta at runtime."]}),"\n",(0,n.jsxs)(i.li,{children:["Iterate the fields of received type meta, use a ",(0,n.jsx)(i.code,{children:"switch"})," to compare the ",(0,n.jsx)(i.code,{children:"field id"})," to deserialize data\nand ",(0,n.jsx)(i.code,{children:"assign/skip"})," field value. ",(0,n.jsx)(i.strong,{children:"Continuous"})," field id will be optimized into ",(0,n.jsx)(i.code,{children:"jump"})," in ",(0,n.jsx)(i.code,{children:"switch"})," block, so it will\nvery fast."]}),"\n"]}),"\n",(0,n.jsxs)(i.p,{children:["Here is an example, suppose process A has a class ",(0,n.jsx)(i.code,{children:"Foo"})," with version 1 defined as ",(0,n.jsx)(i.code,{children:"Foo1"}),", process B has a class ",(0,n.jsx)(i.code,{children:"Foo"}),"\nwith version 2 defined as ",(0,n.jsx)(i.code,{children:"Foo2"}),":"]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-c++",children:"// class Foo with version 1\nclass Foo1 {\n  int32_t v1; // id 0\n  std::string v2; // id 1\n};\n// class Foo with version 2\nclass Foo2 {\n  // id 0, but will have id 2 in process A\n  bool v0;\n  // id 1, but will have id 0 in process A\n  int32_t v1;\n  // id 2, but will have id 3 in process A\n  int64_t long_value;\n  // id 3, but will have id 1 in process A\n  std::string v2;\n  // id 4, but will have id 4 in process A\n  std::vector<std::string> list;\n};\n"})}),"\n",(0,n.jsxs)(i.p,{children:["When process A received serialized ",(0,n.jsx)(i.code,{children:"Foo2"})," from process B, here is how it deserialize the data:"]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-c++",children:"Foo1 foo1 = ...;\nconst std::vector<fory::FieldInfo> &field_infos = type_meta.field_infos;\nfor (const auto &field_info : field_infos) {\n  switch (field_info.field_id) {\n    case 0:\n      foo1.v1 = buffer.read_varint32();\n      break;\n    case 1:\n      foo1.v2 = fory.read_string();\n      break;\n    default:\n      fory.skip_data(field_info);\n  }\n}\n"})}),"\n",(0,n.jsx)(i.h2,{id:"implementation-checklist-for-new-languages",children:"Implementation Checklist for New Languages"}),"\n",(0,n.jsx)(i.p,{children:"This section provides a step-by-step guide for implementing Fory xlang serialization in a new language."}),"\n",(0,n.jsx)(i.h3,{id:"phase-1-core-infrastructure",children:"Phase 1: Core Infrastructure"}),"\n",(0,n.jsxs)(i.ol,{children:["\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.strong,{children:"Buffer Implementation"})}),"\n",(0,n.jsxs)(i.ul,{className:"contains-task-list",children:["\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Create a byte buffer with read/write cursor tracking"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Implement little-endian byte order for all multi-byte writes"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Implement ",(0,n.jsx)(i.code,{children:"write_int8"}),", ",(0,n.jsx)(i.code,{children:"write_int16"}),", ",(0,n.jsx)(i.code,{children:"write_int32"}),", ",(0,n.jsx)(i.code,{children:"write_int64"})]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Implement ",(0,n.jsx)(i.code,{children:"write_float32"}),", ",(0,n.jsx)(i.code,{children:"write_float64"})]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Implement ",(0,n.jsx)(i.code,{children:"read_*"})," counterparts for all write methods"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Implement buffer growth strategy (e.g., doubling)"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.strong,{children:"Varint Encoding"})}),"\n",(0,n.jsxs)(i.ul,{className:"contains-task-list",children:["\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Implement ",(0,n.jsx)(i.code,{children:"write_varuint32"})," / ",(0,n.jsx)(i.code,{children:"read_varuint32"})]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Implement ",(0,n.jsx)(i.code,{children:"write_varint32"})," / ",(0,n.jsx)(i.code,{children:"read_varint32"})," (with ZigZag)"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Implement ",(0,n.jsx)(i.code,{children:"write_varuint64"})," / ",(0,n.jsx)(i.code,{children:"read_varuint64"})]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Implement ",(0,n.jsx)(i.code,{children:"write_varint64"})," / ",(0,n.jsx)(i.code,{children:"read_varint64"})," (with ZigZag)"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Implement ",(0,n.jsx)(i.code,{children:"write_varuint36_small"})," / ",(0,n.jsx)(i.code,{children:"read_varuint36_small"})," (for strings)"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Optionally implement Hybrid encoding (TAGGED_INT64/TAGGED_UINT64) for int64"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.strong,{children:"Header Handling"})}),"\n",(0,n.jsxs)(i.ul,{className:"contains-task-list",children:["\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Write/read bitmap flags (null, xlang, oob)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"phase-2-basic-type-serializers",children:"Phase 2: Basic Type Serializers"}),"\n",(0,n.jsxs)(i.ol,{start:"4",children:["\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.strong,{children:"Primitive Types"})}),"\n",(0,n.jsxs)(i.ul,{className:"contains-task-list",children:["\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","bool (1 byte: 0 or 1)"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","int8, int16, int32, int64 (little endian)"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","float32, float64 (IEEE 754, little endian)"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.strong,{children:"String Serialization"})}),"\n",(0,n.jsxs)(i.ul,{className:"contains-task-list",children:["\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Implement string header: ",(0,n.jsx)(i.code,{children:"(byte_length << 2) | encoding"})]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Support UTF-8 encoding (required for xlang)"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Optionally support LATIN1 and UTF-16"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.strong,{children:"Temporal Types"})}),"\n",(0,n.jsxs)(i.ul,{className:"contains-task-list",children:["\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Duration (seconds + nanoseconds)"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Timestamp (seconds + nanoseconds since epoch)"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Date (days since epoch)"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.strong,{children:"Reference Tracking"})}),"\n",(0,n.jsxs)(i.ul,{className:"contains-task-list",children:["\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Implement write-side object tracking (object \u2192 ref_id map)"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Implement read-side object tracking (ref_id \u2192 object list)"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Handle all four reference flags: NULL(-3), REF(-2), NOT_NULL(-1), REF_VALUE(0)"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Support disabling reference tracking per-type or globally"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"phase-3-collection-types",children:"Phase 3: Collection Types"}),"\n",(0,n.jsxs)(i.ol,{start:"8",children:["\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.strong,{children:"List/Array Serialization"})}),"\n",(0,n.jsxs)(i.ul,{className:"contains-task-list",children:["\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Write length as varuint32"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Write elements header byte"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Handle homogeneous vs heterogeneous elements"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Handle null elements"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.strong,{children:"Map Serialization"})}),"\n",(0,n.jsxs)(i.ul,{className:"contains-task-list",children:["\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Write total size as varuint32"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Implement chunk-based format (max 255 pairs per chunk)"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Write KV header byte per chunk"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Handle key and value type variations"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.strong,{children:"Set Serialization"})}),"\n",(0,n.jsxs)(i.ul,{className:"contains-task-list",children:["\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Same format as List (reuse implementation)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"phase-4-meta-string-encoding",children:"Phase 4: Meta String Encoding"}),"\n",(0,n.jsx)(i.p,{children:"Meta strings are required for enum and struct serialization (encoding field names, type names, namespaces)."}),"\n",(0,n.jsxs)(i.ol,{start:"11",children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Meta String Compression"}),"\n",(0,n.jsxs)(i.ul,{className:"contains-task-list",children:["\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Implement LOWER_SPECIAL encoding (5 bits/char)"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Implement LOWER_UPPER_DIGIT_SPECIAL encoding (6 bits/char)"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Implement FIRST_TO_LOWER_SPECIAL encoding"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Implement ALL_TO_LOWER_SPECIAL encoding"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Implement encoding selection algorithm"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Implement meta string deduplication"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"phase-5-enum-serialization",children:"Phase 5: Enum Serialization"}),"\n",(0,n.jsxs)(i.ol,{start:"12",children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Enum Serialization"}),"\n",(0,n.jsxs)(i.ul,{className:"contains-task-list",children:["\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Write ordinal as varuint32"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Support named enum (namespace + type name)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"phase-6-struct-serialization",children:"Phase 6: Struct Serialization"}),"\n",(0,n.jsxs)(i.ol,{start:"13",children:["\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.strong,{children:"Type Registration"})}),"\n",(0,n.jsxs)(i.ul,{className:"contains-task-list",children:["\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Support registration by numeric ID"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Support registration by namespace + type name"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Maintain type \u2192 serializer mapping"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Generate type IDs: write internal type ID, then ",(0,n.jsx)(i.code,{children:"user_type_id"})," as varuint32"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.strong,{children:"Field Ordering"})}),"\n",(0,n.jsxs)(i.ul,{className:"contains-task-list",children:["\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Implement the spec-defined grouping and ordering (primitive/boxed/built-in, collections/maps, other)"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Use a stable comparator within each group (type ID and name)"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Use tag ID or snake_case field name as field identifier for fingerprints"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.strong,{children:"Schema Consistent Mode"})}),"\n",(0,n.jsxs)(i.ul,{className:"contains-task-list",children:["\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","If class-version check is enabled, compute schema hash from field identifiers"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Write 4-byte schema hash before fields"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Serialize fields in Fory order"]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:["\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.strong,{children:"Compatible/Meta Share Mode"})}),"\n",(0,n.jsxs)(i.ul,{className:"contains-task-list",children:["\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Implement shared TypeDef stream (inline new TypeDefs, index references)"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Map fields by name or tag ID, skip unknown fields"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Apply nullable/ref flags from TypeDef metadata"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"phase-7-other-types",children:"Phase 7: Other types"}),"\n",(0,n.jsxs)(i.ol,{start:"17",children:["\n",(0,n.jsx)(i.li,{children:(0,n.jsx)(i.strong,{children:"Binary/Array Types"})}),"\n"]}),"\n",(0,n.jsxs)(i.ul,{className:"contains-task-list",children:["\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Primitive arrays (direct buffer copy)"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Multi-dimensional arrays as nested lists (no tensor encoding)"]}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"testing-strategy",children:"Testing Strategy"}),"\n",(0,n.jsxs)(i.ol,{start:"18",children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Cross-Language Compatibility Tests"}),"\n",(0,n.jsxs)(i.ul,{className:"contains-task-list",children:["\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Serialize in new language, deserialize in Java/Python"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Serialize in Java/Python, deserialize in new language"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Test all primitive types"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Test strings with various encodings"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Test collections (empty, single, multiple elements)"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Test maps with various key/value types"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Test nested structs"]}),"\n",(0,n.jsxs)(i.li,{className:"task-list-item",children:[(0,n.jsx)(i.input,{type:"checkbox",disabled:!0})," ","Test circular references (if supported)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(i.h2,{id:"language-specific-implementation-notes",children:"Language-Specific Implementation Notes"}),"\n",(0,n.jsx)(i.h3,{id:"java",children:"Java"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Uses runtime code generation (JIT) for maximum performance"}),"\n",(0,n.jsx)(i.li,{children:"Supports all reference tracking modes"}),"\n",(0,n.jsx)(i.li,{children:"Uses internal String coder for encoding selection"}),"\n",(0,n.jsxs)(i.li,{children:["Thread-safe via ",(0,n.jsx)(i.code,{children:"ThreadSafeFory"})," wrapper"]}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"python",children:"Python"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Two modes: Pure Python (debugging) and Cython (performance)"}),"\n",(0,n.jsxs)(i.li,{children:["Uses ",(0,n.jsx)(i.code,{children:"id(obj)"})," for reference tracking"]}),"\n",(0,n.jsx)(i.li,{children:"Latin1/UTF-16/UTF-8 encoding for all strings in xlang mode"}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"dataclass"})," support via code generation"]}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"c",children:"C++"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:["Compile-time reflection via macros (",(0,n.jsx)(i.code,{children:"FORY_STRUCT"}),")"]}),"\n",(0,n.jsx)(i.li,{children:"Template meta programming for type dispatch and serializer selection"}),"\n",(0,n.jsxs)(i.li,{children:["Uses ",(0,n.jsx)(i.code,{children:"std::shared_ptr"})," for reference tracking"]}),"\n",(0,n.jsx)(i.li,{children:"Compile-time field ordering"}),"\n",(0,n.jsx)(i.li,{children:"No runtime code generation"}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"rust",children:"Rust"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:["Derive macros for automatic serialization (",(0,n.jsx)(i.code,{children:"#[derive(ForyObject)]"}),")"]}),"\n",(0,n.jsxs)(i.li,{children:["Uses ",(0,n.jsx)(i.code,{children:"Rc<T>"})," / ",(0,n.jsx)(i.code,{children:"Arc<T>"})," for reference tracking"]}),"\n",(0,n.jsx)(i.li,{children:"Thread-local context caching for performance"}),"\n",(0,n.jsx)(i.li,{children:"Compile-time field ordering"}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"go",children:"Go"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Reflection-based and codegen-based modes"}),"\n",(0,n.jsx)(i.li,{children:"Struct tags for field annotations"}),"\n",(0,n.jsx)(i.li,{children:"Interface types for polymorphism"}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,t.a)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(o,{...e})}):o(e)}},11151:(e,i,s)=>{s.d(i,{Z:()=>r,a:()=>a});var n=s(67294);const t={},l=n.createContext(t);function a(e){const i=n.useContext(l);return n.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function r(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),n.createElement(l.Provider,{value:i},e.children)}}}]);