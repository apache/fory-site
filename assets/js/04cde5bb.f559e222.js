"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[73027],{85790:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>d});var s=i(85893),r=i(11151);const o={title:"Compression",sidebar_position:6,id:"compression",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},t=void 0,a={id:"guide/java/compression",title:"Compression",description:"This page covers compression options for reducing serialized data size.",source:"@site/docs/guide/java/compression.md",sourceDirName:"guide/java",slug:"/guide/java/compression",permalink:"/docs/next/guide/java/compression",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/docs/guide/java/compression.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{title:"Compression",sidebar_position:6,id:"compression",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"Schema Evolution",permalink:"/docs/next/guide/java/schema_evolution"},next:{title:"Advanced Features",permalink:"/docs/next/guide/java/advanced_features"}},l={},d=[{value:"Integer Compression",id:"integer-compression",level:2},{value:"Int Compression",id:"int-compression",level:3},{value:"Long Compression",id:"long-compression",level:3},{value:"SLI (Small Long as Int) Encoding (Default)",id:"sli-small-long-as-int-encoding-default",level:4},{value:"PVL (Progressive Variable-length Long) Encoding",id:"pvl-progressive-variable-length-long-encoding",level:4},{value:"Array Compression",id:"array-compression",level:2},{value:"How Array Compression Works",id:"how-array-compression-works",level:3},{value:"Configuration and Registration",id:"configuration-and-registration",level:3},{value:"Maven Dependency",id:"maven-dependency",level:3},{value:"String Compression",id:"string-compression",level:2},{value:"Configuration Summary",id:"configuration-summary",level:2},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"Example Configuration",id:"example-configuration",level:2},{value:"Related Topics",id:"related-topics",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"This page covers compression options for reducing serialized data size."}),"\n",(0,s.jsx)(n.h2,{id:"integer-compression",children:"Integer Compression"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"ForyBuilder#withIntCompressed"}),"/",(0,s.jsx)(n.code,{children:"ForyBuilder#withLongCompressed"})," can be used to compress int/long for smaller size. Normally compressing int is enough."]}),"\n",(0,s.jsx)(n.p,{children:"Both compression options are enabled by default. If the serialized size is not important (for example, you use FlatBuffers for serialization before, which doesn't compress anything), then you should disable compression. If your data are all numbers, the compression may bring 80% performance regression."}),"\n",(0,s.jsx)(n.h3,{id:"int-compression",children:"Int Compression"}),"\n",(0,s.jsx)(n.p,{children:"For int compression, Fory uses 1~5 bytes for encoding. The first bit in every byte indicates whether there is a next byte. If the first bit is set, then the next byte will be read until the first bit of the next byte is unset."}),"\n",(0,s.jsx)(n.h3,{id:"long-compression",children:"Long Compression"}),"\n",(0,s.jsx)(n.p,{children:"For long compression, Fory supports two encodings:"}),"\n",(0,s.jsx)(n.h4,{id:"sli-small-long-as-int-encoding-default",children:"SLI (Small Long as Int) Encoding (Default)"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["If long is in ",(0,s.jsx)(n.code,{children:"[-1073741824, 1073741823]"}),", encode as 4 bytes int: ",(0,s.jsx)(n.code,{children:"| little-endian: ((int) value) << 1 |"})]}),"\n",(0,s.jsxs)(n.li,{children:["Otherwise write as 9 bytes: ",(0,s.jsx)(n.code,{children:"| 0b1 | little-endian 8bytes long |"})]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"pvl-progressive-variable-length-long-encoding",children:"PVL (Progressive Variable-length Long) Encoding"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"First bit in every byte indicates whether there is a next byte. If first bit is set, then next byte will be read until first bit of next byte is unset."}),"\n",(0,s.jsxs)(n.li,{children:["Negative numbers will be converted to positive numbers by ",(0,s.jsx)(n.code,{children:"(v << 1) ^ (v >> 63)"})," to reduce cost of small negative numbers."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["If a number is of ",(0,s.jsx)(n.code,{children:"long"})," type but can't be represented by smaller bytes mostly, the compression won't get good enough results\u2014not worthy compared to performance cost. Maybe you should try to disable long compression if you find it didn't bring much space savings."]}),"\n",(0,s.jsx)(n.h2,{id:"array-compression",children:"Array Compression"}),"\n",(0,s.jsxs)(n.p,{children:["Fory supports SIMD-accelerated compression for primitive arrays (",(0,s.jsx)(n.code,{children:"int[]"})," and ",(0,s.jsx)(n.code,{children:"long[]"}),") when array values can fit in smaller data types. This feature is available on Java 16+ and uses the Vector API for optimal performance."]}),"\n",(0,s.jsx)(n.h3,{id:"how-array-compression-works",children:"How Array Compression Works"}),"\n",(0,s.jsx)(n.p,{children:"Array compression analyzes arrays to determine if values can be stored using fewer bytes:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:[(0,s.jsx)(n.code,{children:"int[]"})," \u2192 ",(0,s.jsx)(n.code,{children:"byte[]"})]}),": When all values are in range [-128, 127] (75% size reduction)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:[(0,s.jsx)(n.code,{children:"int[]"})," \u2192 ",(0,s.jsx)(n.code,{children:"short[]"})]}),": When all values are in range [-32768, 32767] (50% size reduction)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsxs)(n.strong,{children:[(0,s.jsx)(n.code,{children:"long[]"})," \u2192 ",(0,s.jsx)(n.code,{children:"int[]"})]}),": When all values fit in integer range (50% size reduction)"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"configuration-and-registration",children:"Configuration and Registration"}),"\n",(0,s.jsx)(n.p,{children:"To enable array compression, you must explicitly register the serializers:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"Fory fory = Fory.builder()\n  .withLanguage(Language.JAVA)\n  // Enable int array compression\n  .withIntArrayCompressed(true)\n  // Enable long array compression\n  .withLongArrayCompressed(true)\n  .build();\n\n// You must explicitly register compressed array serializers\nCompressedArraySerializers.registerSerializers(fory);\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"}),": The ",(0,s.jsx)(n.code,{children:"fory-simd"})," module must be included in your dependencies for compressed array serializers to be available."]}),"\n",(0,s.jsx)(n.h3,{id:"maven-dependency",children:"Maven Dependency"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<dependency>\n  <groupId>org.apache.fory</groupId>\n  <artifactId>fory-simd</artifactId>\n  <version>0.15.0</version>\n</dependency>\n"})}),"\n",(0,s.jsx)(n.h2,{id:"string-compression",children:"String Compression"}),"\n",(0,s.jsxs)(n.p,{children:["String compression can be enabled via ",(0,s.jsx)(n.code,{children:"ForyBuilder#withStringCompressed(true)"}),". This is disabled by default."]}),"\n",(0,s.jsx)(n.h2,{id:"configuration-summary",children:"Configuration Summary"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Option"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Default"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"compressInt"})}),(0,s.jsx)(n.td,{children:"Enable int compression"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"true"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"compressLong"})}),(0,s.jsx)(n.td,{children:"Enable long compression"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"true"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"compressIntArray"})}),(0,s.jsx)(n.td,{children:"Enable SIMD int array compression (Java 16+)"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"false"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"compressLongArray"})}),(0,s.jsx)(n.td,{children:"Enable SIMD long array compression (Java 16+)"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"false"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"compressString"})}),(0,s.jsx)(n.td,{children:"Enable string compression"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"false"})})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Disable compression for numeric-heavy data"}),": If your data is mostly numbers, compression overhead may not be worth it"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Array compression requires Java 16+"}),": Uses Vector API for SIMD acceleration"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Long compression may not help large values"}),": If most longs can't fit in smaller representations, disable it"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"String compression has overhead"}),": Only enable if strings are highly compressible"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"example-configuration",children:"Example Configuration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"// For mostly numeric data - disable compression\nFory fory = Fory.builder()\n  .withLanguage(Language.JAVA)\n  .withIntCompressed(false)\n  .withLongCompressed(false)\n  .build();\n\n// For mixed data with arrays - enable array compression\nFory fory = Fory.builder()\n  .withLanguage(Language.JAVA)\n  .withIntCompressed(true)\n  .withLongCompressed(true)\n  .withIntArrayCompressed(true)\n  .withLongArrayCompressed(true)\n  .build();\nCompressedArraySerializers.registerSerializers(fory);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"related-topics",children:"Related Topics"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/next/guide/java/configuration",children:"Configuration Options"})," - All ForyBuilder options"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/next/guide/java/advanced_features",children:"Advanced Features"})," - Memory management"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},11151:(e,n,i)=>{i.d(n,{Z:()=>a,a:()=>t});var s=i(67294);const r={},o=s.createContext(r);function t(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);