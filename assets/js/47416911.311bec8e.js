"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[46119],{21952:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>s,default:()=>d,frontMatter:()=>l,metadata:()=>a,toc:()=>c});var r=i(85893),t=i(11151);const l={title:"Custom Serializers",sidebar_position:4,id:"custom_serializers",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},s=void 0,a={id:"guide/java/custom_serializers",title:"Custom Serializers",description:"This page covers how to implement custom serializers for your types.",source:"@site/versioned_docs/version-0.14/guide/java/custom-serializers.md",sourceDirName:"guide/java",slug:"/guide/java/custom_serializers",permalink:"/docs/0.14/guide/java/custom_serializers",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/docs/guide/java/custom-serializers.md",tags:[],version:"0.14",sidebarPosition:4,frontMatter:{title:"Custom Serializers",sidebar_position:4,id:"custom_serializers",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"Type Registration & Security",permalink:"/docs/0.14/guide/java/type_registration"},next:{title:"Schema Evolution",permalink:"/docs/0.14/guide/java/schema_evolution"}},o={},c=[{value:"Basic Custom Serializer",id:"basic-custom-serializer",level:2},{value:"Register the Serializer",id:"register-the-serializer",level:3},{value:"Collection Serializer",id:"collection-serializer",level:2},{value:"supportCodegenHook Parameter",id:"supportcodegenhook-parameter",level:3},{value:"Collection Serializer with JIT Support",id:"collection-serializer-with-jit-support",level:3},{value:"Custom Collection Serializer without JIT",id:"custom-collection-serializer-without-jit",level:3},{value:"Collection-like Type Serializer",id:"collection-like-type-serializer",level:3},{value:"Map Serializer",id:"map-serializer",level:2},{value:"Map Serializer with JIT Support",id:"map-serializer-with-jit-support",level:3},{value:"Custom Map Serializer without JIT",id:"custom-map-serializer-without-jit",level:3},{value:"Map-like Type Serializer",id:"map-like-type-serializer",level:3},{value:"Registering Custom Serializers",id:"registering-custom-serializers",level:2},{value:"Key Points",id:"key-points",level:2},{value:"Related Topics",id:"related-topics",level:2}];function u(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"This page covers how to implement custom serializers for your types."}),"\n",(0,r.jsx)(n.h2,{id:"basic-custom-serializer",children:"Basic Custom Serializer"}),"\n",(0,r.jsxs)(n.p,{children:["In some cases, you may want to implement a serializer for your type, especially for classes that customize serialization using JDK ",(0,r.jsx)(n.code,{children:"writeObject/writeReplace/readObject/readResolve"}),", which is very inefficient."]}),"\n",(0,r.jsxs)(n.p,{children:["For example, if you don't want the following ",(0,r.jsx)(n.code,{children:"Foo#writeObject"})," to be invoked, you can implement a custom serializer:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"class Foo {\n  public long f1;\n\n  private void writeObject(ObjectOutputStream s) throws IOException {\n    System.out.println(f1);\n    s.defaultWriteObject();\n  }\n}\n\nclass FooSerializer extends Serializer<Foo> {\n  public FooSerializer(Fory fory) {\n    super(fory, Foo.class);\n  }\n\n  @Override\n  public void write(MemoryBuffer buffer, Foo value) {\n    buffer.writeInt64(value.f1);\n  }\n\n  @Override\n  public Foo read(MemoryBuffer buffer) {\n    Foo foo = new Foo();\n    foo.f1 = buffer.readInt64();\n    return foo;\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"register-the-serializer",children:"Register the Serializer"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"Fory fory = getFory();\nfory.registerSerializer(Foo.class, new FooSerializer(fory));\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Besides registering serializers, you can also implement ",(0,r.jsx)(n.code,{children:"java.io.Externalizable"})," for a class to customize serialization logic. Such types will be serialized by Fory's ",(0,r.jsx)(n.code,{children:"ExternalizableSerializer"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"collection-serializer",children:"Collection Serializer"}),"\n",(0,r.jsxs)(n.p,{children:["When implementing a serializer for a custom Collection type, you must extend ",(0,r.jsx)(n.code,{children:"CollectionSerializer"})," or ",(0,r.jsx)(n.code,{children:"CollectionLikeSerializer"}),". The key difference is that ",(0,r.jsx)(n.code,{children:"CollectionLikeSerializer"})," can serialize a class which has a collection-like structure but is not a Java Collection subtype."]}),"\n",(0,r.jsx)(n.h3,{id:"supportcodegenhook-parameter",children:"supportCodegenHook Parameter"}),"\n",(0,r.jsx)(n.p,{children:"This special parameter controls serialization behavior:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["When ",(0,r.jsx)(n.code,{children:"true"}),":"]})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Enables optimized access to collection elements and JIT compilation for better performance"}),"\n",(0,r.jsx)(n.li,{children:"Direct serialization invocation and inline for collection items without dynamic serializer dispatch cost"}),"\n",(0,r.jsx)(n.li,{children:"Better performance for standard collection types"}),"\n",(0,r.jsx)(n.li,{children:"Recommended for most collections"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["When ",(0,r.jsx)(n.code,{children:"false"}),":"]})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Uses interface-based element access and dynamic serializer dispatch for elements (higher cost)"}),"\n",(0,r.jsx)(n.li,{children:"More flexible for custom collection types"}),"\n",(0,r.jsx)(n.li,{children:"Required when collection has special serialization needs"}),"\n",(0,r.jsx)(n.li,{children:"Handles complex collection implementations"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"collection-serializer-with-jit-support",children:"Collection Serializer with JIT Support"}),"\n",(0,r.jsx)(n.p,{children:"When implementing a Collection serializer with JIT support, leverage Fory's existing binary format and collection serialization infrastructure:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"public class CustomCollectionSerializer<T extends Collection> extends CollectionSerializer<T> {\n    public CustomCollectionSerializer(Fory fory, Class<T> cls) {\n        // supportCodegenHook controls whether to use JIT compilation\n        super(fory, cls, true);\n    }\n\n    @Override\n    public Collection onCollectionWrite(MemoryBuffer buffer, T value) {\n        // Write collection size\n        buffer.writeVarUint32Small7(value.size());\n        // Write any additional collection metadata\n        return value;\n    }\n\n    @Override\n    public Collection newCollection(MemoryBuffer buffer) {\n        // Create new collection instance\n        Collection collection = super.newCollection(buffer);\n        // Read and set collection size\n        int numElements = getAndClearNumElements();\n        setNumElements(numElements);\n        return collection;\n    }\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Note: Invoke ",(0,r.jsx)(n.code,{children:"setNumElements"})," when implementing ",(0,r.jsx)(n.code,{children:"newCollection"})," to let Fory know how many elements to deserialize."]}),"\n",(0,r.jsx)(n.h3,{id:"custom-collection-serializer-without-jit",children:"Custom Collection Serializer without JIT"}),"\n",(0,r.jsx)(n.p,{children:"For collections that use primitive arrays or have special requirements, implement a serializer with JIT disabled:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"class IntList extends AbstractCollection<Integer> {\n    private final int[] elements;\n    private final int size;\n\n    public IntList(int size) {\n        this.elements = new int[size];\n        this.size = size;\n    }\n\n    public IntList(int[] elements, int size) {\n        this.elements = elements;\n        this.size = size;\n    }\n\n    @Override\n    public Iterator<Integer> iterator() {\n        return new Iterator<Integer>() {\n            private int index = 0;\n\n            @Override\n            public boolean hasNext() {\n                return index < size;\n            }\n\n            @Override\n            public Integer next() {\n                if (!hasNext()) {\n                    throw new NoSuchElementException();\n                }\n                return elements[index++];\n            }\n        };\n    }\n\n    @Override\n    public int size() {\n        return size;\n    }\n\n    public int get(int index) {\n        if (index >= size) {\n            throw new IndexOutOfBoundsException();\n        }\n        return elements[index];\n    }\n\n    public void set(int index, int value) {\n        if (index >= size) {\n            throw new IndexOutOfBoundsException();\n        }\n        elements[index] = value;\n    }\n\n    public int[] getElements() {\n        return elements;\n    }\n}\n\nclass IntListSerializer extends CollectionLikeSerializer<IntList> {\n    public IntListSerializer(Fory fory) {\n        // Disable JIT since we're handling serialization directly\n        super(fory, IntList.class, false);\n    }\n\n    @Override\n    public void write(MemoryBuffer buffer, IntList value) {\n        // Write size\n        buffer.writeVarUint32Small7(value.size());\n\n        // Write elements directly as primitive ints\n        int[] elements = value.getElements();\n        for (int i = 0; i < value.size(); i++) {\n            buffer.writeVarInt32(elements[i]);\n        }\n    }\n\n    @Override\n    public IntList read(MemoryBuffer buffer) {\n        // Read size\n        int size = buffer.readVarUint32Small7();\n\n        // Create array and read elements\n        int[] elements = new int[size];\n        for (int i = 0; i < size; i++) {\n            elements[i] = buffer.readVarInt32();\n        }\n\n        return new IntList(elements, size);\n    }\n\n    // These methods are not used when JIT is disabled\n    @Override\n    public Collection onCollectionWrite(MemoryBuffer buffer, IntList value) {\n        throw new UnsupportedOperationException();\n    }\n\n    @Override\n    public Collection newCollection(MemoryBuffer buffer) {\n        throw new UnsupportedOperationException();\n    }\n\n    @Override\n    public IntList onCollectionRead(Collection collection) {\n        throw new UnsupportedOperationException();\n    }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"When to use this approach:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Working with primitive types"}),"\n",(0,r.jsx)(n.li,{children:"Need maximum performance"}),"\n",(0,r.jsx)(n.li,{children:"Want to minimize memory overhead"}),"\n",(0,r.jsx)(n.li,{children:"Have special serialization requirements"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"collection-like-type-serializer",children:"Collection-like Type Serializer"}),"\n",(0,r.jsx)(n.p,{children:"For types that behave like collections but aren't standard Java Collections:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'class CustomCollectionLike {\n    private final Object[] elements;\n    private final int size;\n\n    public CustomCollectionLike(int size) {\n        this.elements = new Object[size];\n        this.size = 0;\n    }\n\n    public CustomCollectionLike(Object[] elements, int size) {\n        this.elements = elements;\n        this.size = size;\n    }\n\n    public Object get(int index) {\n        if (index >= size) {\n            throw new IndexOutOfBoundsException();\n        }\n        return elements[index];\n    }\n\n    public int size() {\n        return size;\n    }\n\n    public Object[] getElements() {\n        return elements;\n    }\n}\n\nclass CollectionView extends AbstractCollection<Object> {\n    private final Object[] elements;\n    private final int size;\n    private int writeIndex;\n\n    public CollectionView(CustomCollectionLike collection) {\n        this.elements = collection.getElements();\n        this.size = collection.size();\n    }\n\n    public CollectionView(int size) {\n        this.size = size;\n        this.elements = new Object[size];\n    }\n\n    @Override\n    public Iterator<Object> iterator() {\n        return new Iterator<Object>() {\n            private int index = 0;\n\n            @Override\n            public boolean hasNext() {\n                return index < size;\n            }\n\n            @Override\n            public Object next() {\n                if (!hasNext()) {\n                    throw new NoSuchElementException();\n                }\n                return elements[index++];\n            }\n        };\n    }\n\n    @Override\n    public boolean add(Object element) {\n        if (writeIndex >= size) {\n            throw new IllegalStateException("Collection is full");\n        }\n        elements[writeIndex++] = element;\n        return true;\n    }\n\n    @Override\n    public int size() {\n        return size;\n    }\n\n    public Object[] getElements() {\n        return elements;\n    }\n}\n\nclass CustomCollectionSerializer extends CollectionLikeSerializer<CustomCollectionLike> {\n    public CustomCollectionSerializer(Fory fory) {\n        super(fory, CustomCollectionLike.class, true);\n    }\n\n    @Override\n    public Collection onCollectionWrite(MemoryBuffer buffer, CustomCollectionLike value) {\n        buffer.writeVarUint32Small7(value.size());\n        return new CollectionView(value);\n    }\n\n    @Override\n    public Collection newCollection(MemoryBuffer buffer) {\n        int numElements = buffer.readVarUint32Small7();\n        setNumElements(numElements);\n        return new CollectionView(numElements);\n    }\n\n    @Override\n    public CustomCollectionLike onCollectionRead(Collection collection) {\n        CollectionView view = (CollectionView) collection;\n        return new CustomCollectionLike(view.getElements(), view.size());\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"map-serializer",children:"Map Serializer"}),"\n",(0,r.jsxs)(n.p,{children:["When implementing a serializer for a custom Map type, extend ",(0,r.jsx)(n.code,{children:"MapSerializer"})," or ",(0,r.jsx)(n.code,{children:"MapLikeSerializer"}),". The key difference is that ",(0,r.jsx)(n.code,{children:"MapLikeSerializer"})," can serialize a class which has a map-like structure but is not a Java Map subtype."]}),"\n",(0,r.jsx)(n.h3,{id:"map-serializer-with-jit-support",children:"Map Serializer with JIT Support"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"public class CustomMapSerializer<T extends Map> extends MapSerializer<T> {\n    public CustomMapSerializer(Fory fory, Class<T> cls) {\n        // supportCodegenHook is a critical parameter that determines serialization behavior\n        super(fory, cls, true);\n    }\n\n    @Override\n    public Map onMapWrite(MemoryBuffer buffer, T value) {\n        // Write map size\n        buffer.writeVarUint32Small7(value.size());\n        // Write any additional map metadata here\n        return value;\n    }\n\n    @Override\n    public Map newMap(MemoryBuffer buffer) {\n        // Read map size\n        int numElements = buffer.readVarUint32Small7();\n        setNumElements(numElements);\n        // Create and return new map instance\n        T map = (T) new HashMap(numElements);\n        fory.getRefResolver().reference(map);\n        return map;\n    }\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Note: Invoke ",(0,r.jsx)(n.code,{children:"setNumElements"})," when implementing ",(0,r.jsx)(n.code,{children:"newMap"})," to let Fory know how many elements to deserialize."]}),"\n",(0,r.jsx)(n.h3,{id:"custom-map-serializer-without-jit",children:"Custom Map Serializer without JIT"}),"\n",(0,r.jsx)(n.p,{children:"For complete control over the serialization process:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"class FixedValueMap extends AbstractMap<String, Integer> {\n    private final Set<String> keys;\n    private final int fixedValue;\n\n    public FixedValueMap(Set<String> keys, int fixedValue) {\n        this.keys = keys;\n        this.fixedValue = fixedValue;\n    }\n\n    @Override\n    public Set<Entry<String, Integer>> entrySet() {\n        Set<Entry<String, Integer>> entries = new HashSet<>();\n        for (String key : keys) {\n            entries.add(new SimpleEntry<>(key, fixedValue));\n        }\n        return entries;\n    }\n\n    @Override\n    public Integer get(Object key) {\n        return keys.contains(key) ? fixedValue : null;\n    }\n\n    public Set<String> getKeys() {\n        return keys;\n    }\n\n    public int getFixedValue() {\n        return fixedValue;\n    }\n}\n\nclass FixedValueMapSerializer extends MapLikeSerializer<FixedValueMap> {\n    public FixedValueMapSerializer(Fory fory) {\n        // Disable codegen since we're handling serialization directly\n        super(fory, FixedValueMap.class, false);\n    }\n\n    @Override\n    public void write(MemoryBuffer buffer, FixedValueMap value) {\n        // Write the fixed value\n        buffer.writeInt32(value.getFixedValue());\n        // Write the number of keys\n        buffer.writeVarUint32Small7(value.getKeys().size());\n        // Write each key\n        for (String key : value.getKeys()) {\n            buffer.writeString(key);\n        }\n    }\n\n    @Override\n    public FixedValueMap read(MemoryBuffer buffer) {\n        // Read the fixed value\n        int fixedValue = buffer.readInt32();\n        // Read the number of keys\n        int size = buffer.readVarUint32Small7();\n        Set<String> keys = new HashSet<>(size);\n        for (int i = 0; i < size; i++) {\n            keys.add(buffer.readString());\n        }\n        return new FixedValueMap(keys, fixedValue);\n    }\n\n    // These methods are not used when supportCodegenHook is false\n    @Override\n    public Map onMapWrite(MemoryBuffer buffer, FixedValueMap value) {\n        throw new UnsupportedOperationException();\n    }\n\n    @Override\n    public FixedValueMap onMapRead(Map map) {\n        throw new UnsupportedOperationException();\n    }\n\n    @Override\n    public FixedValueMap onMapCopy(Map map) {\n        throw new UnsupportedOperationException();\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"map-like-type-serializer",children:"Map-like Type Serializer"}),"\n",(0,r.jsx)(n.p,{children:"For types that behave like maps but aren't standard Java Maps:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'class CustomMapLike {\n    private final Object[] keyArray;\n    private final Object[] valueArray;\n    private final int size;\n\n    public CustomMapLike(int initialCapacity) {\n        this.keyArray = new Object[initialCapacity];\n        this.valueArray = new Object[initialCapacity];\n        this.size = 0;\n    }\n\n    public CustomMapLike(Object[] keyArray, Object[] valueArray, int size) {\n        this.keyArray = keyArray;\n        this.valueArray = valueArray;\n        this.size = size;\n    }\n\n    public Integer get(String key) {\n        for (int i = 0; i < size; i++) {\n            if (key.equals(keyArray[i])) {\n                return (Integer) valueArray[i];\n            }\n        }\n        return null;\n    }\n\n    public int size() {\n        return size;\n    }\n\n    public Object[] getKeyArray() {\n        return keyArray;\n    }\n\n    public Object[] getValueArray() {\n        return valueArray;\n    }\n}\n\nclass MapView extends AbstractMap<Object, Object> {\n    private final Object[] keyArray;\n    private final Object[] valueArray;\n    private final int size;\n    private int writeIndex;\n\n    public MapView(CustomMapLike mapLike) {\n        this.size = mapLike.size();\n        this.keyArray = mapLike.getKeyArray();\n        this.valueArray = mapLike.getValueArray();\n    }\n\n    public MapView(int size) {\n        this.size = size;\n        this.keyArray = new Object[size];\n        this.valueArray = new Object[size];\n    }\n\n    @Override\n    public Set<Entry<Object, Object>> entrySet() {\n        return new AbstractSet<Entry<Object, Object>>() {\n            @Override\n            public Iterator<Entry<Object, Object>> iterator() {\n                return new Iterator<Entry<Object, Object>>() {\n                    private int index = 0;\n\n                    @Override\n                    public boolean hasNext() {\n                        return index < size;\n                    }\n\n                    @Override\n                    public Entry<Object, Object> next() {\n                        if (!hasNext()) {\n                            throw new NoSuchElementException();\n                        }\n                        final int currentIndex = index++;\n                        return new SimpleEntry<>(\n                            keyArray[currentIndex],\n                            valueArray[currentIndex]\n                        );\n                    }\n                };\n            }\n\n            @Override\n            public int size() {\n                return size;\n            }\n        };\n    }\n\n    @Override\n    public Object put(Object key, Object value) {\n        if (writeIndex >= size) {\n            throw new IllegalStateException("Map is full");\n        }\n        keyArray[writeIndex] = key;\n        valueArray[writeIndex] = value;\n        writeIndex++;\n        return null;\n    }\n\n    public Object[] getKeyArray() {\n        return keyArray;\n    }\n\n    public Object[] getValueArray() {\n        return valueArray;\n    }\n\n    public int size() {\n        return size;\n    }\n}\n\nclass CustomMapLikeSerializer extends MapLikeSerializer<CustomMapLike> {\n    public CustomMapLikeSerializer(Fory fory) {\n        super(fory, CustomMapLike.class, true);\n    }\n\n    @Override\n    public Map onMapWrite(MemoryBuffer buffer, CustomMapLike value) {\n        buffer.writeVarUint32Small7(value.size());\n        return new MapView(value);\n    }\n\n    @Override\n    public Map newMap(MemoryBuffer buffer) {\n        int numElements = buffer.readVarUint32Small7();\n        setNumElements(numElements);\n        return new MapView(numElements);\n    }\n\n    @Override\n    public CustomMapLike onMapRead(Map map) {\n        MapView view = (MapView) map;\n        return new CustomMapLike(view.getKeyArray(), view.getValueArray(), view.size());\n    }\n\n    @Override\n    public CustomMapLike onMapCopy(Map map) {\n        MapView view = (MapView) map;\n        return new CustomMapLike(view.getKeyArray(), view.getValueArray(), view.size());\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"registering-custom-serializers",children:"Registering Custom Serializers"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"Fory fory = Fory.builder()\n    .withLanguage(Language.JAVA)\n    .build();\n\n// Register map serializer\nfory.registerSerializer(CustomMap.class, new CustomMapSerializer<>(fory, CustomMap.class));\n\n// Register collection serializer\nfory.registerSerializer(CustomCollection.class, new CustomCollectionSerializer<>(fory, CustomCollection.class));\n"})}),"\n",(0,r.jsx)(n.h2,{id:"key-points",children:"Key Points"}),"\n",(0,r.jsx)(n.p,{children:"When implementing custom map or collection serializers:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Always extend the appropriate base class (",(0,r.jsx)(n.code,{children:"MapSerializer"}),"/",(0,r.jsx)(n.code,{children:"MapLikeSerializer"})," for maps, ",(0,r.jsx)(n.code,{children:"CollectionSerializer"}),"/",(0,r.jsx)(n.code,{children:"CollectionLikeSerializer"})," for collections)"]}),"\n",(0,r.jsxs)(n.li,{children:["Consider the impact of ",(0,r.jsx)(n.code,{children:"supportCodegenHook"})," on performance and functionality"]}),"\n",(0,r.jsx)(n.li,{children:"Properly handle reference tracking if needed"}),"\n",(0,r.jsxs)(n.li,{children:["Implement proper size management using ",(0,r.jsx)(n.code,{children:"setNumElements"})," and ",(0,r.jsx)(n.code,{children:"getAndClearNumElements"})," when ",(0,r.jsx)(n.code,{children:"supportCodegenHook"})," is ",(0,r.jsx)(n.code,{children:"true"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"related-topics",children:"Related Topics"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/0.14/guide/java/type_registration",children:"Type Registration"})," - Register serializers"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/0.14/guide/java/schema_evolution",children:"Schema Evolution"})," - Compatible mode considerations"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/0.14/guide/java/configuration",children:"Configuration Options"})," - Serialization options"]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},11151:(e,n,i)=>{i.d(n,{Z:()=>a,a:()=>s});var r=i(67294);const t={},l=r.createContext(t);function s(e){const n=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);