"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[52198],{65930:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>a,contentTitle:()=>l,default:()=>o,frontMatter:()=>t,metadata:()=>d,toc:()=>c});var s=n(85893),r=n(11151);const t={title:"Row Format",sidebar_position:2,id:"row_format_spec",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},l=void 0,d={id:"specification/row_format_spec",title:"Row Format",description:"Overview",source:"@site/docs/specification/row_format_spec.md",sourceDirName:"specification",slug:"/specification/row_format_spec",permalink:"/docs/next/specification/row_format_spec",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/docs/specification/row_format_spec.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Row Format",sidebar_position:2,id:"row_format_spec",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"specificationSidebar",previous:{title:"Java Serialization Format",permalink:"/docs/next/specification/java_serialization_spec"},next:{title:"Xlang Type Mapping",permalink:"/docs/next/specification/xlang_type_mapping"}},a={},c=[{value:"Overview",id:"overview",level:2},{value:"Format Comparison",id:"format-comparison",level:2},{value:"Standard Row Format",id:"standard-row-format",level:2},{value:"Design Principles",id:"design-principles",level:3},{value:"Row Binary Layout",id:"row-binary-layout",level:3},{value:"Null Bitmap",id:"null-bitmap",level:4},{value:"Field Slots",id:"field-slots",level:4},{value:"Variable-Width Data Encoding",id:"variable-width-data-encoding",level:4},{value:"Variable Data Region",id:"variable-data-region",level:4},{value:"Array Binary Layout",id:"array-binary-layout",level:3},{value:"Array Header",id:"array-header",level:4},{value:"Array Element Data",id:"array-element-data",level:4},{value:"Array Element Sizes",id:"array-element-sizes",level:4},{value:"Map Binary Layout",id:"map-binary-layout",level:3},{value:"Map Structure",id:"map-structure",level:4},{value:"Nested Struct Layout",id:"nested-struct-layout",level:3},{value:"Compact Row Format (Java Only)",id:"compact-row-format-java-only",level:2},{value:"Design Principles",id:"design-principles-1",level:3},{value:"Compact Row Binary Layout",id:"compact-row-binary-layout",level:3},{value:"Key Differences from Standard Format",id:"key-differences-from-standard-format",level:4},{value:"Null Bitmap (Compact)",id:"null-bitmap-compact",level:4},{value:"Field Sorting Algorithm",id:"field-sorting-algorithm",level:4},{value:"Fixed-Size Struct Inlining",id:"fixed-size-struct-inlining",level:4},{value:"Fixed-Width Calculation",id:"fixed-width-calculation",level:4},{value:"Compact Array Binary Layout",id:"compact-array-binary-layout",level:3},{value:"Compact Array Header",id:"compact-array-header",level:4},{value:"Key Differences from Standard Array",id:"key-differences-from-standard-array",level:4},{value:"Common Specifications",id:"common-specifications",level:2},{value:"Type Encoding",id:"type-encoding",level:3},{value:"Primitive Types",id:"primitive-types",level:4},{value:"Temporal Types",id:"temporal-types",level:4},{value:"String and Binary",id:"string-and-binary",level:4},{value:"Null Handling",id:"null-handling",level:3},{value:"Row Null Handling",id:"row-null-handling",level:4},{value:"Array Null Handling",id:"array-null-handling",level:4},{value:"Variable-Width Null Semantics",id:"variable-width-null-semantics",level:4},{value:"Alignment and Padding",id:"alignment-and-padding",level:3},{value:"Standard Format Alignment",id:"standard-format-alignment",level:4},{value:"Compact Format Alignment",id:"compact-format-alignment",level:4},{value:"Padding Bytes",id:"padding-bytes",level:4},{value:"Size Calculations",id:"size-calculations",level:2},{value:"Standard Row Size",id:"standard-row-size",level:3},{value:"Compact Row Size",id:"compact-row-size",level:3},{value:"Standard Array Size",id:"standard-array-size",level:3},{value:"Compact Array Size",id:"compact-array-size",level:3},{value:"Map Size",id:"map-size",level:3},{value:"Summary Tables",id:"summary-tables",level:2},{value:"Layout Summary",id:"layout-summary",level:3},{value:"Type Width Summary",id:"type-width-summary",level:3},{value:"Implementation Notes",id:"implementation-notes",level:2},{value:"Endianness",id:"endianness",level:3},{value:"Memory Safety",id:"memory-safety",level:3},{value:"Performance Considerations",id:"performance-considerations",level:3},{value:"When to Use Each Format",id:"when-to-use-each-format",level:3}];function h(e){const i={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(i.p,{children:"Apache Fory Row Format is a cache-friendly, random-access binary format designed for high-performance data processing. Unlike traditional serialization formats that require full deserialization, the row format enables:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Random Field Access"}),": Read individual fields without deserializing the entire row"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Zero-Copy Operations"}),": Direct memory access without data transformation"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Cache-Friendly Layout"}),": Optimized memory layout for CPU cache efficiency"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Cross-Language Support"}),": Consistent binary format across Java, C++, and Python"]}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Fory provides two row format variants:"}),"\n",(0,s.jsxs)(i.table,{children:[(0,s.jsx)(i.thead,{children:(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.th,{children:"Format"}),(0,s.jsx)(i.th,{children:"Languages"}),(0,s.jsx)(i.th,{children:"Use Case"})]})}),(0,s.jsxs)(i.tbody,{children:[(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Standard Format"}),(0,s.jsx)(i.td,{children:"Java, C++, Python"}),(0,s.jsx)(i.td,{children:"Cross-language compatibility"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Compact Format"}),(0,s.jsx)(i.td,{children:"Java only"}),(0,s.jsx)(i.td,{children:"Space efficiency, smaller rows"})]})]})]}),"\n",(0,s.jsx)(i.h2,{id:"format-comparison",children:"Format Comparison"}),"\n",(0,s.jsxs)(i.table,{children:[(0,s.jsx)(i.thead,{children:(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.th,{children:"Feature"}),(0,s.jsx)(i.th,{children:"Standard Format"}),(0,s.jsx)(i.th,{children:"Compact Format"})]})}),(0,s.jsxs)(i.tbody,{children:[(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Field Slot Size"}),(0,s.jsx)(i.td,{children:"Fixed 8 bytes"}),(0,s.jsx)(i.td,{children:"Natural width (1, 2, 4, or 8 bytes)"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Null Bitmap Size"}),(0,s.jsx)(i.td,{children:"8-byte aligned"}),(0,s.jsx)(i.td,{children:"Byte-aligned, can borrow padding"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Null Bitmap Position"}),(0,s.jsx)(i.td,{children:"Before field slots"}),(0,s.jsx)(i.td,{children:"After field slots (at end)"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Fixed-Size Structs"}),(0,s.jsx)(i.td,{children:"Variable region (offset+size)"}),(0,s.jsx)(i.td,{children:"Inline in fixed region"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Field Ordering"}),(0,s.jsx)(i.td,{children:"Schema-defined order"}),(0,s.jsx)(i.td,{children:"Sorted by alignment"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"All Non-Nullable"}),(0,s.jsx)(i.td,{children:"Bitmap still present"}),(0,s.jsx)(i.td,{children:"Bitmap skipped entirely"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Alignment"}),(0,s.jsx)(i.td,{children:"Strict 8-byte"}),(0,s.jsx)(i.td,{children:"Relaxed (2, 4, or 8-byte)"})]})]})]}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h2,{id:"standard-row-format",children:"Standard Row Format"}),"\n",(0,s.jsx)(i.p,{children:"The standard format prioritizes cross-language compatibility and simplicity with uniform 8-byte field slots."}),"\n",(0,s.jsx)(i.h3,{id:"design-principles",children:"Design Principles"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"8-Byte Alignment"}),": All major structures are aligned to 8-byte boundaries for optimal memory access"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Fixed-Width Field Slots"}),": Every field uses an 8-byte slot for uniform offset calculation"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Null Bitmap"}),": Compact null tracking using bit vectors"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Relative Offsets"}),": Variable-length data uses relative offsets for sub-buffer navigation"]}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"row-binary-layout",children:"Row Binary Layout"}),"\n",(0,s.jsx)(i.p,{children:"A row stores structured data with the following layout:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"+----------------+------------------+------------------+-----+------------------+------------------+\n|  Null Bitmap   |  Field 0 Slot    |  Field 1 Slot    | ... |  Field N-1 Slot  |  Variable Data   |\n+----------------+------------------+------------------+-----+------------------+------------------+\n|  B bytes       |     8 bytes      |     8 bytes      |     |     8 bytes      |  Variable size   |\n"})}),"\n",(0,s.jsx)(i.h4,{id:"null-bitmap",children:"Null Bitmap"}),"\n",(0,s.jsx)(i.p,{children:"The null bitmap tracks which fields contain null values:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Size"}),": ",(0,s.jsx)(i.code,{children:"((num_fields + 63) / 64) * 8"})," bytes (rounded up to nearest 8-byte word)"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Encoding"}),": Each bit corresponds to a field index","\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:["Bit value ",(0,s.jsx)(i.code,{children:"1"})," = field is null"]}),"\n",(0,s.jsxs)(i.li,{children:["Bit value ",(0,s.jsx)(i.code,{children:"0"})," = field is not null"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Bit Order"}),": Bit 0 of the first byte corresponds to field 0"]}),"\n"]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Example"}),": For 10 fields, bitmap size = ",(0,s.jsx)(i.code,{children:"((10 + 63) / 64) * 8 = 8"})," bytes"]}),"\n",(0,s.jsx)(i.h4,{id:"field-slots",children:"Field Slots"}),"\n",(0,s.jsx)(i.p,{children:"Each field occupies a fixed 8-byte slot regardless of its actual data type:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Slot Offset"}),": ",(0,s.jsx)(i.code,{children:"bitmap_size + field_index * 8"})]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Total Fixed Region"}),": ",(0,s.jsx)(i.code,{children:"bitmap_size + num_fields * 8"})," bytes"]}),"\n"]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Field Slot Contents by Type"}),":"]}),"\n",(0,s.jsxs)(i.table,{children:[(0,s.jsx)(i.thead,{children:(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.th,{children:"Type Category"}),(0,s.jsx)(i.th,{children:"Slot Contents"})]})}),(0,s.jsxs)(i.tbody,{children:[(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Fixed-width"}),(0,s.jsx)(i.td,{children:"Value stored directly (zero-padded)"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Variable-width"}),(0,s.jsx)(i.td,{children:"Offset + Size encoding (see below)"})]})]})]}),"\n",(0,s.jsx)(i.h4,{id:"variable-width-data-encoding",children:"Variable-Width Data Encoding"}),"\n",(0,s.jsx)(i.p,{children:"Variable-length fields (strings, arrays, maps, nested structs) store an offset-size pair in their slot:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"+---------------------------+---------------------------+\n|    Relative Offset        |         Size              |\n|       (32 bits)           |       (32 bits)           |\n+---------------------------+---------------------------+\n|<-------------- 64-bit field slot value --------------\x3e|\n"})}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Relative Offset"})," (upper 32 bits): Offset from the row's base address"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Size"})," (lower 32 bits): Size of the variable-width data in bytes"]}),"\n"]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Encoding"}),":"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"offset_and_size = (relative_offset << 32) | size\n"})}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Decoding"}),":"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"relative_offset = (offset_and_size >> 32) & 0xFFFFFFFF\nsize = offset_and_size & 0xFFFFFFFF\n"})}),"\n",(0,s.jsx)(i.h4,{id:"variable-data-region",children:"Variable Data Region"}),"\n",(0,s.jsx)(i.p,{children:"Variable-length data is stored after the fixed region:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Data is written sequentially as fields are set"}),"\n",(0,s.jsx)(i.li,{children:"Each variable-length value is padded to 8-byte alignment"}),"\n",(0,s.jsx)(i.li,{children:"Padding bytes are zeroed for deterministic output"}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"array-binary-layout",children:"Array Binary Layout"}),"\n",(0,s.jsx)(i.p,{children:"Arrays store homogeneous sequences of elements:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"+------------------+------------------+------------------+\n|  Element Count   |   Null Bitmap    |   Element Data   |\n+------------------+------------------+------------------+\n|     8 bytes      |     B bytes      |   Variable size  |\n"})}),"\n",(0,s.jsx)(i.h4,{id:"array-header",children:"Array Header"}),"\n",(0,s.jsxs)(i.table,{children:[(0,s.jsx)(i.thead,{children:(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.th,{children:"Field"}),(0,s.jsx)(i.th,{children:"Size"}),(0,s.jsx)(i.th,{children:"Description"})]})}),(0,s.jsxs)(i.tbody,{children:[(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Element Count"}),(0,s.jsx)(i.td,{children:"8 bytes"}),(0,s.jsx)(i.td,{children:"Number of elements (uint64)"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Null Bitmap"}),(0,s.jsxs)(i.td,{children:[(0,s.jsx)(i.code,{children:"((count + 63) / 64) * 8"})," bytes"]}),(0,s.jsx)(i.td,{children:"Per-element null flags"})]})]})]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Header Size"}),": ",(0,s.jsx)(i.code,{children:"8 + ((num_elements + 63) / 64) * 8"})," bytes"]}),"\n",(0,s.jsx)(i.h4,{id:"array-element-data",children:"Array Element Data"}),"\n",(0,s.jsx)(i.p,{children:"Elements are stored contiguously after the header:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Fixed-width elements"}),": Stored with their natural width (1, 2, 4, or 8 bytes)"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Variable-width elements"}),": Stored as 8-byte offset+size pairs"]}),"\n"]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Element Offset"}),": ",(0,s.jsx)(i.code,{children:"header_size + element_index * element_size"})]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Data Region Size"}),": Rounded up to nearest 8-byte boundary"]}),"\n",(0,s.jsx)(i.h4,{id:"array-element-sizes",children:"Array Element Sizes"}),"\n",(0,s.jsxs)(i.table,{children:[(0,s.jsx)(i.thead,{children:(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.th,{children:"Element Type"}),(0,s.jsx)(i.th,{children:"Element Size"})]})}),(0,s.jsxs)(i.tbody,{children:[(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"bool"}),(0,s.jsx)(i.td,{children:"1 byte"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"int8"}),(0,s.jsx)(i.td,{children:"1 byte"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"int16"}),(0,s.jsx)(i.td,{children:"2 bytes"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"int32"}),(0,s.jsx)(i.td,{children:"4 bytes"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"int64"}),(0,s.jsx)(i.td,{children:"8 bytes"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"float32"}),(0,s.jsx)(i.td,{children:"4 bytes"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"float64"}),(0,s.jsx)(i.td,{children:"8 bytes"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"string/binary"}),(0,s.jsx)(i.td,{children:"8 bytes (offset+size)"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"array/map/struct"}),(0,s.jsx)(i.td,{children:"8 bytes (offset+size)"})]})]})]}),"\n",(0,s.jsx)(i.h3,{id:"map-binary-layout",children:"Map Binary Layout"}),"\n",(0,s.jsx)(i.p,{children:"Maps store key-value pairs as two separate arrays:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"+------------------+------------------+------------------+\n|  Keys Array Size |   Keys Array     |   Values Array   |\n+------------------+------------------+------------------+\n|     8 bytes      |   Variable size  |   Variable size  |\n"})}),"\n",(0,s.jsx)(i.h4,{id:"map-structure",children:"Map Structure"}),"\n",(0,s.jsxs)(i.table,{children:[(0,s.jsx)(i.thead,{children:(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.th,{children:"Field"}),(0,s.jsx)(i.th,{children:"Size"}),(0,s.jsx)(i.th,{children:"Description"})]})}),(0,s.jsxs)(i.tbody,{children:[(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Keys Array Size"}),(0,s.jsx)(i.td,{children:"8 bytes"}),(0,s.jsx)(i.td,{children:"Total size of keys array in bytes"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Keys Array"}),(0,s.jsx)(i.td,{children:"Variable"}),(0,s.jsx)(i.td,{children:"Full array structure for keys"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Values Array"}),(0,s.jsx)(i.td,{children:"Variable"}),(0,s.jsx)(i.td,{children:"Full array structure for values"})]})]})]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Keys Array Offset"}),": ",(0,s.jsx)(i.code,{children:"base_offset + 8"}),"\n",(0,s.jsx)(i.strong,{children:"Values Array Offset"}),": ",(0,s.jsx)(i.code,{children:"base_offset + 8 + keys_array_size"})]}),"\n",(0,s.jsx)(i.p,{children:"Both keys and values arrays follow the standard array binary layout."}),"\n",(0,s.jsx)(i.h3,{id:"nested-struct-layout",children:"Nested Struct Layout"}),"\n",(0,s.jsx)(i.p,{children:"Nested structs are stored as complete row structures within the variable data region:"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsx)(i.li,{children:"Parent field slot contains offset+size pointing to nested row"}),"\n",(0,s.jsx)(i.li,{children:"Nested row has its own null bitmap and field slots"}),"\n",(0,s.jsx)(i.li,{children:"Supports arbitrary nesting depth"}),"\n"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"Parent Row:\n+----------------+------------------+------------------+\n|  Null Bitmap   |  ... Slots ...   |  Nested Row Data |\n+----------------+------------------+------------------+\n                        |                    ^\n                        |  offset+size       |\n                        +-------------------\x3e+\n\nNested Row:\n+----------------+------------------+------------------+\n|  Null Bitmap   |  Field Slots     |  Variable Data   |\n+----------------+------------------+------------------+\n"})}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h2,{id:"compact-row-format-java-only",children:"Compact Row Format (Java Only)"}),"\n",(0,s.jsx)(i.p,{children:"The compact format provides space-efficient encoding with additional optimizations. It is currently implemented in Java only."}),"\n",(0,s.jsxs)(i.blockquote,{children:["\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Note"}),": The compact format is still under development and may not be stable yet."]}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"design-principles-1",children:"Design Principles"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Natural Width Storage"}),": Fixed-size fields use their natural byte width instead of 8 bytes"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Alignment-Based Field Sorting"}),": Fields are sorted by alignment requirements to minimize padding"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Conditional Null Bitmap"}),": Null bitmap is omitted when all fields are non-nullable"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Inline Fixed-Size Structs"}),": Nested structs with all fixed-size fields are stored inline"]}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"compact-row-binary-layout",children:"Compact Row Binary Layout"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"+------------------+------------------+-----+------------------+----------------+------------------+\n|  Field 0 Value   |  Field 1 Value   | ... |  Field N-1 Value | Null Bitmap    |  Variable Data   |\n+------------------+------------------+-----+------------------+----------------+------------------+\n|  W0 bytes        |  W1 bytes        |     |  WN-1 bytes      | B bytes (opt)  |  Variable size   |\n"})}),"\n",(0,s.jsx)(i.h4,{id:"key-differences-from-standard-format",children:"Key Differences from Standard Format"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Field Slot Sizes"}),": Each field uses its natural width (Wi = type width or 8 for variable)"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Null Bitmap Position"}),": Placed after field slots, can borrow alignment padding"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Field Order"}),": Fields are sorted by alignment (8-byte \u2192 4-byte \u2192 2-byte \u2192 1-byte \u2192 variable)"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Conditional Bitmap"}),": Skipped entirely if all fields are non-nullable"]}),"\n"]}),"\n",(0,s.jsx)(i.h4,{id:"null-bitmap-compact",children:"Null Bitmap (Compact)"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Size"}),": ",(0,s.jsx)(i.code,{children:"(num_nullable_fields + 7) / 8"})," bytes (byte-aligned, not 8-byte aligned)"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Skipped"}),": When all fields are primitive/non-nullable"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Position"}),": After all fixed-size field slots, can use alignment padding space"]}),"\n"]}),"\n",(0,s.jsx)(i.h4,{id:"field-sorting-algorithm",children:"Field Sorting Algorithm"}),"\n",(0,s.jsx)(i.p,{children:"Fields are sorted to minimize padding and optimize alignment:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"Priority order (highest to lowest):\n1. Fields with 8-byte alignment (int64, float64, variable-width)\n2. Fields with 4-byte alignment (int32, float32)\n3. Fields with 2-byte alignment (int16)\n4. Fields with 1-byte alignment (int8, bool)\n"})}),"\n",(0,s.jsx)(i.p,{children:"Within each alignment group, larger fields come first."}),"\n",(0,s.jsx)(i.h4,{id:"fixed-size-struct-inlining",children:"Fixed-Size Struct Inlining"}),"\n",(0,s.jsx)(i.p,{children:"Nested structs with all fixed-size fields are stored inline in the parent row:"}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Standard Format"})," (nested struct with 2 int32 fields):"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"Parent slot: [offset (4 bytes) | size (4 bytes)]  \u2192 Points to nested row (8+ bytes elsewhere)\n"})}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Compact Format"})," (same nested struct):"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"Parent slot: [int32 field 0 | int32 field 1]  \u2192 8 bytes total, inline\n"})}),"\n",(0,s.jsx)(i.p,{children:"This eliminates the offset+size indirection for fixed-size nested structures."}),"\n",(0,s.jsx)(i.h4,{id:"fixed-width-calculation",children:"Fixed-Width Calculation"}),"\n",(0,s.jsx)(i.p,{children:"A field's fixed width is determined recursively:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Primitive types"}),": Natural byte width (1, 2, 4, or 8)"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Struct types"}),": Sum of all child fixed widths (if all children are fixed-width)"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Variable types"})," (string, array, map): Returns -1 (uses 8-byte offset+size slot)"]}),"\n"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"fixed_width(field) =\n  if primitive: type_width\n  if struct and all_children_fixed: header_bytes + sum(fixed_width(child) for each child)\n  else: -1 (variable, uses 8-byte slot)\n"})}),"\n",(0,s.jsx)(i.h3,{id:"compact-array-binary-layout",children:"Compact Array Binary Layout"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"+------------------+------------------+------------------+\n|  Element Count   |   Null Bitmap    |   Element Data   |\n+------------------+------------------+------------------+\n|     4 bytes      | B bytes (opt)    |   Variable size  |\n"})}),"\n",(0,s.jsx)(i.h4,{id:"compact-array-header",children:"Compact Array Header"}),"\n",(0,s.jsxs)(i.table,{children:[(0,s.jsx)(i.thead,{children:(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.th,{children:"Field"}),(0,s.jsx)(i.th,{children:"Size"}),(0,s.jsx)(i.th,{children:"Description"})]})}),(0,s.jsxs)(i.tbody,{children:[(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Element Count"}),(0,s.jsx)(i.td,{children:"4 bytes"}),(0,s.jsx)(i.td,{children:"Number of elements (int32)"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Null Bitmap"}),(0,s.jsxs)(i.td,{children:[(0,s.jsx)(i.code,{children:"(count + 7) / 8"})," bytes (opt)"]}),(0,s.jsx)(i.td,{children:"Per-element null flags"})]})]})]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Header Size Calculation"}),":"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"header_size = 4 + (element_nullable ? (num_elements + 7) / 8 : 0)\n\n// Round to 8-byte boundary only if element width is 8-byte aligned\nif (fixed_width % 8 == 0):\n    header_size = round_to_8_bytes(header_size)\n"})}),"\n",(0,s.jsx)(i.h4,{id:"key-differences-from-standard-array",children:"Key Differences from Standard Array"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Element Count"}),": 4 bytes instead of 8 bytes"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Null Bitmap"}),": Byte-aligned, skipped if elements are non-nullable"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Fixed-Size Structs"}),": Inline storage for fixed-width struct elements"]}),"\n"]}),"\n",(0,s.jsx)(i.hr,{}),"\n",(0,s.jsx)(i.h2,{id:"common-specifications",children:"Common Specifications"}),"\n",(0,s.jsx)(i.p,{children:"The following specifications apply to both standard and compact formats."}),"\n",(0,s.jsx)(i.h3,{id:"type-encoding",children:"Type Encoding"}),"\n",(0,s.jsx)(i.h4,{id:"primitive-types",children:"Primitive Types"}),"\n",(0,s.jsxs)(i.table,{children:[(0,s.jsx)(i.thead,{children:(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.th,{children:"Type"}),(0,s.jsx)(i.th,{children:"Width"}),(0,s.jsx)(i.th,{children:"Encoding"})]})}),(0,s.jsxs)(i.tbody,{children:[(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"bool"}),(0,s.jsx)(i.td,{children:"1 byte"}),(0,s.jsxs)(i.td,{children:[(0,s.jsx)(i.code,{children:"0x00"})," (false) or ",(0,s.jsx)(i.code,{children:"0x01"})," (true)"]})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"int8"}),(0,s.jsx)(i.td,{children:"1 byte"}),(0,s.jsx)(i.td,{children:"Two's complement"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"int16"}),(0,s.jsx)(i.td,{children:"2 bytes"}),(0,s.jsx)(i.td,{children:"Two's complement, little-endian"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"int32"}),(0,s.jsx)(i.td,{children:"4 bytes"}),(0,s.jsx)(i.td,{children:"Two's complement, little-endian"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"int64"}),(0,s.jsx)(i.td,{children:"8 bytes"}),(0,s.jsx)(i.td,{children:"Two's complement, little-endian"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"float32"}),(0,s.jsx)(i.td,{children:"4 bytes"}),(0,s.jsx)(i.td,{children:"IEEE 754 single precision"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"float64"}),(0,s.jsx)(i.td,{children:"8 bytes"}),(0,s.jsx)(i.td,{children:"IEEE 754 double precision"})]})]})]}),"\n",(0,s.jsx)(i.h4,{id:"temporal-types",children:"Temporal Types"}),"\n",(0,s.jsxs)(i.table,{children:[(0,s.jsx)(i.thead,{children:(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.th,{children:"Type"}),(0,s.jsx)(i.th,{children:"Width"}),(0,s.jsx)(i.th,{children:"Encoding"})]})}),(0,s.jsxs)(i.tbody,{children:[(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"timestamp"}),(0,s.jsx)(i.td,{children:"8 bytes"}),(0,s.jsx)(i.td,{children:"Microseconds since Unix epoch (int64)"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"date32"}),(0,s.jsx)(i.td,{children:"4 bytes"}),(0,s.jsx)(i.td,{children:"Days since Unix epoch (int32)"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"duration"}),(0,s.jsx)(i.td,{children:"8 bytes"}),(0,s.jsx)(i.td,{children:"Duration in microseconds (int64)"})]})]})]}),"\n",(0,s.jsx)(i.h4,{id:"string-and-binary",children:"String and Binary"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Encoding"}),": UTF-8 for strings, raw bytes for binary"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Storage"}),": Offset+size pair in field slot, data in variable region"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Padding"}),": Data padded to 8-byte alignment (standard) or natural alignment (compact)"]}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"null-handling",children:"Null Handling"}),"\n",(0,s.jsx)(i.h4,{id:"row-null-handling",children:"Row Null Handling"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Null fields have their corresponding bit set to 1 in the null bitmap"}),"\n",(0,s.jsx)(i.li,{children:"Field slot contents are undefined for null fields (standard) or zeroed (compact)"}),"\n",(0,s.jsx)(i.li,{children:"Reading a null field returns a null/empty value indicator"}),"\n"]}),"\n",(0,s.jsx)(i.h4,{id:"array-null-handling",children:"Array Null Handling"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Null elements have their corresponding bit set to 1 in the array's null bitmap"}),"\n",(0,s.jsx)(i.li,{children:"Element data is undefined for null elements"}),"\n",(0,s.jsx)(i.li,{children:"Compact format: Bitmap skipped if elements are non-nullable"}),"\n"]}),"\n",(0,s.jsx)(i.h4,{id:"variable-width-null-semantics",children:"Variable-Width Null Semantics"}),"\n",(0,s.jsx)(i.p,{children:"When reading variable-width data from a null field:"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Returns size of -1 or equivalent null indicator"}),"\n",(0,s.jsx)(i.li,{children:"No data access is performed"}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"alignment-and-padding",children:"Alignment and Padding"}),"\n",(0,s.jsx)(i.h4,{id:"standard-format-alignment",children:"Standard Format Alignment"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Null Bitmap"}),": Size rounded to 8-byte boundary"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Field Slots"}),": Always 8 bytes each"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Variable Data"}),": Each value padded to 8-byte boundary"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Array Data"}),": Total data region padded to 8-byte boundary"]}),"\n"]}),"\n",(0,s.jsx)(i.h4,{id:"compact-format-alignment",children:"Compact Format Alignment"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Field Slots"}),": Natural width (1, 2, 4, or 8 bytes)"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Null Bitmap"}),": Byte-aligned, placed after fields"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Variable Data"}),": Padded to 8-byte boundary only when needed"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Header"}),": May use relaxed alignment for smaller overhead"]}),"\n"]}),"\n",(0,s.jsx)(i.h4,{id:"padding-bytes",children:"Padding Bytes"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"All padding bytes must be set to zero"}),"\n",(0,s.jsx)(i.li,{children:"Ensures deterministic serialization output"}),"\n",(0,s.jsx)(i.li,{children:"Prevents information leakage from uninitialized memory"}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"size-calculations",children:"Size Calculations"}),"\n",(0,s.jsx)(i.h3,{id:"standard-row-size",children:"Standard Row Size"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"row_size = bitmap_size + num_fields * 8 + variable_data_size\n\nwhere:\n  bitmap_size = ((num_fields + 63) / 64) * 8\n  variable_data_size = sum of (padded_size for each variable field)\n  padded_size = ((size + 7) / 8) * 8\n"})}),"\n",(0,s.jsx)(i.h3,{id:"compact-row-size",children:"Compact Row Size"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"row_size = fixed_region_size + bitmap_size + variable_data_size\n\nwhere:\n  fixed_region_size = sum of (fixed_width(field) or 8 for each field)\n  bitmap_size = all_non_nullable ? 0 : (num_nullable_fields + 7) / 8\n  // May be rounded to 8-byte boundary if has variable fields\n"})}),"\n",(0,s.jsx)(i.h3,{id:"standard-array-size",children:"Standard Array Size"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"array_size = header_size + data_size\n\nwhere:\n  header_size = 8 + ((num_elements + 63) / 64) * 8\n  data_size = ((num_elements * element_size + 7) / 8) * 8\n"})}),"\n",(0,s.jsx)(i.h3,{id:"compact-array-size",children:"Compact Array Size"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"array_size = header_size + data_size\n\nwhere:\n  header_size = 4 + (element_nullable ? (num_elements + 7) / 8 : 0)\n  // header_size rounded to 8 if element_width % 8 == 0\n  data_size = num_elements * element_width\n"})}),"\n",(0,s.jsx)(i.h3,{id:"map-size",children:"Map Size"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"map_size = 8 + keys_array_size + values_array_size\n"})}),"\n",(0,s.jsx)(i.h2,{id:"summary-tables",children:"Summary Tables"}),"\n",(0,s.jsx)(i.h3,{id:"layout-summary",children:"Layout Summary"}),"\n",(0,s.jsxs)(i.table,{children:[(0,s.jsx)(i.thead,{children:(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.th,{children:"Component"}),(0,s.jsx)(i.th,{children:"Standard Format"}),(0,s.jsx)(i.th,{children:"Compact Format"})]})}),(0,s.jsxs)(i.tbody,{children:[(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Row Header"}),(0,s.jsxs)(i.td,{children:[(0,s.jsx)(i.code,{children:"((N + 63) / 64) * 8"})," bytes"]}),(0,s.jsxs)(i.td,{children:["0 or ",(0,s.jsx)(i.code,{children:"(N + 7) / 8"})," bytes (at end)"]})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Row Field Slots"}),(0,s.jsxs)(i.td,{children:[(0,s.jsx)(i.code,{children:"N * 8"})," bytes"]}),(0,s.jsxs)(i.td,{children:[(0,s.jsx)(i.code,{children:"sum(field_widths)"})," bytes"]})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Array Header"}),(0,s.jsxs)(i.td,{children:[(0,s.jsx)(i.code,{children:"8 + ((E + 63) / 64) * 8"})," bytes"]}),(0,s.jsxs)(i.td,{children:[(0,s.jsx)(i.code,{children:"4 + (E + 7) / 8"})," bytes (if nullable)"]})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Array Elements"}),(0,s.jsxs)(i.td,{children:[(0,s.jsx)(i.code,{children:"E * element_size"})," (8-aligned)"]}),(0,s.jsx)(i.td,{children:(0,s.jsx)(i.code,{children:"E * element_width"})})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Map Header"}),(0,s.jsx)(i.td,{children:"8 bytes"}),(0,s.jsx)(i.td,{children:"8 bytes"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Offset+Size Pair"}),(0,s.jsx)(i.td,{children:"8 bytes (32-bit offset + size)"}),(0,s.jsx)(i.td,{children:"8 bytes (same)"})]})]})]}),"\n",(0,s.jsx)(i.p,{children:"Where N = number of fields, E = number of elements"}),"\n",(0,s.jsx)(i.h3,{id:"type-width-summary",children:"Type Width Summary"}),"\n",(0,s.jsxs)(i.table,{children:[(0,s.jsx)(i.thead,{children:(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.th,{children:"Category"}),(0,s.jsx)(i.th,{children:"Storage Width"}),(0,s.jsx)(i.th,{children:"Standard Slot"}),(0,s.jsx)(i.th,{children:"Compact Slot"})]})}),(0,s.jsxs)(i.tbody,{children:[(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"bool"}),(0,s.jsx)(i.td,{children:"1 byte"}),(0,s.jsx)(i.td,{children:"8 bytes"}),(0,s.jsx)(i.td,{children:"1 byte"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"int8"}),(0,s.jsx)(i.td,{children:"1 byte"}),(0,s.jsx)(i.td,{children:"8 bytes"}),(0,s.jsx)(i.td,{children:"1 byte"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"int16"}),(0,s.jsx)(i.td,{children:"2 bytes"}),(0,s.jsx)(i.td,{children:"8 bytes"}),(0,s.jsx)(i.td,{children:"2 bytes"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"int32"}),(0,s.jsx)(i.td,{children:"4 bytes"}),(0,s.jsx)(i.td,{children:"8 bytes"}),(0,s.jsx)(i.td,{children:"4 bytes"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"int64"}),(0,s.jsx)(i.td,{children:"8 bytes"}),(0,s.jsx)(i.td,{children:"8 bytes"}),(0,s.jsx)(i.td,{children:"8 bytes"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"float32"}),(0,s.jsx)(i.td,{children:"4 bytes"}),(0,s.jsx)(i.td,{children:"8 bytes"}),(0,s.jsx)(i.td,{children:"4 bytes"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"float64"}),(0,s.jsx)(i.td,{children:"8 bytes"}),(0,s.jsx)(i.td,{children:"8 bytes"}),(0,s.jsx)(i.td,{children:"8 bytes"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"string/binary"}),(0,s.jsx)(i.td,{children:"Variable"}),(0,s.jsx)(i.td,{children:"8 bytes"}),(0,s.jsx)(i.td,{children:"8 bytes"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"array"}),(0,s.jsx)(i.td,{children:"Variable"}),(0,s.jsx)(i.td,{children:"8 bytes"}),(0,s.jsx)(i.td,{children:"8 bytes"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"map"}),(0,s.jsx)(i.td,{children:"Variable"}),(0,s.jsx)(i.td,{children:"8 bytes"}),(0,s.jsx)(i.td,{children:"8 bytes"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"struct"}),(0,s.jsx)(i.td,{children:"Variable"}),(0,s.jsx)(i.td,{children:"8 bytes"}),(0,s.jsx)(i.td,{children:"inline or 8"})]})]})]}),"\n",(0,s.jsx)(i.h2,{id:"implementation-notes",children:"Implementation Notes"}),"\n",(0,s.jsx)(i.h3,{id:"endianness",children:"Endianness"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:["All multi-byte integers are stored in ",(0,s.jsx)(i.strong,{children:"little-endian"})," format"]}),"\n",(0,s.jsx)(i.li,{children:"Floating-point values use native IEEE 754 representation"}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"memory-safety",children:"Memory Safety"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Writers must zero padding bytes to prevent information leakage"}),"\n",(0,s.jsx)(i.li,{children:"Readers must validate offsets and sizes before accessing data"}),"\n",(0,s.jsx)(i.li,{children:"Buffer bounds checking is required for untrusted input"}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Standard Format"}),":"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Fixed 8-byte slots enable O(1) field access with simple arithmetic"}),"\n",(0,s.jsx)(i.li,{children:"8-byte alignment optimizes CPU cache line usage"}),"\n",(0,s.jsx)(i.li,{children:"Best for cross-language interoperability"}),"\n"]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"Compact Format"}),":"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:"Smaller row sizes reduce memory bandwidth"}),"\n",(0,s.jsx)(i.li,{children:"Field sorting minimizes padding waste"}),"\n",(0,s.jsx)(i.li,{children:"Inline structs eliminate pointer chasing"}),"\n",(0,s.jsx)(i.li,{children:"Relaxed alignment may have slight CPU overhead on some architectures"}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"when-to-use-each-format",children:"When to Use Each Format"}),"\n",(0,s.jsxs)(i.table,{children:[(0,s.jsx)(i.thead,{children:(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.th,{children:"Scenario"}),(0,s.jsx)(i.th,{children:"Recommended Format"})]})}),(0,s.jsxs)(i.tbody,{children:[(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Cross-language data exchange"}),(0,s.jsx)(i.td,{children:"Standard"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Java-only, memory-constrained"}),(0,s.jsx)(i.td,{children:"Compact"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Many small primitive fields"}),(0,s.jsx)(i.td,{children:"Compact"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Many nested fixed-size structs"}),(0,s.jsx)(i.td,{children:"Compact"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Maximum read performance"}),(0,s.jsx)(i.td,{children:"Standard"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:"Interoperability with C++/Python"}),(0,s.jsx)(i.td,{children:"Standard"})]})]})]})]})}function o(e={}){const{wrapper:i}={...(0,r.a)(),...e.components};return i?(0,s.jsx)(i,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},11151:(e,i,n)=>{n.d(i,{Z:()=>d,a:()=>l});var s=n(67294);const r={},t=s.createContext(r);function l(e){const i=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function d(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(t.Provider,{value:i},e.children)}}}]);