"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[97201],{8332:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>l,toc:()=>c});var s=r(85893),i=r(11151);const t={title:"Type Registration",sidebar_position:4,id:"type_registration",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},d=void 0,l={id:"guide/cpp/type_registration",title:"Type Registration",description:"This page explains how to register types for serialization.",source:"@site/versioned_docs/version-0.15/guide/cpp/type-registration.md",sourceDirName:"guide/cpp",slug:"/guide/cpp/type_registration",permalink:"/docs/guide/cpp/type_registration",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/docs/guide/cpp/type-registration.md",tags:[],version:"0.15",sidebarPosition:4,frontMatter:{title:"Type Registration",sidebar_position:4,id:"type_registration",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"Schema Evolution",permalink:"/docs/guide/cpp/schema_evolution"},next:{title:"Polymorphic Serialization",permalink:"/docs/guide/cpp/polymorphism"}},o={},c=[{value:"Overview",id:"overview",level:2},{value:"Registering Structs",id:"registering-structs",level:2},{value:"Type ID Guidelines",id:"type-id-guidelines",level:2},{value:"Registering Enums",id:"registering-enums",level:2},{value:"Thread-Safe Registration",id:"thread-safe-registration",level:2},{value:"Cross-Language Registration",id:"cross-language-registration",level:2},{value:"Java",id:"java",level:3},{value:"Python",id:"python",level:3},{value:"C++",id:"c",level:3},{value:"Built-in Type IDs",id:"built-in-type-ids",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Related Topics",id:"related-topics",level:2}];function a(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"This page explains how to register types for serialization."}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"Apache Fory\u2122 requires explicit type registration for struct types. This design enables:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cross-Language Compatibility"}),": Registered type IDs are used across language boundaries"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Type Safety"}),": Detects type mismatches at deserialization time"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Polymorphic Serialization"}),": Enables serialization of polymorphic objects via smart pointers"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"registering-structs",children:"Registering Structs"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"register_struct<T>(type_id)"})," to register a struct type:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:'#include "fory/serialization/fory.h"\n\nusing namespace fory::serialization;\n\nstruct Person {\n  std::string name;\n  int32_t age;\n};\nFORY_STRUCT(Person, name, age);\n\nint main() {\n  auto fory = Fory::builder().xlang(true).build();\n\n  // Register with a unique type ID\n  fory.register_struct<Person>(100);\n\n  Person person{"Alice", 30};\n  auto bytes = fory.serialize(person).value();\n  auto decoded = fory.deserialize<Person>(bytes).value();\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"type-id-guidelines",children:"Type ID Guidelines"}),"\n",(0,s.jsx)(n.p,{children:"Type IDs must be:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Unique"}),": Each type must have a unique ID within a Fory instance"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Consistent"}),": Same ID must be used across all languages and versions"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"User-registered type IDs are in a separate namespace from built-in type IDs, so you can start from 0:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:"// User type IDs can start from 0\nfory.register_struct<Address>(0);\nfory.register_struct<Person>(1);\nfory.register_struct<Order>(2);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"registering-enums",children:"Registering Enums"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"register_enum<T>(type_id)"})," to register an enum type. For simple enums with continuous values starting from 0, no macro is needed:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:"// Simple continuous enum - no FORY_ENUM needed\nenum class Color { RED, GREEN, BLUE };  // Values: 0, 1, 2\n\n// Register with register_enum\nfory.register_enum<Color>(0);\n"})}),"\n",(0,s.jsxs)(n.p,{children:["For enums with non-continuous values, use the ",(0,s.jsx)(n.code,{children:"FORY_ENUM"})," macro to map values to ordinals:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:"// Non-continuous enum values - FORY_ENUM required\nenum class Priority { LOW = 10, MEDIUM = 50, HIGH = 100 };\nFORY_ENUM(Priority, LOW, MEDIUM, HIGH);\n// FORY_ENUM must be defined at namespace scope.\n\n// Global namespace enum (prefix with ::)\nenum LegacyStatus { UNKNOWN = -1, OK = 0, ERROR = 1 };\nFORY_ENUM(::LegacyStatus, UNKNOWN, OK, ERROR);\n\n// Register after FORY_ENUM\nfory.register_enum<Priority>(1);\nfory.register_enum<LegacyStatus>(2);\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.strong,{children:["When to use ",(0,s.jsx)(n.code,{children:"FORY_ENUM"}),":"]})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Enum values don't start from 0"}),"\n",(0,s.jsx)(n.li,{children:"Enum values are not continuous (e.g., 10, 50, 100)"}),"\n",(0,s.jsx)(n.li,{children:"You need name-to-value mapping at compile time"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"thread-safe-registration",children:"Thread-Safe Registration"}),"\n",(0,s.jsxs)(n.p,{children:["For ",(0,s.jsx)(n.code,{children:"ThreadSafeFory"}),", register types before spawning threads:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:"auto fory = Fory::builder().xlang(true).build_thread_safe();\n\n// Register all types first\nfory.register_struct<TypeA>(100);\nfory.register_struct<TypeB>(101);\n\n// Now safe to use from multiple threads\nstd::thread t1([&]() {\n  auto result = fory.serialize(obj_a);\n});\nstd::thread t2([&]() {\n  auto result = fory.serialize(obj_b);\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"cross-language-registration",children:"Cross-Language Registration"}),"\n",(0,s.jsx)(n.p,{children:"For cross-language compatibility, ensure:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Same Type ID"}),": Use identical IDs in all languages"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Compatible Types"}),": Use equivalent types across languages"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"java",children:"Java"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"Fory fory = Fory.builder().withXlang(true).build();\nfory.register(Person.class, 100);\nfory.register(Address.class, 101);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"python",children:"Python"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import pyfory\n\nfory = pyfory.Fory(xlang=True)\nfory.register(Person, type_id=100)\nfory.register(Address, type_id=101)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"c",children:"C++"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:"auto fory = Fory::builder().xlang(true).build();\nfory.register_struct<Person>(100);\nfory.register_struct<Address>(101);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"built-in-type-ids",children:"Built-in Type IDs"}),"\n",(0,s.jsx)(n.p,{children:"Built-in types have pre-assigned type IDs and don't need registration:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Type ID"}),(0,s.jsx)(n.th,{children:"Type"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"0"}),(0,s.jsx)(n.td,{children:"NONE"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"1"}),(0,s.jsx)(n.td,{children:"BOOL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"2"}),(0,s.jsx)(n.td,{children:"INT8"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"3"}),(0,s.jsx)(n.td,{children:"INT16"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"4"}),(0,s.jsx)(n.td,{children:"INT32"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"5"}),(0,s.jsx)(n.td,{children:"VAR_INT32"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"6"}),(0,s.jsx)(n.td,{children:"INT64"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"7"}),(0,s.jsx)(n.td,{children:"VAR_INT64"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"8"}),(0,s.jsx)(n.td,{children:"SLI_INT64"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"9"}),(0,s.jsx)(n.td,{children:"FLOAT16"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"10"}),(0,s.jsx)(n.td,{children:"FLOAT32"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"11"}),(0,s.jsx)(n.td,{children:"FLOAT64"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"12"}),(0,s.jsx)(n.td,{children:"STRING"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"13"}),(0,s.jsx)(n.td,{children:"LIST"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"14"}),(0,s.jsx)(n.td,{children:"MAP"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"15"}),(0,s.jsx)(n.td,{children:"SET"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"16"}),(0,s.jsx)(n.td,{children:"TIMESTAMP"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"17"}),(0,s.jsx)(n.td,{children:"DURATION"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"18"}),(0,s.jsx)(n.td,{children:"DATE"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"19"}),(0,s.jsx)(n.td,{children:"DECIMAL"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"20"}),(0,s.jsx)(n.td,{children:"BINARY"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"21"}),(0,s.jsx)(n.td,{children:"ARRAY"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"22"}),(0,s.jsx)(n.td,{children:"BOOL_ARRAY"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"23-28"}),(0,s.jsx)(n.td,{children:"INT_ARRAY variants"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"29-31"}),(0,s.jsx)(n.td,{children:"FLOAT_ARRAY variants"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"32"}),(0,s.jsx)(n.td,{children:"STRUCT"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"33"}),(0,s.jsx)(n.td,{children:"COMPATIBLE_STRUCT"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"34"}),(0,s.jsx)(n.td,{children:"NAMED_STRUCT"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"35"}),(0,s.jsxs)(n.td,{children:["NAMED",(0,s.jsx)(n.em,{children:"COMPATIBLE"}),"..."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"36"}),(0,s.jsx)(n.td,{children:"EXT"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"37"}),(0,s.jsx)(n.td,{children:"NAMED_EXT"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"63"}),(0,s.jsx)(n.td,{children:"UNKNOWN"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,s.jsx)(n.p,{children:"Registration errors are checked at serialization/deserialization time:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:'// Attempting to serialize unregistered type\nauto result = fory.serialize(unregistered_obj);\nif (!result.ok()) {\n  // Error: "Type not registered: ..."\n  std::cerr << result.error().to_string() << std::endl;\n}\n\n// Type ID mismatch during deserialization\nauto result = fory.deserialize<WrongType>(bytes);\nif (!result.ok()) {\n  // Error: "Type mismatch: expected X, got Y"\n  std::cerr << result.error().to_string() << std::endl;\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"related-topics",children:"Related Topics"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/guide/cpp/basic_serialization",children:"Basic Serialization"})," - Using registered types"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/guide/cpp/cross_language",children:"Cross-Language"})," - Cross-language considerations"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/guide/cpp/supported_types",children:"Supported Types"})," - All supported types"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},11151:(e,n,r)=>{r.d(n,{Z:()=>l,a:()=>d});var s=r(67294);const i={},t=s.createContext(i);function d(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);