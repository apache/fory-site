"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[11301],{82523:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>t,metadata:()=>o,toc:()=>c});var r=a(85893),i=a(11151);const t={title:"Serialization",sidebar_position:30,id:"serialization",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},s=void 0,o={id:"guide/xlang/serialization",title:"Serialization",description:"This page demonstrates cross-language serialization patterns with examples in all supported languages. Data serialized in one language can be deserialized in any other supported language.",source:"@site/docs/guide/xlang/serialization.md",sourceDirName:"guide/xlang",slug:"/guide/xlang/serialization",permalink:"/docs/next/guide/xlang/serialization",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/docs/guide/xlang/serialization.md",tags:[],version:"current",sidebarPosition:30,frontMatter:{title:"Serialization",sidebar_position:30,id:"serialization",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"Getting Started",permalink:"/docs/next/guide/xlang/getting_started"},next:{title:"Field Nullability",permalink:"/docs/next/guide/xlang/field_nullability"}},l={},c=[{value:"Serialize Built-in Types",id:"serialize-built-in-types",level:2},{value:"Java",id:"java",level:3},{value:"Python",id:"python",level:3},{value:"Go",id:"go",level:3},{value:"JavaScript",id:"javascript",level:3},{value:"Rust",id:"rust",level:3},{value:"Serialize Custom Types",id:"serialize-custom-types",level:2},{value:"Java",id:"java-1",level:3},{value:"Python",id:"python-1",level:3},{value:"Go",id:"go-1",level:3},{value:"JavaScript",id:"javascript-1",level:3},{value:"Rust",id:"rust-1",level:3},{value:"Serialize Shared and Circular References",id:"serialize-shared-and-circular-references",level:2},{value:"Java",id:"java-2",level:3},{value:"Python",id:"python-2",level:3},{value:"Go",id:"go-2",level:3},{value:"JavaScript",id:"javascript-2",level:3},{value:"Rust",id:"rust-2",level:3},{value:"See Also",id:"see-also",level:2}];function p(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"This page demonstrates cross-language serialization patterns with examples in all supported languages. Data serialized in one language can be deserialized in any other supported language."}),"\n",(0,r.jsx)(n.h2,{id:"serialize-built-in-types",children:"Serialize Built-in Types"}),"\n",(0,r.jsx)(n.p,{children:"Common types can be serialized automatically without registration: primitive numeric types, string, binary, array, list, map, and more."}),"\n",(0,r.jsx)(n.h3,{id:"java",children:"Java"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'import org.apache.fory.*;\nimport org.apache.fory.config.*;\n\nimport java.util.*;\n\npublic class Example1 {\n  public static void main(String[] args) {\n    Fory fory = Fory.builder().withLanguage(Language.XLANG).build();\n    List<Object> list = ofArrayList(true, false, "str", -1.1, 1, new int[100], new double[20]);\n    byte[] bytes = fory.serialize(list);\n    // bytes can be deserialized by other languages\n    fory.deserialize(bytes);\n    Map<Object, Object> map = new HashMap<>();\n    map.put("k1", "v1");\n    map.put("k2", list);\n    map.put("k3", -1);\n    bytes = fory.serialize(map);\n    // bytes can be deserialized by other languages\n    fory.deserialize(bytes);\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"python",children:"Python"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'import pyfory\nimport numpy as np\n\nfory = pyfory.Fory(xlang=True)\nobject_list = [True, False, "str", -1.1, 1,\n               np.full(100, 0, dtype=np.int32), np.full(20, 0.0, dtype=np.double)]\ndata = fory.serialize(object_list)\n# bytes can be deserialized by other languages\nnew_list = fory.deserialize(data)\nobject_map = {"k1": "v1", "k2": object_list, "k3": -1}\ndata = fory.serialize(object_map)\n# bytes can be deserialized by other languages\nnew_map = fory.deserialize(data)\nprint(new_map)\n'})}),"\n",(0,r.jsx)(n.h3,{id:"go",children:"Go"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'package main\n\nimport forygo "github.com/apache/fory/go/fory"\nimport "fmt"\n\nfunc main() {\n  list := []any{true, false, "str", -1.1, 1, make([]int32, 10), make([]float64, 20)}\n  fory := forygo.NewFory(forygo.WithXlang(true))\n  bytes, err := fory.Marshal(list)\n  if err != nil {\n    panic(err)\n  }\n  var newValue any\n  // bytes can be deserialized by other languages\n  if err := fory.Unmarshal(bytes, &newValue); err != nil {\n    panic(err)\n  }\n  fmt.Println(newValue)\n  dict := map[string]any{\n    "k1": "v1",\n    "k2": list,\n    "k3": -1,\n  }\n  bytes, err = fory.Marshal(dict)\n  if err != nil {\n    panic(err)\n  }\n  // bytes can be deserialized by other languages\n  if err := fory.Unmarshal(bytes, &newValue); err != nil {\n    panic(err)\n  }\n  fmt.Println(newValue)\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"javascript",children:"JavaScript"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'import Fory from "@apache-fory/fory";\n\n/**\n * @apache-fory/hps use v8\'s fast-calls-api that can be called directly by jit,\n * ensure that the version of Node is 20 or above.\n * Experimental feature, installation success cannot be guaranteed at this moment.\n * If you are unable to install the module, replace it with `const hps = null;`\n **/\nimport hps from "@apache-fory/hps";\n\nconst fory = new Fory({ hps });\nconst input = fory.serialize("hello fory");\nconst result = fory.deserialize(input);\nconsole.log(result);\n'})}),"\n",(0,r.jsx)(n.h3,{id:"rust",children:"Rust"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",children:'use fory::Fory;\n\nfn run() {\n    let fory = Fory::default().xlang(true);\n    let bin = fory.serialize(&"hello".to_string()).expect("serialize success");\n    let obj: String = fory.deserialize(&bin).expect("deserialize success");\n    assert_eq!("hello".to_string(), obj);\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"serialize-custom-types",children:"Serialize Custom Types"}),"\n",(0,r.jsx)(n.p,{children:"User-defined types must be registered using the register API to establish the mapping relationship between types in different languages. Use consistent type names across all languages."}),"\n",(0,r.jsx)(n.h3,{id:"java-1",children:"Java"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'import org.apache.fory.*;\nimport org.apache.fory.config.*;\nimport java.util.*;\n\npublic class Example2 {\n  public static class SomeClass1 {\n    Object f1;\n    Map<Byte, Integer> f2;\n  }\n\n  public static class SomeClass2 {\n    Object f1;\n    String f2;\n    List<Object> f3;\n    Map<Byte, Integer> f4;\n    Byte f5;\n    Short f6;\n    Integer f7;\n    Long f8;\n    Float f9;\n    Double f10;\n    short[] f11;\n    List<Short> f12;\n  }\n\n  public static Object createObject() {\n    SomeClass1 obj1 = new SomeClass1();\n    obj1.f1 = true;\n    obj1.f2 = ofHashMap((byte) -1, 2);\n    SomeClass2 obj = new SomeClass2();\n    obj.f1 = obj1;\n    obj.f2 = "abc";\n    obj.f3 = ofArrayList("abc", "abc");\n    obj.f4 = ofHashMap((byte) 1, 2);\n    obj.f5 = Byte.MAX_VALUE;\n    obj.f6 = Short.MAX_VALUE;\n    obj.f7 = Integer.MAX_VALUE;\n    obj.f8 = Long.MAX_VALUE;\n    obj.f9 = 1.0f / 2;\n    obj.f10 = 1 / 3.0;\n    obj.f11 = new short[]{(short) 1, (short) 2};\n    obj.f12 = ofArrayList((short) -1, (short) 4);\n    return obj;\n  }\n\n  // mvn exec:java -Dexec.mainClass="org.apache.fory.examples.Example2"\n  public static void main(String[] args) {\n    Fory fory = Fory.builder().withLanguage(Language.XLANG).build();\n    fory.register(SomeClass1.class, "example.SomeClass1");\n    fory.register(SomeClass2.class, "example.SomeClass2");\n    byte[] bytes = fory.serialize(createObject());\n    // bytes can be deserialized by other languages\n    System.out.println(fory.deserialize(bytes));\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"python-1",children:"Python"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from dataclasses import dataclass\nfrom typing import List, Dict, Any\nimport pyfory, array\n\n\n@dataclass\nclass SomeClass1:\n    f1: Any\n    f2: Dict[pyfory.Int8Type, pyfory.Int32Type]\n\n\n@dataclass\nclass SomeClass2:\n    f1: Any = None\n    f2: str = None\n    f3: List[str] = None\n    f4: Dict[pyfory.Int8Type, pyfory.Int32Type] = None\n    f5: pyfory.Int8Type = None\n    f6: pyfory.Int16Type = None\n    f7: pyfory.Int32Type = None\n    # int type will be taken as `pyfory.Int64Type`.\n    # use `pyfory.Int32Type` for type hint if peer uses more narrow type.\n    f8: int = None\n    f9: pyfory.Float32Type = None\n    # float type will be taken as `pyfory.Float64Type`\n    f10: float = None\n    f11: pyfory.Int16ArrayType = None\n    f12: List[pyfory.Int16Type] = None\n\n\nif __name__ == "__main__":\n    f = pyfory.Fory(xlang=True)\n    f.register_type(SomeClass1, typename="example.SomeClass1")\n    f.register_type(SomeClass2, typename="example.SomeClass2")\n    obj1 = SomeClass1(f1=True, f2={-1: 2})\n    obj = SomeClass2(\n        f1=obj1,\n        f2="abc",\n        f3=["abc", "abc"],\n        f4={1: 2},\n        f5=2 ** 7 - 1,\n        f6=2 ** 15 - 1,\n        f7=2 ** 31 - 1,\n        f8=2 ** 63 - 1,\n        f9=1.0 / 2,\n        f10=1 / 3.0,\n        f11=array.array("h", [1, 2]),\n        f12=[-1, 4],\n    )\n    data = f.serialize(obj)\n    # bytes can be deserialized by other languages\n    print(f.deserialize(data))\n'})}),"\n",(0,r.jsx)(n.h3,{id:"go-1",children:"Go"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'package main\n\nimport forygo "github.com/apache/fory/go/fory"\nimport "fmt"\n\nfunc main() {\n  type SomeClass1 struct {\n    F1 any\n    F2 map[int8]int32\n  }\n\n  type SomeClass2 struct {\n    F1  any\n    F2  string\n    F3  []any\n    F4  map[int8]int32\n    F5  int8\n    F6  int16\n    F7  int32\n    F8  int64\n    F9  float32\n    F10 float64\n    F11 []int16\n    F12 []int16\n  }\n  serializer := forygo.NewFory(forygo.WithXlang(true))\n  if err := serializer.RegisterNamedStruct(SomeClass1{}, "example.SomeClass1"); err != nil {\n    panic(err)\n  }\n  if err := serializer.RegisterNamedStruct(SomeClass2{}, "example.SomeClass2"); err != nil {\n    panic(err)\n  }\n  obj1 := &SomeClass1{F1: true, F2: map[int8]int32{-1: 2}}\n  obj := &SomeClass2{\n    F1:  obj1,\n    F2:  "abc",\n    F3:  []any{"abc", "abc"},\n    F4:  map[int8]int32{1: 2},\n    F5:  127,\n    F6:  32767,\n    F7:  2147483647,\n    F8:  9223372036854775807,\n    F9:  1.0 / 2,\n    F10: 1.0 / 3.0,\n    F11: []int16{1, 2},\n    F12: []int16{-1, 4},\n  }\n  bytes, err := serializer.Marshal(obj)\n  if err != nil {\n    panic(err)\n  }\n  var newValue any\n  // bytes can be deserialized by other languages\n  if err := serializer.Unmarshal(bytes, &newValue); err != nil {\n    panic(err)\n  }\n  fmt.Println(newValue)\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"javascript-1",children:"JavaScript"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'import Fory, { Type, InternalSerializerType } from "@apache-fory/fory";\n\n/**\n * @apache-fory/hps use v8\'s fast-calls-api that can be called directly by jit,\n * ensure that the version of Node is 20 or above.\n * Experimental feature, installation success cannot be guaranteed at this moment.\n * If you are unable to install the module, replace it with `const hps = null;`\n **/\nimport hps from "@apache-fory/hps";\n\n// Describe data structures using JSON schema\nconst description = Type.object("example.foo", {\n  foo: Type.string(),\n});\nconst fory = new Fory({ hps });\nconst { serialize, deserialize } = fory.registerSerializer(description);\nconst input = serialize({ foo: "hello fory" });\nconst result = deserialize(input);\nconsole.log(result);\n'})}),"\n",(0,r.jsx)(n.h3,{id:"rust-1",children:"Rust"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",children:'use chrono::{NaiveDate, NaiveDateTime};\nuse fory::{Fory, ForyObject};\nuse std::collections::HashMap;\n\n#[test]\nfn complex_struct() {\n    #[derive(ForyObject, Debug, PartialEq)]\n    struct Animal {\n        category: String,\n    }\n\n    #[derive(ForyObject, Debug, PartialEq)]\n    struct Person {\n        c1: Vec<u8>,  // binary\n        c2: Vec<i16>, // primitive array\n        animal: Vec<Animal>,\n        c3: Vec<Vec<u8>>,\n        name: String,\n        c4: HashMap<String, String>,\n        age: u16,\n        op: Option<String>,\n        op2: Option<String>,\n        date: NaiveDate,\n        time: NaiveDateTime,\n        c5: f32,\n        c6: f64,\n    }\n    let person: Person = Person {\n        c1: vec![1, 2, 3],\n        c2: vec![5, 6, 7],\n        c3: vec![vec![1, 2], vec![1, 3]],\n        animal: vec![Animal {\n            category: "Dog".to_string(),\n        }],\n        c4: HashMap::from([\n            ("hello1".to_string(), "hello2".to_string()),\n            ("hello2".to_string(), "hello3".to_string()),\n        ]),\n        age: 12,\n        name: "helo".to_string(),\n        op: Some("option".to_string()),\n        op2: None,\n        date: NaiveDate::from_ymd_opt(2025, 12, 12).unwrap(),\n        time: NaiveDateTime::from_timestamp_opt(1689912359, 0).unwrap(),\n        c5: 2.0,\n        c6: 4.0,\n    };\n\n    let mut fory = Fory::default().xlang(true);\n    fory\n        .register_by_namespace::<Animal>("example", "foo2")\n        .expect("register Animal");\n    fory\n        .register_by_namespace::<Person>("example", "foo")\n        .expect("register Person");\n    let bin = fory.serialize(&person).expect("serialize success");\n    let obj: Person = fory.deserialize(&bin).expect("deserialize success");\n    assert_eq!(person, obj);\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"serialize-shared-and-circular-references",children:"Serialize Shared and Circular References"}),"\n",(0,r.jsx)(n.p,{children:"Shared references and circular references can be serialized automatically with no duplicate data or recursion errors. Enable reference tracking to use this feature."}),"\n",(0,r.jsx)(n.h3,{id:"java-2",children:"Java"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'import org.apache.fory.*;\nimport org.apache.fory.config.*;\nimport java.util.*;\n\npublic class ReferenceExample {\n  public static class SomeClass {\n    SomeClass f1;\n    Map<String, String> f2;\n    Map<String, String> f3;\n  }\n\n  public static Object createObject() {\n    SomeClass obj = new SomeClass();\n    obj.f1 = obj;\n    obj.f2 = ofHashMap("k1", "v1", "k2", "v2");\n    obj.f3 = obj.f2;\n    return obj;\n  }\n\n  // mvn exec:java -Dexec.mainClass="org.apache.fory.examples.ReferenceExample"\n  public static void main(String[] args) {\n    Fory fory = Fory.builder().withLanguage(Language.XLANG)\n      .withRefTracking(true).build();\n    fory.register(SomeClass.class, "example.SomeClass");\n    byte[] bytes = fory.serialize(createObject());\n    // bytes can be deserialized by other languages\n    System.out.println(fory.deserialize(bytes));\n  }\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"python-2",children:"Python"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from typing import Dict\nimport pyfory\n\nclass SomeClass:\n    f1: "SomeClass"\n    f2: Dict[str, str]\n    f3: Dict[str, str]\n\nfory = pyfory.Fory(xlang=True, ref=True)\nfory.register_type(SomeClass, typename="example.SomeClass")\nobj = SomeClass()\nobj.f2 = {"k1": "v1", "k2": "v2"}\nobj.f1, obj.f3 = obj, obj.f2\ndata = fory.serialize(obj)\n# bytes can be deserialized by other languages\nprint(fory.deserialize(data))\n'})}),"\n",(0,r.jsx)(n.h3,{id:"go-2",children:"Go"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'package main\n\nimport forygo "github.com/apache/fory/go/fory"\nimport "fmt"\n\nfunc main() {\n  type SomeClass struct {\n    F1 *SomeClass\n    F2 map[string]string\n    F3 map[string]string\n  }\n  fory := forygo.NewFory(\n    forygo.WithXlang(true),\n    forygo.WithTrackRef(true),\n  )\n  if err := fory.RegisterStruct(SomeClass{}, 65); err != nil {\n    panic(err)\n  }\n  value := &SomeClass{F2: map[string]string{"k1": "v1", "k2": "v2"}}\n  value.F3 = value.F2\n  value.F1 = value\n  bytes, err := fory.Marshal(value)\n  if err != nil {\n    panic(err)\n  }\n  var newValue any\n  // bytes can be deserialized by other languages\n  if err := fory.Unmarshal(bytes, &newValue); err != nil {\n    panic(err)\n  }\n  fmt.Println(newValue)\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"javascript-2",children:"JavaScript"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'import Fory, { Type } from "@apache-fory/fory";\n/**\n * @apache-fory/hps use v8\'s fast-calls-api that can be called directly by jit,\n * ensure that the version of Node is 20 or above.\n * Experimental feature, installation success cannot be guaranteed at this moment.\n * If you are unable to install the module, replace it with `const hps = null;`\n **/\nimport hps from "@apache-fory/hps";\n\nconst description = Type.object("example.foo", {\n  foo: Type.string(),\n  bar: Type.object("example.foo"),\n});\n\nconst fory = new Fory({ hps });\nconst { serialize, deserialize } = fory.registerSerializer(description);\nconst data: any = {\n  foo: "hello fory",\n};\ndata.bar = data;\nconst input = serialize(data);\nconst result = deserialize(input);\nconsole.log(result.bar.foo === result.foo);\n'})}),"\n",(0,r.jsx)(n.h3,{id:"rust-2",children:"Rust"}),"\n",(0,r.jsx)(n.p,{children:"Circular references cannot be implemented in Rust due to ownership restrictions."}),"\n",(0,r.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/next/guide/xlang/zero_copy",children:"Zero-Copy Serialization"})," - Out-of-band serialization for large data"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/next/specification/xlang_type_mapping",children:"Type Mapping"})," - Cross-language type mapping reference"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/next/guide/xlang/getting_started",children:"Getting Started"})," - Installation and setup"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/docs/next/specification/xlang_serialization_spec",children:"Xlang Serialization Specification"})," - Binary protocol details"]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},11151:(e,n,a)=>{a.d(n,{Z:()=>o,a:()=>s});var r=a(67294);const i={},t=r.createContext(i);function s(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);