"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[85252],{96206:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>c,toc:()=>a});var s=n(85893),t=n(11151);const r={title:"Security Best Practices",sidebar_position:9,id:"security",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},o=void 0,c={id:"guide/python/security",title:"Security Best Practices",description:"This page covers security best practices and DeserializationPolicy.",source:"@site/versioned_docs/version-0.15/guide/python/security.md",sourceDirName:"guide/python",slug:"/guide/python/security",permalink:"/docs/guide/python/security",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/docs/guide/python/security.md",tags:[],version:"0.15",sidebarPosition:9,frontMatter:{title:"Security Best Practices",sidebar_position:9,id:"security",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"NumPy & Pandas",permalink:"/docs/guide/python/numpy_integration"},next:{title:"Cross-Language Serialization",permalink:"/docs/guide/python/cross_language"}},l={},a=[{value:"Production Configuration",id:"production-configuration",level:2},{value:"Development vs Production",id:"development-vs-production",level:2},{value:"DeserializationPolicy",id:"deserializationpolicy",level:2},{value:"Blocking Dangerous Classes",id:"blocking-dangerous-classes",level:3},{value:"Available Policy Hooks",id:"available-policy-hooks",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Related Topics",id:"related-topics",level:2}];function d(e){const i={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.p,{children:"This page covers security best practices and DeserializationPolicy."}),"\n",(0,s.jsx)(i.h2,{id:"production-configuration",children:"Production Configuration"}),"\n",(0,s.jsxs)(i.p,{children:["Never disable ",(0,s.jsx)(i.code,{children:"strict=True"})," in production unless your environment is completely trusted:"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-python",children:"import pyfory\n\n# Recommended production settings\nf = pyfory.Fory(\n    xlang=False,   # or True for cross-language\n    ref=True,      # Handle circular references\n    strict=True,   # IMPORTANT: Prevent malicious data\n    max_depth=100  # Prevent deep recursion attacks\n)\n\n# Explicitly register allowed types\nf.register(UserModel, type_id=100)\nf.register(OrderModel, type_id=101)\n# Never set strict=False in production with untrusted data!\n"})}),"\n",(0,s.jsx)(i.h2,{id:"development-vs-production",children:"Development vs Production"}),"\n",(0,s.jsx)(i.p,{children:"Use environment variables to switch between configurations:"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-python",children:"import pyfory\nimport os\n\n# Development configuration\nif os.getenv('ENV') == 'development':\n    fory = pyfory.Fory(\n        xlang=False,\n        ref=True,\n        strict=False,    # Allow any type for development\n        max_depth=1000   # Higher limit for development\n    )\nelse:\n    # Production configuration (security hardened)\n    fory = pyfory.Fory(\n        xlang=False,\n        ref=True,\n        strict=True,     # CRITICAL: Require registration\n        max_depth=100    # Reasonable limit\n    )\n    # Register only known safe types\n    for idx, model_class in enumerate([UserModel, ProductModel, OrderModel]):\n        fory.register(model_class, type_id=100 + idx)\n"})}),"\n",(0,s.jsx)(i.h2,{id:"deserializationpolicy",children:"DeserializationPolicy"}),"\n",(0,s.jsxs)(i.p,{children:["When ",(0,s.jsx)(i.code,{children:"strict=False"})," is necessary (e.g., deserializing functions/lambdas), use ",(0,s.jsx)(i.code,{children:"DeserializationPolicy"})," to implement fine-grained security controls during deserialization."]}),"\n",(0,s.jsx)(i.p,{children:(0,s.jsx)(i.strong,{children:"Why use DeserializationPolicy?"})}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:["Block dangerous classes/modules (e.g., ",(0,s.jsx)(i.code,{children:"subprocess.Popen"}),")"]}),"\n",(0,s.jsxs)(i.li,{children:["Intercept and validate ",(0,s.jsx)(i.code,{children:"__reduce__"})," callables before invocation"]}),"\n",(0,s.jsxs)(i.li,{children:["Sanitize sensitive data during ",(0,s.jsx)(i.code,{children:"__setstate__"})]}),"\n",(0,s.jsx)(i.li,{children:"Replace or reject deserialized objects based on custom rules"}),"\n"]}),"\n",(0,s.jsx)(i.h3,{id:"blocking-dangerous-classes",children:"Blocking Dangerous Classes"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{className:"language-python",children:"import pyfory\nfrom pyfory import DeserializationPolicy\n\ndangerous_modules = {'subprocess', 'os', '__builtin__'}\n\nclass SafeDeserializationPolicy(DeserializationPolicy):\n    \"\"\"Block potentially dangerous classes during deserialization.\"\"\"\n\n    def validate_class(self, cls, is_local, **kwargs):\n        # Block dangerous modules\n        if cls.__module__ in dangerous_modules:\n            raise ValueError(f\"Blocked dangerous class: {cls.__module__}.{cls.__name__}\")\n        return None\n\n    def intercept_reduce_call(self, callable_obj, args, **kwargs):\n        # Block specific callable invocations during __reduce__\n        if getattr(callable_obj, '__name__', \"\") == 'Popen':\n            raise ValueError(\"Blocked attempt to invoke subprocess.Popen\")\n        return None\n\n    def intercept_setstate(self, obj, state, **kwargs):\n        # Sanitize sensitive data\n        if isinstance(state, dict) and 'password' in state:\n            state['password'] = '***REDACTED***'\n        return None\n\n# Create Fory with custom security policy\npolicy = SafeDeserializationPolicy()\nfory = pyfory.Fory(xlang=False, ref=True, strict=False, policy=policy)\n\n# Now deserialization is protected by your custom policy\ndata = fory.serialize(my_object)\nresult = fory.deserialize(data)  # Policy hooks will be invoked\n"})}),"\n",(0,s.jsx)(i.h2,{id:"available-policy-hooks",children:"Available Policy Hooks"}),"\n",(0,s.jsxs)(i.table,{children:[(0,s.jsx)(i.thead,{children:(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.th,{children:"Hook"}),(0,s.jsx)(i.th,{children:"Description"})]})}),(0,s.jsxs)(i.tbody,{children:[(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:(0,s.jsx)(i.code,{children:"validate_class(cls, is_local)"})}),(0,s.jsx)(i.td,{children:"Validate/block class types during deserialization"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:(0,s.jsx)(i.code,{children:"validate_module(module, is_local)"})}),(0,s.jsx)(i.td,{children:"Validate/block module imports"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:(0,s.jsx)(i.code,{children:"validate_function(func, is_local)"})}),(0,s.jsx)(i.td,{children:"Validate/block function references"})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:(0,s.jsx)(i.code,{children:"intercept_reduce_call(callable_obj, args)"})}),(0,s.jsxs)(i.td,{children:["Intercept ",(0,s.jsx)(i.code,{children:"__reduce__"})," invocations"]})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:(0,s.jsx)(i.code,{children:"inspect_reduced_object(obj)"})}),(0,s.jsxs)(i.td,{children:["Inspect/replace objects created via ",(0,s.jsx)(i.code,{children:"__reduce__"})]})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:(0,s.jsx)(i.code,{children:"intercept_setstate(obj, state)"})}),(0,s.jsxs)(i.td,{children:["Sanitize state before ",(0,s.jsx)(i.code,{children:"__setstate__"})]})]}),(0,s.jsxs)(i.tr,{children:[(0,s.jsx)(i.td,{children:(0,s.jsx)(i.code,{children:"authorize_instantiation(cls, args, kwargs)"})}),(0,s.jsx)(i.td,{children:"Control class instantiation"})]})]})]}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"See also:"})," ",(0,s.jsx)(i.code,{children:"pyfory/policy.py"})," contains detailed documentation and examples for each hook."]}),"\n",(0,s.jsx)(i.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(i.ol,{children:["\n",(0,s.jsx)(i.li,{children:(0,s.jsxs)(i.strong,{children:["Always use ",(0,s.jsx)(i.code,{children:"strict=True"})," in production"]})}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsxs)(i.strong,{children:["Use ",(0,s.jsx)(i.code,{children:"DeserializationPolicy"})]})," when ",(0,s.jsx)(i.code,{children:"strict=False"})," is necessary"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Block dangerous modules"})," (subprocess, os, etc.)"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsxs)(i.strong,{children:["Set appropriate ",(0,s.jsx)(i.code,{children:"max_depth"})]})," to prevent stack overflow"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Validate data sources"})," before deserialization"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.strong,{children:"Log security events"})," for auditing"]}),"\n"]}),"\n",(0,s.jsx)(i.h2,{id:"related-topics",children:"Related Topics"}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.a,{href:"/docs/guide/python/type_registration",children:"Type Registration"})," - Registration and strict mode"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.a,{href:"/docs/guide/python/configuration",children:"Configuration"})," - Fory parameters"]}),"\n",(0,s.jsxs)(i.li,{children:[(0,s.jsx)(i.a,{href:"/docs/guide/python/native_mode",children:"Python Native Mode"})," - Functions and lambdas"]}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,t.a)(),...e.components};return i?(0,s.jsx)(i,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},11151:(e,i,n)=>{n.d(i,{Z:()=>c,a:()=>o});var s=n(67294);const t={},r=s.createContext(t);function o(e){const i=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function c(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(r.Provider,{value:i},e.children)}}}]);