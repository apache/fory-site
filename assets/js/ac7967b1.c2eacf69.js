"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[37970],{87706:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>o,default:()=>u,frontMatter:()=>s,metadata:()=>l,toc:()=>d});var r=n(85893),i=n(11151);const s={title:"Custom Serializers",sidebar_position:4,id:"custom_serializers",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},o=void 0,l={id:"guide/rust/custom_serializers",title:"Custom Serializers",description:"For types that don't support #[derive(ForyObject)], implement the Serializer trait manually.",source:"@site/docs/guide/rust/custom-serializers.md",sourceDirName:"guide/rust",slug:"/guide/rust/custom_serializers",permalink:"/docs/next/guide/rust/custom_serializers",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/docs/guide/rust/custom-serializers.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"Custom Serializers",sidebar_position:4,id:"custom_serializers",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"Type Registration",permalink:"/docs/next/guide/rust/type_registration"},next:{title:"Field Configuration",permalink:"/docs/next/guide/rust/field_configuration"}},a={},d=[{value:"When to Use Custom Serializers",id:"when-to-use-custom-serializers",level:2},{value:"Implementing the Serializer Trait",id:"implementing-the-serializer-trait",level:2},{value:"Registering Custom Serializers",id:"registering-custom-serializers",level:2},{value:"WriteContext and ReadContext",id:"writecontext-and-readcontext",level:2},{value:"Common Writer Methods",id:"common-writer-methods",level:3},{value:"Common Reader Methods",id:"common-reader-methods",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Related Topics",id:"related-topics",level:2}];function c(e){const t={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.p,{children:["For types that don't support ",(0,r.jsx)(t.code,{children:"#[derive(ForyObject)]"}),", implement the ",(0,r.jsx)(t.code,{children:"Serializer"})," trait manually."]}),"\n",(0,r.jsx)(t.h2,{id:"when-to-use-custom-serializers",children:"When to Use Custom Serializers"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"External types from other crates"}),"\n",(0,r.jsx)(t.li,{children:"Types with special serialization requirements"}),"\n",(0,r.jsx)(t.li,{children:"Legacy data format compatibility"}),"\n",(0,r.jsx)(t.li,{children:"Performance-critical custom encoding"}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"implementing-the-serializer-trait",children:"Implementing the Serializer Trait"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-rust",children:"use fory::{Fory, ReadContext, WriteContext, Serializer, ForyDefault, Error};\nuse std::any::Any;\n\n#[derive(Debug, PartialEq, Default)]\nstruct CustomType {\n    value: i32,\n    name: String,\n}\n\nimpl Serializer for CustomType {\n    fn fory_write_data(&self, context: &mut WriteContext, is_field: bool) {\n        context.writer.write_i32(self.value);\n        context.writer.write_varuint32(self.name.len() as u32);\n        context.writer.write_utf8_string(&self.name);\n    }\n\n    fn fory_read_data(context: &mut ReadContext, is_field: bool) -> Result<Self, Error> {\n        let value = context.reader.read_i32();\n        let len = context.reader.read_varuint32() as usize;\n        let name = context.reader.read_utf8_string(len);\n        Ok(Self { value, name })\n    }\n\n    fn fory_type_id_dyn(&self, type_resolver: &TypeResolver) -> u32 {\n        Self::fory_get_type_id(type_resolver)\n    }\n\n    fn as_any(&self) -> &dyn Any {\n        self\n    }\n}\n\n// ForyDefault delegates to Default\nimpl ForyDefault for CustomType {\n    fn fory_default() -> Self {\n        Self::default()\n    }\n}\n"})}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Note"}),": When implementing ",(0,r.jsx)(t.code,{children:"ForyDefault"})," manually, ensure your type also implements ",(0,r.jsx)(t.code,{children:"Default"})," if you use ",(0,r.jsx)(t.code,{children:"Self::default()"}),".\nAlternatively, you can construct a default instance directly in ",(0,r.jsx)(t.code,{children:"fory_default()"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Tip"}),": If your type supports ",(0,r.jsx)(t.code,{children:"#[derive(ForyObject)]"}),", you can use ",(0,r.jsx)(t.code,{children:"#[fory(generate_default)]"})," to automatically generate both ",(0,r.jsx)(t.code,{children:"ForyDefault"})," and ",(0,r.jsx)(t.code,{children:"Default"})," implementations."]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"registering-custom-serializers",children:"Registering Custom Serializers"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-rust",children:'let mut fory = Fory::default();\nfory.register_serializer::<CustomType>(100);\n\nlet custom = CustomType {\n    value: 42,\n    name: "test".to_string(),\n};\nlet bytes = fory.serialize(&custom);\nlet decoded: CustomType = fory.deserialize(&bytes)?;\nassert_eq!(custom, decoded);\n'})}),"\n",(0,r.jsx)(t.h2,{id:"writecontext-and-readcontext",children:"WriteContext and ReadContext"}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"WriteContext"})," and ",(0,r.jsx)(t.code,{children:"ReadContext"})," provide access to:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"writer/reader"}),": Binary buffer operations"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"type_resolver"}),": Type registration information"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"ref_resolver"}),": Reference tracking (for shared/circular references)"]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"common-writer-methods",children:"Common Writer Methods"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-rust",children:"// Primitive types\ncontext.writer.write_i8(value);\ncontext.writer.write_i16(value);\ncontext.writer.write_i32(value);\ncontext.writer.write_i64(value);\ncontext.writer.write_f32(value);\ncontext.writer.write_f64(value);\ncontext.writer.write_bool(value);\n\n// Variable-length integers\ncontext.writer.write_varint32(value);\ncontext.writer.write_varuint32(value);\n\n// Strings\ncontext.writer.write_utf8_string(&string);\n"})}),"\n",(0,r.jsx)(t.h3,{id:"common-reader-methods",children:"Common Reader Methods"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-rust",children:"// Primitive types\nlet value = context.reader.read_i8();\nlet value = context.reader.read_i16();\nlet value = context.reader.read_i32();\nlet value = context.reader.read_i64();\nlet value = context.reader.read_f32();\nlet value = context.reader.read_f64();\nlet value = context.reader.read_bool();\n\n// Variable-length integers\nlet value = context.reader.read_varint32();\nlet value = context.reader.read_varuint32();\n\n// Strings\nlet string = context.reader.read_utf8_string(len);\n"})}),"\n",(0,r.jsx)(t.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Use variable-length encoding"})," for integers that may be small"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Write length first"})," for variable-length data"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Handle errors properly"})," in read methods"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Implement ForyDefault"})," for schema evolution support"]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"related-topics",children:"Related Topics"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"/docs/next/guide/rust/type_registration",children:"Type Registration"})," - Registering serializers"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"/docs/next/guide/rust/basic_serialization",children:"Basic Serialization"})," - Using ForyObject derive"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"/docs/next/guide/rust/schema_evolution",children:"Schema Evolution"})," - Compatible mode"]}),"\n"]})]})}function u(e={}){const{wrapper:t}={...(0,i.a)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},11151:(e,t,n)=>{n.d(t,{Z:()=>l,a:()=>o});var r=n(67294);const i={},s=r.createContext(i);function o(e){const t=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(s.Provider,{value:t},e.children)}}}]);