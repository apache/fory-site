"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[12230],{44140:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>c,toc:()=>l});var s=i(85893),r=i(11151);const t={title:"Troubleshooting",sidebar_position:10,id:"troubleshooting",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},o=void 0,c={id:"guide/rust/troubleshooting",title:"Troubleshooting",description:"This page covers common issues and debugging techniques for Apache Fory\u2122 Rust.",source:"@site/versioned_docs/version-0.14/guide/rust/troubleshooting.md",sourceDirName:"guide/rust",slug:"/guide/rust/troubleshooting",permalink:"/docs/0.14/guide/rust/troubleshooting",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/docs/guide/rust/troubleshooting.md",tags:[],version:"0.14",sidebarPosition:10,frontMatter:{title:"Troubleshooting",sidebar_position:10,id:"troubleshooting",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"Row Format",permalink:"/docs/0.14/guide/rust/row_format"},next:{title:"C++ Serialization Guide",permalink:"/docs/0.14/guide/cpp/"}},d={},l=[{value:"Common Issues",id:"common-issues",level:2},{value:"Type Registry Errors",id:"type-registry-errors",level:3},{value:"Type Mismatch Errors",id:"type-mismatch-errors",level:3},{value:"Debugging Techniques",id:"debugging-techniques",level:2},{value:"Enable Panic on Error for Backtraces",id:"enable-panic-on-error-for-backtraces",level:3},{value:"Struct Field Tracing",id:"struct-field-tracing",level:3},{value:"Lightweight Logging",id:"lightweight-logging",level:3},{value:"Inspect Generated Code",id:"inspect-generated-code",level:3},{value:"Running Tests",id:"running-tests",level:2},{value:"Run All Tests",id:"run-all-tests",level:3},{value:"Run Specific Test",id:"run-specific-test",level:3},{value:"Run Test with Debugging",id:"run-test-with-debugging",level:3},{value:"Test-Time Hygiene",id:"test-time-hygiene",level:2},{value:"Error Handling Best Practices",id:"error-handling-best-practices",level:2},{value:"Quick Reference",id:"quick-reference",level:2},{value:"Related Topics",id:"related-topics",level:2}];function a(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"This page covers common issues and debugging techniques for Apache Fory\u2122 Rust."}),"\n",(0,s.jsx)(n.h2,{id:"common-issues",children:"Common Issues"}),"\n",(0,s.jsx)(n.h3,{id:"type-registry-errors",children:"Type Registry Errors"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Error"}),": ",(0,s.jsx)(n.code,{children:"TypeId ... not found in type_info registry"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cause"}),": The type was never registered with the current ",(0,s.jsx)(n.code,{children:"Fory"})," instance."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solution"}),": Register the type before serialization:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"let mut fory = Fory::default();\nfory.register::<MyStruct>(100)?;  // Register before use\n"})}),"\n",(0,s.jsx)(n.p,{children:"Confirm that:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Every serializable struct or trait implementation calls ",(0,s.jsx)(n.code,{children:"fory.register::<T>(type_id)"})]}),"\n",(0,s.jsx)(n.li,{children:"The same IDs are reused on the deserialize side"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"type-mismatch-errors",children:"Type Mismatch Errors"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cause"}),": Field types are incompatible or schema has changed."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solution"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Enable compatible mode for schema evolution"}),"\n",(0,s.jsx)(n.li,{children:"Ensure field types match across versions"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"let fory = Fory::default().compatible(true);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"debugging-techniques",children:"Debugging Techniques"}),"\n",(0,s.jsx)(n.h3,{id:"enable-panic-on-error-for-backtraces",children:"Enable Panic on Error for Backtraces"}),"\n",(0,s.jsxs)(n.p,{children:["Toggle ",(0,s.jsx)(n.code,{children:"FORY_PANIC_ON_ERROR=1"})," alongside ",(0,s.jsx)(n.code,{children:"RUST_BACKTRACE=1"})," to panic at the exact site an error is constructed:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"RUST_BACKTRACE=1 FORY_PANIC_ON_ERROR=1 cargo test --features tests\n"})}),"\n",(0,s.jsx)(n.p,{children:"Reset the variable afterwards to avoid aborting user-facing code paths."}),"\n",(0,s.jsx)(n.h3,{id:"struct-field-tracing",children:"Struct Field Tracing"}),"\n",(0,s.jsxs)(n.p,{children:["Add the ",(0,s.jsx)(n.code,{children:"#[fory(debug)]"})," attribute alongside ",(0,s.jsx)(n.code,{children:"#[derive(ForyObject)]"})," to emit hook invocations:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-rust",children:"#[derive(ForyObject)]\n#[fory(debug)]\nstruct MyStruct {\n    field1: i32,\n    field2: String,\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Once compiled with debug hooks, call these functions to plug in custom callbacks:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"set_before_write_field_func"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"set_after_write_field_func"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"set_before_read_field_func"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"set_after_read_field_func"})}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"reset_struct_debug_hooks()"})," when you want the defaults back."]}),"\n",(0,s.jsx)(n.h3,{id:"lightweight-logging",children:"Lightweight Logging"}),"\n",(0,s.jsxs)(n.p,{children:["Without custom hooks, enable ",(0,s.jsx)(n.code,{children:"ENABLE_FORY_DEBUG_OUTPUT=1"})," to print field-level read/write events:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ENABLE_FORY_DEBUG_OUTPUT=1 cargo test --features tests\n"})}),"\n",(0,s.jsx)(n.p,{children:"This is especially useful when investigating alignment or cursor mismatches."}),"\n",(0,s.jsx)(n.h3,{id:"inspect-generated-code",children:"Inspect Generated Code"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"cargo expand"})," to inspect code generated by Fory derive macros:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cargo expand --test mod $mod$::$file$ > expanded.rs\n"})}),"\n",(0,s.jsx)(n.h2,{id:"running-tests",children:"Running Tests"}),"\n",(0,s.jsx)(n.h3,{id:"run-all-tests",children:"Run All Tests"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cargo test --features tests\n"})}),"\n",(0,s.jsx)(n.h3,{id:"run-specific-test",children:"Run Specific Test"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cargo test -p tests --test $test_file $test_method\n"})}),"\n",(0,s.jsx)(n.h3,{id:"run-test-with-debugging",children:"Run Test with Debugging"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"RUST_BACKTRACE=1 FORY_PANIC_ON_ERROR=1 ENABLE_FORY_DEBUG_OUTPUT=1 \\\n  cargo test --test mod $dir$::$test_file::$test_method -- --nocapture\n"})}),"\n",(0,s.jsx)(n.h2,{id:"test-time-hygiene",children:"Test-Time Hygiene"}),"\n",(0,s.jsxs)(n.p,{children:["Some integration tests expect ",(0,s.jsx)(n.code,{children:"FORY_PANIC_ON_ERROR"})," to remain unset. Export it only for focused debugging sessions:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# For specific debugging only\nFORY_PANIC_ON_ERROR=1 cargo test -p tests --test specific_test -- --nocapture\n\n# Normal test run (without panic on error)\ncargo test --features tests\n"})}),"\n",(0,s.jsx)(n.h2,{id:"error-handling-best-practices",children:"Error Handling Best Practices"}),"\n",(0,s.jsxs)(n.p,{children:["Prefer the static constructors on ",(0,s.jsx)(n.code,{children:"fory_core::error::Error"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"Error::type_mismatch"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"Error::invalid_data"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"Error::unknown"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This keeps diagnostics consistent and makes opt-in panics work correctly."}),"\n",(0,s.jsx)(n.h2,{id:"quick-reference",children:"Quick Reference"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Environment Variable"}),(0,s.jsx)(n.th,{children:"Purpose"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"RUST_BACKTRACE=1"})}),(0,s.jsx)(n.td,{children:"Enable stack traces"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"FORY_PANIC_ON_ERROR=1"})}),(0,s.jsx)(n.td,{children:"Panic at error site for debugging"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ENABLE_FORY_DEBUG_OUTPUT=1"})}),(0,s.jsx)(n.td,{children:"Print field-level read/write events"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"related-topics",children:"Related Topics"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/0.14/guide/rust/configuration",children:"Configuration"})," - Fory options"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/0.14/guide/rust/type_registration",children:"Type Registration"})," - Registration best practices"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/0.14/guide/rust/schema_evolution",children:"Schema Evolution"})," - Compatible mode"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},11151:(e,n,i)=>{i.d(n,{Z:()=>c,a:()=>o});var s=i(67294);const r={},t=s.createContext(r);function o(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);