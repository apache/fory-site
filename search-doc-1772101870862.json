{"searchDocs":[{"title":"Apache Fory‚Ñ¢ Graduates to Top-Level Apache Project","type":0,"sectionRef":"#","url":"/blog/apache-fory-graduated","content":"","keywords":"","version":null},{"title":"What is Apache Fory?‚Äã","type":1,"pageTitle":"Apache Fory‚Ñ¢ Graduates to Top-Level Apache Project","url":"/blog/apache-fory-graduated#what-is-apache-fory","content":" Apache Fory is a blazingly-fast multi-language serialization framework that revolutionizes data exchange between systems and languages. By leveraging JIT compilation and zero-copy techniques, Fory delivers up to 170x faster performance compared to other serialization frameworkds while being extremely easy to use.  ","version":null,"tagName":"h2"},{"title":"Key Features:‚Äã","type":1,"pageTitle":"Apache Fory‚Ñ¢ Graduates to Top-Level Apache Project","url":"/blog/apache-fory-graduated#key-features","content":" üåê Cross-language serialization: Java, Python, C++, Go, JavaScript, Rust, Scala, Kotlin‚ö°Ô∏è Zero-copy optimization: Minimizes memory overhead for large datasetsüîÑ Schema evolution: Forward/backward compatibility for evolving data structuresüîí Security-first: Class registration prevents deserialization vulnerabilitiesüì¶ Multiple protocols: Object graph, Row format, and Java-compatible modes  ","version":null,"tagName":"h3"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Apache Fory‚Ñ¢ Graduates to Top-Level Apache Project","url":"/blog/apache-fory-graduated#quick-start","content":" Java serialization example:  Fory fory = Fory.builder().build(); fory.register(DataModel.class); DataModel obj = new DataModel(/*...*/); byte[] bytes = fory.serialize(obj); DataModel restored = (DataModel) fory.deserialize(bytes);   Python serialization example  from dataclasses import dataclass import pyfory class Foo: name: str: age: int pyfory.register(Foo) bytes = pyfory.serialize(Foo(&quot;Shawn&quot;, 30)) # Ultra-fast encoding restored = pyfory.deserialize(bytes) # Instant decoding   ","version":null,"tagName":"h3"},{"title":"The Incubation Journey‚Äã","type":1,"pageTitle":"Apache Fory‚Ñ¢ Graduates to Top-Level Apache Project","url":"/blog/apache-fory-graduated#the-incubation-journey","content":" Since entering the Apache Incubator in December 2023, Fory has achieved significant milestones.  ","version":null,"tagName":"h2"},{"title":"Community Growth‚Äã","type":1,"pageTitle":"Apache Fory‚Ñ¢ Graduates to Top-Level Apache Project","url":"/blog/apache-fory-graduated#community-growth","content":" üë• 90+ contributorsüîß 6 new committers added, with 1 promoted to PPMCü§ù Diverse adoption across fintech, e-commerce, and cloud  ","version":null,"tagName":"h3"},{"title":"Technical Progress‚Äã","type":1,"pageTitle":"Apache Fory‚Ñ¢ Graduates to Top-Level Apache Project","url":"/blog/apache-fory-graduated#technical-progress","content":" üöÄ 14 ASF-compliant releases (0.5.0 to 0.11.2)üîÑ 4 release managers ensuring sustainable operations‚Ñ¢ Trademark resolution: Successful rename from Fury ‚Üí Fory‚úÖ Maturity validation: Full compliance with ASF graduation requirements  ","version":null,"tagName":"h3"},{"title":"Apache Way Adoption‚Äã","type":1,"pageTitle":"Apache Fory‚Ñ¢ Graduates to Top-Level Apache Project","url":"/blog/apache-fory-graduated#apache-way-adoption","content":" üì¨ 100% public discussions on dev@ mailing listsüó≥Ô∏è Consensus-driven decisions through formal votingüåê Complete infrastructure migration to Fory namespace  ","version":null,"tagName":"h3"},{"title":"Why Graduation Matters‚Äã","type":1,"pageTitle":"Apache Fory‚Ñ¢ Graduates to Top-Level Apache Project","url":"/blog/apache-fory-graduated#why-graduation-matters","content":" Graduation signifies that Fory has demonstrated:  Sustainable governance with diverse PMC leadershipEnterprise-ready stability through rigorous releasesCommunity independence with no vendor dominanceASF policy compliance including security and licensing  ","version":null,"tagName":"h2"},{"title":"What's Next‚Äã","type":1,"pageTitle":"Apache Fory‚Ñ¢ Graduates to Top-Level Apache Project","url":"/blog/apache-fory-graduated#whats-next","content":" As a Top-Level Project, Fory's roadmap includes:  Enhanced Capabilities Improved schema evolution for cross-language compatibilityProducation ready support for Rust/C++ serializationOptimize Pyfory Performance continuously and provide drop-in replacement support for pickle Ecosystem Integration GRPC IntegrationProtobuf Migration Tool Community Growth Comprehensive user documentationStructured mentorship program for new contributorsProduction case studies with early adopters  ","version":null,"tagName":"h2"},{"title":"Get Involved‚Äã","type":1,"pageTitle":"Apache Fory‚Ñ¢ Graduates to Top-Level Apache Project","url":"/blog/apache-fory-graduated#get-involved","content":" Experience Fory's performance:  Java:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-core&lt;/artifactId&gt; &lt;version&gt;0.11.2&lt;/version&gt; &lt;/dependency&gt;   Python:  pip install pyfory   Join our community:  üåê Website: https://fory.apache.orgüí¨ Slack: fory-project.slack.comüìß Mailing list: dev@fory.apache.orgüêô GitHub: https://github.com/apache/fory  ","version":null,"tagName":"h2"},{"title":"Acknowledgements‚Äã","type":1,"pageTitle":"Apache Fory‚Ñ¢ Graduates to Top-Level Apache Project","url":"/blog/apache-fory-graduated#acknowledgements","content":" The PMC Members of the Fory project are listed as follows, with big thanks to their significant contributions:  Shawn Yang (Chair)tisonXuanwoTwicePJ FanningPan LiXin WangWeipeng Wangliyueolivelli  Big thanks to all contributors who submitted code, reported issues, and improved documentation. This achievement belongs to the entire Apache Fory community! ","version":null,"tagName":"h2"},{"title":"Fory v0.11.0 Released","type":0,"sectionRef":"#","url":"/blog/fory_0_11_0_release","content":"","keywords":"","version":null},{"title":"Highlights‚Äã","type":1,"pageTitle":"Fory v0.11.0 Released","url":"/blog/fory_0_11_0_release#highlights","content":" Add Dart Serialization supportChunk-based map serialization for Java/Python with performance optimizations and XLang supportCross-language homogeneous collection serialization between Java/PythonRefactor XLang type system and serialization for fory goPerformance improvements in Python (dict/tuple/list serialization, C-API optimization)Row format evolution with support for Optional, Records, nested beans, and interface synthesisUnify Java and XLang object serialization with cross-language compatibility for enums, time, arrays, and moreRenamed Apache Fury to Apache Fory  ","version":null,"tagName":"h2"},{"title":"Breaking Changes‚Äã","type":1,"pageTitle":"Fory v0.11.0 Released","url":"/blog/fory_0_11_0_release#breaking-changes","content":" Renamed Apache Fury to Apache Fory, this transition impacts all project components including code repositories, maven groupId, jar names, package names, documentation, and communication channels and the source release name (and location), see Rename Announcement for more details.  ","version":null,"tagName":"h2"},{"title":"Features‚Äã","type":1,"pageTitle":"Fory v0.11.0 Released","url":"/blog/fory_0_11_0_release#features","content":" feat(java): ReplaceResolveSerializer deep copy by @zhaommmmomo in https://github.com/apache/fory/pull/1925perf(python): Enhance the Python benchmark script by @penguin-wwy in https://github.com/apache/fory/pull/1926perf(python): Improve tuple and list serializer performance by @penguin-wwy in https://github.com/apache/fory/pull/1933feat(python): Implement collection serialization protocol by @penguin-wwy in https://github.com/apache/fory/pull/1942perf(python): Pre-allocate size for the dictionary by @penguin-wwy in https://github.com/apache/fory/pull/1949feat(java): use varint for jdk compatible serializers by @chaokunyang in https://github.com/apache/fory/pull/1960feat(java): configurable buffer size limit by @theigl in https://github.com/apache/fory/pull/1963perf(python): Directly access the key-value pairs of a dict by @penguin-wwy in https://github.com/apache/fory/pull/1970feat(python): Hardcoding metastring into passable parameters by @pandalee99 in https://github.com/apache/fory/pull/1987feat(java/python): new xlang type system spec implementation by @chaokunyang in https://github.com/apache/fory/pull/1690feat(c++): Support the UTF-8 to UTF-16 with SIMD by @pandalee99 in https://github.com/apache/fory/pull/1990feat(python): support latin1/utf16 string encoding in python by @chaokunyang in https://github.com/apache/fory/pull/1997feat(c++): add simd accelerated c++ ascii/latin1 check funcion by @chaokunyang in https://github.com/apache/fory/pull/1999perf(python): get object dict for faster field read/write by @chaokunyang in https://github.com/apache/fory/pull/2003perf(python): optimize bytes buffer creation by @chaokunyang in https://github.com/apache/fory/pull/2008feat(java): make 4 bytes utf16 size header optional for utf8 encoding by @chaokunyang in https://github.com/apache/fory/pull/2010feat(ci): support building python on windows by @An-DJ in https://github.com/apache/fory/pull/1885feat(java): Chunk by chunk predictive map serialization protocol by @Hen1ng in https://github.com/apache/fory/pull/1722feat(java): support streaming encode/decode to/from buffer for row format by @chaokunyang in https://github.com/apache/fory/pull/2024feat(c++): Add benchmark for performance evaluation by @pandalee99 in https://github.com/apache/fory/pull/2023feat(java): new implementation and protocol refine for chunk based map serialization by @chaokunyang in https://github.com/apache/fory/pull/2025feat(c++): BenchMark will be a Module by @pandalee99 in https://github.com/apache/fory/pull/2028feat(java): jit support for chunk based map serialization by @chaokunyang in https://github.com/apache/fory/pull/2027feat(java): Add basicMultiConfigFury dataprovider and add basic map unit test use the dataProvider by @Hen1ng in https://github.com/apache/fory/pull/2032feat(python): unify type system between python and xlang serialization in pyfury by @chaokunyang in https://github.com/apache/fory/pull/2034feat(java): deserialize one pojo into another type by @orisgarno in https://github.com/apache/fory/pull/2012feat(python): chunk based map serialization for python by @chaokunyang in https://github.com/apache/fory/pull/2038feat(python): add macos pyfury ci by @chaokunyang in https://github.com/apache/fory/pull/2041feat(python): automatic release pyfury on macos and windows by @chaokunyang in https://github.com/apache/fory/pull/2045feat(javascript): optimize string serializer by @theweipeng in https://github.com/apache/fory/pull/2043feat(java): zstd meta compressor by @orisgarno in https://github.com/apache/fory/pull/2042feat(python): support 3.13 by @penguin-wwy in https://github.com/apache/fory/pull/2046feat(java): support register type by name in java by @chaokunyang in https://github.com/apache/fory/pull/2053feat(spec): remove polymorphic from type id by @chaokunyang in https://github.com/apache/fory/pull/2054feat(java): Add fastpath for collection/map serialize and deserialize by @Hen1ng in https://github.com/apache/fory/pull/2050perf(python): upgrade pyarrow version to 15.0.0 by @pandalee99 in https://github.com/apache/fory/pull/2056feat(python): chunk based map serialization in pure python by @pandalee99 in https://github.com/apache/fory/pull/2037build(bazel): Extracts compile_commands.json by @penguin-wwy in https://github.com/apache/fory/pull/2059feat(javascript): simplify the definition of object type description by @theweipeng in https://github.com/apache/fory/pull/2058perf(java): Optimize Computational Efficiency of MetaStringEncoder::encodeGeneric by @LouisLou2 in https://github.com/apache/fory/pull/2072feat(javascript): Impl xlang by @theweipeng in https://github.com/apache/fory/pull/2075perf(python): Optimize sequence buffer writing via the c-api by @penguin-wwy in https://github.com/apache/fory/pull/2078feat(javascript): Speed up string serializer by @theweipeng in https://github.com/apache/fory/pull/2083feat(java): extra entry in disallowed.txt by @pjfanning in https://github.com/apache/fory/pull/2098perf(java): Refactor ThreadPoolFury to improve performance by @moooonk in https://github.com/apache/fory/pull/2092perf(java): Improve performance by using System.arraycopy to copy between byte arrays by @Cybermaxke in https://github.com/apache/fory/pull/2101feat(java): use sha256 to check disallowed.txt tamper by @chaokunyang in https://github.com/apache/fory/pull/2102perf(java): Refactor field sorting in StructSerializer to cache transformed field names and avoid redundant computation by @LouisLou2 in https://github.com/apache/fory/pull/2091feat(java): support passed tracking ref meta when building serializers by @chaokunyang in https://github.com/apache/fory/pull/2113feat(java): support nested bean in array/collection/map for row format by @chaokunyang in https://github.com/apache/fory/pull/2116feat(java): support inconsistent registration by name/id by @chaokunyang in https://github.com/apache/fory/pull/2120feat: xlang map chunk serialization between java/python by @chaokunyang in https://github.com/apache/fory/pull/2127feat: xlang homogeneous collection serialization between java/python by @chaokunyang in https://github.com/apache/fory/pull/2130feat(chore): bump version support kotlin by @chaokunyang in https://github.com/apache/fory/pull/2134feat(dart): Add Fury Dart Support by @LouisLou2 in https://github.com/apache/fory/pull/2112refactor(java): refactor object serializer for unifying xlang/java serialization in java by @chaokunyang in https://github.com/apache/fory/pull/2139refactor(java): move methods from object serializer to abstract object serializer by @chaokunyang in https://github.com/apache/fory/pull/2140feat(java): unify java and xlang object serialization by @chaokunyang in https://github.com/apache/fory/pull/2146feat(java): support enum/time/array final types in xlang serialization by @chaokunyang in https://github.com/apache/fory/pull/2164feat(java): FuryField annotation hints for struct serialization by @Hen1ng in https://github.com/apache/fory/pull/2036feat(kotlin): add kotlin ci by @pandalee99 in https://github.com/apache/fory/pull/2176perf(kotlin): Add multiple versions of kotlin CI by @pandalee99 in https://github.com/apache/fory/pull/2184feat(dart): add test_config.yaml and apply TestConfig for environment-specific settings by @LouisLou2 in https://github.com/apache/fory/pull/2183feat: add Dart to Language enums across all implementations by @LouisLou2 in https://github.com/apache/fory/pull/2187feat(go): fury go implements new xlang by @pandalee99 in https://github.com/apache/fory/pull/2198feat(java): add protobuf serializer for message and byte string by @chaokunyang in https://github.com/apache/fory/pull/2213feat(spec): update type meta encoding by @chaokunyang in https://github.com/apache/fory/pull/2216feat(java): type meta encoding for xlang in java by @chaokunyang in https://github.com/apache/fory/pull/2197feat(java): support trackingRef in furyField by @Hen1ng in https://github.com/apache/fory/pull/2168feat(java): add DescriptorBuilder for easy build and copying Descriptor by @Hen1ng in https://github.com/apache/fory/pull/2229feat(java): Support furyField nullable in codeGen pattern by @Hen1ng in https://github.com/apache/fory/pull/2191feat(java): row encoder supports custom types and collections by @stevenschlansker in https://github.com/apache/fory/pull/2243test(benchmark): add msgpack serialization/deserialization to benchmark by @Kn0688 in https://github.com/apache/fory/pull/2242feat(go): fury-go implements adaptation and optimization for new xlang by @pandalee99 in https://github.com/apache/fory/pull/2230perf(c++): Evaluate the implementation effect &amp;&amp;simdutf performs partial vectorization by @pandalee99 in https://github.com/apache/fory/pull/2033feat(java): fury row encoder now supports implementing interfaces with simple value type by @stevenschlansker in https://github.com/apache/fory/pull/2250feat(java): row format supports Optional by @stevenschlansker in https://github.com/apache/fory/pull/2254feat(java): row format supports Record types by @stevenschlansker in https://github.com/apache/fory/pull/2256perf(go): Optimize the type registration system &amp;&amp; Reduce useless code by @pandalee99 in https://github.com/apache/fory/pull/2262feat(java): support meta shared serialization for xlang in java by @chaokunyang in https://github.com/apache/fory/pull/2276feat(python): replace &quot;_class&quot; prefix with &quot;_type&quot; in metashare by @urlyy in https://github.com/apache/fory/pull/2290feat(java): Adding explanatory message to deserializeNonexistentClass misconfiguration in Config by @drse in https://github.com/apache/fory/pull/2300feat(java): row encoder supports synthesizing interfaces nested inside of records by @stevenschlansker in https://github.com/apache/fory/pull/2304feat(java): Support customized serializer for abstract or interface. by @CherishCai in https://github.com/apache/fory/pull/2311feat(java): row encoder supports custom rewriting values without changing their type by @stevenschlansker in https://github.com/apache/fory/pull/2305feat(java): support multi-dimensional array field serialization in xlang meta shared mode by @OmCheeLin in https://github.com/apache/fory/pull/2314feat(python): bump cython to 3.1.1 by @penguin-wwy in https://github.com/apache/fory/pull/2318  ","version":null,"tagName":"h2"},{"title":"Bug Fix‚Äã","type":1,"pageTitle":"Fory v0.11.0 Released","url":"/blog/fory_0_11_0_release#bug-fix","content":" fix(doc): set compressString default value to false by @chaokunyang in https://github.com/apache/fory/pull/1913fix(java): Move schema caching to unsafe trait to avoid issues when using non-inferred schema. by @wywen in https://github.com/apache/fory/pull/1944fix(java): ClassLoaderFuryPooled#setFactoryCallback cannot effect old Fury by @MrChang0 in https://github.com/apache/fory/pull/1946fix(java): fix find constructor error in generated serializer class caused by duplicated class classloading for Fury by @chaokunyang in https://github.com/apache/fory/pull/1948fix(c++): fix bazel install by @chaokunyang in https://github.com/apache/fory/pull/1979fix(java): Fix flakiness in ExpressionVisitorTest#testTraverseExpression by @AmitPr in https://github.com/apache/fory/pull/1968fix(java): only print warn message if scopedMetaShareEnabled is true ‚Ä¶ by @zhfeng in https://github.com/apache/fory/pull/1985fix(java): Fix the issue caused by not using readCompressedBytesString during deserialization when string compression is enabled. by @Aliothmoon in https://github.com/apache/fory/pull/1991fix(java): Compatible mode on de/serialize api failed to deserialize by @orisgarno in https://github.com/apache/fory/pull/1996fix(java): chunk map serialize an error by @Hen1ng in https://github.com/apache/fory/pull/2030fix(java): fix duplicate entry write at max chunk size bound by @chaokunyang in https://github.com/apache/fory/pull/2040fix(java): Remove duplicate maven dependency by @Hen1ng in https://github.com/apache/fory/pull/2044fix(python): Fix missing parameters and old API names by @pandalee99 in https://github.com/apache/fory/pull/2049fix(java): fix read null chunk out of bound by @chaokunyang in https://github.com/apache/fory/pull/2065fix(java): Fix error with MemoryBuffer::readBytesAsInt64 when not in LITTLE_ENDIAN mode by @LouisLou2 in https://github.com/apache/fory/pull/2069fix(java): fix read primitives error on fill buffer bound by @chaokunyang in https://github.com/apache/fory/pull/2064fix(java): java.util.Date and its subclasses are mutable by @moooonk in https://github.com/apache/fory/pull/2076fix(java): fix ImmutableCollections$SubList duplicate registration by @w-yfan in https://github.com/apache/fory/pull/2074fix(java): Modify some mistake by @Hen1ng in https://github.com/apache/fory/pull/2086fix(python): inconsistent struct hash calculation between Java and Python by @LouisLou2 in https://github.com/apache/fory/pull/2108fix(java): fix serialization npe of collection with all null elems by @chaokunyang in https://github.com/apache/fory/pull/2111fix(java): fix not null value flag by @chaokunyang in https://github.com/apache/fory/pull/2114fix(java): use registered id to sort fields by @chaokunyang in https://github.com/apache/fory/pull/2115fix(java): fix disallowed.txt check in windows by @chaokunyang in https://github.com/apache/fory/pull/2128fix(java): fix nested chunk map serialization error when generics exists by @chaokunyang in https://github.com/apache/fory/pull/2136fix(java): fix DisallowedList calculate hash in Windows by @moooonk in https://github.com/apache/fory/pull/2142fix(java): fix fury logger log exception by @chaokunyang in https://github.com/apache/fory/pull/2153fix(java): fix xlang container field deserialization type error by @chaokunyang in https://github.com/apache/fory/pull/2161fix(java): fix nested map chunk serialization codegen by @chaokunyang in https://github.com/apache/fory/pull/2172fix(kotlin): fix kotlin compile error by @chaokunyang in https://github.com/apache/fory/pull/2173fix(dart): fix inappropriate naming and align test titles by @LouisLou2 in https://github.com/apache/fory/pull/2180fix(dart): replace string-based type selection with enum in FixedNum factory method by @LouisLou2 in https://github.com/apache/fory/pull/2185fix(java): ensure readVarUint36Small reads full bits regardless of remaining buffer size by @LouisLou2 in https://github.com/apache/fory/pull/2179test(java): add test for fix of readVarUint36Small behavior by @LouisLou2 in https://github.com/apache/fory/pull/2186fix(python): fix pyfury build using pyproject.toml by @chaokunyang in https://github.com/apache/fory/pull/2206fix(java): ensure FuryObjectInputStream.read never returns 0 when length&gt;0 #2204 by @X-czh in https://github.com/apache/fory/pull/2205fix(python): TimestampSerializer fails on Windows for naive datetimes near epoch by @LouisLou2 in https://github.com/apache/fory/pull/2209fix(java): Fix empty string processing in MetaStringBytes by @LouisLou2 in https://github.com/apache/fory/pull/2212fix(java): fix field super class missing in compatible mode by @chaokunyang in https://github.com/apache/fory/pull/2214fix(java): mark fury-test-core as test dep in fury extensions by @chaokunyang in https://github.com/apache/fory/pull/2231fix(java): MemoryBuffer getRemainingBytes can return unexpected results on a slice by @stevenschlansker in https://github.com/apache/fory/pull/2237fix(java): use serialization binding by @Hen1ng in https://github.com/apache/fory/pull/2241fix(C++): Fix reversed parameters and incorrect calls in string_util benchmark by @lzaeh in https://github.com/apache/fory/pull/2246fix(java): fix row type enum properties by @stevenschlansker in https://github.com/apache/fory/pull/2258fix(java): fix generics when write/read null map kv chunk by @chaokunyang in https://github.com/apache/fory/pull/2261fix(java): row encoder incorrectly interprets type parameters as cycles by @stevenschlansker in https://github.com/apache/fory/pull/2265fix(scala): Ensure singleton classes are initialized before reading by @creddy in https://github.com/apache/fory/pull/2267fix(go): fix metastringbytes inconsistency issue by @lzaeh in https://github.com/apache/fory/pull/2269fix(java): descriptors for beans should not include static methods by @stevenschlansker in https://github.com/apache/fory/pull/2281fix(java): raise exception when registering invalid serializer for Map/List by @OmCheeLin in https://github.com/apache/fory/pull/2291fix(java): xlang test skip needs correct import in newer python versions by @stevenschlansker in https://github.com/apache/fory/pull/2296fix(java): row encoder interface synthesis handle (Optional) null correctly by @stevenschlansker in https://github.com/apache/fory/pull/2306fix(java): Use (long, long, byte) key for MetaStringBytes cache to prevent collisions by @LouisLou2 in https://github.com/apache/fory/pull/2308fix(python): update python benchmark script by @penguin-wwy in https://github.com/apache/fory/pull/2315  ","version":null,"tagName":"h2"},{"title":"Other Improvements‚Äã","type":1,"pageTitle":"Fory v0.11.0 Released","url":"/blog/fory_0_11_0_release#other-improvements","content":" chore(ci): Migrate the ci from macOS 12 to macOS 13 by @penguin-wwy in https://github.com/apache/fory/pull/1927chore: bump release version to 0.9.0 by @chaokunyang in https://github.com/apache/fory/pull/1940chore(Rust): fix lint problems by @theweipeng in https://github.com/apache/fory/pull/1962docs(java): add object mapping example and tests by @chaokunyang in https://github.com/apache/fory/pull/1974chore(python): drop py3.7 support by @chaokunyang in https://github.com/apache/fory/pull/1981chore(c++): Function inlining and code tuning by @pandalee99 in https://github.com/apache/fory/pull/2002style(cpp): rename logging level with &quot;FURY_&quot; prefix by @An-DJ in https://github.com/apache/fory/pull/2016docs: update copyright date in NOTICE by @caicancai in https://github.com/apache/fory/pull/2029docs(java): update java serialization schema compatibility doc by @chaokunyang in https://github.com/apache/fory/pull/2047docs: Update to latest version by @theweipeng in https://github.com/apache/fory/pull/2080Update snapshot version by @chaokunyang in https://github.com/apache/fory/pull/2081chore: remove required_linear_history by @chaokunyang in https://github.com/apache/fory/pull/2122chore: fix license issue by @chaokunyang in https://github.com/apache/fory/pull/2137chore(java): use the SHA256_HASH field value directly. by @LiangliangSui in https://github.com/apache/fory/pull/2144chore(java): Update the content that needs to be corrected when reading the code. by @LiangliangSui in https://github.com/apache/fory/pull/2143chore: update copyright year to 2025 by @chaokunyang in https://github.com/apache/fory/pull/2149chore: bump release version to 0.10.1 by @chaokunyang in https://github.com/apache/fory/pull/2151chore(dart): remove unused dart/fury-test/lib/main.dart by @LouisLou2 in https://github.com/apache/fory/pull/2181chore: bump release version to 0.10.2 by @LiangliangSui in https://github.com/apache/fory/pull/2207chore(java): reduce java test log by @chaokunyang in https://github.com/apache/fory/pull/2217chore(.asf.yaml): enable rebase-and-merge button by @chaokunyang in https://github.com/apache/fory/pull/2220chore(github): fix YAML warnings about spaces before comments by @stevenschlansker in https://github.com/apache/fory/pull/2225chore(java): janino 3.1.12 by @stevenschlansker in https://github.com/apache/fory/pull/2226chore(java): jdk 24 build support by @stevenschlansker in https://github.com/apache/fory/pull/2224chore(javascript): remove nodejs 12 support by @chaokunyang in https://github.com/apache/fory/pull/2233chore(java): gitignore testng output by @stevenschlansker in https://github.com/apache/fory/pull/2238chore: fix clippy warning by @theweipeng in https://github.com/apache/fory/pull/2240chore: Delete the redundant comments and add the document by @pandalee99 in https://github.com/apache/fory/pull/2244chore: bump release version to 0.10.3 by @pandalee99 in https://github.com/apache/fory/pull/2252chore: rename apache fury to apache fory by @chaokunyang in https://github.com/apache/fory/pull/2263chore: keep fury for maven artifact by @chaokunyang in https://github.com/apache/fory/pull/2264chore(java): skip xlang tests when pyfory is not available by @stevenschlansker in https://github.com/apache/fory/pull/2266chore(java): Use crossLanguage instead of language in Fory by @CherishCai in https://github.com/apache/fory/pull/2274chore(java): fix xlang test skip in the case where there is no Python at all by @stevenschlansker in https://github.com/apache/fory/pull/2280chore(java): gitignore test-output from integration_tests as well as java by @stevenschlansker in https://github.com/apache/fory/pull/2282chore: update fory rename in README.md by @chaokunyang in https://github.com/apache/fory/pull/2292chore: Some Fory changes in README.md by @pjfanning in https://github.com/apache/fory/pull/2295chore: update fory logo by @chaokunyang in https://github.com/apache/fory/pull/2298chore(java): skip find customized serializer when absClassInfo is empty by @CherishCai in https://github.com/apache/fory/pull/2316  ","version":null,"tagName":"h2"},{"title":"New Contributors‚Äã","type":1,"pageTitle":"Fory v0.11.0 Released","url":"/blog/fory_0_11_0_release#new-contributors","content":" @theigl made their first contribution in https://github.com/apache/fory/pull/1963@AmitPr made their first contribution in https://github.com/apache/fory/pull/1968@zhfeng made their first contribution in https://github.com/apache/fory/pull/1985@Hen1ng made their first contribution in https://github.com/apache/fory/pull/1722@LouisLou2 made their first contribution in https://github.com/apache/fory/pull/2069@moooonk made their first contribution in https://github.com/apache/fory/pull/2076@w-yfan made their first contribution in https://github.com/apache/fory/pull/2074@Cybermaxke made their first contribution in https://github.com/apache/fory/pull/2101@X-czh made their first contribution in https://github.com/apache/fory/pull/2205@stevenschlansker made their first contribution in https://github.com/apache/fory/pull/2225@Kn0688 made their first contribution in https://github.com/apache/fory/pull/2242@lzaeh made their first contribution in https://github.com/apache/fory/pull/2246@creddy made their first contribution in https://github.com/apache/fory/pull/2267@CherishCai made their first contribution in https://github.com/apache/fory/pull/2274@OmCheeLin made their first contribution in https://github.com/apache/fory/pull/2291@drse made their first contribution in https://github.com/apache/fory/pull/2300  Full Changelog: https://github.com/apache/fory/compare/v0.10.3...v0.11.0-rc2 ","version":null,"tagName":"h2"},{"title":"Fory v0.11.1 Released","type":0,"sectionRef":"#","url":"/blog/fory_0_11_1_release","content":"","keywords":"","version":null},{"title":"Features‚Äã","type":1,"pageTitle":"Fory v0.11.1 Released","url":"/blog/fory_0_11_1_release#features","content":" feat(java): row encoder supports synthesizing interfaces nested inside of records by @stevenschlansker in https://github.com/apache/fory/pull/2304feat(java): Support customized serializer for abstract or interface. by @CherishCai in https://github.com/apache/fory/pull/2311feat(java): row encoder supports custom rewriting values without changing their type by @stevenschlansker in https://github.com/apache/fory/pull/2305feat(java): support multi-dimensional array field serialization in xlang meta shared mode by @OmCheeLin in https://github.com/apache/fory/pull/2314feat(python): bump cython to 3.1.1 by @penguin-wwy in https://github.com/apache/fory/pull/2318feat(java): array row encoder supports set of interface type by @stevenschlansker in https://github.com/apache/fory/pull/2333feat(java): support maven shade for disallowed.txt by @chaokunyang in https://github.com/apache/fory/pull/2327feat(java): store OptionalInt, OptionalLong, OptionalDouble same as nullable values by @stevenschlansker in https://github.com/apache/fory/pull/2338  ","version":null,"tagName":"h2"},{"title":"Bug Fix‚Äã","type":1,"pageTitle":"Fory v0.11.1 Released","url":"/blog/fory_0_11_1_release#bug-fix","content":" fix(java): row encoder interface synthesis handle (Optional) null correctly by @stevenschlansker in https://github.com/apache/fory/pull/2306fix(java): Use (long, long, byte) key for MetaStringBytes cache to prevent collisions by @LouisLou2 in https://github.com/apache/fory/pull/2308fix(python): update python benchmark script by @penguin-wwy in https://github.com/apache/fory/pull/2315fix(java): fix row encoder synthesized interface lazy-decoding of Optional by @stevenschlansker in https://github.com/apache/fory/pull/2320fix(java): fix row format handling Optional of type with custom codec by @stevenschlansker in https://github.com/apache/fory/pull/2321fix(java): row encoder array element serializer created too late by @stevenschlansker in https://github.com/apache/fory/pull/2323fix(python): fix py3.13 ci on windows by @chaokunyang in https://github.com/apache/fory/pull/2334fix(python): correct compute_string_hash usage in StructHashVisitor.visit_customized by @lzaeh in https://github.com/apache/fory/pull/2335fix(java): fix register serializer for abstract class by @chaokunyang in https://github.com/apache/fory/pull/2347fix(java): fix map nested array type serialization codegen by @chaokunyang in https://github.com/apache/fory/pull/2352  ","version":null,"tagName":"h2"},{"title":"Other Improvements‚Äã","type":1,"pageTitle":"Fory v0.11.1 Released","url":"/blog/fory_0_11_1_release#other-improvements","content":" chore(java): skip find customized serializer when absClassInfo is empty by @CherishCai in https://github.com/apache/fory/pull/2316chore: add release note generate tool by @chaokunyang in https://github.com/apache/fory/pull/2322chore: Update README.md for fory rename by @chaokunyang in https://github.com/apache/fory/pull/2324chore: update slack invite link to fory by @chaokunyang in https://github.com/apache/fory/pull/2325perf(java): Improve zone offset deserialization performance by overriding JDK caching by @Cybermaxke in https://github.com/apache/fory/pull/2336chore: bump release version to 0.11.0 by @chaokunyang in https://github.com/apache/fory/pull/2340perf(java): update benchmark plot by @chaokunyang in https://github.com/apache/fory/pull/2342chore: update plots fro compatible by @chaokunyang in https://github.com/apache/fory/pull/2344docs: add document for customized map collection serializers by @chaokunyang in https://github.com/apache/fory/pull/2351docs: add row format guide for ext and interface types by @nabilshafi in https://github.com/apache/fory/pull/2346chore(java): ProtobufDispatcher should trigger log warning at most once by @ClaudioConsolmagno in https://github.com/apache/fory/pull/2353docs: format markdown docs by @chaokunyang in https://github.com/apache/fory/pull/2354chore: refine validate serializers message for map/collection by @chaokunyang in https://github.com/apache/fory/pull/2355  ","version":null,"tagName":"h2"},{"title":"New Contributors‚Äã","type":1,"pageTitle":"Fory v0.11.1 Released","url":"/blog/fory_0_11_1_release#new-contributors","content":" @nabilshafi made their first contribution in https://github.com/apache/fory/pull/2346@ClaudioConsolmagno made their first contribution in https://github.com/apache/fory/pull/2353  Full Changelog: https://github.com/apache/fory/compare/v0.11.0...v0.11.1-rc1 ","version":null,"tagName":"h2"},{"title":"Fory v0.11.2 Released","type":0,"sectionRef":"#","url":"/blog/fory_0_11_2_release","content":"","keywords":"","version":null},{"title":"Features‚Äã","type":1,"pageTitle":"Fory v0.11.2 Released","url":"/blog/fory_0_11_2_release#features","content":" feat(python): Add Python Linux ARM64 support and optimize Bazel installation by @esafak in https://github.com/apache/fory/pull/2357feat(java): row encoder array deserialization into List supports lazy access by @stevenschlansker in https://github.com/apache/fory/pull/2358  ","version":null,"tagName":"h2"},{"title":"Bug Fixes‚Äã","type":1,"pageTitle":"Fory v0.11.2 Released","url":"/blog/fory_0_11_2_release#bug-fixes","content":" fix(java): fix register class async jit thread safety by @chaokunyang in https://github.com/apache/fory/pull/2365fix: fix WeakHashMap thread safety by @chaokunyang in https://github.com/apache/fory/pull/2366fix(rust): fix rust lint error by @chaokunyang in https://github.com/apache/fory/pull/2373fix(java): fix automatic module conflict with maven shaded dependencies by @chaokunyang in https://github.com/apache/fory/pull/2372  ","version":null,"tagName":"h2"},{"title":"Documentation‚Äã","type":1,"pageTitle":"Fory v0.11.2 Released","url":"/blog/fory_0_11_2_release#documentation","content":" docs: adding multi-threading clarifications for java serialization by @drse in https://github.com/apache/fory/pull/2356docs: fix document markdown lint error by @LiangliangSui in https://github.com/apache/fory/pull/2360docs: Update java_serialization_guide.md - Fury - Fory by @apupier in https://github.com/apache/fory/pull/2362docs: Update java_serialization_guide.md - fury --&gt; fory by @apupier in https://github.com/apache/fory/pull/2361docs: update jdk 24 support in README.md by @chaokunyang in https://github.com/apache/fory/pull/2368  ","version":null,"tagName":"h2"},{"title":"Chores‚Äã","type":1,"pageTitle":"Fory v0.11.2 Released","url":"/blog/fory_0_11_2_release#chores","content":" chore: bump version 0.11.1 by @LiangliangSui in https://github.com/apache/fory/pull/2369  Full Changelog: https://github.com/apache/fory/compare/v0.11.1...v0.11.2 ","version":null,"tagName":"h2"},{"title":"Fory v0.12.0 Released","type":0,"sectionRef":"#","url":"/blog/fory_0_12_0_release","content":"","keywords":"","version":null},{"title":"Highlights‚Äã","type":1,"pageTitle":"Fory v0.12.0 Released","url":"/blog/fory_0_12_0_release#highlights","content":" [Python] Support Python __getstate__/__setstate__/__reduce__ serialization protocol[Python] Support serialize python function[Java] Use JDK11 for fory-format module[Scala]Support default value for scala case/pojo classes when deseralizing[Kotlin] Support default value for kotlin data classes when deserializing  ","version":null,"tagName":"h2"},{"title":"Features‚Äã","type":1,"pageTitle":"Fory v0.12.0 Released","url":"/blog/fory_0_12_0_release#features","content":" refactor(python): replace Black and Flake8 with Ruff by @esafak in https://github.com/apache/fory/pull/2388refactor(python): Unify DataClassSerializer and ComplexObjectSerializer by @esafak in https://github.com/apache/fory/pull/2389refactor(python): Simplify require_pyarrow, remove undefined pytest.mark by @esafak in https://github.com/apache/fory/pull/2396feat(python): Replace usage of ComplexObjectSerializer with DataClassSerializer by @esafak in https://github.com/apache/fory/pull/2395feat(python): Add StatefulSerializer using getstate, setstate by @esafak in https://github.com/apache/fory/pull/2400feat(python): Implement ReduceSerializer for reduce support by @esafak in https://github.com/apache/fory/pull/2401feat(python): Support codegen with XLANG in DataClassSerializer by @esafak in https://github.com/apache/fory/pull/2405perf(Go/python): Type system compatibility upgrade by @pandalee99 in https://github.com/apache/fory/pull/2339feat(python): Add FunctionSerializer for function serialization by @esafak in https://github.com/apache/fory/pull/2404feat: Implement ObjectSerializer for custom objects by @esafak in https://github.com/apache/fory/pull/2413feat(scala): support scala object with default values by @chaokunyang in https://github.com/apache/fory/pull/2412refactor(java): refactor java default value support for scala/kotlin by @chaokunyang in https://github.com/apache/fory/pull/2415feat(kotlin): support default value for kotlin data class by @chaokunyang in https://github.com/apache/fory/pull/2416feat(kotlin): add cache to kotlin default value support by @chaokunyang in https://github.com/apache/fory/pull/2419refactor(ci): Migrate CI runner to Python scripts by @esafak in https://github.com/apache/fory/pull/2406feat(java): use java11 for fory-format module by @chaokunyang in https://github.com/apache/fory/pull/2448feat(python): add register api for python by @chaokunyang in https://github.com/apache/fory/pull/2451feat(java): add graalvm 23 ci by @chaokunyang in https://github.com/apache/fory/pull/2463  ","version":null,"tagName":"h2"},{"title":"Bug Fix‚Äã","type":1,"pageTitle":"Fory v0.12.0 Released","url":"/blog/fory_0_12_0_release#bug-fix","content":" fix: tidy up issues in scala_guide.md by @pjfanning in https://github.com/apache/fory/pull/2374fix(java): ClassDef header calculation error by @LiangliangSui in https://github.com/apache/fory/pull/2382ci(python): Build manylinux_2_28 wheels using auditwheel by @esafak in https://github.com/apache/fory/pull/2381fix: Correct pyarrow installation check and add bazel troubleshooting by @esafak in https://github.com/apache/fory/pull/2418fix(go): fix type writing and reading logic in slice by @lzaeh in https://github.com/apache/fory/pull/2427fix(rust): fix rust lint error by @chaokunyang in https://github.com/apache/fory/pull/2447fix(java): crash when map only contains null value by @LouisLou2 in https://github.com/apache/fory/pull/2444fix(java): MemoryBuffer::readChars by @LouisLou2 in https://github.com/apache/fory/pull/2438fix(java): fix java deploy with different java versions by @chaokunyang in https://github.com/apache/fory/pull/2449fix(java): fix install jdks by @chaokunyang in https://github.com/apache/fory/pull/2450fix(java): fix maven deploy by @chaokunyang in https://github.com/apache/fory/pull/2452fix(java): fix shade janino duplciate entry by @chaokunyang in https://github.com/apache/fory/pull/2453fix(java): fix extension java module conflict by @chaokunyang in https://github.com/apache/fory/pull/2455fix(java): fix extension java module conflict by @chaokunyang in https://github.com/apache/fory/pull/2456fix(java): fix decode classdef for abstract classes by @chaokunyang in https://github.com/apache/fory/pull/2462fix(python): fix pyfory pypi release (#2473) by @chaokunyang in https://github.com/apache/fory/pull/2474fix(python): fix py releases macos13 by @chaokunyang in https://github.com/apache/fory/pull/2479  ","version":null,"tagName":"h2"},{"title":"Other Improvements‚Äã","type":1,"pageTitle":"Fory v0.12.0 Released","url":"/blog/fory_0_12_0_release#other-improvements","content":" chore(Scala): upgrade sbt and plugins by @pjfanning in https://github.com/apache/fory/pull/2379chore(python): add more comprehensive test parameters by @pandalee99 in https://github.com/apache/fory/pull/2377chore(Scala): remove var that can be mutated by @pjfanning in https://github.com/apache/fory/pull/2385chore(Scala): add test for Scala 3 enum by @pjfanning in https://github.com/apache/fory/pull/2386chore(Scala): use setup-sbt CI action by @pjfanning in https://github.com/apache/fory/pull/2387chore(Scala): refactor scala test so it asserts something by @pjfanning in https://github.com/apache/fory/pull/2390chore(Scala): Create DurationTest.scala by @pjfanning in https://github.com/apache/fory/pull/2394chore(Java): handle deserialization scenario that currently throws an IndexOutOfBoundsException by @pjfanning in https://github.com/apache/fory/pull/2399chore: bump release version to 0.11.2 by @pandalee99 in https://github.com/apache/fory/pull/2403chore(deps): bump org.apache.commons:commons-lang3 from 3.12.0 to 3.18.0 in /java/fory-test-core by @dependabot[bot] in https://github.com/apache/fory/pull/2408chore(docs): Fix the names of some documents by @pandalee99 in https://github.com/apache/fory/pull/2411chore(cpp): fix duplicate copyright by @co63oc in https://github.com/apache/fory/pull/2426docs: fix ruff command by @co63oc in https://github.com/apache/fory/pull/2425chore: fix typos by @co63oc in https://github.com/apache/fory/pull/2424chore(dart): fix typos by @co63oc in https://github.com/apache/fory/pull/2428chore: fix typos by @co63oc in https://github.com/apache/fory/pull/2429chore: remove incubating by @chaokunyang in https://github.com/apache/fory/pull/2431chore: fix typos by @co63oc in https://github.com/apache/fory/pull/2433chore: fix typos by @co63oc in https://github.com/apache/fory/pull/2436chore: translate comments by @co63oc in https://github.com/apache/fory/pull/2442chore(python): add execute doc for cross langauge tests in python by @chaokunyang in https://github.com/apache/fory/pull/2420chore(java): arrow 18.3.0 by @stevenschlansker in https://github.com/apache/fory/pull/2458chore: prepare commits for releases-0.12 by @chaokunyang in https://github.com/apache/fory/pull/2470chore(python): disable import format warning by @chaokunyang in https://github.com/apache/fory/pull/2477  ","version":null,"tagName":"h2"},{"title":"New Contributors‚Äã","type":1,"pageTitle":"Fory v0.12.0 Released","url":"/blog/fory_0_12_0_release#new-contributors","content":" @co63oc made their first contribution in https://github.com/apache/fory/pull/2426  Full Changelog: https://github.com/apache/fory/compare/v0.11.2...v0.12.0 ","version":null,"tagName":"h2"},{"title":"Fory v0.12.3 Released","type":0,"sectionRef":"#","url":"/blog/fory_0_12_3_release","content":"","keywords":"","version":null},{"title":"Features‚Äã","type":1,"pageTitle":"Fory v0.12.3 Released","url":"/blog/fory_0_12_3_release#features","content":" feat(java): support concurent map serialization when being updated by @chaokunyang in https://github.com/apache/fory/pull/2617feat(python): support limit pyfory depth by @chaokunyang in https://github.com/apache/fory/pull/2625feat(python): drop-in replacement for pickle serialization by @chaokunyang in https://github.com/apache/fory/pull/2629  ","version":null,"tagName":"h2"},{"title":"Bug Fixes‚Äã","type":1,"pageTitle":"Fory v0.12.3 Released","url":"/blog/fory_0_12_3_release#bug-fixes","content":" fix(java): fix get nested genericType for codegen by @chaokunyang in https://github.com/apache/fory/pull/2632  Full Changelog: https://github.com/apache/fory/compare/v0.12.2...v0.12.3 ","version":null,"tagName":"h2"},{"title":"Fory v0.12.1 Released","type":0,"sectionRef":"#","url":"/blog/fory_0_12_1_release","content":"","keywords":"","version":null},{"title":"Features‚Äã","type":1,"pageTitle":"Fory v0.12.1 Released","url":"/blog/fory_0_12_1_release#features","content":" feat(python): set default languge to python for pyfory by @chaokunyang in https://github.com/apache/fory/pull/2490feat(python): add register api to python by @chaokunyang in https://github.com/apache/fory/pull/2491  ","version":null,"tagName":"h2"},{"title":"Bug Fixes‚Äã","type":1,"pageTitle":"Fory v0.12.1 Released","url":"/blog/fory_0_12_1_release#bug-fixes","content":" Ensure Encoders.mapEncoder loads bean classes correctly by @stevenschlansker in https://github.com/apache/fory/pull/2494fix(java): row format generated bean types handling Optional by @stevenschlansker in https://github.com/apache/fory/pull/2497fix(java): fix addListener not releasing the lock by @open-snail in https://github.com/apache/fory/pull/2500  ","version":null,"tagName":"h2"},{"title":"Improvements‚Äã","type":1,"pageTitle":"Fory v0.12.1 Released","url":"/blog/fory_0_12_1_release#improvements","content":" Improve PyPI landing page and add row-format documentation (https://github.com/apache/fory/pull/2498, https://github.com/apache/fory/pull/2499)Refactor python release workflow by @esafak in https://github.com/apache/fory/pull/2483 https://github.com/apache/fory/pull/2532chore: translate Chinese comments into English by @Asnowww in https://github.com/apache/fory/pull/2503  ","version":null,"tagName":"h2"},{"title":"New Contributors‚Äã","type":1,"pageTitle":"Fory v0.12.1 Released","url":"/blog/fory_0_12_1_release#new-contributors","content":" @Asnowww made their first contribution in https://github.com/apache/fory/pull/2503@open-snail made their first contribution in https://github.com/apache/fory/pull/2500  Full Changelog: https://github.com/apache/fory/compare/v0.12.0...v0.12.1 ","version":null,"tagName":"h2"},{"title":"Fory v0.12.2 Released","type":0,"sectionRef":"#","url":"/blog/fory_0_12_2_release","content":"","keywords":"","version":null},{"title":"Features‚Äã","type":1,"pageTitle":"Fory v0.12.2 Released","url":"/blog/fory_0_12_2_release#features","content":" feat(java): bean encoder implemented interfaces honor @Ignore by @stevenschlansker in https://github.com/apache/fory/pull/2576feat(java): support limit deserialization depth by @chaokunyang in https://github.com/apache/fory/pull/2578  ","version":null,"tagName":"h2"},{"title":"Bug Fixes‚Äã","type":1,"pageTitle":"Fory v0.12.2 Released","url":"/blog/fory_0_12_2_release#bug-fixes","content":" fix(ci): Install pyfory for golang xlang tests by @esafak in https://github.com/apache/fory/pull/2561fix(ci): Exit with subprocess return code in run_ci.py by @esafak in https://github.com/apache/fory/pull/2560fix(java): fix codegen name conflict by @chaokunyang in https://github.com/apache/fory/pull/2565fix(java): Skip calculation of classVersionHash if checkClassVersion by @theigl in https://github.com/apache/fory/pull/2573fix(java): skip hash compute for abstract field type by @chaokunyang in https://github.com/apache/fory/pull/2575fix(java): row format buffer recycling leaves offset and size for null by @stevenschlansker in https://github.com/apache/fory/pull/2540  ","version":null,"tagName":"h2"},{"title":"Improvements‚Äã","type":1,"pageTitle":"Fory v0.12.2 Released","url":"/blog/fory_0_12_2_release#improvements","content":" refactor(java): refactor fory java exception hierarchical structure by @chaokunyang in https://github.com/apache/fory/pull/2577  Full Changelog: https://github.com/apache/fory/compare/v0.12.1...v0.12.2 ","version":null,"tagName":"h2"},{"title":"Fory v0.13.2 Released","type":0,"sectionRef":"#","url":"/blog/fory_0_13_2_release","content":"","keywords":"","version":null},{"title":"Highlights‚Äã","type":1,"pageTitle":"Fory v0.13.2 Released","url":"/blog/fory_0_13_2_release#highlights","content":" perf(rust): use thread local to manage fory rust WriteContext/ReadContext by @chaokunyang inhttps://github.com/apache/fory/pull/2946feat(rust): add typename to unregistered error message by @chaokunyang in https://github.com/apache/fory/pull/2881  ","version":null,"tagName":"h2"},{"title":"Features‚Äã","type":1,"pageTitle":"Fory v0.13.2 Released","url":"/blog/fory_0_13_2_release#features","content":" feat(rust): add fory config for rust by @chaokunyang in https://github.com/apache/fory/pull/2947perf(rust): use thread local to manage fory rust WriteContext/ReadContext by @chaokunyang inhttps://github.com/apache/fory/pull/2946perf(rust): use segmented pool to reduce contention of fory pool by @chaokunyang inhttps://github.com/apache/fory/pull/2945feat(Rust): Support u128 &amp; u128_array by @urlyy in https://github.com/apache/fory/pull/2899perf(rust): optimize buffer write read perf by @chaokunyang in https://github.com/apache/fory/pull/2892feat(rust): direct derive primitve write/read by @chaokunyang in https://github.com/apache/fory/pull/2890refactor(rust): merge fory_debug into fory macro attr by @chaokunyang in https://github.com/apache/fory/pull/2883perf(rust): support criterion profiler to generate flamegraph by @chaokunyang inhttps://github.com/apache/fory/pull/2882feat(rust): add typename to unregistered error message by @chaokunyang in https://github.com/apache/fory/pull/2881feat(rust): add duration serializer support by @chaokunyang in https://github.com/apache/fory/pull/2878feat(python): add raw method to buffer object by @chaokunyang in https://github.com/apache/fory/pull/2875feat: refine python module check by @chaokunyang in https://github.com/apache/fory/pull/2952  ","version":null,"tagName":"h2"},{"title":"Bug Fix‚Äã","type":1,"pageTitle":"Fory v0.13.2 Released","url":"/blog/fory_0_13_2_release#bug-fix","content":" fix(kotlin): support Kotlin field with Java reserved world by @chaokunyang inhttps://github.com/apache/fory/pull/2948fix(rust): raise error for nested polymorphics for collection by @chaokunyang inhttps://github.com/apache/fory/pull/2934fix(rust): fix array field support by @chaokunyang in https://github.com/apache/fory/pull/2933fix(Rust): fix Binary implementation by @urlyy in https://github.com/apache/fory/pull/2902  ","version":null,"tagName":"h2"},{"title":"Other Improvements‚Äã","type":1,"pageTitle":"Fory v0.13.2 Released","url":"/blog/fory_0_13_2_release#other-improvements","content":" docs(java): add logging section by @mosinnik in https://github.com/apache/fory/pull/2905docs: fix cargo benchmark comand in doc by @chaokunyang in https://github.com/apache/fory/pull/2897chore: move benchmarks to separate dir to speed up ci build by @chaokunyang inhttps://github.com/apache/fory/pull/2894chore(CI): Fix cache with symlinks by @PrakashRaj-GK in https://github.com/apache/fory/pull/2893chore(CI): Add caching for bazel in github workflows by @PrakashRaj-GK in https://github.com/apache/fory/pull/2888chore(Java): Update java quickstart doc, for note register order-sensitive by @monk inhttps://github.com/apache/fory/pull/2837docs(rust): remove redundant doc for shared reference by @chaokunyang in https://github.com/apache/fory/pull/2879chore(rust): fix tuple test comment by @chaokunyang in https://github.com/apache/fory/pull/2877docs: fix broken table in in java_serialization_guide.md by @mosinnik in https://github.com/apache/fory/pull/2876  Full Changelog: https://github.com/apache/fory/compare/v0.13.1...v0.13.2 ","version":null,"tagName":"h2"},{"title":"Fory v0.14.1 Released","type":0,"sectionRef":"#","url":"/blog/fory_0_14_1_release","content":"","keywords":"","version":null},{"title":"Highlights‚Äã","type":1,"pageTitle":"Fory v0.14.1 Released","url":"/blog/fory_0_14_1_release#highlights","content":" feat(rust): add generate_default attr, no longer generate Default by default by @ariesdevil in https://github.com/apache/fory/pull/3074  ","version":null,"tagName":"h2"},{"title":"Features‚Äã","type":1,"pageTitle":"Fory v0.14.1 Released","url":"/blog/fory_0_14_1_release#features","content":" feat(rust): add generate_default attr, no longer generate Default by default by @ariesdevil in https://github.com/apache/fory/pull/3074feat(java): mark createSerializer as public by @chaokunyang  ","version":null,"tagName":"h2"},{"title":"Bug Fix‚Äã","type":1,"pageTitle":"Fory v0.14.1 Released","url":"/blog/fory_0_14_1_release#bug-fix","content":" fix(java): Fix CopyOnWriteArrayList field serialization by @vybhavjs in https://github.com/apache/fory/pull/3079fix(java): Better ergonomics for AllowListChecker by @Asuka-star in https://github.com/apache/fory/pull/3061fix(java): fix read class def when writing classdefs by @chaokunyang in https://github.com/apache/fory/commit/3ad627c9fix(Rust): Move the calculating of TypeMeta::bytes and TypeMeta::hash ahead of serialization by @urlyy in https://github.com/apache/fory/pull/3060fix(Rust): prevent obtaining generic type metadata on custom types(struct/enum) by @urlyy in https://github.com/apache/fory/pull/3057  Full Changelog: https://github.com/apache/fory/compare/v0.14.0...v0.14.1 ","version":null,"tagName":"h2"},{"title":"Fory v0.13.1 Released","type":0,"sectionRef":"#","url":"/blog/fory_0_13_1_release","content":"","keywords":"","version":null},{"title":"Highlights‚Äã","type":1,"pageTitle":"Fory v0.13.1 Released","url":"/blog/fory_0_13_1_release#highlights","content":" Support rust enum variant and schema evolution for tuple/struct style enumSupport rust tuple serialization and schema evolutionSupport rust skip macro attributes  ","version":null,"tagName":"h2"},{"title":"Enum Schema Evolution‚Äã","type":1,"pageTitle":"Fory v0.13.1 Released","url":"/blog/fory_0_13_1_release#enum-schema-evolution","content":" Fory v0.13.1 adds comprehensive enum schema evolution in Compatible mode, supporting all three variant types (Unit, Unnamed, Named):  Add/remove variants: Unknown variants fall back to #[fory(default)]Add/remove fields: Named variants support field evolution with automatic defaultsModify elements: Unnamed variants handle element count changes (extras skipped, missing use defaults)Variant type changes: Convert between Unit/Unnamed/Named with automatic default values  // Version 1 #[derive(ForyObject)] enum Command { #[fory(default)] Noop, Execute { name: String, args: i32 }, } // Version 2 - Added field and new variant // both `fory(default)` and standard `default` are supported #[derive(Default, ForyObject)] enum Command { #[default] Noop, Execute { name: String, args: i32, env: String }, // Added 'env' Cancel { reason: String }, // New variant } // V1‚ÜíV2: Missing 'env' gets default &quot;&quot;; Cancel‚ÜíNoop fallback in V1 // V2‚ÜíV1: Extra 'env' skipped; Cancel‚ÜíNoop fallback   ","version":null,"tagName":"h3"},{"title":"Tuple Schema Evolution‚Äã","type":1,"pageTitle":"Fory v0.13.1 Released","url":"/blog/fory_0_13_1_release#tuple-schema-evolution","content":" Tuples (1-22 elements) now support length evolution in Compatible mode:  Length changes: Grow or shrink tuple size (missing elements get defaults, extras discarded)Collections: Vec, HashMap, HashSet elements fully supportedNested tuples: Multi-level nesting with independent evolution per levelSmart pointers: Option, Arc, Rc wrapped elements handle evolution correctlyStruct fields: Tuple fields in structs evolve independently  let fory = Fory::default().compatible(true); // Serialize 2-element tuple let short = (42i32, &quot;hello&quot;.to_string()); let bin = fory.serialize(&amp;short).unwrap(); // Deserialize as 4-element tuple - extras get defaults let long: (i32, String, f64, bool) = fory.deserialize(&amp;bin).unwrap(); assert_eq!(long, (42, &quot;hello&quot;.to_string(), 0.0, false)); // Reverse: 4‚Üí2 elements, extras discarded let long = (100i32, &quot;world&quot;.to_string(), 3.14, true); let bin = fory.serialize(&amp;long).unwrap(); let short: (i32, String) = fory.deserialize(&amp;bin).unwrap(); assert_eq!(short, (100, &quot;world&quot;.to_string()));   ","version":null,"tagName":"h3"},{"title":"Features‚Äã","type":1,"pageTitle":"Fory v0.13.1 Released","url":"/blog/fory_0_13_1_release#features","content":" feat(rust): add rust benchmark report script and result by @chaokunyang in https://github.com/apache/fory/pull/2835feat(rust): rust benchmark print serialized data size by @chaokunyang in https://github.com/apache/fory/pull/2845feat(rust): Support rust tagged union enum by @urlyy in https://github.com/apache/fory/pull/2855feat(rust): support unsigned number for rust by @chaokunyang in https://github.com/apache/fory/pull/2857feat(rust): support rust tuple serialization and schema evolution by @chaokunyang in https://github.com/apache/fory/pull/2858feat(go): implement new field ordering and type hash algorithm by @ThisingL in https://github.com/apache/fory/pull/2868feat: support fory skip macro attributes(#2864) by @kitty-eu-org in https://github.com/apache/fory/pull/2865feat(Rust): Support usize by @urlyy in https://github.com/apache/fory/pull/2870feat(rust): make whether write type/ref compile-time evaluation by @chaokunyang in https://github.com/apache/fory/pull/2871feat(rust): add array support for rust by @chaokunyang in https://github.com/apache/fory/pull/2874feat(rust): support enum variant for schema evolution mode by @chaokunyang in https://github.com/apache/fory/pull/2873  ","version":null,"tagName":"h2"},{"title":"Bug Fix‚Äã","type":1,"pageTitle":"Fory v0.13.1 Released","url":"/blog/fory_0_13_1_release#bug-fix","content":" fix: fix 0.14.0 snapshot version by @chaokunyang in https://github.com/apache/fory/pull/2842fix(java): setting the ForyJitCompilerThreadFactory to produce daemon threads by @coderunner234 in https://github.com/apache/fory/pull/2869fix: modify the depth setting in Fory to prevent duplicate registrations. by @mengnankkkk in https://github.com/apache/fory/pull/2852  ","version":null,"tagName":"h2"},{"title":"Other Improvements‚Äã","type":1,"pageTitle":"Fory v0.13.1 Released","url":"/blog/fory_0_13_1_release#other-improvements","content":" docs(rust): update rust benchmark report table by @chaokunyang in https://github.com/apache/fory/pull/2836chore(rust): update cargo toml for publish by @chaokunyang in https://github.com/apache/fory/pull/2838chore: bump release version to 0.13.0 by @chaokunyang in https://github.com/apache/fory/pull/2841docs: fix doc sync dest by @chaokunyang in https://github.com/apache/fory/pull/2839docs: refactor readme by @chaokunyang in https://github.com/apache/fory/pull/2843docs: add AGENTS to readme by @chaokunyang in https://github.com/apache/fory/pull/2844chore: remove agents from main readme by @chaokunyang in https://github.com/apache/fory/pull/2846docs: update readme by @chaokunyang in https://github.com/apache/fory/pull/2847docs: fix xlang type mapping link by @chaokunyang in https://github.com/apache/fory/pull/2848chore(Java): Make RustXlangTest cases independent from each other by @urlyy in https://github.com/apache/fory/pull/2834chore(java): Remove print property names by @Danden1 in https://github.com/apache/fory/pull/2860chore(python): add py3.13 release flag by @chaokunyang in https://github.com/apache/fory/pull/2872chore(rust): add tests to use #[derive(ForyObject)] in macro_rules! by @REASY in https://github.com/apache/fory/pull/2867  ","version":null,"tagName":"h2"},{"title":"New Contributors‚Äã","type":1,"pageTitle":"Fory v0.13.1 Released","url":"/blog/fory_0_13_1_release#new-contributors","content":" @Danden1 made their first contribution in https://github.com/apache/fory/pull/2860@coderunner234 made their first contribution in https://github.com/apache/fory/pull/2869@REASY made their first contribution in https://github.com/apache/fory/pull/2867  Full Changelog: https://github.com/apache/fory/compare/v0.13.0...v0.13.1 ","version":null,"tagName":"h2"},{"title":"Fory v0.13.0 Released","type":0,"sectionRef":"#","url":"/blog/fory_0_13_0_release","content":"","keywords":"","version":null},{"title":"Highlights‚Äã","type":1,"pageTitle":"Fory v0.13.0 Released","url":"/blog/fory_0_13_0_release#highlights","content":" Dynamic Trait Object Serialization for RustShared/Circular ownership serialization for RustSchema Forward/Backward compatibilify for RustDrop-in Replacement for Python pickle: support local function/classes/__reduce__/__getstate__ serializationSchema Forward/Backward compatibilify for Python dataclassSupport codegen for xlang mode in javaPrimitive array compression using SIMDCompact Row Codec for Row FormatSchema Forward/Backward compatibilify for GoAhead-of-time codegen for golang struct serialization  ","version":null,"tagName":"h2"},{"title":"Rust: First Release Highlights‚Äã","type":1,"pageTitle":"Fory v0.13.0 Released","url":"/blog/fory_0_13_0_release#rust-first-release-highlights","content":" This is the first Apache Fory Rust release, delivering a complete, high‚Äëperformance serialization stack. If you build Rust services or libraries, you can now use Fory natively with strong typing, performance, and schema evolution.  Derive-based object graph serialization via #[derive(ForyObject)]Polymorphism for trait objects: Box&lt;dyn Trait&gt;, Rc&lt;dyn Trait&gt;, Arc&lt;dyn Trait&gt;, plus dyn AnyShared and circular reference tracking: Rc/Arc and RcWeak/ArcWeakForward/backward compatible schema evolution (Compatible mode)Zero-copy Row format via #[derive(ForyRow)] with selective field accessThread-safe and multi-thread capable serialization (context pool)Broad collection support (e.g., VecDeque, LinkedList, BTreeMap, BTreeSet, BinaryHeap)  ","version":null,"tagName":"h2"},{"title":"Quick start (minimal example):‚Äã","type":1,"pageTitle":"Fory v0.13.0 Released","url":"/blog/fory_0_13_0_release#quick-start-minimal-example","content":" use fory::{Fory, Error}; use fory::ForyObject; #[derive(ForyObject, Debug, PartialEq)] struct User { name: String, age: i32, email: String, } fn main() -&gt; Result&lt;(), Error&gt; { let mut fory = Fory::default(); fory.register::&lt;User&gt;(1)?; let user = User { name: &quot;Alice&quot;.into(), age: 30, email: &quot;alice@example.com&quot;.into() }; let bytes = fory.serialize(&amp;user)?; let decoded: User = fory.deserialize(&amp;bytes)?; assert_eq!(user, decoded); Ok(()) }   Guide: Rust Serialization ‚Äì https://fory.apache.org/docs/docs/guide/rust_serializationCrate: fory on crates.io ‚Äì https://crates.io/crates/foryAPI docs: docs.rs ‚Äì https://docs.rs/fory/latest/fory  ","version":null,"tagName":"h3"},{"title":"Rust Benchmarks‚Äã","type":1,"pageTitle":"Fory v0.13.0 Released","url":"/blog/fory_0_13_0_release#rust-benchmarks","content":"     Below are serialize throughput results (TPS; higher is better) comparing Fory with JSON and Protobuf across multiple datasets and sizes.  Datatype\tSize\tOperation\tFory TPS\tJSON TPS\tProtobuf TPS\tFastestcompany\tsmall\tserialize\t10,063,906\t761,673\t896,620\tfory company\tmedium\tserialize\t412,507\t33,835\t37,590\tfory company\tlarge\tserialize\t9,183\t793\t880\tfory ecommerce_data\tsmall\tserialize\t2,350,729\t206,262\t256,970\tfory ecommerce_data\tmedium\tserialize\t59,977\t4,699\t5,242\tfory ecommerce_data\tlarge\tserialize\t3,727\t266\t295\tfory person\tsmall\tserialize\t13,632,522\t1,345,189\t1,475,035\tfory person\tmedium\tserialize\t3,839,656\t337,610\t369,031\tfory person\tlarge\tserialize\t907,853\t79,631\t91,408\tfory simple_list\tsmall\tserialize\t27,726,945\t4,874,957\t4,643,172\tfory simple_list\tmedium\tserialize\t4,770,765\t401,558\t397,551\tfory simple_list\tlarge\tserialize\t606,061\t41,061\t44,565\tfory simple_map\tsmall\tserialize\t22,862,369\t3,888,025\t2,695,999\tfory simple_map\tmedium\tserialize\t2,128,973\t204,319\t193,132\tfory simple_map\tlarge\tserialize\t177,847\t18,419\t18,668\tfory simple_struct\tsmall\tserialize\t35,729,598\t10,167,045\t8,633,342\tfory simple_struct\tmedium\tserialize\t34,988,279\t9,737,098\t6,433,350\tfory simple_struct\tlarge\tserialize\t31,801,558\t4,545,041\t7,420,049\tfory system_data\tsmall\tserialize\t5,382,131\t468,033\t569,930\tfory system_data\tmedium\tserialize\t174,240\t11,896\t14,753\tfory system_data\tlarge\tserialize\t10,671\t876\t1,040\tfory  Note: Results depend on hardware, dataset, and implementation versions. See the Rust guide for how to run benchmarks yourself: https://github.com/apache/fory/blob/main/benchmarks/rust_benchmark/README.md  ","version":null,"tagName":"h3"},{"title":"Python: Drop‚Äëin Replacement for pickle‚Äã","type":1,"pageTitle":"Fory v0.13.0 Released","url":"/blog/fory_0_13_0_release#python-dropin-replacement-for-pickle","content":" pyfory now acts as a high‚Äëperformance drop‚Äëin replacement for pickle/cloudpickle, while keeping the same simple API and adding security and performance features.  Serialize any Python object in Python‚Äënative mode (xlang=False): global/local functions, lambdas, global/local classes, instance/class/static methodsHonors Python hooks: __getstate__, __setstate__, __reduce__, __reduce_ex__Reference tracking for shared/circular graphs with ref=TruePickle protocol 5 out‚Äëof‚Äëband buffers for zero‚Äëcopy via pickle.PickleBuffer (NumPy, Pandas, etc.)Security: strict=True for registration‚Äëbased safety and DeserializationPolicy for fine‚Äëgrained controlThreading: ThreadSafeFory for safe multi‚Äëthread useFamiliar API: dumps/loads are aliases of serialize/deserialize  Quick start:  import pyfory # Drop-in replacement for pickle/cloudpickle fory = pyfory.Fory(xlang=False, ref=True, strict=False) def make_multiplier(k): def mul(x): return k * x return mul binary = fory.dumps(make_multiplier(10)) assert fory.loads(binary)(3) == 30   Read more: Python Guide ‚Äì https://fory.apache.org/docs/latest/python_serialization/  ","version":null,"tagName":"h2"},{"title":"Features‚Äã","type":1,"pageTitle":"Fory v0.13.0 Released","url":"/blog/fory_0_13_0_release#features","content":" feat(java): support object stream serialization for graalvm by @chaokunyang in https://github.com/apache/fory/pull/2464refactor(java): rename abstract collection/map serializers to Map/ListLikeSerializer by @chaokunyang in https://github.com/apache/fory/pull/2466feat(memory): add customizable MemoryAllocator interface by @adriacabeza in https://github.com/apache/fory/pull/2467feat: Chain wheel test/build and release workflows by @esafak in https://github.com/apache/fory/pull/2483feat(python): set default languge to python for pyfory by @chaokunyang in https://github.com/apache/fory/pull/2490feat(python): add register api to python by @chaokunyang in https://github.com/apache/fory/pull/2491feat(python): meta compression for python by @chaokunyang in https://github.com/apache/fory/pull/2504feat(python): type meta encoding for python by @chaokunyang in https://github.com/apache/fory/pull/2509feat(CI): Cache npm, add node 24, lock file by @esafak in https://github.com/apache/fory/pull/2523feat(Rust): Implementing Type Compatible by @urlyy in https://github.com/apache/fory/pull/2492feat(Rust): support Option in MetaFieldType se/de by @urlyy in https://github.com/apache/fory/pull/2528feat(rust): support skipping fields bytes when deserializing in compatible mode by @urlyy in https://github.com/apache/fory/pull/2545feat(go): add type meta encoding for meta share by @junjiexh in https://github.com/apache/fory/pull/2554feat(Rust): Support automatic conversion between T and Option&lt;T&gt; when deserialize by @urlyy in https://github.com/apache/fory/pull/2563feat(java): bean encoder implemented interfaces honor @Ignore by @stevenschlansker in https://github.com/apache/fory/pull/2576refactor(java): refactor fory java exception hierarchical structure by @chaokunyang in https://github.com/apache/fory/pull/2577feat(Go): Implement ahead of time codegen for fory-go serialization by @ThisingL in https://github.com/apache/fory/pull/2553feat(java): support limit deserialization depth by @chaokunyang in https://github.com/apache/fory/pull/2578feat(rust): add fory rust benchmark by @chaokunyang in https://github.com/apache/fory/pull/2583perf(rust): optimize rust deserialize perf by @chaokunyang in https://github.com/apache/fory/pull/2584feat(rust): add rust profiler for serialization by @chaokunyang in https://github.com/apache/fory/pull/2588refactor(go): rename FieldInfo to FieldDef to avoide name collision by @junjiexh in https://github.com/apache/fory/pull/2594feat(python): meta share mode for pyfory compatible serialization by @chaokunyang in https://github.com/apache/fory/pull/2593feat(java/python): align java and python compatible mode serialization by @chaokunyang in https://github.com/apache/fory/pull/2602feat(java/python): support enum xlang serialization by @chaokunyang in https://github.com/apache/fory/pull/2603feat(Rust): support basic type se/de aligned with java by @urlyy in https://github.com/apache/fory/pull/2585perf(python/java): Fix &amp; optimize cross-language meta-share mode by @pandalee99 in https://github.com/apache/fory/pull/2601feat(go): align cross-language type serialization for primitive arrays by @pandalee99 in https://github.com/apache/fory/pull/2610feat(java): support codegen for xlang mode in java by @chaokunyang in https://github.com/apache/fory/pull/2613feat(java): primitive array compression using SIMD by @adriacabeza in https://github.com/apache/fory/pull/2485refactor(go): Replace globalTypeResolver with factory-based serializer registration by @ThisingL in https://github.com/apache/fory/pull/2615feat(go): Implement compatible mode with metashare mode by @junjiexh in https://github.com/apache/fory/pull/2607feat(java): support concurent map serialization when being updated by @chaokunyang in https://github.com/apache/fory/pull/2617feat(java): support concurrent updates when serializing collections by @chaokunyang in https://github.com/apache/fory/pull/2623feat(python): support limit pyfory depth by @chaokunyang in https://github.com/apache/fory/pull/2625feat(Rust): sort fields &amp;&amp; feat Enum &amp;&amp; fix read/write type_info &amp;&amp; fix type_meta en/decode by @urlyy in https://github.com/apache/fory/pull/2630feat(python): drop-in replacement for pickle serialization by @chaokunyang in https://github.com/apache/fory/pull/2629refactor(java): refactor type resolver by @chaokunyang in https://github.com/apache/fory/pull/2640feat(java): support type converters for comaptible mode by @chaokunyang in https://github.com/apache/fory/pull/2641refactor(java/python): refine collection header bitmap by @chaokunyang in https://github.com/apache/fory/pull/2642feat(go): metashare mode support collection and map and nested object by @junjiexh in https://github.com/apache/fory/pull/2643feat(go): Add slice and map support to fory-go codegen serialization by @ThisingL in https://github.com/apache/fory/pull/2638refactor(go): Change codegen annotation from //fory:gen to //fory:generate by @ThisingL in https://github.com/apache/fory/pull/2648feat(rust): support Map and register_by_name by @urlyy in https://github.com/apache/fory/pull/2649feat(java): support graalvm 25 by @chaokunyang in https://github.com/apache/fory/pull/2652feat(java): support deserialize not registered/exsited class/fields for xlang compatible mode by @chaokunyang in https://github.com/apache/fory/pull/2655refactor(Rust): Refactor compile-time code &amp; fix named_enum &amp; fix skip enum by @urlyy in https://github.com/apache/fory/pull/2657feat(python): support local py class serialization by @chaokunyang in https://github.com/apache/fory/pull/2665refactor(go): refine collection header bitmap by @junjiexh in https://github.com/apache/fory/pull/2656feat(python): support class methods serialization by @chaokunyang in https://github.com/apache/fory/pull/2670refactor(go): refine collection header bitmap in codegen by @ThisingL in https://github.com/apache/fory/pull/2676feat(rust): support box serde for rust by @chaokunyang in https://github.com/apache/fory/pull/2677feat(rust): support reference tracking for rust Rc/Arc by @chaokunyang in https://github.com/apache/fory/pull/2678feat(python): refine python serialization api by @chaokunyang in https://github.com/apache/fory/pull/2673refactor(Rust): Refine api name by @urlyy in https://github.com/apache/fory/pull/2671feat(rust): support rust dyn trait object serialization by @chaokunyang in https://github.com/apache/fory/pull/2691feat(rust): support dyn any trait object serialization for box/arc/rc by @chaokunyang in https://github.com/apache/fory/pull/2704feat(rust): support shared reference tracking for arc/rc&lt;dyn T&gt; by @chaokunyang in https://github.com/apache/fory/pull/2707feat(rust): avoid downcast method of multiple trait objects in same module conflict by @chaokunyang in https://github.com/apache/fory/pull/2708feat(rust): add deref to arc/rc wrapper by @chaokunyang in https://github.com/apache/fory/pull/2709refactor(rust): unify rc/arc wrapper macro arms into one function by @chaokunyang in https://github.com/apache/fory/pull/2711perf(Rust): Use SIMD to se/de string by @urlyy in https://github.com/apache/fory/pull/2716feat(Rust): named_xx se/de &amp;&amp; ext se/de &amp;&amp; add unittest by @urlyy in https://github.com/apache/fory/pull/2712feat(rust): support RcWeak/ArcWeak for circular reference tracking by @chaokunyang in https://github.com/apache/fory/pull/2714feat(rust): support limit max dyn depth by @chaokunyang in https://github.com/apache/fory/pull/2730feat(Rust): Unroll fields loop &amp; Add a feature for this by @urlyy in https://github.com/apache/fory/pull/2724feat(python): make fory out-of-band serialization compatible with pickle5 by @chaokunyang in https://github.com/apache/fory/pull/2732refactor(go): Replace legacy RegisterTagType api call by @junjiexh in https://github.com/apache/fory/pull/2696feat(python): add thread safe fory by @chaokunyang in https://github.com/apache/fory/pull/2735feat(rust): support VecDeque/LinkedList serialization by @chaokunyang in https://github.com/apache/fory/pull/2741feat(rust): support btreemap serialization by @chaokunyang in https://github.com/apache/fory/pull/2743feat(rust): support btree set and binary heap serialization by @chaokunyang in https://github.com/apache/fory/pull/2744feat(Rust): support context_pool to reduce context allocation &amp;&amp; support se/de in multi-thread by @urlyy in https://github.com/apache/fory/pull/2737feat(ci): cache Bazel binary in Python CI workflow by @SanyamSuyal in https://github.com/apache/fory/pull/2745feat(rust): rewrite fory derive macro for smaller and faster generated code using compile-time fields sort algorithm by @chaokunyang in https://github.com/apache/fory/pull/2749feat(ci): add maven cache to ci for faster build by @chaokunyang in https://github.com/apache/fory/pull/2751feat(rust): fast fory_read_compatible macro to use match by assigned field id by @chaokunyang in https://github.com/apache/fory/pull/2758refactor(rust): use compatible bool instead of enum to simplify API by @chaokunyang in https://github.com/apache/fory/pull/2763feat(rust): query type meta from parsed cache to speed up deserialization by @chaokunyang in https://github.com/apache/fory/pull/2764feat(java): introduce Compact Row Codec by @stevenschlansker in https://github.com/apache/fory/pull/2414feat(go): Add pointer field test for meta share mode by @junjiexh in https://github.com/apache/fory/pull/2674feat(rust): make Serializer api to return Result &amp;&amp; replace panic/expect/assert/unwrap with Result by @urlyy in https://github.com/apache/fory/pull/2765feat(rust): refactor rust serialization system by @chaokunyang in https://github.com/apache/fory/pull/2774feat(python): support optional typehint for dataclass fields by @chaokunyang in https://github.com/apache/fory/pull/2766feat(rust): dynamic rust serializer system by @chaokunyang in https://github.com/apache/fory/pull/2778feat(rust): use rc instead of arc for type meta for faster performance by @chaokunyang in https://github.com/apache/fory/pull/2782feat(python): support dataclass compatible mode for python native mode by @chaokunyang in https://github.com/apache/fory/pull/2784feat(java): support deserialize non exist enum variant to default by @chaokunyang in https://github.com/apache/fory/pull/2787feat(go): update codegen field sorting to generate smaller and faster code by @ThisingL in https://github.com/apache/fory/pull/2779feat(rust): make type meta resolve return type info directly by @chaokunyang in https://github.com/apache/fory/pull/2789perf(Rust): remove clone()/to_owned() on MetaString/MetaStringBytes in MetaStringResolver to improve performance &amp;&amp; fix xlang test by @urlyy in https://github.com/apache/fory/pull/2791feat(rust): support static struct version hash check for rust by @chaokunyang in https://github.com/apache/fory/pull/2793feat(rust): support profile all data types in rust benchmark by @chaokunyang in https://github.com/apache/fory/pull/2801perf(rust): optimize rust small string/struct read/write performance by @chaokunyang in https://github.com/apache/fory/pull/2803perf(rust): optimize rust performance by remove copy simd and add more inline hints by @chaokunyang in https://github.com/apache/fory/pull/2807perf(rust): always use utf8 when writing string by @chaokunyang in https://github.com/apache/fory/pull/2809feat(python): add deserialization policy for more fine-grained control and audit deserialization behaviour by @chaokunyang in https://github.com/apache/fory/pull/2811perf(Rust): Enchance performance by @theweipeng in https://github.com/apache/fory/pull/2810feat(Rust): Support serialize_to by @theweipeng in https://github.com/apache/fory/pull/2822feat(rust): lazy build typeinfo for rust to avoid nested struct register deps by @chaokunyang in https://github.com/apache/fory/pull/2824perf(Rust): Refactor reader by @theweipeng in https://github.com/apache/fory/pull/2826perf(python): optimize pyfory perf by @chaokunyang in https://github.com/apache/fory/pull/2829  ","version":null,"tagName":"h2"},{"title":"Bug Fix‚Äã","type":1,"pageTitle":"Fory v0.13.0 Released","url":"/blog/fory_0_13_0_release#bug-fix","content":" fix(java): fix map/list element type same with collection type jit error by @chaokunyang in https://github.com/apache/fory/pull/2465fix(python): fix gh action pypi publish by @chaokunyang in https://github.com/apache/fory/pull/2468fix(java): fix row encoder for private struct by @chaokunyang in https://github.com/apache/fory/pull/2469fix(python): fix pyfory pypi release by @chaokunyang in https://github.com/apache/fory/pull/2473fix(python): fix py release on macos 13 by @chaokunyang in https://github.com/apache/fory/pull/2478fix(ci): Build python wheels using interpreters in manylinux2014 by @esafak in https://github.com/apache/fory/pull/2486fix(java): Encoders.mapEncoder(TypeRef, TypeRef, TypeRef, Fory) should load bean classes by @stevenschlansker in https://github.com/apache/fory/pull/2494fix(java): row format generated bean types handling Optional by @stevenschlansker in https://github.com/apache/fory/pull/2497fix: Fix the issue of addListener not releasing the lock by @open-snail in https://github.com/apache/fory/pull/2500fix(ci): Use $ROOT/dist for wheel distribution by @esafak in https://github.com/apache/fory/pull/2506fix(python): fix publich tag for workflow by @chaokunyang in https://github.com/apache/fory/pull/2517fix(ci): print workflow head branch by @chaokunyang in https://github.com/apache/fory/pull/2518fix(python): fix release python wheel head_branch tag by @chaokunyang in https://github.com/apache/fory/pull/2519fix(java): MemoryBuffer tests that equalTo works with size zero buffers by @stevenschlansker in https://github.com/apache/fory/pull/2524fix(ci): Pass tag to bump_py_version, set PLAT inside manylinux container by @esafak in https://github.com/apache/fory/pull/2522fix(ci): Use ref_name tag in Windows, name release runs, verify wheel versions, use all python versions for release by @esafak in https://github.com/apache/fory/pull/2532ci: Fix verify_version() by capturing version properly by @esafak in https://github.com/apache/fory/pull/2535fix(python): fix bump_wheel version by @chaokunyang in https://github.com/apache/fory/pull/2534fix(python): fix bump version by @chaokunyang in https://github.com/apache/fory/pull/2536fix(python): add macos 13 release by @chaokunyang in https://github.com/apache/fory/pull/2538fix(ci): use lowercase for betahuhn/repo-file-sync-action by @chaokunyang in https://github.com/apache/fory/pull/2541fix(ci): use commit hash for repo-file-sync-action by @chaokunyang in https://github.com/apache/fory/pull/2542fix(java): array encoder seems to waste 8 bytes in encode(T) by @stevenschlansker in https://github.com/apache/fory/pull/2551fix(ci): Install pyfory for golang xlang tests by @esafak in https://github.com/apache/fory/pull/2561fix(ci): Exit with subprocess return code in run_ci.py by @esafak in https://github.com/apache/fory/pull/2560fix(java): fix codegen name conflict by @chaokunyang in https://github.com/apache/fory/pull/2565fix(java): fix classinfo npe on graalvm by @chaokunyang in https://github.com/apache/fory/pull/2572fix(java): Skip calculation of classVersionHash if checkClassVersion is false by @theigl in https://github.com/apache/fory/pull/2573fix(java): skip hash compute for abstract field type by @chaokunyang in https://github.com/apache/fory/pull/2575fix(java): row format buffer recycling leaves offset and size for null values by @stevenschlansker in https://github.com/apache/fory/pull/2540fix(java): fix xlang register type by id by @chaokunyang in https://github.com/apache/fory/pull/2591fix(java): fix xlang mode meta shared for java by @chaokunyang in https://github.com/apache/fory/pull/2592fix(python): Fix the build dependency failure that occurred in pyfory by @pandalee99 in https://github.com/apache/fory/pull/2596fix(python): Delete the redundant code in typedef by @pandalee99 in https://github.com/apache/fory/pull/2600fix(java): fix register by id for xlang metashare mode in java by @chaokunyang in https://github.com/apache/fory/pull/2614fix(java/python): fix meta string encoding order by @chaokunyang in https://github.com/apache/fory/pull/2616fix(go): Complete type registration in factory-based serializer system by @ThisingL in https://github.com/apache/fory/pull/2619fix(python): fix pyfory depth limit by @chaokunyang in https://github.com/apache/fory/pull/2626fix(java): fix get nested genericType for codegen by @chaokunyang in https://github.com/apache/fory/pull/2632fix(python): register dynamic serializer only not require registration by @chaokunyang in https://github.com/apache/fory/pull/2634fix(java): fix record serialization on graalvm25 by @chaokunyang in https://github.com/apache/fory/pull/2644fix(java): fix field converter for xlang by @chaokunyang in https://github.com/apache/fory/pull/2654fix(java): fix array serialization on graalvm by @chaokunyang in https://github.com/apache/fory/pull/2664fix(java): fix meta share deserialization for register by @chaokunyang in https://github.com/apache/fory/pull/2667fix(java): retain serializers in graalvm native images by @gudzpoz in https://github.com/apache/fory/pull/2680fix(java): fix graalvm not use generated serializer by @chaokunyang in https://github.com/apache/fory/pull/2682fix(java): fix register serializer for xlang in java by @chaokunyang in https://github.com/apache/fory/pull/2683fix(java): fix InputStream read big buffer error by @wuwangben in https://github.com/apache/fory/pull/2687fix(python): fix python module/type serialize by @chaokunyang in https://github.com/apache/fory/pull/2688fix(java): Fix flakiness in CollectionSerializersTest#tesPriorityQueueSerializer by @swj20010308 in https://github.com/apache/fory/pull/2693fix(java): Fix flakiness in LazyMapTest#testMap by @swj20010308 in https://github.com/apache/fory/pull/2692fix(java): fix deserializing EXT type bug by @mengnankkkk in https://github.com/apache/fory/pull/2700fix(java): fix xlang typedef encode by @chaokunyang in https://github.com/apache/fory/pull/2719fix(java): Fix flakiness in MetaContextTest#testShareClassName and #testShareClassDefCompatible by @swj20010308 in https://github.com/apache/fory/pull/2739fix(java): Fix flakiness in ForyCopyTest#mutableObjectCopyTest by @swj20010308 in https://github.com/apache/fory/pull/2738fix(ci): add retry logic to Bazel downloads to prevent flaky CI failures by @SanyamSuyal in https://github.com/apache/fory/pull/2733fix(java): serialize collections with only null elements in xlang mode by @mymde in https://github.com/apache/fory/pull/2740fix(ci): fix sync file by @chaokunyang in https://github.com/apache/fory/pull/2750fix(ci): fix sync files by @chaokunyang in https://github.com/apache/fory/pull/2752fix(docs): fix rust doc links build and check by @chaokunyang in https://github.com/apache/fory/pull/2753fix(java): fix maven cache by @chaokunyang in https://github.com/apache/fory/pull/2755fix(rust): fix rust xlang tests by @chaokunyang in https://github.com/apache/fory/pull/2788fix(java): Fix flakiness in CollectionSerializersTest#testCollectionFieldSerializers, CollectionSerializersTest#testCollectionFieldSerializersCopy and ProtocolInteroperabilityTest#testComplexCollection by @swj20010308 in https://github.com/apache/fory/pull/2790fix(java): fix java shanpshot version by @chaokunyang in https://github.com/apache/fory/pull/2800fix(go): Adjust serialization of nullable value to align python behavior by @junjiexh in https://github.com/apache/fory/pull/2814  ","version":null,"tagName":"h2"},{"title":"Other Improvements‚Äã","type":1,"pageTitle":"Fory v0.13.0 Released","url":"/blog/fory_0_13_0_release#other-improvements","content":" chore(python): disable pyfory.format import warning by @chaokunyang in https://github.com/apache/fory/pull/2476chore: bump release version to 0.12.0 by @chaokunyang in https://github.com/apache/fory/pull/2489docs: fix meta_size_mask by @urlyy in https://github.com/apache/fory/pull/2495chore: fix typos by @Asnowww in https://github.com/apache/fory/pull/2496docs: Improve pyfory PyPI documentation by @esafak in https://github.com/apache/fory/pull/2498docs(python): add row format doc by @chaokunyang in https://github.com/apache/fory/pull/2499chore: translate Chinese comments into English by @Asnowww in https://github.com/apache/fory/pull/2503docs: Improve pull request template by @esafak in https://github.com/apache/fory/pull/2508ci: Fix Windows wheel creation by @esafak in https://github.com/apache/fory/pull/2511ci: Pass the GH token to actions/download-artifact by @esafak in https://github.com/apache/fory/pull/2514chore: fix MetaStrEncoding by @co63oc in https://github.com/apache/fory/pull/2516chore(javascript): rename foryjs to apache-fory and remove install docs by @chaokunyang in https://github.com/apache/fory/pull/2544chore: bump release version to 0.12.1 by @chaokunyang in https://github.com/apache/fory/pull/2556docs: update contributing.md with Rust lint command by @urlyy in https://github.com/apache/fory/pull/2569chore(ci): use str replace to make bump java version faster by @chaokunyang in https://github.com/apache/fory/pull/2568docs(java): add idea jdk11 usage config by @chaokunyang in https://github.com/apache/fory/pull/2570docs(rust): add rust document by @chaokunyang in https://github.com/apache/fory/pull/2582chore: bump release version to 0.12.2 by @chaokunyang in https://github.com/apache/fory/pull/2589chore: add trademark for fory name by @chaokunyang in https://github.com/apache/fory/pull/2590chore: Revert &quot;fix(python): Fix the build dependency failure that occurred in pyfory&quot; by @chaokunyang in https://github.com/apache/fory/pull/2597chore: remove slash in homepage URL by @chaokunyang in https://github.com/apache/fory/pull/2604chore(go): replace all typ to type_ by @chaokunyang in https://github.com/apache/fory/pull/2612chore: bump release version to 0.12.3 by @chaokunyang in https://github.com/apache/fory/pull/2645docs: add AGENT.md to make AI coding more efficient by @chaokunyang in https://github.com/apache/fory/pull/2646chore(rust): remove tag read/write by @chaokunyang in https://github.com/apache/fory/pull/2681docs(python): refine python readme with detailed docs by @chaokunyang in https://github.com/apache/fory/pull/2689docs(python): update schema evolution support in README by @chaokunyang in https://github.com/apache/fory/pull/2690docs: fix python readme lint by @chaokunyang in https://github.com/apache/fory/pull/2694docs(rust): add comprehensive rust readme document by @chaokunyang in https://github.com/apache/fory/pull/2723docs(rust): add detailed rust api doc and readme by @chaokunyang in https://github.com/apache/fory/pull/2728docs: sync rust and python document to fory-site by @chaokunyang in https://github.com/apache/fory/pull/2734docs(rust): update rust roadmap by @chaokunyang in https://github.com/apache/fory/pull/2754docs(rust): fix rust doc broken link by @chaokunyang in https://github.com/apache/fory/pull/2756docs(rust): fix rust doc lint by @chaokunyang in https://github.com/apache/fory/pull/2757docs(go): Update README.md by @junjiexh in https://github.com/apache/fory/pull/2675docs(rust): add rust thread safety and troubleshooting doc by @chaokunyang in https://github.com/apache/fory/pull/2781chore(rust): rename fory-tests to tests by @chaokunyang in https://github.com/apache/fory/pull/2783docs(rust): update rust serializer trait doc by @chaokunyang in https://github.com/apache/fory/pull/2795chore: fix release error by @chaokunyang in https://github.com/apache/fory/pull/2796chore(python): rename numeric typehint by @chaokunyang in https://github.com/apache/fory/pull/2808chore(rust): reorder fory rust methods by @chaokunyang in https://github.com/apache/fory/pull/2813docs(python): refine python code and add api doc by @chaokunyang in https://github.com/apache/fory/pull/2816chore(ci): remove macos13 ci for rust/c++ by @chaokunyang in https://github.com/apache/fory/pull/2817chore(rust): rename metastring to meta_string by @urlyy in https://github.com/apache/fory/pull/2812docs(rust): add serialize_to api doc by @chaokunyang in https://github.com/apache/fory/pull/2825chore(Rust): Streamline code by @theweipeng in https://github.com/apache/fory/pull/2828docs(rust): update serialize to deserialize from doc by @chaokunyang in https://github.com/apache/fory/pull/2830chore(Rust): Remove new_from_fory from context.rs by @urlyy in https://github.com/apache/fory/pull/2831  ","version":null,"tagName":"h2"},{"title":"New Contributors‚Äã","type":1,"pageTitle":"Fory v0.13.0 Released","url":"/blog/fory_0_13_0_release#new-contributors","content":" @adriacabeza made their first contribution in https://github.com/apache/fory/pull/2467@Asnowww made their first contribution in https://github.com/apache/fory/pull/2496@open-snail made their first contribution in https://github.com/apache/fory/pull/2500@junjiexh made their first contribution in https://github.com/apache/fory/pull/2554@ThisingL made their first contribution in https://github.com/apache/fory/pull/2553@gudzpoz made their first contribution in https://github.com/apache/fory/pull/2680@wuwangben made their first contribution in https://github.com/apache/fory/pull/2687@swj20010308 made their first contribution in https://github.com/apache/fory/pull/2693@mengnankkkk made their first contribution in https://github.com/apache/fory/pull/2700@SanyamSuyal made their first contribution in https://github.com/apache/fory/pull/2733@mymde made their first contribution in https://github.com/apache/fory/pull/2740  Full Changelog: https://github.com/apache/fory/compare/v0.12.3...v0.13.0-rc2 ","version":null,"tagName":"h2"},{"title":"Fory v0.14.0 Released","type":0,"sectionRef":"#","url":"/blog/fory_0_14_0_release","content":"","keywords":"","version":null},{"title":"Highlights‚Äã","type":1,"pageTitle":"Fory v0.14.0 Released","url":"/blog/fory_0_14_0_release#highlights","content":" Official C++ Support: First release of Apache Fory C++ with high-performance object graph serialization, cross-language interoperability, and schema evolutionRow Format &amp; Type System: New row-oriented format type system across Java, Python, and C++, enabling row-columnar conversions and removing Arrow dependenciesPerformance Enhancements: Significant optimizations across all languages, including thread-local context in Rust and fast flat-int maps for C++ type dispatchEcosystem Updates: Added support for JDK 25 (Java), Go 1.23, and Bazel 8. Python officially marked as stable with improved build parallelismAdvanced Java Features: GraalVM Native Image support via ForyFeature and optimized serializers for blocking queues and final fieldsObjectStreamSerializer Refactoring: Refactored ObjectStreamSerializer with meta-shared compatible mode for reduced space cost and improved performance on JDK customized serialization APIs  ","version":null,"tagName":"h2"},{"title":"C++: First Release Highlights‚Äã","type":1,"pageTitle":"Fory v0.14.0 Released","url":"/blog/fory_0_14_0_release#c-first-release-highlights","content":" This is the first Apache Fory C++ release, delivering a complete, high-performance serialization framework for modern C++17. If you build C++ applications requiring fast serialization, cross-language communication, or schema evolution, Fory C++ provides type-safe, compile-time serialization with minimal overhead.  Key capabilities:  Macro-based struct registration via FORY_STRUCT for compile-time type safetyCross-language serialization with Java, Python, Go, Rust, and JavaScriptForward/backward compatible schema evolution (Compatible mode)Reference tracking for shared objects and circular referencesThread-safe and single-threaded (fastest) variantsComprehensive type support: primitives, std::string, std::vector, std::map, std::set, std::optional, std::shared_ptr, std::unique_ptr, std::variant, and temporal typesZero-copy Row format for analytics workloads with random field accessCMake (FetchContent) and Bazel build system support  ","version":null,"tagName":"h2"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Fory v0.14.0 Released","url":"/blog/fory_0_14_0_release#quick-start","content":" #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; struct Person { std::string name; int32_t age; std::vector&lt;std::string&gt; hobbies; FORY_STRUCT(Person, name, age, hobbies); }; int main() { auto fory = Fory::builder() .xlang(true) // Enable cross-language mode .track_ref(false) // Disable ref tracking for simple types .build(); fory.register_struct&lt;Person&gt;(1); Person person{&quot;Alice&quot;, 30, {&quot;reading&quot;, &quot;coding&quot;}}; auto bytes = fory.serialize(person).value(); Person decoded = fory.deserialize&lt;Person&gt;(bytes).value(); // person == decoded return 0; }   Guide: C++ Serialization ‚Äì https://fory.apache.org/docs/docs/guide/cpp/Examples: hello_world, hello_row  ","version":null,"tagName":"h3"},{"title":"C++ Benchmarks‚Äã","type":1,"pageTitle":"Fory v0.14.0 Released","url":"/blog/fory_0_14_0_release#c-benchmarks","content":"   Below are timing results (nanoseconds; lower is better) comparing Fory with Protobuf across different data structures.  Datatype\tOperation\tFory (ns)\tProtobuf (ns)\tFasterMediaContent\tSerialize\t414\t2,046\tFory (4.9x) MediaContent\tDeserialize\t1,361\t2,890\tFory (2.1x) Sample\tSerialize\t210\t307\tFory (1.5x) Sample\tDeserialize\t1,061\t1,500\tFory (1.4x) Struct\tSerialize\t51\t181\tFory (3.5x) Struct\tDeserialize\t136\t170\tFory (1.3x)  Note: Results depend on hardware and implementation versions. See the C++ benchmark guide for how to run benchmarks yourself: https://github.com/apache/fory/tree/main/benchmarks/cpp_benchmark  ","version":null,"tagName":"h3"},{"title":"Features‚Äã","type":1,"pageTitle":"Fory v0.14.0 Released","url":"/blog/fory_0_14_0_release#features","content":" feat(python): add raw method to buffer object by @chaokunyang in https://github.com/apache/fory/pull/2875feat(rust): add duration serializer support by @chaokunyang in https://github.com/apache/fory/pull/2878feat(rust): add typename to unregistered error message by @chaokunyang in https://github.com/apache/fory/pull/2881perf(rust): support criterion profiler to generate flamegraph by @chaokunyang in https://github.com/apache/fory/pull/2882refactor(rust): merge fory_debug into fory macro attr by @chaokunyang in https://github.com/apache/fory/pull/2883feat(rust): direct derive primitve write/read by @chaokunyang in https://github.com/apache/fory/pull/2890perf(rust): optimize buffer write read perf by @chaokunyang in https://github.com/apache/fory/pull/2892feat(Rust): Support u128 &amp; u128_array by @urlyy in https://github.com/apache/fory/pull/2899feat(c++): implement fory cpp object graph serialization framework by @chaokunyang in https://github.com/apache/fory/pull/2908feat(python): pure python row-columar convert by @chaokunyang in https://github.com/apache/fory/pull/2919feat(c++): implement xlang serialization for c++ by @chaokunyang in https://github.com/apache/fory/pull/2925feat(c++/python): add row format schema and remove arrow dependency by @chaokunyang in https://github.com/apache/fory/pull/2928feat(java): implement fory row format type system by @chaokunyang in https://github.com/apache/fory/pull/2931feat(python): implement cython bazel build directly without 3rd deps by @chaokunyang in https://github.com/apache/fory/pull/2936feat(c+/python): upgrade bazel to bazel8 by @chaokunyang in https://github.com/apache/fory/pull/2937feat(java/python/c++): add schema encoder and remove arrow serializers by @chaokunyang in https://github.com/apache/fory/pull/2938feat(c++): check max dyn depth when deserializing polymorphic types by @chaokunyang in https://github.com/apache/fory/pull/2939feat(c++): add cmake build support and add cpp examples by @chaokunyang in https://github.com/apache/fory/pull/2942feat(c++ ): add cpp benchmark by @chaokunyang in https://github.com/apache/fory/pull/2943perf(rust): use segmented pool to reduce contention of fory pool by @chaokunyang in https://github.com/apache/fory/pull/2945perf(rust): use thread local to manage fory rust WriteContext/ReadContext by @chaokunyang in https://github.com/apache/fory/pull/2946feat(rust): add fory config for rust by @chaokunyang in https://github.com/apache/fory/pull/2947perf(c++): optimize cpp serialization performance by @chaokunyang in https://github.com/apache/fory/pull/2944perf(c++): remove shared_ptr from type info to reduce atomic counter cost by @chaokunyang in https://github.com/apache/fory/pull/2951feat: refine python module check by @chaokunyang in https://github.com/apache/fory/pull/2952feat(java): support jdk 25 by @chaokunyang in https://github.com/apache/fory/pull/2954feat(java): add optimized serializers for blocking queues by @zhan7236 in https://github.com/apache/fory/pull/2955perf(c++): directly error set instead of result to reduce cost on hotpath by @chaokunyang in https://github.com/apache/fory/pull/2959perf(c++): optimize primitive struct fields read performance by @chaokunyang in https://github.com/apache/fory/pull/2960feat(java): implement FinalFieldReplaceResolveSerializer for final fields with writeReplace/readResolve methods by @mchernyakov in https://github.com/apache/fory/pull/2917perf(c++): add mac profile script for c++ by @chaokunyang in https://github.com/apache/fory/pull/2962perf(c++): fair benchmark for cpp by @chaokunyang in https://github.com/apache/fory/pull/2963perf(c++): optimize type dispatch performance by a fast flat-int map by @chaokunyang in https://github.com/apache/fory/pull/2966perf(c++): add media content benchmark by @chaokunyang in https://github.com/apache/fory/pull/2968feat(c++): support polymorphic collection elements serialization by @chaokunyang in https://github.com/apache/fory/pull/2974feat(c++): add cpp tuple serializer by @chaokunyang in https://github.com/apache/fory/pull/2975refactor(xlang): use 0 for unknow type id by @chaokunyang in https://github.com/apache/fory/pull/2985feat(java): Add ForyFeature for GraalVM Native Image by @mengnankkkk in https://github.com/apache/fory/pull/2701feat(c++): support container xlang serialization with polymorphic elements by @chaokunyang in https://github.com/apache/fory/pull/2980feat(python): parallel python wheel build by @chaokunyang in https://github.com/apache/fory/pull/2989perf(c++): improve the serialization performance of array/collection by @LiangliangSui in https://github.com/apache/fory/pull/2986feat(go): upgrade go to to 1.23 by @chaokunyang in https://github.com/apache/fory/pull/2995perf(c++): centralize error state in context for faster serialization by @chaokunyang in https://github.com/apache/fory/pull/3009refactor(go): redesign serialization implementation with performance and usability improvements by @chaokunyang in https://github.com/apache/fory/pull/2998refactor(rust): merge rust type layer into TypeMeta by @chaokunyang in https://github.com/apache/fory/pull/3019ci: remove macos x86 CI for Python by @chaokunyang in https://github.com/apache/fory/pull/3023feat(c++): support unsigned type for cpp by @chaokunyang in https://github.com/apache/fory/pull/3022feat(c++): support variant-based union type serialization for c++ by @chaokunyang in https://github.com/apache/fory/pull/3032feat(java): refactor ObjectStreamSerializer to use meta shared compatible serializer by @chaokunyang in https://github.com/apache/fory/pull/3034feat(java): separate user register type id with fory registered type id by @chaokunyang in https://github.com/apache/fory/pull/3035feat(): add c++ user guide doc by @chaokunyang in https://github.com/apache/fory/pull/3037refactor(c++/rust): refine c++ serialize_to API by @chaokunyang in https://github.com/apache/fory/pull/3045  ","version":null,"tagName":"h2"},{"title":"Bug Fix‚Äã","type":1,"pageTitle":"Fory v0.14.0 Released","url":"/blog/fory_0_14_0_release#bug-fix","content":" fix(Rust): fix Binary implementation by @urlyy in https://github.com/apache/fory/pull/2902fix(rust): fix array field support by @chaokunyang in https://github.com/apache/fory/pull/2933fix(rust): raise error for nested polymorphics for collection by @chaokunyang in https://github.com/apache/fory/pull/2934fix(kotlin): support Kotlin field with Java reserved world by @chaokunyang in https://github.com/apache/fory/pull/2948fix(java): handle TypeVariable in row format type inference by @chaokunyang in https://github.com/apache/fory/pull/2949fix(java): use single quotes in Python command for Windows compatibility by @zhan7236 in https://github.com/apache/fory/pull/2953fix(java): fix race condition in blocking queue serializers by @zhan7236 in https://github.com/apache/fory/pull/2956fix(cpp): fix the type error by @LiangliangSui in https://github.com/apache/fory/pull/2961fix(go): fix struct value reference tracking bug by @chaokunyang in https://github.com/apache/fory/pull/2991fix(java): support serialization of CopyOnWriteArraySet by @LiangliangSui in https://github.com/apache/fory/pull/2999  ","version":null,"tagName":"h2"},{"title":"Other Improvements‚Äã","type":1,"pageTitle":"Fory v0.14.0 Released","url":"/blog/fory_0_14_0_release#other-improvements","content":" docs: fix broken table in in java_serialization_guide.md by @mosinnik in https://github.com/apache/fory/pull/2876chore(rust): fix tuple test comment by @chaokunyang in https://github.com/apache/fory/pull/2877docs(rust): remove redundant doc for shared reference by @chaokunyang in https://github.com/apache/fory/pull/2879chore(Java): Update java quickstart doc, for note register order-sensitive by @moooonk in https://github.com/apache/fory/pull/2837chore(CI): Add caching for bazel in github workflows by @prakash-218 in https://github.com/apache/fory/pull/2888chore(CI): Fix cache with symlinks by @prakash-218 in https://github.com/apache/fory/pull/2893chore: move benchmarks to separate dir to speed up ci build by @chaokunyang in https://github.com/apache/fory/pull/2894docs: fix rust benchmark links by @chaokunyang in https://github.com/apache/fory/pull/2896docs: fix cargo benchmark comand in doc by @chaokunyang in https://github.com/apache/fory/pull/2897chore: bump release version to 0.13.1 by @chaokunyang in https://github.com/apache/fory/pull/2901docs(java): add logging section by @mosinnik in https://github.com/apache/fory/pull/2905chore(c++): remove cpp benchmarks by @chaokunyang in https://github.com/apache/fory/pull/2926chore(c++): move meta string to meta dir by @chaokunyang in https://github.com/apache/fory/pull/2940docs: remove unused type mappings for arrow types by @chaokunyang in https://github.com/apache/fory/pull/2964chore: Remove the content related to arrow. by @LiangliangSui in https://github.com/apache/fory/pull/2965chore(c++): move common macro into macros.h by @chaokunyang in https://github.com/apache/fory/pull/2970docs: Update Bazel version in README.md by @chaokunyang in https://github.com/apache/fory/pull/2971docs: refine xlang spec documentation by @chaokunyang in https://github.com/apache/fory/pull/2979docs: Refine metadata packing and automatic type mapping by @chaokunyang in https://github.com/apache/fory/pull/2984ci: add workflow to remove HTML comments from PR body by @chaokunyang in https://github.com/apache/fory/pull/2983docs: Update xlang_serialization_spec.md by @chaokunyang in https://github.com/apache/fory/pull/2987docs: update the C++ benchmark case by @LiangliangSui in https://github.com/apache/fory/pull/2988chore(deps): bump gopkg.in/yaml.v3 from 3.0.0-20200313102051-9f266ea9e77c to 3.0.1 in /go/fory by @dependabot[bot] in https://github.com/apache/fory/pull/2996chore: bump release version to 0.13.2 by @chaokunyang in https://github.com/apache/fory/pull/2997chore(python): mark pyfory as stable by @chaokunyang in https://github.com/apache/fory/pull/3001docs(c++): add cpp bazel example and add ci by @chaokunyang in https://github.com/apache/fory/pull/3033docs: refactor user guide docs by @chaokunyang in https://github.com/apache/fory/pull/3036docs: add scala and kotlin docs by @chaokunyang in https://github.com/apache/fory/pull/3040docs: refactor xlang docs by @chaokunyang in https://github.com/apache/fory/pull/3041docs: add row format spec by @chaokunyang in https://github.com/apache/fory/pull/3042docs: fix sidebar position by @chaokunyang in https://github.com/apache/fory/pull/3043docs: remove copy rust/python docs by @chaokunyang in https://github.com/apache/fory/pull/3044  ","version":null,"tagName":"h2"},{"title":"New Contributors‚Äã","type":1,"pageTitle":"Fory v0.14.0 Released","url":"/blog/fory_0_14_0_release#new-contributors","content":" @mosinnik made their first contribution in https://github.com/apache/fory/pull/2876@prakash-218 made their first contribution in https://github.com/apache/fory/pull/2888@zhan7236 made their first contribution in https://github.com/apache/fory/pull/2953@mchernyakov made their first contribution in https://github.com/apache/fory/pull/2917  Full Changelog: https://github.com/apache/fory/compare/v0.13.2...v0.14.0 ","version":null,"tagName":"h2"},{"title":"Fory v0.15.0 Released","type":0,"sectionRef":"#","url":"/blog/fory_0_15_0_release","content":"","keywords":"","version":null},{"title":"Highlights‚Äã","type":1,"pageTitle":"Fory v0.15.0 Released","url":"/blog/fory_0_15_0_release#highlights","content":" feat(go): new golang xlang serialization implementation by @chaokunyang in https://github.com/apache/fory/pull/3063feat(rust): add tuple struct support and improve generic type handling by @ariesdevil in https://github.com/apache/fory/pull/3087refactor(rust): unify tuple struct and named struct protocol, and make schema evolution happy by @ariesdevil in https://github.com/apache/fory/pull/3092feat(java/python/rust/go/cpp): align nullable meta for xlang struct fields serialization by @chaokunyang in https://github.com/apache/fory/pull/3093feat(java/python/rust/go/cpp): xlang fields reference and typeinfo alignment by @chaokunyang in https://github.com/apache/fory/pull/3107feat(cpp): add SharedWeak&lt;T&gt; for circular reference support by @chaokunyang in https://github.com/apache/fory/pull/3109feat(xlang): support unsigned int for xlang by @chaokunyang in https://github.com/apache/fory/pull/3111 and https://github.com/apache/fory/pull/3113feat(xlang/java): refactor java native serialization type system and streaming type info for xlang by @chaokunyang in https://github.com/apache/fory/pull/3153feat(xlang): fory schema idl and compiler by @chaokunyang in https://github.com/apache/fory/pull/3106feat(compiler): add flatbuffers idl support by @chaokunyang in https://github.com/apache/fory/pull/3184  ","version":null,"tagName":"h2"},{"title":"Go Serialization: First Release‚Äã","type":1,"pageTitle":"Fory v0.15.0 Released","url":"/blog/fory_0_15_0_release#go-serialization-first-release","content":" Apache Fory 0.15.0 is the first release with official Go serialization support. The Go implementation delivers high-performance serialization with cross-language compatibility and production-focused configuration options.  Key capabilities:  Cross-language mode with Java, Python, cpp, Rust, and JavaScript (fory.WithXlang(true))Reflection-based serialization by default, plus optional experimental AOT code generation for hot pathsReference tracking for shared/circular object graphs (fory.WithTrackRef(true) + fory:&quot;ref&quot; tags)Compatible mode for schema evolution (fory.WithCompatible(true)) supporting add/remove/reorder field changesThread-safe wrapper (github.com/apache/fory/go/fory/threadsafe) for concurrent workloads  ","version":null,"tagName":"h2"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Fory v0.15.0 Released","url":"/blog/fory_0_15_0_release#quick-start","content":" package main import ( &quot;github.com/apache/fory/go/fory&quot; ) type User struct { ID int64 Name string } func main() { f := fory.New( fory.WithXlang(true), fory.WithCompatible(true), ) _ = f.RegisterStruct(User{}, 1) data, _ := f.Serialize(&amp;User{ID: 1, Name: &quot;Alice&quot;}) var out User _ = f.Deserialize(data, &amp;out) }   Go guide: https://fory.apache.org/docs/guide/go/  ","version":null,"tagName":"h3"},{"title":"Go Benchmarks‚Äã","type":1,"pageTitle":"Fory v0.15.0 Released","url":"/blog/fory_0_15_0_release#go-benchmarks","content":"   Below are timing results (ns/op; lower is better) comparing Fory with Protobuf and Msgpack across representative data structures.  Data Type\tOperation\tFory\tProtobuf\tMsgpackStruct\tSerialize\t66.0\t97.8\t184.9 Struct\tDeserialize\t82.7\t90.9\t309.6 Structlist\tSerialize\t632.8\t1783.0\t3340.0 Structlist\tDeserialize\t906.4\t1891.0\t5709.0 Sample\tSerialize\t137.3\t367.3\t1492.0 Sample\tDeserialize\t263.6\t422.2\t2661.0 Samplelist\tSerialize\t1962.0\t7087.0\t26169.0 Samplelist\tDeserialize\t4234.0\t9321.0\t53615.0 Mediacontent\tSerialize\t268.8\t471.1\t773.7 Mediacontent\tDeserialize\t426.9\t553.1\t1432.0 Mediacontentlist\tSerialize\t3736.0\t9107.0\t13911.0 Mediacontentlist\tDeserialize\t7247.0\t11435.0\t27975.0  Serialized data sizes (bytes):  Data Type\tFory\tProtobuf\tMsgpackStruct\t58\t61\t57 Sample\t446\t375\t524 MediaContent\t342\t301\t400 StructList\t560\t1260\t1146 SampleList\t7600\t7560\t10486 MediaContentList\t5776\t6080\t8006  Note: Results depend on hardware and implementation versions. See the Go benchmark docs for details: https://fory.apache.org/docs/benchmarks/go/  ","version":null,"tagName":"h3"},{"title":"Fory Schema IDL and Compiler: First Release‚Äã","type":1,"pageTitle":"Fory v0.15.0 Released","url":"/blog/fory_0_15_0_release#fory-schema-idl-and-compiler-first-release","content":" Apache Fory 0.15.0 also introduces the first release of the Fory schema IDL and compiler toolchain. You can define schemas once and generate native types and registration code across languages.  Key capabilities:  Schema-first development with enum, message, and unionFory-native field semantics: optional (nullability), ref (shared/circular references), list, and mapMulti-language code generation for Java, Python, Go, Rust, and cppProtobuf (.proto) and FlatBuffers (.fbs) frontend support, translated into Fory IR/codegenIdiomatic generated APIs with to/from bytes helpers  ","version":null,"tagName":"h2"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Fory v0.15.0 Released","url":"/blog/fory_0_15_0_release#quick-start-1","content":" pip install fory-compiler foryc example.fdl --lang java,python,go,rust,cpp --output ./generated   package example; message Person [id=101] { string name = 1; optional string email = 2; }   ","version":null,"tagName":"h3"},{"title":"Generated Code Example‚Äã","type":1,"pageTitle":"Fory v0.15.0 Released","url":"/blog/fory_0_15_0_release#generated-code-example","content":" foryc generates idiomatic native types plus registration/byte helpers. For the schema above, generated code looks like:  // Go (excerpt) type Person struct { Name string `fory:&quot;id=1&quot;` Email optional.Optional[string] `fory:&quot;id=2&quot;` } func (m *Person) ToBytes() ([]byte, error) { ... } func (m *Person) FromBytes(data []byte) error { ... } func RegisterTypes(f *fory.Fory) error { return f.RegisterStruct(Person{}, 101) }   // Java (excerpt) public class Person { @ForyField(id = 1) private String name; @ForyField(id = 2, nullable = true) private String email; public byte[] toBytes() { ... } public static Person fromBytes(byte[] bytes) { ... } }   # Python (excerpt) @pyfory.dataclass class Person: name: str = pyfory.field(id=1, default=&quot;&quot;) email: Optional[str] = pyfory.field(id=2, default=None) def to_bytes(self) -&gt; bytes: ... @classmethod def from_bytes(cls, data: bytes) -&gt; &quot;Person&quot;: ...   Compiler docs: https://fory.apache.org/docs/compiler/  ","version":null,"tagName":"h3"},{"title":"Features‚Äã","type":1,"pageTitle":"Fory v0.15.0 Released","url":"/blog/fory_0_15_0_release#features","content":" feat(java): add config params for IdentityObjectIntMap by @jim-parsons in https://github.com/apache/fory/pull/3048perf: add cpp benchmark report by @chaokunyang in https://github.com/apache/fory/pull/3051feat(python): add Union type support for xlang serialization by @zhan7236 in https://github.com/apache/fory/pull/3059feat(go): new golang xlang serialization implementation by @chaokunyang in https://github.com/apache/fory/pull/3063feat(java): enhance ForyField annotation with tag ID support for optimized serialization by @mchernyakov in https://github.com/apache/fory/pull/3021feat(cpp): add iterator container serialization support by @zhan7236 in https://github.com/apache/fory/pull/3068refactor(go): refactor go error processing by @chaokunyang in https://github.com/apache/fory/pull/3069feat(rust): add generate_default attr, no longer generate Default trait impl by default by @ariesdevil in https://github.com/apache/fory/pull/3074feat(java): implement Union type support for cross-language serialization by @zhan7236 in https://github.com/apache/fory/pull/3062perf(go): add go benchmarks and optimize performance by @chaokunyang in https://github.com/apache/fory/pull/3071feat(python): add java python xlang tests and align protocol by @chaokunyang in https://github.com/apache/fory/pull/3077feat(rust): add i128 and isize type support by @ariesdevil in https://github.com/apache/fory/pull/3080feat(rust): add unit type and PhantomData serializer support by @ariesdevil in https://github.com/apache/fory/pull/3081refactor(python): refactor pyfory serializers code structure by @chaokunyang in https://github.com/apache/fory/pull/3083feat(rust): add union and none type support by @ariesdevil in https://github.com/apache/fory/pull/3084feat(go): add go struct field tag support by @chaokunyang in https://github.com/apache/fory/pull/3082feat(rust): add tuple struct support and improve generic type handling by @ariesdevil in https://github.com/apache/fory/pull/3087feat(rust): support configure rust field meta to reduce cost by @chaokunyang in https://github.com/apache/fory/pull/3089feat(cpp): support customize cpp field meta by @chaokunyang in https://github.com/apache/fory/pull/3088feat(ci): make rust xlang ci run separately to make ci faster by @chaokunyang in https://github.com/apache/fory/pull/3090feat(python): support configure field meta for python by @chaokunyang in https://github.com/apache/fory/pull/3091refactor(rust): unify tuple struct and named struct protocol, and make schema evolution happy by @ariesdevil in https://github.com/apache/fory/pull/3092feat(java): build Descriptors with final ref_tracking flags by @chaokunyang in https://github.com/apache/fory/pull/3070feat(java/python/rust/go/cpp): align nullable meta for xlang struct fields serialization by @chaokunyang in https://github.com/apache/fory/pull/3093feat(rust): implement fine-grained ref tracking for rust by @chaokunyang in https://github.com/apache/fory/pull/3101feat(cpp): fine-grained ref tracking for cpp by @chaokunyang in https://github.com/apache/fory/pull/3103feat(java/python/rust/go/cpp): xlang nullable/ref alignment by @chaokunyang in https://github.com/apache/fory/pull/3104feat(java/python/rust/go/cpp): xlang fields reference and typeinfo alignment by @chaokunyang in https://github.com/apache/fory/pull/3107feat(java/python/go/rust): add circular reference xlang tests by @chaokunyang in https://github.com/apache/fory/pull/3108feat(cpp): add SharedWeak&lt;T&gt; for circular reference support by @chaokunyang in https://github.com/apache/fory/pull/3109feat(js): add schema-based per-field nullable support for xlang by @theharsh999 in https://github.com/apache/fory/pull/3100feat(xlang): support unsigned int for xlang by @chaokunyang in https://github.com/apache/fory/pull/3111feat(java): long array serializer support varint encoding by @Pigsy-Monk in https://github.com/apache/fory/pull/3115feat(xlang): support serialization for unsigned types and field encoding config by @chaokunyang in https://github.com/apache/fory/pull/3113perf(go): optimize go struct fields serialization perf by @chaokunyang in https://github.com/apache/fory/pull/3120feat(java): int array serializer support varint encoding by @Pigsy-Monk in https://github.com/apache/fory/pull/3124feat(java): support xlang serialization for GraalVM native image by @chaokunyang in https://github.com/apache/fory/pull/3126refactor(go): rename go interface to any by @chaokunyang in https://github.com/apache/fory/pull/3128refactor(xlang): remove magic number from protocol by @chaokunyang in https://github.com/apache/fory/pull/3137feat(xlang): use little endian when serializing array of multiple byte element size by @chaokunyang in https://github.com/apache/fory/pull/3140refactor(java/cpp): rename morphic to dynamic by @chaokunyang in https://github.com/apache/fory/pull/3142feat(xlang): add unsigned integer type support for JavaScript by @ayush00git in https://github.com/apache/fory/pull/3139feat: add unsigned number for dart by @ayush00git in https://github.com/apache/fory/pull/3144feat(xlang/java): refactor java native serialization type system and streaming type info for xlang by @chaokunyang in https://github.com/apache/fory/pull/3153feat(dart): add struct serializer support for unsigned integer types by @ayush00git in https://github.com/apache/fory/pull/3155feat(xlang): fory schema idl and compiler by @chaokunyang in https://github.com/apache/fory/pull/3106refactor(java): use Types.NONE + 1 as base java native id by @chaokunyang in https://github.com/apache/fory/pull/3180refactor(compiler): refactor fory compiler into hierarchical architecture by @chaokunyang in https://github.com/apache/fory/pull/3179feat(JavaScript): Add cross language test for JavaScript by @theweipeng in https://github.com/apache/fory/pull/3161feat(dart): add dart ci by @chaokunyang in https://github.com/apache/fory/pull/3189feat(compiler): add flatbuffers idl support by @chaokunyang in https://github.com/apache/fory/pull/3184feat(java): enhance java unsigned int/array type system by @chaokunyang in https://github.com/apache/fory/pull/3190feat(dart): add uint annotation types to the fory's codegen system by @ayush00git in https://github.com/apache/fory/pull/3181feat(dart): add uint struct support to the codegen system by @ayush00git in https://github.com/apache/fory/pull/3192feat(compiler): add union support to fory compiler and runtime by @chaokunyang in https://github.com/apache/fory/pull/3195feat(cpp): support private fields of cpp class by @chaokunyang in https://github.com/apache/fory/pull/3193feat(compiler): generate getter/setter/has/clear methods for cpp by @chaokunyang in https://github.com/apache/fory/pull/3199feat(JavaScript): impl the xlang string by @theweipeng in https://github.com/apache/fory/pull/3197feat(cpp): make fory enum/nuion macro in user namespace by @chaokunyang in https://github.com/apache/fory/pull/3200feat(go): use option for optional fields by @chaokunyang in https://github.com/apache/fory/pull/3202feat(cpp): make shared_ptr track ref by default by @chaokunyang in https://github.com/apache/fory/pull/3214feat(go): support [N]uint types array serializers by @ayush00git in https://github.com/apache/fory/pull/3201feat(xlang): reserve 4 bits for type meta by @chaokunyang in https://github.com/apache/fory/pull/3204feat(go): remove murmur hash go deps by @chaokunyang in https://github.com/apache/fory/pull/3217feat(compiler): refine generated cpp API by @chaokunyang in https://github.com/apache/fory/pull/3221feat(python): refactor cython buffer to use cpp buffer by @chaokunyang in https://github.com/apache/fory/pull/3219ci: speed up setup-python on windows by @chaokunyang in https://github.com/apache/fory/pull/3222feat(python): add buffer index accessors by @chaokunyang in https://github.com/apache/fory/pull/3223feat(xlang/compiler): support shared/circular reference serialization for fory/protobuf/flatbuffer idl by @chaokunyang in https://github.com/apache/fory/pull/3226feat(cpp): add polymorphic serialization support for any to compiler by @chaokunyang in https://github.com/apache/fory/pull/3232feat(JavaScript): impl xlang writer by @theweipeng in https://github.com/apache/fory/pull/3234feat(xlang): support control ref tracking for nested list map elements by @chaokunyang in https://github.com/apache/fory/pull/3236feat(compiler): add generated to_bytes/from_bytes methods to generated message/union by @chaokunyang in https://github.com/apache/fory/pull/3238refactor(cpp): use snake_case namestyle for cpp by @chaokunyang in https://github.com/apache/fory/pull/3240perf(go): optimize go perf by @chaokunyang in https://github.com/apache/fory/pull/3241refactor(go): adjust go buffer uint32/64 write/read name style by @chaokunyang in https://github.com/apache/fory/pull/3242refactor(compiler): refactor fory compiler command line by @chaokunyang in https://github.com/apache/fory/pull/3243feat(compiler): add compatible mode for idl by @chaokunyang in https://github.com/apache/fory/pull/3245feat(go): add float16 support to go by @ayush00git in https://github.com/apache/fory/pull/3235feat(java): generate java List for primitive array by @chaokunyang in https://github.com/apache/fory/pull/3247feat(JavaScript): Impl xlang Map and Collection by @theweipeng in https://github.com/apache/fory/pull/3249feat(compiler/runtime): use hash for generated class as id and refactor user type id encoding by @chaokunyang in https://github.com/apache/fory/pull/3248refactor(spec): remove language byte from xlang in protocol by @chaokunyang in https://github.com/apache/fory/pull/3256refactor(go): move go struct serializer init to struct_init.go by @chaokunyang in https://github.com/apache/fory/pull/3255feat(protocol): add float8 and bfloat16 to protocol spec by @chaokunyang in https://github.com/apache/fory/pull/3259feat(compiler): add evolution option support by @chaokunyang in https://github.com/apache/fory/pull/3262feat(compiler): update toString/repr/std::fmt::Debug for generated ref code by @chaokunyang in https://github.com/apache/fory/pull/3264perf: optimize schema evolution mode performance by @chaokunyang in https://github.com/apache/fory/pull/3260feat(JavaScript): Impl xlang JavaScript testcase by @theweipeng in https://github.com/apache/fory/pull/3263feat(compiler): add list keyword for list fields by @chaokunyang in https://github.com/apache/fory/pull/3295  ","version":null,"tagName":"h2"},{"title":"Bug Fix‚Äã","type":1,"pageTitle":"Fory v0.15.0 Released","url":"/blog/fory_0_15_0_release#bug-fix","content":" fix(docs): fix graalvm link by @chaokunyang in https://github.com/apache/fory/pull/3056fix(Rust): prevent obtaining generic type metadata on custom types(struct/enum) by @urlyy in https://github.com/apache/fory/pull/3057fix(Rust): Move the calculating of TypeMeta::bytes and TypeMeta::hash ahead of serialization by @urlyy in https://github.com/apache/fory/pull/3060fix(java): Better ergonomics for AllowListChecker by @Asuka-star in https://github.com/apache/fory/pull/3061fix(rust): output original registered ID in type mismatch error log by @userzhy in https://github.com/apache/fory/pull/3067fix(java): Fix CopyOnWriteArrayList field serialization by @vybhavjs in https://github.com/apache/fory/pull/3079fix(go): reference tracking fails when &gt;127 objects serialized by @jonyoder in https://github.com/apache/fory/pull/3086fix(java): fix abstract enum and abstract array serialization for GraalVM by @chaokunyang in https://github.com/apache/fory/pull/3095fix(rust): enable Union type cross-language serialization between Rust and Java by @ariesdevil in https://github.com/apache/fory/pull/3094fix: x86 architecture missing from universal2 macOS wheel by @madhavajay in https://github.com/apache/fory/pull/3114fix(java): optimize type resolver calls for xlang mode on graalvm by @chaokunyang in https://github.com/apache/fory/pull/3129fix(java): stop compilation service when shutdowning compile service by @chaokunyang in https://github.com/apache/fory/pull/3138fix(python): fix collection null elements read/write by @chaokunyang in https://github.com/apache/fory/pull/3149fix: typo in the xlang_serialization_spec.md by @ayush00git in https://github.com/apache/fory/pull/3151fix(java): use littlen endian for utf16 string on big endian by @chaokunyang in https://github.com/apache/fory/pull/3159fix(java): fix openj9 sliced string serde by @chaokunyang in https://github.com/apache/fory/pull/3160fix(cpp): fix fory cpp compile warnings by @chaokunyang in https://github.com/apache/fory/pull/3188fix(cpp): issue 3229 - compile error on gcc16 by @xflcx1991 in https://github.com/apache/fory/pull/3230fix(java): fix java ci maven module error by @chaokunyang in https://github.com/apache/fory/pull/3265fix(go): prevent panic in readUTF16LE with odd byte counts by @jonyoder in https://github.com/apache/fory/pull/3293  ","version":null,"tagName":"h2"},{"title":"Other Improvements‚Äã","type":1,"pageTitle":"Fory v0.15.0 Released","url":"/blog/fory_0_15_0_release#other-improvements","content":" chore: bump release version to 0.14.0 by @chaokunyang in https://github.com/apache/fory/pull/3052chore: fix benchmark plot by @chaokunyang in https://github.com/apache/fory/pull/3053docs: add cpp doc in main readme.md by @chaokunyang in https://github.com/apache/fory/pull/3055chore(deps): bump org.apache.logging.log4j:log4j-core from 2.20.0 to 2.25.3 in /java/fory-test-core by @dependabot[bot] in https://github.com/apache/fory/pull/3065chore(python): Update badge styles in README.md by @chaokunyang in https://github.com/apache/fory/pull/3072chore(rust): revert rust crates version by @ariesdevil in https://github.com/apache/fory/pull/3075docs(cpp): Add MSVC compatibility to the CMake sample in the CPP document. by @Eiskomet in https://github.com/apache/fory/pull/3078chore: bump release version to 0.14.1 by @chaokunyang in https://github.com/apache/fory/pull/3096docs(go): add go serialization doc by @chaokunyang in https://github.com/apache/fory/pull/3121docs(go): fix go serialization doc by @chaokunyang in https://github.com/apache/fory/pull/3125docs(go): fix broken go doc links by @chaokunyang in https://github.com/apache/fory/pull/3127docs(go): add go version requirements by @chaokunyang in https://github.com/apache/fory/pull/3134docs(go): add docs for go pkg dev by @chaokunyang in https://github.com/apache/fory/pull/3135docs: adjust doc links and sync config by @chaokunyang in https://github.com/apache/fory/pull/3136docs: remove redundant prefix doc id by @chaokunyang in https://github.com/apache/fory/pull/3141docs: add field configuration doc by @chaokunyang in https://github.com/apache/fory/pull/3143docs: fix field type broken links by @chaokunyang in https://github.com/apache/fory/pull/3146docs: fix field type meta pos by @chaokunyang in https://github.com/apache/fory/pull/3147docs: fix native field type meta doc by @chaokunyang in https://github.com/apache/fory/pull/3148chore(java): move java benchmark to bench dir by @chaokunyang in https://github.com/apache/fory/pull/3152docs: fix typo and grammar in readme by @Howard-aile in https://github.com/apache/fory/pull/3156docs: update agents.md by @chaokunyang in https://github.com/apache/fory/pull/3162docs(compiler): update fory compiler doc by @chaokunyang in https://github.com/apache/fory/pull/3183docs: fix protobuf docs by @chaokunyang in https://github.com/apache/fory/pull/3185docs: add missing protobuf-idl.md by @chaokunyang in https://github.com/apache/fory/pull/3186docs(cpp): add cpp polymorphism doc by @chaokunyang in https://github.com/apache/fory/pull/3187docs: Fix links in README by @chaokunyang in https://github.com/apache/fory/pull/3212chore(java): rename _getTypeResolver to getTypeResolver by @chaokunyang in https://github.com/apache/fory/pull/3227chore(cpp): remove unique token from FORY_FIELD_CONFIG by @chaokunyang in https://github.com/apache/fory/pull/3228docs(compiler): merge type system doc into schema-idl odc by @chaokunyang in https://github.com/apache/fory/pull/3258chore: fix bump version and add rust/comiler auto release by @chaokunyang in https://github.com/apache/fory/pull/3257docs: move language impl reference to a new doc by @chaokunyang in https://github.com/apache/fory/pull/3261docs(go): add go benchmarks result by @chaokunyang in https://github.com/apache/fory/pull/3296chore: speedup windows ci by @chaokunyang in https://github.com/apache/fory/pull/3297  ","version":null,"tagName":"h2"},{"title":"New Contributors‚Äã","type":1,"pageTitle":"Fory v0.15.0 Released","url":"/blog/fory_0_15_0_release#new-contributors","content":" @jim-parsons made their first contribution in https://github.com/apache/fory/pull/3048@Asuka-star made their first contribution in https://github.com/apache/fory/pull/3061@userzhy made their first contribution in https://github.com/apache/fory/pull/3067@ariesdevil made their first contribution in https://github.com/apache/fory/pull/3074@Eiskomet made their first contribution in https://github.com/apache/fory/pull/3078@vybhavjs made their first contribution in https://github.com/apache/fory/pull/3079@jonyoder made their first contribution in https://github.com/apache/fory/pull/3086@theharsh999 made their first contribution in https://github.com/apache/fory/pull/3100@madhavajay made their first contribution in https://github.com/apache/fory/pull/3114@Pigsy-Monk made their first contribution in https://github.com/apache/fory/pull/3115@ayush00git made their first contribution in https://github.com/apache/fory/pull/3139@Howard-aile made their first contribution in https://github.com/apache/fory/pull/3156@xflcx1991 made their first contribution in https://github.com/apache/fory/pull/3230  Full Changelog: https://github.com/apache/fory/compare/v0.14.1...v0.15.0 ","version":null,"tagName":"h2"},{"title":"Fury v0.1.1 released","type":0,"sectionRef":"#","url":"/blog/fury_0_1_1_release","content":"","keywords":"","version":null},{"title":"Highlights‚Äã","type":1,"pageTitle":"Fury v0.1.1 released","url":"/blog/fury_0_1_1_release#highlights","content":" Java Dubbo fury integration: https://github.com/fury-project/dubbo-serialization-furyAdd class checker API to customize security check behaviour(#890) Python Support pyarrow6 bazel build (#859 #862)Support python 3.10 (#859 #862)  ","version":null,"tagName":"h2"},{"title":"What's Changed‚Äã","type":1,"pageTitle":"Fury v0.1.1 released","url":"/blog/fury_0_1_1_release#whats-changed","content":" [Java] Dubbo fury integration: https://github.com/fury-project/dubbo-serialization-fury[Java] fix isSecure check for xlang in java (#822)[Java] register empty object by default (#829)[Java] upgrade guava for(#831)[Python] Support pyarrow6 bazel build (#859)[Python] add missing shared lib for python (#862)[Java] optimize buffer copy (#870)[Doc] Fix row format doc (#873)[Java] fix ofHashMap (#877)[Java] add jdk tools.jar for tests (#881)[Java] Fix lazy bean serializer (#883)[Java] print exception for fury creation (#885)[Java] remove getCurrentFury API (#887)[Java] Add fury map iterator api (#889)[Java] Add class checker API (#890)[Python] Fix python linux deploy missing shared library files (#892)[[Java] refine AllowListChecker (#893)  Full Changelog: https://github.com/alipay/fury/compare/v0.1.0...v0.1.1 ","version":null,"tagName":"h2"},{"title":"Fury v0.1.2 released","type":0,"sectionRef":"#","url":"/blog/fury_0_1_2_release","content":"","keywords":"","version":null},{"title":"What's Changed‚Äã","type":1,"pageTitle":"Fury v0.1.2 released","url":"/blog/fury_0_1_2_release#whats-changed","content":" [Java] Skip toString in annotation invocation handler readObject (#746)[Python] Use cloudpickle for local function serialization (#914)[Python] fix row format getter (#915)  Full Changelog: https://github.com/alipay/fury/compare/v0.1.0...v0.1.1 ","version":null,"tagName":"h2"},{"title":"Fury v0.1.0 released","type":0,"sectionRef":"#","url":"/blog/fury_0_1_0_release","content":"","keywords":"","version":null},{"title":"New Contributors‚Äã","type":1,"pageTitle":"Fury v0.1.0 released","url":"/blog/fury_0_1_0_release#new-contributors","content":" @wangweipeng2 made their first contribution in https://github.com/alipay/fury/pull/215@rainsonGain made their first contribution in https://github.com/alipay/fury/pull/429@leeco-cloud made their first contribution in https://github.com/alipay/fury/pull/436@dependabot made their first contribution in https://github.com/alipay/fury/pull/590@tisonkun made their first contribution in https://github.com/alipay/fury/pull/762@hieu-ht made their first contribution in https://github.com/alipay/fury/pull/786@s31k31 made their first contribution in https://github.com/alipay/fury/pull/782  ","version":null,"tagName":"h2"},{"title":"What's Changed‚Äã","type":1,"pageTitle":"Fury v0.1.0 released","url":"/blog/fury_0_1_0_release#whats-changed","content":" Create pull_request_template.md by @chaokunyang in https://github.com/alipay/fury/pull/2add apache licence file by @chaokunyang in https://github.com/alipay/fury/pull/3[Java] add java code structure by @chaokunyang in https://github.com/alipay/fury/pull/4[Java] add java code formatter by @chaokunyang in https://github.com/alipay/fury/pull/5[Java] Add licence to file header by @chaokunyang in https://github.com/alipay/fury/pull/6[Docs] add fury debug doc by @chaokunyang in https://github.com/alipay/fury/pull/8[Docs] refine readme by fix syntax error by @chaokunyang in https://github.com/alipay/fury/pull/10[Community] add getting involved document by @chaokunyang in https://github.com/alipay/fury/pull/12[Java] add java ci by @chaokunyang in https://github.com/alipay/fury/pull/14[Java] fix license format conflict with checkstyle by @chaokunyang in https://github.com/alipay/fury/pull/16[Java] Add unsafe memory util by @chaokunyang in https://github.com/alipay/fury/pull/18[Java] add tuple2/tuple3 utils by @chaokunyang in https://github.com/alipay/fury/pull/20[Java] add LoggerFactory for disable logging more easily by @chaokunyang in https://github.com/alipay/fury/pull/22[Java] add string utils by @chaokunyang in https://github.com/alipay/fury/pull/24[Java] add memory read/write utils by @chaokunyang in https://github.com/alipay/fury/pull/26[Community] update slack invite link by @chaokunyang in https://github.com/alipay/fury/pull/27[Java] add cross-language type id by @chaokunyang in https://github.com/alipay/fury/pull/35[Java] Add api annotation to mark api stability by @chaokunyang in https://github.com/alipay/fury/pull/37[Java] add int array to avoid box cost by @chaokunyang in https://github.com/alipay/fury/pull/39[Java] add auto-growing object array by @chaokunyang in https://github.com/alipay/fury/pull/41[Java] Add optimized map for faster lookup by @chaokunyang in https://github.com/alipay/fury/pull/43[Java] add basic type inference support by @chaokunyang in https://github.com/alipay/fury/pull/45[Java] Add long map support by @chaokunyang in https://github.com/alipay/fury/pull/47[Java] add fury exceptions by @chaokunyang in https://github.com/alipay/fury/pull/48[Java] add MurmurHash3 support by @chaokunyang in https://github.com/alipay/fury/pull/50[Java] add Reflection support by @chaokunyang in https://github.com/alipay/fury/pull/52add FieldAccessor and fields compare by @chaokunyang in https://github.com/alipay/fury/pull/54[Java] implement basic compiler backend based on janino by @chaokunyang in https://github.com/alipay/fury/pull/56[Java] Add extensible classloaders by @chaokunyang in https://github.com/alipay/fury/pull/58[Java] Support multi key weak map by @chaokunyang in https://github.com/alipay/fury/pull/60[Java] codegen framework for fury java jit by @chaokunyang in https://github.com/alipay/fury/pull/61[Java] add utility for lambda functions by @chaokunyang in https://github.com/alipay/fury/pull/63[Java] add common expression ir for programing construct by @chaokunyang in https://github.com/alipay/fury/pull/64[Java] fix if expression with return child node by @chaokunyang in https://github.com/alipay/fury/pull/66[Java] add expression tree traverser and updater by @chaokunyang in https://github.com/alipay/fury/pull/68[Java] add missing author java odc by @chaokunyang in https://github.com/alipay/fury/pull/69[Java] add enum string resolver support by @chaokunyang in https://github.com/alipay/fury/pull/72[Java] add reference tracking support by @chaokunyang in https://github.com/alipay/fury/pull/74[Java] add java serializer interface by @chaokunyang in https://github.com/alipay/fury/pull/76[Java] add test utils by @chaokunyang in https://github.com/alipay/fury/pull/77[Java] add generics hierarchy resolving support by @chaokunyang in https://github.com/alipay/fury/pull/79[Java] add serialization context to relate serializing different objects by @chaokunyang in https://github.com/alipay/fury/pull/82[Java] add class info util by @chaokunyang in https://github.com/alipay/fury/pull/83[Java] add buffer callback by @chaokunyang in https://github.com/alipay/fury/pull/87[Java] implement basic java serialization framework by @chaokunyang in https://github.com/alipay/fury/pull/88[Java] Add string serializer by @chaokunyang in https://github.com/alipay/fury/pull/90[Java] add string builder/buffer serializers by @chaokunyang in https://github.com/alipay/fury/pull/93[Java] add missing uint serializers tests by @chaokunyang in https://github.com/alipay/fury/pull/95[Java] Implement enum serialization for java by @chaokunyang in https://github.com/alipay/fury/pull/97[Java] Implement bigint/decimal serialization for java by @chaokunyang in https://github.com/alipay/fury/pull/101[Community] add zhihu link by @chaokunyang in https://github.com/alipay/fury/pull/103[Community] fix zhihu link by @chaokunyang in https://github.com/alipay/fury/pull/104[Community] update slack desc by @chaokunyang in https://github.com/alipay/fury/pull/105[Java] Add object array serializer by @chaokunyang in https://github.com/alipay/fury/pull/107[Java] Implement primitive array serializers by @chaokunyang in https://github.com/alipay/fury/pull/109[Java] support serializing byte buffer by @chaokunyang in https://github.com/alipay/fury/pull/113[Java] support serializing java.util.concurrent.atomics by @chaokunyang in https://github.com/alipay/fury/pull/115[Java] move string array serializers by @chaokunyang in https://github.com/alipay/fury/pull/116[Java] support Currency serialization by @chaokunyang in https://github.com/alipay/fury/pull/118[Java] support charset serialization by @chaokunyang in https://github.com/alipay/fury/pull/120[Java] support URI serialization by @chaokunyang in https://github.com/alipay/fury/pull/122[Java] add support for regex serialization by @chaokunyang in https://github.com/alipay/fury/pull/124[Java] support uuid serialization by @chaokunyang in https://github.com/alipay/fury/pull/126[Java] add class serialization test by @chaokunyang in https://github.com/alipay/fury/pull/127[Java] add Locale Serializer support by @chaokunyang in https://github.com/alipay/fury/pull/129[Java] fix LocaleSerializer cache thread safety by @chaokunyang in https://github.com/alipay/fury/pull/132[Java] serialization support for java.util.OptionalXXX by @chaokunyang in https://github.com/alipay/fury/pull/134[Java] Add time serializers by @chaokunyang in https://github.com/alipay/fury/pull/137[Java] add ObjectInput/Output based on fury by @chaokunyang in https://github.com/alipay/fury/pull/139[Java] add JavaSerializer based on ObjectInputStream/ObjectOutputStream by @chaokunyang in https://github.com/alipay/fury/pull/141[Java] implement jdk proxy serialization by @chaokunyang in https://github.com/alipay/fury/pull/143[Java] implement Externalizable serialization by @chaokunyang in https://github.com/alipay/fury/pull/145[Java] implement Collection serialization by @chaokunyang in https://github.com/alipay/fury/pull/147[Java] add sortedset serializer by @chaokunyang in https://github.com/alipay/fury/pull/149[Java] add empty collection serializer by @chaokunyang in https://github.com/alipay/fury/pull/151[Java] add single collection serializers by @chaokunyang in https://github.com/alipay/fury/pull/153[Java] add ConcurrentSkipListSet serializer by @chaokunyang in https://github.com/alipay/fury/pull/155[Java] add java.util.Vector serializer by @chaokunyang in https://github.com/alipay/fury/pull/157[Java] add java.util.ArrayDeque serializer by @chaokunyang in https://github.com/alipay/fury/pull/159[Java] add java.util.EnumSet serializer by @chaokunyang in https://github.com/alipay/fury/pull/161[Java] implement java.util.BitSet serializer by @chaokunyang in https://github.com/alipay/fury/pull/163[Java] implement java.util.PriorityQueue serialization by @chaokunyang in https://github.com/alipay/fury/pull/165[Java] implement map serialization framework by @chaokunyang in https://github.com/alipay/fury/pull/167[Java] support java.util.SortedMap serialization by @chaokunyang in https://github.com/alipay/fury/pull/169[Java] support empty map serialization by @chaokunyang in https://github.com/alipay/fury/pull/171[Java] implement singleton map serialization by @chaokunyang in https://github.com/alipay/fury/pull/173[Java] support concurrent map serialization by @chaokunyang in https://github.com/alipay/fury/pull/175[Java] implement enum map serialization by @chaokunyang in https://github.com/alipay/fury/pull/177[Java] group and sort descriptors for cache and consistency by @chaokunyang in https://github.com/alipay/fury/pull/179[Java] Implement object serialization by @chaokunyang in https://github.com/alipay/fury/pull/181[Java] fury native lambda serialization for java by @chaokunyang in https://github.com/alipay/fury/pull/183Update feature_request.md by @chaokunyang in https://github.com/alipay/fury/pull/184Update bug_report.md by @chaokunyang in https://github.com/alipay/fury/pull/185Update bug_report.md by @chaokunyang in https://github.com/alipay/fury/pull/186[Java] Optimize Collections.synchronized serialization performance by @chaokunyang in https://github.com/alipay/fury/pull/188[Java] optimize unmodifiable serialization by @chaokunyang in https://github.com/alipay/fury/pull/191[Java] add native readResolve/writeReplace serialization support by @chaokunyang in https://github.com/alipay/fury/pull/193[Java] [1/N] support type forward/backward compatibility by @chaokunyang in https://github.com/alipay/fury/pull/196[Java] Add struct util to create test struct class dynamically by @chaokunyang in https://github.com/alipay/fury/pull/199Revert &quot;[Java] Add struct util to create test struct class dynamically&quot; by @chaokunyang in https://github.com/alipay/fury/pull/200[Java] Add struct util to create test struct class dynamically by @chaokunyang in https://github.com/alipay/fury/pull/201[Java] [2/N] support type forward/backward compatibility by @chaokunyang in https://github.com/alipay/fury/pull/195[Java] Optimize subclass container serialization by @chaokunyang in https://github.com/alipay/fury/pull/205[Java] remove generated classes automatically by @chaokunyang in https://github.com/alipay/fury/pull/207[Java] implement collection serialization field by field by @chaokunyang in https://github.com/alipay/fury/pull/209[Java] implement java map serialization field by field by @chaokunyang in https://github.com/alipay/fury/pull/210[Java] optimize jdk compatible collection serializer by @chaokunyang in https://github.com/alipay/fury/pull/212[Java] support compatible map serialization by @chaokunyang in https://github.com/alipay/fury/pull/213[JavaScript] javascript of fury by @wangweipeng2 in https://github.com/alipay/fury/pull/215[JavaScript]Replace Nodejs lib by standard lib by @wangweipeng2 in https://github.com/alipay/fury/pull/217[JavaScript]Add test by @wangweipeng2 in https://github.com/alipay/fury/pull/219[JavaScript] Change package.json entry file by @wangweipeng2 in https://github.com/alipay/fury/pull/221Update feature_request.md by @chaokunyang in https://github.com/alipay/fury/pull/223[Java] implement fury-native jdk compatible object serialization by @chaokunyang in https://github.com/alipay/fury/pull/222[Java] Add class def for meta sharing by @chaokunyang in https://github.com/alipay/fury/pull/226[Java] Support meta shared serialization by @chaokunyang in https://github.com/alipay/fury/pull/225[Java] add missing license to ObjectStreamSerializer by @chaokunyang in https://github.com/alipay/fury/pull/228[Java] move loadClass to ClassUtils by @chaokunyang in https://github.com/alipay/fury/pull/229[javascript] add javascript ci by @chaokunyang in https://github.com/alipay/fury/pull/230Fix CI by @chaokunyang in https://github.com/alipay/fury/pull/232[Java] forbid classes serialization by blacklist by @chaokunyang in https://github.com/alipay/fury/pull/234[Java] generate field accessor on the flight by @chaokunyang in https://github.com/alipay/fury/pull/240[Java] expression optimizer for method split by @chaokunyang in https://github.com/alipay/fury/pull/241[JavaScript]Fix ci by @wangweipeng2 in https://github.com/alipay/fury/pull/242[Java] add codec builder base class by @chaokunyang in https://github.com/alipay/fury/pull/244[Java] add jdk serializable check by @chaokunyang in https://github.com/alipay/fury/pull/248[Java] add base object serializer builder by @chaokunyang in https://github.com/alipay/fury/pull/249[Java] Implement jit serialization for object by @chaokunyang in https://github.com/alipay/fury/pull/250[Java] Fix meta shared serializer when jit enabled by @chaokunyang in https://github.com/alipay/fury/pull/252Update bug_report.md by @chaokunyang in https://github.com/alipay/fury/pull/253[Java] type forward/backward compatible jit serializer by @chaokunyang in https://github.com/alipay/fury/pull/254[Java] Meta shared object jit serializer by @chaokunyang in https://github.com/alipay/fury/pull/255[Java] jit context for manage compilation by @chaokunyang in https://github.com/alipay/fury/pull/259[Java] fix javaFury thread safety by @chaokunyang in https://github.com/alipay/fury/pull/261[Java] set rootdir for maven multi-module project by @chaokunyang in https://github.com/alipay/fury/pull/263[Java] add guava immutable list serializer by @chaokunyang in https://github.com/alipay/fury/pull/264[Java] add guava immutable map serializer by @chaokunyang in https://github.com/alipay/fury/pull/266[Java] Async compilation for jit serializers by @chaokunyang in https://github.com/alipay/fury/pull/268[Java] add url serializer by @chaokunyang in https://github.com/alipay/fury/pull/269[Java] optimize java serialization by @chaokunyang in https://github.com/alipay/fury/pull/271[Java] bind fury with classloader by @chaokunyang in https://github.com/alipay/fury/pull/274[Java] add forward serializer by @chaokunyang in https://github.com/alipay/fury/pull/276[Java] add thread-safe fury serializer by @chaokunyang in https://github.com/alipay/fury/pull/278[Java] Add guava/sublist todo serializer by @chaokunyang in https://github.com/alipay/fury/pull/282[Java] add zero-copy tests by @chaokunyang in https://github.com/alipay/fury/pull/284[Java] Profiling fury init by @chaokunyang in https://github.com/alipay/fury/pull/286[Java] add complex cyclic tests by @chaokunyang in https://github.com/alipay/fury/pull/288[Java] enable testArrayStructZeroCopy by @chaokunyang in https://github.com/alipay/fury/pull/290[Java] add complex collection struct tests by @chaokunyang in https://github.com/alipay/fury/pull/292[Java] add complex map struct tests by @chaokunyang in https://github.com/alipay/fury/pull/294[Java] misc serializer tests by @chaokunyang in https://github.com/alipay/fury/pull/295[Java] optimize time reference by @chaokunyang in https://github.com/alipay/fury/pull/297[Java] add unsafe accessor test for duplicate fields by @chaokunyang in https://github.com/alipay/fury/pull/299[Java] add serializer factory test by @chaokunyang in https://github.com/alipay/fury/pull/301[Java] add duplicate fields tests by @chaokunyang in https://github.com/alipay/fury/pull/303[Java] add protocol interoperability tests by @chaokunyang in https://github.com/alipay/fury/pull/305[Java] Lazy map support by @chaokunyang in https://github.com/alipay/fury/pull/307[Java] Support deserialize unexisted classes by @chaokunyang in https://github.com/alipay/fury/pull/309[Java] fix OutOfBandTest pkg by @chaokunyang in https://github.com/alipay/fury/pull/310javascript latin1 string performance improvement by @wangweipeng2 in https://github.com/alipay/fury/pull/312[Java] Add row format interface by @chaokunyang in https://github.com/alipay/fury/pull/316[Java] add Default arrow type visitor by @chaokunyang in https://github.com/alipay/fury/pull/318[Java] add decimal util by @chaokunyang in https://github.com/alipay/fury/pull/320[Java] add pyarrow style data types API in java by @chaokunyang in https://github.com/alipay/fury/pull/322[Java] add fury InputStream/OutputStream by @chaokunyang in https://github.com/alipay/fury/pull/324[Java] Infer arrow schema for java bean by @chaokunyang in https://github.com/alipay/fury/pull/326[Java] add bitmap utils by @chaokunyang in https://github.com/alipay/fury/pull/328[Java] binary row format data structure by @chaokunyang in https://github.com/alipay/fury/pull/330[Java] binary row format writer by @chaokunyang in https://github.com/alipay/fury/pull/333[Java] add arrow visitor for value accessor by @chaokunyang in https://github.com/alipay/fury/pull/335[Java] add row format tests by @chaokunyang in https://github.com/alipay/fury/pull/337[Java] add row format encoder interface by @chaokunyang in https://github.com/alipay/fury/pull/339[Java] Base builder for building jit encoder by @chaokunyang in https://github.com/alipay/fury/pull/341[Java] add jit-based row encoder implementation by @chaokunyang in https://github.com/alipay/fury/pull/343[Java] format code by @chaokunyang in https://github.com/alipay/fury/pull/344[Java] add missing license by @chaokunyang in https://github.com/alipay/fury/pull/345[Java] Add fury channel by @chaokunyang in https://github.com/alipay/fury/pull/346[Java] Mock io for count bytes by @chaokunyang in https://github.com/alipay/fury/pull/349[Java] Arrow record batch zero-copy serializers by @chaokunyang in https://github.com/alipay/fury/pull/351[Java] Add missing license by @chaokunyang in https://github.com/alipay/fury/pull/352[Java] optimize decimal encoding performance by @chaokunyang in https://github.com/alipay/fury/pull/354[Java] optimize schema creation perf by @chaokunyang in https://github.com/alipay/fury/pull/356[Java] update row javadoc by @chaokunyang in https://github.com/alipay/fury/pull/357[Java] Support convert row to arrow format by @chaokunyang in https://github.com/alipay/fury/pull/359[Java] add arrow serializers tests by @chaokunyang in https://github.com/alipay/fury/pull/361[Java] fix arrow tests by @chaokunyang in https://github.com/alipay/fury/pull/362[Java] add serialize to buffer tests by @chaokunyang in https://github.com/alipay/fury/pull/364[Java] add basic cross-langauge serialization tests by @chaokunyang in https://github.com/alipay/fury/pull/366[Java] add serializeBeanTest by @chaokunyang in https://github.com/alipay/fury/pull/367[Java] add registerTest by @chaokunyang in https://github.com/alipay/fury/pull/368[Java] add testTreeMap by @chaokunyang in https://github.com/alipay/fury/pull/369[Java] add offheap tests by @chaokunyang in https://github.com/alipay/fury/pull/371[Java] refine classresovler tests by @chaokunyang in https://github.com/alipay/fury/pull/373[Java] add private bean tests by @chaokunyang in https://github.com/alipay/fury/pull/375[Java] add blocking queue test by @chaokunyang in https://github.com/alipay/fury/pull/377[Java] add duplicate fields test by @chaokunyang in https://github.com/alipay/fury/pull/378[Java] add guava tests by @chaokunyang in https://github.com/alipay/fury/pull/381[Java] add test for jdk serializable check by @chaokunyang in https://github.com/alipay/fury/pull/383[Java] add secure mode test by @chaokunyang in https://github.com/alipay/fury/pull/385[Java] ensure fury doesn't introduce class leak by @chaokunyang in https://github.com/alipay/fury/pull/387[Java] add tests for ignoring fields by @chaokunyang in https://github.com/alipay/fury/pull/389[Java] add thread to blacklist by @chaokunyang in https://github.com/alipay/fury/pull/391[Java] Add complex testsuite by @chaokunyang in https://github.com/alipay/fury/pull/393[Java] add benchmark framework by @chaokunyang in https://github.com/alipay/fury/pull/399[Java] add plotting tool by @chaokunyang in https://github.com/alipay/fury/pull/400[Java] add usertype benchmarks by @chaokunyang in https://github.com/alipay/fury/pull/401[Java] Add string benchmarks by @chaokunyang in https://github.com/alipay/fury/pull/403[Java] add array benchmark by @chaokunyang in https://github.com/alipay/fury/pull/405[Java] add map benchmark by @chaokunyang in https://github.com/alipay/fury/pull/409[Java] add memory benchmark by @chaokunyang in https://github.com/alipay/fury/pull/410[Java] add row format benchmark by @chaokunyang in https://github.com/alipay/fury/pull/411[Java] add zero copy benchmark by @chaokunyang in https://github.com/alipay/fury/pull/413[Java] Add flatbufffer/protobuffer benchmarks by @chaokunyang in https://github.com/alipay/fury/pull/415[Java] update integration_tests readme by @chaokunyang in https://github.com/alipay/fury/pull/416[C++] generate arrow bazel depdencies from pyarrow bundled shared library by @chaokunyang in https://github.com/alipay/fury/pull/418[C++] Add bazel C++ build support by @chaokunyang in https://github.com/alipay/fury/pull/420[C++] add c++ logging util by @chaokunyang in https://github.com/alipay/fury/pull/423[C++] add cpp status util by @chaokunyang in https://github.com/alipay/fury/pull/425[C++] basic util for bytes operations by @chaokunyang in https://github.com/alipay/fury/pull/427Update bug_report.md by @chaokunyang in https://github.com/alipay/fury/pull/430[Java] register class check duplciate id by @chaokunyang in https://github.com/alipay/fury/pull/432[Java] move ExpressionOptimizer into codegen package by @chaokunyang in https://github.com/alipay/fury/pull/433Format/container encoder by @rainsonGain in https://github.com/alipay/fury/pull/429[Java] Thread-safe fury implementation by pooling by @leeco-cloud in https://github.com/alipay/fury/pull/436[C++] Add c++ buffer util by @chaokunyang in https://github.com/alipay/fury/pull/438[CI] fix CI by @chaokunyang in https://github.com/alipay/fury/pull/439[C++] Binary row format for c++ by @chaokunyang in https://github.com/alipay/fury/pull/441[C++] C++ row format to arrow by @chaokunyang in https://github.com/alipay/fury/pull/442[C++] Add c++ ci by @chaokunyang in https://github.com/alipay/fury/pull/444[CI] Add code lint ci job by @chaokunyang in https://github.com/alipay/fury/pull/446[Doc] Add c++ debugging doc by @chaokunyang in https://github.com/alipay/fury/pull/448[Python] [1/n] Fury python binding by @chaokunyang in https://github.com/alipay/fury/pull/450[python] Type infer for python by @chaokunyang in https://github.com/alipay/fury/pull/458[Java] skip checkstyle in java test by @chaokunyang in https://github.com/alipay/fury/pull/459[Python] Fix python ci by @chaokunyang in https://github.com/alipay/fury/pull/461[Python] Python row format by @chaokunyang in https://github.com/alipay/fury/pull/463[Python] Python encoder for row format by @chaokunyang in https://github.com/alipay/fury/pull/466[Python] Row and arrow format converter by @chaokunyang in https://github.com/alipay/fury/pull/467[C++] cpp murmurhash by @chaokunyang in https://github.com/alipay/fury/pull/469[Python] Python murmur hash binding by @chaokunyang in https://github.com/alipay/fury/pull/472[Python] add weak key identity map by @chaokunyang in https://github.com/alipay/fury/pull/474[Python] add reference resolver by @chaokunyang in https://github.com/alipay/fury/pull/476[Python] Implement python serialization framework by @chaokunyang in https://github.com/alipay/fury/pull/478[Python] add common python serializers by @chaokunyang in https://github.com/alipay/fury/pull/480[Python] struct serialization support by @chaokunyang in https://github.com/alipay/fury/pull/482[Java] Fix get super type exception by @chaokunyang in https://github.com/alipay/fury/pull/484[Java] fix map final value type serializer in jit compatible mode by @chaokunyang in https://github.com/alipay/fury/pull/485[Docs] add fury logo by @chaokunyang in https://github.com/alipay/fury/pull/487[Docs] add square fury logo by @chaokunyang in https://github.com/alipay/fury/pull/488[python] add cpp reference resolver based on abseil map by @chaokunyang in https://github.com/alipay/fury/pull/493[python] add cpp class resolver by @chaokunyang in https://github.com/alipay/fury/pull/494[Python] cython serialization framework by @chaokunyang in https://github.com/alipay/fury/pull/496[Python] cython basic serializers by @chaokunyang in https://github.com/alipay/fury/pull/501[Python] cython container serializers by @chaokunyang in https://github.com/alipay/fury/pull/502[Pyhton] cython array serializers by @chaokunyang in https://github.com/alipay/fury/pull/503[Python] cython struct serializer by @chaokunyang in https://github.com/alipay/fury/pull/505[Python] cython misc serializers by @chaokunyang in https://github.com/alipay/fury/pull/506[Python] Unify cython python serializer by @chaokunyang in https://github.com/alipay/fury/pull/507[Python] Codegen serialization support by @chaokunyang in https://github.com/alipay/fury/pull/509[Python] Support arrow serialization in objgraph by @chaokunyang in https://github.com/alipay/fury/pull/515[Python] Add common pytests by @chaokunyang in https://github.com/alipay/fury/pull/517[C++] pin bazel to 4.2.0 by @chaokunyang in https://github.com/alipay/fury/pull/519[Community] Update contacts about wechat/dingding by @chaokunyang in https://github.com/alipay/fury/pull/521[Java] support struct cross language serialization by @chaokunyang in https://github.com/alipay/fury/pull/523[Java] add java/python cross language row format tests by @chaokunyang in https://github.com/alipay/fury/pull/525feat: fix qrcode size in readme by @wangweipeng2 in https://github.com/alipay/fury/pull/526[Java] replace io.furyx with org.furyio by @chaokunyang in https://github.com/alipay/fury/pull/527[Java] Add missing map license by @chaokunyang in https://github.com/alipay/fury/pull/529[Java] reduce string serializer caller stack by jit by @chaokunyang in https://github.com/alipay/fury/pull/531[Java] fix nested map generics by @chaokunyang in https://github.com/alipay/fury/pull/533[Java] fix jdk11 string jit serialization by @chaokunyang in https://github.com/alipay/fury/pull/535[JavaScript] improve write performance by @wangweipeng2 in https://github.com/alipay/fury/pull/538[Java] refine java benchmarks by @chaokunyang in https://github.com/alipay/fury/pull/536[Java] fix fury java kryo/fst benchmark classloading by @chaokunyang in https://github.com/alipay/fury/pull/542[Java] Unsafe method invoke optimization by @chaokunyang in https://github.com/alipay/fury/pull/543[Java] Optimize string serialization mem ops by @chaokunyang in https://github.com/alipay/fury/pull/545[Java] Optimze jit generated code by @chaokunyang in https://github.com/alipay/fury/pull/548[Java] Optimize primitive fields jit read/write by @chaokunyang in https://github.com/alipay/fury/pull/550[Java] Fix benchmark plot by @chaokunyang in https://github.com/alipay/fury/pull/554[Java] Upload benchmark data by @chaokunyang in https://github.com/alipay/fury/pull/555[Docs] Update benchmarks by @chaokunyang in https://github.com/alipay/fury/pull/560[Docs] use a smaller size for benchmark plots by @chaokunyang in https://github.com/alipay/fury/pull/561[Docs] update docs by @chaokunyang in https://github.com/alipay/fury/pull/565[Doc] update docs by @chaokunyang in https://github.com/alipay/fury/pull/566[Docs] update readme by @chaokunyang in https://github.com/alipay/fury/pull/567[JavaScript] Import js write performance by @wangweipeng2 in https://github.com/alipay/fury/pull/569[Docs ] fix benchmarks figures align by @chaokunyang in https://github.com/alipay/fury/pull/571[Docs] fix python typehint comment by @chaokunyang in https://github.com/alipay/fury/pull/572[Docs] add row format to arrow conversion java example by @chaokunyang in https://github.com/alipay/fury/pull/573[JavaScript] update benchmark by @wangweipeng2 in https://github.com/alipay/fury/pull/574[JavaScript] easy type description by @wangweipeng2 in https://github.com/alipay/fury/pull/576[JavaScript] add generic constraints to the serializer by @wangweipeng2 in https://github.com/alipay/fury/pull/577[Docs] Refine benchmark plots by @chaokunyang in https://github.com/alipay/fury/pull/578[Docs] fix java header by @chaokunyang in https://github.com/alipay/fury/pull/582[Python] support secure mode for python by @chaokunyang in https://github.com/alipay/fury/pull/584[Docs] update readme speedup by @chaokunyang in https://github.com/alipay/fury/pull/585[Docs] remove Binary Serialization from header by @chaokunyang in https://github.com/alipay/fury/pull/586[Docs] add Serialization to header by @chaokunyang in https://github.com/alipay/fury/pull/587[Docs] fix invalid image links in cpp debug doc by @chaokunyang in https://github.com/alipay/fury/pull/589Bump protobuf-java from 3.11.0 to 3.16.3 in /java/fury-benchmark by @dependabot in https://github.com/alipay/fury/pull/590Bump testng from 7.3.0 to 7.5.1 in /java by @dependabot in https://github.com/alipay/fury/pull/591Bump checkstyle from 8.19 to 8.29 in /java by @dependabot in https://github.com/alipay/fury/pull/592Bump guava from 30.0-jre to 32.0.0-jre in /java by @dependabot in https://github.com/alipay/fury/pull/593Bump protobuf-java from 3.15.0 to 3.16.3 in /integration_tests by @dependabot in https://github.com/alipay/fury/pull/594[Java] replace log4j by log4j2 for test modules by @chaokunyang in https://github.com/alipay/fury/pull/595[JavaScript] update benchmark by @wangweipeng2 in https://github.com/alipay/fury/pull/597[Java] rename reference to ref by @chaokunyang in https://github.com/alipay/fury/pull/599[Java] fix checkstyle failure by @chaokunyang in https://github.com/alipay/fury/pull/602[Java] fix missing reference renaming by @chaokunyang in https://github.com/alipay/fury/pull/603[Java] Rename requireClassRegistration by @chaokunyang in https://github.com/alipay/fury/pull/604[JavaScript]: remove dependency on v8 by @wangweipeng2 in https://github.com/alipay/fury/pull/606[Rust] Add readme for fury rust by @chaokunyang in https://github.com/alipay/fury/pull/607[Java] add missing license for java code by @chaokunyang in https://github.com/alipay/fury/pull/608[Java] update java benchmarks by @chaokunyang in https://github.com/alipay/fury/pull/609[Docs] update java benchmarks chart size by @chaokunyang in https://github.com/alipay/fury/pull/610[Docs] use same color for fury best performance by @chaokunyang in https://github.com/alipay/fury/pull/611[Java] add MetaContext tests by @chaokunyang in https://github.com/alipay/fury/pull/613[Java] Add java misc tests by @chaokunyang in https://github.com/alipay/fury/pull/614[Java] Add codegen class loading/gc tests by @chaokunyang in https://github.com/alipay/fury/pull/616[Java] add warn logs when requireClassRegistration disabled by @chaokunyang in https://github.com/alipay/fury/pull/618[Docs] Add java adcanced user guide doc by @chaokunyang in https://github.com/alipay/fury/pull/621[Docs] Update java advanced doc by @chaokunyang in https://github.com/alipay/fury/pull/625[JavaScript] Eliminate polymorphism in JS code by @wangweipeng2 in https://github.com/alipay/fury/pull/627[Python] rename reference to ref for python by @chaokunyang in https://github.com/alipay/fury/pull/629[Java/Python] Rename crosslanguage to x by @chaokunyang in https://github.com/alipay/fury/pull/631[JavaScript] reduce generated code size by @wangweipeng2 in https://github.com/alipay/fury/pull/633[Java] update java snapshot url by @chaokunyang in https://github.com/alipay/fury/pull/635[CI] Enable Fury CI by @chaokunyang in https://github.com/alipay/fury/pull/636[Docs] add benchmark data by @chaokunyang in https://github.com/alipay/fury/pull/639[Doc] use camel naming for benchmark class doc by @chaokunyang in https://github.com/alipay/fury/pull/640[Docs] Update security doc by @chaokunyang in https://github.com/alipay/fury/pull/642[Java] update license for Generics by @chaokunyang in https://github.com/alipay/fury/pull/644[Java] fix generics license length by @chaokunyang in https://github.com/alipay/fury/pull/645[Java] update java security doc by @chaokunyang in https://github.com/alipay/fury/pull/646[Go] update golang readme by @chaokunyang in https://github.com/alipay/fury/pull/648[Doc] replace Fury.Language by Language by @chaokunyang in https://github.com/alipay/fury/pull/650[Java] update java row readme by @chaokunyang in https://github.com/alipay/fury/pull/651[Java] register guava serializers ahead by @chaokunyang in https://github.com/alipay/fury/pull/654[Docs] split user guide doc into 3 parts to sync with website by @chaokunyang in https://github.com/alipay/fury/pull/665[Docs] move guide docs to guide by @chaokunyang in https://github.com/alipay/fury/pull/667[Doc] sync files to home site by @wangweipeng2 in https://github.com/alipay/fury/pull/666[Java] Fix IndexOutOfBoundsException when new fury deserialize from InputStream by @chaokunyang in https://github.com/alipay/fury/pull/671[Doc] support front matter by @wangweipeng2 in https://github.com/alipay/fury/pull/672[Doc] rename inner fury to f when creating ThreadSafeFury by @chaokunyang in https://github.com/alipay/fury/pull/676[Java] Support string zerocopy for jdk14+ by @chaokunyang in https://github.com/alipay/fury/pull/677[CI] Add deploy script by @chaokunyang in https://github.com/alipay/fury/pull/688[Java] Support maven release by @chaokunyang in https://github.com/alipay/fury/pull/691[Doc] add java release jar for v0.1.0-alpha.1 by @chaokunyang in https://github.com/alipay/fury/pull/693[Doc] Fix release jar doc by @chaokunyang in https://github.com/alipay/fury/pull/694[Doc] Refine readme for more readability by @chaokunyang in https://github.com/alipay/fury/pull/695[Java] Add detailed lambda error by @chaokunyang in https://github.com/alipay/fury/pull/698[Doc] Fix threadsafe example by @chaokunyang in https://github.com/alipay/fury/pull/699[Docs] fix threadsafe fury in java guide by @chaokunyang in https://github.com/alipay/fury/pull/700[Docs] remove bracket from classLoader by @chaokunyang in https://github.com/alipay/fury/pull/701[Java] add maven source plugin by @chaokunyang in https://github.com/alipay/fury/pull/702[Java] Jdk serialization binary check by @chaokunyang in https://github.com/alipay/fury/pull/714[Java] add jdk migration doc by @chaokunyang in https://github.com/alipay/fury/pull/715[Java] Support jit for non public classes by @chaokunyang in https://github.com/alipay/fury/pull/719[Rust] rust lang initial version by @wangweipeng2 in https://github.com/alipay/fury/pull/718[Java] add type tag registration check by @chaokunyang in https://github.com/alipay/fury/pull/722[Doc] highlight warmup by @chaokunyang in https://github.com/alipay/fury/pull/723[Rust ] calculate the reserved space on compile time by @wangweipeng2 in https://github.com/alipay/fury/pull/725[Java/Python] disable reference tracking by default by @chaokunyang in https://github.com/alipay/fury/pull/727[Java] debug log code stats by @chaokunyang in https://github.com/alipay/fury/pull/728[Java] upgrade java install to 0.1.0-alpha.2 by @chaokunyang in https://github.com/alipay/fury/pull/731[Doc] use fury png logo by @chaokunyang in https://github.com/alipay/fury/pull/733[Doc] remove margin fury png logo by @chaokunyang in https://github.com/alipay/fury/pull/734[Doc] Refine logo and icon by @chaokunyang in https://github.com/alipay/fury/pull/735[ Rust ] Make the protocols of rust and js consistent by @wangweipeng2 in https://github.com/alipay/fury/pull/738[JavaScript] Make the protocols of rust and js consistent by @wangweipeng2 in https://github.com/alipay/fury/pull/739[Java] Remove guava from userdoc by @chaokunyang in https://github.com/alipay/fury/pull/740[Java] rename writeNonRefT to writeNonRef by @chaokunyang in https://github.com/alipay/fury/pull/743[Java] Optimize object array serialization by @chaokunyang in https://github.com/alipay/fury/pull/741[Java] avoid reflection in resolve/replace by @chaokunyang in https://github.com/alipay/fury/pull/744[Java] avoid reflection in writeObject/readOject/readObjectNoData by @chaokunyang in https://github.com/alipay/fury/pull/747[Java] optimize guava list serialization by @chaokunyang in https://github.com/alipay/fury/pull/748[Java] add MakeJDKFunction lambda factory by @chaokunyang in https://github.com/alipay/fury/pull/752[Java] Optimize guava List/Map/Set serialization by @chaokunyang in https://github.com/alipay/fury/pull/750[Doc] Add contributing guide doc by @chaokunyang in https://github.com/alipay/fury/pull/759[Doc] Create CODE_OF_CONDUCT.md by @chaokunyang in https://github.com/alipay/fury/pull/761[Doc] Fix broken link in README by @tisonkun in https://github.com/alipay/fury/pull/762[Rust] Several Rust idioms by @tisonkun in https://github.com/alipay/fury/pull/763[Java] fix write replace class failure by @chaokunyang in https://github.com/alipay/fury/pull/767[Java] replace withSecureMode by requireClassRegistration API by @chaokunyang in https://github.com/alipay/fury/pull/768[Doc] Update README.md by @chaokunyang in https://github.com/alipay/fury/pull/770[Doc] add javadoc for FuryBuilder by @chaokunyang in https://github.com/alipay/fury/pull/775[Doc] add doc for fury creation reuse by @chaokunyang in https://github.com/alipay/fury/pull/777[Java] [Python] auto deploy java/python packages by @chaokunyang in https://github.com/alipay/fury/pull/781[Java] refine FuryBuilder API by @chaokunyang in https://github.com/alipay/fury/pull/784[CI] skip release tests by @chaokunyang in https://github.com/alipay/fury/pull/785Corrected grammar and paraphrasing to make the README easier to read by @hieu-ht in https://github.com/alipay/fury/pull/786Don't let CI run when the changed files are not the code by @hieu-ht in https://github.com/alipay/fury/pull/787[Java] use lambda for SynchronizedSerializers factory by @chaokunyang in https://github.com/alipay/fury/pull/789[Java] use lambda for unmodifiable serializers factory by @chaokunyang in https://github.com/alipay/fury/pull/790[Python] replace alpha/beta to a/b for python by @chaokunyang in https://github.com/alipay/fury/pull/792[Python] fix python bump version by @chaokunyang in https://github.com/alipay/fury/pull/793[CI] Fix bump version by @chaokunyang in https://github.com/alipay/fury/pull/795[CI] Fix py release by @chaokunyang in https://github.com/alipay/fury/pull/796[Doc] update python and java install by @chaokunyang in https://github.com/alipay/fury/pull/797Update README.md by @chaokunyang in https://github.com/alipay/fury/pull/800[Doc] Update java install version to 0.1.0-alpah.5 by @chaokunyang in https://github.com/alipay/fury/pull/801[CI] Fix pypi upload by @chaokunyang in https://github.com/alipay/fury/pull/803[Java] Add core java developer to maven pom by @chaokunyang in https://github.com/alipay/fury/pull/802[Java] add core java developer to maven modules pom by @chaokunyang in https://github.com/alipay/fury/pull/804[Java] support decode utf8 for java string serialization by @chaokunyang in https://github.com/alipay/fury/pull/806Update Java Deserialization Blacklist by @s31k31 in https://github.com/alipay/fury/pull/782chore: apply license format by @tisonkun in https://github.com/alipay/fury/pull/783[Java] use soft reference to avoid duplicate codegen by @chaokunyang in https://github.com/alipay/fury/pull/809  Full Changelog: https://github.com/alipay/fury/commits/v0.1.0 ","version":null,"tagName":"h2"},{"title":"Fury v0.10.0 Released","type":0,"sectionRef":"#","url":"/blog/fury_0_10_0_release","content":"","keywords":"","version":null},{"title":"Highlight‚Äã","type":1,"pageTitle":"Fury v0.10.0 Released","url":"/blog/fury_0_10_0_release#highlight","content":" Chunk based map serializationHighly optimized JavaScript string serialization  ","version":null,"tagName":"h2"},{"title":"Features‚Äã","type":1,"pageTitle":"Fury v0.10.0 Released","url":"/blog/fury_0_10_0_release#features","content":" feat(java): ReplaceResolveSerializer deep copy by @zhaommmmomo in https://github.com/apache/fury/pull/1925feat(java): use varint for jdk compatible serializers by @chaokunyang in https://github.com/apache/fury/pull/1960feat(java): configurable buffer size limit by @theigl in https://github.com/apache/fury/pull/1963feat(java): make 4 bytes utf16 size header optional for utf8 encoding by @chaokunyang in https://github.com/apache/fury/pull/2010feat(ci): support building python on windows by @An-DJ in https://github.com/apache/fury/pull/1885feat(java): Chunk by chunk predictive map serialization protocol by @Hen1ng in https://github.com/apache/fury/pull/1722feat(java): support streaming encode/decode to/from buffer for row format by @chaokunyang in https://github.com/apache/fury/pull/2024feat(java): new implementation and protocol refine for chunk based map serialization by @chaokunyang in https://github.com/apache/fury/pull/2025feat(java): jit support for chunk based map serialization by @chaokunyang in https://github.com/apache/fury/pull/2027feat(java): Add basicMultiConfigFury dataprovider and add basic map unit test use the dataProvider by @Hen1ng in https://github.com/apache/fury/pull/2032feat(java): deserialize one pojo into another type by @orisgarno in https://github.com/apache/fury/pull/2012feat(python): chunk based map serialization for python by @chaokunyang in https://github.com/apache/fury/pull/2038feat(java): zstd meta compressor by @orisgarno in https://github.com/apache/fury/pull/2042feat(python): automatic release pyfury on macos and windows by @chaokunyang in https://github.com/apache/fury/pull/2045feat(javascript): optimize string serializer by @theweipeng in https://github.com/apache/fury/pull/2043feat(python): add macos pyfury ci by @chaokunyang in https://github.com/apache/fury/pull/2041  ","version":null,"tagName":"h2"},{"title":"Bug Fix‚Äã","type":1,"pageTitle":"Fury v0.10.0 Released","url":"/blog/fury_0_10_0_release#bug-fix","content":" fix(java): Move schema caching to unsafe trait to avoid issues when using non-inferred schema. by @wywen in https://github.com/apache/fury/pull/1944fix(java): ClassLoaderFuryPooled#setFactoryCallback cannot effect old Fury by @MrChang0 in https://github.com/apache/fury/pull/1946fix(java): fix find constructor error in generated serializer class caused by duplicated class classloading for Fury by @chaokunyang in https://github.com/apache/fury/pull/1948fix(c++): fix bazel install by @chaokunyang in https://github.com/apache/fury/pull/1979fix(java): Fix flakiness in ExpressionVisitorTest#testTraverseExpression by @AmitPr in https://github.com/apache/fury/pull/1968fix(java): Fix the issue caused by not using readCompressedBytesString during deserialization when string compression is enabled. by @Aliothmoon in https://github.com/apache/fury/pull/1991fix(java): Compatible mode on de/serialize api failed to deserialize by @orisgarno in https://github.com/apache/fury/pull/1996fix(java): chunk map serialize an error by @Hen1ng in https://github.com/apache/fury/pull/2030fix(python): Fix missing parameters and old API names by @pandalee99 in https://github.com/apache/fury/pull/2049fix(doc): set compressString default value to false by @chaokunyang in https://github.com/apache/fury/pull/1913fix(java): Remove duplicate maven dependency by @Hen1ng in https://github.com/apache/fury/pull/2044fix(java): fix duplicate entry write at max chunk size bound by @chaokunyang in https://github.com/apache/fury/pull/2040  ","version":null,"tagName":"h2"},{"title":"Other Improvements‚Äã","type":1,"pageTitle":"Fury v0.10.0 Released","url":"/blog/fury_0_10_0_release#other-improvements","content":" chore(ci): Migrate the ci from macOS 12 to macOS 13 by @penguin-wwy in https://github.com/apache/fury/pull/1927chore(Rust): fix lint problems by @theweipeng in https://github.com/apache/fury/pull/1962docs(java): add object mapping example and tests by @chaokunyang in https://github.com/apache/fury/pull/1974chore(python): drop py3.7 support by @chaokunyang in https://github.com/apache/fury/pull/1981fix(java): only print warn message if scopedMetaShareEnabled is true ‚Ä¶ by @zhfeng in https://github.com/apache/fury/pull/1985docs: update copyright date in NOTICE by @caicancai in https://github.com/apache/fury/pull/2029docs(java): update java serialization schema compatibility doc by @chaokunyang in https://github.com/apache/fury/pull/2047  ","version":null,"tagName":"h2"},{"title":"New Contributors‚Äã","type":1,"pageTitle":"Fury v0.10.0 Released","url":"/blog/fury_0_10_0_release#new-contributors","content":" @theigl made their first contribution in https://github.com/apache/fury/pull/1963@AmitPr made their first contribution in https://github.com/apache/fury/pull/1968@zhfeng made their first contribution in https://github.com/apache/fury/pull/1985@Hen1ng made their first contribution in https://github.com/apache/fury/pull/1722  Full Changelog: https://github.com/apache/fury/compare/v0.9.0...v0.10.0 ","version":null,"tagName":"h2"},{"title":"Introducing Apache Fory‚Ñ¢ C++: Blazing-Fast, Type-Safe Serialization for Modern C++","type":0,"sectionRef":"#","url":"/blog/fory_cpp_blazing_fast_serialization_framework","content":"","keywords":"","version":null},{"title":"The C++ Serialization Problem‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ C++: Blazing-Fast, Type-Safe Serialization for Modern C++","url":"/blog/fory_cpp_blazing_fast_serialization_framework#the-c-serialization-problem","content":" Every C++ developer working in a polyglot environment eventually hits the same wall. Existing options force a painful choice:  IDL-first frameworks (Protocol Buffers, FlatBuffers): Require upfront schema compilation, lose native C++ type expressiveness, and carry significant integration friction. Every type change means regenerating code across all languages in lock-step.Reflection-based frameworks (Boost.Serialization, cereal): Limited cross-language support, no circular reference handling, no polymorphism without boilerplate. They work well within a single language but break down at system boundaries.Hand-rolled binary formats: Fast but brittle ‚Äî any schema change risks silent corruption, and every new type requires manual encode/decode logic.  Apache Fory C++ eliminates this trade-off. It delivers performance competitive with the fastest C++ serialization libraries while providing first-class support for polymorphism, shared/circular references, schema evolution, and binary compatibility with Java, Python, Go, Rust, and JavaScript ‚Äî through a clean C++17 API.    ","version":null,"tagName":"h2"},{"title":"What Makes Apache Fory C++ Different?‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ C++: Blazing-Fast, Type-Safe Serialization for Modern C++","url":"/blog/fory_cpp_blazing_fast_serialization_framework#what-makes-apache-fory-c-different","content":" ","version":null,"tagName":"h2"},{"title":"Compile-Time Code Generation‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ C++: Blazing-Fast, Type-Safe Serialization for Modern C++","url":"/blog/fory_cpp_blazing_fast_serialization_framework#compile-time-code-generation","content":" Most serialization frameworks pay a runtime cost for flexibility ‚Äî inspecting type information through virtual dispatch or hash maps at every call. Apache Fory takes a different approach: the FORY_STRUCT macro uses C++ template metaprogramming to generate all serialization logic at compile time. The result is inlined, type-specific code with no virtual dispatch, no reflection, and no runtime overhead:  #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; struct Person { std::string name; int32_t age; std::vector&lt;std::string&gt; hobbies; std::map&lt;std::string, std::string&gt; metadata; std::optional&lt;std::string&gt; nickname; }; FORY_STRUCT(Person, name, age, hobbies, metadata, nickname);   That single macro generates compile-time field metadata, efficient serialization/deserialization code via ADL (Argument-Dependent Lookup), and type registration hooks. The macro can be placed inside the class body to access private fields, or at namespace scope for third-party types.  ","version":null,"tagName":"h3"},{"title":"Cross-Language Binary Protocol‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ C++: Blazing-Fast, Type-Safe Serialization for Modern C++","url":"/blog/fory_cpp_blazing_fast_serialization_framework#cross-language-binary-protocol","content":" Apache Fory C++ speaks the same binary wire format as Java, Python, Go, Rust, and JavaScript. Serialize a struct in C++, deserialize it in Python ‚Äî no adaptation layer, no schema translation, no version negotiation needed. This is especially powerful for microservice architectures where different teams own different services in different languages:  // C++: Serialize auto fory = Fory::builder().xlang(true).build(); fory.register_struct&lt;Person&gt;(100); auto bytes = fory.serialize(person).value();   # Python: Deserialize (same binary format, same type ID) fory = pyfory.Fory(xlang=True) fory.register(Person, type_id=100) # Same ID as C++ person = fory.deserialize(data)   The core requirements for cross-language interoperability are consistent type IDs/Names across participating runtimes, matching canonical field names, and compatible field types for those names.  ","version":null,"tagName":"h3"},{"title":"Polymorphism via Smart Pointers‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ C++: Blazing-Fast, Type-Safe Serialization for Modern C++","url":"/blog/fory_cpp_blazing_fast_serialization_framework#polymorphism-via-smart-pointers","content":" Serializing polymorphic objects is notoriously difficult in C++. Most frameworks require manual type tagging or generate large amounts of boilerplate. Apache Fory handles it automatically: it detects polymorphic types via std::is_polymorphic&lt;T&gt; and preserves the full runtime type identity through std::shared_ptr and std::unique_ptr. When you deserialize a shared_ptr&lt;Animal&gt; that holds a Dog, you get a Dog back ‚Äî no extra code required:  struct Animal { virtual ~Animal() = default; int32_t age = 0; }; FORY_STRUCT(Animal, age); struct Dog : Animal { std::string breed; }; FORY_STRUCT(Dog, FORY_BASE(Animal), breed); struct Cat : Animal { std::string color; }; FORY_STRUCT(Cat, FORY_BASE(Animal), color); struct Shelter { std::vector&lt;std::shared_ptr&lt;Animal&gt;&gt; animals; }; FORY_STRUCT(Shelter, animals); auto fory = Fory::builder().track_ref(true).build(); fory.register_struct&lt;Shelter&gt;(10); fory.register_struct&lt;Dog&gt;(11); fory.register_struct&lt;Cat&gt;(12); Shelter s; s.animals.push_back(std::make_shared&lt;Dog&gt;()); // Dog at runtime s.animals.push_back(std::make_shared&lt;Cat&gt;()); // Cat at runtime auto decoded = fory.deserialize&lt;Shelter&gt;(fory.serialize(s).value()).value(); assert(dynamic_cast&lt;Dog*&gt;(decoded.animals[0].get()) != nullptr); // Runtime type preserved!   Fory also supports std::unique_ptr for exclusive-ownership polymorphic fields, and collections of smart pointers (std::vector&lt;std::shared_ptr&lt;Base&gt;&gt;, std::map&lt;K, std::unique_ptr&lt;Base&gt;&gt;).  ","version":null,"tagName":"h3"},{"title":"Shared/Circular Reference Tracking‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ C++: Blazing-Fast, Type-Safe Serialization for Modern C++","url":"/blog/fory_cpp_blazing_fast_serialization_framework#sharedcircular-reference-tracking","content":" Many real-world data models contain shared objects or cycles: a parent node pointing to its children, which point back to the parent; an order referencing a customer who appears in multiple orders. Standard serialization frameworks either duplicate the data (wasting space) or crash with a stack overflow when they encounter a cycle.  With track_ref(true), Fory tracks object identity across the entire graph. Shared objects are serialized exactly once; every subsequent reference is encoded as a back-reference. Cycles terminate naturally:  struct Node { virtual ~Node() = default; int32_t id = 0; std::vector&lt;std::shared_ptr&lt;Node&gt;&gt; neighbors; }; FORY_STRUCT(Node, id, neighbors); auto fory = Fory::builder().track_ref(true).build(); fory.register_struct&lt;Node&gt;(200); auto node1 = std::make_shared&lt;Node&gt;(); node1-&gt;id = 1; auto node2 = std::make_shared&lt;Node&gt;(); node2-&gt;id = 2; node1-&gt;neighbors.push_back(node2); node2-&gt;neighbors.push_back(node1); // Cycle ‚Äî handled correctly! auto bytes = fory.serialize(node1).value(); // No stack overflow, no duplicate data ‚Äî the cycle is preserved faithfully auto decoded = fory.deserialize&lt;std::shared_ptr&lt;Node&gt;&gt;(bytes).value();   This makes Fory a natural fit for graph databases, entity-component systems, and any domain model with bidirectional relationships.  ","version":null,"tagName":"h3"},{"title":"Schema Evolution‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ C++: Blazing-Fast, Type-Safe Serialization for Modern C++","url":"/blog/fory_cpp_blazing_fast_serialization_framework#schema-evolution","content":" In a microservice deployment, services update independently. A new version of the user service may add a phone field while old consumers are still running. Without schema evolution support, this forces a coordinated, big-bang deployment. Apache Fory's compatible mode removes this constraint entirely:  // Version 1 struct UserV1 { std::string name; int32_t age; }; FORY_STRUCT(UserV1, name, age); // Version 2 ‚Äî new fields added independently struct UserV2 { std::string name; int32_t age; std::string email; }; FORY_STRUCT(UserV2, name, age, email); auto fory_v1 = Fory::builder().compatible(true).xlang(true).build(); auto fory_v2 = Fory::builder().compatible(true).xlang(true).build(); fory_v1.register_struct&lt;UserV1&gt;(100); fory_v2.register_struct&lt;UserV2&gt;(100); // Same type ID enables evolution auto bytes = fory_v1.serialize(UserV1{&quot;Alice&quot;, 30}).value(); auto v2 = fory_v2.deserialize&lt;UserV2&gt;(bytes).value(); assert(v2.name == &quot;Alice&quot; &amp;&amp; v2.email == &quot;&quot;); // Default for missing field   In compatible mode, fields are matched by name rather than position. New fields receive C++ default values when missing; removed fields are safely skipped. This enables rolling upgrades and independent service deployments without any serialization errors.  ","version":null,"tagName":"h3"},{"title":"Row Format: Zero-Copy Analytics‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ C++: Blazing-Fast, Type-Safe Serialization for Modern C++","url":"/blog/fory_cpp_blazing_fast_serialization_framework#row-format-zero-copy-analytics","content":" Beyond object graph serialization, Apache Fory C++ implements a row-based binary format designed for analytics workloads. The row format stores data in a contiguous memory layout with a null bitmap, fixed-size slots for primitives, and a variable-length section for strings and nested objects. This enables O(1) random field access by index ‚Äî you can read a single field from a large struct without touching the rest of the data.  This is particularly valuable in data pipelines and OLAP workloads where only a small subset of fields are queried per record:  #include &quot;fory/encoder/row_encoder.h&quot; using namespace fory::row::encoder; struct SensorReading { int32_t sensor_id; double temperature; std::string location; FORY_STRUCT(SensorReading, sensor_id, temperature, location); }; RowEncoder&lt;SensorReading&gt; encoder; encoder.encode({42, 23.5, &quot;rack-B&quot;}); auto row = encoder.get_writer().to_row(); // Read any field in O(1) ‚Äî no deserialization of unused fields int32_t id = row-&gt;get_int32(0); double temp = row-&gt;get_double(1); auto loc = row-&gt;get_string(2);   For zero-copy access into an existing buffer (e.g., from a memory-mapped file or network receive buffer), Fory can point a Row directly at the memory without copying:  auto src = encoder.get_writer().to_row(); fory::row::Row view(src-&gt;schema()); view.point_to(src-&gt;buffer(), src-&gt;base_offset(), src-&gt;size_bytes()); // Zero-copy view int32_t id = view.get_int32(0); // Reads directly from the original buffer   Use the row format for analytics, OLAP-style workloads, and partial field access. Use object graph serialization for full object round-trips with references and polymorphism.    ","version":null,"tagName":"h3"},{"title":"Installation‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ C++: Blazing-Fast, Type-Safe Serialization for Modern C++","url":"/blog/fory_cpp_blazing_fast_serialization_framework#installation","content":" Fory C++ requires a C++17-compatible compiler (GCC 7+, Clang 5+, MSVC 2017+) and supports both CMake and Bazel build systems.  ","version":null,"tagName":"h2"},{"title":"CMake (FetchContent)‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ C++: Blazing-Fast, Type-Safe Serialization for Modern C++","url":"/blog/fory_cpp_blazing_fast_serialization_framework#cmake-fetchcontent","content":" The simplest integration is via CMake's FetchContent module, which fetches and builds Fory as part of your project:  cmake_minimum_required(VERSION 3.16) project(my_project LANGUAGES CXX) set(CMAKE_CXX_STANDARD 17) include(FetchContent) FetchContent_Declare(fory GIT_REPOSITORY https://github.com/apache/fory.git GIT_TAG v0.15.0 SOURCE_SUBDIR cpp) FetchContent_MakeAvailable(fory) add_executable(my_app main.cc) target_link_libraries(my_app PRIVATE fory::serialization)   ","version":null,"tagName":"h3"},{"title":"Bazel‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ C++: Blazing-Fast, Type-Safe Serialization for Modern C++","url":"/blog/fory_cpp_blazing_fast_serialization_framework#bazel","content":" For Bazel-based projects, add Fory as a module dependency:  bazel_dep(name = &quot;fory&quot;, version = &quot;0.15.0&quot;) git_override(module_name = &quot;fory&quot;, remote = &quot;https://github.com/apache/fory.git&quot;, commit = &quot;v0.15.0&quot;)   cc_binary(name = &quot;my_app&quot;, srcs = [&quot;main.cc&quot;], deps = [&quot;@fory//cpp/fory/serialization:fory_serialization&quot;])     ","version":null,"tagName":"h3"},{"title":"Native Serialization‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ C++: Blazing-Fast, Type-Safe Serialization for Modern C++","url":"/blog/fory_cpp_blazing_fast_serialization_framework#native-serialization","content":" For pure C++ applications without cross-language requirements, disabling xlang produces a more compact binary encoding because no cross-language type metadata is emitted. This is the fastest possible path:  auto fory = Fory::builder() .xlang(false) // Native C++ mode ‚Äî tighter encoding .track_ref(false) // Disable if no shared/circular refs .build(); fory.register_struct&lt;Address&gt;(1); fory.register_struct&lt;Person&gt;(2); // Serialize auto result = fory.serialize(person); if (!result.ok()) { std::cerr &lt;&lt; result.error().to_string(); return 1; } std::vector&lt;uint8_t&gt; bytes = std::move(result).value(); // Deserialize auto decoded = fory.deserialize&lt;Person&gt;(bytes); assert(decoded.ok() &amp;&amp; person == decoded.value());   FORY_STRUCT handles several important C++ patterns that commonly arise in production codebases:  // Private fields ‚Äî place macro in public: section class Secure { int32_t secret_; std::string token_; public: FORY_STRUCT(Secure, secret_, token_); }; // Inheritance ‚Äî FORY_BASE includes base class fields struct Derived : Base { std::string extra; FORY_STRUCT(Derived, FORY_BASE(Base), extra); }; // External/third-party types ‚Äî use at namespace scope (public fields only) namespace ext { struct Coord { double lat, lon; }; } FORY_STRUCT(ext::Coord, lat, lon);   ","version":null,"tagName":"h2"},{"title":"Error Handling‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ C++: Blazing-Fast, Type-Safe Serialization for Modern C++","url":"/blog/fory_cpp_blazing_fast_serialization_framework#error-handling","content":" All Fory operations return Result&lt;T, Error&gt;, making error handling explicit and composable. The FORY_TRY macro provides a concise early-return pattern for functions that propagate errors:  // Option 1: Conditional check auto r = fory.serialize(obj); if (r.ok()) { auto bytes = std::move(r).value(); } else { std::cerr &lt;&lt; r.error().to_string(); } // Option 2: FORY_TRY macro for early return FORY_TRY(bytes, fory.serialize(obj)); // Use bytes directly ‚Äî any error propagates automatically   ","version":null,"tagName":"h3"},{"title":"Thread Safety‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ C++: Blazing-Fast, Type-Safe Serialization for Modern C++","url":"/blog/fory_cpp_blazing_fast_serialization_framework#thread-safety","content":" Fory provides two variants with different threading guarantees. Choose based on whether your serialization is centralized (shared instance) or distributed across threads:  // Single-threaded (fastest) ‚Äî one instance per thread, no synchronization overhead auto fory = Fory::builder().build(); // Thread-safe ‚Äî shared across threads via an internal instance pool auto fory = Fory::builder().build_thread_safe(); fory.register_struct&lt;MyType&gt;(1); // Register all types before sharing std::thread t([&amp;]() { fory.serialize(obj); }); // Safe to call concurrently     ","version":null,"tagName":"h3"},{"title":"Cross-Language Serialization‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ C++: Blazing-Fast, Type-Safe Serialization for Modern C++","url":"/blog/fory_cpp_blazing_fast_serialization_framework#cross-language-serialization","content":" ","version":null,"tagName":"h2"},{"title":"Without IDL‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ C++: Blazing-Fast, Type-Safe Serialization for Modern C++","url":"/blog/fory_cpp_blazing_fast_serialization_framework#without-idl","content":" When you control both sides of the wire and can coordinate type definitions manually, the simplest approach is to register types with matching numeric IDs in each language. This requires no additional tooling and works well for small, stable schemas:  // C++ auto fory = Fory::builder().xlang(true).build(); fory.register_struct&lt;Order&gt;(201); auto bytes = fory.serialize(order).value();   // Java ‚Äî same binary format, same type ID Fory fory = Fory.builder().withLanguage(Language.XLANG).build(); fory.register(Order.class, 201); Order order = (Order) fory.deserialize(bytes);   # Python ‚Äî same binary format, same type ID fory = pyfory.Fory(xlang=True) fory.register(Order, type_id=201) order = fory.deserialize(data)   Field matching: In cross-language mode, field names are normalized to snake_case and matched by that canonical name. Ordering follows Fory's xlang field-order rules (not simple alphabetical ordering), so keep names semantically consistent across languages.  ","version":null,"tagName":"h3"},{"title":"With the Fory Schema IDL Compiler‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ C++: Blazing-Fast, Type-Safe Serialization for Modern C++","url":"/blog/fory_cpp_blazing_fast_serialization_framework#with-the-fory-schema-idl-compiler","content":" As schemas grow and span more services and teams, manually maintaining consistent field names, type IDs, and type definitions across five languages becomes error-prone. The Fory Schema IDL Compiler (foryc) solves this by letting you define types once in a .fdl file and generating idiomatic, production-ready code for every target language. The generated code includes typed accessors, serialization macros, registration helpers, and to_bytes()/from_bytes() helpers ‚Äî so you never write serialization plumbing by hand.  1. Install the compiler‚Äã  pip install fory-compiler foryc --help   2. Write a schema (ecommerce.fdl)‚Äã  Fory IDL syntax is concise and deliberately close to protobuf, so it is easy to pick up. Field modifiers like optional, ref, and list map directly to idiomatic C++ types:  package ecommerce; enum OrderStatus { PENDING = 0; CONFIRMED = 1; SHIPPED = 2; DELIVERED = 3; } message Address { string street = 1; string city = 2; string country = 3; } message Customer { string id = 1; string name = 2; optional string email = 3; // Nullable: maps to std::optional&lt;std::string&gt; optional Address address = 4; } message OrderItem { string sku = 1; int32 quantity = 2; float64 unit_price = 3; } // Discount can be either a fixed amount or a percentage ‚Äî modelled as a union message FixedDiscount { float64 amount = 1; } message PercentDiscount { float64 percentage = 1; } // union maps to std::variant&lt;FixedDiscount, PercentDiscount&gt; in C++ union Discount { FixedDiscount fixed = 1; PercentDiscount percent = 2; } message Order { string order_id = 1; ref Customer customer = 2; // ref: std::shared_ptr + reference tracking list&lt;OrderItem&gt; items = 3; // list: std::vector&lt;OrderItem&gt; OrderStatus status = 4; float64 total = 5; optional string notes = 6; timestamp created_at = 7; optional Discount discount = 8; // optional union field }   The IDL type system maps cleanly to native C++ constructs. union is a first-class IDL construct that generates a std::variant-based wrapper class in C++, with typed case accessors (is_fixed(), as_fixed(), etc.) and a visit() method. Here is the full set of field modifiers and their C++ equivalents:  Modifier\tC++ type\tPurposeoptional T\tstd::optional&lt;T&gt;\tNullable field ref T\tstd::shared_ptr&lt;T&gt;\tShared / circular reference ref(weak=true) T\tfory::serialization::SharedWeak&lt;T&gt;\tWeak reference (breaks cycles) list&lt;T&gt;\tstd::vector&lt;T&gt;\tOrdered list map&lt;K,V&gt;\tstd::map&lt;K,V&gt;\tKey-value map  3. Generate code‚Äã  foryc generates a single header file per schema for C++, and equivalent files for every other target language. All generated files use the same type IDs derived from the package and type names, guaranteeing binary compatibility without any manual coordination:  # Generate C++ header directly under ./generated foryc ecommerce.fdl --cpp_out ./generated # Generate multiple languages with explicit output directories foryc ecommerce.fdl --cpp_out ./generated --java_out ./java/src/main/java --python_out ./python/gen --go_out ./go/gen --rust_out ./rust/gen   The output structure for C++ is one header per schema file under the directory passed to --cpp_out. For example, --cpp_out ./generated produces generated/ecommerce.h. The header contains all types under the ecommerce:: namespace, with FORY_STRUCT macros and a register_types() helper already wired up.  4. Use the generated C++ code‚Äã  The generated header provides final classes with typed accessors and to_bytes()/from_bytes() helpers. There is no manual Fory instance setup required ‚Äî the helpers manage it internally:  #include &quot;generated/ecommerce.h&quot; ecommerce::Order order; order.set_order_id(&quot;ORD-2025-001&quot;); order.mutable_customer()-&gt;set_name(&quot;Alice&quot;); order.set_status(ecommerce::OrderStatus::CONFIRMED); order.set_total(159.98); // to_bytes()/from_bytes() are generated ‚Äî no Fory boilerplate needed auto bytes = order.to_bytes().value(); auto restored = ecommerce::Order::from_bytes(bytes).value(); assert(restored.order_id() == &quot;ORD-2025-001&quot;);   Because the generated Java, Python, and Go code uses the same type IDs, bytes serialized by the C++ to_bytes() helper can be deserialized by the Java fromBytes() or Python from_bytes() helpers out of the box ‚Äî no extra configuration required.    ","version":null,"tagName":"h3"},{"title":"Supported Types‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ C++: Blazing-Fast, Type-Safe Serialization for Modern C++","url":"/blog/fory_cpp_blazing_fast_serialization_framework#supported-types","content":" Apache Fory C++ supports a comprehensive set of types covering all common C++ data structures and cross-language primitives:  Category\tC++ TypesPrimitives\tbool, int8_t‚Ä¶int64_t, uint8_t‚Ä¶uint64_t, float, double Strings\tstd::string, std::string_view, std::u16string Collections\tstd::vector&lt;T&gt;, std::set&lt;T&gt;, std::unordered_set&lt;T&gt;, std::map&lt;K,V&gt;, std::unordered_map&lt;K,V&gt; Optional/Union\tstd::optional&lt;T&gt;, std::variant&lt;Ts...&gt; Smart Pointers\tstd::shared_ptr&lt;T&gt; (ref tracking + polymorphism), std::unique_ptr&lt;T&gt;, fory::serialization::SharedWeak&lt;T&gt; Temporal\tstd::chrono::nanoseconds, fory::serialization::Timestamp, fory::serialization::Date Enums\tScoped/unscoped enums; use FORY_ENUM for non-continuous values User structs\tAny type annotated with FORY_STRUCT  All collection element and map value types can be arbitrarily nested, including structs, smart pointers, and std::optional.    ","version":null,"tagName":"h2"},{"title":"Configuration Reference‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ C++: Blazing-Fast, Type-Safe Serialization for Modern C++","url":"/blog/fory_cpp_blazing_fast_serialization_framework#configuration-reference","content":" Fory instances are constructed through a fluent builder API. All options have sensible defaults, so most applications only need to set one or two:  auto fory = Fory::builder() .xlang(true) // Cross-language binary protocol (default: true) .compatible(true) // Schema evolution / compatible mode (default: false) .track_ref(true) // Shared/circular reference tracking (default: true) .max_dyn_depth(10) // Max polymorphic nesting depth (default: 5) .check_struct_version(true) // Validate struct hash on deserialization (default: false) .build(); // Single-threaded; use build_thread_safe() for multi-thread   Tuning guide: Disable compatible for maximum throughput when schema changes are coordinated (same binary deployed together). Disable track_ref for pure value types with no sharing or cycles ‚Äî it eliminates per-object reference bookkeeping. Use xlang(false) for C++-only deployments to get a more compact binary encoding.    ","version":null,"tagName":"h2"},{"title":"Benchmarks‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ C++: Blazing-Fast, Type-Safe Serialization for Modern C++","url":"/blog/fory_cpp_blazing_fast_serialization_framework#benchmarks","content":" Apache Fory delivers exceptional performance across diverse data shapes. The combination of compile-time code generation, variable-length integer encoding, and a carefully designed binary protocol yields major gains versus text formats and strong results versus Protocol Buffers. In the current C++ benchmark report, Fory throughput vs Protobuf ranges from about 1.1x to 12.2x depending on workload and operation:    The C++ implementation achieves similar relative speedups to the Java implementation. Because both share the same binary protocol design, and C++ serialization code is generated at compile time (eliminating the JIT warm-up cost), C++ performance is competitive or superior for latency-sensitive workloads.  Serialized Data Sizes (bytes)  Datatype\tFory\tProtobufStruct\t58\t61 Sample\t446\t375 MediaContent\t365\t301 StructList\t184\t315 SampleList\t1980\t1890 MediaContentList\t1535\t1520    ","version":null,"tagName":"h2"},{"title":"Conclusion‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ C++: Blazing-Fast, Type-Safe Serialization for Modern C++","url":"/blog/fory_cpp_blazing_fast_serialization_framework#conclusion","content":" Apache Fory C++ brings together a set of capabilities that no other C++ serialization library delivers as a cohesive package:  Performance: Template-based compile-time codegen eliminates all runtime reflection overhead; a highly efficient binary protocol minimizes both serialized size and CPU cyclesCross-language: The same binary format works natively with Java, Python, Go, Rust, and JavaScriptNative C++ idioms: std::shared_ptr, std::optional, std::variant, fory::serialization::SharedWeak ‚Äî all handled naturallyProduction-ready features: Polymorphism, circular references, schema evolution, thread safety out of the boxSchema-first option: The Fory IDL Compiler generates consistent, idiomatic code across all languages from a single .fdl definition ‚Äî no more manually synchronizing type IDs across codebases  Whether you are building a high-performance game server, a polyglot microservice backend, a real-time analytics pipeline, or an embedded system serializing complex domain models, Apache Fory C++ has you covered.  Get started:  git clone https://github.com/apache/fory.git cd fory/examples/cpp/hello_world cmake -B build -DCMAKE_BUILD_TYPE=Release &amp;&amp; cmake --build build ./build/hello_world   Documentation:  C++ Serialization Guide: fory.apache.org/docs/guide/cppFory Schema IDL Compiler: fory.apache.org/docs/compilerXlang Serialization Spec: fory.apache.org/docs/specification  Community:  GitHub: apache/forySlack: Join our communityLicense: Apache License 2.0 ","version":null,"tagName":"h2"},{"title":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","type":0,"sectionRef":"#","url":"/blog/fory_rust_versatile_serialization_framework","content":"","keywords":"","version":null},{"title":"The Serialization Dilemma‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#the-serialization-dilemma","content":" Every backend engineer has faced this moment: your application needs to serialize complex data structures such as nested objects, circular references, polymorphic types, and you're forced to choose between three bad options:  Fast but fragile: Hand-rolled binary formats that break with schema changesFlexible but slow: JSON/Protocol with 10x performance overheadComplex and limiting: Existing solutions that don't support your language's advanced features  Apache Fory Rust eliminates this false choice. It's a serialization framework that delivers exceptional performance while automatically handling the complexities of modern applications‚Äîno IDL files, no manual schema management, no compromises.  ","version":null,"tagName":"h2"},{"title":"What Makes Apache Fory Rust Different?‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#what-makes-apache-fory-rust-different","content":" ","version":null,"tagName":"h2"},{"title":"1. Truly Cross-Language‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#1-truly-cross-language","content":" Apache Fory Rust speaks the same binary protocol as Java, Python, C++, Go, and other language implementations. Serialize data in Rust, deserialize in Python ‚Äî it just works. No schema files. No code generation. No version mismatches.  // Rust: Serialize let user = User { name: &quot;Alice&quot;.to_string(), age: 30, metadata: HashMap::from([(&quot;role&quot;, &quot;admin&quot;)]), }; let bytes = fory.serialize(&amp;user); // Python: Deserialize (same binary format!) user = fory.deserialize(bytes) # Just works!   This isn't just convenient ‚Äî it changes how we develop microservices architectures where different teams use different languages.  ","version":null,"tagName":"h3"},{"title":"2. Automatic Shared/Circular Reference Handling‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#2-automatic-sharedcircular-reference-handling","content":" Most serialization frameworks panic when encountering circular references. Apache Fory tracks and preserves reference identity automatically:  Shared Reference:  use fory::Fory; use std::rc::Rc; let fory = Fory::default(); // Create a shared value let shared = Rc::new(String::from(&quot;shared_value&quot;)); // Reference it multiple times let data = vec![shared.clone(), shared.clone(), shared.clone()]; // The shared value is serialized only once let bytes = fory.serialize(&amp;data); let decoded: Vec&lt;Rc&lt;String&gt;&gt; = fory.deserialize(&amp;bytes)?; // Verify reference identity is preserved assert_eq!(decoded.len(), 3); assert_eq!(*decoded[0], &quot;shared_value&quot;); // All three Rc pointers point to the same object assert!(Rc::ptr_eq(&amp;decoded[0], &amp;decoded[1])); assert!(Rc::ptr_eq(&amp;decoded[1], &amp;decoded[2]));   Circular Reference:  use fory::{ForyObject, RcWeak}; #[derive(ForyObject)] struct Node { value: i32, parent: RcWeak&lt;RefCell&lt;Node&gt;&gt;, // Weak pointer breaks cycles children: Vec&lt;Rc&lt;RefCell&lt;Node&gt;&gt;&gt;, // Strong references tracked } // Build a parent-child tree with circular references let parent = Rc::new(RefCell::new(Node { ... })); let child = Rc::new(RefCell::new(Node { parent: RcWeak::from(&amp;parent), // Points back to parent ... })); parent.borrow_mut().children.push(child.clone()); // Serialization handles the cycle automatically let bytes = fory.serialize(&amp;parent); let decoded: Rc&lt;RefCell&lt;Node&gt;&gt; = fory.deserialize(&amp;bytes)?; // Reference relationships preserved! assert!(Rc::ptr_eq(&amp;decoded, &amp;decoded.borrow().children[0].borrow().parent.upgrade().unwrap()));   This isn't just a feature‚Äîit's essential for graph databases, object-relational mappers, and domain models.  ","version":null,"tagName":"h3"},{"title":"3. Trait Object Serialization‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#3-trait-object-serialization","content":" Rust's trait system enables powerful abstractions, but serializing Box&lt;dyn Trait&gt; is notoriously difficult. Apache Fory makes it trivial:  use fory::{ForyObject, Serializer, register_trait_type}; trait Animal: Serializer { fn speak(&amp;self) -&gt; String; } #[derive(ForyObject)] struct Dog { name: String, breed: String } #[derive(ForyObject)] struct Cat { name: String, color: String } // Register implementations register_trait_type!(Animal, Dog, Cat); // Serialize heterogeneous collections let animals: Vec&lt;Box&lt;dyn Animal&gt;&gt; = vec![ Box::new(Dog { ... }), Box::new(Cat { ... }), ]; let bytes = fory.serialize(&amp;animals); let decoded: Vec&lt;Box&lt;dyn Animal&gt;&gt; = fory.deserialize(&amp;bytes)?; // Polymorphism preserved! decoded[0].speak(); // &quot;Woof!&quot; decoded[1].speak(); // &quot;Meow!&quot;   Alternative: Using dyn Any without trait registration:  use std::rc::Rc; use std::any::Any; // No trait definition or registration needed let dog: Rc&lt;dyn Any&gt; = Rc::new(Dog { name: &quot;Rex&quot;.to_string(), breed: &quot;Labrador&quot;.to_string() }); let cat: Rc&lt;dyn Any&gt; = Rc::new(Cat { name: &quot;Whiskers&quot;.to_string(), color: &quot;Orange&quot;.to_string() }); let bytes = fory.serialize(&amp;dog); let decoded: Rc&lt;dyn Any&gt; = fory.deserialize(&amp;bytes)?; // Downcast to concrete type let unwrapped = decoded.downcast_ref::&lt;Dog&gt;().unwrap(); assert_eq!(unwrapped.name, &quot;Rex&quot;);   Supports:  Box&lt;dyn Trait&gt; - Owned trait objectsRc&lt;dyn Trait&gt; / Arc&lt;dyn Trait&gt; - Reference-counted trait objectsRc&lt;dyn Any&gt; / Arc&lt;dyn Any&gt; - Runtime type dispatch without traitsAuto-generated wrapper types for standalone serialization  This unlocks plugin systems, heterogeneous collections, and extensible architectures that were previously impossible to serialize.  ","version":null,"tagName":"h3"},{"title":"4. Schema Evolution Without Breaking Changes‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#4-schema-evolution-without-breaking-changes","content":" Microservices evolve independently. Apache Fory's Compatible mode allows schema changes without coordination:  use fory::{Fory, ForyObject}; // Service A: Version 1 #[derive(ForyObject)] struct User { name: String, age: i32, address: String, } let mut fory_v1 = Fory::default().compatible(true); fory_v1.register::&lt;User&gt;(1); // Service B: Version 2 (evolved independently) #[derive(ForyObject)] struct User { name: String, age: i32, // address removed phone: Option&lt;String&gt;, // New field metadata: HashMap&lt;String, String&gt;, // Another new field } let mut fory_v2 = Fory::default().compatible(true); fory_v2.register::&lt;User&gt;(1); // V1 data deserializes into V2 structure let v1_bytes = fory_v1.serialize(&amp;user_v1); let user_v2: User = fory_v2.deserialize(&amp;v1_bytes)?; // Missing fields get default values automatically   Compatibility rules:  ‚úÖ Add new fields (default values applied)‚úÖ Remove fields (skipped during deserialization)‚úÖ Reorder fields (matched by name)‚úÖ Change nullability (T ‚Üî Option&lt;T&gt;)‚ùå Type changes (except nullable variants)  This is critical for zero-downtime deployments and polyglot microservices.  ","version":null,"tagName":"h3"},{"title":"The Technical Foundation‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#the-technical-foundation","content":" ","version":null,"tagName":"h2"},{"title":"Protocol Design‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#protocol-design","content":" Apache Fory uses a sophisticated binary protocol designed for both performance and flexibility:  | fory header | reference meta | type meta | value data |   Key innovations:  Efficient encoding: Variable-length integers, compact type IDs, bit-packed flagsReference tracking: Deduplicates shared objects automatically (serialize once, reference thereafter)Meta compression: Gzip compression for type metadata in meta-sharing modeLittle-endian layout: Optimized for modern CPU architectures  ","version":null,"tagName":"h3"},{"title":"Compile-Time Code Generation‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#compile-time-code-generation","content":" Unlike reflection-based frameworks, Apache Fory generates serialization code at compile time via procedural macros:  use fory::ForyObject; #[derive(ForyObject)] struct Person { name: String, age: i32, address: Address, } // Macro generates: // - fory_write_data() for serialization // - fory_read_data() for deserialization // - fory_reserved_space() for buffer pre-allocation // - fory_get_type_id() for type registration   Benefits:  ‚ö° Zero runtime overhead: No reflection, no vtable lookupsüõ°Ô∏è Type safety: Compile-time errors instead of runtime panicsüì¶ Small binary size: Only code for types you actually useüîç IDE support: Full autocomplete and error checking  ","version":null,"tagName":"h3"},{"title":"Architecture‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#architecture","content":" Apache Fory Rust consists of three focused crates:  fory/ # High-level API ‚îî‚îÄ Convenience wrappers, derive re-exports fory-core/ # Core serialization engine ‚îú‚îÄ fory.rs # Main entry point ‚îú‚îÄ buffer.rs # Zero-copy binary I/O ‚îú‚îÄ serializer/ # Type-specific serializers ‚îú‚îÄ resolver/ # Type registration &amp; dispatch ‚îú‚îÄ meta/ # Meta string compression ‚îî‚îÄ row/ # Row format implementation fory-derive/ # Procedural macros ‚îú‚îÄ object/ # ForyObject derive macro ‚îî‚îÄ fory_row.rs # ForyRow derive macro   This modular design ensures clean separation of concerns and makes the codebase maintainable.  ","version":null,"tagName":"h3"},{"title":"Benchmarks: Real-World Performance‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#benchmarks-real-world-performance","content":"     Datatype\tSize\tOperation\tFory TPS\tJSON TPS\tProtobuf TPS\tFastestcompany\tsmall\tserialize\t10,063,906\t761,673\t896,620\tfory company\tmedium\tserialize\t412,507\t33,835\t37,590\tfory company\tlarge\tserialize\t9,183\t793\t880\tfory ecommerce_data\tsmall\tserialize\t2,350,729\t206,262\t256,970\tfory ecommerce_data\tmedium\tserialize\t59,977\t4,699\t5,242\tfory ecommerce_data\tlarge\tserialize\t3,727\t266\t295\tfory person\tsmall\tserialize\t13,632,522\t1,345,189\t1,475,035\tfory person\tmedium\tserialize\t3,839,656\t337,610\t369,031\tfory person\tlarge\tserialize\t907,853\t79,631\t91,408\tfory simple_list\tsmall\tserialize\t27,726,945\t4,874,957\t4,643,172\tfory simple_list\tmedium\tserialize\t4,770,765\t401,558\t397,551\tfory simple_list\tlarge\tserialize\t606,061\t41,061\t44,565\tfory simple_map\tsmall\tserialize\t22,862,369\t3,888,025\t2,695,999\tfory simple_map\tmedium\tserialize\t2,128,973\t204,319\t193,132\tfory simple_map\tlarge\tserialize\t177,847\t18,419\t18,668\tfory simple_struct\tsmall\tserialize\t35,729,598\t10,167,045\t8,633,342\tfory simple_struct\tmedium\tserialize\t34,988,279\t9,737,098\t6,433,350\tfory simple_struct\tlarge\tserialize\t31,801,558\t4,545,041\t7,420,049\tfory system_data\tsmall\tserialize\t5,382,131\t468,033\t569,930\tfory system_data\tmedium\tserialize\t174,240\t11,896\t14,753\tfory system_data\tlarge\tserialize\t10,671\t876\t1,040\tfory  ","version":null,"tagName":"h2"},{"title":"When to Use Apache Fory Rust‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#when-to-use-apache-fory-rust","content":" ","version":null,"tagName":"h2"},{"title":"‚úÖ Ideal Use Cases‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#-ideal-use-cases","content":" Microservices with polyglot teams Different services in different languagesNeed seamless data exchange without schema filesSchema evolution across independent deployments High-performance data pipelines Processing millions of records per secondMemory-constrained environments (use row format)Analytics workloads with selective field access Complex domain models Circular references (parent-child relationships, graphs)Polymorphic types (trait objects, inheritance hierarchies)Rich object graphs with shared references Real-time systems Low-latency requirements (&lt;1ms serialization)Memory-mapped file accessZero-copy deserialization critical  ","version":null,"tagName":"h3"},{"title":"‚ö†Ô∏è Consider Alternatives If‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#Ô∏è-consider-alternatives-if","content":" You need human-readable data: Use JSON/YAML for debuggingYou need long-term storage format: Use Parquet for data lakesYour data is trivial: serde + bincode is simpler for basic types  ","version":null,"tagName":"h3"},{"title":"Getting Started in 5 Minutes‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#getting-started-in-5-minutes","content":" ","version":null,"tagName":"h2"},{"title":"Installation‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#installation","content":" Add to Cargo.toml:  [dependencies] fory = &quot;0.13&quot;   ","version":null,"tagName":"h3"},{"title":"Basic Object Serialization‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#basic-object-serialization","content":" use fory::{Fory, Error, ForyObject}; #[derive(ForyObject, Debug, PartialEq)] struct User { name: String, age: i32, email: String, } fn main() -&gt; Result&lt;(), Error&gt; { let mut fory = Fory::default(); fory.register::&lt;User&gt;(1); // Register with unique ID let user = User { name: &quot;Alice&quot;.to_string(), age: 30, email: &quot;alice@example.com&quot;.to_string(), }; // Serialize let bytes = fory.serialize(&amp;user); // Deserialize let decoded: User = fory.deserialize(&amp;bytes)?; assert_eq!(user, decoded); Ok(()) }   ","version":null,"tagName":"h3"},{"title":"Cross-Language Serialization‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#cross-language-serialization","content":" use fory::Fory; // Enable cross-language mode let mut fory = Fory::default().compatible(true).xlang(true); // Register with id/namespace for cross-language compatibility fory.register_by_namespace::&lt;User&gt;(1); // fory.register_by_namespace::&lt;User&gt;(&quot;example&quot;, &quot;User&quot;); let bytes = fory.serialize(&amp;user); // This can now be deserialized in Java, Python, Go, etc.   Register types with consistent IDs or names across all languages:  By ID (fory.register::&lt;User&gt;(1)): Faster serialization, more compact encoding, but requires coordination to avoid ID conflictsBy name (fory.register_by_name::&lt;User&gt;(&quot;example.User&quot;)): More flexible, less prone to conflicts, easier to manage across teams, but slightly larger encoding  ","version":null,"tagName":"h3"},{"title":"Supported Types‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#supported-types","content":" Apache Fory Rust supports a comprehensive type system:  Primitives: bool, i8, i16, i32, i64, f32, f64, String  Collections: Vec&lt;T&gt;, HashMap&lt;K,V&gt;, BTreeMap&lt;K,V&gt;, HashSet&lt;T&gt;, Option&lt;T&gt;  Smart Pointers: Box&lt;T&gt;, Rc&lt;T&gt;, Arc&lt;T&gt;, RcWeak&lt;T&gt;, ArcWeak&lt;T&gt;, RefCell&lt;T&gt;, Mutex&lt;T&gt;  Date/Time: chrono::NaiveDate, chrono::NaiveDateTime  Custom Types: Derive ForyObject for object graphs, ForyRow for row format  Trait Objects: Box&lt;dyn T&gt;, Rc&lt;dyn T&gt;, Arc&lt;dyn T&gt;, Rc&lt;dyn Any&gt;, Arc&lt;dyn Any&gt;  ","version":null,"tagName":"h2"},{"title":"Roadmap: What's Next‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#roadmap-whats-next","content":" Apache Fory Rust is production-ready today, but we're just getting started and continuing active development:  ","version":null,"tagName":"h2"},{"title":"‚úÖ Shipped in v0.13‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#-shipped-in-v013","content":" ‚úÖ Static codegen via procedural macros‚úÖ Row format serialization with zero-copy‚úÖ Cross-language object graph serialization‚úÖ Shared and circular reference tracking‚úÖ Weak pointer support (RcWeak, ArcWeak)‚úÖ Trait object serialization (Box/Rc/Arc)‚úÖ Schema evolution in compatible mode  ","version":null,"tagName":"h3"},{"title":"üöß Coming Soon‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#-coming-soon","content":"  Cross-language reference serialization: serialize Rc/Arc to/from other languages. Partial row updates: Mutate row format in-place  ","version":null,"tagName":"h3"},{"title":"üéØ Help Wanted‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#-help-wanted","content":" We're actively seeking contributors for:  Performance tuning: Profile and optimize hot pathsDocumentation: More examples, tutorials, and guidesTesting: Fuzzing, property tests, edge case coverage  ","version":null,"tagName":"h3"},{"title":"Production Considerations‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#production-considerations","content":" ","version":null,"tagName":"h2"},{"title":"Thread Safety‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#thread-safety","content":" Fory becomes fully thread-safe after registration is complete. Once every type is registered (which requires &amp;mut Fory), wrap the instance in an Arc and freely share it across worker threads for concurrent serialization and deserialization.  use fory::Fory; use std::{sync::Arc, thread}; let mut fory = Fory::default(); fory.register::&lt;Item&gt;(1)?; let fory = Arc::new(fory); // `Fory` is Send + Sync once registration is done let item = Item::default(); let handles: Vec&lt;_&gt; = (0..4) .map(|_| { let fory = Arc::clone(&amp;fory); let input = item.clone(); thread::spawn(move || { let bytes = fory.serialize(&amp;input); let decoded: Item = fory.deserialize(&amp;bytes).expect(&quot;valid data&quot;); (bytes, decoded) }) }) .collect(); for handle in handles { let (bytes, decoded) = handle.join().expect(&quot;thread finished&quot;); // work with `bytes` / `decoded` }   ","version":null,"tagName":"h3"},{"title":"Error Handling‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#error-handling","content":" Apache Fory uses Result&lt;T, Error&gt; for all fallible operations:  use fory::Error; match fory.deserialize::&lt;User&gt;(&amp;bytes) { Ok(user) =&gt; process_user(user), Err(Error::TypeMismatch) =&gt; log::error!(&quot;Schema mismatch&quot;), Err(Error::BufferTooShort) =&gt; log::error!(&quot;Incomplete data&quot;), Err(e) =&gt; log::error!(&quot;Deserialization failed: {}&quot;, e), }   ","version":null,"tagName":"h3"},{"title":"Documentation‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#documentation","content":" Apache Fory Rust Guide: üìñ ViewApache Fory Rust API Doc: üìñ ViewApache Fory Xlang Serialization Spec: üìñ View  ","version":null,"tagName":"h2"},{"title":"Community and Contribution‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#community-and-contribution","content":" Apache Fory is an Apache Software Foundation project with a vibrant, growing community:  GitHub: apache/foryDocs: fory.apache.orgSlack: Join our communityIssue Tracker: GitHub Issues  ","version":null,"tagName":"h2"},{"title":"How to Contribute‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#how-to-contribute","content":" We welcome contributions of all kinds:  Code: Implement features from the roadmapDocs: Write tutorials, examples, and guidesTesting: Add benchmarks, fuzz tests, integration testsFeedback: Report bugs, request features, share use cases  See CONTRIBUTING.md for guidelines.  ","version":null,"tagName":"h3"},{"title":"License‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#license","content":" Apache Fory is licensed under the Apache License 2.0, a permissive open-source license that allows commercial use, modification, and distribution.  ","version":null,"tagName":"h3"},{"title":"Conclusion‚Äã","type":1,"pageTitle":"Introducing Apache Fory‚Ñ¢ Rust: A Versatile Serialization Framework for the Modern Age","url":"/blog/fory_rust_versatile_serialization_framework#conclusion","content":" Apache Fory Rust represents a paradigm shift in serialization:  No more trade-offs: Get performance and flexibilityNo more boilerplate: Derive macros handle the complexityNo more lock-in: Trait-object and shared reference support by nature  Whether you're building microservices, data pipelines, or real-time systems, Apache Fory Rust delivers the performance you need with the ergonomics you deserve.  Try it today:  cargo add fory   Join the community:  git clone https://github.com/apache/fory.git cd fory/rust cargo test --features tests   Share your experience:  Write a blog post about your use casePresent at your local Rust meetupContribute benchmarks from your domain ","version":null,"tagName":"h2"},{"title":"Fury v0.10.1 Released","type":0,"sectionRef":"#","url":"/blog/fury_0_10_1_release","content":"","keywords":"","version":null},{"title":"Features‚Äã","type":1,"pageTitle":"Fury v0.10.1 Released","url":"/blog/fury_0_10_1_release#features","content":" feat(java): support passed tracking ref meta when building serializers by @chaokunyang in https://github.com/apache/fury/pull/2113feat(java): extra entry in disallowed.txt by @pjfanning in https://github.com/apache/fury/pull/2098feat(java): use sha256 to check disallowed.txt tamper by @chaokunyang in https://github.com/apache/fury/pull/2102  ","version":null,"tagName":"h2"},{"title":"Bug Fix‚Äã","type":1,"pageTitle":"Fury v0.10.1 Released","url":"/blog/fury_0_10_1_release#bug-fix","content":" fix(java): fix read null chunk out of bound by @chaokunyang in https://github.com/apache/fury/pull/2065fix(java): Fix error with MemoryBuffer::readBytesAsInt64 when not in LITTLE_ENDIAN mode by @LouisLou2 in https://github.com/apache/fury/pull/2069fix(java): fix read primitives error on fill buffer bound by @chaokunyang in https://github.com/apache/fury/pull/2064fix(java): java.util.Date and its subclasses are mutable by @moooonk in https://github.com/apache/fury/pull/2076fix(java): fix ImmutableCollections$SubList duplicate registration by @w-yfan in https://github.com/apache/fury/pull/2074fix(java): Modify some mistake by @Hen1ng in https://github.com/apache/fury/pull/2086fix(java): fix serialization npe of collection with all null elems by @chaokunyang in https://github.com/apache/fury/pull/2111fix(java): fix disallowed.txt check in windows by @chaokunyang in https://github.com/apache/fury/pull/2128  ","version":null,"tagName":"h2"},{"title":"Other Improvements‚Äã","type":1,"pageTitle":"Fury v0.10.1 Released","url":"/blog/fury_0_10_1_release#other-improvements","content":" perf(java): Improve performance by using System.arraycopy to copy between byte arrays by @Cybermaxke in https://github.com/apache/fury/pull/2101perf(java): Refactor ThreadPoolFury to improve performance by @moooonk in https://github.com/apache/fury/pull/2092perf(java): Optimize Computational Efficiency of MetaStringEncoder::encodeGeneric by @LouisLou2 in https://github.com/apache/fury/pull/2072  Full Changelog: https://github.com/apache/fury/compare/v0.10.0...v0.10.1 ","version":null,"tagName":"h2"},{"title":"Fury v0.10.2 Released","type":0,"sectionRef":"#","url":"/blog/fury_0_10_2_release","content":"","keywords":"","version":null},{"title":"Features‚Äã","type":1,"pageTitle":"Fury v0.10.2 Released","url":"/blog/fury_0_10_2_release#features","content":" feat(kotlin): add kotlin ci by @pandalee99 in https://github.com/apache/fury/pull/2176  ","version":null,"tagName":"h2"},{"title":"Bug Fix‚Äã","type":1,"pageTitle":"Fury v0.10.2 Released","url":"/blog/fury_0_10_2_release#bug-fix","content":" fix(java): fix DisallowedList calculate hash in Windows by @chaokunyang in https://github.com/apache/fury/pull/2142fix(java): fix fury logger log exception by @chaokunyang in https://github.com/apache/fury/pull/2153fix(java): fix nested chunk map serialization error when generics exists by @chaokunyang in https://github.com/apache/fury/pull/2162fix(java): fix nested map chunk serialization codegen by @chaokunyang in https://github.com/apache/fury/pull/2172fix(kotlin): fix kotlin compile error by @chaokunyang in https://github.com/apache/fury/pull/2173  Full Changelog: https://github.com/apache/fury/compare/v0.10.1...v0.10.2 ","version":null,"tagName":"h2"},{"title":"Fury v0.10.3 Released","type":0,"sectionRef":"#","url":"/blog/fury_0_10_3_release","content":"","keywords":"","version":null},{"title":"Features‚Äã","type":1,"pageTitle":"Fury v0.10.3 Released","url":"/blog/fury_0_10_3_release#features","content":" feat(java): add protobuf serializer for message and byte string by @chaokunyang in https://github.com/apache/fury/pull/2213  ","version":null,"tagName":"h2"},{"title":"Bug Fix‚Äã","type":1,"pageTitle":"Fury v0.10.3 Released","url":"/blog/fury_0_10_3_release#bug-fix","content":" fix(java): mark fury-test-core as test dep in fury extensions by @chaokunyang in https://github.com/apache/fury/pull/2231fix(java): ensure readVarUint36Small reads full bits regardless of remaining buffer size by @LouisLou2 in https://github.com/apache/fury/pull/2179fix(java): ensure FuryObjectInputStream.read never returns 0 when length&gt;0 by @X-czh in https://github.com/apache/fury/pull/2205fix(java): Fix empty string processing in MetaStringBytes by @LouisLou2 in https://github.com/apache/fury/pull/2212fix(java): fix field super class missing in compatible mode by @chaokunyang in https://github.com/apache/fury/pull/2214fix(python): fix pyfury build using pyproject.toml by @chaokunyang in https://github.com/apache/fury/pull/2206fix: install bazel by @chaokunyangfix: print python tests exception by @chaokunyangfix: install pyarrow by @chaokunyang  ","version":null,"tagName":"h2"},{"title":"Chores‚Äã","type":1,"pageTitle":"Fury v0.10.3 Released","url":"/blog/fury_0_10_3_release#chores","content":" chore: cherry-pick commits for 0.10.3 by @chaokunyang in https://github.com/apache/fury/pull/2219chore: cherry-pick commits for 0.10.3 by @chaokunyang in https://github.com/apache/fury/pull/2234chore: Bump version to 0.10.3 by @pandalee99 in https://github.com/apache/fury/pull/2235chore: fix Releases 0.10 by @pandalee99 in https://github.com/apache/fury/pull/2236chore(javascript): remove nodejs 12 support by @chaokunyang in https://github.com/apache/fury/pull/2233  Full Changelog: https://github.com/apache/fury/compare/v0.10.2...v0.10.3-rc2 ","version":null,"tagName":"h2"},{"title":"Fury v0.2.1 released","type":0,"sectionRef":"#","url":"/blog/fury_0_2_1_release","content":"","keywords":"","version":null},{"title":"Highlight‚Äã","type":1,"pageTitle":"Fury v0.2.1 released","url":"/blog/fury_0_2_1_release#highlight","content":" [Go] Support tiny go compilation[Java] Support private JDK17+ record class JIT serialization  ","version":null,"tagName":"h2"},{"title":"Bug fix‚Äã","type":1,"pageTitle":"Fury v0.2.1 released","url":"/blog/fury_0_2_1_release#bug-fix","content":" Fix jit error for register private serializersUpgrade janino version to fix package name conflict with classname  ","version":null,"tagName":"h2"},{"title":"What's Changed‚Äã","type":1,"pageTitle":"Fury v0.2.1 released","url":"/blog/fury_0_2_1_release#whats-changed","content":" [Doc] Update JDK support doc by @chaokunyang in https://github.com/alipay/fury/pull/992[Go] Make compilation support tinygo by @springrain in https://github.com/alipay/fury/pull/991[Doc] fix config class imports by @chaokunyang in https://github.com/alipay/fury/pull/993[go] fixed typo in readme import path by @voldyman in https://github.com/alipay/fury/pull/995[Java] fix jit error for register private serializers by @chaokunyang in https://github.com/alipay/fury/pull/999[Java] Refine reflection contructor by MethodHandle by @chaokunyang in https://github.com/alipay/fury/pull/1000[Java] Fix private record JIT by @chaokunyang in https://github.com/alipay/fury/pull/1004[Java] Upgrade janino version to fix package name conflict with classname by @chaokunyang in https://github.com/alipay/fury/pull/1006[Java] fix janino deps for fury-benchmark by @chaokunyang in https://github.com/alipay/fury/pull/1007[Doc] Improve README by @caicancai in https://github.com/alipay/fury/pull/1009  ","version":null,"tagName":"h2"},{"title":"New Contributors‚Äã","type":1,"pageTitle":"Fury v0.2.1 released","url":"/blog/fury_0_2_1_release#new-contributors","content":" @springrain made their first contribution in https://github.com/alipay/fury/pull/991@voldyman made their first contribution in https://github.com/alipay/fury/pull/995@caicancai made their first contribution in https://github.com/alipay/fury/pull/1009  Full Changelog: https://github.com/alipay/fury/compare/v0.2.0...v0.2.1 ","version":null,"tagName":"h2"},{"title":"Fury 0.4.0 Released","type":0,"sectionRef":"#","url":"/blog/fury_0_4_0_release","content":"","keywords":"","version":null},{"title":"Highlight‚Äã","type":1,"pageTitle":"Fury 0.4.0 Released","url":"/blog/fury_0_4_0_release#highlight","content":" [Java] Support Graalvm native image. The implementation will generate all serialization code at image build time, the runtime will be extremely fast, see fury graalvm usage doc[Java] Fury vs JDK benchmark on Graalvm native image[Scala] Serialization support for package scoped object[C++] Reflection support by macro/template programing[C++] Automatic row format encoder  ","version":null,"tagName":"h2"},{"title":"What's Changed‚Äã","type":1,"pageTitle":"Fury 0.4.0 Released","url":"/blog/fury_0_4_0_release#whats-changed","content":" [Python] fix python release by @chaokunyang in https://github.com/alipay/fury/pull/1125[Java] make unsafe offset compatible with graalvm by @chaokunyang in https://github.com/alipay/fury/pull/1117[Scala] Fix scala package object JIT error by @chaokunyang in https://github.com/alipay/fury/pull/1130[Java] Refine maven pom config by @chaokunyang in https://github.com/alipay/fury/pull/1126[Rust] add rust building by @caicancai in https://github.com/alipay/fury/pull/1129[C++] Remove useless overload of Writer::WriteString by @PragmaTwice in https://github.com/alipay/fury/pull/1136[Rust] fix typo by @caicancai in https://github.com/alipay/fury/pull/1133[Rust] add mesaage about rust ci by @caicancai in https://github.com/alipay/fury/pull/1131[C++] Add move ctor/assign op to Status by @PragmaTwice in https://github.com/alipay/fury/pull/1134[Rust] fix cargo test error by @wangweipeng2 in https://github.com/alipay/fury/pull/1135[Rust] improve rust ci by @caicancai in https://github.com/alipay/fury/pull/1138[Scala] Fix scala collection serialization nested in pojo by @chaokunyang in https://github.com/alipay/fury/pull/1140[Java] make sting builder serializer codegen eager by @chaokunyang in https://github.com/alipay/fury/pull/1141[Rust] fix rust ci bug by @caicancai in https://github.com/alipay/fury/pull/1139[Java] support add static fields in fury codegen by @chaokunyang in https://github.com/alipay/fury/pull/1147[C++] Add the basic row format serializer for C++ class types via reflection by @PragmaTwice in https://github.com/alipay/fury/pull/1144[C++] Add duplicated fields detection in FURY_FIELD_INFO macro by @PragmaTwice in https://github.com/alipay/fury/pull/1151[Java] support create serializer when register class by @chaokunyang in https://github.com/alipay/fury/pull/1154[Java] Support graalvm native image by @chaokunyang in https://github.com/alipay/fury/pull/1143[C++] Support string type in RowEncoder by @PragmaTwice in https://github.com/alipay/fury/pull/1158[Scala] add graalvm support for scala singleton by @chaokunyang in https://github.com/alipay/fury/pull/1159[Scala] Fix scala singleton map/collection serialization in struct by @chaokunyang in https://github.com/alipay/fury/pull/1160[Java] add read resolve circular test suite by @chaokunyang in https://github.com/alipay/fury/pull/1161[Java] Remove load arrow serializers by default by @chaokunyang in https://github.com/alipay/fury/pull/1163[Java] Support thread safe fury for graalvm native image by @chaokunyang in https://github.com/alipay/fury/pull/1164[Scala] Fix package object serialization in scala App by @chaokunyang in https://github.com/alipay/fury/pull/1166[Java] add graalvm usage doc by @chaokunyang in https://github.com/alipay/fury/pull/1168[C++] Split util.h to bit_util.h and time_util.h by @PragmaTwice in https://github.com/alipay/fury/pull/1171[C++] Support cv-qualified types in row encoder by @PragmaTwice in https://github.com/alipay/fury/pull/1172[C++] Add support for nested class types in row encoder by @PragmaTwice in https://github.com/alipay/fury/pull/1173[Java] Add graalvm benchmark by @chaokunyang in https://github.com/alipay/fury/pull/1178[Java] Fix string key serializer ref tracking by @chaokunyang in https://github.com/alipay/fury/pull/1174[Java] Add graalvm benchmark test results by @chaokunyang in https://github.com/alipay/fury/pull/1180[Scala] fix package object inaccessible from source code by @chaokunyang in https://github.com/alipay/fury/pull/1181  Full Changelog: https://github.com/alipay/fury/compare/v0.3.1...v0.4.0 ","version":null,"tagName":"h2"},{"title":"Fury v0.3.1 released","type":0,"sectionRef":"#","url":"/blog/fury_0_3_1_release","content":"","keywords":"","version":null},{"title":"Highlight‚Äã","type":1,"pageTitle":"Fury v0.3.1 released","url":"/blog/fury_0_3_1_release#highlight","content":" Support python 3.11 and 3.12, drop python 3.6 supportRefactor collection serialization framework to support writeReplace JITIntegrate scala collection with fury java collection frameworkSupport scala collection jit serializationSupport shim dispatcher to resolve compatibility problems for common used classesUse lastest arrow 14 version for row format in Java and Python  ","version":null,"tagName":"h2"},{"title":"What's Changed‚Äã","type":1,"pageTitle":"Fury v0.3.1 released","url":"/blog/fury_0_3_1_release#whats-changed","content":" [Doc] add scala sbt install doc by @chaokunyang in https://github.com/alipay/fury/pull/1066[Doc] Update scala_guide.md by @chaokunyang in https://github.com/alipay/fury/pull/1067[Doc] Add scala 2/3 support doc by @chaokunyang in https://github.com/alipay/fury/pull/1068[Java] Refactor collection serialization framework to support writeReplace JIT by @chaokunyang in https://github.com/alipay/fury/pull/1062[Java] Refine collection package by @chaokunyang in https://github.com/alipay/fury/pull/1070[Java] merge map/collection into collection package by @chaokunyang in https://github.com/alipay/fury/pull/1072[Scala] integrate scala collection with fury java collection framework by @chaokunyang in https://github.com/alipay/fury/pull/1073remove unused part of build.sbt by @pjfanning in https://github.com/alipay/fury/pull/1074[Scala] get build to work with Scala 3 by @pjfanning in https://github.com/alipay/fury/pull/1075[Scala] support scala collection jit serialization by @chaokunyang in https://github.com/alipay/fury/pull/1077[Doc] add apache license section to readme by @caicancai in https://github.com/alipay/fury/pull/1080[Java] add option to disable class check warnings by @chaokunyang in https://github.com/alipay/fury/pull/1084[Java] Fix collection serialization NPE when all elements are null by @chaokunyang in https://github.com/alipay/fury/pull/1086[Java] FuryPooledObjectFactory getFury refactor, remove redundant recursive call by @mof-dev-3 in https://github.com/alipay/fury/pull/1088[Rust] add rust-version by @wangweipeng2 in https://github.com/alipay/fury/pull/1091[DOC] add javascript sample by @wangweipeng2 in https://github.com/alipay/fury/pull/1095Make sure the c++ standard is set to 17 by @PragmaTwice in https://github.com/alipay/fury/pull/1093Fix undefined behavior due to use of uninitialized field in Buffer by @PragmaTwice in https://github.com/alipay/fury/pull/1092[Rust] merge derive and make it sample by @wangweipeng2 in https://github.com/alipay/fury/pull/1098[DOC] add rust sample by @wangweipeng2 in https://github.com/alipay/fury/pull/1100Simplify endian utility functions and IsOneOf by @PragmaTwice in https://github.com/alipay/fury/pull/1096[Java] throw error if nested fury serialize happen in serialization by @chaokunyang in https://github.com/alipay/fury/pull/1103[C++] remove useless FromXXXEndian by @chaokunyang in https://github.com/alipay/fury/pull/1105[Rust ] Remove the magic numbers by @wangweipeng2 in https://github.com/alipay/fury/pull/1107[Rust] chore: add rust doc by @wangweipeng2 in https://github.com/alipay/fury/pull/1109[JavaScript] Fill in readme by @wangweipeng2 in https://github.com/alipay/fury/pull/1110chore: check xlang flag by @wangweipeng2 in https://github.com/alipay/fury/pull/1112[Java] Remove guava part1 by @chaokunyang in https://github.com/alipay/fury/pull/1114[Rust] Correct language flag by @wangweipeng2 in https://github.com/alipay/fury/pull/1120[Java] DateTimeUtils minor refactor, reuse floorDiv to calculate floorMod by @mof-dev-3 in https://github.com/alipay/fury/pull/1122[Python] Support python3.11/12 by @chaokunyang in https://github.com/alipay/fury/pull/1064[java] support shim dispatcher to resolve compatibility problems for common used classes by @xiguashu in https://github.com/alipay/fury/pull/1123  ","version":null,"tagName":"h2"},{"title":"New Contributors‚Äã","type":1,"pageTitle":"Fury v0.3.1 released","url":"/blog/fury_0_3_1_release#new-contributors","content":" @pjfanning made their first contribution in https://github.com/alipay/fury/pull/1074@mof-dev-3 made their first contribution in https://github.com/alipay/fury/pull/1088@PragmaTwice made their first contribution in https://github.com/alipay/fury/pull/1093@xiguashu made their first contribution in https://github.com/alipay/fury/pull/1123  Full Changelog: https://github.com/alipay/fury/compare/v0.3.0...v0.3.1 ","version":null,"tagName":"h2"},{"title":"Fury 0.4.1 Released","type":0,"sectionRef":"#","url":"/blog/fury_0_4_1_release","content":"","keywords":"","version":null},{"title":"Highlight‚Äã","type":1,"pageTitle":"Fury 0.4.1 Released","url":"/blog/fury_0_4_1_release#highlight","content":" [Rust] Support row format[C++] Support iterable types for RowEncoder[JavaScript] Support partial record[Java] Fix JIT error in corner case, now Fury can generate serializer for every class  ","version":null,"tagName":"h2"},{"title":"What's Changed‚Äã","type":1,"pageTitle":"Fury 0.4.1 Released","url":"/blog/fury_0_4_1_release#whats-changed","content":" [Doc] Refine issue template by a yaml form by @chaokunyang in https://github.com/alipay/fury/pull/1185[C++] Fix ownership problem for children writers by visitor by @PragmaTwice in https://github.com/alipay/fury/pull/1193[C++] Remove useless fields and macro in logging by @PragmaTwice in https://github.com/alipay/fury/pull/1195[Doc] add docs for java FuryBuilder #1188 by @mof-dev-3 in https://github.com/alipay/fury/pull/1192[Rust] support row format by @wangweipeng2 in https://github.com/alipay/fury/pull/1196[C++] Add RowEncoder wrapper to RowEncodeTrait by @PragmaTwice in https://github.com/alipay/fury/pull/1200[Rust] Row support more types by @wangweipeng2 in https://github.com/alipay/fury/pull/1202[Rust] Support row map by @wangweipeng2 in https://github.com/alipay/fury/pull/1206[C++] update bazel version from 4.2 to 6.3.2 by @chaokunyang in https://github.com/alipay/fury/pull/1204[JavaScript] Support partial record by @wangweipeng2 in https://github.com/alipay/fury/pull/1208[Java] fix package access level class accessor jit by @chaokunyang in https://github.com/alipay/fury/pull/1210[JavaScript] Fix register a description twice will get undefined serializer by @bytemain in https://github.com/alipay/fury/pull/1211[C++] Support iterable types in RowEncodeTrait by @PragmaTwice in https://github.com/alipay/fury/pull/1212[C++] Support iterable types for RowEncoder by @PragmaTwice in https://github.com/alipay/fury/pull/1215[Python] Refine py register class method by @chaokunyang in https://github.com/alipay/fury/pull/1218[Java] Clear extRegistry.getClassCtx if generate serializer class failed in https://github.com/alipay/fury/pull/1221  ","version":null,"tagName":"h2"},{"title":"New Contributors‚Äã","type":1,"pageTitle":"Fury 0.4.1 Released","url":"/blog/fury_0_4_1_release#new-contributors","content":" @bytemain made their first contribution in https://github.com/alipay/fury/pull/1211  Full Changelog: https://github.com/alipay/fury/compare/v0.4.0...v0.4.1 ","version":null,"tagName":"h2"},{"title":"Fury v0.2.0 released","type":0,"sectionRef":"#","url":"/blog/fury_0_2_0_release","content":"","keywords":"","version":null},{"title":"Highlights‚Äã","type":1,"pageTitle":"Fury v0.2.0 released","url":"/blog/fury_0_2_0_release#highlights","content":" ","version":null,"tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Fury v0.2.0 released","url":"/blog/fury_0_2_0_release#java","content":" Support JDK17+ record JIT/Interpreter serializationSupport JDK17+ record JIT/Interpreter serialization backward/forward compatibilitySupport jdk9+ Immutable Collections JIT/Interpreter mode serialization, much faster compared to other frameworksNew collection serialization protocol by homogenization, 1.5x speed up, 2X space saving.Desgined and implemented a new long compression algorithm, with performance cost less than 10% but give 50% compresstion ratioSupport configuring compress int/long independently, enable int/long compression by defaultAdd class checker API and Whitelist/Blacklist based implementation to enhance security  ","version":null,"tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Fury v0.2.0 released","url":"/blog/fury_0_2_0_release#python","content":" Support pyarrow6 bazel buildSupport python 3.10  ","version":null,"tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Fury v0.2.0 released","url":"/blog/fury_0_2_0_release#javascript","content":" [JavaScript] support fury for browser[JavaScript] support polymorphism[JavaScript] enhancement performance  ","version":null,"tagName":"h3"},{"title":"Golang‚Äã","type":1,"pageTitle":"Fury v0.2.0 released","url":"/blog/fury_0_2_0_release#golang","content":" Implement Golang serialization framework, which support reference, pointer, data serializationImplement serializers for string/numbers/slice/map/slice/struct/pointer  ","version":null,"tagName":"h3"},{"title":"What's Changed‚Äã","type":1,"pageTitle":"Fury v0.2.0 released","url":"/blog/fury_0_2_0_release#whats-changed","content":" [JavaScript] enhancement performance and bugfix by @wangweipeng2 in https://github.com/alipay/fury/pull/811[JavaScript] support polymorphism by @wangweipeng2 in https://github.com/alipay/fury/pull/814Create SECURITY.md by @chaokunyang in https://github.com/alipay/fury/pull/817[JavaScript] fix bug #703 by @wangweipeng2 in https://github.com/alipay/fury/pull/819[Java] fix isSecure check for xlang in java by @chaokunyang in https://github.com/alipay/fury/pull/822[Doc] add protocol wire format wip by @chaokunyang in https://github.com/alipay/fury/pull/823[JavaScript] write tag hash by @wangweipeng2 in https://github.com/alipay/fury/pull/825[JavaScript] support browser by @wangweipeng2 in https://github.com/alipay/fury/pull/830[Java] register empty object by default by @chaokunyang in https://github.com/alipay/fury/pull/829[Java] upgrade guava for CVE-2023-2976 by @chaokunyang in https://github.com/alipay/fury/pull/831[JavaScript] detect platform wrong by @wangweipeng2 in https://github.com/alipay/fury/pull/832[JavaScript] add test by @wangweipeng2 in https://github.com/alipay/fury/pull/836[Java] Add compatible ci for JDK8/11/13/15/17 by @chaokunyang in https://github.com/alipay/fury/pull/835[Java] use java.lang.ClassValue to cache Lookup by @chaokunyang in https://github.com/alipay/fury/pull/844[Java] Refactor integration tests by @chaokunyang in https://github.com/alipay/fury/pull/845[Java] suppress maven download logs by --no-transfer-progress by @chaokunyang in https://github.com/alipay/fury/pull/846[Java] add missing jdk primitive function by @chaokunyang in https://github.com/alipay/fury/pull/848[Java] make getter lambda functions by @chaokunyang in https://github.com/alipay/fury/pull/849[Java] add record utils by @chaokunyang in https://github.com/alipay/fury/pull/850[Java] Support access record field value by @chaokunyang in https://github.com/alipay/fury/pull/851[Java] interpreter mode support for record serialization by @chaokunyang in https://github.com/alipay/fury/pull/852[CI] Fix checkstyle by @chaokunyang in https://github.com/alipay/fury/pull/853[Java] Support jdk record forward/backward interpreter serialization by @chaokunyang in https://github.com/alipay/fury/pull/854[Java] Support jdk record metashare mode by @chaokunyang in https://github.com/alipay/fury/pull/855[Java] move record utils to record pkg by @chaokunyang in https://github.com/alipay/fury/pull/856[Java] move inner functions outside by @chaokunyang in https://github.com/alipay/fury/pull/857[Python] Support pyarrow6 bazel build by @chaokunyang in https://github.com/alipay/fury/pull/859[Python] add missing shared lib for python by @chaokunyang in https://github.com/alipay/fury/pull/862[Python] fix python deploy by @chaokunyang in https://github.com/alipay/fury/pull/863[Java] Jdk record compatible jit by @chaokunyang in https://github.com/alipay/fury/pull/864[Java] JIT serialization for JDK record by @chaokunyang in https://github.com/alipay/fury/pull/866[Java] support private record jit by @chaokunyang in https://github.com/alipay/fury/pull/869[Java] optimize buffer copy by @chaokunyang in https://github.com/alipay/fury/pull/870[Doc] Fix row format doc by @chaokunyang in https://github.com/alipay/fury/pull/873[Java] Support compress int long independently by @chaokunyang in https://github.com/alipay/fury/pull/875[Java] fix ofHashMap by @chaokunyang in https://github.com/alipay/fury/pull/877[Java] add jdk tools.jar for tests by @chaokunyang in https://github.com/alipay/fury/pull/881[Java] register common exception by @chaokunyang in https://github.com/alipay/fury/pull/879[Java] Fix lazy bean serializer by @chaokunyang in https://github.com/alipay/fury/pull/883[Java] print exception for fury creation by @chaokunyang in https://github.com/alipay/fury/pull/885[Java] remove getCurrentFury API by @chaokunyang in https://github.com/alipay/fury/pull/887[Java] Add fury map iterator api by @chaokunyang in https://github.com/alipay/fury/pull/889[Java] Add class checker API by @chaokunyang in https://github.com/alipay/fury/pull/890[Python] Fix python linux deploy missing shared library files by @chaokunyang in https://github.com/alipay/fury/pull/892[Java] refine AllowListChecker by @chaokunyang in https://github.com/alipay/fury/pull/893Update README.md by @chaokunyang in https://github.com/alipay/fury/pull/894[Java] support immutable collection/map jit and generics optimization by @chaokunyang in https://github.com/alipay/fury/pull/895[Java] cache generated guava constructor by @chaokunyang in https://github.com/alipay/fury/pull/897[Java] Optimize jdk9+ immutable collection serialization by @chaokunyang in https://github.com/alipay/fury/pull/900[Java] add jdk20 tests by @chaokunyang in https://github.com/alipay/fury/pull/901[Java] optimize duplicate fields utils by @chaokunyang in https://github.com/alipay/fury/pull/905[Java] fix jit error for package-level field with private type by @chaokunyang in https://github.com/alipay/fury/pull/907[Java] update blacklist by @chaokunyang in https://github.com/alipay/fury/pull/913[Python] Use cloudpickle for local function serialization by @chaokunyang in https://github.com/alipay/fury/pull/914[Python] fix row format getter by @chaokunyang in https://github.com/alipay/fury/pull/915[Java] disable class check by default by @chaokunyang in https://github.com/alipay/fury/pull/917[Java] refine java docs by @chaokunyang in https://github.com/alipay/fury/pull/918Update blacklist.txt by @chaokunyang in https://github.com/alipay/fury/pull/920[Java] Skip toString in annotation invocation handler readObject by @chaokunyang in https://github.com/alipay/fury/pull/922Optimize StringBuilder/StringBuffer serialization by @pandalee99 in https://github.com/alipay/fury/pull/908Bump release versin to 0.1.2 by @chaokunyang in https://github.com/alipay/fury/pull/924[Doc] add basic type java format doc by @chaokunyang in https://github.com/alipay/fury/pull/928[Java] speed test codegen speed by avoid duplicate codegen by @chaokunyang in https://github.com/alipay/fury/pull/929[Java] Optimize collection serialization protocol by homogenization by @chaokunyang in https://github.com/alipay/fury/pull/923Bump org.apache.avro:avro from 1.11.1 to 1.11.3 in /java/fury-benchmark by @dependabot in https://github.com/alipay/fury/pull/931[Java] Rename classinfocache to classinfoholder by @chaokunyang in https://github.com/alipay/fury/pull/933[Java] put together all primitive serializers by @chaokunyang in https://github.com/alipay/fury/pull/934[Java] Fix jvm crash caused by varint out-of-bound writing by @chaokunyang in https://github.com/alipay/fury/pull/937[Java] enable int compression by default by @chaokunyang in https://github.com/alipay/fury/pull/935[Java] put together all fury related config classes into config package by @chaokunyang in https://github.com/alipay/fury/pull/940[Java] Add SLI(small long as int) long encoding algorithm by @chaokunyang in https://github.com/alipay/fury/pull/942[Java] use raw type serializer for getSerialzier in jit by @chaokunyang in https://github.com/alipay/fury/pull/943[Java] use varint for class id encoding to reduce space cost by @chaokunyang in https://github.com/alipay/fury/pull/945[Java] Fix Collection/Map jit/interpreter protocol inconsisitency for generics instantiated subclass by @chaokunyang in https://github.com/alipay/fury/pull/947[Go] add fury go util and ci tests by @chaokunyang in https://github.com/alipay/fury/pull/950[Go] add fury go buffer implementation by @chaokunyang in https://github.com/alipay/fury/pull/952[Go] add fury go serialization framework by @chaokunyang in https://github.com/alipay/fury/pull/954[Go] add serializers for common go types by @chaokunyang in https://github.com/alipay/fury/pull/956[Java] fix varint writeindex grow for jit by @chaokunyang in https://github.com/alipay/fury/pull/957[Go] add fury go map serializer by @chaokunyang in https://github.com/alipay/fury/pull/959[Go] add slice serializer for fury go by @chaokunyang in https://github.com/alipay/fury/pull/961[Go] add set serializer for fury go by @chaokunyang in https://github.com/alipay/fury/pull/963[Go] Add struct serializer for fury go by @chaokunyang in https://github.com/alipay/fury/pull/965[Go] add ref tracking tests by @chaokunyang in https://github.com/alipay/fury/pull/967[Go] add fury type dispatch tests by @chaokunyang in https://github.com/alipay/fury/pull/969[Go] add fury serialization tests by @chaokunyang in https://github.com/alipay/fury/pull/971[Go] Add fury xlang tests by @chaokunyang in https://github.com/alipay/fury/pull/973[Go] rename Reference to Ref by @chaokunyang in https://github.com/alipay/fury/pull/975[Java] add jdk 21 tests by @chaokunyang in https://github.com/alipay/fury/pull/977[Java] add jdk 21 tests ci by @chaokunyang in https://github.com/alipay/fury/pull/978[Java] Optimize sli long read/write by @chaokunyang in https://github.com/alipay/fury/pull/981[Doc] upgrade docs by @chaokunyang in https://github.com/alipay/fury/pull/985 https://github.com/alipay/fury/pull/986 https://github.com/alipay/fury/pull/987[Java] add serializeJavaObject API to ThreadSafeFury by @chaokunyang in https://github.com/alipay/fury/pull/988[Java] fix jdk17/21 ci latest_jdk_tests skip by @chaokunyang in https://github.com/alipay/fury/pull/989  ","version":null,"tagName":"h2"},{"title":"New Contributors‚Äã","type":1,"pageTitle":"Fury v0.2.0 released","url":"/blog/fury_0_2_0_release#new-contributors","content":" @pandalee99 made their first contribution in https://github.com/alipay/fury/pull/908@ilxqx made their first contribution in https://github.com/fury-project/dubbo-serialization-fury/pull/1@T-baby made their first contribution in https://github.com/fury-project/dubbo-serialization-fury/pull/13  Full Changelog: https://github.com/alipay/fury/compare/v0.1.0...v0.2.0 ","version":null,"tagName":"h2"},{"title":"Fury v0.3.0 released","type":0,"sectionRef":"#","url":"/blog/fury_0_3_0_release","content":"","keywords":"","version":null},{"title":"Scala Serialization Guide‚Äã","type":1,"pageTitle":"Fury v0.3.0 released","url":"/blog/fury_0_3_0_release#scala-serialization-guide","content":" Install dependecy:  libraryDependencies += &quot;org.furyio&quot; % &quot;fury-core&quot; % &quot;0.3.0&quot;   Creating fury:  val fury = Fury.builder() .withScalaOptimizationEnabled(true) .requireClassRegistration(false) .withRefTracking(true) .build()   Serialize case objects:  case class Person(github: String, age: Int, id: Long) val p = Person(&quot;https://github.com/chaokunyang&quot;, 18, 1) println(fury.deserialize(fury.serialize(p))) println(fury.deserializeJavaObject(fury.serializeJavaObject(p)))   Serialize singleton objects:  object singleton { } val o1 = fury.deserialize(fury.serialize(singleton)) val o2 = fury.deserialize(fury.serialize(singleton)) println(o1 == o2)   Serialize collection objects:  val seq = Seq(1,2) val list = List(&quot;a&quot;, &quot;b&quot;) val map = Map(&quot;a&quot; -&gt; 1, &quot;b&quot; -&gt; 2) println(fury.deserialize(fury.serialize(seq))) println(fury.deserialize(fury.serialize(list))) println(fury.deserialize(fury.serialize(map)))   Serialize enum:  enum Color { case Red, Green, Blue } println(fury.deserialize(fury.serialize(Color.Green)))   ","version":null,"tagName":"h2"},{"title":"Highlight‚Äã","type":1,"pageTitle":"Fury v0.3.0 released","url":"/blog/fury_0_3_0_release#highlight","content":" [Scala] Support scala serialization: case/object/tuple/string/collection/enum/basic all supported[Scala] Add scala user documentation[Scala] add optimized scala singleton object serializer[Java] Make java.io.Externalizable compatible with Java writeReplace/readResolve API[Java] Integrate fury with dubbo https://github.com/apache/dubbo-spi-extensions/pull/226[Java] support bytes string serialization for jdk8 with JDK17 runtime  ","version":null,"tagName":"h2"},{"title":"BugFix‚Äã","type":1,"pageTitle":"Fury v0.3.0 released","url":"/blog/fury_0_3_0_release#bugfix","content":" [Java] Allow for InputStream not reading entire length[Java] Use ReflectionUtils.getCtrHandle() for non-public constructor in ExternalizableSerializer[Java] fix jdk compatible serialization for inheritance  ","version":null,"tagName":"h2"},{"title":"What's Changed‚Äã","type":1,"pageTitle":"Fury v0.3.0 released","url":"/blog/fury_0_3_0_release#whats-changed","content":" [Impove]-[Doc] Improve README by @caicancai in https://github.com/alipay/fury/pull/1011[Java] rename wrong ascii naming to latin by @chaokunyang in https://github.com/alipay/fury/pull/1013[Doc] Update go install doc by @chaokunyang in https://github.com/alipay/fury/pull/1015fix(grammatical): correct typos and improve grammar by @iamahens in https://github.com/alipay/fury/pull/1018[Improve]-[Doc] Improve README by @caicancai in https://github.com/alipay/fury/pull/1020[Improve]-[Doc] add environment requirement by @caicancai in https://github.com/alipay/fury/pull/1022chore(docs): fixed typos by @Smoothieewastaken in https://github.com/alipay/fury/pull/1023bugfix: read buffer error when object contain binary field by @wangweipeng2 in https://github.com/alipay/fury/pull/1026[Doc] Optimize class registration doc by @chaokunyang in https://github.com/alipay/fury/pull/1027[Java] fix jdk compatible serialization for inheritance by @chaokunyang in https://github.com/alipay/fury/pull/1030[Doc] add scala user doc by @chaokunyang in https://github.com/alipay/fury/pull/1028[Doc] refine scala doc by @chaokunyang in https://github.com/alipay/fury/pull/1031Update README.md - fix grammatrical errors in README. by @ayushrakesh in https://github.com/alipay/fury/pull/1037[Java] Support local static class jit by @chaokunyang in https://github.com/alipay/fury/pull/1036[Java] support bytes string serialization for jdk8 by @chaokunyang in https://github.com/alipay/fury/pull/1039[Java] set timeout to JITContextTest by @chaokunyang in https://github.com/alipay/fury/pull/1040[Java] fix string builder serialization for jdk8 with jdk17 runtime by @chaokunyang in https://github.com/alipay/fury/pull/1042[Doc] add auto code reviewers by @chaokunyang in https://github.com/alipay/fury/pull/1043[Java] Allow for InputStream not reading entire length by @knutwannheden in https://github.com/alipay/fury/pull/1034[Java] Use ReflectionUtils.getCtrHandle() in ExternalizableSerializer by @knutwannheden in https://github.com/alipay/fury/pull/1044[Improve] make maven-spotless-plugin version as a parameter by @caicancai in https://github.com/alipay/fury/pull/1046Update README.md by @Shivam250702 in https://github.com/alipay/fury/pull/1047[Java] support writeReplace/readResolve for Externalizable by @chaokunyang in https://github.com/alipay/fury/pull/1048Update README.md by @Spyrosigma in https://github.com/alipay/fury/pull/1051Grammatical error in CODE_OF_CONDUCT.md by @HimanshuMahto in https://github.com/alipay/fury/pull/1050Update scala link title README.md by @chaokunyang in https://github.com/alipay/fury/pull/1052[Doc] add scala readme and refine document by @chaokunyang in https://github.com/alipay/fury/pull/1041[Java] populate StackOverflowError with enable ref tracking message by @chaokunyang in https://github.com/alipay/fury/pull/1049[Scala] Setup scala project by @chaokunyang in https://github.com/alipay/fury/pull/1054[Scala] add scala singleton object serializer by @chaokunyang in https://github.com/alipay/fury/pull/1053Updated README.md by @vidhijain27 in https://github.com/alipay/fury/pull/1056[Scala] add scala tuple serialization tests by @chaokunyang in https://github.com/alipay/fury/pull/1059Empty ListExpression#genCode will throw npe by @farmerworking in https://github.com/alipay/fury/pull/1063  ","version":null,"tagName":"h2"},{"title":"New Contributors‚Äã","type":1,"pageTitle":"Fury v0.3.0 released","url":"/blog/fury_0_3_0_release#new-contributors","content":" @iamahens made their first contribution in https://github.com/alipay/fury/pull/1018@Smoothieewastaken made their first contribution in https://github.com/alipay/fury/pull/1023@ayushrakesh made their first contribution in https://github.com/alipay/fury/pull/1037@knutwannheden made their first contribution in https://github.com/alipay/fury/pull/1034@Shivam250702 made their first contribution in https://github.com/alipay/fury/pull/1047@Spyrosigma made their first contribution in https://github.com/alipay/fury/pull/1051@HimanshuMahto made their first contribution in https://github.com/alipay/fury/pull/1050@vidhijain27 made their first contribution in https://github.com/alipay/fury/pull/1056@farmerworking made their first contribution in https://github.com/alipay/fury/pull/1063  Full Changelog: https://github.com/alipay/fury/compare/v0.2.1...v0.3.0 ","version":null,"tagName":"h2"},{"title":"Fury 0.5.1 Released","type":0,"sectionRef":"#","url":"/blog/fury_0_5_1_release","content":"","keywords":"","version":null},{"title":"Feature‚Äã","type":1,"pageTitle":"Fury 0.5.1 Released","url":"/blog/fury_0_5_1_release#feature","content":" feat(spec): remove list/map header from type meta spec by @chaokunyang in https://github.com/apache/fury/pull/1590perf(java): Reduce performance regression caused by deleteCharAt by @LiangliangSui in https://github.com/apache/fury/pull/1591feat(java): type meta encoding for java by @chaokunyang in https://github.com/apache/fury/pull/1556 and https://github.com/apache/fury/pull/1601feat(sepc): update type meta field info spec by @chaokunyang in https://github.com/apache/fury/pull/1603feat(javascript): add data to description util by @bytemain in https://github.com/apache/fury/pull/1609feat(java): Support CopyOnWriteArrayListSerializer by @MrChang0 in https://github.com/apache/fury/pull/1613feat(java): add blocked stream utils by @chaokunyang in https://github.com/apache/fury/pull/1617feat(go/java): Add ASCII check before meta string encoding by @jasonmokk in https://github.com/apache/fury/pull/1620feat(java): register old version guava collect by @MrChang0 in https://github.com/apache/fury/pull/1622feat(java): support deserialization ignoreEnumDeserializeError by @157152688 in https://github.com/apache/fury/pull/1623feat(java): add set serializer for concurrent set by @MrChang0 in https://github.com/apache/fury/pull/1616feat(java): add custom serializer register in case of special serializer ctr by @MrChang0 in https://github.com/apache/fury/pull/1625feat(java): remove soft/weak ref values from thread safe fury by @chaokunyang in https://github.com/apache/fury/pull/1639refactor(java): Remove Guava's Collection usages by @Munoon in https://github.com/apache/fury/pull/1611 and https://github.com/apache/fury/pull/1614refactor(java): replace Guava's string utility methods with own implementation by @Munoon in https://github.com/apache/fury/pull/1624  ","version":null,"tagName":"h2"},{"title":"Bug Fix‚Äã","type":1,"pageTitle":"Fury 0.5.1 Released","url":"/blog/fury_0_5_1_release#bug-fix","content":" fix(java): compatible low version guava by @MrChang0 in https://github.com/apache/fury/pull/1593 and https://github.com/apache/fury/pull/1594fix(java): fix getClassDef thead safety by @chaokunyang in https://github.com/apache/fury/pull/1597fix(java): remove maven groupId change by @chaokunyang in https://github.com/apache/fury/pull/1602fix(java): make slf4j provided by @chaokunyang in https://github.com/apache/fury/pull/1605fix(java): clear serializer for collection/map by @chaokunyang in https://github.com/apache/fury/pull/1606fix(java): fix TypeRef getSubType by @chaokunyang in https://github.com/apache/fury/pull/1608fix(java): fix fastutil Object2ObjectOpenHashMap serialization by @chaokunyang in https://github.com/apache/fury/pull/1618fix(java): subclass without fields will encode superclass by @MrChang0 in https://github.com/apache/fury/pull/1626fix(java): fix wildcard capturer capture NullPointerException by @chaokunyang in https://github.com/apache/fury/pull/1637fix(java): fix abstract collection elems same type serialization by @chaokunyang in https://github.com/apache/fury/pull/1641fix(java): ThreadPoolFury#factoryCallback don't work when create new classLoaderFuryPooled by @MrChang0 in https://github.com/apache/fury/pull/1628fix(go/java): Enhance ASCII check in meta string encoding by @jasonmokk in https://github.com/apache/fury/pull/1631  ","version":null,"tagName":"h2"},{"title":"Misc‚Äã","type":1,"pageTitle":"Fury 0.5.1 Released","url":"/blog/fury_0_5_1_release#misc","content":" chore(java): move tests to meta/reflect pkg by @chaokunyang in https://github.com/apache/fury/pull/1592chore(java): make enum serializer as an upper level class by @chaokunyang in https://github.com/apache/fury/pull/1598chore: bump dev version to 0.6.0 by @chaokunyang in https://github.com/apache/fury/pull/1599chore: Fury header add language field by @LiangliangSui in https://github.com/apache/fury/pull/1612chore(java): rename deserializeUnexistentEnumValueAsNull to deserializeNonexistentAsNull by @chaokunyang in https://github.com/apache/fury/pull/1634chore(java): remove gpg pinentry-mode by @chaokunyang in https://github.com/apache/fury/pull/1636  ","version":null,"tagName":"h2"},{"title":"New Contributors‚Äã","type":1,"pageTitle":"Fury 0.5.1 Released","url":"/blog/fury_0_5_1_release#new-contributors","content":" @MrChang0 made their first contribution in https://github.com/apache/fury/pull/1594@jasonmokk made their first contribution in https://github.com/apache/fury/pull/1620@157152688 made their first contribution in https://github.com/apache/fury/pull/1623  Full Changelog: https://github.com/apache/fury/compare/v0.5.0...v0.5.1 ","version":null,"tagName":"h2"},{"title":"Fury v0.5.0 Released","type":0,"sectionRef":"#","url":"/blog/fury_0_5_0_release","content":"","keywords":"","version":null},{"title":"New Features‚Äã","type":1,"pageTitle":"Fury v0.5.0 Released","url":"/blog/fury_0_5_0_release#new-features","content":" ","version":null,"tagName":"h2"},{"title":"Specification‚Äã","type":1,"pageTitle":"Fury v0.5.0 Released","url":"/blog/fury_0_5_0_release#specification","content":" Introduced fury cross-language serialization specification (#1413, #1508)Introduced xlang type mapping (#1468)Introduced fury java specification (#1240)Introduced meta string encoding specification (#1565, #1513, #1517)  ","version":null,"tagName":"h3"},{"title":"Java‚Äã","type":1,"pageTitle":"Fury v0.5.0 Released","url":"/blog/fury_0_5_0_release#java","content":" Support for compatible mode with GraalVM (#1586, #1587).Support unexisted array/enum classes and enabled deserializeUnexistedClass by default (#1569, #1575).meta string encoding algorithm in java (#1514, #1568, #1516, #1565)Support meta string encoding for classname and package name (#1527)native streaming mode deserialization (#1451, #1551)native channel stream reader (#1483)Support registration in thread safe fury (#1280)Implement fury logger and remove slf4j library (#1485, #1494, #1506, #1492)Support adjust logger level dynamically (#1557)Support jdk proxy serialization for graalvm (#1379)Specify JPMS module names (#1343)Align string array to collection protocol v2 (#1228)  ","version":null,"tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Fury v0.5.0 Released","url":"/blog/fury_0_5_0_release#javascript","content":" Align implementation to new Xlang protocol (#1487)Implement Xlang map (#1549)Implemented xlang map code generator (#1571)Added magic number feature for better serialization control (#1550).Support oneof (#1348)create zero-copy buffer when convert (#1386)Implement the collection protocol (#1337)Implement Enum (#1321)compress numbers (#1290)  ","version":null,"tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Fury v0.5.0 Released","url":"/blog/fury_0_5_0_release#c","content":" Support optional fields/elements in RowEncoder (#1223)Support mapping types for RowEncodeTrait (#1247)  ","version":null,"tagName":"h3"},{"title":"Golang‚Äã","type":1,"pageTitle":"Fury v0.5.0 Released","url":"/blog/fury_0_5_0_release#golang","content":" Implemented Fury meta string encoding algorithm (#1566).concat meta string len with flags (#1517)  ","version":null,"tagName":"h3"},{"title":"Enhancements‚Äã","type":1,"pageTitle":"Fury v0.5.0 Released","url":"/blog/fury_0_5_0_release#enhancements","content":" ","version":null,"tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Fury v0.5.0 Released","url":"/blog/fury_0_5_0_release#java-1","content":" Improved buffer growth strategy to support larger data sizes for serialization (#1582).Performance optimizations for MetaStringDecoder and various serialization processes (#1568, #1511, #1493).concat write classname flag with package name (#1523)concat meta string len with flags (#1517)fastpath for read/write small varint in range [0,127] (#1503)optimize read float/double for jvm jit inline (#1472)replace Guava's TypeToken with self-made (#1553)Remove basic guava API usage (#1244)optimize fury creation speed (#1511)optimize string serialization by concat coder and length (#1486)carry read objects when deserialization fail for better trouble shooting (#1420)implement define_class insteadof using javaassist (#1422)avoid recompilation when gc happens for memory pressure (#1411, #1585)Fix immutable collection ref tracking (#1403)reduce fury caller stack (#1496)Extract BaseFury interface (#1382)refine collection builder util (#1334)disable async compilation for graalvm (#1222)refine endian check code size in buffer (#1501)generate list fori loop instead of iterator loop for list serialization (#1493)Reduce unsafeWritePositiveVarLong bytecode size. (#1491)Reduce unsafePutPositiveVarInt bytecode size. (#1490, #1489)optimize read char/short jvm jit inline (#1471)reduce code size of read long to optimize jvm jit inline (#1470)reduce readInt/readVarInt code size for for jvm jit inline (#1469)refactor readVarUint32 algorithm (#1462)rewrite readVarUint64 algorithm (#1463)  ","version":null,"tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Fury v0.5.0 Released","url":"/blog/fury_0_5_0_release#javascript-1","content":" Make PlatformBuffer available if has Buffer polyfill (#1373)enhance performance 64bits number (#1320)Refactor &amp; Compress Long (#1313)Improve tag write performance (#1241)Add more methods for BinaryReader (#1231)Implements tuple serializer (#1216)  ","version":null,"tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Fury v0.5.0 Released","url":"/blog/fury_0_5_0_release#python","content":" concat meta string len with flags (#1517)  ","version":null,"tagName":"h3"},{"title":"Bug Fix‚Äã","type":1,"pageTitle":"Fury v0.5.0 Released","url":"/blog/fury_0_5_0_release#bug-fix","content":" Java‚Äã  Fix bytebuffer no such method error (#1580)Prevent exception in ObjectArray.clearObjectArray() (#1573)Fix slf4j on graalvm (#1432)Fix illegal classname caused by negative hash (#1436)Fix BigDecimal serializer (#1431)Fix BigInteger serialization (#1479)Fix type conflict in method split (#1371)Fix CodeGen Name conflicts when omitting java.lang prefix #1363 (#1366)Fix ClassLoader npe in loadOrGenCodecClass (#1346)Fix big buffer trunc (#1402)Make Blacklist detection is also performed when the Class is registered. (#1398)avoid big object graph cause buffer take up too much memory (#1397)Fix get static field by unsafe (#1380)Fix javax package for accessor codegen (#1388)Fix nested collection cast for scala/java (#1333)Fix References within InvocationHandler (#1365)Allow partial read of serialized size from InputStream (#1391)add potential missing bean class-loader (#1381)Fix polymorphic array serialization (#1324)Fix nested collection num elements (#1306)Fix collection init size typo (#1342)Clear extRegistry.getClassCtx if generate serializer class failed (#1221)  Rust‚Äã  Fix memory errors caused by casting (#1372)Fix incorrect cast (#1345)  ","version":null,"tagName":"h3"},{"title":"Miscellaneous‚Äã","type":1,"pageTitle":"Fury v0.5.0 Released","url":"/blog/fury_0_5_0_release#miscellaneous","content":" Numerous code cleanups, refactorings, and internal improvements across all supported languages to enhance code quality and maintainability.Moved various utilities into more appropriate packages to improve code organization and readability (#1584, #1583, #1578).rename MemoryBuffer read/write/put/getType with read/write/put/getTypeNumber (#1480, #1464, #1505, #1500)extract public Fury methods to BaseFury (#1467)Optimize Class ID allocation. (#1406)refine Collection util data structure (#1287) (#1288)Improve Status by using unique_ptr (#1234)Improve FormatTimePoint by removing sstream (#1233)Drop optional chaining expression (#1338)  ","version":null,"tagName":"h2"},{"title":"New Contributors‚Äã","type":1,"pageTitle":"Fury v0.5.0 Released","url":"/blog/fury_0_5_0_release#new-contributors","content":" @nandakumar131 made their first contribution in https://github.com/apache/fury/pull/1244@vesense made their first contribution in https://github.com/apache/fury/pull/1260@LiangliangSui made their first contribution in https://github.com/apache/fury/pull/1294@liuxiaocs7 made their first contribution in https://github.com/apache/fury/pull/1312@mtf90 made their first contribution in https://github.com/apache/fury/pull/1343@bowin made their first contribution in https://github.com/apache/fury/pull/1353@cn-at-osmit made their first contribution in https://github.com/apache/fury/pull/1366@Maurice-Betzel made their first contribution in https://github.com/apache/fury/pull/1381@phogh made their first contribution in https://github.com/apache/fury/pull/1391@laglangyue made their first contribution in https://github.com/apache/fury/pull/1415@Munoon made their first contribution in https://github.com/apache/fury/pull/1467@pixeeai made their first contribution in https://github.com/apache/fury/pull/1559@huisman6 made their first contribution in https://github.com/apache/fury/pull/1572@tommyettinger made their first contribution in https://github.com/apache/fury/pull/1573@qingoba made their first contribution in https://github.com/apache/fury/pull/1566  ","version":null,"tagName":"h2"},{"title":"Acknowledgements‚Äã","type":1,"pageTitle":"Fury v0.5.0 Released","url":"/blog/fury_0_5_0_release#acknowledgements","content":" Thanks @chaokunyang @theweipeng @PragmaTwice @LiangliangSui @nandakumar131 @Munoon @qingoba @vesense @liuxiaocs7 @mtf90 @bowin @cn-at-osmit @Maurice-Betzel @phogh @laglangyue @tommyettinger @huisman6 @pixeeai  A big thank you to all our contributors who have worked hard on this release. Your contributions, whether through code, documentation, or issue reporting, are really appreciated.  Full Changelog: https://github.com/apache/fury/compare/v0.4.1...v0.5.0 ","version":null,"tagName":"h2"},{"title":"Fury v0.7.0 Released","type":0,"sectionRef":"#","url":"/blog/fury_0_7_0_release","content":"","keywords":"","version":null},{"title":"High Light‚Äã","type":1,"pageTitle":"Fury v0.7.0 Released","url":"/blog/fury_0_7_0_release#high-light","content":" ","version":null,"tagName":"h2"},{"title":"Experimental‚Äã","type":1,"pageTitle":"Fury v0.7.0 Released","url":"/blog/fury_0_7_0_release#experimental","content":" Implement fast object deep copy framework for java:  Fury fury = Fury.builder().withRefCopy(true).build(); fury.register(SomeClass.class); SomeClass a = xxx; SomeClass copied = fury.copy(a);   Benchmark result:  Benchmark\tobjectType\tScore\tError\tUnitsfury_copy\tMEDIA_CONTENT\t1243297.690\t¬± 451828.452\tops/s fury_copy\tSAMPLE\t2670545.816\t¬± 1378536.021\tops/s fury_copy\tSTRUCT\t2673356.422\t¬± 202288.322\tops/s fury_copy\tSTRUCT2\t1943587.774\t¬± 392513.707\tops/s fury_copy_int_map\tint map\t1470264.733\t¬± 1021875.257\tops/s fury_copy_list\tint list\t3556892.276\t¬± 127410.724\tops/s fury_copy_object_array\tarray\t4430589.112\t¬± 25366.893\tops/s fury_copy_string_map\tstring map\t1736145.327\t¬± 377806.877\tops/s kryo_copy\tMEDIA_CONTENT\t804208.092\t¬± 27429.069\tops/s kryo_copy\tSAMPLE\t717669.608\t¬± 71093.370\tops/s kryo_copy\tSTRUCT\t1076048.642\t¬± 223194.146\tops/s kryo_copy\tSTRUCT2\t141374.767\t¬± 14150.535\tops/s kryo_copy_int_map\tint map\t546203.187\t¬± 54669.173\tops/s kryo_copy_list\tint list\t843643.496\t¬± 312306.921\tops/s kryo_copy_object_array\tobject array\t1593267.344\t¬± 1721824.436\tops/s kryo_copy_string_map\tstring map\t574809.875\t¬± 47316.340\tops/s  ","version":null,"tagName":"h3"},{"title":"Features‚Äã","type":1,"pageTitle":"Fury v0.7.0 Released","url":"/blog/fury_0_7_0_release#features","content":" feat(Rust): add meta string encoding algorithm in Rust by @urlyy in https://github.com/apache/fury/pull/1712feat(Rust): Implement utf16 to utf8 conversion algorithm by @urlyy in https://github.com/apache/fury/pull/1730perf(java): add struct benchmark with pb by @chaokunyang in https://github.com/apache/fury/pull/1736feat(java): fast object copy framework in fury java by @zhaommmmomo in https://github.com/apache/fury/pull/1701perf(java): optimize pojo copy performance by @chaokunyang in https://github.com/apache/fury/pull/1739feat(java): support jdk17+ record copy by @chaokunyang in https://github.com/apache/fury/pull/1741feat(RUST): String detection is performed using SIMD techniques by @kitty-eu-org in https://github.com/apache/fury/pull/1752feat(java): Add 'Expose' annotation to support &quot;only de/serialize annotated fields&quot; by @urlyy in https://github.com/apache/fury/pull/1751feat(java): support Ignore inconsistent types deserialize by @weijiang157152688 in https://github.com/apache/fury/pull/1737perf(java): optimize map copy perf by @chaokunyang in https://github.com/apache/fury/pull/1767perf(java): optimize list copy perf by @chaokunyang in https://github.com/apache/fury/pull/1769perf(java): optimize object array copy perf by @chaokunyang in https://github.com/apache/fury/pull/1770feat(java): support deep ref copy by @chaokunyang in https://github.com/apache/fury/pull/1771  ","version":null,"tagName":"h2"},{"title":"Bug Fix‚Äã","type":1,"pageTitle":"Fury v0.7.0 Released","url":"/blog/fury_0_7_0_release#bug-fix","content":" fix(java): fix janino commons classes issue by @chaokunyang in https://github.com/apache/fury/pull/1753fix(scala): fix scala release version by @chaokunyang in https://github.com/apache/fury/pull/1756fix(java): fix streaming classdef read by @chaokunyang in https://github.com/apache/fury/pull/1758fix(java): fix big buffer streaming MetaShared read offset by @chaokunyang in https://github.com/apache/fury/pull/1760fix(java): fix fury logger npe by @chaokunyang in https://github.com/apache/fury/pull/1762fix(java): fix enum abstract field serialization by @chaokunyang in https://github.com/apache/fury/pull/1765fix(java): Fix memory leak in StructSerializer.xread() caused by re-pushing instead of popping GenericType. by @komamitsu in https://github.com/apache/fury/pull/1768  ","version":null,"tagName":"h2"},{"title":"Other Improvements‚Äã","type":1,"pageTitle":"Fury v0.7.0 Released","url":"/blog/fury_0_7_0_release#other-improvements","content":" chore: Update case in DISCLAIMER by @pjfanning in https://github.com/apache/fury/pull/1746chore: bump dev version to 0.7.0 by @chaokunyang in https://github.com/apache/fury/pull/1755chore(java): rename copyTrackingRef to copyRef by @chaokunyang in https://github.com/apache/fury/pull/1748chore(java): add fury deep copy documentation by @chaokunyang in https://github.com/apache/fury/pull/1773  ","version":null,"tagName":"h2"},{"title":"New Contributors‚Äã","type":1,"pageTitle":"Fury v0.7.0 Released","url":"/blog/fury_0_7_0_release#new-contributors","content":" @urlyy made their first contribution in https://github.com/apache/fury/pull/1712@zhaommmmomo made their first contribution in https://github.com/apache/fury/pull/1701@kitty-eu-org made their first contribution in https://github.com/apache/fury/pull/1752@komamitsu made their first contribution in https://github.com/apache/fury/pull/1768  Full Changelog: https://github.com/apache/fury/compare/v0.6.0...v0.7.0  ","version":null,"tagName":"h2"},{"title":"Acknowledgements‚Äã","type":1,"pageTitle":"Fury v0.7.0 Released","url":"/blog/fury_0_7_0_release#acknowledgements","content":" Thanks @komamitsu @pjfanning @chaokunyang @weijiang157152688 @kitty-eu-org @urlyy @zhaommmmomo A big thank you to all our contributors who have worked hard on this release. Your contributions, whether through code, documentation, or issue reporting, are really appreciated.  Full Changelog: https://github.com/apache/fury/compare/v0.6.0...v0.7.0 ","version":null,"tagName":"h2"},{"title":"Fury v0.7.1 Released","type":0,"sectionRef":"#","url":"/blog/fury_0_7_1_release","content":"","keywords":"","version":null},{"title":"Features‚Äã","type":1,"pageTitle":"Fury v0.7.1 Released","url":"/blog/fury_0_7_1_release#features","content":" feat(javascript): Added MetaString Class for Unicode Encoding/Decoding in Type.Object Code Generation by @Forchapeatl in https://github.com/apache/fury/pull/1774feat(Rust): Refine Code Structure &amp; Prepare for Future Compatibility Features by @theweipeng in https://github.com/apache/fury/pull/1787feat(java): ThreadSafeFury add getClassResolver method by @funky-eyes in https://github.com/apache/fury/pull/1780feat(Rust): Implement TypeMeta part of the compatibility features by @theweipeng in https://github.com/apache/fury/pull/1789feat(Rust): Support polymorphism by @theweipeng in https://github.com/apache/fury/pull/1795feat(java): Support copy capabilities for some classes without no-argument constructors by @zhaommmmomo in https://github.com/apache/fury/pull/1794feat(java): support jdk9+ java.util.ImmutableCollections copy by @zhaommmmomo in https://github.com/apache/fury/pull/1800feat(rust): support enum serialization by @jiacai2050 in https://github.com/apache/fury/pull/1817refine fury website and add chinese documents by @yuluo-yx and @LofiSu  ","version":null,"tagName":"h2"},{"title":"Bug Fix‚Äã","type":1,"pageTitle":"Fury v0.7.1 Released","url":"/blog/fury_0_7_1_release#bug-fix","content":" ci: fix rust ci failed by @LiangliangSui in https://github.com/apache/fury/pull/1783fix(java): fix classloader get npe by @chaokunyang in https://github.com/apache/fury/pull/1792fix(scala): fix nested type serialization in scala object type by @chaokunyang in https://github.com/apache/fury/pull/1809fix(java): Fix replace resolver serializaiton by @chaokunyang in https://github.com/apache/fury/pull/1812fix(java): fix reserved keyword conflict by @chaokunyang in https://github.com/apache/fury/pull/1819fix(java): fix nested map field value serialization by private map serializer by @chaokunyang in https://github.com/apache/fury/pull/1820fix(rust): use iter to avoid reallocate by @jiacai2050 in https://github.com/apache/fury/pull/1821  ","version":null,"tagName":"h2"},{"title":"Other Improvements‚Äã","type":1,"pageTitle":"Fury v0.7.1 Released","url":"/blog/fury_0_7_1_release#other-improvements","content":" chore(java): Disallow writing meta classdef when obj is null by @LiangliangSui in https://github.com/apache/fury/pull/1686chore(infra): optimize github tmpl &amp; update actions/checkout version to 4.1.7 by @yuluo-yx in https://github.com/apache/fury/pull/1807chore(infra): remove redundant bug reporting options by @yuluo-yx in https://github.com/apache/fury/pull/1810docs: add check lint ci &amp; fix md lint by @yuluo-yx in https://github.com/apache/fury/pull/1811  ","version":null,"tagName":"h2"},{"title":"New Contributors‚Äã","type":1,"pageTitle":"Fury v0.7.1 Released","url":"/blog/fury_0_7_1_release#new-contributors","content":" @Forchapeatl made their first contribution in https://github.com/apache/fury/pull/1774@funky-eyes made their first contribution in https://github.com/apache/fury/pull/1780@yuluo-yx made their first contribution in https://github.com/apache/fury/pull/1807  Full Changelog: https://github.com/apache/fury/compare/v0.7.0...v0.7.1  ","version":null,"tagName":"h2"},{"title":"Acknowledgements‚Äã","type":1,"pageTitle":"Fury v0.7.1 Released","url":"/blog/fury_0_7_1_release#acknowledgements","content":" Thanks @jiacai2050 @chaokunyang @theweipeng @funky-eyes @Forchapeatl @zhaommmmomo @yuluo-yx @LiangliangSui @LofiSu  A big thank you to all our contributors who have worked hard on this release. Your contributions, whether through code, documentation, or issue reporting, are really appreciated. ","version":null,"tagName":"h2"},{"title":"Fury v0.9.0 Released","type":0,"sectionRef":"#","url":"/blog/fury_0_9_0_release","content":"","keywords":"","version":null},{"title":"Highlight‚Äã","type":1,"pageTitle":"Fury v0.9.0 Released","url":"/blog/fury_0_9_0_release#highlight","content":" Optimized serializers for Fury kotlin supportHighly-optimized UTF-8 string encoding implementation for Java(2x faster than JDK utf8 encoding)Reduce metastring hashcode payload for small string(&lt;=16 bytes)Support building C++ libs on windows platform  ","version":null,"tagName":"h2"},{"title":"Features‚Äã","type":1,"pageTitle":"Fury v0.9.0 Released","url":"/blog/fury_0_9_0_release#features","content":" feat(kotlin): Introduce kotlin package with stdlib collections and tests by @wywen in https://github.com/apache/fury/pull/1877feat(kotlin): Add Unsigned Primitive Support by @wywen in https://github.com/apache/fury/pull/1886feat(kotlin): Add unsigned array support and tests for arrays and strings by @wywen in https://github.com/apache/fury/pull/1891feat(java): Refactor String serialization and deserialization by @HuangXingBo in https://github.com/apache/fury/pull/1890feat(java): support thread safe register callback for scala kotlin by @chaokunyang in https://github.com/apache/fury/pull/1895feat(scala): add scala range serializer by @chaokunyang in https://github.com/apache/fury/pull/1899feat(java): add option to treat enum as string by @orisgarno in https://github.com/apache/fury/pull/1892feat(kotlin): Add tests and support for built-in types from the kotlin stdlib by @wywen in https://github.com/apache/fury/pull/1901feat(java): reduce metastring hashcode payload for small string(&lt;=16 bytes) by @chaokunyang in https://github.com/apache/fury/pull/1909feat(javascript): Added serialization and serialization for Type Meta Layer by @Forchapeatl in https://github.com/apache/fury/pull/1825feat(bazel): support building C++ libs on windows platform by @An-DJ in https://github.com/apache/fury/pull/1873feat(scala): support scala native image build by @chaokunyang in https://github.com/apache/fury/pull/1922perf(python): Add python benchmark test by @penguin-wwy in https://github.com/apache/fury/pull/1916  ","version":null,"tagName":"h2"},{"title":"Bug Fix‚Äã","type":1,"pageTitle":"Fury v0.9.0 Released","url":"/blog/fury_0_9_0_release#bug-fix","content":" fix(scala): ban these sbt commands by @pjfanning in https://github.com/apache/fury/pull/1862fix(java): fix async compilation switch for non-public nested class by @chaokunyang in https://github.com/apache/fury/pull/1883fix(java): fix add fury thread safety issue by @chaokunyang in https://github.com/apache/fury/pull/1889fix(other): fix feature request template by @chaokunyang in https://github.com/apache/fury/pull/1898fix(java): NonExistentEnum on mode serializeEnumByName by @orisgarno in https://github.com/apache/fury/pull/1904fix(java): ThreadLocalFury and ThreadPoolFury prioritize using the user classloader by @Aliothmoon in https://github.com/apache/fury/pull/1907fix(java): child container deep copy by @zhaommmmomo in https://github.com/apache/fury/pull/1911fix(java): Fix incorrect results of utf16 to utf8 conversion for latin1 but not ascii characters in https://github.com/apache/fury/pull/1914fix(python): Eliminate PytestCollectionWarning when running pytest by @penguin-wwy in https://github.com/apache/fury/pull/1917  ","version":null,"tagName":"h2"},{"title":"Other Improvements‚Äã","type":1,"pageTitle":"Fury v0.9.0 Released","url":"/blog/fury_0_9_0_release#other-improvements","content":" chore(py314): Replace deprecated pkgutil.find_loader by @effigies in https://github.com/apache/fury/pull/1888docs(guide): Fix package typo by @mandrean in https://github.com/apache/fury/pull/1906build(kotlin): Add spotless ktfmt and enable explicit api mode for library code. by @wywen in https://github.com/apache/fury/pull/1912build(deps): upgrade scala (2.13.15/3.3.4) by @pjfanning in https://github.com/apache/fury/pull/1861feat(rust): add rust-analyzer to toolchain by @caicancai in https://github.com/apache/fury/pull/1865chore(scala): add scala build script by @chaokunyang in https://github.com/apache/fury/pull/1920chore(kotlin): add parent pom for fury kotlin by @chaokunyang in https://github.com/apache/fury/pull/1921feat(java): Improve error message on architecture not using little-endian format by @apupier in https://github.com/apache/fury/pull/1918  ","version":null,"tagName":"h2"},{"title":"New Contributors‚Äã","type":1,"pageTitle":"Fury v0.9.0 Released","url":"/blog/fury_0_9_0_release#new-contributors","content":" @An-DJ made their first contribution in https://github.com/apache/fury/pull/1873@wywen made their first contribution in https://github.com/apache/fury/pull/1877@effigies made their first contribution in https://github.com/apache/fury/pull/1888@HuangXingBo made their first contribution in https://github.com/apache/fury/pull/1890@orisgarno made their first contribution in https://github.com/apache/fury/pull/1892@mandrean made their first contribution in https://github.com/apache/fury/pull/1906@Aliothmoon made their first contribution in https://github.com/apache/fury/pull/1907@penguin-wwy made their first contribution in https://github.com/apache/fury/pull/1916@apupier made their first contribution in https://github.com/apache/fury/pull/1918  Full Changelog: https://github.com/apache/fury/compare/v0.8.0...v0.9.0  ","version":null,"tagName":"h2"},{"title":"Acknowledgements‚Äã","type":1,"pageTitle":"Fury v0.9.0 Released","url":"/blog/fury_0_9_0_release#acknowledgements","content":" Thanks @effigies @apupier @wywen @mandrean @HuangXingBo @pjfanning @chaokunyang @penguin-wwy @An-DJ @Forchapeatl @orisgarno @zhaommmmomo @caicancai @Aliothmoon  A big thank you to all our contributors who have worked hard on this release. Your contributions, whether through code, documentation, or issue reporting, are really appreciated. ","version":null,"tagName":"h2"},{"title":"Fury v0.8.0 Released","type":0,"sectionRef":"#","url":"/blog/fury_0_8_0_release","content":"","keywords":"","version":null},{"title":"Highlights‚Äã","type":1,"pageTitle":"Fury v0.8.0 Released","url":"/blog/fury_0_8_0_release#highlights","content":" Support graalvm 17/21/22 native imageRelease fury optimized serializers for scala collectionReduce scala collection classname serialization cost using dict encoding  ","version":null,"tagName":"h2"},{"title":"Features‚Äã","type":1,"pageTitle":"Fury v0.8.0 Released","url":"/blog/fury_0_8_0_release#features","content":" refactor(rust): simplify error handle by @jiacai2050 in https://github.com/apache/fury/pull/1823feat(java): support graalvm 17/21/22 by @chaokunyang in https://github.com/apache/fury/pull/1845perf(java): inline same element invoke in jit by @chaokunyang in https://github.com/apache/fury/pull/1851perf(java): optimize read classdef perf by @chaokunyang in https://github.com/apache/fury/pull/1852feat(scala): optimize scala class serialization by @chaokunyang in https://github.com/apache/fury/pull/1853feat(java): implement sublist serializers by @chaokunyang in https://github.com/apache/fury/pull/1856feat(java): use SubListViewSerializer only when tracking ref by @chaokunyang in https://github.com/apache/fury/pull/1858  ","version":null,"tagName":"h2"},{"title":"Bug Fix‚Äã","type":1,"pageTitle":"Fury v0.8.0 Released","url":"/blog/fury_0_8_0_release#bug-fix","content":" fix(java): DeserializationException#getMessage call by @yoohaemin in https://github.com/apache/fury/pull/1830fix(java): fix collection view serialization by @chaokunyang in https://github.com/apache/fury/pull/1833fix(java): fix long type name meta string encoding by @chaokunyang in https://github.com/apache/fury/pull/1837fix(java): fix serializer factory getSerializerClass by @chaokunyang in https://github.com/apache/fury/pull/1836fix(rust): replace (value &lt;&lt; 8) | (value &gt;&gt; 8) with value.rotate_right(8) by @chaokunyang in https://github.com/apache/fury/pull/1841fix(java): Fix for maximum size of java arrays by @fink-arthur in https://github.com/apache/fury/pull/1843fix(java): Fix max Java array size for reader by @fink-arthur in https://github.com/apache/fury/pull/1844fix(java): fix jdk proxy serialization when proxy writeReplace method by @chaokunyang in https://github.com/apache/fury/pull/1857  ","version":null,"tagName":"h2"},{"title":"Other Improvements‚Äã","type":1,"pageTitle":"Fury v0.8.0 Released","url":"/blog/fury_0_8_0_release#other-improvements","content":" chore(java): fix default value doc for metaShareEnabled/scopedMetaShareEnabled by @chaokunyang in https://github.com/apache/fury/pull/1826chore(doc): fix 'how to upgrade fury' link in README by @sh-cho in https://github.com/apache/fury/pull/1846build(deps): bump com.google.protobuf:protobuf-java from 3.16.3 to 3.25.5 in /java/benchmark by @dependabot in https://github.com/apache/fury/pull/1847chore(java): simplify generated codec name by @chaokunyang in https://github.com/apache/fury/pull/1850ci: only run sync job if the repo is apache/fury by @pjfanning in https://github.com/apache/fury/pull/1860feat(scala): upgrade sbt and sbt-apache-sonatype by @pjfanning in https://github.com/apache/fury/pull/1859  ","version":null,"tagName":"h2"},{"title":"New Contributors‚Äã","type":1,"pageTitle":"Fury v0.8.0 Released","url":"/blog/fury_0_8_0_release#new-contributors","content":" @yoohaemin made their first contribution in https://github.com/apache/fury/pull/1830@fink-arthur made their first contribution in https://github.com/apache/fury/pull/1843@sh-cho made their first contribution in https://github.com/apache/fury/pull/1846  Full Changelog: https://github.com/apache/fury/compare/v0.7.1...v0.8.0  ","version":null,"tagName":"h2"},{"title":"Acknowledgements‚Äã","type":1,"pageTitle":"Fury v0.8.0 Released","url":"/blog/fury_0_8_0_release#acknowledgements","content":" Thanks @jiacai2050 @fink-arthur @sh-cho @pjfanning @chaokunyang @yoohaemin  A big thank you to all our contributors who have worked hard on this release. Your contributions, whether through code, documentation, or issue reporting, are really appreciated. ","version":null,"tagName":"h2"},{"title":"Fury 0.6.0 Released","type":0,"sectionRef":"#","url":"/blog/fury_0_6_0_release","content":"","keywords":"","version":null},{"title":"High light‚Äã","type":1,"pageTitle":"Fury 0.6.0 Released","url":"/blog/fury_0_6_0_release#high-light","content":" In this release, we introduced a scoped meta share mode for schema evolution in java and enabled it by default when CompatibleMode is set to Compatible:  This mode is 50% faster than previous KV compatible mode, and only 1/6 size of serialized payload than before.It's 4x faster than protobuf, less than 1/2 serialized size of protobuf for complex object.    Protobuf/JSON will write message fields meta and values in a KV layout, so when serializzing a list of message, they will have two issues:  Write meta multiple times even those message are the same type.KV layout is dispersive, which is not friendly for compression.  The meta share mode will write field name&amp;type meta of a struct only once for multiple objects of same type, which will save space and improve performance comparedto protobuf.  With meta share, we can write field name&amp;type meta of a struct only once for multiple objects of same type, which will save space and improve performance comparedto protobuf. And we can also encode the meta into binary in advance, and use one memory copy to write it which will be much faster.  ","version":null,"tagName":"h2"},{"title":"Serialize data‚Äã","type":1,"pageTitle":"Fury 0.6.0 Released","url":"/blog/fury_0_6_0_release#serialize-data","content":"  public static class NumericStruct { public int f1; public int f2; public int f3; public int f4; public int f5; public int f6; public int f7; public int f8; public static NumericStruct build() { NumericStruct struct = new NumericStruct(); struct.f1 = 1; struct.f2 = 2; struct.f3 = 3; struct.f4 = 4; struct.f5 = 5; struct.f6 = 6; struct.f7 = 7; struct.f8 = 8; return struct; } } public static class NumericStructList { public List&lt;NumericStruct&gt; list; public static NumericStructList build() { NumericStructList structList = new NumericStructList(); structList.list = new ArrayList&lt;&gt;(1000); for (int i = 0; i &lt; 1000; i++) { structList.list.add(NumericStruct.build()); } return structList; }   ","version":null,"tagName":"h3"},{"title":"Result‚Äã","type":1,"pageTitle":"Fury 0.6.0 Released","url":"/blog/fury_0_6_0_release#result","content":" Performance:  Benchmark Mode Cnt Score Error Units fury_deserialize thrpt 30 49667.900 ¬± 3004.061 ops/s fury_kv_compatible_deserialize thrpt 30 33014.595 ¬± 3716.199 ops/s fury_kv_compatible_serialize thrpt 30 23915.260 ¬± 3968.119 ops/s fury_serialize thrpt 30 63146.826 ¬± 2930.505 ops/s protobuf_deserialize thrpt 30 14156.610 ¬± 685.272 ops/s protobuf_serialize thrpt 30 10060.293 ¬± 706.064 ops/s   Size:  Lib\tSerialized Payload Sizefury\t8077 furystrict\t8009 furykv\t48028 protobuf\t18000  ","version":null,"tagName":"h3"},{"title":"Feature‚Äã","type":1,"pageTitle":"Fury 0.6.0 Released","url":"/blog/fury_0_6_0_release#feature","content":" feat(java): support nonexistent class deserialization in meta share mode by @chaokunyang in https://github.com/apache/fury/pull/1646feat(java): scoped meta share mode for type forward/backward compaibility by @chaokunyang in https://github.com/apache/fury/pull/1660feat(java): support meta compression by Deflater by @chaokunyang in https://github.com/apache/fury/pull/1663perf(java): Add ClassInfo ClassBytes generation conditions. by @LiangliangSui in https://github.com/apache/fury/pull/1667feat(javascript): use TextDecoder to decode buffer by @bytemain in https://github.com/apache/fury/pull/1699feat(Python): meta string encoding algorithm in Python by @pandalee99 in https://github.com/apache/fury/pull/1702feat(C++): String detection is performed using SIMD techniques by @pandalee99 in https://github.com/apache/fury/pull/1720feat(C++): The use of SIMD accelerated to implement and optimize utf16 utf8 by @pandalee99 in https://github.com/apache/fury/pull/1732feat(java): enable scoped meta share for compatible mode by default by @chaokunyang in https://github.com/apache/fury/pull/1733perf(java): optimize scoped meta share mode perf by @chaokunyang in https://github.com/apache/fury/pull/1734  ","version":null,"tagName":"h2"},{"title":"Bug Fix‚Äã","type":1,"pageTitle":"Fury 0.6.0 Released","url":"/blog/fury_0_6_0_release#bug-fix","content":" chore(doc): fix example by @wangjie-fourth in https://github.com/apache/fury/pull/1657fix(java): fix scala object type codegen by @chaokunyang in https://github.com/apache/fury/pull/1659fix(java): Fix header offset issue in MetaStringBytes hashcode by @LiangliangSui in https://github.com/apache/fury/pull/1668fix(java): return fury to pooled which get from by @MrChang0 in https://github.com/apache/fury/pull/1697fix(doc): codestyle version in python by @pandalee99 in https://github.com/apache/fury/pull/1706fix(java): fix nested map serialization codegen by @chaokunyang in https://github.com/apache/fury/pull/1713fix(java): fix fastjson object serialization by @chaokunyang in https://github.com/apache/fury/pull/1717  ","version":null,"tagName":"h2"},{"title":"Others‚Äã","type":1,"pageTitle":"Fury 0.6.0 Released","url":"/blog/fury_0_6_0_release#others","content":" chore: Add IssueNavigationLink and icon for IDEA by @lvshaokang in https://github.com/apache/fury/pull/1665chore(rust): resolve deprecate warnings by @waynexia in https://github.com/apache/fury/pull/1662chore(doc): fix doc example code by @wangjie-fourth in https://github.com/apache/fury/pull/1666chore(rust): Setup rustfmt and toolchain for rust by @Xuanwo in https://github.com/apache/fury/pull/1677chore(rust): Make rust clippy happy by @Xuanwo in https://github.com/apache/fury/pull/1678chore(doc): add incubating DISCLAIMER by @chaokunyang in https://github.com/apache/fury/pull/1681chore(java): Update github URL in IntelliJ vcs.xml by @pjfanning in https://github.com/apache/fury/pull/1689ci: fix ci error by @LiangliangSui in https://github.com/apache/fury/pull/1691docs: fix badge x by @vesense in https://github.com/apache/fury/pull/1694chore(doc): fix compiler error by @wangjie-fourth in https://github.com/apache/fury/pull/1698refactor(java): move latin language checker method from string serializer to string util by @anagh07 in https://github.com/apache/fury/pull/1708chore(doc): the more complete readme is in python by @pandalee99 in https://github.com/apache/fury/pull/1709build: update scala build by @pjfanning in https://github.com/apache/fury/pull/1725build: publish jars for fury-scala by @pjfanning in https://github.com/apache/fury/pull/1729chore(java): merge reflect.Types into TypeRef by @chaokunyang in https://github.com/apache/fury/pull/1731  ","version":null,"tagName":"h2"},{"title":"New Contributors‚Äã","type":1,"pageTitle":"Fury 0.6.0 Released","url":"/blog/fury_0_6_0_release#new-contributors","content":" @wangjie-fourth made their first contribution in https://github.com/apache/fury/pull/1657@lvshaokang made their first contribution in https://github.com/apache/fury/pull/1665@waynexia made their first contribution in https://github.com/apache/fury/pull/1662@Xuanwo made their first contribution in https://github.com/apache/fury/pull/1677@anagh07 made their first contribution in https://github.com/apache/fury/pull/1708  Full Changelog: https://github.com/apache/fury/compare/v0.5.1...v0.6.0 ","version":null,"tagName":"h2"},{"title":"Apache Fury: A blazing fast multi-language serialization framework powered by JIT and zero-copy","type":0,"sectionRef":"#","url":"/blog/fury_blazing_fast_multiple_language_serialization_framework","content":"","keywords":"","version":null},{"title":"Background‚Äã","type":1,"pageTitle":"Apache Fury: A blazing fast multi-language serialization framework powered by JIT and zero-copy","url":"/blog/fury_blazing_fast_multiple_language_serialization_framework#background","content":" Serialization is a basic component of system communication, and widely used in big data, AI framework, cloud native and other distributed systems. Data transfer between processes, languages, nodes, or object persistence, state read-write and copy, all need serialization. The performance and ease-of-use of serialization affects runtime and development efficiency of the system.  Static serialization frameworks like Protobuf or FlatBuffers cannot be used for cross-language application development directly, because they don't support shared reference and polymorphism, and also need to generate code ahead.  Dynamic serialization frameworks such as JDK serialization, Kryo, Fst, Hessian, Pickle provide ease-of-use and dynamics, but don't support cross-language and suffer significant performance issues, which is unsuitable for high throughput, low latency, and large-scale data transfer scenarios.  Therefore, we developed a new multi-language serialization framework Apache Fury, which is open-sourced on https://github.com/apache/fury. Through highly optimized serialization primitives, JIT dynamic compilation and zero-copy technologies, Fury is both fast and easy-to-use. It can cross-language serialize any object automatically and provides ultimate performance at the same time.    ","version":null,"tagName":"h2"},{"title":"What is Apache Fury?‚Äã","type":1,"pageTitle":"Apache Fury: A blazing fast multi-language serialization framework powered by JIT and zero-copy","url":"/blog/fury_blazing_fast_multiple_language_serialization_framework#what-is-apache-fury","content":" Apache Fury is a multi-language serialization framework powered by JIT dynamic compilation and zero copy, providing blazing fast speed and ease of use:  Multiple languages: Java, Python, C++, Golang, JavaScript, Rust. Other languages can be added easily.Highly optimized serialization primitives.Zero-copy: Support out-of-band serialization and off-heap read/write.High performance: Use JIT to generate serialization code at runtime in an async multithreaded way, which can optimize methods inlining, code cache, dead code elimination, hash lookup, meta writing and memory read/write.Multi protocols: Provide flexibility and ease of use of dynamic serialization, as well as the cross-language of static serialization. Java Serialization: Drop-in replaces JDK, Kryo, and Hessian. No need to modify user code, but providing 170x speed up at most, which can improve efficiency of rpc, data transfer and object persistence significantly.100% JDK compatible, support JDK custom serialization methods writeObject, readObject, writeReplace, readResolve, readObjectNoData natively. Cross-language object graph: Cross-language serialize any objects automatically, no need for IDL, schema compilation, and object/protocol conversion.Cross-language serialize shared/circular reference, no data duplication or recursion error.Support object polymorphism, multiple children type objects can be serialized simultaneously. Row format A cache-friendly binary random-access format, supports skipping deserialization and lazy deserialization, efficient for high-performance computing and large-scale data transfer.Support automatic conversion to Apache Arrow.  ","version":null,"tagName":"h2"},{"title":"Core Serialization Capabilities‚Äã","type":1,"pageTitle":"Apache Fury: A blazing fast multi-language serialization framework powered by JIT and zero-copy","url":"/blog/fury_blazing_fast_multiple_language_serialization_framework#core-serialization-capabilities","content":" Although different scenarios require different serialization protocols, the underlying operations of serialization are similar.  Therefore, Fury defines and implements a set of basic serialization capabilities, which can be used for quickly building new multi-language serialization protocols and get speedup by JIT acceleration and other optimizations.  At the same time, performance optimization for a protocol on the primitives can also benefit all other protocols.  ","version":null,"tagName":"h2"},{"title":"Serialization Primitives‚Äã","type":1,"pageTitle":"Apache Fury: A blazing fast multi-language serialization framework powered by JIT and zero-copy","url":"/blog/fury_blazing_fast_multiple_language_serialization_framework#serialization-primitives","content":" Common serialization operations contains:  Bitmap operationsNumber encoding and decodingCompression for int and longString creation and copyString encoding: ASCII, UTF8, UTF16Memory copyArray copy and compressionMeta encoding, compression, and cache  Fury use SIMD and other advanced language features to make basic operations extremely fast in every languages.  ","version":null,"tagName":"h3"},{"title":"Zero-copy Serialization‚Äã","type":1,"pageTitle":"Apache Fury: A blazing fast multi-language serialization framework powered by JIT and zero-copy","url":"/blog/fury_blazing_fast_multiple_language_serialization_framework#zero-copy-serialization","content":" Large-scale data transfer often has multiple binary buffers in an object graph. Some serialization frameworks will write the binaries into an intermediate buffer and introduce multiple time-consuming memory copies. Fury implemented an out-of-band serialization protocol inspired by pickle5, Ray and Apache Arrow, which can capture all binary buffers in an object graph to avoid intermediate copies of these buffers.  The following figure shows the serialization process of zero-copy:    Currently, Fury supports the following types of zero-copy:  Java: all basic types of arrays, ByteBuffer, ArrowRecordBatch, and VectorSchemaRootPython: all arrays of the array module, numpy arrays, pyarrow.Table, and pyarrow.RecordBatchGolang: byte slice  You can also add the new zero copy type based on the Fury interface.  ","version":null,"tagName":"h3"},{"title":"JIT dynamic compilation acceleration‚Äã","type":1,"pageTitle":"Apache Fury: A blazing fast multi-language serialization framework powered by JIT and zero-copy","url":"/blog/fury_blazing_fast_multiple_language_serialization_framework#jit-dynamic-compilation-acceleration","content":" Custom type objects usually contain lots of type information, Fury used this information to generate efficient serialization code at runtime, which can push lots of runtime operations into the dynamic compilation stage. By inlining more methods, better code cache, reducing virtual method calls, conditional branches, hash lookup, metadata writes, and memory reads/writes, the serialization performance is greatly accelerated.  For Java, Fury implements a runtime codegen framework and defines an operator expression IR. Then fury can perform type inference based on the generic type information of the object at runtime to build an expression tree that describes the logic of serialized code.  The codegen framework will generate efficient Java code from the expression tree, then pass to Janino to compile it into bytecode, and load it into the user's ClassLoader or the ClassLoader created by Fury, and finally compile it into efficient assembly code through Java JIT.  Since JVM JIT skips Big method compilation and inlining, Fury also implements an optimizer to split big methods into small methods recursively, thus ensuring that all code can be compiled and inlined.    Fury also supports asynchronous multithreaded compilation by running the codegen tasks in a thread pool, and using interpretation mode until JIT finishes to ensure no serialization burrs. Users can skip warm up serialization of objects.  Python and JavaScript codegen are similar. Generating source code is easier for development and troubleshooting problems.  Since serialization will manipulate objects extensively in each programming language, and the language does not expose the low-level API of the memory model, native methods call has a large cost too, so we cannot use LLVM to build a unified serializer JIT framework. Instead, we implemented a codegen framework for every language separately.  ","version":null,"tagName":"h3"},{"title":"Static code generation‚Äã","type":1,"pageTitle":"Apache Fury: A blazing fast multi-language serialization framework powered by JIT and zero-copy","url":"/blog/fury_blazing_fast_multiple_language_serialization_framework#static-code-generation","content":" Although JIT compilation can greatly improve serialization efficiency and generate better serialization code based on the statistical distribution of data at runtime, languages like C++ do not support reflection, have no virtual machines, and no low-level API for memory models. We cannot generate serialization code dynamically for such languages through JIT.  In such scenarios, Fury is implementing an AOT codegen framework, which generates the serialized code statically according to the object schema, and objects can be serialized automatically using the generated serializer. For Rust, Rust macro is used to generate code statically.  ","version":null,"tagName":"h3"},{"title":"Cache optimization‚Äã","type":1,"pageTitle":"Apache Fury: A blazing fast multi-language serialization framework powered by JIT and zero-copy","url":"/blog/fury_blazing_fast_multiple_language_serialization_framework#cache-optimization","content":" When serializing a custom type, fury will reorder fields to ensure that fields of the same type are serialized in order. This can hit more data cache and CPU instruction cache.  The basic type fields are written in descending order by byte size. In this way, if the initial addresses are aligned, subsequent read and write operations will occur at the position where the memory addresses are aligned, making CPU execution more efficient.  ","version":null,"tagName":"h3"},{"title":"Multi-protocol Design and Implementation‚Äã","type":1,"pageTitle":"Apache Fury: A blazing fast multi-language serialization framework powered by JIT and zero-copy","url":"/blog/fury_blazing_fast_multiple_language_serialization_framework#multi-protocol-design-and-implementation","content":" Based on the multi-language serialization features provided by Fury core, we have built three serialization protocols for different scenarios:  Java serialization: Suitable for pure Java serialization scenarios and provides up to 170x speed up;Cross-language object graph serialization: Suitable for application-oriented multi-language programming and high-performance cross-language serialization;Row-format serialization: Suitable for distributed computing engines such as Apache Spark, Apache Flink, Apache Doris, Velox, and features frameworks.  In the future, we will add new protocols for other core scenarios. Users can also build their own protocols based on Fury's serialization framework.  ","version":null,"tagName":"h2"},{"title":"Java serialization‚Äã","type":1,"pageTitle":"Apache Fury: A blazing fast multi-language serialization framework powered by JIT and zero-copy","url":"/blog/fury_blazing_fast_multiple_language_serialization_framework#java-serialization","content":" Java is widely used in big data, cloud native, microservices, and enterprise applications. Therefore, Fury made lots of optimizations for Java serialization, which reduces system latency and server costs a lot, and improves throughput significantly. Our implementation has the following highlights:  Blazing fast performance: Based on Java types, JIT compilation and Unsafe low-level operations, Fury is 170x faster than JDK, and 50~110x faster than Kryo/Hessian at most.100% JDK serialization API compatibility : Supports all JDK custom serialization methods writeObject, readObject, writeReplace, readResolve, readObjectNoData natively to ensure the serialization correctness in any scenario. Kryo and Hessian have some correctness issues in these scenarios.Type compatibility: When the deserialization and serialization class schema are inconsistent, it can still deserialize correctly. It supports application upgrade and deployment, add/delete fields independently. Fury type-compatible mode is implemented with no performance loss compared to type-consistent mode.Metadata sharing : share metadata(class name, field name&amp;type, etc.) across multiple serializations under a context (TCP connection), meta will be sent to the peer only for the first serialization, the peer can reconstruct the same deserializer based on this information. Subsequent serialization will skip transferring metadata, which can reduce network traffic, and support type compatibility automatically.Zero-copy support: supports out-of-band zero copy and off-heap memory read and write.  ","version":null,"tagName":"h3"},{"title":"Cross-language object graph serialization‚Äã","type":1,"pageTitle":"Apache Fury: A blazing fast multi-language serialization framework powered by JIT and zero-copy","url":"/blog/fury_blazing_fast_multiple_language_serialization_framework#cross-language-object-graph-serialization","content":" Fury cross-language object graph serialization is primarily used for scenarios that require higher dynamics and ease-of-use.  Although frameworks like Protobuf or FlatBuffers support cross-language serialization, they still have limitations:  They require pre-defined IDLs and generate code statically ahead, lacking sufficient dynamics and flexibility;The generated classes don't conform to object-oriented design and it's impossible to add behavior to classes, which make them unsuitable for use as domain objects in cross-language application development.They don't support polymorphism. Object-oriented programming uses interfaces to invoke subclass methods, but this pattern isn't supported well in those frameworks. Although FlatBuffers offers Union, and Protobuf provides OneOf/Any, those API require check object type during serialization and deserialization, which isn't polymorphic.They don't support circular references and shared references. Users need to define a set of IDLs for domain objects and implement reference resolution by themselves, as well as writing code to convert between domain objects and protocol objects in each language. If the object graph depth is deep, more code needs to be written.  Due to the above limitations, Fury implemented a cross-language object graph serialization protocol that:  Automatically serializes any object across multiple languages: By defining classes in the serialization and deserialization peer, objects in one language can be automatically serialized into objects in another language without creating IDL files, compiling schema to generate code, or writing conversion code.Automatically serializes shared and circular references across multiple languages.Supports object type polymorphism, consistent with the object-oriented programming paradigm, and multiple subtypes can be automatically deserialized without manual intervention.Out-of-band zero-copy is also supported in this protocol.  Example of Automatic Cross-Language Serialization:    ","version":null,"tagName":"h3"},{"title":"Row-format‚Äã","type":1,"pageTitle":"Apache Fury: A blazing fast multi-language serialization framework powered by JIT and zero-copy","url":"/blog/fury_blazing_fast_multiple_language_serialization_framework#row-format","content":" For high-performance computing and large-scale data transfer scenarios, data serialization and transfer are often the performance bottlenecks of the system. If users only need to read part of the data or filter data based on some field of an object, deserializing the entire data will result in unnecessary overhead. Therefore, Fury provides a binary data structure for direct reading and writing on binary data to avoid serialization.  Apache Arrow is a standardized columnar storage format that supports binary read and write. However, columnar format is not suitable for all scenarios. Data in online and streaming computing are naturally stored row by row, and row is also used in columnar computing engines when involving data updates, Hash/Join/Aggregation operations.  However, there is no standardized implementation for row format. Computing engines such as Spark/Flink/Doris/Velox all defined their row format, which doesn't support cross-language and can only be used internally by themselves. FlatBuffers does support lazy deserialization, but it requires static compilation of schema IDL and management of offset, which is impossible for complex scenarios.  Therefore, Fury implemented a binary row format inspired by Spark Tungsten and Apache Arrow format, which allows random access and partial deserialization. Currently, Java/Python/C++ versions have been implemented, allowing direct reading and writing on binary data to avoid all serialization overhead, and can convert to arrow format automatically.    This format is densely stored, byte aligned and cache-friendly, which enables faster read and write operations. By avoiding deserialization, it reduces Java GC pressure and Python overhead. Based on Python's dynamics, Fury's data structure implements special methods such as getattr, getitem, slice, etc., ensuring behavior consistency with Python dataclass, list, object, and users have no perception of this.  ","version":null,"tagName":"h3"},{"title":"Performance Comparison‚Äã","type":1,"pageTitle":"Apache Fury: A blazing fast multi-language serialization framework powered by JIT and zero-copy","url":"/blog/fury_blazing_fast_multiple_language_serialization_framework#performance-comparison","content":" Here are some Java serialization performance data, where charts with &quot;compatible&quot; in the title are performance data under type compatible mode: Support type forward vs. Backward compatibility. Charts without &quot;compatible&quot; in the title are performance data without type compatibility: class schema must be same between serialization and deserialization.  For fairness, Fury disabled the zero-copy feature for all tests.        ","version":null,"tagName":"h2"},{"title":"Roadmap‚Äã","type":1,"pageTitle":"Apache Fury: A blazing fast multi-language serialization framework powered by JIT and zero-copy","url":"/blog/fury_blazing_fast_multiple_language_serialization_framework#roadmap","content":" Meta compression, auto meta sharing and cross-language schema compatibility.AOT Framework for C++ and Golang to generate code statically.Object graph serialization support for C++ and RustRow format support for Golang, Rust, and NodeJSProtobuf compatibility supportProtocols for features and knowledge graph serializationContinuously improve our serialization infrastructure for any new protocols  ","version":null,"tagName":"h2"},{"title":"Join us‚Äã","type":1,"pageTitle":"Apache Fury: A blazing fast multi-language serialization framework powered by JIT and zero-copy","url":"/blog/fury_blazing_fast_multiple_language_serialization_framework#join-us","content":" We are committed to building Apache Fury into an open and neutral community project that pursues passion and innovation. The development and discussion are open-sourced and transparent in the community. Any form of participation is welcome, including but not limited to questions, code contributions, technical discussions, etc. We are looking forward to receiving your ideas and feedback, participating in the project together, pushing the project forward and creating a better serialization framework.  The GitHub address of the fury repository is: https://github.com/apache/fury  Official website: https://fury.apache.org  All issues, PR, and Discussion are welcome. ","version":null,"tagName":"h2"},{"title":"Important Announcement - Apache Fury is Now Apache Fory","type":0,"sectionRef":"#","url":"/blog/fury_renamed_to_fory","content":"","keywords":"","version":null},{"title":"Announcement‚Äã","type":1,"pageTitle":"Important Announcement - Apache Fury is Now Apache Fory","url":"/blog/fury_renamed_to_fory#announcement","content":" The Apache Fury team is now officially announcing that Apache Fury has been renamed to Apache Fory, effective immediately. This transition impacts all project components including code repositories, package names, documentation, and communication channels.  ","version":null,"tagName":"h2"},{"title":"Why This Change Is Necessary‚Äã","type":1,"pageTitle":"Important Announcement - Apache Fury is Now Apache Fory","url":"/blog/fury_renamed_to_fory#why-this-change-is-necessary","content":" This transition is required to resolve naming conflicts identified by the ASF Brand Management. Following massive discussions and a formal vote, this change ensures compliance with ASF's guidelines.  The new name &quot;Fory&quot; preserves phonetic similarity to &quot;Fury&quot; while establishing a distinct identity aligned with ASF standards.  ","version":null,"tagName":"h2"},{"title":"Technical Changes and Impact‚Äã","type":1,"pageTitle":"Important Announcement - Apache Fury is Now Apache Fory","url":"/blog/fury_renamed_to_fory#technical-changes-and-impact","content":" This transition requires updates across the ecosystem:  Java packages migrated from org.apache.fury to org.apache.foryClass names migrated from XXXFury/FuryXXX to XXXFory/ForyXXXGitHub repositories renamed to apache/fory (code) and apache/fory-site (website)Downstream integrations (Quarkus-Fury, Camel-Fury) require dependency updatesMailing lists transition to @fory.apache.org  ","version":null,"tagName":"h2"},{"title":"Migration Support‚Äã","type":1,"pageTitle":"Important Announcement - Apache Fury is Now Apache Fory","url":"/blog/fury_renamed_to_fory#migration-support","content":" To facilitate this transition:  Existing Apache Fury release document remains intact at v0.10 documentCritical URL redirects in place  ","version":null,"tagName":"h2"},{"title":"Why \"Fory\"?‚Äã","type":1,"pageTitle":"Important Announcement - Apache Fury is Now Apache Fory","url":"/blog/fury_renamed_to_fory#why-fory","content":" The name was chosen by prioritizing:  Phonetic similarity to &quot;Fury&quot;No existing trademark conflictsPreservation of our technical identityShort, memorable, and globally pronounceable  ","version":null,"tagName":"h2"},{"title":"Our Commitment‚Äã","type":1,"pageTitle":"Important Announcement - Apache Fury is Now Apache Fory","url":"/blog/fury_renamed_to_fory#our-commitment","content":" We recognize the burden this places on our users, especially those with deep integrations. Please know:  All existing issues and PRs have been migratedPerformance benchmarks remain consistently superiorRelease cycles continue uninterrupted  This rename represents our commitment to respecting intellectual property while maintaining technical excellence. We're grateful for your patience and continued trust as we navigate this transition together. ","version":null,"tagName":"h2"},{"title":"Meta String: A 37.5% space efficient string encoding than UTF-8 in Fury serialization","type":0,"sectionRef":"#","url":"/blog/fury_meta_string_37_5_percent_space_efficient_encoding_than_utf8","content":"","keywords":"","version":null},{"title":"Background‚Äã","type":1,"pageTitle":"Meta String: A 37.5% space efficient string encoding than UTF-8 in Fury serialization","url":"/blog/fury_meta_string_37_5_percent_space_efficient_encoding_than_utf8#background","content":" In rpc/serialization systems, we often need to send namespace/path/filename/fieldName/packageName/moduleName/className/enumValue string between processes.  Those strings are mostly ascii strings. In order to transfer between processes, we encode such strings using utf-8 encodings. Such encoding will take one byte for every char, which is not space efficient actually.  If we take a deeper look, we will found that most chars are lowercase chars, ., $ and _, which can be expressed in a much smaller range 0~32. But one byte can represent range 0~255, the significant bits are wasted, and this cost is not ignorable. In a dynamic serialization framework, such meta will take considerable cost compared to actual data.  So we proposed a new string encoding algorithm which we called meta string encoding in Fury. It will encode most chars using 5 bits instead of 8 bits in utf-8 encoding, which can bring 37.5% space cost savings compared to utf-8 encoding.  ","version":null,"tagName":"h2"},{"title":"Meta String Introduction‚Äã","type":1,"pageTitle":"Meta String: A 37.5% space efficient string encoding than UTF-8 in Fury serialization","url":"/blog/fury_meta_string_37_5_percent_space_efficient_encoding_than_utf8#meta-string-introduction","content":" Meta string encoding algorithm is mainly used to encode meta strings such as field names, namespace, packageName, className, path and filename. Such a string is enumerated and limited, so the encoding performance is not important since we can cache the encoding result.  Meta string encoding uses 5/6 bits instead of 8 bits in utf-8 encoding for every chars. Since it uses less bits than utf8, it can bring37.5% space cost savings compared to utf-8 and has a smaller encoded binary size, which uses less storage and makes the network transfer faster.  More details about meta string spec can be found in Fury xlang serialization specification.  ","version":null,"tagName":"h2"},{"title":"Encoding Algorithms‚Äã","type":1,"pageTitle":"Meta String: A 37.5% space efficient string encoding than UTF-8 in Fury serialization","url":"/blog/fury_meta_string_37_5_percent_space_efficient_encoding_than_utf8#encoding-algorithms","content":" String binary encoding algorithm:  Algorithm\tPattern\tDescriptionLOWER_SPECIAL\ta-z._$|\tevery char is written using 5 bits, a-z: 0b00000~0b11001, ._$|: 0b11010~0b11101, prepend one bit at the start to indicate whether strip last char since last byte may have 7 redundant bits(1 indicates strip last char) LOWER_UPPER_DIGIT_SPECIAL\ta-zA-Z0~9._\tevery char is written using 6 bits, a-z: 0b00000~0b11001, A-Z: 0b11010~0b110011, 0~9: 0b110100~0b111101, ._: 0b111110~0b111111, prepend one bit at the start to indicate whether strip last char since last byte may have 7 redundant bits(1 indicates strip last char) UTF-8\tany chars\tUTF-8 encoding  If we use LOWER_SPECIAL/LOWER_UPPER_DIGIT_SPECIAL, we must add a strip last char flag in encoded data. This is because every char will be encoded using 5/6 bits, and the last char may have 1~7 bits which are unused by encoding, such bits may cause an extra char to be read, which we must strip off.  Here is encoding code snippet in java, see org.apache.fury.meta.MetaStringEncoder#encodeGeneric(char[], int) for more details:  private byte[] encodeGeneric(char[] chars, int bitsPerChar) { int totalBits = chars.length * bitsPerChar + 1; int byteLength = (totalBits + 7) / 8; // Calculate number of needed bytes byte[] bytes = new byte[byteLength]; int currentBit = 1; for (char c : chars) { int value = (bitsPerChar == 5) ? charToValueLowerSpecial(c) : charToValueLowerUpperDigitSpecial(c); // Encode the value in bitsPerChar bits for (int i = bitsPerChar - 1; i &gt;= 0; i--) { if ((value &amp; (1 &lt;&lt; i)) != 0) { // Set the bit in the byte array int bytePos = currentBit / 8; int bitPos = currentBit % 8; bytes[bytePos] |= (byte) (1 &lt;&lt; (7 - bitPos)); } currentBit++; } } boolean stripLastChar = bytes.length * 8 &gt;= totalBits + bitsPerChar; if (stripLastChar) { bytes[0] = (byte) (bytes[0] | 0x80); } return bytes; } private int charToValueLowerSpecial(char c) { if (c &gt;= 'a' &amp;&amp; c &lt;= 'z') { return c - 'a'; } else if (c == '.') { return 26; } else if (c == '_') { return 27; } else if (c == '$') { return 28; } else if (c == '|') { return 29; } else { throw new IllegalArgumentException(&quot;Unsupported character for LOWER_SPECIAL encoding: &quot; + c); } } private int charToValueLowerUpperDigitSpecial(char c) { if (c &gt;= 'a' &amp;&amp; c &lt;= 'z') { return c - 'a'; } else if (c &gt;= 'A' &amp;&amp; c &lt;= 'Z') { return 26 + (c - 'A'); } else if (c &gt;= '0' &amp;&amp; c &lt;= '9') { return 52 + (c - '0'); } else if (c == specialChar1) { return 62; } else if (c == specialChar2) { return 63; } else { throw new IllegalArgumentException( &quot;Unsupported character for LOWER_UPPER_DIGIT_SPECIAL encoding: &quot; + c); } }   Here is decoding code snippet in golang, see go/fury/meta/meta_string_decoder.go:70 for more details:  func (d *Decoder) decodeGeneric(data []byte, algorithm Encoding) ([]byte, error) { bitsPerChar := 5 if algorithm == LOWER_UPPER_DIGIT_SPECIAL { bitsPerChar = 6 } // Retrieve 5 bits every iteration from data, convert them to characters, and save them to chars // &quot;abc&quot; encodedBytes as [00000] [000,01] [00010] [0, corresponding to three bytes, which are 0, 68, 0 // Take the highest digit first, then the lower, in order // here access data[0] before entering the loop, so we had to deal with empty data in Decode method // totChars * bitsPerChar &lt;= totBits &lt; (totChars + 1) * bitsPerChar stripLastChar := (data[0] &amp; 0x80) &gt;&gt; 7 totBits := len(data)*8 - 1 - int(stripLastChar)*bitsPerChar totChars := totBits / bitsPerChar chars := make([]byte, totChars) bitPos, bitCount := 6, 1 // first highest bit indicates whether strip last char for i := 0; i &lt; totChars; i++ { var val byte = 0 for i := 0; i &lt; bitsPerChar; i++ { if data[bitCount/8]&amp;(1&lt;&lt;bitPos) &gt; 0 { val |= 1 &lt;&lt; (bitsPerChar - i - 1) } bitPos = (bitPos - 1 + 8) % 8 bitCount++ } ch, err := d.decodeChar(val, algorithm) if err != nil { return nil, err } chars[i] = ch } return chars, nil }   ","version":null,"tagName":"h2"},{"title":"Select Best Encoding‚Äã","type":1,"pageTitle":"Meta String: A 37.5% space efficient string encoding than UTF-8 in Fury serialization","url":"/blog/fury_meta_string_37_5_percent_space_efficient_encoding_than_utf8#select-best-encoding","content":" For most lowercase characters, meta string will use 5 bits to encode every char. For string containing uppercase chars, meta string will try to convert the string into a lower case representation by inserting some markers, and compare used bytes with 6 bits encoding, then select the encoding which has smaller encoded size.  Here is the common encoding selection strategy:  Encoding Flag\tPattern\tEncoding AlgorithmLOWER_SPECIAL\tevery char is in a-z._|\tLOWER_SPECIAL FIRST_TO_LOWER_SPECIAL\tevery char is in a-z._ except first char is upper case\treplace first upper case char to lower case, then use LOWER_SPECIAL ALL_TO_LOWER_SPECIAL\tevery char is in a-zA-Z._\treplace every upper case char by | + lower case, then use LOWER_SPECIAL, use this encoding if it's smaller than Encoding LOWER_UPPER_DIGIT_SPECIAL LOWER_UPPER_DIGIT_SPECIAL\tevery char is in a-zA-Z._\tuse LOWER_UPPER_DIGIT_SPECIAL encoding if it's smaller than Encoding FIRST_TO_LOWER_SPECIAL UTF8\tany utf-8 char\tuse UTF-8 encoding Compression\tany utf-8 char\tlossless compression  For package name, module name or namespace, LOWER_SPECIAL will be used mostly. ALL_TO_LOWER_SPECIAL can be used too, since it can represent the same chars as LOWER_SPECIAL without using more bits, but also support string with uppercase chars.  For className, FIRST_TO_LOWER_SPECIAL will be used mostly. If there are multiple uppercase chars, then ALL_TO_LOWER_SPECIAL will be used instead. If a string contains digits, then LOWER_UPPER_DIGIT_SPECIAL will be used.  Finally, utf8 will be the fallback encoding if the string contains some chars which is not in range a-z0-9A-Z.  ","version":null,"tagName":"h2"},{"title":"Encoding Flags and Data jointly‚Äã","type":1,"pageTitle":"Meta String: A 37.5% space efficient string encoding than UTF-8 in Fury serialization","url":"/blog/fury_meta_string_37_5_percent_space_efficient_encoding_than_utf8#encoding-flags-and-data-jointly","content":" Depending on the case, one can choose encoding flags + data jointly, using 3 bits of first byte for flags and other bytes for data. This can be useful since there are some holes remaining in last byte, adding flags in data doesn't always increase serialized bytes size.Or one can use a header to encode such flags with other meta such as encoded size, this is what Fury does in https://github.com/apache/fury/pull/1556  ","version":null,"tagName":"h2"},{"title":"Benchmark‚Äã","type":1,"pageTitle":"Meta String: A 37.5% space efficient string encoding than UTF-8 in Fury serialization","url":"/blog/fury_meta_string_37_5_percent_space_efficient_encoding_than_utf8#benchmark","content":" utf8 encoding uses 30 bytes for string org.apache.fury.benchmark.data, fury meta string uses only 19 bytes. utf8 encoding uses 12 bytes for string MediaContent, but fury meta string uses only 9 bytes.  // utf8 use 30 bytes, we use only 19 bytes assertEquals(encoder.encode(&quot;org.apache.fury.benchmark.data&quot;).getBytes().length, 19); // utf8 uses 12 bytes, we use only 9 bytes. assertEquals(encoder.encode(&quot;MediaContent&quot;).getBytes().length, 9);  ","version":null,"tagName":"h2"},{"title":"Community","type":0,"sectionRef":"#","url":"/docs/0.10/community/","content":"","keywords":"","version":"0.10"},{"title":"Mailing list‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.10/community/#mailing-list","content":" Name\tDesc\tSubscribe\tUnsubscribe\tPost\tArchivedev@fury.apache.org\tDevelopment related discussions\tSubscribe\tUnsubscribe\tPost\tArchive commits@fury.apache.org\tAll commits to our repositories\tSubscribe\tUnsubscribe\tRead only list\tArchive  Please make sure subscribe to any list before attempting to post.  If you are not subscribed to the mailing list, your message will either be rejected or you won't receive the response.  ","version":"0.10","tagName":"h2"},{"title":"How to subscribe to a mailing list‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.10/community/#how-to-subscribe-to-a-mailing-list","content":" To post messages, subscribe first by:  Sending an email to listname-subscribe@fury.apache.org with listname replaced accordingly.Replying to the confirmation email you'll receive, keeping the subject line intact.You'll then get a welcome email, and the subscription succeeds.  When discussing code snippets in emails, ensure:  You do not link to files in external services, as such files can change, get deleted or the link might break and thus make an archived email thread useless.You paste text instead of screenshots of text.You keep formatting when pasting code in order to keep the code readable.There are enough import statements to avoid ambiguities.  ","version":"0.10","tagName":"h3"},{"title":"Slack‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.10/community/#slack","content":" You can join the Apache Fury‚Ñ¢ community on Slack.  There are a couple of community rules:  Be respectful and nice.All important decisions and conclusions must be reflected back to the mailing lists. &quot;If it didn't happen on a mailing list, it didn't happen.&quot; - The Apache Mottos.Use Slack threads to keep parallel conversations from overwhelming a channel.Please do not direct message people for troubleshooting, issue assigning and PR review. These should be picked-up voluntarily.  ","version":"0.10","tagName":"h2"},{"title":"Issue tracker‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.10/community/#issue-tracker","content":" We use GitHub Issues to track all issues:  code related issues: https://github.com/apache/fury/issueswebsite related issues: https://github.com/apache/fury-site/issues  You need to have a GitHub account in order to create issues. If you don't have a GitHub account, you can post an email to dev@fury.apache.org.  ","version":"0.10","tagName":"h2"},{"title":"Bug reports‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.10/community/#bug-reports","content":" To report a bug:  Verify that the bug does in fact exist.Search the issue tracker to verify there is no existing issue reporting the bug you've found.Create a bug report on issue tracker.If possible, dive into the source code of fury, and submit a patch for the bug you reported, this helps ensure the bug will be fixed quickly.  ","version":"0.10","tagName":"h3"},{"title":"Reporting a Vulnerability‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.10/community/#reporting-a-vulnerability","content":" Apache Fury is a project of the Apache Software Foundation and follows the ASF vulnerability handling process.  To report a new vulnerability you have discovered please follow the ASF vulnerability reporting process, which explains how to send us details privately.  ","version":"0.10","tagName":"h3"},{"title":"Enhancement‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.10/community/#enhancement","content":" Enhancements or new feature proposals are also welcome. The more concrete and rationale the proposal is, the greater the chance it will be incorporated into future releases.  ","version":"0.10","tagName":"h3"},{"title":"Source code‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.10/community/#source-code","content":" fury core repository: https://github.com/apache/furyfury website repository: https://github.com/apache/fury-site ","version":"0.10","tagName":"h2"},{"title":"How to join Fury","type":0,"sectionRef":"#","url":"/docs/0.10/community/how_to_join_community","content":"","keywords":"","version":"0.10"},{"title":"Fury Contribution Guide‚Äã","type":1,"pageTitle":"How to join Fury","url":"/docs/0.10/community/how_to_join_community#fury-contribution-guide","content":" The Fury team usually conducts development and issue maintenance on GitHub. Please open the GitHub website, click the Sign up button in the upper right corner, register your own account, and take the first step of your open source journey.  In the Fury repository, we have a guide for all open source contributors, introducing contents such as version management and branch management. Please take a few minutes to read and understand it.  ","version":"0.10","tagName":"h2"},{"title":"Your First Pull Request‚Äã","type":1,"pageTitle":"How to join Fury","url":"/docs/0.10/community/how_to_join_community#your-first-pull-request","content":" ","version":"0.10","tagName":"h2"},{"title":"Step 0: Install Git‚Äã","type":1,"pageTitle":"How to join Fury","url":"/docs/0.10/community/how_to_join_community#step-0-install-git","content":" Git is a version control system used to track and manage code changes in software development projects. It helps developers record and manage the history of the code, facilitating team collaboration, code version control, code merging, and other operations. With Git, you can track each version of each file and easily switch and compare between different versions. Git also provides branch management functionality, allowing multiple concurrent development tasks to be carried out simultaneously.  Visit the official Git website: [https://git-scm.com/] (https://git-scm.com/)Download the latest version of the Git installer.Run the downloaded installer and follow the prompts of the installation wizard to install.After the installation is complete, you can use the git version command in the command line to confirm the successful installation.  ","version":"0.10","tagName":"h3"},{"title":"Step 1: Fork the Project‚Äã","type":1,"pageTitle":"How to join Fury","url":"/docs/0.10/community/how_to_join_community#step-1-fork-the-project","content":" First, you need to fork this project. Enter the Fury project page, and click the Fork button in the upper right corner.In your GitHub account, the project xxxx (your GitHub username)/fury will appear.On your local computer, use the following commands to obtain a fury folder:  // ssh git clone git@github.com:xxxx (your GitHub username)/fury.git // https git clone https://github.com/xxxx (your GitHub username)/fury.git   ","version":"0.10","tagName":"h3"},{"title":"Step 2: Obtain the Project Code‚Äã","type":1,"pageTitle":"How to join Fury","url":"/docs/0.10/community/how_to_join_community#step-2-obtain-the-project-code","content":" Enter the fury folder and add the remote address of fury:  git remote add upstream https://github.com/apache/fury.git   ","version":"0.10","tagName":"h3"},{"title":"Step 3: Create a Branch‚Äã","type":1,"pageTitle":"How to join Fury","url":"/docs/0.10/community/how_to_join_community#step-3-create-a-branch","content":" Alright, now you can start contributing our code. The default branch of Fury is the main branch. Whether it is for function development, bug fixes, or documentation writing, please create a new branch and then merge it to the main branch. Use the following code to create a branch:  // Create a function development branch git checkout -b feat/xxxx // Create a problem-fixing development branch git checkout -b fix/xxxx // Create a documentation, demo branch git checkout -b docs/add-java-demo   Suppose we have created the documentation modification branch docs/add-java-demo and we have added some code and submitted it to the code repository.  git add .git commit -a -m &quot;docs: add java demo and related docs&quot;  ","version":"0.10","tagName":"h3"},{"title":"Step 4: Merge the Modifications‚Äã","type":1,"pageTitle":"How to join Fury","url":"/docs/0.10/community/how_to_join_community#step-4-merge-the-modifications","content":" Switch back to your development branch:  git checkout docs/add-java-demo   Submit the updated code to your branch:  git push origin docs/add-java-demo   ","version":"0.10","tagName":"h3"},{"title":"Step 5: Submit a Pull Request‚Äã","type":1,"pageTitle":"How to join Fury","url":"/docs/0.10/community/how_to_join_community#step-5-submit-a-pull-request","content":" You can click the Compare &amp; pull request button on your GitHub code repository page. Or create it through the contribute button.  Fill in what type of modification this is.Fill in the associated issue.If there are complex changes, please explain the background and solution.  After filling in the relevant information, click Create pull request to submit.  ","version":"0.10","tagName":"h3"},{"title":"Easily Step into the Fury Open Source Contribution Journey‚Äã","type":1,"pageTitle":"How to join Fury","url":"/docs/0.10/community/how_to_join_community#easily-step-into-the-fury-open-source-contribution-journey","content":" &quot;good first issue&quot; is a common label in the open source community, and the purpose of this label is to help new contributors find entry-level issues that are suitable for them.  The entry-level issues of Fury can be viewed through the issue list.  If you currently have the time and willingness to participate in community contributions, you can take a look at good first issue in the issues and select one that interests you and is suitable for you to claim.  ","version":"0.10","tagName":"h2"},{"title":"Embrace the Apache Fury Community‚Äã","type":1,"pageTitle":"How to join Fury","url":"/docs/0.10/community/how_to_join_community#embrace-the-apache-fury-community","content":" While you contribute code to Fury, we encourage you to participate in other things that make the community more prosperous, such as:  Offer suggestions for the project's development, functional planning, etc.Create articles, videos, and hold lectures to promote Fury.Write promotion plans and execute them together with the team. ","version":"0.10","tagName":"h2"},{"title":"How to verify","type":0,"sectionRef":"#","url":"/docs/0.10/community/how_to_verify","content":"","keywords":"","version":"0.10"},{"title":"Download the candidate version‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/0.10/community/how_to_verify#download-the-candidate-version","content":" #If there is svn locally, you can clone to the local svn co https://dist.apache.org/repos/dist/dev/incubator/fury/${release_version}-${rc_version}/ # You can download the material file directly wget https://dist.apache.org/repos/dist/dev/incubator/fury/${release_version}-${rc_version}/xxx.xxx   ","version":"0.10","tagName":"h2"},{"title":"Verify checksums and signatures‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/0.10/community/how_to_verify#verify-checksums-and-signatures","content":" First you need to install gpg:  apt-get install gnupg # or yum install gnupg # or brew install gnupg   Then import the Fury release manager's public key:  curl https://downloads.apache.org/incubator/fury/KEYS &gt; KEYS # Download KEYS gpg --import KEYS # Import KEYS to local # Then, trust the public key: gpg --edit-key &lt;KEY-used-in-this-version&gt; # Edit the key(mentioned in vote email) # It will enter the interactive mode, use the following command to trust the key: gpg (GnuPG) 2.0.22; Copyright (C) 2013 Free Software Foundation, Inc. This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. pub 4096R/5E580BA4 created: 2024-03-27 expires: never usage: SC trust: unknown validity: unknown sub 4096R/A31EF728 created: 2024-03-27 expires: never usage: E [ unknown] (1). chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; gpg&gt; trust pub 4096R/5E580BA4 created: 2024-03-27 expires: never usage: SC trust: unknown validity: unknown sub 4096R/A31EF728 created: 2024-03-27 expires: never usage: E [ unknown] (1). chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; Please decide how far you trust this user to correctly verify other users' keys (by looking at passports, checking fingerprints from different sources, etc.) 1 = I don't know or won't say 2 = I do NOT trust 3 = I trust marginally 4 = I trust fully 5 = I trust ultimately m = back to the main menu Your decision? 5 Do you really want to set this key to ultimate trust? (y/N) y pub 4096R/5E580BA4 created: 2024-03-27 expires: never usage: SC trust: ultimate validity: unknown sub 4096R/A31EF728 created: 2024-03-27 expires: never usage: E [ unknown] (1). chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; Please note that the shown key validity is not necessarily correct unless you restart the program.   Next verify signature:  for i in *.tar.gz; do echo $i; gpg --verify $i.asc $i; done   If something like the following appears, it means the signature is correct:  apache-fury-incubating-0.5.0-src.tar.gz gpg: Signature made Wed 17 Apr 2024 11:49:45 PM CST using RSA key ID 5E580BA4 gpg: checking the trustdb gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model gpg: depth: 0 valid: 1 signed: 0 trust: 0-, 0q, 0n, 0m, 0f, 1u gpg: Good signature from &quot;chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt;&quot;   Then verify checksum:  for i in *.tar.gz; do echo $i; sha512sum --check $i.sha512; done   It should output something like:  apache-fury-incubating-0.5.0-src.tar.gz apache-fury-incubating-0.5.0-src.tar.gz: OK   ","version":"0.10","tagName":"h2"},{"title":"Check the file content of the source package‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/0.10/community/how_to_verify#check-the-file-content-of-the-source-package","content":" Unzip apache-fury-${release_version}-${rc_version}-src.tar.gz and check the follows:  LICENSE and NOTICE files are correct for the repository.All files have ASF license headers if necessary.Building is OK.  ","version":"0.10","tagName":"h2"},{"title":"Check the Maven artifacts of fury-java‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/0.10/community/how_to_verify#check-the-maven-artifacts-of-fury-java","content":" Download the artifacts from https://repository.apache.org/content/repositories/orgapachefury-${maven_artifact_number}/.  You can check the follows:  Checksum of JARs match the bundled checksum file.Signature of JARs match the bundled signature file.JARs is reproducible locally. This means you can build the JARs on your machine and verify the checksum is the same with the bundled one. ","version":"0.10","tagName":"h2"},{"title":"Development","type":0,"sectionRef":"#","url":"/docs/0.10/guide/development","content":"","keywords":"","version":"0.10"},{"title":"How to build Fury‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.10/guide/development#how-to-build-fury","content":" Please checkout the source tree from https://github.com/apache/fury.  ","version":"0.10","tagName":"h2"},{"title":"Build Fury Java‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.10/guide/development#build-fury-java","content":" cd java mvn clean compile -DskipTests   Environment Requirements‚Äã  java 1.8+maven 3.6.3+  ","version":"0.10","tagName":"h3"},{"title":"Build Fury Python‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.10/guide/development#build-fury-python","content":" cd python # Uninstall numpy first so that when we install pyarrow, it will install the correct numpy version automatically. # For Python versions less than 3.13, numpy 2 is not currently supported. pip uninstall -y numpy # Install necessary environment for Python &lt; 3.13. pip install pyarrow==15.0.0 Cython wheel pytest # For Python 3.13, pyarrow 18.0.0 is available and requires numpy version greater than 2. # pip install pyarrow==18.0.0 Cython wheel pytest pip install -v -e .   Environment Requirements‚Äã  python 3.6+  ","version":"0.10","tagName":"h3"},{"title":"Build Fury C++‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.10/guide/development#build-fury-c","content":" Build fury row formatÔºö  pip install pyarrow==15.0.0 bazel build //cpp/fury/row:fury_row_format   Build fury row format encoder:  pip install pyarrow==15.0.0 bazel build //cpp/fury/encoder:fury_encoder   Environment Requirements‚Äã  compilers with C++17 supportbazel 6.3.2  ","version":"0.10","tagName":"h3"},{"title":"Build Fury GoLang‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.10/guide/development#build-fury-golang","content":" cd go/fury # run test go test -v # run xlang test go test -v fury_xlang_test.go   Environment Requirements‚Äã  go 1.13+  ","version":"0.10","tagName":"h3"},{"title":"Build Fury Rust‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.10/guide/development#build-fury-rust","content":" cd rust # build cargo build # run test cargo test   Environment Requirements‚Äã  curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh   ","version":"0.10","tagName":"h3"},{"title":"Build Fury JavaScript‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.10/guide/development#build-fury-javascript","content":" cd javascript npm install # run build npm run build # run test npm run test   Environment Requirements‚Äã  node 14+npm 8+ ","version":"0.10","tagName":"h3"},{"title":"How to release","type":0,"sectionRef":"#","url":"/docs/0.10/community/how_to_release","content":"","keywords":"","version":"0.10"},{"title":"Introduction‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.10/community/how_to_release#introduction","content":" Source Release is the most important part which Apache values.  Please pay more attention to license and signing issues. Publishing software is a serious thing and has legal consequences.  ","version":"0.10","tagName":"h2"},{"title":"First-time as a release manager‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.10/community/how_to_release#first-time-as-a-release-manager","content":" ","version":"0.10","tagName":"h2"},{"title":"Environmental requirements‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.10/community/how_to_release#environmental-requirements","content":" This release process is operated in the Ubuntu OS, and the following tools are required:  JDK 1.8Apache Maven 3.xPython 3.8GnuPG 2.xGitSVN (apache uses svn to host project releases)Pay attention to setting environment variables: if you configure gpg keys under a different directory, please export GNUPGHOME=$(xxx)  ","version":"0.10","tagName":"h3"},{"title":"Prepare GPG Key‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.10/community/how_to_release#prepare-gpg-key","content":" If you are the first to become a release manager, you need to prepare a gpg key.  Following is a quick setup, you can refer to Apache openpgp doc for further details.  Install GPG‚Äã  sudo apt install gnupg2   Generate GPG Key‚Äã  Please use your apache name and email for generate key  $ gpg --full-gen-key gpg (GnuPG) 2.2.20; Copyright (C) 2020 Free Software Foundation, Inc. This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. Please select what kind of key you want: (1) RSA and RSA (default) (2) DSA and Elgamal (3) DSA (sign only) (4) RSA (sign only) (14) Existing key from card Your selection? 1 # input 1 RSA keys may be between 1024 and 4096 bits long. What keysize do you want? (2048) 4096 # input 4096 Requested keysize is 4096 bits Please specify how long the key should be valid. 0 = key does not expire &lt;n&gt; = key expires in n days &lt;n&gt;w = key expires in n weeks &lt;n&gt;m = key expires in n months &lt;n&gt;y = key expires in n years Key is valid for? (0) 0 # input 0 Key does not expire at all Is this correct? (y/N) y # input y GnuPG needs to construct a user ID to identify your key. Real name: Chaokun Yang # input your name Email address: chaokunyang@apache.org # input your email Comment: CODE SIGNING KEY # input some annotations, optional You selected this USER-ID: &quot;Chaokun &lt;chaokunyang@apache.org&gt;&quot; Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? O # input O We need to generate a lot of random bytes. It is a good idea to perform some other action (type on the keyboard, move the mouse, utilize the disks) during the prime generation; this gives the random number generator a better chance to gain enough entropy. We need to generate a lot of random bytes. It is a good idea to perform some other action (type on the keyboard, move the mouse, utilize the disks) during the prime generation; this gives the random number generator a better chance to gain enough entropy. # Input the security key ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ Please enter this passphrase ‚îÇ ‚îÇ ‚îÇ ‚îÇ Passphrase: _______________________________ ‚îÇ ‚îÇ ‚îÇ ‚îÇ &lt;OK&gt; &lt;Cancel&gt; ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò # key generation will be done after your inputting the key with the following output gpg: key E49B00F626B marked as ultimately trusted gpg: revocation certificate stored as '/Users/chaokunyang/.gnupg/openpgp-revocs.d/1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4.rev' public and secret key created and signed. pub rsa4096 2022-07-12 [SC] 1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4 uid [ultimate] Chaokun &lt;chaokunyang@apache.org&gt; sub rsa4096 2022-07-12 [E]   Upload your public key to public GPG keyserver‚Äã  Firstly, list your key:  gpg --list-keys   The output is like:  -------------------------------------------------- pub rsa4096 2024-03-27 [SC] 1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4 uid [ultimate] chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; sub rsa4096 2024-03-27 [E]   Then, send your key id to key server:  gpg --keyserver keys.openpgp.org --send-key &lt;key-id&gt; # e.g., 1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4   Among them, keys.openpgp.org is a randomly selected keyserver, you can use keyserver.ubuntu.com or any other full-featured keyserver.  Check whether the key is created successfully‚Äã  Uploading takes about one minute; after that, you can check by email at the corresponding keyserver.  Uploading keys to the keyserver is mainly for joining a Web of Trust.  Add your GPG public key to the project KEYS file‚Äã  The svn repository of the release branch is: https://dist.apache.org/repos/dist/release/incubator/fury  Please add the public key to KEYS in the release branch:  svn co https://dist.apache.org/repos/dist/release/incubator/fury fury-dist # As this step will copy all the versions, it will take some time. If the network is broken, please use svn cleanup to delete the lock before re-execute it. cd fury-dist (gpg --list-sigs YOUR_NAME@apache.org &amp;&amp; gpg --export --armor YOUR_NAME@apache.org) &gt;&gt; KEYS # Append your key to the KEYS file svn add . # It is not needed if the KEYS document exists before. svn ci -m &quot;add gpg key for YOUR_NAME&quot; # Later on, if you are asked to enter a username and password, just use your apache username and password.   Upload the GPG public key to your GitHub account‚Äã  Enter https://github.com/settings/keys to add your GPG key.Please remember to bind the email address used in the GPG key to your GitHub account (https://github.com/settings/emails) if you find &quot;unverified&quot; after adding it.  ","version":"0.10","tagName":"h3"},{"title":"Further reading‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.10/community/how_to_release#further-reading","content":" It's recommended but not mandatory to read following documents before making a release to know more details about apache release:  Release policy: https://www.apache.org/legal/release-policy.htmlIncubator release: http://incubator.apache.org/guides/releasemanagement.htmlTLP release: https://infra.apache.org/release-distributionRelease sign: https://infra.apache.org/release-signing.htmlRelease publish: https://infra.apache.org/release-publishing.htmlRelease download pages: https://infra.apache.org/release-download-pages.htmlPublishing maven artifacts: https://infra.apache.org/publishing-maven-artifacts.html  ","version":"0.10","tagName":"h3"},{"title":"Start discussion about the release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.10/community/how_to_release#start-discussion-about-the-release","content":" Start a discussion about the next release via sending email to: dev@fury.apache.org:  Title:  [DISCUSS] Release Apache Fury(incubating) ${release_version}   Content:  Hello, Apache Fury(incubating) Community, This is a call for a discussion to release Apache Fury(incubating) version ${release_version}. The change lists about this release: https://github.com/apache/fury/compare/v0.4.1...v0.5.0 Please leave your comments here about this release plan. We will bump the version in repo and start the release process after the discussion. Thanks, ${name}   ","version":"0.10","tagName":"h2"},{"title":"Preparing for release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.10/community/how_to_release#preparing-for-release","content":" If the discussion goes positive, you will need to prepare the release artifiacts.  ","version":"0.10","tagName":"h2"},{"title":"Github branch and tag‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.10/community/how_to_release#github-branch-and-tag","content":" Create a new branch named releases-0.5.0Bump version to $version by executing command python ci/release.py bump_version -l all -version $versionMake a git commit and push the branch to git@github.com:apache/fury.gitCreate a new tag by git tag v0.5.0-rc1, then push it to git@github.com:apache/fury.git  ","version":"0.10","tagName":"h3"},{"title":"Build and upload artifacts to SVN dist/dev repo‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.10/community/how_to_release#build-and-upload-artifacts-to-svn-distdev-repo","content":" First you need to build source release artifacts by python ci/release.py build -v $version.  Then you need to upload it to svn dist repo. The dist repo of the dev branch is: https://dist.apache.org/repos/dist/dev/incubator/fury  # As this step will copy all the versions, it will take some time. If the network is broken, please use svn cleanup to delete the lock before re-execute it. svn co https://dist.apache.org/repos/dist/dev/incubator/fury fury-dist-dev   Then, upload the artifacts:  cd fury-dist-dev # create a directory named by version mkdir ${release_version}-${rc_version} # copy source code and signature package to the versioned directory cp ${repo_dir}/dist/* ${release_version}-${rc_version} # check svn status svn status # add to svn svn add ${release_version}-${rc_version} # check svn status svn status # commit to SVN remote server svn commit -m &quot;Prepare for fury ${release_version}-${rc_version}&quot;   Visit https://dist.apache.org/repos/dist/dev/incubator/fury/ to check the artifacts are uploaded correctly.  ","version":"0.10","tagName":"h3"},{"title":"What to do if something goes wrong‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.10/community/how_to_release#what-to-do-if-something-goes-wrong","content":" If some files are unexpected, you need to remove by svn delete and repeat the above upload process.  ","version":"0.10","tagName":"h3"},{"title":"Voting‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.10/community/how_to_release#voting","content":" ","version":"0.10","tagName":"h2"},{"title":"check version‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.10/community/how_to_release#check-version","content":" As an incubating project, Fury requires votes from both the FUry Community and Incubator Community.  release_version: the version for fury, like 0.5.0.release_candidate_version: the version for voting, like 0.5.0-rc1.maven_artifact_number: the number for Maven staging artifacts, like 1001. Specifically, the maven_artifact_number can be found by searching &quot;fury&quot; on https://repository.apache.org/#stagingRepositories.  ","version":"0.10","tagName":"h3"},{"title":"Build the source code of fury and release it to nexus‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.10/community/how_to_release#build-the-source-code-of-fury-and-release-it-to-nexus","content":" Configure Apache Account Passwords‚Äã  Before publishing Fury to Nexus, you need to securely configure your Apache account credentials. This step is critical as passwords must be encrypted.  First, open your Maven global settings file settings.xml, typically located at ~/.m2/settings.xml. Add or modify the following section:   &lt;servers&gt; &lt;server&gt; &lt;id&gt;apache.snapshots.https&lt;/id&gt; &lt;username&gt;your-apache-username&lt;/username&gt; &lt;password&gt;{your-encrypted-password}&lt;/password&gt; &lt;/server&gt; &lt;server&gt; &lt;id&gt;apache.releases.https&lt;/id&gt; &lt;username&gt;your-apache-username&lt;/username&gt; &lt;password&gt;{your-encrypted-password}&lt;/password&gt; &lt;/server&gt; &lt;/servers&gt;   Important Notes:  Replace your-apache-username with your Apache LDAP usernamePasswords must be encrypted using Maven's password encryption toolEncrypted passwords should be enclosed in curly braces {}  Refer to the official documentation for detailed encryption instructions: Publishing Maven Artifacts  Steps to encrypt your password:  Generate a master password (if you haven't already): mvn --encrypt-master-password your-master-password Save the output to ~/.m2/settings-security.xml: &lt;settingsSecurity&gt; &lt;master&gt;{your-encrypted-master-password}&lt;/master&gt; &lt;/settingsSecurity&gt; Encrypt your Apache account password: mvn --encrypt-password your-apache-password Place the encrypted output into the password field in settings.xml  Build and Publish Java Module‚Äã   # Navigate to the Java module directory cd java # Execute Maven build and deploy to Nexus # -T10: Use 10 threads for parallel build, improving speed # clean: Clean the project # deploy: Deploy to remote repository # -Papache-release: Activate apache-release profile # -DskipTests: Skip tests # -Dgpg.skip=false: Enable GPG signing (required for release verification) mvn -T10 clean deploy -Papache-release -DskipTests -Dgpg.skip=false   Build and Publish Kotlin Module‚Äã   # Return to project root and navigate to Kotlin module cd ../kotlin # Execute the same Maven command as Java module # Configuration parameters are identical to Java module mvn -T10 clean deploy -Papache-release -DskipTests -Dgpg.skip=false   Build and Publish Scala Module‚Äã   # Return to project root and navigate to Scala module cd ../scala # Build and sign JARs for all Scala versions # +publishSigned: Execute publishSigned for all configured Scala versions echo &quot;Starting to build Scala JARs...&quot; sbt +publishSigned # Prepare for upload to Sonatype (Nexus) # sonatypePrepare: Prepare for Maven Central Repository release echo &quot;Starting upload preparation...&quot; sbt sonatypePrepare # Upload packaged JARs to Sonatype # sonatypeBundleUpload: Upload prepared bundles echo &quot;Starting JAR upload...&quot; sbt sonatypeBundleUpload echo &quot;Scala JAR deployment succeeded!&quot;   Lock the Release in Nexus‚Äã  After completing the publication of all modules, perform the following steps in Nexus:  Log in to the Apache Nexus repository management interfaceNavigate to the &quot;Snapshots&quot; or &quot;Releases&quot; repository (depending on your release type)Locate the latest Fury project versionExecute the &quot;Close&quot; operation to validate all uploaded artifactsAfter successful validation, execute the &quot;Release&quot; operation to finalize the deployment  These steps ensure all published artifacts are verified and correctly deployed to the public repository.  ","version":"0.10","tagName":"h3"},{"title":"build a Pre-release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.10/community/how_to_release#build-a-pre-release","content":" You need to build a Pre-release before voting, such as:https://github.com/apache/fury/releases/tag/v0.10.3-rc2  ","version":"0.10","tagName":"h3"},{"title":"Fury Community Vote‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.10/community/how_to_release#fury-community-vote","content":" you need send a email to Fury Community: dev@fury.apache.org:  Title:  [VOTE] Release Apache Fury(incubating) v${release_version}-${rc_version}   Content:  Hello, Apache Fury(incubating) Community: This is a call for vote to release Apache Fury(Incubating) version release-0.5.0-rc3. Apache Fury(incubating) - A blazingly fast multi-language serialization framework powered by JIT and zero-copy. The discussion thread: https://lists.apache.org/thread/xxr3od301g6v3ndj14zqc05byp9qvclh The change lists about this release: https://github.com/apache/fury/compare/v0.4.1...v0.5.0-rc3 The release candidates: https://dist.apache.org/repos/dist/dev/incubator/fury/0.5.0-rc3/ The maven staging for this release: https://repository.apache.org/content/repositories/orgapachefury-1003 Git tag for the release: https://github.com/apache/fury/releases/tag/v0.5.0-rc3 Git commit for the release: https://github.com/apache/fury/commit/fae06330edd049bb960536e978a45b97bca66faf The artifacts signed with PGP key [5E580BA4], corresponding to [chaokunyang@apache.org], that can be found in keys file: https://downloads.apache.org/incubator/fury/KEYS The vote will be open for at least 72 hours until the necessary number of votes are reached. Please vote accordingly: [ ] +1 approve [ ] +0 no opinion [ ] -1 disapprove with the reason To learn more about Fury, please see https://fury.apache.org/ *Valid check is a requirement for a vote. *Checklist for reference: [ ] Download Fury is valid. [ ] Checksums and PGP signatures are valid. [ ] Source code distributions have correct names matching the current release. [ ] LICENSE and NOTICE files are correct. [ ] All files have license headers if necessary. [ ] No compiled archives bundled in source archive. [ ] Can compile from source. More detail checklist please refer: https://cwiki.apache.org/confluence/display/INCUBATOR/Incubator+Release+Checklist How to Build and Test, please refer to: https://github.com/apache/fury/blob/main/docs/guide/DEVELOPMENT.md Thanks, Chaokun Yang   After at least 3 +1 binding vote (from Fury Podling PMC member and committers) and no veto, claim the vote result:  Title:  [RESULT][VOTE] Release Apache Fury(incubating) v${release_version}-${rc_version}   Content:  Hello, Apache Fury(incubating) Community, The vote to release Apache Fury(Incubating) v${release_version}-${rc_version} has passed. The vote PASSED with 3 binding +1 and 0 -1 vote: Binding votes: - xxx - yyy - zzz Vote thread: ${vote_thread_url} Thanks, ${name}   ","version":"0.10","tagName":"h3"},{"title":"Incubator Community Vote‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.10/community/how_to_release#incubator-community-vote","content":" Send an email to: general@incubator.apache.org:  Title:  [VOTE] Release Apache Fury(incubating) v${release_version}-${rc_version}   Content:  Hello everyone, This is a call for the vote to release Apache Fury(Incubating) v${release_version}-${rc_version}. The Apache Fury community has voted and approved the release of Apache Fury(incubating) v${release_version}-${rc_version}. We now kindly request the IPMC members review and vote for this release. Apache Fury(incubating) - A blazingly fast multi-language serialization framework powered by JIT and zero-copy. Fury community vote thread: ${community_vote_thread_url} Vote result thread: ${community_vote_result_thread_url} The release candidate: https://dist.apache.org/repos/dist/dev/incubator/fury/${release_version}-${rc_version}/ This release has been signed with a PGP available here: https://downloads.apache.org/incubator/fury/KEYS Git tag for the release: https://github.com/apache/fury/releases/tag/v${release_version}-${rc_version}/ Git commit for the release: https://github.com/apache/fury/commit/$xxx Maven staging repo: https://repository.apache.org/content/repositories/orgapachefury-${maven_artifact_number}/ How to Build and Test, please refer to: https://github.com/apache/fury/blob/main/docs/guide/DEVELOPMENT.md Please download, verify, and test. The VOTE will pass after 3 binding approve. [ ] +1 approve [ ] +0 no opinion [ ] -1 disapprove with the reason To learn more about apache fury, please see https://fury.apache.org/ Checklist for reference: [ ] Download links are valid. [ ] Checksums and signatures. [ ] LICENSE/NOTICE files exist [ ] No unexpected binary files [ ] All source files have ASF headers [ ] Can compile from source Thanks, ${name}   After at least 72 hours with at least 3 +1 binding vote (from Incubator PMC member) and no veto, claim the vote result:  Title:  [RESULT][VOTE] Release Apache Fury(incubating) v${release_version}-${rc_version}   Content:  Hi Incubator PMC, The vote to release Apache Fury(incubating) v${release_version}-${rc_version} has passed with 4 +1 binding and 3 +1 non-binding votes, no +0 or -1 votes. Binding votesÔºö - xxx - yyy - zzz Non-Binding votes: - aaa Vote thread: ${incubator_vote_thread_url} Thanks for reviewing and voting for our release candidate. We will proceed with publishing the approved artifacts and sending out the announcement soon.   ","version":"0.10","tagName":"h3"},{"title":"What if vote fail‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.10/community/how_to_release#what-if-vote-fail","content":" If the vote failed, click &quot;Drop&quot; to drop the staging Maven artifacts.  Address the raised issues, then bump rc_version and file a new vote again.  ","version":"0.10","tagName":"h3"},{"title":"Official Release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.10/community/how_to_release#official-release","content":" ","version":"0.10","tagName":"h2"},{"title":"Publish artifacts to SVN Release Directory‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.10/community/how_to_release#publish-artifacts-to-svn-release-directory","content":" release_version: the release version for fury, like 0.5.0release_candidate_version: the version for voting, like 0.5.0-rc1  svn mv https://dist.apache.org/repos/dist/dev/incubator/fury/${release_version}-${rc_version} https://dist.apache.org/repos/dist/release/incubator/fury/${release_version} -m &quot;Release fury ${release_version}&quot;   In the repository at https://dist.apache.org/repos/dist/dev/incubator/fury/, if any outdated release_candidate_version are left behind when releasing the release_version, please clear them to keep the dev repository tidy.  When https://archive.apache.org/dist/incubator/fury/0.10.0/${release_version} is accessible (confirming that the release_version has been successfully released and archived), we may clean up the previous release version in the release repository, leaving only the current version.  ","version":"0.10","tagName":"h3"},{"title":"Update Fury&Fury-Site content‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.10/community/how_to_release#update-furyfury-site-content","content":" Submit a PR to https://github.com/apache/fury-site to update Fury-site. Reference implementation: #222and #223.  Submit a PR to https://github.com/apache/fury to update README, like #2207.  ","version":"0.10","tagName":"h3"},{"title":"Github officially released‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.10/community/how_to_release#github-officially-released","content":" You need to officially release this version in the Fury project Reference implementation: https://github.com/apache/fury/releases/tag/v0.10.3  ","version":"0.10","tagName":"h3"},{"title":"Release Maven artifacts‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.10/community/how_to_release#release-maven-artifacts","content":" maven_artifact_number: the number for Maven staging artifacts, like 1001.Open https://repository.apache.org/#stagingRepositories.Find the artifact orgapachefury-${maven_artifact_number}, click &quot;Release&quot;.  ","version":"0.10","tagName":"h3"},{"title":"Send the announcement‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.10/community/how_to_release#send-the-announcement","content":" Send the release announcement to dev@fury.apache.org and CC announce@apache.org.  Title:  [ANNOUNCE] Release Apache Fury(incubating) ${release_version}   Content:  Hi all, The Apache Fury(incubating) community is pleased to announce that Apache Fury(incubating) {release_version} has been released! Apache Fury(incubating) - A blazingly fast multi-language serialization framework powered by JIT and zero-copy. The release notes are available here: https://github.com/apache/fury/releases/tag/v${release_version} For the complete list of changes: https://github.com/apache/fury/compare/v0.5.0...v${release_version} Apache Fury website: https://fury.apache.org/ Download Links: https://fury.apache.org/download Fury Resources: - Fury github repo: https://github.com/apache/fury - Issue: https://github.com/apache/fury/issues - Mailing list: dev@fury.apache.org We are looking to grow our community and welcome new contributors. If you are interested in contributing to Fury, please contact us on the mailing list or on GitHub. We will be happy to help you get started. ------------------ Best Regards, ${your_name}   Remember to use plain text instead of rich text format, or you may be rejected when CC announce@apache.org  After completing the above steps, the Fury release process comes to an end. ","version":"0.10","tagName":"h3"},{"title":"Row Format","type":0,"sectionRef":"#","url":"/docs/0.10/guide/row_format","content":"","keywords":"","version":"0.10"},{"title":"Row format protocol‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.10/guide/row_format#row-format-protocol","content":" ","version":"0.10","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.10/guide/row_format#java","content":" public class Bar { String f1; List&lt;Long&gt; f2; } public class Foo { int f1; List&lt;Integer&gt; f2; Map&lt;String, Integer&gt; f3; List&lt;Bar&gt; f4; } RowEncoder&lt;Foo&gt; encoder = Encoders.bean(Foo.class); Foo foo = new Foo(); foo.f1 = 10; foo.f2 = IntStream.range(0, 1000000).boxed().collect(Collectors.toList()); foo.f3 = IntStream.range(0, 1000000).boxed().collect(Collectors.toMap(i -&gt; &quot;k&quot;+i, i-&gt;i)); List&lt;Bar&gt; bars = new ArrayList&lt;&gt;(1000000); for (int i = 0; i &lt; 1000000; i++) { Bar bar = new Bar(); bar.f1 = &quot;s&quot;+i; bar.f2 = LongStream.range(0, 10).boxed().collect(Collectors.toList()); bars.add(bar); } foo.f4 = bars; // Can be zero-copy read by python BinaryRow binaryRow = encoder.toRow(foo); // can be data from python Foo newFoo = encoder.fromRow(binaryRow); // zero-copy read List&lt;Integer&gt; f2 BinaryArray binaryArray2 = binaryRow.getArray(1); // zero-copy read List&lt;Bar&gt; f4 BinaryArray binaryArray4 = binaryRow.getArray(3); // zero-copy read 11th element of `readList&lt;Bar&gt; f4` BinaryRow barStruct = binaryArray4.getStruct(10); // zero-copy read 6th of f2 of 11th element of `readList&lt;Bar&gt; f4` barStruct.getArray(1).getInt64(5); RowEncoder&lt;Bar&gt; barEncoder = Encoders.bean(Bar.class); // deserialize part of data. Bar newBar = barEncoder.fromRow(barStruct); Bar newBar2 = barEncoder.fromRow(binaryArray4.getStruct(20));   ","version":"0.10","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.10/guide/row_format#python","content":" @dataclass class Bar: f1: str f2: List[pa.int64] @dataclass class Foo: f1: pa.int32 f2: List[pa.int32] f3: Dict[str, pa.int32] f4: List[Bar] encoder = pyfury.encoder(Foo) foo = Foo(f1=10, f2=list(range(1000_000)), f3={f&quot;k{i}&quot;: i for i in range(1000_000)}, f4=[Bar(f1=f&quot;s{i}&quot;, f2=list(range(10))) for i in range(1000_000)]) binary: bytes = encoder.to_row(foo).to_bytes() print(f&quot;start: {datetime.datetime.now()}&quot;) foo_row = pyfury.RowData(encoder.schema, binary) print(foo_row.f2[100000], foo_row.f4[100000].f1, foo_row.f4[200000].f2[5]) print(f&quot;end: {datetime.datetime.now()}&quot;) binary = pickle.dumps(foo) print(f&quot;pickle start: {datetime.datetime.now()}&quot;) new_foo = pickle.loads(binary) print(new_foo.f2[100000], new_foo.f4[100000].f1, new_foo.f4[200000].f2[5]) print(f&quot;pickle end: {datetime.datetime.now()}&quot;)   ","version":"0.10","tagName":"h3"},{"title":"Apache Arrow Support‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.10/guide/row_format#apache-arrow-support","content":" Fury Format also supports automatic conversion from/to Arrow Table/RecordBatch.  Java:  Schema schema = TypeInference.inferSchema(BeanA.class); ArrowWriter arrowWriter = ArrowUtils.createArrowWriter(schema); Encoder&lt;BeanA&gt; encoder = Encoders.rowEncoder(BeanA.class); for (int i = 0; i &lt; 10; i++) { BeanA beanA = BeanA.createBeanA(2); arrowWriter.write(encoder.toRow(beanA)); } return arrowWriter.finishAsRecordBatch();   Python:  import pyfury encoder = pyfury.encoder(Foo) encoder.to_arrow_record_batch([foo] * 10000) encoder.to_arrow_table([foo] * 10000)   C++  std::shared_ptr&lt;ArrowWriter&gt; arrow_writer; EXPECT_TRUE( ArrowWriter::Make(schema, ::arrow::default_memory_pool(), &amp;arrow_writer) .ok()); for (auto &amp;row : rows) { EXPECT_TRUE(arrow_writer-&gt;Write(row).ok()); } std::shared_ptr&lt;::arrow::RecordBatch&gt; record_batch; EXPECT_TRUE(arrow_writer-&gt;Finish(&amp;record_batch).ok()); EXPECT_TRUE(record_batch-&gt;Validate().ok()); EXPECT_EQ(record_batch-&gt;num_columns(), schema-&gt;num_fields()); EXPECT_EQ(record_batch-&gt;num_rows(), row_nums);   Schema schema = TypeInference.inferSchema(BeanA.class); ArrowWriter arrowWriter = ArrowUtils.createArrowWriter(schema); Encoder&lt;BeanA&gt; encoder = Encoders.rowEncoder(BeanA.class); for (int i = 0; i &lt; 10; i++) { BeanA beanA = BeanA.createBeanA(2); arrowWriter.write(encoder.toRow(beanA)); } return arrowWriter.finishAsRecordBatch();  ","version":"0.10","tagName":"h3"},{"title":"GraalVM Serialization","type":0,"sectionRef":"#","url":"/docs/0.10/guide/graalvm_serialization","content":"","keywords":"","version":"0.10"},{"title":"GraalVM Native Image‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.10/guide/graalvm_serialization#graalvm-native-image","content":" GraalVM native image can compile java code into native code ahead to build faster, smaller, leaner applications. The native image doesn't have a JIT compiler to compile bytecode into machine code, and doesn't support reflection unless configure reflection file.  Fury runs on GraalVM native image pretty well. Fury generates all serializer code for Fury JIT framework and MethodHandle/LambdaMetafactory at graalvm build time. Then use those generated code for serialization at runtime without any extra cost, the performance is great.  In order to use Fury on graalvm native image, you must create Fury as an static field of a class, and register all classes at the enclosing class initialize time. Then configure native-image.properties underresources/META-INF/native-image/$xxx/native-image.propertie to tell graalvm to init the class at native image build time. For example, here we configure org.apache.fury.graalvm.Example class be init at build time:  Args = --initialize-at-build-time=org.apache.fury.graalvm.Example   Another benefit using fury is that you don't have to configure reflection json andserialization json, which is very tedious, cumbersome and inconvenient. When using fury, you just need to invokeorg.apache.fury.Fury.register(Class&lt;?&gt;, boolean) for every type you want to serialize.  Note that Fury asyncCompilationEnabled option will be disabled automatically for graalvm native image since graalvm native image doesn't support JIT at the image run time.  ","version":"0.10","tagName":"h2"},{"title":"Not thread-safe Fury‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.10/guide/graalvm_serialization#not-thread-safe-fury","content":" Example:  import org.apache.fury.Fury; import org.apache.fury.util.Preconditions; import java.util.List; import java.util.Map; public class Example { public record Record ( int f1, String f2, List&lt;String&gt; f3, Map&lt;String, Long&gt; f4) { } static Fury fury; static { fury = Fury.builder().build(); // register and generate serializer code. fury.register(Record.class, true); } public static void main(String[] args) { Record record = new Record(10, &quot;abc&quot;, List.of(&quot;str1&quot;, &quot;str2&quot;), Map.of(&quot;k1&quot;, 10L, &quot;k2&quot;, 20L)); System.out.println(record); byte[] bytes = fury.serialize(record); Object o = fury.deserialize(bytes); System.out.println(o); Preconditions.checkArgument(record.equals(o)); } }   Then add org.apache.fury.graalvm.Example build time init to native-image.properties configuration:  Args = --initialize-at-build-time=org.apache.fury.graalvm.Example   ","version":"0.10","tagName":"h2"},{"title":"Thread-safe Fury‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.10/guide/graalvm_serialization#thread-safe-fury","content":" import org.apache.fury.Fury; import org.apache.fury.ThreadLocalFury; import org.apache.fury.ThreadSafeFury; import org.apache.fury.util.Preconditions; import java.util.List; import java.util.Map; public class ThreadSafeExample { public record Foo ( int f1, String f2, List&lt;String&gt; f3, Map&lt;String, Long&gt; f4) { } static ThreadSafeFury fury; static { fury = new ThreadLocalFury(classLoader -&gt; { Fury f = Fury.builder().build(); // register and generate serializer code. f.register(Foo.class, true); return f; }); } public static void main(String[] args) { System.out.println(fury.deserialize(fury.serialize(&quot;abc&quot;))); System.out.println(fury.deserialize(fury.serialize(List.of(1,2,3)))); System.out.println(fury.deserialize(fury.serialize(Map.of(&quot;k1&quot;, 1, &quot;k2&quot;, 2)))); Foo foo = new Foo(10, &quot;abc&quot;, List.of(&quot;str1&quot;, &quot;str2&quot;), Map.of(&quot;k1&quot;, 10L, &quot;k2&quot;, 20L)); System.out.println(foo); byte[] bytes = fury.serialize(foo); Object o = fury.deserialize(bytes); System.out.println(o); } }   Then add org.apache.fury.graalvm.ThreadSafeExample build time init to native-image.properties configuration:  Args = --initialize-at-build-time=org.apache.fury.graalvm.ThreadSafeExample   ","version":"0.10","tagName":"h2"},{"title":"Framework Integration‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.10/guide/graalvm_serialization#framework-integration","content":" For framework developers, if you want to integrate fury for serialization, you can provided a configuration file to let the users to list all the classes they want to serialize, then you can load those classes and invokeorg.apache.fury.Fury.register(Class&lt;?&gt;, boolean) to register those classes in your Fury integration class, and configure that class be initialized at graalvm native image build time.  ","version":"0.10","tagName":"h2"},{"title":"Benchmark‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.10/guide/graalvm_serialization#benchmark","content":" Here we give two class benchmarks between Fury and Graalvm Serialization.  When Fury compression is disabled:  Struct: Fury is 46x speed, 43% size compared to JDK.Pojo: Fury is 12x speed, 56% size compared to JDK.  When Fury compression is enabled:  Struct: Fury is 24x speed, 31% size compared to JDK.Pojo: Fury is 12x speed, 48% size compared to JDK.  See [Benchmark.java] for benchmark code.  ","version":"0.10","tagName":"h2"},{"title":"Struct Benchmark‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.10/guide/graalvm_serialization#struct-benchmark","content":" Class Fields‚Äã  public class Struct implements Serializable { public int f1; public long f2; public float f3; public double f4; public int f5; public long f6; public float f7; public double f8; public int f9; public long f10; public float f11; public double f12; }   Benchmark Results‚Äã  No compression:  Benchmark repeat number: 400000 Object type: class org.apache.fury.graalvm.Struct Compress number: false Fury size: 76.0 JDK size: 178.0 Fury serialization took mills: 49 JDK serialization took mills: 2254 Compare speed: Fury is 45.70x speed of JDK Compare size: Fury is 0.43x size of JDK   Compress number:  Benchmark repeat number: 400000 Object type: class org.apache.fury.graalvm.Struct Compress number: true Fury size: 55.0 JDK size: 178.0 Fury serialization took mills: 130 JDK serialization took mills: 3161 Compare speed: Fury is 24.16x speed of JDK Compare size: Fury is 0.31x size of JDK   ","version":"0.10","tagName":"h3"},{"title":"Pojo Benchmark‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.10/guide/graalvm_serialization#pojo-benchmark","content":" Class Fields‚Äã  public class Foo implements Serializable { int f1; String f2; List&lt;String&gt; f3; Map&lt;String, Long&gt; f4; }   Benchmark Results‚Äã  No compression:  Benchmark repeat number: 400000 Object type: class org.apache.fury.graalvm.Foo Compress number: false Fury size: 541.0 JDK size: 964.0 Fury serialization took mills: 1663 JDK serialization took mills: 16266 Compare speed: Fury is 12.19x speed of JDK Compare size: Fury is 0.56x size of JDK   Compress number:  Benchmark repeat number: 400000 Object type: class org.apache.fury.graalvm.Foo Compress number: true Fury size: 459.0 JDK size: 964.0 Fury serialization took mills: 1289 JDK serialization took mills: 15069 Compare speed: Fury is 12.11x speed of JDK Compare size: Fury is 0.48x size of JDK  ","version":"0.10","tagName":"h3"},{"title":"Type Mapping of Xlang Serialization","type":0,"sectionRef":"#","url":"/docs/0.10/guide/xlang_type_mapping","content":"","keywords":"","version":"0.10"},{"title":"Type Mapping‚Äã","type":1,"pageTitle":"Type Mapping of Xlang Serialization","url":"/docs/0.10/guide/xlang_type_mapping#type-mapping","content":" Fury Type\tFury Type ID\tJava\tPython\tJavascript\tC++\tGolang\tRustbool\t1\tbool/Boolean\tbool\tBoolean\tbool\tbool\tbool int8\t2\tbyte/Byte\tint/pyfury.Int8\tType.int8()\tint8_t\tint8\ti8 int16\t3\tshort/Short\tint/pyfury.Int16\tType.int16()\tint16_t\tint16\ti6 int32\t4\tint/Integer\tint/pyfury.Int32\tType.int32()\tint32_t\tint32\ti32 var_int32\t5\tint/Integer\tint/pyfury.VarInt32\tType.varint32()\tfury::varint32_t\tfury.varint32\tfury::varint32 int64\t6\tlong/Long\tint/pyfury.Int64\tType.int64()\tint64_t\tint64\ti64 var_int64\t7\tlong/Long\tint/pyfury.VarInt64\tType.varint64()\tfury::varint64_t\tfury.varint64\tfury::varint64 sli_int64\t8\tlong/Long\tint/pyfury.SliInt64\tType.sliint64()\tfury::sliint64_t\tfury.sliint64\tfury::sliint64 float16\t9\tfloat/Float\tfloat/pyfury.Float16\tType.float16()\tfury::float16_t\tfury.float16\tfury::f16 float32\t10\tfloat/Float\tfloat/pyfury.Float32\tType.float32()\tfloat\tfloat32\tf32 float64\t11\tdouble/Double\tfloat/pyfury.Float64\tType.float64()\tdouble\tfloat64\tf64 string\t12\tString\tstr\tString\tstring\tstring\tString/str enum\t13\tEnum subclasses\tenum subclasses\t/\tenum\t/\tenum named_enum\t14\tEnum subclasses\tenum subclasses\t/\tenum\t/\tenum struct\t15\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct compatible_struct\t16\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct named_struct\t17\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct named_compatible_struct\t18\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct ext\t19\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct named_ext\t20\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct list\t21\tList/Collection\tlist/tuple\tarray\tvector\tslice\tVec set\t22\tSet\tset\t/\tset\tfury.Set\tSet map\t23\tMap\tdict\tMap\tunordered_map\tmap\tHashMap duration\t24\tDuration\ttimedelta\tNumber\tduration\tDuration\tDuration timestamp\t25\tInstant\tdatetime\tNumber\tstd::chrono::nanoseconds\tTime\tDateTime local_date\t26\tDate\tdatetime\tNumber\tstd::chrono::nanoseconds\tTime\tDateTime decimal\t27\tBigDecimal\tDecimal\tbigint\t/\t/\t/ binary\t28\tbyte[]\tbytes\t/\tuint8_t[n]/vector&lt;T&gt;\t[n]uint8/[]T\tVec&lt;uint8_t&gt; array\t29\tarray\tnp.ndarray\t/\t/\tarray/slice\tVec bool_array\t30\tbool[]\tndarray(np.bool_)\t/\tbool[n]\t[n]bool/[]T\tVec&lt;bool&gt; int8_array\t31\tbyte[]\tndarray(int8)\t/\tint8_t[n]/vector&lt;T&gt;\t[n]int8/[]T\tVec&lt;i18&gt; int16_array\t32\tshort[]\tndarray(int16)\t/\tint16_t[n]/vector&lt;T&gt;\t[n]int16/[]T\tVec&lt;i16&gt; int32_array\t33\tint[]\tndarray(int32)\t/\tint32_t[n]/vector&lt;T&gt;\t[n]int32/[]T\tVec&lt;i32&gt; int64_array\t34\tlong[]\tndarray(int64)\t/\tint64_t[n]/vector&lt;T&gt;\t[n]int64/[]T\tVec&lt;i64&gt; float16_array\t35\tfloat[]\tndarray(float16)\t/\tfury::float16_t[n]/vector&lt;T&gt;\t[n]float16/[]T\tVec&lt;fury::f16&gt; float32_array\t36\tfloat[]\tndarray(float32)\t/\tfloat[n]/vector&lt;T&gt;\t[n]float32/[]T\tVec&lt;f32&gt; float64_array\t37\tdouble[]\tndarray(float64)\t/\tdouble[n]/vector&lt;T&gt;\t[n]float64/[]T\tVec&lt;f64&gt; arrow record batch\t38\t/\t/\t/\t/\t/\t/ arrow table\t39\t/\t/\t/\t/\t/\t/  ","version":"0.10","tagName":"h2"},{"title":"Type info(not implemented currently)‚Äã","type":1,"pageTitle":"Type Mapping of Xlang Serialization","url":"/docs/0.10/guide/xlang_type_mapping#type-infonot-implemented-currently","content":" Due to differences between type systems of languages, those types can't be mapped one-to-one between languages.  If the user notices that one type on a language corresponds to multiple types in Fury type systems, for example, longin java has type int64/varint64/sliint64, it means the language lacks some types, and the user must provide extra type info when using Fury.  ","version":"0.10","tagName":"h2"},{"title":"Type annotation‚Äã","type":1,"pageTitle":"Type Mapping of Xlang Serialization","url":"/docs/0.10/guide/xlang_type_mapping#type-annotation","content":" If the type is a field of another class, users can provide meta hints for fields of a type, or for the whole type. Such information can be provided in other languages too:  java: use annotation.cpp: use macro and template.golang: use struct tag.python: use typehint.rust: use macro.  Here is en example:  Java: class Foo { @Int32Type(varint = true) int f1; List&lt;@Int32Type(varint = true) Integer&gt; f2; } Python: class Foo: f1: Int32Type(varint=True) f2: List[Int32Type(varint=True)]   ","version":"0.10","tagName":"h2"},{"title":"Type wrapper‚Äã","type":1,"pageTitle":"Type Mapping of Xlang Serialization","url":"/docs/0.10/guide/xlang_type_mapping#type-wrapper","content":" If the type is not a field of a class, the user must wrap this type with a Fury type to pass the extra type info.  For example, suppose Fury Java provide a VarInt64 type, when a user invoke fury.serialize(long_value), he need to invoke like fury.serialize(new VarInt64(long_value)). ","version":"0.10","tagName":"h2"},{"title":"Benchmark","type":0,"sectionRef":"#","url":"/docs/0.10/introduction/benchmark","content":"","keywords":"","version":"0.10"},{"title":"Java Serialization‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/0.10/introduction/benchmark#java-serialization","content":"         ","version":"0.10","tagName":"h3"},{"title":"Java Deserialization‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/0.10/introduction/benchmark#java-deserialization","content":"         See benchmarks for more benchmarks about type forward/backward compatibility, off-heap support, zero-copy serialization.  ","version":"0.10","tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/0.10/introduction/benchmark#javascript","content":"   The data used for this bar graph includes a complex object that has many kinds of field types, and the size of the JSON data is 3KB.  See benchmarks for the benchmark code. ","version":"0.10","tagName":"h3"},{"title":"Features","type":0,"sectionRef":"#","url":"/docs/0.10/introduction/features","content":"Features Multiple languages: Java/Python/C++/Golang/Javascript/Rust.Zero-copy: cross-language out-of-band serialization inspired by pickle5 and off-heap read/write.High performance: A highly-extensible JIT framework to generate serializer code at runtime in an async multi-thread way to speed serialization, providing 20-170x speed up by: reduce memory access by inline variable in generated code.reduce virtual method invocation by inline call in generated code.reduce conditional branching.reduce hash lookup.binary protocols: object graph, row format and so on. In addition to cross-language serialization, Fury also features at: Drop-in replace Java serialization frameworks such as JDK/Kryo/Hessian without modifying any code, but 100x faster. It can greatly improve the efficiency of high-performance RPC calls, data transfer and object persistence.JDK serialization 100% compatible, support java custom serializationwriteObject/readObject/writeReplace/readResolve/readObjectNoData natively.Supports shared and circular reference object serialization for golang.Supports automatic object serialization for golang.","keywords":"","version":"0.10"},{"title":"Overview","type":0,"sectionRef":"#","url":"/docs/0.10/introduction/overview","content":"","keywords":"","version":"0.10"},{"title":"Protocols‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.10/introduction/overview#protocols","content":" Different scenarios have different serialization requirements. Fury designed and implemented multiple binary protocols for those requirements:  Cross-language object graph protocol: Cross-language serialize any object automatically, no need for IDL definition, schema compilation and object to/from protocol conversion.Support shared reference and circular reference, no duplicate data or recursion error.Support object polymorphism. Native java/python object graph protocol: highly-optimized based on type system of the language.Row format protocol: a cache-friendly binary random access format, supports skipping serialization and partial serialization, and can convert to column-format automatically.  New protocols can be added easily based on fury existing buffer, encoding, meta, codegen and other capabilities. All of those share same codebase, and the optimization for one protocol can be reused by another protocol.  ","version":"0.10","tagName":"h2"},{"title":"Compatibility‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.10/introduction/overview#compatibility","content":" ","version":"0.10","tagName":"h2"},{"title":"Schema Compatibility‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.10/introduction/overview#schema-compatibility","content":" Fury java object graph serialization support class schema forward/backward compatibility. The serialization peer and deserialization peer can add/delete fields independently.  We plan to add support cross-language serialization after meta compression are finished.  ","version":"0.10","tagName":"h3"},{"title":"Binary Compatibility‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.10/introduction/overview#binary-compatibility","content":" We are still improving our protocols, binary compatibility are not ensured between fury releases for now. Please shade fury if you will upgrade fury in the future.  Binary compatibility will be ensured before fury 1.0.  ","version":"0.10","tagName":"h3"},{"title":"Security‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.10/introduction/overview#security","content":" Static serialization such as row format are secure by nature. But dynamic object graph serialization supports deserialize unregistered types, which can introduce security risks.  For example, the deserialization may invoke init constructor or equals/hashCode method, if the method body contains malicious code, the system will be at risks.  Fury provides a class registration mode option and enabled by default for this protocol, which allows deserializing trusted registered types or built-in types only for security.  Fury provides a class registration option and enabled by default for such protocols, which allows only deserializing trusted registered types or built-in types. Do not disable class registration or class registration checks unless you can ensure your environment is indeed secure. We are not responsible for security if you disabled the class registration option.  ","version":"0.10","tagName":"h2"},{"title":"RoadMap‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.10/introduction/overview#roadmap","content":" Meta compression, auto meta sharing and cross-language schema compatibility.AOT Framework for c++/golang to generate code statically.C++/Rust object graph serialization supportGolang/Rust/NodeJS row format supportProtoBuffer compatibility supportProtocols for features and knowledge graph serializationContinuously improve our serialization infrastructure for any new protocols  ","version":"0.10","tagName":"h2"},{"title":"How to Contribute‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.10/introduction/overview#how-to-contribute","content":" Please read the CONTRIBUTING guide for instructions on how to contribute. ","version":"0.10","tagName":"h2"},{"title":"Fury Row Format","type":0,"sectionRef":"#","url":"/docs/0.10/specification/row_format_spec","content":"","keywords":"","version":"0.10"},{"title":"Row Format‚Äã","type":1,"pageTitle":"Fury Row Format","url":"/docs/0.10/specification/row_format_spec#row-format","content":" Coming soon ","version":"0.10","tagName":"h2"},{"title":"Java Serialization","type":0,"sectionRef":"#","url":"/docs/0.10/guide/serialization","content":"","keywords":"","version":"0.10"},{"title":"Java object graph serialization‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.10/guide/serialization#java-object-graph-serialization","content":" When only java object serialization needed, this mode will have better performance compared to cross-language object graph serialization.  ","version":"0.10","tagName":"h2"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.10/guide/serialization#quick-start","content":" Note that fury creation is not cheap, the fury instances should be reused between serializations instead of creating it everytime. You should keep fury to a static global variable, or instance variable of some singleton object or limited objects.  Fury for single-thread usage:  import java.util.List; import java.util.Arrays; import org.apache.fury.*; import org.apache.fury.config.*; public class Example { public static void main(String[] args) { SomeClass object = new SomeClass(); // Note that Fury instances should be reused between // multiple serializations of different objects. Fury fury = Fury.builder().withLanguage(Language.JAVA) .requireClassRegistration(true) .build(); // Registering types can reduce class name serialization overhead, but not mandatory. // If class registration enabled, all custom types must be registered. fury.register(SomeClass.class); byte[] bytes = fury.serialize(object); System.out.println(fury.deserialize(bytes)); } }   Fury for multiple-thread usage:  import java.util.List; import java.util.Arrays; import org.apache.fury.*; import org.apache.fury.config.*; public class Example { public static void main(String[] args) { SomeClass object = new SomeClass(); // Note that Fury instances should be reused between // multiple serializations of different objects. ThreadSafeFury fury = new ThreadLocalFury(classLoader -&gt; { Fury f = Fury.builder().withLanguage(Language.JAVA) .withClassLoader(classLoader).build(); f.register(SomeClass.class); return f; }); byte[] bytes = fury.serialize(object); System.out.println(fury.deserialize(bytes)); } }   Fury instances reuse example:  import java.util.List; import java.util.Arrays; import org.apache.fury.*; import org.apache.fury.config.*; public class Example { // reuse fury. private static final ThreadSafeFury fury = new ThreadLocalFury(classLoader -&gt; { Fury f = Fury.builder().withLanguage(Language.JAVA) .withClassLoader(classLoader).build(); f.register(SomeClass.class); return f; }); public static void main(String[] args) { SomeClass object = new SomeClass(); byte[] bytes = fury.serialize(object); System.out.println(fury.deserialize(bytes)); } }   ","version":"0.10","tagName":"h2"},{"title":"FuryBuilder options‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.10/guide/serialization#furybuilder-options","content":" Option Name\tDescription\tDefault ValuetimeRefIgnored\tWhether to ignore reference tracking of all time types registered in TimeSerializers and subclasses of those types when ref tracking is enabled. If ignored, ref tracking of every time type can be enabled by invoking Fury#registerSerializer(Class, Serializer). For example, fury.registerSerializer(Date.class, new DateSerializer(fury, true)). Note that enabling ref tracking should happen before serializer codegen of any types which contain time fields. Otherwise, those fields will still skip ref tracking.\ttrue compressInt\tEnables or disables int compression for smaller size.\ttrue compressLong\tEnables or disables long compression for smaller size.\ttrue compressString\tEnables or disables string compression for smaller size.\tfalse classLoader\tThe classloader should not be updated; Fury caches class metadata. Use LoaderBinding or ThreadSafeFury for classloader updates.\tThread.currentThread().getContextClassLoader() compatibleMode\tType forward/backward compatibility config. Also Related to checkClassVersion config. SCHEMA_CONSISTENT: Class schema must be consistent between serialization peer and deserialization peer. COMPATIBLE: Class schema can be different between serialization peer and deserialization peer. They can add/delete fields independently. See more.\tCompatibleMode.SCHEMA_CONSISTENT checkClassVersion\tDetermines whether to check the consistency of the class schema. If enabled, Fury checks, writes, and checks consistency using the classVersionHash. It will be automatically disabled when CompatibleMode#COMPATIBLE is enabled. Disabling is not recommended unless you can ensure the class won't evolve.\tfalse checkJdkClassSerializable\tEnables or disables checking of Serializable interface for classes under java.*. If a class under java.* is not Serializable, Fury will throw an UnsupportedOperationException.\ttrue registerGuavaTypes\tWhether to pre-register Guava types such as RegularImmutableMap/RegularImmutableList. These types are not public API, but seem pretty stable.\ttrue requireClassRegistration\tDisabling may allow unknown classes to be deserialized, potentially causing security risks.\ttrue suppressClassRegistrationWarnings\tWhether to suppress class registration warnings. The warnings can be used for security audit, but may be annoying, this suppression will be enabled by default.\ttrue metaShareEnabled\tEnables or disables meta share mode.\ttrue if CompatibleMode.Compatible is set, otherwise false. scopedMetaShareEnabled\tScoped meta share focuses on a single serialization process. Metadata created or identified during this process is exclusive to it and is not shared with by other serializations.\ttrue if CompatibleMode.Compatible is set, otherwise false. metaCompressor\tSet a compressor for meta compression. Note that the passed MetaCompressor should be thread-safe. By default, a Deflater based compressor DeflaterMetaCompressor will be used. Users can pass other compressor such as zstd for better compression rate.\tDeflaterMetaCompressor deserializeNonexistentClass\tEnables or disables deserialization/skipping of data for non-existent classes.\ttrue if CompatibleMode.Compatible is set, otherwise false. codeGenEnabled\tDisabling may result in faster initial serialization but slower subsequent serializations.\ttrue asyncCompilationEnabled\tIf enabled, serialization uses interpreter mode first and switches to JIT serialization after async serializer JIT for a class is finished.\tfalse scalaOptimizationEnabled\tEnables or disables Scala-specific serialization optimization.\tfalse copyRef\tWhen disabled, the copy performance will be better. But fury deep copy will ignore circular and shared reference. Same reference of an object graph will be copied into different objects in one Fury#copy.\ttrue serializeEnumByName\tWhen Enabled, fury serialize enum by name instead of ordinal.\tfalse  ","version":"0.10","tagName":"h2"},{"title":"Advanced Usage‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.10/guide/serialization#advanced-usage","content":" ","version":"0.10","tagName":"h2"},{"title":"Fury creation‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.10/guide/serialization#fury-creation","content":" Single thread fury:  Fury fury = Fury.builder() .withLanguage(Language.JAVA) // enable reference tracking for shared/circular reference. // Disable it will have better performance if no duplicate reference. .withRefTracking(false) .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT) // enable type forward/backward compatibility // disable it for small size and better performance. // .withCompatibleMode(CompatibleMode.COMPATIBLE) // enable async multi-threaded compilation. .withAsyncCompilation(true) .build(); byte[] bytes = fury.serialize(object); System.out.println(fury.deserialize(bytes));   Thread-safe fury:  ThreadSafeFury fury = Fury.builder() .withLanguage(Language.JAVA) // enable reference tracking for shared/circular reference. // Disable it will have better performance if no duplicate reference. .withRefTracking(false) // compress int for smaller size // .withIntCompressed(true) // compress long for smaller size // .withLongCompressed(true) .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT) // enable type forward/backward compatibility // disable it for small size and better performance. // .withCompatibleMode(CompatibleMode.COMPATIBLE) // enable async multi-threaded compilation. .withAsyncCompilation(true) .buildThreadSafeFury(); byte[] bytes = fury.serialize(object); System.out.println(fury.deserialize(bytes));   ","version":"0.10","tagName":"h3"},{"title":"Handling Class Schema Evolution in Serialization‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.10/guide/serialization#handling-class-schema-evolution-in-serialization","content":" In many systems, the schema of a class used for serialization may change over time. For instance, fields within a class may be added or removed. When serialization and deserialization processes use different versions of jars, the schema of the class being deserialized may differ from the one used during serialization.  By default, Fury serializes objects using the CompatibleMode.SCHEMA_CONSISTENT mode. This mode assumes that the deserialization process uses the same class schema as the serialization process, minimizing payload overhead. However, if there is a schema inconsistency, deserialization will fail.  If the schema is expected to change, to make deserialization succeed, i.e. schema forward/backward compatibility. Users must configure Fury to use CompatibleMode.COMPATIBLE. This can be done using theFuryBuilder#withCompatibleMode(CompatibleMode.COMPATIBLE) method. In this compatible mode, deserialization can handle schema changes such as missing or extra fields, allowing it to succeed even when the serialization and deserialization processes have different class schemas.  Here is an example of creating Fury to support schema evolution:  Fury fury = Fury.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .build(); byte[] bytes = fury.serialize(object); System.out.println(fury.deserialize(bytes));   This compatible mode involves serializing class metadata into the serialized output. Despite Fury's use of sophisticated compression techniques to minimize overhead, there is still some additional space cost associated with class metadata.  To further reduce metadata costs, Fury introduces a class metadata sharing mechanism, which allows the metadata to be sent to the deserialization process only once. For more details, please refer to the Meta Sharingsection.  ","version":"0.10","tagName":"h3"},{"title":"Smaller size‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.10/guide/serialization#smaller-size","content":" FuryBuilder#withIntCompressed/FuryBuilder#withLongCompressed can be used to compress int/long for smaller size. Normally compress int is enough.  Both compression are enabled by default, if the serialized is not important, for example, you use flatbuffers for serialization before, which doesn't compress anything, then you should disable compression. If your data are all numbers, the compression may bring 80% performance regression.  For int compression, fury use 1~5 bytes for encoding. First bit in every byte indicate whether has next byte. if first bit is set, then next byte will be read util first bit of next byte is unset.  For long compression, fury support two encoding:  Fury SLI(Small long as int) Encoding (used by default): If long is in [-1073741824, 1073741823], encode as 4 bytes int: | little-endian: ((int) value) &lt;&lt; 1 |Otherwise write as 9 bytes: | 0b1 | little-endian 8bytes long | Fury PVL(Progressive Variable-length Long) Encoding: First bit in every byte indicate whether has next byte. if first bit is set, then next byte will be read util first bit of next byte is unset.Negative number will be converted to positive number by (v &lt;&lt; 1) ^ (v &gt;&gt; 63) to reduce cost of small negative numbers.  If a number are long type, it can't be represented by smaller bytes mostly, the compression won't get good enough result, not worthy compared to performance cost. Maybe you should try to disable long compression if you find it didn't bring much space savings.  ","version":"0.10","tagName":"h3"},{"title":"Object deep copy‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.10/guide/serialization#object-deep-copy","content":" Deep copy example:  Fury fury = Fury.builder().withRefCopy(true).build(); SomeClass a = xxx; SomeClass copied = fury.copy(a);   Make fury deep copy ignore circular and shared reference, this deep copy mode will ignore circular and shared reference. Same reference of an object graph will be copied into different objects in one Fury#copy.  Fury fury = Fury.builder().withRefCopy(false).build(); SomeClass a = xxx; SomeClass copied = fury.copy(a);   ","version":"0.10","tagName":"h3"},{"title":"Implement a customized serializer‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.10/guide/serialization#implement-a-customized-serializer","content":" In some cases, you may want to implement a serializer for your type, especially some class customize serialization by JDK writeObject/writeReplace/readObject/readResolve, which is very inefficient. For example, you don't want following Foo#writeObjectgot invoked, you can take following FooSerializer as an example:  class Foo { public long f1; private void writeObject(ObjectOutputStream s) throws IOException { System.out.println(f1); s.defaultWriteObject(); } } class FooSerializer extends Serializer&lt;Foo&gt; { public FooSerializer(Fury fury) { super(fury, Foo.class); } @Override public void write(MemoryBuffer buffer, Foo value) { buffer.writeInt64(value.f1); } @Override public Foo read(MemoryBuffer buffer) { Foo foo = new Foo(); foo.f1 = buffer.readInt64(); return foo; } }   Register serializer:  Fury fury = getFury(); fury.registerSerializer(Foo.class, new FooSerializer(fury));   ","version":"0.10","tagName":"h3"},{"title":"Security & Class Registration‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.10/guide/serialization#security--class-registration","content":" FuryBuilder#requireClassRegistration can be used to disable class registration, this will allow to deserialize objects unknown types, more flexible but may be insecure if the classes contains malicious code.  Do not disable class registration unless you can ensure your environment is secure. Malicious code in init/equals/hashCode can be executed when deserializing unknown/untrusted types when this option disabled.  Class registration can not only reduce security risks, but also avoid classname serialization cost.  You can register class with API Fury#register.  Note that class registration order is important, serialization and deserialization peer should have same registration order.  Fury fury = xxx; fury.register(SomeClass.class); fury.register(SomeClass1.class, 200);   If you invoke FuryBuilder#requireClassRegistration(false) to disable class registration check, you can set org.apache.fury.resolver.ClassChecker by ClassResolver#setClassChecker to control which classes are allowed for serialization. For example, you can allow classes started with org.example.* by:  Fury fury = xxx; fury.getClassResolver().setClassChecker( (classResolver, className) -&gt; className.startsWith(&quot;org.example.&quot;));   AllowListChecker checker = new AllowListChecker(AllowListChecker.CheckLevel.STRICT); ThreadSafeFury fury = new ThreadLocalFury(classLoader -&gt; { Fury f = Fury.builder().requireClassRegistration(true).withClassLoader(classLoader).build(); f.getClassResolver().setClassChecker(checker); checker.addListener(f.getClassResolver()); return f; }); checker.allowClass(&quot;org.example.*&quot;);   Fury also provided a org.apache.fury.resolver.AllowListChecker which is allowed/disallowed list based checker to simplify the customization of class check mechanism. You can use this checker or implement more sophisticated checker by yourself.  ","version":"0.10","tagName":"h3"},{"title":"Register class by name‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.10/guide/serialization#register-class-by-name","content":" Register class by id will have better performance and smaller space overhead. But in some cases, management for a bunch of type id is complex. In such cases, registering class by name using APIregister(Class&lt;?&gt; cls, String namespace, String typeName) is recommended.  fury.register(Foo.class, &quot;demo&quot;, &quot;Foo&quot;);   If there are no duplicate name for type, namespace can be left as empty to reduce serialized size.  Do not use this API to register class since it will increase serialized size a lot compared to register class by id  ","version":"0.10","tagName":"h3"},{"title":"Serializer Registration‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.10/guide/serialization#serializer-registration","content":" You can also register a custom serializer for a class by Fury#registerSerializer API.  Or implement java.io.Externalizable for a class.  ","version":"0.10","tagName":"h3"},{"title":"Zero-Copy Serialization‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.10/guide/serialization#zero-copy-serialization","content":" import org.apache.fury.*; import org.apache.fury.config.*; import org.apache.fury.serializer.BufferObject; import org.apache.fury.memory.MemoryBuffer; import java.util.*; import java.util.stream.Collectors; public class ZeroCopyExample { // Note that fury instance should be reused instead of creation every time. static Fury fury = Fury.builder() .withLanguage(Language.JAVA) .build(); // mvn exec:java -Dexec.mainClass=&quot;io.ray.fury.examples.ZeroCopyExample&quot; public static void main(String[] args) { List&lt;Object&gt; list = Arrays.asList(&quot;str&quot;, new byte[1000], new int[100], new double[100]); Collection&lt;BufferObject&gt; bufferObjects = new ArrayList&lt;&gt;(); byte[] bytes = fury.serialize(list, e -&gt; !bufferObjects.add(e)); List&lt;MemoryBuffer&gt; buffers = bufferObjects.stream() .map(BufferObject::toBuffer).collect(Collectors.toList()); System.out.println(fury.deserialize(bytes, buffers)); } }   ","version":"0.10","tagName":"h3"},{"title":"Meta Sharing‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.10/guide/serialization#meta-sharing","content":" Fury supports share type metadata (class name, field name, final field type information, etc.) between multiple serializations in a context (ex. TCP connection), and this information will be sent to the peer during the first serialization in the context. Based on this metadata, the peer can rebuild the same deserializer, which avoids transmitting metadata for subsequent serializations and reduces network traffic pressure and supports type forward/backward compatibility automatically.  // Fury.builder() // .withLanguage(Language.JAVA) // .withRefTracking(false) // // share meta across serialization. // .withMetaContextShare(true) // Not thread-safe fury. MetaContext context = xxx; fury.getSerializationContext().setMetaContext(context); byte[] bytes = fury.serialize(o); // Not thread-safe fury. MetaContext context = xxx; fury.getSerializationContext().setMetaContext(context); fury.deserialize(bytes); // Thread-safe fury fury.setClassLoader(beanA.getClass().getClassLoader()); byte[] serialized = fury.execute( f -&gt; { f.getSerializationContext().setMetaContext(context); return f.serialize(beanA); } ); // thread-safe fury fury.setClassLoader(beanA.getClass().getClassLoader()); Object newObj = fury.execute( f -&gt; { f.getSerializationContext().setMetaContext(context); return f.deserialize(serialized); } );   ","version":"0.10","tagName":"h3"},{"title":"Deserialize non-existent classes‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.10/guide/serialization#deserialize-non-existent-classes","content":" Fury support deserializing non-existent classes, this feature can be enabled by FuryBuilder#deserializeNonexistentClass(true). When enabled, and metadata sharing enabled, Fury will store the deserialized data of this type in a lazy subclass of Map. By using the lazy map implemented by Fury, the rebalance cost of filling map during deserialization can be avoided, which further improves performance. If this data is sent to another process and the class exists in this process, the data will be deserialized into the object of this type without losing any information.  If metadata sharing is not enabled, the new class data will be skipped and an NonexistentSkipClass stub object will be returned.  ","version":"0.10","tagName":"h3"},{"title":"Coping/Mapping object from one type to another type‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.10/guide/serialization#copingmapping-object-from-one-type-to-another-type","content":" Fury support mapping object from one type to another type.  Notes: This mapping will execute a deep copy, all mapped fields are serialized into binary and deserialized from that binary to map into another type.All struct types must be registered with same ID, otherwise Fury can not mapping to correct struct type. Be careful when you use Fury#register(Class), because fury will allocate an auto-grown ID which might be inconsistent if you register classes with different order between Fury instance.  public class StructMappingExample { static class Struct1 { int f1; String f2; public Struct1(int f1, String f2) { this.f1 = f1; this.f2 = f2; } } static class Struct2 { int f1; String f2; double f3; } static ThreadSafeFury fury1 = Fury.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE).buildThreadSafeFury(); static ThreadSafeFury fury2 = Fury.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE).buildThreadSafeFury(); static { fury1.register(Struct1.class); fury2.register(Struct2.class); } public static void main(String[] args) { Struct1 struct1 = new Struct1(10, &quot;abc&quot;); Struct2 struct2 = (Struct2) fury2.deserialize(fury1.serialize(struct1)); Assert.assertEquals(struct2.f1, struct1.f1); Assert.assertEquals(struct2.f2, struct1.f2); struct1 = (Struct1) fury1.deserialize(fury2.serialize(struct2)); Assert.assertEquals(struct1.f1, struct2.f1); Assert.assertEquals(struct1.f2, struct2.f2); } }   ","version":"0.10","tagName":"h3"},{"title":"Migration‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.10/guide/serialization#migration","content":" ","version":"0.10","tagName":"h2"},{"title":"JDK migration‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.10/guide/serialization#jdk-migration","content":" If you use jdk serialization before, and you can't upgrade your client and server at the same time, which is common for online application. Fury provided an util method org.apache.fury.serializer.JavaSerializer.serializedByJDK to check whether the binary are generated by jdk serialization, you use following pattern to make exiting serialization protocol-aware, then upgrade serialization to fury in an async rolling-up way:  if (JavaSerializer.serializedByJDK(bytes)) { ObjectInputStream objectInputStream=xxx; return objectInputStream.readObject(); } else { return fury.deserialize(bytes); }   ","version":"0.10","tagName":"h3"},{"title":"Upgrade fury‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.10/guide/serialization#upgrade-fury","content":" Currently binary compatibility is ensured for minor versions only. For example, if you are using furyv0.2.0, binary compatibility will be provided if you upgrade to fury v0.2.1. But if upgrade to fury v0.4.1, no binary compatibility are ensured. Most of the time there is no need to upgrade fury to newer major version, the current version is fast and compact enough, and we provide some minor fix for recent older versions.  But if you do want to upgrade fury for better performance and smaller size, you need to write fury version as header to serialized data using code like following to keep binary compatibility:  MemoryBuffer buffer = xxx; buffer.writeVarInt32(2); fury.serialize(buffer, obj);   Then for deserialization, you need:  MemoryBuffer buffer = xxx; int furyVersion = buffer.readVarInt32(); Fury fury = getFury(furyVersion); fury.deserialize(buffer);   getFury is a method to load corresponding fury, you can shade and relocate different version of fury to different package, and load fury by version.  If you upgrade fury by minor version, or you won't have data serialized by older fury, you can upgrade fury directly, no need to versioning the data.  ","version":"0.10","tagName":"h3"},{"title":"Trouble shooting‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.10/guide/serialization#trouble-shooting","content":" ","version":"0.10","tagName":"h2"},{"title":"Class inconsistency and class version check‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.10/guide/serialization#class-inconsistency-and-class-version-check","content":" If you create fury without setting CompatibleMode to org.apache.fury.config.CompatibleMode.COMPATIBLE, and you got a strange serialization error, it may be caused by class inconsistency between serialization peer and deserialization peer.  In such cases, you can invoke FuryBuilder#withClassVersionCheck to create fury to validate it, if deserialization throws org.apache.fury.exception.ClassNotCompatibleException, it shows class are inconsistent, and you should create fury withFuryBuilder#withCompaibleMode(CompatibleMode.COMPATIBLE).  CompatibleMode.COMPATIBLE has more performance and space cost, do not set it by default if your classes are always consistent between serialization and deserialization.  ","version":"0.10","tagName":"h3"},{"title":"Deserialize POJO into another type‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.10/guide/serialization#deserialize-pojo-into-another-type","content":" Fury allows you to serialize one POJO and deserialize it into a different POJO. The different POJO means the schema inconsistency. Users must to configure Fury withCompatibleMode set to org.apache.fury.config.CompatibleMode.COMPATIBLE.  public class DeserializeIntoType { static class Struct1 { int f1; String f2; public Struct1(int f1, String f2) { this.f1 = f1; this.f2 = f2; } } static class Struct2 { int f1; String f2; double f3; } static ThreadSafeFury fury = Fury.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE).buildThreadSafeFury(); public static void main(String[] args) { Struct1 struct1 = new Struct1(10, &quot;abc&quot;); byte[] data = fury.serializeJavaObject(struct1); Struct2 struct2 = (Struct2) fury.deserializeJavaObject(bytes, Struct2.class); } }   ","version":"0.10","tagName":"h3"},{"title":"Use wrong API for deserialization‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.10/guide/serialization#use-wrong-api-for-deserialization","content":" If you serialize an object by invoking Fury#serialize, you should invoke Fury#deserialize for deserialization instead ofFury#deserializeJavaObject.  If you serialize an object by invoking Fury#serializeJavaObject, you should invoke Fury#deserializeJavaObject for deserialization instead of Fury#deserializeJavaObjectAndClass/Fury#deserialize.  If you serialize an object by invoking Fury#serializeJavaObjectAndClass, you should invoke Fury#deserializeJavaObjectAndClass for deserialization instead of Fury#deserializeJavaObject/Fury#deserialize. ","version":"0.10","tagName":"h3"},{"title":"Fury Java Serialization Format","type":0,"sectionRef":"#","url":"/docs/0.10/specification/java_serialization_spec","content":"","keywords":"","version":"0.10"},{"title":"Spec overview‚Äã","type":1,"pageTitle":"Fury Java Serialization Format","url":"/docs/0.10/specification/java_serialization_spec#spec-overview","content":" Fury Java Serialization is an automatic object serialization framework that supports reference and polymorphism. Fury will convert an object from/to fury java serialization binary format. Fury has two core concepts for java serialization:  Fury Java Binary formatFramework to convert object to/from Fury Java Binary format  The serialization format is a dynamic binary format. The dynamics and reference/polymorphism support make Fury flexible, much more easy to use, but also introduce more complexities compared to static serialization frameworks. So the format will be more complex.  Here is the overall format:  | fury header | object ref meta | object class meta | object value data |   The data are serialized using little endian byte order overall. If bytes swap is costly for some object, Fury will write the byte order for that object into the data instead of converting it to little endian.  ","version":"0.10","tagName":"h2"},{"title":"Fury header‚Äã","type":1,"pageTitle":"Fury Java Serialization Format","url":"/docs/0.10/specification/java_serialization_spec#fury-header","content":" Fury header consists starts one byte:  | 4 bits | 1 bit | 1 bit | 1 bit | 1 bit | optional 4 bytes | +---------------+-------+-------+--------+-------+------------------------------------+ | reserved bits | oob | xlang | endian | null | unsigned int for meta start offset |   null flag: 1 when object is null, 0 otherwise. If an object is null, other bits won't be set.endian flag: 1 when data is encoded by little endian, 0 for big endian.xlang flag: 1 when serialization uses xlang format, 0 when serialization uses Fury java format.oob flag: 1 when passed BufferCallback is not null, 0 otherwise.  If meta share mode is enabled, an uncompressed unsigned int is appended to indicate the start offset of metadata.  ","version":"0.10","tagName":"h2"},{"title":"Reference Meta‚Äã","type":1,"pageTitle":"Fury Java Serialization Format","url":"/docs/0.10/specification/java_serialization_spec#reference-meta","content":" Reference tracking handles whether the object is null, and whether to track reference for the object by writing corresponding flags and maintaining internal state.  Reference flags:  Flag\tByte Value\tDescriptionNULL FLAG\t-3\tThis flag indicates the object is a null value. We don't use another byte to indicate REF, so that we can save one byte. REF FLAG\t-2\tThis flag indicates the object is already serialized previously, and fury will write a ref id with unsigned varint format instead of serialize it again NOT_NULL VALUE FLAG\t-1\tThis flag indicates the object is a non-null value and fury doesn't track ref for this type of object. REF VALUE FLAG\t0\tThis flag indicates the object is referencable and the first time to serialize.  When reference tracking is disabled globally or for specific types, or for certain types within a particular context(e.g., a field of a class), only the NULL and NOT_NULL VALUE flags will be used for reference meta.  ","version":"0.10","tagName":"h2"},{"title":"Class Meta‚Äã","type":1,"pageTitle":"Fury Java Serialization Format","url":"/docs/0.10/specification/java_serialization_spec#class-meta","content":" Fury supports to register class by an optional id, the registration can be used for security check and class identification. If a class is registered, it will have a user-provided or an auto-growing unsigned int i.e. class_id.  Depending on whether meta share mode and registration is enabled for current class, Fury will write class meta differently.  ","version":"0.10","tagName":"h2"},{"title":"Schema consistent‚Äã","type":1,"pageTitle":"Fury Java Serialization Format","url":"/docs/0.10/specification/java_serialization_spec#schema-consistent","content":" If schema consistent mode is enabled globally or enabled for current class, class meta will be written as follows:  If class is registered, it will be written as a fury unsigned varint: class_id &lt;&lt; 1.If class is not registered: If class is not an array, fury will write one byte 0bxxxxxxx1 first, then write class name. The first little bit is 1, which is different from first bit 0 of encoded class id. Fury can use this information to determine whether to read class by class id for deserialization. If class is not registered and class is an array, fury will write one byte dimensions &lt;&lt; 1 | 1 first, then write component class subsequently. This can reduce array class name cost if component class is or will be serialized.Class will be written as two enumerated fury unsigned by default: package name and class name. If meta share mode is enabled, class will be written as an unsigned varint which points to index in MetaContext.  ","version":"0.10","tagName":"h3"},{"title":"Schema evolution‚Äã","type":1,"pageTitle":"Fury Java Serialization Format","url":"/docs/0.10/specification/java_serialization_spec#schema-evolution","content":" If schema evolution mode is enabled globally or enabled for current class, class meta will be written as follows:  If meta share mode is not enabled, class meta will be written as schema consistent mode. Additionally, field meta such as field type and name will be written with the field value using a key-value like layout.If meta share mode is enabled, class meta will be written as a meta-share encoded binary if class hasn't been written before, otherwise an unsigned varint id which references to previous written class meta will be written.  ","version":"0.10","tagName":"h3"},{"title":"Meta share‚Äã","type":1,"pageTitle":"Fury Java Serialization Format","url":"/docs/0.10/specification/java_serialization_spec#meta-share","content":" This mode will forbid streaming writing since it needs to look back for update the start offset after the whole object graph writing and meta collecting is finished. Only in this way we can ensure deserialization failure doesn't lost shared meta. Meta streamline will be supported in the future for enclosed meta sharing which doesn't cross multiple serializations of different objects.  For Schema consistent mode, class will be encoded as an enumerated string by full class name. Here we mainly describe the meta layout for schema evolution mode:  | 8 bytes global meta header | 1~2 bytes | variable bytes | variable bytes | variable bytes | +-------------------------------+-------------|--------------------+-------------------+----------------+ | 50 bits hash + 14 bits header | type header | current class meta | parent class meta | ... |   Class meta are encoded from parent class to leaf class, only class with serializable fields will be encoded.  ","version":"0.10","tagName":"h2"},{"title":"Global meta header‚Äã","type":1,"pageTitle":"Fury Java Serialization Format","url":"/docs/0.10/specification/java_serialization_spec#global-meta-header","content":" Meta header is a 64 bits number value encoded in little endian order.  lower 12 bits are used to encode meta size. If meta size &gt;= 0b1111_1111_1111, then writemeta_ size - 0b1111_1111_1111 next.13rd bit is used to indicate whether to write fields meta. When this class is schema-consistent or use registered serializer, fields meta will be skipped. Class Meta will be used for share namespace + type name only.14rd bit is used to indicate whether meta is compressed.Other 50 bits is used to store the unique hash of flags + all layers class meta.  ","version":"0.10","tagName":"h3"},{"title":"Type header‚Äã","type":1,"pageTitle":"Fury Java Serialization Format","url":"/docs/0.10/specification/java_serialization_spec#type-header","content":" Lowest 4 digits 0b0000~0b1110 are used to record num classes. 0b1111 is preserved to indicate that Fury need to read more bytes for length using Fury unsigned int encoding. If current class doesn't has parent class, or parent class doesn't have fields to serialize, or we're in a context which serialize fields of current class only(ObjectStreamSerializer#SlotInfo is an example), num classes will be 1.Other 4 bits are preserved to future extensions.If num classes are greater than or equal to 0b1111, write num_classes - 0b1111 as varuint next.  ","version":"0.10","tagName":"h3"},{"title":"Single layer class meta‚Äã","type":1,"pageTitle":"Fury Java Serialization Format","url":"/docs/0.10/specification/java_serialization_spec#single-layer-class-meta","content":" | unsigned varint | meta string | meta string | field info: variable bytes | variable bytes | ... | +----------------------------+-----------------------+---------------------+-------------------------------+-----------------+-----+ | num fields + register flag | header + package name | header + class name | header + type id + field name | next field info | ... |   num fields: encode num fields &lt;&lt; 1 | register flag(1 when class registered) as unsigned varint. If class is registered, then an unsigned varint class id will be written next, package and class name will be omitted.If current class is schema consistent, then num field will be 0 to flag it.If current class isn't schema consistent, then num field will be the number of compatible fields. For example, users can use tag id to mark some field as compatible field in schema consistent context. In such cases, schema consistent fields will be serialized first, then compatible fields will be serialized next. At deserialization, Fury will use fields info of those fields which aren't annotated by tag id for deserializing schema consistent fields, then use fields info in meta for deserializing compatible fields. Package name encoding(omitted when class is registered): encoding algorithm: UTF8/ALL_TO_LOWER_SPECIAL/LOWER_UPPER_DIGIT_SPECIALHeader: 6 bits size | 2 bits encoding flags. The 6 bits size: 0~63 will be used to indicate size 0~63, the value 63 the size need more byte to read, the encoding will encode size - 63 as a varint next. Class name encoding(omitted when class is registered): encoding algorithm: UTF8/LOWER_UPPER_DIGIT_SPECIAL/FIRST_TO_LOWER_SPECIAL/ALL_TO_LOWER_SPECIALheader: 6 bits size | 2 bits encoding flags. The 6 bits size: 0~63 will be used to indicate size 0~63, the value 63 the size need more byte to read, the encoding will encode size - 63 as a varint next. Field info: header(8 bits): 3 bits size + 2 bits field name encoding + polymorphism flag + nullability flag + ref tracking flag. Users can use annotation to provide those info. 2 bits field name encoding: encoding: UTF8/ALL_TO_LOWER_SPECIAL/LOWER_UPPER_DIGIT_SPECIAL/TAG_IDIf tag id is used, i.e. field name is written by an unsigned varint tag id. 2 bits encoding will be 11. size of field name: The 3 bits size: 0~7 will be used to indicate length 1~7, the value 6 the size read more bytes, the encoding will encode size - 7 as a varint next.If encoding is TAG_ID, then num_bytes of field name will be used to store tag id. ref tracking: when set to 1, ref tracking will be enabled for this field.nullability: when set to 1, this field can be null.polymorphism: when set to 1, the actual type of field will be the declared field type even the type if not final. type id: For registered type-consistent classes, it will be the registered class id.Otherwise it will be encoded as OBJECT_ID if it isn't final and FINAL_OBJECT_ID if it's final. The meta for such types is written separately instead of inlining here is to reduce meta space cost if object of this type is serialized in current object graph multiple times, and the field value may be null too. Field name: If type id is set, type id will be used instead. Otherwise meta string encoding length and data will be written instead.  Field order are left as implementation details, which is not exposed to specification, the deserialization need to resort fields based on Fury field comparator. In this way, fury can compute statistics for field names or types and using a more compact encoding.  ","version":"0.10","tagName":"h3"},{"title":"Other layers class meta‚Äã","type":1,"pageTitle":"Fury Java Serialization Format","url":"/docs/0.10/specification/java_serialization_spec#other-layers-class-meta","content":" Same encoding algorithm as the previous layer except:  header + package name: Header: If package name has been written before: varint index + sharing flag(set) will be writtenIf package name hasn't been written before: If meta string encoding is LOWER_SPECIAL and the length of encoded string &lt;= 64, then header will be6 bits size + encoding flag(set) + sharing flag(unset).Otherwise, header will be 3 bits unset + 3 bits encoding flags + encoding flag(unset) + sharing flag(unset)  ","version":"0.10","tagName":"h3"},{"title":"Meta String‚Äã","type":1,"pageTitle":"Fury Java Serialization Format","url":"/docs/0.10/specification/java_serialization_spec#meta-string","content":" Meta string is mainly used to encode meta strings such as class name and field names.  ","version":"0.10","tagName":"h2"},{"title":"Encoding Algorithms‚Äã","type":1,"pageTitle":"Fury Java Serialization Format","url":"/docs/0.10/specification/java_serialization_spec#encoding-algorithms","content":" String binary encoding algorithm:  Algorithm\tPattern\tDescriptionLOWER_SPECIAL\ta-z._$|\tevery char is written using 5 bits, a-z: 0b00000~0b11001, ._$|: 0b11010~0b11101, prepend one bit at the start to indicate whether strip last char since last byte may have 7 redundant bits(1 indicates strip last char) LOWER_UPPER_DIGIT_SPECIAL\ta-zA-Z0~9._\tevery char is written using 6 bits, a-z: 0b00000~0b11001, A-Z: 0b11010~0b110011, 0~9: 0b110100~0b111101, ._: 0b111110~0b111111, prepend one bit at the start to indicate whether strip last char since last byte may have 7 redundant bits(1 indicates strip last char) UTF-8\tany chars\tUTF-8 encoding  Encoding flags:  Encoding Flag\tPattern\tEncoding AlgorithmLOWER_SPECIAL\tevery char is in a-z._$|\tLOWER_SPECIAL FIRST_TO_LOWER_SPECIAL\tevery char is in a-z[c1,c2] except first char is upper case\treplace first upper case char to lower case, then use LOWER_SPECIAL ALL_TO_LOWER_SPECIAL\tevery char is in a-zA-Z[c1,c2]\treplace every upper case char by | + lower case, then use LOWER_SPECIAL, use this encoding if it's smaller than Encoding LOWER_UPPER_DIGIT_SPECIAL LOWER_UPPER_DIGIT_SPECIAL\tevery char is in a-zA-Z[c1,c2]\tuse LOWER_UPPER_DIGIT_SPECIAL encoding if it's smaller than Encoding FIRST_TO_LOWER_SPECIAL UTF8\tany utf-8 char\tuse UTF-8 encoding Compression\tany utf-8 char\tlossless compression  Notes:  For package name encoding, c1,c2 should be ._; For field/type name encoding, c1,c2 should be _$;Depending on cases, one can choose encoding flags + data jointly, uses 3 bits of first byte for flags and other bytes for data.  ","version":"0.10","tagName":"h3"},{"title":"Shared meta string‚Äã","type":1,"pageTitle":"Fury Java Serialization Format","url":"/docs/0.10/specification/java_serialization_spec#shared-meta-string","content":" The shared meta string format consists of header and encoded string binary. Header of encoded string binary will be inlined in shared meta header.  Header is written using little endian order, Fury can read this flag first to determine how to deserialize the data.  Write by data‚Äã  If string hasn't been written before, the data will be written as follows:  | unsigned varint: string binary size + 1 bit: not written before | 56 bits: unique hash | 3 bits encoding flags + string binary |   If string binary size is less than 16 bytes, the hash will be omitted to save spaces. Unique hash can be omitted too if caller pass a flag to disable it. In such cases, the format will be:  | unsigned varint: string binary size + 1 bit: not written before | 3 bits encoding flags + string binary |   Write by ref‚Äã  If string has been written before, the data will be written as follows:  | unsigned varint: written string id + 1 bit: written before |   ","version":"0.10","tagName":"h3"},{"title":"Value Format‚Äã","type":1,"pageTitle":"Fury Java Serialization Format","url":"/docs/0.10/specification/java_serialization_spec#value-format","content":" ","version":"0.10","tagName":"h2"},{"title":"Basic types‚Äã","type":1,"pageTitle":"Fury Java Serialization Format","url":"/docs/0.10/specification/java_serialization_spec#basic-types","content":" Bool‚Äã  size: 1 byteformat: 0 for false, 1 for true  Byte‚Äã  size: 1 byteformat: write as pure byte.  Short‚Äã  size: 2 bytebyte order: little endian order  Char‚Äã  size: 2 bytebyte order: little endian order  Unsigned int‚Äã  size: 1~5 byteFormat: The most significant bit (MSB) in every byte indicates whether to have the next byte. If first bit is set i.e. b &amp; 0x80 == 0x80, then the next byte should be read until the first bit of the next byte is unset.  Signed int‚Äã  size: 1~5 byteFormat: First convert the number into positive unsigned int by (v &lt;&lt; 1) ^ (v &gt;&gt; 31) ZigZag algorithm, then encoding it as an unsigned int.  Unsigned long‚Äã  size: 1~9 byteFury PVL(Progressive Variable-length Long) Encoding: positive long format: first bit in every byte indicates whether to have the next byte. If first bit is set i.e. b &amp; 0x80 == 0x80, then the next byte should be read until the first bit is unset.  Signed long‚Äã  size: 1~9 byteFury SLI(Small long as int) Encoding: If long is in [-1073741824, 1073741823], encode as 4 bytes int: | little-endian: ((int) value) &lt;&lt; 1 |Otherwise write as 9 bytes: | 0b1 | little-endian 8 bytes long | Fury PVL(Progressive Variable-length Long) Encoding: First convert the number into positive unsigned long by (v &lt;&lt; 1) ^ (v &gt;&gt; 63) ZigZag algorithm to reduce cost of small negative numbers, then encoding it as an unsigned long.  Float‚Äã  size: 4 byteformat: convert float to 4 bytes int by Float.floatToRawIntBits, then write as binary by little endian order.  Double‚Äã  size: 8 byteformat: convert double to 8 bytes int by Double.doubleToRawLongBits, then write as binary by little endian order.  ","version":"0.10","tagName":"h3"},{"title":"String‚Äã","type":1,"pageTitle":"Fury Java Serialization Format","url":"/docs/0.10/specification/java_serialization_spec#string","content":" Format:  | header: size &lt;&lt; 2 | 2 bits encoding flags | binary data |   size + encoding will be concat as a long and encoded as an unsigned var long. The little 2 bits is used for encoding: 0 for latin, 1 for utf-16, 2 for utf-8.encoded string binary data based on encoding: latin/utf-16/utf-8.  Which encoding to choose:  For JDK8: fury detect latin at runtime, if string is latin string, then use latin encoding, otherwise use utf-16.For JDK9+: fury use coder in String object for encoding, latin/utf-16 will be used for encoding.If the string is encoded by utf-8, then fury will use utf-8 to decode the data. But currently fury doesn't enable utf-8 encoding by default for java. Cross-language string serialization of fury uses utf-8 by default.  ","version":"0.10","tagName":"h3"},{"title":"Collection‚Äã","type":1,"pageTitle":"Fury Java Serialization Format","url":"/docs/0.10/specification/java_serialization_spec#collection","content":" All collection serializers must extend AbstractCollectionSerializer.  Format:  length(unsigned varint) | collection header | elements header | elements data   Collection header‚Äã  For ArrayList/LinkedArrayList/HashSet/LinkedHashSet, this will be empty.For TreeSet, this will be ComparatorFor subclass of ArrayList, this may be extra object field info.  Elements header‚Äã  In most cases, all collection elements are same type and not null, elements header will encode those homogeneous information to avoid the cost of writing it for every element. Specifically, there are four kinds of information which will be encoded by elements header, each use one bit:  If track elements ref, use the first bit 0b1 of the header to flag it.If the collection has null, use the second bit 0b10 of the header to flag it. If ref tracking is enabled for this element type, this flag is invalid.If the collection element types are not declared type, use the 3rd bit 0b100 of the header to flag it.If the collection element types are different, use the 4rd bit 0b1000 header to flag it.  By default, all bits are unset, which means all elements won't track ref, all elements are same type, not null and the actual element is the declared type in the custom class field.  The implementation can generate different deserialization code based read header, and look up the generated code from a linear map/list.  Elements data‚Äã  Based on the elements header, the serialization of elements data may skip ref flag/null flag/element class info.  CollectionSerializer#write/read can be taken as an example.  ","version":"0.10","tagName":"h3"},{"title":"Array‚Äã","type":1,"pageTitle":"Fury Java Serialization Format","url":"/docs/0.10/specification/java_serialization_spec#array","content":" Primitive array‚Äã  Primitive array are taken as a binary buffer, serialization will just write the length of array size as an unsigned int, then copy the whole buffer into the stream.  Such serialization won't compress the array. If users want to compress primitive array, users need to register custom serializers for such types.  Object array‚Äã  Object array is serialized using the collection format. Object component type will be taken as collection element generic type.  ","version":"0.10","tagName":"h3"},{"title":"Map‚Äã","type":1,"pageTitle":"Fury Java Serialization Format","url":"/docs/0.10/specification/java_serialization_spec#map","content":" All Map serializers must extend AbstractMapSerializer.  Format:  | length(unsigned varint) | map header | key value pairs data |   Map header‚Äã  For HashMap/LinkedHashMap, this will be empty.For TreeMap, this will be ComparatorFor other Map, this may be extra object field info.  Map Key-Value data‚Äã  Map iteration is too expensive, Fury won't compute the header like for collection before since it introduceconsiderable overhead. Users can use MapFieldInfo annotation to provide header in advance. Otherwise Fury will use first key-value pair to predict header optimistically, and update the chunk header if the prediction failed at some pair.  Fury will serialize map chunk by chunk, every chunk has 127 pairs at most.  | 1 byte | 1 byte | variable bytes | +----------------+----------------+-----------------+ | KV header | chunk size: N | N*2 objects |   KV header:  If track key ref, use the first bit 0b1 of the header to flag it.If the key has null, use the second bit 0b10 of the header to flag it. If ref tracking is enabled for this key type, this flag is invalid.If the actual key type of map is not the declared key type, use the 3rd bit 0b100 of the header to flag it.If track value ref, use the 4th bit 0b1000 of the header to flag it.If the value has null, use the 5th bit 0b10000 of the header to flag it. If ref tracking is enabled for this value type, this flag is invalid.If the value type of map is not the declared value type, use the 6rd bit 0b100000 of the header to flag it.If key or value is null, that key and value will be written as a separate chunk, and chunk size writing will be skipped too.  If streaming write is enabled, which means Fury can't update written chunk size. In such cases, map key-value data format will be:  | 1 byte | variable bytes | +----------------+-----------------+ | KV header | N*2 objects |   KV header will be a header marked by MapFieldInfo in java. The implementation can generate different deserialization code based read header, and look up the generated code from a linear map/list.  ","version":"0.10","tagName":"h3"},{"title":"Enum‚Äã","type":1,"pageTitle":"Fury Java Serialization Format","url":"/docs/0.10/specification/java_serialization_spec#enum","content":" Enums are serialized as an unsigned var int. If the order of enum values change, the deserialized enum value may not be the value users expect. In such cases, users must register enum serializer by make it write enum value as an enumerated string with unique hash disabled.  ","version":"0.10","tagName":"h3"},{"title":"Object‚Äã","type":1,"pageTitle":"Fury Java Serialization Format","url":"/docs/0.10/specification/java_serialization_spec#object","content":" Object means object of pojo/struct/bean/record type. Object will be serialized by writing its fields data in fury order.  Depending on schema compatibility, objects will have different formats.  Field order‚Äã  Field will be ordered as following, every group of fields will have its own order:  primitive fields: larger size type first, smaller later, variable size type last.boxed primitive fields: same order as primitive fieldsfinal fields: same type together, then sorted by field name lexicographically.collection fields: same order as final fieldsmap fields: same order as final fieldsother fields: same order as final fields  Schema consistent‚Äã  Object fields will be serialized one by one using following format:  Primitive field value: | var bytes | +----------------+ | value data | +----------------+ Boxed field value: | one byte | var bytes | +-----------+---------------+ | null flag | field value | +-----------+---------------+ field value of final type with ref tracking: | var bytes | var objects | +-----------+-------------+ | ref meta | value data | +-----------+-------------+ field value of final type without ref tracking: | one byte | var objects | +-----------+-------------+ | null flag | field value | +-----------+-------------+ field value of non-final type with ref tracking: | one byte | var bytes | var objects | +-----------+-------------+-------------+ | ref meta | class meta | value data | +-----------+-------------+-------------+ field value of non-final type without ref tracking: | one byte | var bytes | var objects | +-----------+------------+------------+ | null flag | class meta | value data | +-----------+------------+------------+   Schema evolution‚Äã  Schema evolution have similar format as schema consistent mode for object except:  For this object type itself, schema consistent mode will write class by id/name, but schema evolution mode will write class field names, types and other meta too, see Class meta.Class meta of final custom type needs to be written too, because peers may not have this class defined.  ","version":"0.10","tagName":"h3"},{"title":"Class‚Äã","type":1,"pageTitle":"Fury Java Serialization Format","url":"/docs/0.10/specification/java_serialization_spec#class","content":" Class will be serialized using class meta format.  ","version":"0.10","tagName":"h3"},{"title":"Implementation guidelines‚Äã","type":1,"pageTitle":"Fury Java Serialization Format","url":"/docs/0.10/specification/java_serialization_spec#implementation-guidelines","content":" Try to merge multiple bytes into an int/long write before writing to reduce memory IO and bound check cost.Read multiple bytes as an int/long, then split into multiple bytes to reduce memory IO and bound check cost.Try to use one varint/long to write flags and length together to save one byte cost and reduce memory io.Condition branches are less expensive compared to memory IO cost unless there are too many branches. ","version":"0.10","tagName":"h2"},{"title":"Fury Xlang Serialization Format","type":0,"sectionRef":"#","url":"/docs/0.10/specification/xlang_serialization_spec","content":"","keywords":"","version":"0.10"},{"title":"Cross-language Serialization Specification‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#cross-language-serialization-specification","content":" Format Version History: Version 0.1 - serialization spec formalized  Fury xlang serialization is an automatic object serialization framework that supports reference and polymorphism. Fury will convert an object from/to fury xlang serialization binary format. Fury has two core concepts for xlang serialization:  Fury xlang binary formatFramework implemented in different languages to convert object to/from Fury xlang binary format  The serialization format is a dynamic binary format. The dynamics and reference/polymorphism support make Fury flexible, much more easy to use, but also introduce more complexities compared to static serialization frameworks. So the format will be more complex.  ","version":"0.10","tagName":"h2"},{"title":"Type Systems‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#type-systems","content":" ","version":"0.10","tagName":"h2"},{"title":"Data Types‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#data-types","content":" bool: a boolean value (true or false).int8: a 8-bit signed integer.int16: a 16-bit signed integer.int32: a 32-bit signed integer.var_int32: a 32-bit signed integer which use fury var_int32 encoding.int64: a 64-bit signed integer.var_int64: a 64-bit signed integer which use fury PVL encoding.sli_int64: a 64-bit signed integer which use fury SLI encoding.float16: a 16-bit floating point number.float32: a 32-bit floating point number.float64: a 64-bit floating point number including NaN and Infinity.string: a text string encoded using Latin1/UTF16/UTF-8 encoding.enum: a data type consisting of a set of named values. Rust enum with non-predefined field values are not supported as an enum.named_enum: an enum whose value will be serialized as the registered name.struct: a morphic(final) type serialized by Fury Struct serializer. i.e. it doesn't have subclasses. Suppose we're deserializing List&lt;SomeClass&gt;, we can save dynamic serializer dispatch since SomeClass is morphic(final).compatible_struct: a morphic(final) type serialized by Fury compatible Struct serializer.named_struct: a struct whose type mapping will be encoded as a name.named_compatible_struct: a compatible_struct whose type mapping will be encoded as a name.ext: a type which will be serialized by a customized serializer.named_ext: an ext type whose type mapping will be encoded as a name.list: a sequence of objects.set: an unordered set of unique elements.map: a map of key-value pairs. Mutable types such as list/map/set/array/tensor/arrow are not allowed as key of map.duration: an absolute length of time, independent of any calendar/timezone, as a count of nanoseconds.timestamp: a point in time, independent of any calendar/timezone, as a count of nanoseconds. The count is relative to an epoch at UTC midnight on January 1, 1970.local_date: a naive date without timezone. The count is days relative to an epoch at UTC midnight on Jan 1, 1970.decimal: exact decimal value represented as an integer value in two's complement.binary: an variable-length array of bytes.array: only allow 1d numeric components. Other arrays will be taken as List. The implementation should support the interoperability between array and list. bool_array: one dimensional bool array.int8_array: one dimensional int8 array.int16_array: one dimensional int16 array.int32_array: one dimensional int32 array.int64_array: one dimensional int64 array.float16_array: one dimensional half_float_16 array.float32_array: one dimensional float32 array.float64_array: one dimensional float64 array. tensor: multidimensional array which every sub-array have same size and type.arrow record batch: an arrow record batch object.arrow table: an arrow table object.  Note:  Unsigned int/long are not added here, since not every language support those types.  ","version":"0.10","tagName":"h3"},{"title":"Polymorphisms‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#polymorphisms","content":" For polymorphism, if one non-final class is registered, and only one subclass is registered, then we can take all elements in List/Map have same type, thus reduce runtime check cost.  Collection/Array polymorphism are not fully supported, since some languages such as golang have only one collection type. If users want to get exactly the type he passed, he must pass that type when deserializing or annotate that type to the field of struct.  ","version":"0.10","tagName":"h3"},{"title":"Type disambiguation‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#type-disambiguation","content":" Due to differences between type systems of languages, those types can't be mapped one-to-one between languages. When deserializing, Fury use the target data structure type and the data type in the data jointly to determine how to deserialize and populate the target data structure. For example:  class Foo { int[] intArray; Object[] objects; List&lt;Object&gt; objectList; } class Foo2 { int[] intArray; List&lt;Object&gt; objects; List&lt;Object&gt; objectList; }   intArray has an int32_array type. But both objects and objectList fields in the serialize data have list data type. When deserializing, the implementation will create an Object array for objects, but create a ArrayListfor objectList to populate its elements. And the serialized data of Foo can be deserialized into Foo2 too.  Users can also provide meta hints for fields of a type, or the type whole. Here is an example in java which use annotation to provide such information.  @FuryObject(fieldsNullable = false, trackingRef = false) class Foo { @FuryField(trackingRef = false) int[] intArray; @FuryField(polymorphic = true) Object object; @FuryField(tagId = 1, nullable = true) List&lt;Object&gt; objectList; }   Such information can be provided in other languages too:  cpp: use macro and template.golang: use struct tag.python: use typehint.rust: use macro.  ","version":"0.10","tagName":"h3"},{"title":"Type ID‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#type-id","content":" All internal data types are expressed using an ID in range 0~64. Users can use 0~4096 for representing their types.  ","version":"0.10","tagName":"h3"},{"title":"Type mapping‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#type-mapping","content":" See Type mapping  ","version":"0.10","tagName":"h3"},{"title":"Spec overview‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#spec-overview","content":" Here is the overall format:  | fury header | object ref meta | object type meta | object value data |   The data are serialized using little endian byte order overall. If bytes swap is costly for some object, Fury will write the byte order for that object into the data instead of converting it to little endian.  ","version":"0.10","tagName":"h2"},{"title":"Fury header‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#fury-header","content":" Fury header consists starts one byte:  | 2 bytes | 4 bits | 1 bit | 1 bit | 1 bit | 1 bit | 1 byte | optional 4 bytes | +--------------+---------------+-------+-------+--------+-------+------------+------------------------------------+ | magic number | reserved bits | oob | xlang | endian | null | language | unsigned int for meta start offset |   magic number: used to identify fury serialization protocol, current version use 0x62d4.null flag: 1 when object is null, 0 otherwise. If an object is null, other bits won't be set.endian flag: 1 when data is encoded by little endian, 0 for big endian.xlang flag: 1 when serialization uses xlang format, 0 when serialization uses Fury java format.oob flag: 1 when passed BufferCallback is not null, 0 otherwise.language: the language when serializing objects, such as JAVA, PYTHON, GO, etc. Fury can use this flag to determine whether spend more time on serialization to make the deserialization faster for dynamic languages.  If meta share mode is enabled, an uncompressed unsigned int is appended to indicate the start offset of metadata.  ","version":"0.10","tagName":"h2"},{"title":"Reference Meta‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#reference-meta","content":" Reference tracking handles whether the object is null, and whether to track reference for the object by writing corresponding flags and maintaining internal state.  Reference flags:  Flag\tByte Value\tDescriptionNULL FLAG\t-3\tThis flag indicates the object is a null value. We don't use another byte to indicate REF, so that we can save one byte. REF FLAG\t-2\tThis flag indicates the object is already serialized previously, and fury will write a ref id with unsigned varint format instead of serialize it again NOT_NULL VALUE FLAG\t-1\tThis flag indicates the object is a non-null value and fury doesn't track ref for this type of object. REF VALUE FLAG\t0\tThis flag indicates the object is referencable and the first time to serialize.  When reference tracking is disabled globally or for specific types, or for certain types within a particular context(e.g., a field of a type), only the NULL and NOT_NULL VALUE flags will be used for reference meta.  For languages which doesn't support reference such as rust, reference tracking must be disabled for correct deserialization by fury rust implementation.  For languages whose object values are not null by default:  In rust, Fury takes Option:None as a null valueIn c++, Fury takes std::nullopt as a null valueIn golang, Fury takes null interface/pointer as a null value  If one want to deserialize in languages like Java/Python/JavaScript, he should mark the type with all fields not-null by default, or using schema-evolution mode to carry the not-null fields info in the data.  ","version":"0.10","tagName":"h2"},{"title":"Type Meta‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#type-meta","content":" For every type to be serialized, it have a type id to indicate its type.  basic types: the type idenum: Type.ENUM + registered idType.NAMED_ENUM + registered namespace+typename list: Type.Listset: Type.SETmap: Type.MAPext: Type.EXT + registered idType.NAMED_EXT + registered namespace+typename struct: Type.STRUCT + struct metaType.NAMED_STRUCT + struct meta  Every type must be registered with an ID or name first. The registration can be used for security check and type identification.  Struct is a special type, depending whether schema compatibility is enabled, Fury will write struct meta differently.  ","version":"0.10","tagName":"h2"},{"title":"Struct Schema consistent‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#struct-schema-consistent","content":" If schema consistent mode is enabled globally when creating fury, type meta will be written as a fury unsigned varint of type_id. Schema evolution related meta will be ignored.If schema evolution mode is enabled globally when creating fury, and current class is configured to use schema consistent mode like struct vs table in flatbuffers: Type meta will be add to captured_type_defs: captured_type_defs[type def stub] = map size ahead when registering type.Get index of the meta in captured_type_defs, write that index as | unsigned varint: index |.  ","version":"0.10","tagName":"h3"},{"title":"Struct Schema evolution‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#struct-schema-evolution","content":" If schema evolution mode is enabled globally when creating fury, and enabled for current type, type meta will be written using one of the following mode. Which mode to use is configured when creating fury.  Normal mode(meta share not enabled): If type meta hasn't been written before, add type defto captured_type_defs: captured_type_defs[type def] = map size.Get index of the meta in captured_type_defs, write that index as | unsigned varint: index |.After finished the serialization of the object graph, fury will start to write captured_type_defs: Firstly, set current to meta start offset of fury header Then write captured_type_defs one by one: buffer.write_var_uint32(len(writting_type_defs) - len(schema_consistent_type_def_stubs)) for type_meta in writting_type_defs: if not type_meta.is_stub(): type_meta.write_type_def(buffer) writing_type_defs = copy(schema_consistent_type_def_stubs) Meta share mode: the writing steps are same as the normal mode, but captured_type_defs will be shared across multiple serializations of different objects. For example, suppose we have a batch to serialize: captured_type_defs = {} stream = ... # add `Type1` to `captured_type_defs` and write `Type1` fury.serialize(stream, [Type1()]) # add `Type2` to `captured_type_defs` and write `Type2`, `Type1` is written before. fury.serialize(stream, [Type1(), Type2()]) # `Type1` and `Type2` are written before, no need to write meta. fury.serialize(stream, [Type1(), Type2()]) Streaming mode(streaming mode doesn't support meta share): If type meta hasn't been written before, the data will be written as: | unsigned varint: 0b11111111 | type def | If type meta has been written before, the data will be written as: | unsigned varint: written index &lt;&lt; 1 | written index is the id in captured_type_defs. With this mode, meta start offset can be omitted.  The normal mode and meta share mode will forbid streaming writing since it needs to look back for update the start offset after the whole object graph writing and meta collecting is finished. Only in this way we can ensure deserialization failure in meta share mode doesn't lost shared meta.  Type Def‚Äã  Here we mainly describe the meta layout for schema evolution mode:  | 8 bytes header | variable bytes | variable bytes | +----------------------+--------------------+-------------------+ | global binary header | meta header | fields meta |   For languages which support inheritance, if parent class and subclass has fields with same name, using field in subclass.  Global binary header‚Äã  50 bits hash + 1bit compress flag + write fields meta + 12 bits meta size. Right is the lower bits.  lower 12 bits are used to encode meta size. If meta size &gt;= 0b1111_1111_1111, then writemeta_ size - 0b1111_1111_1111 next.13rd bit is used to indicate whether to write fields meta. When this class is schema-consistent or use registered serializer, fields meta will be skipped. Class Meta will be used for share namespace + type name only.14rd bit is used to indicate whether meta is compressed.Other 50 bits is used to store the unique hash of flags + all layers class meta.  Meta header‚Äã  Meta header is a 8 bits number value.  Lowest 5 digits 0b00000~0b11110 are used to record num fields. 0b11111 is preserved to indicate that Fury need to read more bytes for length using Fury unsigned int encoding. Note that num_fields is the number of compatible fields. Users can use tag id to mark some fields as compatible fields in schema consistent context. In such cases, schema consistent fields will be serialized first, then compatible fields will be serialized next. At deserialization, Fury will use fields info of those fields which aren't annotated by tag id for deserializing schema consistent fields, then use fields info in meta for deserializing compatible fields.The 6th bit: 0 for registered by id, 1 for registered by name.Remaining 2 bits are reserved for future extension.  Fields meta‚Äã  Format:  | field info: variable bytes | variable bytes | ... | +---------------------------------+-----------------+-----+ | header + type info + field name | next field info | ... |   Field Header‚Äã  Field Header is 8 bits, annotation can be used to provide more specific info. If annotation not exists, fury will infer those info automatically.  The format for field header is:  2 bits field name encoding + 4 bits size + nullability flag + ref tracking flag   Detailed spec:  2 bits field name encoding: encoding: UTF8/ALL_TO_LOWER_SPECIAL/LOWER_UPPER_DIGIT_SPECIAL/TAG_IDIf tag id is used, field name will be written by an unsigned varint tag id, and 2 bits encoding will be 11. size of field name: The 4 bits size: 0~14 will be used to indicate length 1~15, the value 15 indicates to read more bytes, the encoding will encode size - 15 as a varint next.If encoding is TAG_ID, then num_bytes of field name will be used to store tag id. ref tracking: when set to 1, ref tracking will be enabled for this field.nullability: when set to 1, this field can be null.  Field Type Info‚Äã  Field type info is written as unsigned int8. Detailed id spec is:  For struct registered by id, it will be Type.STRUCT.For struct registered by name, it will be Type.NAMED_STRUCT.For enum registered by id, it will be Type.ENUM.For enum registered by name, it will be Type.NAMED_ENUM.For ext type registered by id, it will be Type.EXT.For ext type registered by name, it will be Type.NAMED_EXT.For list/set type, it will be written as Type.LIST/SET, then write element type recursively.For 1D primitive array type, it will be written as Type.XXX_ARRAY.For multi-dimensional primitive array type with same size on each dim, it will be written as Type.TENSOR.For other array type, it will be written as Type.LIST, then write element type recursively.For map type, it will be written as Type.MAP, then write key and value type recursively.For other types supported by fury directly, it will be fury type id for that type.For other types not determined at compile time, write Type.UNKNOWN instead. For such types, actual type will be written when serializing such field values.  Polymorphism spec:  struct/named_struct/ext/named_ext are taken as polymorphic, the meta for those types are written separately instead of inlining here to reduce meta space cost if object of this type is serialized in current object graph multiple times, and the field value may be null too.enum is taken as morphic, if deserialization doesn't have this field, or the type is not enum, enum value will be skipped.list/map/set are taken as morphic, when serializing values of those type, the concrete types won't be written again.Other types that fury supported are taken as morphic too.  List/Set/Map nested type spec:  list: | list type id | nested type id &lt;&lt; 2 + nullability flag + ref tracking flag | ... multi-layer type info |set: | set type id | nested type id &lt;&lt; 2 + nullability flag + ref tracking flag | ... multi-layer type info |map: | set type id | key type info | value type info | Key type format: | nested type id &lt;&lt; 2 + nullability flag + ref tracking flag | ... multi-layer type info |Value type format: | nested type id &lt;&lt; 2 + nullability flag + ref tracking flag | ... multi-layer type info |  Field Name‚Äã  If tag id is set, tag id will be used instead. Otherwise meta string of field name will be written instead.  Field order‚Äã  Field order are left as implementation details, which is not exposed to specification, the deserialization need to resort fields based on Fury fields sort algorithms. In this way, fury can compute statistics for field names or types and using a more compact encoding.  ","version":"0.10","tagName":"h3"},{"title":"Extended Type Meta with Inheritance support‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#extended-type-meta-with-inheritance-support","content":" If one want to support inheritance for struct, one can implement following spec.  ","version":"0.10","tagName":"h2"},{"title":"Schema consistent‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#schema-consistent","content":" Fields are serialized from parent type to leaf type. Fields are sorted using fury struct fields sort algorithms.  ","version":"0.10","tagName":"h3"},{"title":"Schema Evolution‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#schema-evolution","content":" Meta layout for schema evolution mode:  | 8 bytes header | variable bytes | variable bytes | variable bytes | variable bytes | +----------------------+----------------+----------------+--------------------+--------------------+ | global binary header | meta header | fields meta | parent meta header | parent fields meta |   Meta header‚Äã  Meta header is a 64 bits number value encoded in little endian order.  Lowest 4 digits 0b0000~0b1110 are used to record num classes. 0b1111 is preserved to indicate that Fury need to read more bytes for length using Fury unsigned int encoding. If current type doesn't has parent type, or parent type doesn't have fields to serialize, or we're in a context which serialize fields of current type only, num classes will be 1.The 5th bit is used to indicate whether this type needs schema evolution.Other 56 bits are used to store the unique hash of flags + all layers type meta.  Single layer type meta‚Äã  | unsigned varint | var uint | field info: variable bytes | variable bytes | ... | +-----------------+----------+-------------------------------+-----------------+-----+ | num_fields | type id | header + type id + field name | next field info | ... |   Other layers type meta‚Äã  Same encoding algorithm as the previous layer.  ","version":"0.10","tagName":"h3"},{"title":"Meta String‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#meta-string","content":" Meta string is mainly used to encode meta strings such as field names.  ","version":"0.10","tagName":"h2"},{"title":"Encoding Algorithms‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#encoding-algorithms","content":" String binary encoding algorithm:  Algorithm\tPattern\tDescriptionLOWER_SPECIAL\ta-z._$|\tevery char is written using 5 bits, a-z: 0b00000~0b11001, ._$|: 0b11010~0b11101, prepend one bit at the start to indicate whether strip last char since last byte may have 7 redundant bits(1 indicates strip last char) LOWER_UPPER_DIGIT_SPECIAL\ta-zA-Z0~9._\tevery char is written using 6 bits, a-z: 0b00000~0b11001, A-Z: 0b11010~0b110011, 0~9: 0b110100~0b111101, ._: 0b111110~0b111111, prepend one bit at the start to indicate whether strip last char since last byte may have 7 redundant bits(1 indicates strip last char) UTF-8\tany chars\tUTF-8 encoding  Encoding flags:  Encoding Flag\tPattern\tEncoding AlgorithmLOWER_SPECIAL\tevery char is in a-z._|\tLOWER_SPECIAL FIRST_TO_LOWER_SPECIAL\tevery char is in a-z._ except first char is upper case\treplace first upper case char to lower case, then use LOWER_SPECIAL ALL_TO_LOWER_SPECIAL\tevery char is in a-zA-Z._\treplace every upper case char by | + lower case, then use LOWER_SPECIAL, use this encoding if it's smaller than Encoding LOWER_UPPER_DIGIT_SPECIAL LOWER_UPPER_DIGIT_SPECIAL\tevery char is in a-zA-Z._\tuse LOWER_UPPER_DIGIT_SPECIAL encoding if it's smaller than Encoding FIRST_TO_LOWER_SPECIAL UTF8\tany utf-8 char\tuse UTF-8 encoding Compression\tany utf-8 char\tlossless compression  Notes:  Depending on cases, one can choose encoding flags + data jointly, uses 3 bits of first byte for flags and other bytes for data.  ","version":"0.10","tagName":"h3"},{"title":"Value Format‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#value-format","content":" ","version":"0.10","tagName":"h2"},{"title":"Basic types‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#basic-types","content":" bool‚Äã  size: 1 byteformat: 0 for false, 1 for true  int8‚Äã  size: 1 byteformat: write as pure byte.  int16‚Äã  size: 2 bytebyte order: raw bytes of little endian order  unsigned int32‚Äã  size: 4 bytebyte order: raw bytes of little endian order  unsigned varint32‚Äã  size: 1~5 byteFormat: The most significant bit (MSB) in every byte indicates whether to have the next byte. If first bit is set i.e. b &amp; 0x80 == 0x80, then the next byte should be read until the first bit of the next byte is unset.  signed int32‚Äã  size: 4 bytebyte order: raw bytes of little endian order  signed varint32‚Äã  size: 1~5 byteFormat: First convert the number into positive unsigned int by (v &lt;&lt; 1) ^ (v &gt;&gt; 31) ZigZag algorithm, then encode it as an unsigned varint.  unsigned int64‚Äã  size: 8 bytebyte order: raw bytes of little endian order  unsigned varint64‚Äã  size: 1~9 byteFury SLI(Small long as int) Encoding: If long is in [0, 2147483647], encode as 4 bytes int: | little-endian: ((int) value) &lt;&lt; 1 |Otherwise write as 9 bytes: | 0b1 | little-endian 8 bytes long | Fury PVL(Progressive Variable-length Long) Encoding: positive long format: first bit in every byte indicates whether to have the next byte. If first bit is set i.e. b &amp; 0x80 == 0x80, then the next byte should be read until the first bit is unset.  signed int64‚Äã  size: 8 bytebyte order: raw bytes of little endian order  signed varint64‚Äã  size: 1~9 byteFury SLI(Small long as int) Encoding: If long is in [-1073741824, 1073741823], encode as 4 bytes int: | little-endian: ((int) value) &lt;&lt; 1 |Otherwise write as 9 bytes: | 0b1 | little-endian 8 bytes long | Fury PVL(Progressive Variable-length Long) Encoding: First convert the number into positive unsigned long by (v &lt;&lt; 1) ^ (v &gt;&gt; 63) ZigZag algorithm to reduce cost of small negative numbers, then encoding it as an unsigned long.  float32‚Äã  size: 4 byteformat: encode the specified floating-point value according to the IEEE 754 floating-point &quot;single format&quot; bit layout, preserving Not-a-Number (NaN) values, then write as binary by little endian order.  float64‚Äã  size: 8 byteformat: encode the specified floating-point value according to the IEEE 754 floating-point &quot;double format&quot; bit layout, preserving Not-a-Number (NaN) values. then write as binary by little endian order.  ","version":"0.10","tagName":"h3"},{"title":"string‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#string","content":" Format:  | unsigned varint64: size &lt;&lt; 2 `bitor` 2 bits encoding flags | binary data |   size + encoding will be concat as a long and encoded as an unsigned varint64. The little 2 bits is used for encoding: 0 for latin1(ISO-8859-1), 1 for utf-16, 2 for utf-8.encoded string binary data based on encoding: latin/utf-16/utf-8.  Which encoding to choose:  For JDK8: fury detect latin at runtime, if string is latin string, then use latin encoding, otherwise use utf-16.For JDK9+: fury use coder in String object for encoding, latin/utf-16 will be used for encoding.If the string is encoded by utf-8, then fury will use utf-8 to decode the data. Cross-language string serialization of fury uses utf-8 by default.  ","version":"0.10","tagName":"h3"},{"title":"list‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#list","content":" Format:  | unsigned varint64: length | 1 byte elements header | elements data |   elements header‚Äã  In most cases, all elements are same type and not null, elements header will encode those homogeneous information to avoid the cost of writing it for every element. Specifically, there are four kinds of information which will be encoded by elements header, each use one bit:  If track elements ref, use the first bit 0b1 of the header to flag it.If the elements have null, use the second bit 0b10 of the header to flag it. If ref tracking is enabled for this element type, this flag is invalid.If the element types are not the declared type, use the 3rd bit 0b100 of the header to flag it.If the element types are different, use the 4rd bit 0b1000 header to flag it.  By default, all bits are unset, which means all elements won't track ref, all elements are same type, not null and the actual element is the declared type in the custom type field.  The implementation can generate different deserialization code based read header, and look up the generated code from a linear map/list.  elements data‚Äã  Based on the elements header, the serialization of elements data may skip ref flag/null flag/element type info.  fury = ... buffer = ... elems = ... if element_type_is_same: if not is_declared_type: fury.write_type(buffer, elem_type) elem_serializer = get_serializer(...) if track_ref: for elem in elems: if not ref_resolver.write_ref_or_null(buffer, elem): elem_serializer.write(buffer, elem) elif has_null: for elem in elems: if elem is None: buffer.write_byte(null_flag) else: buffer.write_byte(not_null_flag) elem_serializer.write(buffer, elem) else: for elem in elems: elem_serializer.write(buffer, elem) else: if track_ref: for elem in elems: fury.write_ref(buffer, elem) elif has_null: for elem in elems: fury.write_nullable(buffer, elem) else: for elem in elems: fury.write_value(buffer, elem)   CollectionSerializer#writeElementscan be taken as an example.  ","version":"0.10","tagName":"h3"},{"title":"array‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#array","content":" primitive array‚Äã  Primitive array are taken as a binary buffer, serialization will just write the length of array size as an unsigned int, then copy the whole buffer into the stream.  Such serialization won't compress the array. If users want to compress primitive array, users need to register custom serializers for such types or mark it as list type.  Tensor‚Äã  Tensor is a special primitive multi-dimensional array which all dimensions have same size and type. The serialization format is:  | num_dims(unsigned varint) | shape[0](unsigned varint) | shape[...] | shape[N] | element type | data |   The data is continuous to reduce copy and may zero-copy in some cases.  object array‚Äã  Object array is serialized using the list format. Object component type will be taken as list element generic type.  ","version":"0.10","tagName":"h3"},{"title":"map‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#map","content":" Map uses a chunk by chunk based Format:  | length(unsigned varint) | key value chunk data | ... | key value chunk data |   map key-value chunk data‚Äã  Map iteration is too expensive, Fury won't compute the header like for list since it introduceconsiderable overhead. Users can use MapFieldInfo annotation to provide the header in advance. Otherwise Fury will use first key-value pair to predict header optimistically, and update the chunk header if the prediction failed at some pair.  Fury will serialize the map chunk by chunk, every chunk has 255 pairs at most.  | 1 byte | 1 byte | variable bytes | +----------------+----------------+-----------------+ | KV header | chunk size: N | N*2 objects |   KV header:  If track key ref, use the first bit 0b1 of the header to flag it.If the key has null, use the second bit 0b10 of the header to flag it. If ref tracking is enabled for this key type, this flag is invalid.If the actual key type of map is not the declared key type, use the 3rd bit 0b100 of the header to flag it.If track value ref, use the 4th bit 0b1000 of the header to flag it.If the value has null, use the 5th bit 0b10000 of the header to flag it. If ref tracking is enabled for this value type, this flag is invalid.If the value type of map is not the declared value type, use the 6rd bit 0b100000 of the header to flag it.If key or value is null, that key and value will be written as a separate chunk, and chunk size writing will be skipped too.  If streaming write is enabled, which means Fury can't update written chunk size. In such cases, map key-value data format will be:  | 1 byte | variable bytes | +----------------+-----------------+ | KV header | N*2 objects |   KV header will be a header marked by MapFieldInfo in java. For languages such as golang, this can be computed in advance for non-interface types most times. The implementation can generate different deserialization code based read header, and look up the generated code from a linear map/list.  Why serialize chunk by chunk?‚Äã  When fury will use first key-value pair to predict header optimistically, it can't know how many pairs have same meta(tracking kef ref, key has null and so on). If we don't write chunk by chunk with max chunk size, we must write at least X bytes to take up a place for later to update the number which has same elements, X is the num_bytes for encoding varint encoding of map size.  And most map size are smaller than 255, if all pairs have same data, the chunk will be 1. This is common in golang/rust, which object are not reference by default.  Also, if only one or two keys have different meta, we can make it into a different chunk, so that most pairs can share meta.  The implementation can accumulate read count with map size to decide whether to read more chunks.  ","version":"0.10","tagName":"h3"},{"title":"enum‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#enum","content":" Enums are serialized as an unsigned var int. If the order of enum values change, the deserialized enum value may not be the value users expect. In such cases, users must register enum serializer by make it write enum value as an enumerated string with unique hash disabled.  ","version":"0.10","tagName":"h3"},{"title":"decimal‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#decimal","content":" Not supported for now.  ","version":"0.10","tagName":"h3"},{"title":"struct‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#struct","content":" Struct means object of class/pojo/struct/bean/record type. Struct will be serialized by writing its fields data in fury order.  Depending on schema compatibility, structs will have different formats.  field order‚Äã  Field will be ordered as following, every group of fields will have its own order:  primitive fields: larger size type first, smaller later, variable size type last.when same size, sort by type idwhen same size and type id, sort by snake case field nametypes: bool/int8/int16/int32/varint32/int64/varint64/sliint64/float16/float32/float64 nullable primitive fields: same order as primitive fieldsmorphic fields: same type together, then sorted by field name lexicographically using snake case style.unknown fields: same sort algorithms as morphic fieldslist fields: same sort algorithms as morphic fieldsset fields: same sort algorithms as morphic fieldsmap fields: same sort algorithms as morphic fields  Field order‚Äã  Fields in a struct are sorted in a ascending order by:  primitive fields first: bool/int8/int16/int32/varint32/int64/varint64/sliint64/float16/float32/float64, sorted by type id.nullable primitive fieldsmorphic types except list/set/mapunknown typeslist typesset typesmap types  If two fields have same type, then sort by snake_case styled field name.  schema consistent‚Äã  Object will be written as:  | 4 byte | variable bytes | +---------------+------------------+ | type hash | field values |   Type hash is used to check the type schema consistency across languages. Type hash will be the first 32 bits of 56 bits value of the type meta.  Object fields will be serialized one by one using following format:  not null primitive field value: | var bytes | +----------------+ | value data | +----------------+ nullable primitive field value: | one byte | var bytes | +-----------+---------------+ | null flag | field value | +-----------+---------------+ field value of final type with ref tracking: | var bytes | var objects | +-----------+-------------+ | ref meta | value data | +-----------+-------------+ field value of final type without ref tracking: | one byte | var objects | +-----------+-------------+ | null flag | field value | +-----------+-------------+ field value of non-final type with ref tracking: | one byte | var bytes | var objects | +-----------+-------------+-------------+ | ref meta | type meta | value data | +-----------+-------------+-------------+ field value of non-final type without ref tracking: | one byte | var bytes | var objects | +-----------+------------+------------+ | null flag | type meta | value data | +-----------+------------+------------+   Schema evolution‚Äã  Schema evolution have similar format as schema consistent mode for object except:  For the object type, schema consistent mode will write type by id only, but schema evolution mode will write type consisting of field names, types and other meta too, see Type meta.Type meta of final custom type needs to be written too, because peers may not have this type defined.  ","version":"0.10","tagName":"h3"},{"title":"Type‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#type","content":" Type will be serialized using type meta format.  ","version":"0.10","tagName":"h3"},{"title":"Implementation guidelines‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#implementation-guidelines","content":" ","version":"0.10","tagName":"h2"},{"title":"How to reduce memory read/write code‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#how-to-reduce-memory-readwrite-code","content":" Try to merge multiple bytes into an int/long write before writing to reduce memory IO and bound check cost.Read multiple bytes as an int/long, then split into multiple bytes to reduce memory IO and bound check cost.Try to use one varint/long to write flags and length together to save one byte cost and reduce memory io.Condition branches are less expensive compared to memory IO cost unless there are too many branches.  ","version":"0.10","tagName":"h3"},{"title":"Fast deserialization for static languages without runtime codegen support‚Äã","type":1,"pageTitle":"Fury Xlang Serialization Format","url":"/docs/0.10/specification/xlang_serialization_spec#fast-deserialization-for-static-languages-without-runtime-codegen-support","content":" For type evolution, the serializer will encode the type meta into the serialized data. The deserializer will compare this meta with class meta in the current process, and use the diff to determine how to deserialize the data.  For java/javascript/python, we can use the diff to generate serializer code at runtime and load it as class/function for deserialization. In this way, the type evolution will be as fast as type consist mode.  For C++/Rust, we can't generate the serializer code at runtime. So we need to generate the code at compile-time using meta programming. But at that time, we don't know the type schema in other processes, so we can't generate the serializer code for such inconsistent types. We may need to generate the code which has a loop and compare field name one by one to decide whether to deserialize and assign the field or skip the field value.  One fast way is that we can optimize the string comparison into jump instructions:  Assume the current type has n fields, and the peer type has n1 fields.Generate an auto growing field id from 0 for every sorted field in the current type at the compile time.Compare the received type meta with current type, generate same id if the field name is same, otherwise generate an auto growing id starting from n, cache this meta at runtime.Iterate the fields of received type meta, use a switch to compare the field id to deserialize data and assign/skip field value. Continuous field id will be optimized into jump in switch block, so it will very fast.  Here is an example, suppose process A has a class Foo with version 1 defined as Foo1, process B has a class Foowith version 2 defined as Foo2:  // class Foo with version 1 class Foo1 { int32_t v1; // id 0 std::string v2; // id 1 }; // class Foo with version 2 class Foo2 { // id 0, but will have id 2 in process A bool v0; // id 1, but will have id 0 in process A int32_t v1; // id 2, but will have id 3 in process A int64_t long_value; // id 3, but will have id 1 in process A std::string v2; // id 4, but will have id 4 in process A std::vector&lt;std::string&gt; list; };   When process A received serialized Foo2 from process B, here is how it deserialize the data:  Foo1 foo1 = ...; const std::vector&lt;fury::FieldInfo&gt; &amp;field_infos = type_meta.field_infos; for (const auto &amp;field_info : field_infos) { switch (field_info.field_id) { case 0: foo1.v1 = buffer.read_varint32(); break; case 1: foo1.v2 = fury.read_string(); break; default: fury.skip_data(field_info); } }  ","version":"0.10","tagName":"h3"},{"title":"Install","type":0,"sectionRef":"#","url":"/docs/0.10/start/install","content":"","keywords":"","version":"0.10"},{"title":"Java‚Äã","type":1,"pageTitle":"Install","url":"/docs/0.10/start/install#java","content":" To add a dependency on Fury using Maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fury&lt;/groupId&gt; &lt;artifactId&gt;fury-core&lt;/artifactId&gt; &lt;version&gt;0.10.3&lt;/version&gt; &lt;/dependency&gt; &lt;!-- row/arrow format support --&gt; &lt;!-- &lt;dependency&gt; &lt;groupId&gt;org.apache.fury&lt;/groupId&gt; &lt;artifactId&gt;fury-format&lt;/artifactId&gt; &lt;version&gt;0.10.3&lt;/version&gt; &lt;/dependency&gt; --&gt;   ","version":"0.10","tagName":"h2"},{"title":"Scala‚Äã","type":1,"pageTitle":"Install","url":"/docs/0.10/start/install#scala","content":" To add a dependency on Fury scala for scala 2.13 with maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fury&lt;/groupId&gt; &lt;artifactId&gt;fury-scala_2.13&lt;/artifactId&gt; &lt;version&gt;0.10.3&lt;/version&gt; &lt;/dependency&gt;   To add a dependency on Fury scala for scala 3 with maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fury&lt;/groupId&gt; &lt;artifactId&gt;fury-scala_3&lt;/artifactId&gt; &lt;version&gt;0.10.3&lt;/version&gt; &lt;/dependency&gt;   To add a dependency on Fury scala for scala 2.13 with sbt, use the following:  libraryDependencies += &quot;org.apache.fury&quot; % &quot;fury-scala_2.13&quot; % &quot;0.10.3&quot;   To add a dependency on Fury scala for scala 3 with sbt, use the following:  libraryDependencies += &quot;org.apache.fury&quot; % &quot;fury-scala_3&quot; % &quot;0.10.3&quot;   ","version":"0.10","tagName":"h2"},{"title":"Kotlin‚Äã","type":1,"pageTitle":"Install","url":"/docs/0.10/start/install#kotlin","content":" To add a dependency on Fury kotlin with maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fury&lt;/groupId&gt; &lt;artifactId&gt;fury-kotlin&lt;/artifactId&gt; &lt;version&gt;0.10.3&lt;/version&gt; &lt;/dependency&gt;  ","version":"0.10","tagName":"h2"},{"title":"Xlang Serialization","type":0,"sectionRef":"#","url":"/docs/0.10/guide/xlang_serialization","content":"","keywords":"","version":"0.10"},{"title":"Cross-language object graph serialization‚Äã","type":1,"pageTitle":"Xlang Serialization","url":"/docs/0.10/guide/xlang_serialization#cross-language-object-graph-serialization","content":" ","version":"0.10","tagName":"h2"},{"title":"Serialize built-in types‚Äã","type":1,"pageTitle":"Xlang Serialization","url":"/docs/0.10/guide/xlang_serialization#serialize-built-in-types","content":" Common types can be serialized automatically: primitive numeric types, string, binary, array, list, map and so on.  Java  import org.apache.fury.*; import org.apache.fury.config.*; import java.util.*; public class Example1 { public static void main(String[] args) { Fury fury = Fury.builder().withLanguage(Language.XLANG).build(); List&lt;Object&gt; list = ofArrayList(true, false, &quot;str&quot;, -1.1, 1, new int[100], new double[20]); byte[] bytes = fury.serialize(list); // bytes can be data serialized by other languages. fury.deserialize(bytes); Map&lt;Object, Object&gt; map = new HashMap&lt;&gt;(); map.put(&quot;k1&quot;, &quot;v1&quot;); map.put(&quot;k2&quot;, list); map.put(&quot;k3&quot;, -1); bytes = fury.serialize(map); // bytes can be data serialized by other languages. fury.deserialize(bytes); } }   Python  import pyfury import numpy as np fury = pyfury.Fury() object_list = [True, False, &quot;str&quot;, -1.1, 1, np.full(100, 0, dtype=np.int32), np.full(20, 0.0, dtype=np.double)] data = fury.serialize(object_list) # bytes can be data serialized by other languages. new_list = fury.deserialize(data) object_map = {&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: object_list, &quot;k3&quot;: -1} data = fury.serialize(object_map) # bytes can be data serialized by other languages. new_map = fury.deserialize(data) print(new_map)   Golang  package main import furygo &quot;github.com/apache/fury/fury/go/fury&quot; import &quot;fmt&quot; func main() { list := []interface{}{true, false, &quot;str&quot;, -1.1, 1, make([]int32, 10), make([]float64, 20)} fury := furygo.NewFury() bytes, err := fury.Marshal(list) if err != nil { panic(err) } var newValue interface{} // bytes can be data serialized by other languages. if err := fury.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) dict := map[string]interface{}{ &quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: list, &quot;k3&quot;: -1, } bytes, err = fury.Marshal(dict) if err != nil { panic(err) } // bytes can be data serialized by other languages. if err := fury.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) }   JavaScript  import Fury from &quot;@furyjs/fury&quot;; /** * @furyjs/hps use v8's fast-calls-api that can be called directly by jit, ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from &quot;@furyjs/hps&quot;; const fury = new Fury({ hps }); const input = fury.serialize(&quot;hello fury&quot;); const result = fury.deserialize(input); console.log(result);   Rust  use chrono::{NaiveDate, NaiveDateTime}; use fury::{from_buffer, to_buffer, Fury}; use std::collections::HashMap; fn run() { let bin: Vec&lt;u8&gt; = to_buffer(&amp;&quot;hello&quot;.to_string()); let obj: String = from_buffer(&amp;bin).expect(&quot;should success&quot;); assert_eq!(&quot;hello&quot;.to_string(), obj); }   ","version":"0.10","tagName":"h3"},{"title":"Serialize custom types‚Äã","type":1,"pageTitle":"Xlang Serialization","url":"/docs/0.10/guide/xlang_serialization#serialize-custom-types","content":" Serializing user-defined types needs registering the custom type using the register API to establish the mapping relationship between the type in different languages.  Java  import org.apache.fury.*; import org.apache.fury.config.*; import java.util.*; public class Example2 { public static class SomeClass1 { Object f1; Map&lt;Byte, Integer&gt; f2; } public static class SomeClass2 { Object f1; String f2; List&lt;Object&gt; f3; Map&lt;Byte, Integer&gt; f4; Byte f5; Short f6; Integer f7; Long f8; Float f9; Double f10; short[] f11; List&lt;Short&gt; f12; } public static Object createObject() { SomeClass1 obj1 = new SomeClass1(); obj1.f1 = true; obj1.f2 = ofHashMap((byte) -1, 2); SomeClass2 obj = new SomeClass2(); obj.f1 = obj1; obj.f2 = &quot;abc&quot;; obj.f3 = ofArrayList(&quot;abc&quot;, &quot;abc&quot;); obj.f4 = ofHashMap((byte) 1, 2); obj.f5 = Byte.MAX_VALUE; obj.f6 = Short.MAX_VALUE; obj.f7 = Integer.MAX_VALUE; obj.f8 = Long.MAX_VALUE; obj.f9 = 1.0f / 2; obj.f10 = 1 / 3.0; obj.f11 = new short[]{(short) 1, (short) 2}; obj.f12 = ofArrayList((short) -1, (short) 4); return obj; } // mvn exec:java -Dexec.mainClass=&quot;org.apache.fury.examples.Example2&quot; public static void main(String[] args) { Fury fury = Fury.builder().withLanguage(Language.XLANG).build(); fury.register(SomeClass1.class, &quot;example.SomeClass1&quot;); fury.register(SomeClass2.class, &quot;example.SomeClass2&quot;); byte[] bytes = fury.serialize(createObject()); // bytes can be data serialized by other languages. System.out.println(fury.deserialize(bytes)); } }   Python  from dataclasses import dataclass from typing import List, Dict, Any import pyfury, array @dataclass class SomeClass1: f1: Any f2: Dict[pyfury.Int8Type, pyfury.Int32Type] @dataclass class SomeClass2: f1: Any = None f2: str = None f3: List[str] = None f4: Dict[pyfury.Int8Type, pyfury.Int32Type] = None f5: pyfury.Int8Type = None f6: pyfury.Int16Type = None f7: pyfury.Int32Type = None # int type will be taken as `pyfury.Int64Type`. # use `pyfury.Int32Type` for type hint if peer # are more narrow type. f8: int = None f9: pyfury.Float32Type = None # float type will be taken as `pyfury.Float64Type` f10: float = None f11: pyfury.Int16ArrayType = None f12: List[pyfury.Int16Type] = None if __name__ == &quot;__main__&quot;: f = pyfury.Fury() f.register_type(SomeClass1, typename=&quot;example.SomeClass1&quot;) f.register_type(SomeClass2, typename=&quot;example.SomeClass2&quot;) obj1 = SomeClass1(f1=True, f2={-1: 2}) obj = SomeClass2( f1=obj1, f2=&quot;abc&quot;, f3=[&quot;abc&quot;, &quot;abc&quot;], f4={1: 2}, f5=2 ** 7 - 1, f6=2 ** 15 - 1, f7=2 ** 31 - 1, f8=2 ** 63 - 1, f9=1.0 / 2, f10=1 / 3.0, f11=array.array(&quot;h&quot;, [1, 2]), f12=[-1, 4], ) data = f.serialize(obj) # bytes can be data serialized by other languages. print(f.deserialize(data))   Golang  package main import furygo &quot;github.com/apache/fury/fury/go/fury&quot; import &quot;fmt&quot; func main() { type SomeClass1 struct { F1 interface{} F2 string F3 []interface{} F4 map[int8]int32 F5 int8 F6 int16 F7 int32 F8 int64 F9 float32 F10 float64 F11 []int16 F12 fury.Int16Slice } type SomeClas2 struct { F1 interface{} F2 map[int8]int32 } fury := furygo.NewFury() if err := fury.RegisterTagType(&quot;example.SomeClass1&quot;, SomeClass1{}); err != nil { panic(err) } if err := fury.RegisterTagType(&quot;example.SomeClass2&quot;, SomeClass2{}); err != nil { panic(err) } obj1 := &amp;SomeClass1{} obj1.F1 = true obj1.F2 = map[int8]int32{-1: 2} obj := &amp;SomeClass1{} obj.F1 = obj1 obj.F2 = &quot;abc&quot; obj.F3 = []interface{}{&quot;abc&quot;, &quot;abc&quot;} f4 := map[int8]int32{1: 2} obj.F4 = f4 obj.F5 = fury.MaxInt8 obj.F6 = fury.MaxInt16 obj.F7 = fury.MaxInt32 obj.F8 = fury.MaxInt64 obj.F9 = 1.0 / 2 obj.F10 = 1 / 3.0 obj.F11 = []int16{1, 2} obj.F12 = []int16{-1, 4} bytes, err := fury.Marshal(obj); if err != nil { panic(err) } var newValue interface{} // bytes can be data serialized by other languages. if err := fury.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) }   JavaScript  import Fury, { Type, InternalSerializerType } from &quot;@furyjs/fury&quot;; /** * @furyjs/hps use v8's fast-calls-api that can be called directly by jit, ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from &quot;@furyjs/hps&quot;; // Now we describe data structures using JSON, but in the future, we will use more ways. const description = Type.object(&quot;example.foo&quot;, { foo: Type.string(), }); const fury = new Fury({ hps }); const { serialize, deserialize } = fury.registerSerializer(description); const input = serialize({ foo: &quot;hello fury&quot; }); const result = deserialize(input); console.log(result);   Rust  use chrono::{NaiveDate, NaiveDateTime}; use fury::{from_buffer, to_buffer, Fury}; use std::collections::HashMap; #[test] fn complex_struct() { #[derive(Fury, Debug, PartialEq)] #[tag(&quot;example.foo2&quot;)] struct Animal { category: String, } #[derive(Fury, Debug, PartialEq)] #[tag(&quot;example.foo&quot;)] struct Person { c1: Vec&lt;u8&gt;, // binary c2: Vec&lt;i16&gt;, // primitive array animal: Vec&lt;Animal&gt;, c3: Vec&lt;Vec&lt;u8&gt;&gt;, name: String, c4: HashMap&lt;String, String&gt;, age: u16, op: Option&lt;String&gt;, op2: Option&lt;String&gt;, date: NaiveDate, time: NaiveDateTime, c5: f32, c6: f64, } let person: Person = Person { c1: vec![1, 2, 3], c2: vec![5, 6, 7], c3: vec![vec![1, 2], vec![1, 3]], animal: vec![Animal { category: &quot;Dog&quot;.to_string(), }], c4: HashMap::from([ (&quot;hello1&quot;.to_string(), &quot;hello2&quot;.to_string()), (&quot;hello2&quot;.to_string(), &quot;hello3&quot;.to_string()), ]), age: 12, name: &quot;helo&quot;.to_string(), op: Some(&quot;option&quot;.to_string()), op2: None, date: NaiveDate::from_ymd_opt(2025, 12, 12).unwrap(), time: NaiveDateTime::from_timestamp_opt(1689912359, 0).unwrap(), c5: 2.0, c6: 4.0, }; let bin: Vec&lt;u8&gt; = to_buffer(&amp;person); let obj: Person = from_buffer(&amp;bin).expect(&quot;should success&quot;); assert_eq!(person, obj); }   ","version":"0.10","tagName":"h3"},{"title":"Serialize Shared Reference and Circular Reference‚Äã","type":1,"pageTitle":"Xlang Serialization","url":"/docs/0.10/guide/xlang_serialization#serialize-shared-reference-and-circular-reference","content":" Shared reference and circular reference can be serialized automatically, no duplicate data or recursion error.  Java  import org.apache.fury.*; import org.apache.fury.config.*; import java.util.*; public class ReferenceExample { public static class SomeClass { SomeClass f1; Map&lt;String, String&gt; f2; Map&lt;String, String&gt; f3; } public static Object createObject() { SomeClass obj = new SomeClass(); obj.f1 = obj; obj.f2 = ofHashMap(&quot;k1&quot;, &quot;v1&quot;, &quot;k2&quot;, &quot;v2&quot;); obj.f3 = obj.f2; return obj; } // mvn exec:java -Dexec.mainClass=&quot;org.apache.fury.examples.ReferenceExample&quot; public static void main(String[] args) { Fury fury = Fury.builder().withLanguage(Language.XLANG) .withRefTracking(true).build(); fury.register(SomeClass.class, &quot;example.SomeClass&quot;); byte[] bytes = fury.serialize(createObject()); // bytes can be data serialized by other languages. System.out.println(fury.deserialize(bytes)); } }   Python  from typing import Dict import pyfury class SomeClass: f1: &quot;SomeClass&quot; f2: Dict[str, str] f3: Dict[str, str] fury = pyfury.Fury(ref_tracking=True) fury.register_type(SomeClass, typename=&quot;example.SomeClass&quot;) obj = SomeClass() obj.f2 = {&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: &quot;v2&quot;} obj.f1, obj.f3 = obj, obj.f2 data = fury.serialize(obj) # bytes can be data serialized by other languages. print(fury.deserialize(data))   Golang  package main import furygo &quot;github.com/apache/fury/fury/go/fury&quot; import &quot;fmt&quot; func main() { type SomeClass struct { F1 *SomeClass F2 map[string]string F3 map[string]string } fury := furygo.NewFury(true) if err := fury.RegisterTagType(&quot;example.SomeClass&quot;, SomeClass{}); err != nil { panic(err) } value := &amp;SomeClass{F2: map[string]string{&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: &quot;v2&quot;}} value.F3 = value.F2 value.F1 = value bytes, err := fury.Marshal(value) if err != nil { } var newValue interface{} // bytes can be data serialized by other languages. if err := fury.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) }   JavaScript  import Fury, { Type } from '@furyjs/fury'; /** * @furyjs/hps use v8's fast-calls-api that can be called directly by jit, ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from '@furyjs/hps'; const description = Type.object('example.foo', { foo: Type.string(), bar: Type.object('example.foo'), }); const fury = new Fury({ hps }); const { serialize, deserialize } = fury.registerSerializer(description); const data: any = { foo: 'hello fury', }; data.bar = data; const input = serialize(data); const result = deserialize(input); console.log(result.bar.foo === result.foo);   JavaScriptReference cannot be implemented because of rust ownership restrictions  ","version":"0.10","tagName":"h3"},{"title":"Zero-Copy Serialization‚Äã","type":1,"pageTitle":"Xlang Serialization","url":"/docs/0.10/guide/xlang_serialization#zero-copy-serialization","content":" Java  import org.apache.fury.*; import org.apache.fury.config.*; import org.apache.fury.serializer.BufferObject; import org.apache.fury.memory.MemoryBuffer; import java.util.*; import java.util.stream.Collectors; public class ZeroCopyExample { // mvn exec:java -Dexec.mainClass=&quot;io.ray.fury.examples.ZeroCopyExample&quot; public static void main(String[] args) { Fury fury = Fury.builder().withLanguage(Language.XLANG).build(); List&lt;Object&gt; list = ofArrayList(&quot;str&quot;, new byte[1000], new int[100], new double[100]); Collection&lt;BufferObject&gt; bufferObjects = new ArrayList&lt;&gt;(); byte[] bytes = fury.serialize(list, e -&gt; !bufferObjects.add(e)); // bytes can be data serialized by other languages. List&lt;MemoryBuffer&gt; buffers = bufferObjects.stream() .map(BufferObject::toBuffer).collect(Collectors.toList()); System.out.println(fury.deserialize(bytes, buffers)); } }   Python  import array import pyfury import numpy as np fury = pyfury.Fury() list_ = [&quot;str&quot;, bytes(bytearray(1000)), array.array(&quot;i&quot;, range(100)), np.full(100, 0.0, dtype=np.double)] serialized_objects = [] data = fury.serialize(list_, buffer_callback=serialized_objects.append) buffers = [o.to_buffer() for o in serialized_objects] # bytes can be data serialized by other languages. print(fury.deserialize(data, buffers=buffers))   Golang  package main import furygo &quot;github.com/apache/fury/fury/go/fury&quot; import &quot;fmt&quot; func main() { fury := furygo.NewFury() list := []interface{}{&quot;str&quot;, make([]byte, 1000)} buf := fury.NewByteBuffer(nil) var bufferObjects []fury.BufferObject fury.Serialize(buf, list, func(o fury.BufferObject) bool { bufferObjects = append(bufferObjects, o) return false }) var newList []interface{} var buffers []*fury.ByteBuffer for _, o := range bufferObjects { buffers = append(buffers, o.ToBuffer()) } if err := fury.Deserialize(buf, &amp;newList, buffers); err != nil { panic(err) } fmt.Println(newList) }   JavaScript  // Coming soon  ","version":"0.10","tagName":"h3"},{"title":"Community","type":0,"sectionRef":"#","url":"/docs/0.11/community/","content":"","keywords":"","version":"0.11"},{"title":"Mailing list‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.11/community/#mailing-list","content":" Name\tDesc\tSubscribe\tUnsubscribe\tPost\tArchivedev@fory.apache.org\tDevelopment related discussions\tSubscribe\tUnsubscribe\tPost\tArchive commits@fory.apache.org\tAll commits to our repositories\tSubscribe\tUnsubscribe\tRead only list\tArchive  Please make sure subscribe to any list before attempting to post.  If you are not subscribed to the mailing list, your message will either be rejected or you won't receive the response.  ","version":"0.11","tagName":"h2"},{"title":"How to subscribe to a mailing list‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.11/community/#how-to-subscribe-to-a-mailing-list","content":" To post messages, subscribe first by:  Sending an email to listname-subscribe@fory.apache.org with listname replaced accordingly.Replying to the confirmation email you'll receive, keeping the subject line intact.You'll then get a welcome email, and the subscription succeeds.  When discussing code snippets in emails, ensure:  You do not link to files in external services, as such files can change, get deleted or the link might break and thus make an archived email thread useless.You paste text instead of screenshots of text.You keep formatting when pasting code in order to keep the code readable.There are enough import statements to avoid ambiguities.  ","version":"0.11","tagName":"h3"},{"title":"Slack‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.11/community/#slack","content":" You can join the Apache Fory‚Ñ¢ community on Slack.  There are a couple of community rules:  Be respectful and nice.All important decisions and conclusions must be reflected back to the mailing lists. &quot;If it didn't happen on a mailing list, it didn't happen.&quot; - The Apache Mottos.Use Slack threads to keep parallel conversations from overwhelming a channel.Please do not direct message people for troubleshooting, issue assigning and PR review. These should be picked-up voluntarily.  ","version":"0.11","tagName":"h2"},{"title":"Issue tracker‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.11/community/#issue-tracker","content":" We use GitHub Issues to track all issues:  code related issues: https://github.com/apache/fory/issueswebsite related issues: https://github.com/apache/fory-site/issues  You need to have a GitHub account in order to create issues. If you don't have a GitHub account, you can post an email to dev@fory.apache.org.  ","version":"0.11","tagName":"h2"},{"title":"Bug reports‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.11/community/#bug-reports","content":" To report a bug:  Verify that the bug does in fact exist.Search the issue tracker to verify there is no existing issue reporting the bug you've found.Create a bug report on issue tracker.If possible, dive into the source code of fory, and submit a patch for the bug you reported, this helps ensure the bug will be fixed quickly.  ","version":"0.11","tagName":"h3"},{"title":"Reporting a Vulnerability‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.11/community/#reporting-a-vulnerability","content":" Apache Fory‚Ñ¢ is a project of the Apache Software Foundation and follows the ASF vulnerability handling process.  To report a new vulnerability you have discovered please follow the ASF vulnerability reporting process, which explains how to send us details privately.  ","version":"0.11","tagName":"h3"},{"title":"Enhancement‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.11/community/#enhancement","content":" Enhancements or new feature proposals are also welcome. The more concrete and rationale the proposal is, the greater the chance it will be incorporated into future releases.  ","version":"0.11","tagName":"h3"},{"title":"Source code‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.11/community/#source-code","content":" fory core repository: https://github.com/apache/foryfory website repository: https://github.com/apache/fory-site ","version":"0.11","tagName":"h2"},{"title":"How to join Apache Fory‚Ñ¢","type":0,"sectionRef":"#","url":"/docs/0.11/community/how_to_join_community","content":"","keywords":"","version":"0.11"},{"title":"Fory Contribution Guide‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.11/community/how_to_join_community#fory-contribution-guide","content":" The Fory team usually conducts development and issue maintenance on GitHub. Please open the GitHub website, click the Sign up button in the upper right corner, register your own account, and take the first step of your open source journey.  In the Fory repository, we have a guide for all open source contributors, introducing contents such as version management and branch management. Please take a few minutes to read and understand it.  ","version":"0.11","tagName":"h2"},{"title":"Your First Pull Request‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.11/community/how_to_join_community#your-first-pull-request","content":" ","version":"0.11","tagName":"h2"},{"title":"Step 0: Install Git‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.11/community/how_to_join_community#step-0-install-git","content":" Git is a version control system used to track and manage code changes in software development projects. It helps developers record and manage the history of the code, facilitating team collaboration, code version control, code merging, and other operations. With Git, you can track each version of each file and easily switch and compare between different versions. Git also provides branch management functionality, allowing multiple concurrent development tasks to be carried out simultaneously.  Visit the official Git website: [https://git-scm.com/] (https://git-scm.com/)Download the latest version of the Git installer.Run the downloaded installer and follow the prompts of the installation wizard to install.After the installation is complete, you can use the git version command in the command line to confirm the successful installation.  ","version":"0.11","tagName":"h3"},{"title":"Step 1: Fork the Project‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.11/community/how_to_join_community#step-1-fork-the-project","content":" First, you need to fork this project. Enter the Fory project page, and click the Fork button in the upper right corner.In your GitHub account, the project xxxx (your GitHub username)/fory will appear.On your local computer, use the following commands to obtain a fory folder:  // ssh git clone git@github.com:xxxx (your GitHub username)/fory.git // https git clone https://github.com/xxxx (your GitHub username)/fory.git   ","version":"0.11","tagName":"h3"},{"title":"Step 2: Obtain the Project Code‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.11/community/how_to_join_community#step-2-obtain-the-project-code","content":" Enter the fory folder and add the remote address of fory:  git remote add upstream https://github.com/apache/fory.git   ","version":"0.11","tagName":"h3"},{"title":"Step 3: Create a Branch‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.11/community/how_to_join_community#step-3-create-a-branch","content":" Alright, now you can start contributing our code. The default branch of Fory is the main branch. Whether it is for function development, bug fixes, or documentation writing, please create a new branch and then merge it to the main branch. Use the following code to create a branch:  // Create a function development branch git checkout -b feat/xxxx // Create a problem-fixing development branch git checkout -b fix/xxxx // Create a documentation, demo branch git checkout -b docs/add-java-demo   Suppose we have created the documentation modification branch docs/add-java-demo and we have added some code and submitted it to the code repository.  git add .git commit -a -m &quot;docs: add java demo and related docs&quot;  ","version":"0.11","tagName":"h3"},{"title":"Step 4: Merge the Modifications‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.11/community/how_to_join_community#step-4-merge-the-modifications","content":" Switch back to your development branch:  git checkout docs/add-java-demo   Submit the updated code to your branch:  git push origin docs/add-java-demo   ","version":"0.11","tagName":"h3"},{"title":"Step 5: Submit a Pull Request‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.11/community/how_to_join_community#step-5-submit-a-pull-request","content":" You can click the Compare &amp; pull request button on your GitHub code repository page. Or create it through the contribute button.  Fill in what type of modification this is.Fill in the associated issue.If there are complex changes, please explain the background and solution.  After filling in the relevant information, click Create pull request to submit.  ","version":"0.11","tagName":"h3"},{"title":"Easily Step into the Fory Open Source Contribution Journey‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.11/community/how_to_join_community#easily-step-into-the-fory-open-source-contribution-journey","content":" &quot;good first issue&quot; is a common label in the open source community, and the purpose of this label is to help new contributors find entry-level issues that are suitable for them.  The entry-level issues of Fory can be viewed through the issue list.  If you currently have the time and willingness to participate in community contributions, you can take a look at good first issue in the issues and select one that interests you and is suitable for you to claim.  ","version":"0.11","tagName":"h2"},{"title":"Embrace the Apache Fory Community‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.11/community/how_to_join_community#embrace-the-apache-fory-community","content":" While you contribute code to Fory, we encourage you to participate in other things that make the community more prosperous, such as:  Offer suggestions for the project's development, functional planning, etc.Create articles, videos, and hold lectures to promote Fory.Write promotion plans and execute them together with the team. ","version":"0.11","tagName":"h2"},{"title":"Usage","type":0,"sectionRef":"#","url":"/docs/0.10/start/usage","content":"","keywords":"","version":"0.10"},{"title":"Java Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.10/start/usage#java-serialization","content":" import java.util.List; import java.util.Arrays; import org.apache.fury.*; public class Example { public static void main(String[] args) { SomeClass object = new SomeClass(); // Note that Fury instances should be reused between // multiple serializations of different objects. Fury fury = Fury.builder().withLanguage(Language.JAVA) // Allow to deserialize objects unknown types, // more flexible but less secure. // .requireClassRegistration(false) .build(); // Registering types can reduce class name serialization overhead, but not mandatory. // If secure mode enabled, all custom types must be registered. fury.register(SomeClass.class); byte[] bytes = fury.serialize(object); System.out.println(fury.deserialize(bytes)); } }   ","version":"0.10","tagName":"h2"},{"title":"Scala Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.10/start/usage#scala-serialization","content":" import org.apache.fury.Fury import org.apache.fury.serializer.scala.ScalaSerializers case class Person(name: String, id: Long, github: String) case class Point(x : Int, y : Int, z : Int) object ScalaExample { val fury: Fury = Fury.builder().withScalaOptimizationEnabled(true).build() // Register optimized fury serializers for scala ScalaSerializers.registerSerializers(fury) fury.register(classOf[Person]) fury.register(classOf[Point]) def main(args: Array[String]): Unit = { val p = Person(&quot;Shawn Yang&quot;, 1, &quot;https://github.com/chaokunyang&quot;) println(fury.deserialize(fury.serialize(p))) println(fury.deserialize(fury.serialize(Point(1, 2, 3)))) } }   ","version":"0.10","tagName":"h2"},{"title":"Kotlin Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.10/start/usage#kotlin-serialization","content":" import org.apache.fury.Fury import org.apache.fury.ThreadSafeFury import org.apache.fury.serializer.kotlin.KotlinSerializers data class Person(val name: String, val id: Long, val github: String) data class Point(val x : Int, val y : Int, val z : Int) fun main(args: Array&lt;String&gt;) { // Note: following fury init code should be executed only once in a global scope instead // of initializing it everytime when serialization. val fury: ThreadSafeFury = Fury.builder().requireClassRegistration(true).buildThreadSafeFury() KotlinSerializers.registerSerializers(fury) fury.register(Person::class.java) fury.register(Point::class.java) val p = Person(&quot;Shawn Yang&quot;, 1, &quot;https://github.com/chaokunyang&quot;) println(fury.deserialize(fury.serialize(p))) println(fury.deserialize(fury.serialize(Point(1, 2, 3)))) }   ","version":"0.10","tagName":"h2"},{"title":"CrossLanguage Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.10/start/usage#crosslanguage-serialization","content":" ","version":"0.10","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.10/start/usage#java","content":" import com.google.common.collect.ImmutableMap; import org.apache.fury.*; import java.util.Map; public class ReferenceExample { public static class SomeClass { SomeClass f1; Map&lt;String, String&gt; f2; Map&lt;String, String&gt; f3; } public static Object createObject() { SomeClass obj = new SomeClass(); obj.f1 = obj; obj.f2 = ImmutableMap.of(&quot;k1&quot;, &quot;v1&quot;, &quot;k2&quot;, &quot;v2&quot;); obj.f3 = obj.f2; return obj; } // mvn exec:java -Dexec.mainClass=&quot;io.fury.examples.ReferenceExample&quot; public static void main(String[] args) { Fury fury = Fury.builder().withLanguage(Language.XLANG) .withRefTracking(true).build(); fury.register(SomeClass.class, &quot;example.SomeClass&quot;); byte[] bytes = fury.serialize(createObject()); // bytes can be data serialized by other languages. System.out.println(fury.deserialize(bytes)); ; } }   ","version":"0.10","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.10/start/usage#python","content":" from typing import Dict import pyfury class SomeClass: f1: &quot;SomeClass&quot; f2: Dict[str, str] f3: Dict[str, str] fury = pyfury.Fury(ref_tracking=True) fury.register_class(SomeClass, &quot;example.SomeClass&quot;) obj = SomeClass() obj.f2 = {&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: &quot;v2&quot;} obj.f1, obj.f3 = obj, obj.f2 data = fury.serialize(obj) # bytes can be data serialized by other languages. print(fury.deserialize(data))   ","version":"0.10","tagName":"h3"},{"title":"Golang‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.10/start/usage#golang","content":" package main import ( &quot;fmt&quot; furygo &quot;github.com/apache/fury/go/fury&quot; ) func main() { type SomeClass struct { F1 *SomeClass F2 map[string]string F3 map[string]string } fury := furygo.NewFury(true) if err := fury.RegisterTagType(&quot;example.SomeClass&quot;, SomeClass{}); err != nil { panic(err) } value := &amp;SomeClass{F2: map[string]string{&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: &quot;v2&quot;}} value.F3 = value.F2 value.F1 = value bytes, err := fury.Marshal(value) if err != nil { } var newValue interface{} // bytes can be data serialized by other languages. if err := fury.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) }   ","version":"0.10","tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.10/start/usage#javascript","content":" import Fury, { Type } from &quot;@furyjs/fury&quot;; /** * @furyjs/hps use v8's fast-calls-api that can be called directly by jit, ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from &quot;@furyjs/hps&quot;; // Now we describe data structures using JSON, but in the future, we will use more ways. const description = Type.object(&quot;example.foo&quot;, { foo: Type.string(), }); const fury = new Fury({ hps }); const { serialize, deserialize } = fury.registerSerializer(description); const input = serialize({ foo: &quot;hello fury&quot; }); const result = deserialize(input); console.log(result);   ","version":"0.10","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.10/start/usage#rust","content":" use fury::{from_buffer, to_buffer, Fury}; #[derive(Fury, Debug, PartialEq)] #[tag(&quot;example.foo&quot;)] struct Animal { name: String, category: String, } #[derive(Fury, Debug, PartialEq)] #[tag(&quot;example.bar&quot;)] struct Person { name: String, age: u32, pets: Vec&lt;Animal&gt;, } fn main() { let penson = Person { name: &quot;hello&quot;.to_string(), age: 12, pets: vec![ Animal { name: &quot;world1&quot;.to_string(), category: &quot;cat&quot;.to_string(), }, Animal { name: &quot;world2&quot;.to_string(), category: &quot;dog&quot;.to_string(), }, ], }; let bin = to_buffer(&amp;penson); let obj: Person = from_buffer(&amp;bin).expect(&quot;should success&quot;); assert_eq!(obj, penson); }  ","version":"0.10","tagName":"h3"},{"title":"How to verify","type":0,"sectionRef":"#","url":"/docs/0.11/community/how_to_verify","content":"","keywords":"","version":"0.11"},{"title":"Download the candidate version‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/0.11/community/how_to_verify#download-the-candidate-version","content":" #If there is svn locally, you can clone to the local svn co https://dist.apache.org/repos/dist/dev/incubator/fory/${release_version}-${rc_version}/ # You can download the material file directly wget https://dist.apache.org/repos/dist/dev/incubator/fory/${release_version}-${rc_version}/xxx.xxx   ","version":"0.11","tagName":"h2"},{"title":"Verify checksums and signatures‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/0.11/community/how_to_verify#verify-checksums-and-signatures","content":" First you need to install gpg:  apt-get install gnupg # or yum install gnupg # or brew install gnupg   Then import the Fory release manager's public key:  curl https://downloads.apache.org/incubator/fory/KEYS &gt; KEYS # Download KEYS gpg --import KEYS # Import KEYS to local # Then, trust the public key: gpg --edit-key &lt;KEY-used-in-this-version&gt; # Edit the key(mentioned in vote email) # It will enter the interactive mode, use the following command to trust the key: gpg (GnuPG) 2.0.22; Copyright (C) 2013 Free Software Foundation, Inc. This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. pub 4096R/5E580BA4 created: 2024-03-27 expires: never usage: SC trust: unknown validity: unknown sub 4096R/A31EF728 created: 2024-03-27 expires: never usage: E [ unknown] (1). chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; gpg&gt; trust pub 4096R/5E580BA4 created: 2024-03-27 expires: never usage: SC trust: unknown validity: unknown sub 4096R/A31EF728 created: 2024-03-27 expires: never usage: E [ unknown] (1). chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; Please decide how far you trust this user to correctly verify other users' keys (by looking at passports, checking fingerprints from different sources, etc.) 1 = I don't know or won't say 2 = I do NOT trust 3 = I trust marginally 4 = I trust fully 5 = I trust ultimately m = back to the main menu Your decision? 5 Do you really want to set this key to ultimate trust? (y/N) y pub 4096R/5E580BA4 created: 2024-03-27 expires: never usage: SC trust: ultimate validity: unknown sub 4096R/A31EF728 created: 2024-03-27 expires: never usage: E [ unknown] (1). chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; Please note that the shown key validity is not necessarily correct unless you restart the program.   Next verify signature:  for i in *.tar.gz; do echo $i; gpg --verify $i.asc $i; done   If something like the following appears, it means the signature is correct:  apache-fory-incubating-0.5.0-src.tar.gz gpg: Signature made Wed 17 Apr 2024 11:49:45 PM CST using RSA key ID 5E580BA4 gpg: checking the trustdb gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model gpg: depth: 0 valid: 1 signed: 0 trust: 0-, 0q, 0n, 0m, 0f, 1u gpg: Good signature from &quot;chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt;&quot;   Then verify checksum:  for i in *.tar.gz; do echo $i; sha512sum --check $i.sha512*; done   It should output something like:  apache-fory-incubating-0.5.0-src.tar.gz apache-fory-incubating-0.5.0-src.tar.gz: OK   ","version":"0.11","tagName":"h2"},{"title":"Check the file content of the source package‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/0.11/community/how_to_verify#check-the-file-content-of-the-source-package","content":" Unzip apache-fory-${release_version}-${rc_version}-src.tar.gz and check the follows:  LICENSE and NOTICE files are correct for the repository.All files have ASF license headers if necessary.Building is OK.  ","version":"0.11","tagName":"h2"},{"title":"Check the Maven artifacts of fory-java‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/0.11/community/how_to_verify#check-the-maven-artifacts-of-fory-java","content":" Download the artifacts from https://repository.apache.org/content/repositories/orgapachefory-${maven_artifact_number}/.  You can check the follows:  Checksum of JARs match the bundled checksum file.Signature of JARs match the bundled signature file.JARs is reproducible locally. This means you can build the JARs on your machine and verify the checksum is the same with the bundled one. ","version":"0.11","tagName":"h2"},{"title":"Development","type":0,"sectionRef":"#","url":"/docs/0.11/guide/development","content":"","keywords":"","version":"0.11"},{"title":"How to build Fory‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.11/guide/development#how-to-build-fory","content":" Please checkout the source tree from https://github.com/apache/fory.  ","version":"0.11","tagName":"h2"},{"title":"Build Fory Java‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.11/guide/development#build-fory-java","content":" cd java mvn clean compile -DskipTests   Environment Requirements‚Äã  java 1.8+maven 3.6.3+  ","version":"0.11","tagName":"h3"},{"title":"Build Fory Python‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.11/guide/development#build-fory-python","content":" cd python # Uninstall numpy first so that when we install pyarrow, it will install the correct numpy version automatically. # For Python versions less than 3.13, numpy 2 is not currently supported. pip uninstall -y numpy # Install necessary environment for Python &lt; 3.13. pip install pyarrow==15.0.0 Cython wheel pytest # For Python 3.13, pyarrow 18.0.0 is available and requires numpy version greater than 2. # pip install pyarrow==18.0.0 Cython wheel pytest pip install -v -e .   Environment Requirements‚Äã  python 3.6+  ","version":"0.11","tagName":"h3"},{"title":"Build Fory C++‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.11/guide/development#build-fory-c","content":" Build fory row formatÔºö  pip install pyarrow==15.0.0 bazel build //cpp/fory/row:fory_row_format   Build fory row format encoder:  pip install pyarrow==15.0.0 bazel build //cpp/fory/encoder:fory_encoder   Environment Requirements‚Äã  compilers with C++17 supportbazel 6.3.2  ","version":"0.11","tagName":"h3"},{"title":"Build Fory GoLang‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.11/guide/development#build-fory-golang","content":" cd go/fory # run test go test -v # run xlang test go test -v fory_xlang_test.go   Environment Requirements‚Äã  go 1.13+  ","version":"0.11","tagName":"h3"},{"title":"Build Fory Rust‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.11/guide/development#build-fory-rust","content":" cd rust # build cargo build # run test cargo test   Environment Requirements‚Äã  curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh   ","version":"0.11","tagName":"h3"},{"title":"Build Fory JavaScript‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.11/guide/development#build-fory-javascript","content":" cd javascript npm install # run build npm run build # run test npm run test   Environment Requirements‚Äã  node 14+npm 8+  ","version":"0.11","tagName":"h3"},{"title":"Lint Markdown Docs‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.11/guide/development#lint-markdown-docs","content":" # Install prettier globally npm install -g prettier # Fix markdown files prettier --write &quot;**/*.md&quot;   Environment Requirements‚Äã  node 14+npm 8+ ","version":"0.11","tagName":"h3"},{"title":"GraalVM Serialization","type":0,"sectionRef":"#","url":"/docs/0.11/guide/graalvm_serialization","content":"","keywords":"","version":"0.11"},{"title":"GraalVM Native Image‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.11/guide/graalvm_serialization#graalvm-native-image","content":" GraalVM native image can compile java code into native code ahead to build faster, smaller, leaner applications. The native image doesn't have a JIT compiler to compile bytecode into machine code, and doesn't support reflection unless configure reflection file.  Fory runs on GraalVM native image pretty well. Fory generates all serializer code for Fory JIT framework and MethodHandle/LambdaMetafactory at graalvm build time. Then use those generated code for serialization at runtime without any extra cost, the performance is great.  In order to use Fory on graalvm native image, you must create Fory as an static field of a class, and register all classes at the enclosing class initialize time. Then configure native-image.properties underresources/META-INF/native-image/$xxx/native-image.propertie to tell graalvm to init the class at native image build time. For example, here we configure org.apache.fory.graalvm.Example class be init at build time:  Args = --initialize-at-build-time=org.apache.fory.graalvm.Example   Another benefit using fory is that you don't have to configure reflection json andserialization json, which is very tedious, cumbersome and inconvenient. When using fory, you just need to invokeorg.apache.fory.Fory.register(Class&lt;?&gt;, boolean) for every type you want to serialize.  Note that Fory asyncCompilationEnabled option will be disabled automatically for graalvm native image since graalvm native image doesn't support JIT at the image run time.  ","version":"0.11","tagName":"h2"},{"title":"Not thread-safe Fory‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.11/guide/graalvm_serialization#not-thread-safe-fory","content":" Example:  import org.apache.fory.Fory; import org.apache.fory.util.Preconditions; import java.util.List; import java.util.Map; public class Example { public record Record ( int f1, String f2, List&lt;String&gt; f3, Map&lt;String, Long&gt; f4) { } static Fory fory; static { fory = Fory.builder().build(); // register and generate serializer code. fory.register(Record.class, true); } public static void main(String[] args) { Record record = new Record(10, &quot;abc&quot;, List.of(&quot;str1&quot;, &quot;str2&quot;), Map.of(&quot;k1&quot;, 10L, &quot;k2&quot;, 20L)); System.out.println(record); byte[] bytes = fory.serialize(record); Object o = fory.deserialize(bytes); System.out.println(o); Preconditions.checkArgument(record.equals(o)); } }   Then add org.apache.fory.graalvm.Example build time init to native-image.properties configuration:  Args = --initialize-at-build-time=org.apache.fory.graalvm.Example   ","version":"0.11","tagName":"h2"},{"title":"Thread-safe Fory‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.11/guide/graalvm_serialization#thread-safe-fory","content":" import org.apache.fory.Fory; import org.apache.fory.ThreadLocalFory; import org.apache.fory.ThreadSafeFory; import org.apache.fory.util.Preconditions; import java.util.List; import java.util.Map; public class ThreadSafeExample { public record Foo ( int f1, String f2, List&lt;String&gt; f3, Map&lt;String, Long&gt; f4) { } static ThreadSafeFory fory; static { fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().build(); // register and generate serializer code. f.register(Foo.class, true); return f; }); } public static void main(String[] args) { System.out.println(fory.deserialize(fory.serialize(&quot;abc&quot;))); System.out.println(fory.deserialize(fory.serialize(List.of(1,2,3)))); System.out.println(fory.deserialize(fory.serialize(Map.of(&quot;k1&quot;, 1, &quot;k2&quot;, 2)))); Foo foo = new Foo(10, &quot;abc&quot;, List.of(&quot;str1&quot;, &quot;str2&quot;), Map.of(&quot;k1&quot;, 10L, &quot;k2&quot;, 20L)); System.out.println(foo); byte[] bytes = fory.serialize(foo); Object o = fory.deserialize(bytes); System.out.println(o); } }   Then add org.apache.fory.graalvm.ThreadSafeExample build time init to native-image.properties configuration:  Args = --initialize-at-build-time=org.apache.fory.graalvm.ThreadSafeExample   ","version":"0.11","tagName":"h2"},{"title":"Framework Integration‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.11/guide/graalvm_serialization#framework-integration","content":" For framework developers, if you want to integrate fory for serialization, you can provided a configuration file to let the users to list all the classes they want to serialize, then you can load those classes and invokeorg.apache.fory.Fory.register(Class&lt;?&gt;, boolean) to register those classes in your Fory integration class, and configure that class be initialized at graalvm native image build time.  ","version":"0.11","tagName":"h2"},{"title":"Benchmark‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.11/guide/graalvm_serialization#benchmark","content":" Here we give two class benchmarks between Fory and Graalvm Serialization.  When Fory compression is disabled:  Struct: Fory is 46x speed, 43% size compared to JDK.Pojo: Fory is 12x speed, 56% size compared to JDK.  When Fory compression is enabled:  Struct: Fory is 24x speed, 31% size compared to JDK.Pojo: Fory is 12x speed, 48% size compared to JDK.  See [Benchmark.java] for benchmark code.  ","version":"0.11","tagName":"h2"},{"title":"Struct Benchmark‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.11/guide/graalvm_serialization#struct-benchmark","content":" Class Fields‚Äã  public class Struct implements Serializable { public int f1; public long f2; public float f3; public double f4; public int f5; public long f6; public float f7; public double f8; public int f9; public long f10; public float f11; public double f12; }   Benchmark Results‚Äã  No compression:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Struct Compress number: false Fory size: 76.0 JDK size: 178.0 Fory serialization took mills: 49 JDK serialization took mills: 2254 Compare speed: Fory is 45.70x speed of JDK Compare size: Fory is 0.43x size of JDK   Compress number:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Struct Compress number: true Fory size: 55.0 JDK size: 178.0 Fory serialization took mills: 130 JDK serialization took mills: 3161 Compare speed: Fory is 24.16x speed of JDK Compare size: Fory is 0.31x size of JDK   ","version":"0.11","tagName":"h3"},{"title":"Pojo Benchmark‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.11/guide/graalvm_serialization#pojo-benchmark","content":" Class Fields‚Äã  public class Foo implements Serializable { int f1; String f2; List&lt;String&gt; f3; Map&lt;String, Long&gt; f4; }   Benchmark Results‚Äã  No compression:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Foo Compress number: false Fory size: 541.0 JDK size: 964.0 Fory serialization took mills: 1663 JDK serialization took mills: 16266 Compare speed: Fory is 12.19x speed of JDK Compare size: Fory is 0.56x size of JDK   Compress number:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Foo Compress number: true Fory size: 459.0 JDK size: 964.0 Fory serialization took mills: 1289 JDK serialization took mills: 15069 Compare speed: Fory is 12.11x speed of JDK Compare size: Fory is 0.48x size of JDK  ","version":"0.11","tagName":"h3"},{"title":"How to release","type":0,"sectionRef":"#","url":"/docs/0.11/community/how_to_release","content":"","keywords":"","version":"0.11"},{"title":"Introduction‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.11/community/how_to_release#introduction","content":" Source Release is the most important part which Apache values.  Please pay more attention to license and signing issues. Publishing software is a serious thing and has legal consequences.  ","version":"0.11","tagName":"h2"},{"title":"First-time as a release manager‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.11/community/how_to_release#first-time-as-a-release-manager","content":" ","version":"0.11","tagName":"h2"},{"title":"Environmental requirements‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.11/community/how_to_release#environmental-requirements","content":" This release process is operated in the Ubuntu OS, and the following tools are required:  JDK 1.8Apache Maven 3.xPython 3.8GnuPG 2.xGitSVN (apache uses svn to host project releases)Pay attention to setting environment variables: if you configure gpg keys under a different directory, please export GNUPGHOME=$(xxx)  ","version":"0.11","tagName":"h3"},{"title":"Prepare GPG Key‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.11/community/how_to_release#prepare-gpg-key","content":" If you are the first to become a release manager, you need to prepare a gpg key.  Following is a quick setup, you can refer to Apache openpgp doc for further details.  Install GPG‚Äã  sudo apt install gnupg2   Generate GPG Key‚Äã  Please use your apache name and email for generate key  $ gpg --full-gen-key gpg (GnuPG) 2.2.20; Copyright (C) 2020 Free Software Foundation, Inc. This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. Please select what kind of key you want: (1) RSA and RSA (default) (2) DSA and Elgamal (3) DSA (sign only) (4) RSA (sign only) (14) Existing key from card Your selection? 1 # input 1 RSA keys may be between 1024 and 4096 bits long. What keysize do you want? (2048) 4096 # input 4096 Requested keysize is 4096 bits Please specify how long the key should be valid. 0 = key does not expire &lt;n&gt; = key expires in n days &lt;n&gt;w = key expires in n weeks &lt;n&gt;m = key expires in n months &lt;n&gt;y = key expires in n years Key is valid for? (0) 0 # input 0 Key does not expire at all Is this correct? (y/N) y # input y GnuPG needs to construct a user ID to identify your key. Real name: Chaokun Yang # input your name Email address: chaokunyang@apache.org # input your email Comment: CODE SIGNING KEY # input some annotations, optional You selected this USER-ID: &quot;Chaokun &lt;chaokunyang@apache.org&gt;&quot; Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? O # input O We need to generate a lot of random bytes. It is a good idea to perform some other action (type on the keyboard, move the mouse, utilize the disks) during the prime generation; this gives the random number generator a better chance to gain enough entropy. We need to generate a lot of random bytes. It is a good idea to perform some other action (type on the keyboard, move the mouse, utilize the disks) during the prime generation; this gives the random number generator a better chance to gain enough entropy. # Input the security key ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ Please enter this passphrase ‚îÇ ‚îÇ ‚îÇ ‚îÇ Passphrase: _______________________________ ‚îÇ ‚îÇ ‚îÇ ‚îÇ &lt;OK&gt; &lt;Cancel&gt; ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò # key generation will be done after your inputting the key with the following output gpg: key E49B00F626B marked as ultimately trusted gpg: revocation certificate stored as '/Users/chaokunyang/.gnupg/openpgp-revocs.d/1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4.rev' public and secret key created and signed. pub rsa4096 2022-07-12 [SC] 1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4 uid [ultimate] Chaokun &lt;chaokunyang@apache.org&gt; sub rsa4096 2022-07-12 [E]   Upload your public key to public GPG keyserver‚Äã  Firstly, list your key:  gpg --list-keys   The output is like:  -------------------------------------------------- pub rsa4096 2024-03-27 [SC] 1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4 uid [ultimate] chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; sub rsa4096 2024-03-27 [E]   Then, send your key id to key server:  gpg --keyserver keys.openpgp.org --send-key &lt;key-id&gt; # e.g., 1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4   Among them, keys.openpgp.org is a randomly selected keyserver, you can use keyserver.ubuntu.com or any other full-featured keyserver.  Check whether the key is created successfully‚Äã  Uploading takes about one minute; after that, you can check by email at the corresponding keyserver.  Uploading keys to the keyserver is mainly for joining a Web of Trust.  Add your GPG public key to the project KEYS file‚Äã  The svn repository of the release branch is: https://dist.apache.org/repos/dist/release/incubator/fory  Please add the public key to KEYS in the release branch:  svn co https://dist.apache.org/repos/dist/release/incubator/fory fory-dist # As this step will copy all the versions, it will take some time. If the network is broken, please use svn cleanup to delete the lock before re-execute it. cd fory-dist (gpg --list-sigs YOUR_NAME@apache.org &amp;&amp; gpg --export --armor YOUR_NAME@apache.org) &gt;&gt; KEYS # Append your key to the KEYS file svn add . # It is not needed if the KEYS document exists before. svn ci -m &quot;add gpg key for YOUR_NAME&quot; # Later on, if you are asked to enter a username and password, just use your apache username and password.   Upload the GPG public key to your GitHub account‚Äã  Enter https://github.com/settings/keys to add your GPG key.Please remember to bind the email address used in the GPG key to your GitHub account (https://github.com/settings/emails) if you find &quot;unverified&quot; after adding it.  ","version":"0.11","tagName":"h3"},{"title":"Further reading‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.11/community/how_to_release#further-reading","content":" It's recommended but not mandatory to read following documents before making a release to know more details about apache release:  Release policy: https://www.apache.org/legal/release-policy.htmlIncubator release: http://incubator.apache.org/guides/releasemanagement.htmlTLP release: https://infra.apache.org/release-distributionRelease sign: https://infra.apache.org/release-signing.htmlRelease publish: https://infra.apache.org/release-publishing.htmlRelease download pages: https://infra.apache.org/release-download-pages.htmlPublishing maven artifacts: https://infra.apache.org/publishing-maven-artifacts.html  ","version":"0.11","tagName":"h3"},{"title":"Start discussion about the release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.11/community/how_to_release#start-discussion-about-the-release","content":" Start a discussion about the next release via sending email to: dev@fory.apache.org:  Title:  [DISCUSS] Release Apache Fory(incubating) ${release_version}   Content:  Hello, Apache Fory(incubating) Community, This is a call for a discussion to release Apache Fory(incubating) version ${release_version}. The change lists about this release: https://github.com/apache/fory/compare/v0.4.1...v0.5.0 Please leave your comments here about this release plan. We will bump the version in repo and start the release process after the discussion. Thanks, ${name}   ","version":"0.11","tagName":"h2"},{"title":"Preparing for release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.11/community/how_to_release#preparing-for-release","content":" If the discussion goes positive, you will need to prepare the release artifiacts.  ","version":"0.11","tagName":"h2"},{"title":"Github branch and tag‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.11/community/how_to_release#github-branch-and-tag","content":" Create a new branch named releases-0.5.0Bump version to $version by executing command python ci/release.py bump_version -l all -version $versionMake a git commit and push the branch to git@github.com:apache/fory.gitCreate a new tag by git tag v0.5.0-rc1, then push it to git@github.com:apache/fory.git  ","version":"0.11","tagName":"h3"},{"title":"Build and upload artifacts to SVN dist/dev repo‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.11/community/how_to_release#build-and-upload-artifacts-to-svn-distdev-repo","content":" First you need to build source release artifacts by python ci/release.py build -v $version.  Then you need to upload it to svn dist repo. The dist repo of the dev branch is: https://dist.apache.org/repos/dist/dev/incubator/fory  # As this step will copy all the versions, it will take some time. If the network is broken, please use svn cleanup to delete the lock before re-execute it. svn co https://dist.apache.org/repos/dist/dev/incubator/fory fory-dist-dev   Then, upload the artifacts:  cd fory-dist-dev # create a directory named by version mkdir ${release_version}-${rc_version} # copy source code and signature package to the versioned directory cp ${repo_dir}/dist/* ${release_version}-${rc_version} # check svn status svn status # add to svn svn add ${release_version}-${rc_version} # check svn status svn status # commit to SVN remote server svn commit -m &quot;Prepare for fory ${release_version}-${rc_version}&quot;   Visit https://dist.apache.org/repos/dist/dev/incubator/fory/ to check the artifacts are uploaded correctly.  ","version":"0.11","tagName":"h3"},{"title":"What to do if something goes wrong‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.11/community/how_to_release#what-to-do-if-something-goes-wrong","content":" If some files are unexpected, you need to remove by svn delete and repeat the above upload process.  ","version":"0.11","tagName":"h3"},{"title":"Voting‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.11/community/how_to_release#voting","content":" ","version":"0.11","tagName":"h2"},{"title":"check version‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.11/community/how_to_release#check-version","content":" As an incubating project, Fory requires votes from both the Fory Community and Incubator Community.  release_version: the version for fory, like 0.5.0.release_candidate_version: the version for voting, like 0.5.0-rc1.maven_artifact_number: the number for Maven staging artifacts, like 1001. Specifically, the maven_artifact_number can be found by searching &quot;fory&quot; on https://repository.apache.org/#stagingRepositories.  ","version":"0.11","tagName":"h3"},{"title":"Build the source code of fory and release it to nexus‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.11/community/how_to_release#build-the-source-code-of-fory-and-release-it-to-nexus","content":" Configure Apache Account Passwords‚Äã  Before publishing Fory to Nexus, you need to securely configure your Apache account credentials. This step is critical as passwords must be encrypted.  First, open your Maven global settings file settings.xml, typically located at ~/.m2/settings.xml. Add or modify the following section:   &lt;servers&gt; &lt;server&gt; &lt;id&gt;apache.snapshots.https&lt;/id&gt; &lt;username&gt;your-apache-username&lt;/username&gt; &lt;password&gt;{your-encrypted-password}&lt;/password&gt; &lt;/server&gt; &lt;server&gt; &lt;id&gt;apache.releases.https&lt;/id&gt; &lt;username&gt;your-apache-username&lt;/username&gt; &lt;password&gt;{your-encrypted-password}&lt;/password&gt; &lt;/server&gt; &lt;/servers&gt;   Important Notes:  Replace your-apache-username with your Apache LDAP usernamePasswords must be encrypted using Maven's password encryption toolEncrypted passwords should be enclosed in curly braces {}  Refer to the official documentation for detailed encryption instructions: Publishing Maven Artifacts  Steps to encrypt your password:  Generate a master password (if you haven't already): mvn --encrypt-master-password your-master-password Save the output to ~/.m2/settings-security.xml: &lt;settingsSecurity&gt; &lt;master&gt;{your-encrypted-master-password}&lt;/master&gt; &lt;/settingsSecurity&gt; Encrypt your Apache account password: mvn --encrypt-password your-apache-password Place the encrypted output into the password field in settings.xml  Build and Publish Java Module‚Äã   # Navigate to the Java module directory cd java # Execute Maven build and deploy to Nexus # -T10: Use 10 threads for parallel build, improving speed # clean: Clean the project # deploy: Deploy to remote repository # -Papache-release: Activate apache-release profile # -DskipTests: Skip tests # -Dgpg.skip=false: Enable GPG signing (required for release verification) mvn -T10 clean deploy -Papache-release -DskipTests -Dgpg.skip=false   Build and Publish Kotlin Module‚Äã   # Return to project root and navigate to Kotlin module cd ../kotlin # Execute the same Maven command as Java module # Configuration parameters are identical to Java module mvn -T10 clean deploy -Papache-release -DskipTests -Dgpg.skip=false   Build and Publish Scala Module‚Äã   # Return to project root and navigate to Scala module cd ../scala # Build and sign JARs for all Scala versions # +publishSigned: Execute publishSigned for all configured Scala versions echo &quot;Starting to build Scala JARs...&quot; sbt +publishSigned # Prepare for upload to Sonatype (Nexus) # sonatypePrepare: Prepare for Maven Central Repository release echo &quot;Starting upload preparation...&quot; sbt sonatypePrepare # Upload packaged JARs to Sonatype # sonatypeBundleUpload: Upload prepared bundles echo &quot;Starting JAR upload...&quot; sbt sonatypeBundleUpload echo &quot;Scala JAR deployment succeeded!&quot;   Lock the Release in Nexus‚Äã  After completing the publication of all modules, perform the following steps in Nexus:  Log in to the Apache Nexus repository management interfaceNavigate to the &quot;Snapshots&quot; or &quot;Releases&quot; repository (depending on your release type)Locate the latest Fory project versionExecute the &quot;Close&quot; operation to validate all uploaded artifactsAfter successful validation, execute the &quot;Release&quot; operation to finalize the deployment  These steps ensure all published artifacts are verified and correctly deployed to the public repository.  ","version":"0.11","tagName":"h3"},{"title":"build a Pre-release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.11/community/how_to_release#build-a-pre-release","content":" You need to build a Pre-release before voting, such as:https://github.com/apache/fory/releases/tag/v0.11.2-rc1  ","version":"0.11","tagName":"h3"},{"title":"Fory Community Vote‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.11/community/how_to_release#fory-community-vote","content":" you need send a email to Fory Community: dev@fory.apache.org:  Title:  [VOTE] Release Apache Fory(incubating) v${release_version}-${rc_version}   Content:  Hello, Apache Fory(incubating) Community: This is a call for vote to release Apache Fory(Incubating) version release-0.5.0-rc3. Apache Fory(incubating) - A blazingly fast multi-language serialization framework powered by JIT and zero-copy. The discussion thread: https://lists.apache.org/thread/xxr3od301g6v3ndj14zqc05byp9qvclh The change lists about this release: https://github.com/apache/fory/compare/v0.4.1...v0.5.0-rc3 The release candidates: https://dist.apache.org/repos/dist/dev/incubator/fory/0.5.0-rc3/ The maven staging for this release: https://repository.apache.org/content/repositories/orgapachefory-1003 Git tag for the release: https://github.com/apache/fory/releases/tag/v0.5.0-rc3 Git commit for the release: https://github.com/apache/fory/commit/fae06330edd049bb960536e978a45b97bca66faf The artifacts signed with PGP key [5E580BA4], corresponding to [chaokunyang@apache.org], that can be found in keys file: https://downloads.apache.org/incubator/fory/KEYS The vote will be open for at least 72 hours until the necessary number of votes are reached. Please vote accordingly: [ ] +1 approve [ ] +0 no opinion [ ] -1 disapprove with the reason To learn more about Fory, please see https://fory.apache.org/ *Valid check is a requirement for a vote. *Checklist for reference: [ ] Download Fory is valid. [ ] Checksums and PGP signatures are valid. [ ] Source code distributions have correct names matching the current release. [ ] LICENSE and NOTICE files are correct. [ ] All files have license headers if necessary. [ ] No compiled archives bundled in source archive. [ ] Can compile from source. More detail checklist please refer: https://cwiki.apache.org/confluence/display/INCUBATOR/Incubator+Release+Checklist How to Build and Test, please refer to: https://github.com/apache/fory/blob/main/docs/guide/DEVELOPMENT.md Thanks, Chaokun Yang   After at least 3 +1 binding vote (from Fory Podling PMC member and committers) and no veto, claim the vote result:  Title:  [RESULT][VOTE] Release Apache Fory(incubating) v${release_version}-${rc_version}   Content:  Hello, Apache Fory(incubating) Community, The vote to release Apache Fory(Incubating) v${release_version}-${rc_version} has passed. The vote PASSED with 3 binding +1 and 0 -1 vote: Binding votes: - xxx - yyy - zzz Vote thread: ${vote_thread_url} Thanks, ${name}   ","version":"0.11","tagName":"h3"},{"title":"Incubator Community Vote‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.11/community/how_to_release#incubator-community-vote","content":" Send an email to: general@incubator.apache.org:  Title:  [VOTE] Release Apache Fory(incubating) v${release_version}-${rc_version}   Content:  Hello everyone, This is a call for the vote to release Apache Fory(Incubating) v${release_version}-${rc_version}. The Apache Fory community has voted and approved the release of Apache Fory(incubating) v${release_version}-${rc_version}. We now kindly request the IPMC members review and vote for this release. Apache Fory(incubating) - A blazingly fast multi-language serialization framework powered by JIT and zero-copy. Fory community vote thread: ${community_vote_thread_url} Vote result thread: ${community_vote_result_thread_url} The release candidate: https://dist.apache.org/repos/dist/dev/incubator/fory/${release_version}-${rc_version}/ This release has been signed with a PGP available here: https://downloads.apache.org/incubator/fory/KEYS Git tag for the release: https://github.com/apache/fory/releases/tag/v${release_version}-${rc_version}/ Git commit for the release: https://github.com/apache/fory/commit/$xxx Maven staging repo: https://repository.apache.org/content/repositories/orgapachefory-${maven_artifact_number}/ How to Build and Test, please refer to: https://github.com/apache/fory/blob/main/docs/guide/DEVELOPMENT.md Please download, verify, and test. The VOTE will pass after 3 binding approve. [ ] +1 approve [ ] +0 no opinion [ ] -1 disapprove with the reason To learn more about apache fory, please see https://fory.apache.org/ Checklist for reference: [ ] Download links are valid. [ ] Checksums and signatures. [ ] LICENSE/NOTICE files exist [ ] No unexpected binary files [ ] All source files have ASF headers [ ] Can compile from source Thanks, ${name}   After at least 72 hours with at least 3 +1 binding vote (from Incubator PMC member) and no veto, claim the vote result:  Title:  [RESULT][VOTE] Release Apache Fory(incubating) v${release_version}-${rc_version}   Content:  Hi Incubator PMC, The vote to release Apache Fory(incubating) v${release_version}-${rc_version} has passed with 4 +1 binding and 3 +1 non-binding votes, no +0 or -1 votes. Binding votesÔºö - xxx - yyy - zzz Non-Binding votes: - aaa Vote thread: ${incubator_vote_thread_url} Thanks for reviewing and voting for our release candidate. We will proceed with publishing the approved artifacts and sending out the announcement soon.   ","version":"0.11","tagName":"h3"},{"title":"What if vote fail‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.11/community/how_to_release#what-if-vote-fail","content":" If the vote failed, click &quot;Drop&quot; to drop the staging Maven artifacts.  Address the raised issues, then bump rc_version and file a new vote again.  ","version":"0.11","tagName":"h3"},{"title":"Official Release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.11/community/how_to_release#official-release","content":" ","version":"0.11","tagName":"h2"},{"title":"Publish artifacts to SVN Release Directory‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.11/community/how_to_release#publish-artifacts-to-svn-release-directory","content":" release_version: the release version for fory, like 0.5.0release_candidate_version: the version for voting, like 0.5.0-rc1  svn mv https://dist.apache.org/repos/dist/dev/incubator/fory/${release_version}-${rc_version} https://dist.apache.org/repos/dist/release/incubator/fory/${release_version} -m &quot;Release fory ${release_version}&quot;   In the repository at https://dist.apache.org/repos/dist/dev/incubator/fory/, if any outdated release_candidate_version are left behind when releasing the release_version, please clear them to keep the dev repository tidy.  When https://archive.apache.org/dist/incubator/fory/0.10.0/${release_version} is accessible (confirming that the release_version has been successfully released and archived), we may clean up the previous release version in the release repository, leaving only the current version.  ","version":"0.11","tagName":"h3"},{"title":"Update Fory&Fory-Site content‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.11/community/how_to_release#update-foryfory-site-content","content":" Submit a PR to https://github.com/apache/fory-site to update Fory-site. Reference implementation: #222and #223.  Submit a PR to https://github.com/apache/fory to update README, like #2207.  ","version":"0.11","tagName":"h3"},{"title":"Github officially released‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.11/community/how_to_release#github-officially-released","content":" You need to officially release this version in the Fory project Reference implementation: https://github.com/apache/fory/releases/tag/v0.11.2  ","version":"0.11","tagName":"h3"},{"title":"Release Maven artifacts‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.11/community/how_to_release#release-maven-artifacts","content":" maven_artifact_number: the number for Maven staging artifacts, like 1001.Open https://repository.apache.org/#stagingRepositories.Find the artifact orgapachefory-${maven_artifact_number}, click &quot;Release&quot;.  ","version":"0.11","tagName":"h3"},{"title":"Send the announcement‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.11/community/how_to_release#send-the-announcement","content":" Send the release announcement to dev@fory.apache.org and CC announce@apache.org.  Title:  [ANNOUNCE] Release Apache Fory(incubating) ${release_version}   Content:  Hi all, The Apache Fory(incubating) community is pleased to announce that Apache Fory(incubating) {release_version} has been released! Apache Fory(incubating) - A blazingly fast multi-language serialization framework powered by JIT and zero-copy. The release notes are available here: https://github.com/apache/fory/releases/tag/v${release_version} For the complete list of changes: https://github.com/apache/fory/compare/v0.5.0...v${release_version} Apache Fory website: https://fory.apache.org/ Download Links: https://fory.apache.org/download Fory Resources: - Fory github repo: https://github.com/apache/fory - Issue: https://github.com/apache/fory/issues - Mailing list: dev@fory.apache.org We are looking to grow our community and welcome new contributors. If you are interested in contributing to Fory, please contact us on the mailing list or on GitHub. We will be happy to help you get started. ------------------ Best Regards, ${your_name}   Remember to use plain text instead of rich text format, or you may be rejected when CC announce@apache.org  After completing the above steps, the Fory release process comes to an end. ","version":"0.11","tagName":"h3"},{"title":"Row Format","type":0,"sectionRef":"#","url":"/docs/0.11/guide/row_format","content":"","keywords":"","version":"0.11"},{"title":"Java‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.11/guide/row_format#java","content":" public class Bar { String f1; List&lt;Long&gt; f2; } public class Foo { int f1; List&lt;Integer&gt; f2; Map&lt;String, Integer&gt; f3; List&lt;Bar&gt; f4; } RowEncoder&lt;Foo&gt; encoder = Encoders.bean(Foo.class); Foo foo = new Foo(); foo.f1 = 10; foo.f2 = IntStream.range(0, 1000000).boxed().collect(Collectors.toList()); foo.f3 = IntStream.range(0, 1000000).boxed().collect(Collectors.toMap(i -&gt; &quot;k&quot;+i, i-&gt;i)); List&lt;Bar&gt; bars = new ArrayList&lt;&gt;(1000000); for (int i = 0; i &lt; 1000000; i++) { Bar bar = new Bar(); bar.f1 = &quot;s&quot;+i; bar.f2 = LongStream.range(0, 10).boxed().collect(Collectors.toList()); bars.add(bar); } foo.f4 = bars; // Can be zero-copy read by python BinaryRow binaryRow = encoder.toRow(foo); // can be data from python Foo newFoo = encoder.fromRow(binaryRow); // zero-copy read List&lt;Integer&gt; f2 BinaryArray binaryArray2 = binaryRow.getArray(1); // zero-copy read List&lt;Bar&gt; f4 BinaryArray binaryArray4 = binaryRow.getArray(3); // zero-copy read 11th element of `readList&lt;Bar&gt; f4` BinaryRow barStruct = binaryArray4.getStruct(10); // zero-copy read 6th of f2 of 11th element of `readList&lt;Bar&gt; f4` barStruct.getArray(1).getInt64(5); RowEncoder&lt;Bar&gt; barEncoder = Encoders.bean(Bar.class); // deserialize part of data. Bar newBar = barEncoder.fromRow(barStruct); Bar newBar2 = barEncoder.fromRow(binaryArray4.getStruct(20));   ","version":"0.11","tagName":"h2"},{"title":"Python‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.11/guide/row_format#python","content":" @dataclass class Bar: f1: str f2: List[pa.int64] @dataclass class Foo: f1: pa.int32 f2: List[pa.int32] f3: Dict[str, pa.int32] f4: List[Bar] encoder = pyfory.encoder(Foo) foo = Foo(f1=10, f2=list(range(1000_000)), f3={f&quot;k{i}&quot;: i for i in range(1000_000)}, f4=[Bar(f1=f&quot;s{i}&quot;, f2=list(range(10))) for i in range(1000_000)]) binary: bytes = encoder.to_row(foo).to_bytes() print(f&quot;start: {datetime.datetime.now()}&quot;) foo_row = pyfory.RowData(encoder.schema, binary) print(foo_row.f2[100000], foo_row.f4[100000].f1, foo_row.f4[200000].f2[5]) print(f&quot;end: {datetime.datetime.now()}&quot;) binary = pickle.dumps(foo) print(f&quot;pickle start: {datetime.datetime.now()}&quot;) new_foo = pickle.loads(binary) print(new_foo.f2[100000], new_foo.f4[100000].f1, new_foo.f4[200000].f2[5]) print(f&quot;pickle end: {datetime.datetime.now()}&quot;)   ","version":"0.11","tagName":"h2"},{"title":"Apache Arrow Support‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.11/guide/row_format#apache-arrow-support","content":" Fory Format also supports automatic conversion from/to Arrow Table/RecordBatch.  Java:  Schema schema = TypeInference.inferSchema(BeanA.class); ArrowWriter arrowWriter = ArrowUtils.createArrowWriter(schema); Encoder&lt;BeanA&gt; encoder = Encoders.rowEncoder(BeanA.class); for (int i = 0; i &lt; 10; i++) { BeanA beanA = BeanA.createBeanA(2); arrowWriter.write(encoder.toRow(beanA)); } return arrowWriter.finishAsRecordBatch();   ","version":"0.11","tagName":"h3"},{"title":"Support for Interface and Extension Types‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.11/guide/row_format#support-for-interface-and-extension-types","content":" Fury now supports row format mapping for Java interface types and subclassed (extends) types, enabling more dynamic and flexible data schemas.  These enhancements were introduced in #2243, #2250, and #2256.  ","version":"0.11","tagName":"h2"},{"title":"Example: Interface Mapping with RowEncoder‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.11/guide/row_format#example-interface-mapping-with-rowencoder","content":" public interface Animal { String speak(); } public class Dog implements Animal { public String name; @Override public String speak() { return &quot;Woof&quot;; } } // Encode and decode using RowEncoder with interface type RowEncoder&lt;Animal&gt; encoder = Encoders.bean(Animal.class); Dog dog = new Dog(); dog.name = &quot;Bingo&quot;; BinaryRow row = encoder.toRow(dog); Animal decoded = encoder.fromRow(row); System.out.println(decoded.speak()); // Woof   ","version":"0.11","tagName":"h3"},{"title":"Example: Extension Type with RowEncoder‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.11/guide/row_format#example-extension-type-with-rowencoder","content":" public class Parent { public String parentField; } public class Child extends Parent { public String childField; } // Encode and decode using RowEncoder with parent class type RowEncoder&lt;Parent&gt; encoder = Encoders.bean(Parent.class); Child child = new Child(); child.parentField = &quot;Hello&quot;; child.childField = &quot;World&quot;; BinaryRow row = encoder.toRow(child); Parent decoded = encoder.fromRow(row);   Python:  import pyfory encoder = pyfory.encoder(Foo) encoder.to_arrow_record_batch([foo] * 10000) encoder.to_arrow_table([foo] * 10000)   C++  std::shared_ptr&lt;ArrowWriter&gt; arrow_writer; EXPECT_TRUE( ArrowWriter::Make(schema, ::arrow::default_memory_pool(), &amp;arrow_writer) .ok()); for (auto &amp;row : rows) { EXPECT_TRUE(arrow_writer-&gt;Write(row).ok()); } std::shared_ptr&lt;::arrow::RecordBatch&gt; record_batch; EXPECT_TRUE(arrow_writer-&gt;Finish(&amp;record_batch).ok()); EXPECT_TRUE(record_batch-&gt;Validate().ok()); EXPECT_EQ(record_batch-&gt;num_columns(), schema-&gt;num_fields()); EXPECT_EQ(record_batch-&gt;num_rows(), row_nums);   Schema schema = TypeInference.inferSchema(BeanA.class); ArrowWriter arrowWriter = ArrowUtils.createArrowWriter(schema); Encoder&lt;BeanA&gt; encoder = Encoders.rowEncoder(BeanA.class); for (int i = 0; i &lt; 10; i++) { BeanA beanA = BeanA.createBeanA(2); arrowWriter.write(encoder.toRow(beanA)); } return arrowWriter.finishAsRecordBatch();  ","version":"0.11","tagName":"h3"},{"title":"Type Mapping of Xlang Serialization","type":0,"sectionRef":"#","url":"/docs/0.11/guide/xlang_type_mapping","content":"","keywords":"","version":"0.11"},{"title":"Type Mapping‚Äã","type":1,"pageTitle":"Type Mapping of Xlang Serialization","url":"/docs/0.11/guide/xlang_type_mapping#type-mapping","content":" Fory Type\tFory Type ID\tJava\tPython\tJavascript\tC++\tGolang\tRustbool\t1\tbool/Boolean\tbool\tBoolean\tbool\tbool\tbool int8\t2\tbyte/Byte\tint/pyfory.Int8\tType.int8()\tint8_t\tint8\ti8 int16\t3\tshort/Short\tint/pyfory.Int16\tType.int16()\tint16_t\tint16\ti6 int32\t4\tint/Integer\tint/pyfory.Int32\tType.int32()\tint32_t\tint32\ti32 var_int32\t5\tint/Integer\tint/pyfory.VarInt32\tType.varint32()\tfory::varint32_t\tfory.varint32\tfory::varint32 int64\t6\tlong/Long\tint/pyfory.Int64\tType.int64()\tint64_t\tint64\ti64 var_int64\t7\tlong/Long\tint/pyfory.VarInt64\tType.varint64()\tfory::varint64_t\tfory.varint64\tfory::varint64 sli_int64\t8\tlong/Long\tint/pyfory.SliInt64\tType.sliint64()\tfory::sliint64_t\tfory.sliint64\tfory::sliint64 float16\t9\tfloat/Float\tfloat/pyfory.Float16\tType.float16()\tfory::float16_t\tfory.float16\tfory::f16 float32\t10\tfloat/Float\tfloat/pyfory.Float32\tType.float32()\tfloat\tfloat32\tf32 float64\t11\tdouble/Double\tfloat/pyfory.Float64\tType.float64()\tdouble\tfloat64\tf64 string\t12\tString\tstr\tString\tstring\tstring\tString/str enum\t13\tEnum subclasses\tenum subclasses\t/\tenum\t/\tenum named_enum\t14\tEnum subclasses\tenum subclasses\t/\tenum\t/\tenum struct\t15\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct compatible_struct\t16\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct named_struct\t17\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct named_compatible_struct\t18\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct ext\t19\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct named_ext\t20\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct list\t21\tList/Collection\tlist/tuple\tarray\tvector\tslice\tVec set\t22\tSet\tset\t/\tset\tfory.Set\tSet map\t23\tMap\tdict\tMap\tunordered_map\tmap\tHashMap duration\t24\tDuration\ttimedelta\tNumber\tduration\tDuration\tDuration timestamp\t25\tInstant\tdatetime\tNumber\tstd::chrono::nanoseconds\tTime\tDateTime local_date\t26\tDate\tdatetime\tNumber\tstd::chrono::nanoseconds\tTime\tDateTime decimal\t27\tBigDecimal\tDecimal\tbigint\t/\t/\t/ binary\t28\tbyte[]\tbytes\t/\tuint8_t[n]/vector&lt;T&gt;\t[n]uint8/[]T\tVec&lt;uint8_t&gt; array\t29\tarray\tnp.ndarray\t/\t/\tarray/slice\tVec bool_array\t30\tbool[]\tndarray(np.bool_)\t/\tbool[n]\t[n]bool/[]T\tVec&lt;bool&gt; int8_array\t31\tbyte[]\tndarray(int8)\t/\tint8_t[n]/vector&lt;T&gt;\t[n]int8/[]T\tVec&lt;i18&gt; int16_array\t32\tshort[]\tndarray(int16)\t/\tint16_t[n]/vector&lt;T&gt;\t[n]int16/[]T\tVec&lt;i16&gt; int32_array\t33\tint[]\tndarray(int32)\t/\tint32_t[n]/vector&lt;T&gt;\t[n]int32/[]T\tVec&lt;i32&gt; int64_array\t34\tlong[]\tndarray(int64)\t/\tint64_t[n]/vector&lt;T&gt;\t[n]int64/[]T\tVec&lt;i64&gt; float16_array\t35\tfloat[]\tndarray(float16)\t/\tfory::float16_t[n]/vector&lt;T&gt;\t[n]float16/[]T\tVec&lt;fory::f16&gt; float32_array\t36\tfloat[]\tndarray(float32)\t/\tfloat[n]/vector&lt;T&gt;\t[n]float32/[]T\tVec&lt;f32&gt; float64_array\t37\tdouble[]\tndarray(float64)\t/\tdouble[n]/vector&lt;T&gt;\t[n]float64/[]T\tVec&lt;f64&gt; arrow record batch\t38\t/\t/\t/\t/\t/\t/ arrow table\t39\t/\t/\t/\t/\t/\t/  ","version":"0.11","tagName":"h2"},{"title":"Type info(not implemented currently)‚Äã","type":1,"pageTitle":"Type Mapping of Xlang Serialization","url":"/docs/0.11/guide/xlang_type_mapping#type-infonot-implemented-currently","content":" Due to differences between type systems of languages, those types can't be mapped one-to-one between languages.  If the user notices that one type on a language corresponds to multiple types in Fory type systems, for example, longin java has type int64/varint64/sliint64, it means the language lacks some types, and the user must provide extra type info when using Fory.  ","version":"0.11","tagName":"h2"},{"title":"Type annotation‚Äã","type":1,"pageTitle":"Type Mapping of Xlang Serialization","url":"/docs/0.11/guide/xlang_type_mapping#type-annotation","content":" If the type is a field of another class, users can provide meta hints for fields of a type, or for the whole type. Such information can be provided in other languages too:  java: use annotation.cpp: use macro and template.golang: use struct tag.python: use typehint.rust: use macro.  Here is en example:  Java: class Foo { @Int32Type(varint = true) int f1; List&lt;@Int32Type(varint = true) Integer&gt; f2; } Python: class Foo: f1: Int32Type(varint=True) f2: List[Int32Type(varint=True)]   ","version":"0.11","tagName":"h2"},{"title":"Type wrapper‚Äã","type":1,"pageTitle":"Type Mapping of Xlang Serialization","url":"/docs/0.11/guide/xlang_type_mapping#type-wrapper","content":" If the type is not a field of a class, the user must wrap this type with a Fory type to pass the extra type info.  For example, suppose Fory Java provide a VarInt64 type, when a user invoke fory.serialize(long_value), he need to invoke like fory.serialize(new VarInt64(long_value)). ","version":"0.11","tagName":"h2"},{"title":"Benchmark","type":0,"sectionRef":"#","url":"/docs/0.11/introduction/benchmark","content":"","keywords":"","version":"0.11"},{"title":"Java Serialization‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/0.11/introduction/benchmark#java-serialization","content":"         ","version":"0.11","tagName":"h3"},{"title":"Java Deserialization‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/0.11/introduction/benchmark#java-deserialization","content":"         See benchmarks for more benchmarks about type forward/backward compatibility, off-heap support, zero-copy serialization.  ","version":"0.11","tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/0.11/introduction/benchmark#javascript","content":"   The data used for this bar graph includes a complex object that has many kinds of field types, and the size of the JSON data is 3KB.  See benchmarks for the benchmark code. ","version":"0.11","tagName":"h3"},{"title":"Features","type":0,"sectionRef":"#","url":"/docs/0.11/introduction/features","content":"Features Multiple languages: Java/Python/C++/Golang/Javascript/Rust.Zero-copy: cross-language out-of-band serialization inspired by pickle5 and off-heap read/write.High performance: A highly-extensible JIT framework to generate serializer code at runtime in an async multi-thread way to speed serialization, providing 20-170x speed up by: reduce memory access by inline variable in generated code.reduce virtual method invocation by inline call in generated code.reduce conditional branching.reduce hash lookup.binary protocols: object graph, row format and so on. In addition to cross-language serialization, Fory also features at: Drop-in replace Java serialization frameworks such as JDK/Kryo/Hessian without modifying any code, but 100x faster. It can greatly improve the efficiency of high-performance RPC calls, data transfer and object persistence.JDK serialization 100% compatible, support java custom serializationwriteObject/readObject/writeReplace/readResolve/readObjectNoData natively.Supports shared and circular reference object serialization for golang.Supports automatic object serialization for golang.","keywords":"","version":"0.11"},{"title":"Overview","type":0,"sectionRef":"#","url":"/docs/0.11/introduction/overview","content":"","keywords":"","version":"0.11"},{"title":"Protocols‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.11/introduction/overview#protocols","content":" Different scenarios have different serialization requirements. Apache Fory‚Ñ¢ designed and implemented multiple binary protocols for those requirements:  Cross-language object graph protocol: Cross-language serialize any object automatically, no need for IDL definition, schema compilation and object to/from protocol conversion.Support shared reference and circular reference, no duplicate data or recursion error.Support object polymorphism. Native java/python object graph protocol: highly-optimized based on type system of the language.Row format protocol: a cache-friendly binary random access format, supports skipping serialization and partial serialization, and can convert to column-format automatically.  New protocols can be added easily based on Apache Fory‚Ñ¢ existing buffer, encoding, meta, codegen and other capabilities. All of those share same codebase, and the optimization for one protocol can be reused by another protocol.  ","version":"0.11","tagName":"h2"},{"title":"Compatibility‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.11/introduction/overview#compatibility","content":" ","version":"0.11","tagName":"h2"},{"title":"Schema Compatibility‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.11/introduction/overview#schema-compatibility","content":" Apache Fory‚Ñ¢ java object graph serialization support class schema forward/backward compatibility. The serialization peer and deserialization peer can add/delete fields independently.  We plan to add support cross-language serialization after meta compression are finished.  ","version":"0.11","tagName":"h3"},{"title":"Binary Compatibility‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.11/introduction/overview#binary-compatibility","content":" We are still improving our protocols, binary compatibility are not ensured between Apache Fory‚Ñ¢ releases for now. Please shade Apache Fory‚Ñ¢ if you will upgrade Apache Fory‚Ñ¢ in the future.  Binary compatibility will be ensured before Apache Fory‚Ñ¢ 1.0.  ","version":"0.11","tagName":"h3"},{"title":"Security‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.11/introduction/overview#security","content":" Static serialization such as row format are secure by nature. But dynamic object graph serialization supports deserialize unregistered types, which can introduce security risks.  For example, the deserialization may invoke init constructor or equals/hashCode method, if the method body contains malicious code, the system will be at risks.  Apache Fory‚Ñ¢ provides a class registration mode option and enabled by default for this protocol, which allows deserializing trusted registered types or built-in types only for security.  Apache Fory‚Ñ¢ provides a class registration option and enabled by default for such protocols, which allows only deserializing trusted registered types or built-in types. Do not disable class registration or class registration checks unless you can ensure your environment is indeed secure. We are not responsible for security if you disabled the class registration option.  ","version":"0.11","tagName":"h2"},{"title":"RoadMap‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.11/introduction/overview#roadmap","content":" Meta compression, auto meta sharing and cross-language schema compatibility.AOT Framework for c++/golang to generate code statically.C++/Rust object graph serialization supportGolang/Rust/NodeJS row format supportProtoBuffer compatibility supportProtocols for features and knowledge graph serializationContinuously improve our serialization infrastructure for any new protocols  ","version":"0.11","tagName":"h2"},{"title":"How to Contribute‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.11/introduction/overview#how-to-contribute","content":" Please read the CONTRIBUTING guide for instructions on how to contribute. ","version":"0.11","tagName":"h2"},{"title":"Row Format","type":0,"sectionRef":"#","url":"/docs/0.11/specification/row_format_spec","content":"","keywords":"","version":"0.11"},{"title":"Row Format‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.11/specification/row_format_spec#row-format","content":" Coming soon ","version":"0.11","tagName":"h2"},{"title":"Java Serialization Format","type":0,"sectionRef":"#","url":"/docs/0.11/specification/java_serialization_spec","content":"","keywords":"","version":"0.11"},{"title":"Spec overview‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.11/specification/java_serialization_spec#spec-overview","content":" Fory Java Serialization is an automatic object serialization framework that supports reference and polymorphism. Fory will convert an object from/to fory java serialization binary format. Fory has two core concepts for java serialization:  Fory Java Binary formatFramework to convert object to/from Fory Java Binary format  The serialization format is a dynamic binary format. The dynamics and reference/polymorphism support make Fory flexible, much more easy to use, but also introduce more complexities compared to static serialization frameworks. So the format will be more complex.  Here is the overall format:  | fory header | object ref meta | object class meta | object value data |   The data are serialized using little endian byte order overall. If bytes swap is costly for some object, Fory will write the byte order for that object into the data instead of converting it to little endian.  ","version":"0.11","tagName":"h2"},{"title":"Fory header‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.11/specification/java_serialization_spec#fory-header","content":" Fory header consists starts one byte:  | 4 bits | 1 bit | 1 bit | 1 bit | 1 bit | optional 4 bytes | +---------------+-------+-------+--------+-------+------------------------------------+ | reserved bits | oob | xlang | endian | null | unsigned int for meta start offset |   null flag: 1 when object is null, 0 otherwise. If an object is null, other bits won't be set.endian flag: 1 when data is encoded by little endian, 0 for big endian.xlang flag: 1 when serialization uses xlang format, 0 when serialization uses Fory java format.oob flag: 1 when passed BufferCallback is not null, 0 otherwise.  If meta share mode is enabled, an uncompressed unsigned int is appended to indicate the start offset of metadata.  ","version":"0.11","tagName":"h2"},{"title":"Reference Meta‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.11/specification/java_serialization_spec#reference-meta","content":" Reference tracking handles whether the object is null, and whether to track reference for the object by writing corresponding flags and maintaining internal state.  Reference flags:  Flag\tByte Value\tDescriptionNULL FLAG\t-3\tThis flag indicates the object is a null value. We don't use another byte to indicate REF, so that we can save one byte. REF FLAG\t-2\tThis flag indicates the object is already serialized previously, and fory will write a ref id with unsigned varint format instead of serialize it again NOT_NULL VALUE FLAG\t-1\tThis flag indicates the object is a non-null value and fory doesn't track ref for this type of object. REF VALUE FLAG\t0\tThis flag indicates the object is referencable and the first time to serialize.  When reference tracking is disabled globally or for specific types, or for certain types within a particular context(e.g., a field of a class), only the NULL and NOT_NULL VALUE flags will be used for reference meta.  ","version":"0.11","tagName":"h2"},{"title":"Class Meta‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.11/specification/java_serialization_spec#class-meta","content":" Fory supports to register class by an optional id, the registration can be used for security check and class identification. If a class is registered, it will have a user-provided or an auto-growing unsigned int i.e. class_id.  Depending on whether meta share mode and registration is enabled for current class, Fory will write class meta differently.  ","version":"0.11","tagName":"h2"},{"title":"Schema consistent‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.11/specification/java_serialization_spec#schema-consistent","content":" If schema consistent mode is enabled globally or enabled for current class, class meta will be written as follows:  If class is registered, it will be written as a fory unsigned varint: class_id &lt;&lt; 1.If class is not registered: If class is not an array, fory will write one byte 0bxxxxxxx1 first, then write class name. The first little bit is 1, which is different from first bit 0 of encoded class id. Fory can use this information to determine whether to read class by class id for deserialization. If class is not registered and class is an array, fory will write one byte dimensions &lt;&lt; 1 | 1 first, then write component class subsequently. This can reduce array class name cost if component class is or will be serialized.Class will be written as two enumerated fory unsigned by default: package name and class name. If meta share mode is enabled, class will be written as an unsigned varint which points to index in MetaContext.  ","version":"0.11","tagName":"h3"},{"title":"Schema evolution‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.11/specification/java_serialization_spec#schema-evolution","content":" If schema evolution mode is enabled globally or enabled for current class, class meta will be written as follows:  If meta share mode is not enabled, class meta will be written as schema consistent mode. Additionally, field meta such as field type and name will be written with the field value using a key-value like layout.If meta share mode is enabled, class meta will be written as a meta-share encoded binary if class hasn't been written before, otherwise an unsigned varint id which references to previous written class meta will be written.  ","version":"0.11","tagName":"h3"},{"title":"Meta share‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.11/specification/java_serialization_spec#meta-share","content":" This mode will forbid streaming writing since it needs to look back for update the start offset after the whole object graph writing and meta collecting is finished. Only in this way we can ensure deserialization failure doesn't lost shared meta. Meta streamline will be supported in the future for enclosed meta sharing which doesn't cross multiple serializations of different objects.  For Schema consistent mode, class will be encoded as an enumerated string by full class name. Here we mainly describe the meta layout for schema evolution mode:  | 8 bytes global meta header | 1~2 bytes | variable bytes | variable bytes | variable bytes | +-------------------------------+-------------|--------------------+-------------------+----------------+ | 50 bits hash + 14 bits header | type header | current class meta | parent class meta | ... |   Class meta are encoded from parent class to leaf class, only class with serializable fields will be encoded.  ","version":"0.11","tagName":"h2"},{"title":"Global meta header‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.11/specification/java_serialization_spec#global-meta-header","content":" Meta header is a 64 bits number value encoded in little endian order.  lower 12 bits are used to encode meta size. If meta size &gt;= 0b1111_1111_1111, then writemeta_ size - 0b1111_1111_1111 next.13rd bit is used to indicate whether to write fields meta. When this class is schema-consistent or use registered serializer, fields meta will be skipped. Class Meta will be used for share namespace + type name only.14rd bit is used to indicate whether meta is compressed.Other 50 bits is used to store the unique hash of flags + all layers class meta.  ","version":"0.11","tagName":"h3"},{"title":"Type header‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.11/specification/java_serialization_spec#type-header","content":" Lowest 4 digits 0b0000~0b1110 are used to record num classes. 0b1111 is preserved to indicate that Fory need to read more bytes for length using Fory unsigned int encoding. If current class doesn't has parent class, or parent class doesn't have fields to serialize, or we're in a context which serialize fields of current class only(ObjectStreamSerializer#SlotInfo is an example), num classes will be 1.Other 4 bits are preserved to future extensions.If num classes are greater than or equal to 0b1111, write num_classes - 0b1111 as varuint next.  ","version":"0.11","tagName":"h3"},{"title":"Single layer class meta‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.11/specification/java_serialization_spec#single-layer-class-meta","content":" | unsigned varint | meta string | meta string | field info: variable bytes | variable bytes | ... | +----------------------------+-----------------------+---------------------+-------------------------------+-----------------+-----+ | num fields + register flag | header + package name | header + class name | header + type id + field name | next field info | ... |   num fields: encode num fields &lt;&lt; 1 | register flag(1 when class registered) as unsigned varint. If class is registered, then an unsigned varint class id will be written next, package and class name will be omitted.If current class is schema consistent, then num field will be 0 to flag it.If current class isn't schema consistent, then num field will be the number of compatible fields. For example, users can use tag id to mark some field as compatible field in schema consistent context. In such cases, schema consistent fields will be serialized first, then compatible fields will be serialized next. At deserialization, Fory will use fields info of those fields which aren't annotated by tag id for deserializing schema consistent fields, then use fields info in meta for deserializing compatible fields. Package name encoding(omitted when class is registered): encoding algorithm: UTF8/ALL_TO_LOWER_SPECIAL/LOWER_UPPER_DIGIT_SPECIALHeader: 6 bits size | 2 bits encoding flags. The 6 bits size: 0~63 will be used to indicate size 0~63, the value 63 the size need more byte to read, the encoding will encode size - 63 as a varint next. Class name encoding(omitted when class is registered): encoding algorithm: UTF8/LOWER_UPPER_DIGIT_SPECIAL/FIRST_TO_LOWER_SPECIAL/ALL_TO_LOWER_SPECIALheader: 6 bits size | 2 bits encoding flags. The 6 bits size: 0~63 will be used to indicate size 0~63, the value 63 the size need more byte to read, the encoding will encode size - 63 as a varint next. Field info: header(8 bits): 3 bits size + 2 bits field name encoding + polymorphism flag + nullability flag + ref tracking flag. Users can use annotation to provide those info. 2 bits field name encoding: encoding: UTF8/ALL_TO_LOWER_SPECIAL/LOWER_UPPER_DIGIT_SPECIAL/TAG_IDIf tag id is used, i.e. field name is written by an unsigned varint tag id. 2 bits encoding will be 11. size of field name: The 3 bits size: 0~7 will be used to indicate length 1~7, the value 6 the size read more bytes, the encoding will encode size - 7 as a varint next.If encoding is TAG_ID, then num_bytes of field name will be used to store tag id. ref tracking: when set to 1, ref tracking will be enabled for this field.nullability: when set to 1, this field can be null.polymorphism: when set to 1, the actual type of field will be the declared field type even the type if not final. type id: For registered type-consistent classes, it will be the registered class id.Otherwise it will be encoded as OBJECT_ID if it isn't final and FINAL_OBJECT_ID if it's final. The meta for such types is written separately instead of inlining here is to reduce meta space cost if object of this type is serialized in current object graph multiple times, and the field value may be null too. Field name: If type id is set, type id will be used instead. Otherwise meta string encoding length and data will be written instead.  Field order are left as implementation details, which is not exposed to specification, the deserialization need to resort fields based on Fory field comparator. In this way, fory can compute statistics for field names or types and using a more compact encoding.  ","version":"0.11","tagName":"h3"},{"title":"Other layers class meta‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.11/specification/java_serialization_spec#other-layers-class-meta","content":" Same encoding algorithm as the previous layer except:  header + package name: Header: If package name has been written before: varint index + sharing flag(set) will be writtenIf package name hasn't been written before: If meta string encoding is LOWER_SPECIAL and the length of encoded string &lt;= 64, then header will be6 bits size + encoding flag(set) + sharing flag(unset).Otherwise, header will be 3 bits unset + 3 bits encoding flags + encoding flag(unset) + sharing flag(unset)  ","version":"0.11","tagName":"h3"},{"title":"Meta String‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.11/specification/java_serialization_spec#meta-string","content":" Meta string is mainly used to encode meta strings such as class name and field names.  ","version":"0.11","tagName":"h2"},{"title":"Encoding Algorithms‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.11/specification/java_serialization_spec#encoding-algorithms","content":" String binary encoding algorithm:  Algorithm\tPattern\tDescriptionLOWER_SPECIAL\ta-z._$|\tevery char is written using 5 bits, a-z: 0b00000~0b11001, ._$|: 0b11010~0b11101, prepend one bit at the start to indicate whether strip last char since last byte may have 7 redundant bits(1 indicates strip last char) LOWER_UPPER_DIGIT_SPECIAL\ta-zA-Z0~9._\tevery char is written using 6 bits, a-z: 0b00000~0b11001, A-Z: 0b11010~0b110011, 0~9: 0b110100~0b111101, ._: 0b111110~0b111111, prepend one bit at the start to indicate whether strip last char since last byte may have 7 redundant bits(1 indicates strip last char) UTF-8\tany chars\tUTF-8 encoding  Encoding flags:  Encoding Flag\tPattern\tEncoding AlgorithmLOWER_SPECIAL\tevery char is in a-z._$|\tLOWER_SPECIAL FIRST_TO_LOWER_SPECIAL\tevery char is in a-z[c1,c2] except first char is upper case\treplace first upper case char to lower case, then use LOWER_SPECIAL ALL_TO_LOWER_SPECIAL\tevery char is in a-zA-Z[c1,c2]\treplace every upper case char by | + lower case, then use LOWER_SPECIAL, use this encoding if it's smaller than Encoding LOWER_UPPER_DIGIT_SPECIAL LOWER_UPPER_DIGIT_SPECIAL\tevery char is in a-zA-Z[c1,c2]\tuse LOWER_UPPER_DIGIT_SPECIAL encoding if it's smaller than Encoding FIRST_TO_LOWER_SPECIAL UTF8\tany utf-8 char\tuse UTF-8 encoding Compression\tany utf-8 char\tlossless compression  Notes:  For package name encoding, c1,c2 should be ._; For field/type name encoding, c1,c2 should be _$;Depending on cases, one can choose encoding flags + data jointly, uses 3 bits of first byte for flags and other bytes for data.  ","version":"0.11","tagName":"h3"},{"title":"Shared meta string‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.11/specification/java_serialization_spec#shared-meta-string","content":" The shared meta string format consists of header and encoded string binary. Header of encoded string binary will be inlined in shared meta header.  Header is written using little endian order, Fory can read this flag first to determine how to deserialize the data.  Write by data‚Äã  If string hasn't been written before, the data will be written as follows:  | unsigned varint: string binary size + 1 bit: not written before | 56 bits: unique hash | 3 bits encoding flags + string binary |   If string binary size is less than 16 bytes, the hash will be omitted to save spaces. Unique hash can be omitted too if caller pass a flag to disable it. In such cases, the format will be:  | unsigned varint: string binary size + 1 bit: not written before | 3 bits encoding flags + string binary |   Write by ref‚Äã  If string has been written before, the data will be written as follows:  | unsigned varint: written string id + 1 bit: written before |   ","version":"0.11","tagName":"h3"},{"title":"Value Format‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.11/specification/java_serialization_spec#value-format","content":" ","version":"0.11","tagName":"h2"},{"title":"Basic types‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.11/specification/java_serialization_spec#basic-types","content":" Bool‚Äã  size: 1 byteformat: 0 for false, 1 for true  Byte‚Äã  size: 1 byteformat: write as pure byte.  Short‚Äã  size: 2 bytebyte order: little endian order  Char‚Äã  size: 2 bytebyte order: little endian order  Unsigned int‚Äã  size: 1~5 byteFormat: The most significant bit (MSB) in every byte indicates whether to have the next byte. If first bit is set i.e. b &amp; 0x80 == 0x80, then the next byte should be read until the first bit of the next byte is unset.  Signed int‚Äã  size: 1~5 byteFormat: First convert the number into positive unsigned int by (v &lt;&lt; 1) ^ (v &gt;&gt; 31) ZigZag algorithm, then encoding it as an unsigned int.  Unsigned long‚Äã  size: 1~9 byteFory PVL(Progressive Variable-length Long) Encoding: positive long format: first bit in every byte indicates whether to have the next byte. If first bit is set i.e. b &amp; 0x80 == 0x80, then the next byte should be read until the first bit is unset.  Signed long‚Äã  size: 1~9 byteFory SLI(Small long as int) Encoding: If long is in [-1073741824, 1073741823], encode as 4 bytes int: | little-endian: ((int) value) &lt;&lt; 1 |Otherwise write as 9 bytes: | 0b1 | little-endian 8 bytes long | Fory PVL(Progressive Variable-length Long) Encoding: First convert the number into positive unsigned long by (v &lt;&lt; 1) ^ (v &gt;&gt; 63) ZigZag algorithm to reduce cost of small negative numbers, then encoding it as an unsigned long.  Float‚Äã  size: 4 byteformat: convert float to 4 bytes int by Float.floatToRawIntBits, then write as binary by little endian order.  Double‚Äã  size: 8 byteformat: convert double to 8 bytes int by Double.doubleToRawLongBits, then write as binary by little endian order.  ","version":"0.11","tagName":"h3"},{"title":"String‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.11/specification/java_serialization_spec#string","content":" Format:  | header: size &lt;&lt; 2 | 2 bits encoding flags | binary data |   size + encoding will be concat as a long and encoded as an unsigned var long. The little 2 bits is used for encoding: 0 for latin, 1 for utf-16, 2 for utf-8.encoded string binary data based on encoding: latin/utf-16/utf-8.  Which encoding to choose:  For JDK8: fory detect latin at runtime, if string is latin string, then use latin encoding, otherwise use utf-16.For JDK9+: fory use coder in String object for encoding, latin/utf-16 will be used for encoding.If the string is encoded by utf-8, then fory will use utf-8 to decode the data. But currently fory doesn't enable utf-8 encoding by default for java. Cross-language string serialization of fory uses utf-8 by default.  ","version":"0.11","tagName":"h3"},{"title":"Collection‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.11/specification/java_serialization_spec#collection","content":" All collection serializers must extend AbstractCollectionSerializer.  Format:  length(unsigned varint) | collection header | elements header | elements data   Collection header‚Äã  For ArrayList/LinkedArrayList/HashSet/LinkedHashSet, this will be empty.For TreeSet, this will be ComparatorFor subclass of ArrayList, this may be extra object field info.  Elements header‚Äã  In most cases, all collection elements are same type and not null, elements header will encode those homogeneous information to avoid the cost of writing it for every element. Specifically, there are four kinds of information which will be encoded by elements header, each use one bit:  If track elements ref, use the first bit 0b1 of the header to flag it.If the collection has null, use the second bit 0b10 of the header to flag it. If ref tracking is enabled for this element type, this flag is invalid.If the collection element types are not declared type, use the 3rd bit 0b100 of the header to flag it.If the collection element types are different, use the 4rd bit 0b1000 header to flag it.  By default, all bits are unset, which means all elements won't track ref, all elements are same type, not null and the actual element is the declared type in the custom class field.  The implementation can generate different deserialization code based read header, and look up the generated code from a linear map/list.  Elements data‚Äã  Based on the elements header, the serialization of elements data may skip ref flag/null flag/element class info.  CollectionSerializer#write/read can be taken as an example.  ","version":"0.11","tagName":"h3"},{"title":"Array‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.11/specification/java_serialization_spec#array","content":" Primitive array‚Äã  Primitive array are taken as a binary buffer, serialization will just write the length of array size as an unsigned int, then copy the whole buffer into the stream.  Such serialization won't compress the array. If users want to compress primitive array, users need to register custom serializers for such types.  Object array‚Äã  Object array is serialized using the collection format. Object component type will be taken as collection element generic type.  ","version":"0.11","tagName":"h3"},{"title":"Map‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.11/specification/java_serialization_spec#map","content":" All Map serializers must extend AbstractMapSerializer.  Format:  | length(unsigned varint) | map header | key value pairs data |   Map header‚Äã  For HashMap/LinkedHashMap, this will be empty.For TreeMap, this will be ComparatorFor other Map, this may be extra object field info.  Map Key-Value data‚Äã  Map iteration is too expensive, Fory won't compute the header like for collection before since it introduceconsiderable overhead. Users can use MapFieldInfo annotation to provide header in advance. Otherwise Fory will use first key-value pair to predict header optimistically, and update the chunk header if the prediction failed at some pair.  Fory will serialize map chunk by chunk, every chunk has 127 pairs at most.  | 1 byte | 1 byte | variable bytes | +----------------+----------------+-----------------+ | KV header | chunk size: N | N*2 objects |   KV header:  If track key ref, use the first bit 0b1 of the header to flag it.If the key has null, use the second bit 0b10 of the header to flag it. If ref tracking is enabled for this key type, this flag is invalid.If the actual key type of map is not the declared key type, use the 3rd bit 0b100 of the header to flag it.If track value ref, use the 4th bit 0b1000 of the header to flag it.If the value has null, use the 5th bit 0b10000 of the header to flag it. If ref tracking is enabled for this value type, this flag is invalid.If the value type of map is not the declared value type, use the 6rd bit 0b100000 of the header to flag it.If key or value is null, that key and value will be written as a separate chunk, and chunk size writing will be skipped too.  If streaming write is enabled, which means Fory can't update written chunk size. In such cases, map key-value data format will be:  | 1 byte | variable bytes | +----------------+-----------------+ | KV header | N*2 objects |   KV header will be a header marked by MapFieldInfo in java. The implementation can generate different deserialization code based read header, and look up the generated code from a linear map/list.  ","version":"0.11","tagName":"h3"},{"title":"Enum‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.11/specification/java_serialization_spec#enum","content":" Enums are serialized as an unsigned var int. If the order of enum values change, the deserialized enum value may not be the value users expect. In such cases, users must register enum serializer by make it write enum value as an enumerated string with unique hash disabled.  ","version":"0.11","tagName":"h3"},{"title":"Object‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.11/specification/java_serialization_spec#object","content":" Object means object of pojo/struct/bean/record type. Object will be serialized by writing its fields data in fory order.  Depending on schema compatibility, objects will have different formats.  Field order‚Äã  Field will be ordered as following, every group of fields will have its own order:  primitive fields: larger size type first, smaller later, variable size type last.boxed primitive fields: same order as primitive fieldsfinal fields: same type together, then sorted by field name lexicographically.collection fields: same order as final fieldsmap fields: same order as final fieldsother fields: same order as final fields  Schema consistent‚Äã  Object fields will be serialized one by one using following format:  Primitive field value: | var bytes | +----------------+ | value data | +----------------+ Boxed field value: | one byte | var bytes | +-----------+---------------+ | null flag | field value | +-----------+---------------+ field value of final type with ref tracking: | var bytes | var objects | +-----------+-------------+ | ref meta | value data | +-----------+-------------+ field value of final type without ref tracking: | one byte | var objects | +-----------+-------------+ | null flag | field value | +-----------+-------------+ field value of non-final type with ref tracking: | one byte | var bytes | var objects | +-----------+-------------+-------------+ | ref meta | class meta | value data | +-----------+-------------+-------------+ field value of non-final type without ref tracking: | one byte | var bytes | var objects | +-----------+------------+------------+ | null flag | class meta | value data | +-----------+------------+------------+   Schema evolution‚Äã  Schema evolution have similar format as schema consistent mode for object except:  For this object type itself, schema consistent mode will write class by id/name, but schema evolution mode will write class field names, types and other meta too, see Class meta.Class meta of final custom type needs to be written too, because peers may not have this class defined.  ","version":"0.11","tagName":"h3"},{"title":"Class‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.11/specification/java_serialization_spec#class","content":" Class will be serialized using class meta format.  ","version":"0.11","tagName":"h3"},{"title":"Implementation guidelines‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.11/specification/java_serialization_spec#implementation-guidelines","content":" Try to merge multiple bytes into an int/long write before writing to reduce memory IO and bound check cost.Read multiple bytes as an int/long, then split into multiple bytes to reduce memory IO and bound check cost.Try to use one varint/long to write flags and length together to save one byte cost and reduce memory io.Condition branches are less expensive compared to memory IO cost unless there are too many branches. ","version":"0.11","tagName":"h2"},{"title":"Xlang Serialization","type":0,"sectionRef":"#","url":"/docs/0.11/guide/xlang_serialization","content":"","keywords":"","version":"0.11"},{"title":"Serialize built-in types‚Äã","type":1,"pageTitle":"Xlang Serialization","url":"/docs/0.11/guide/xlang_serialization#serialize-built-in-types","content":" Common types can be serialized automatically: primitive numeric types, string, binary, array, list, map and so on.  Java  import org.apache.fory.*; import org.apache.fory.config.*; import java.util.*; public class Example1 { public static void main(String[] args) { Fory fory = Fory.builder().withLanguage(Language.XLANG).build(); List&lt;Object&gt; list = ofArrayList(true, false, &quot;str&quot;, -1.1, 1, new int[100], new double[20]); byte[] bytes = fory.serialize(list); // bytes can be data serialized by other languages. fory.deserialize(bytes); Map&lt;Object, Object&gt; map = new HashMap&lt;&gt;(); map.put(&quot;k1&quot;, &quot;v1&quot;); map.put(&quot;k2&quot;, list); map.put(&quot;k3&quot;, -1); bytes = fory.serialize(map); // bytes can be data serialized by other languages. fory.deserialize(bytes); } }   Python  import pyfory import numpy as np fory = pyfory.Fory() object_list = [True, False, &quot;str&quot;, -1.1, 1, np.full(100, 0, dtype=np.int32), np.full(20, 0.0, dtype=np.double)] data = fory.serialize(object_list) # bytes can be data serialized by other languages. new_list = fory.deserialize(data) object_map = {&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: object_list, &quot;k3&quot;: -1} data = fory.serialize(object_map) # bytes can be data serialized by other languages. new_map = fory.deserialize(data) print(new_map)   Golang  package main import forygo &quot;github.com/apache/fory/fory/go/fory&quot; import &quot;fmt&quot; func main() { list := []interface{}{true, false, &quot;str&quot;, -1.1, 1, make([]int32, 10), make([]float64, 20)} fory := forygo.NewFory() bytes, err := fory.Marshal(list) if err != nil { panic(err) } var newValue interface{} // bytes can be data serialized by other languages. if err := fory.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) dict := map[string]interface{}{ &quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: list, &quot;k3&quot;: -1, } bytes, err = fory.Marshal(dict) if err != nil { panic(err) } // bytes can be data serialized by other languages. if err := fory.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) }   JavaScript  import Fory from &quot;@apache-fory/fory&quot;; /** * @apache-fory/hps use v8's fast-calls-api that can be called directly by jit, ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from &quot;@apache-fory/hps&quot;; const fory = new Fory({ hps }); const input = fory.serialize(&quot;hello fory&quot;); const result = fory.deserialize(input); console.log(result);   Rust  use chrono::{NaiveDate, NaiveDateTime}; use fory::{from_buffer, to_buffer, Fory}; use std::collections::HashMap; fn run() { let bin: Vec&lt;u8&gt; = to_buffer(&amp;&quot;hello&quot;.to_string()); let obj: String = from_buffer(&amp;bin).expect(&quot;should success&quot;); assert_eq!(&quot;hello&quot;.to_string(), obj); }   ","version":"0.11","tagName":"h2"},{"title":"Serialize custom types‚Äã","type":1,"pageTitle":"Xlang Serialization","url":"/docs/0.11/guide/xlang_serialization#serialize-custom-types","content":" Serializing user-defined types needs registering the custom type using the register API to establish the mapping relationship between the type in different languages.  Java  import org.apache.fory.*; import org.apache.fory.config.*; import java.util.*; public class Example2 { public static class SomeClass1 { Object f1; Map&lt;Byte, Integer&gt; f2; } public static class SomeClass2 { Object f1; String f2; List&lt;Object&gt; f3; Map&lt;Byte, Integer&gt; f4; Byte f5; Short f6; Integer f7; Long f8; Float f9; Double f10; short[] f11; List&lt;Short&gt; f12; } public static Object createObject() { SomeClass1 obj1 = new SomeClass1(); obj1.f1 = true; obj1.f2 = ofHashMap((byte) -1, 2); SomeClass2 obj = new SomeClass2(); obj.f1 = obj1; obj.f2 = &quot;abc&quot;; obj.f3 = ofArrayList(&quot;abc&quot;, &quot;abc&quot;); obj.f4 = ofHashMap((byte) 1, 2); obj.f5 = Byte.MAX_VALUE; obj.f6 = Short.MAX_VALUE; obj.f7 = Integer.MAX_VALUE; obj.f8 = Long.MAX_VALUE; obj.f9 = 1.0f / 2; obj.f10 = 1 / 3.0; obj.f11 = new short[]{(short) 1, (short) 2}; obj.f12 = ofArrayList((short) -1, (short) 4); return obj; } // mvn exec:java -Dexec.mainClass=&quot;org.apache.fory.examples.Example2&quot; public static void main(String[] args) { Fory fory = Fory.builder().withLanguage(Language.XLANG).build(); fory.register(SomeClass1.class, &quot;example.SomeClass1&quot;); fory.register(SomeClass2.class, &quot;example.SomeClass2&quot;); byte[] bytes = fory.serialize(createObject()); // bytes can be data serialized by other languages. System.out.println(fory.deserialize(bytes)); } }   Python  from dataclasses import dataclass from typing import List, Dict, Any import pyfory, array @dataclass class SomeClass1: f1: Any f2: Dict[pyfory.Int8Type, pyfory.Int32Type] @dataclass class SomeClass2: f1: Any = None f2: str = None f3: List[str] = None f4: Dict[pyfory.Int8Type, pyfory.Int32Type] = None f5: pyfory.Int8Type = None f6: pyfory.Int16Type = None f7: pyfory.Int32Type = None # int type will be taken as `pyfory.Int64Type`. # use `pyfory.Int32Type` for type hint if peer # are more narrow type. f8: int = None f9: pyfory.Float32Type = None # float type will be taken as `pyfory.Float64Type` f10: float = None f11: pyfory.Int16ArrayType = None f12: List[pyfory.Int16Type] = None if __name__ == &quot;__main__&quot;: f = pyfory.Fory() f.register_type(SomeClass1, typename=&quot;example.SomeClass1&quot;) f.register_type(SomeClass2, typename=&quot;example.SomeClass2&quot;) obj1 = SomeClass1(f1=True, f2={-1: 2}) obj = SomeClass2( f1=obj1, f2=&quot;abc&quot;, f3=[&quot;abc&quot;, &quot;abc&quot;], f4={1: 2}, f5=2 ** 7 - 1, f6=2 ** 15 - 1, f7=2 ** 31 - 1, f8=2 ** 63 - 1, f9=1.0 / 2, f10=1 / 3.0, f11=array.array(&quot;h&quot;, [1, 2]), f12=[-1, 4], ) data = f.serialize(obj) # bytes can be data serialized by other languages. print(f.deserialize(data))   Golang  package main import forygo &quot;github.com/apache/fory/fory/go/fory&quot; import &quot;fmt&quot; func main() { type SomeClass1 struct { F1 interface{} F2 string F3 []interface{} F4 map[int8]int32 F5 int8 F6 int16 F7 int32 F8 int64 F9 float32 F10 float64 F11 []int16 F12 fory.Int16Slice } type SomeClas2 struct { F1 interface{} F2 map[int8]int32 } fory := forygo.NewFory() if err := fory.RegisterTagType(&quot;example.SomeClass1&quot;, SomeClass1{}); err != nil { panic(err) } if err := fory.RegisterTagType(&quot;example.SomeClass2&quot;, SomeClass2{}); err != nil { panic(err) } obj1 := &amp;SomeClass1{} obj1.F1 = true obj1.F2 = map[int8]int32{-1: 2} obj := &amp;SomeClass1{} obj.F1 = obj1 obj.F2 = &quot;abc&quot; obj.F3 = []interface{}{&quot;abc&quot;, &quot;abc&quot;} f4 := map[int8]int32{1: 2} obj.F4 = f4 obj.F5 = fory.MaxInt8 obj.F6 = fory.MaxInt16 obj.F7 = fory.MaxInt32 obj.F8 = fory.MaxInt64 obj.F9 = 1.0 / 2 obj.F10 = 1 / 3.0 obj.F11 = []int16{1, 2} obj.F12 = []int16{-1, 4} bytes, err := fory.Marshal(obj); if err != nil { panic(err) } var newValue interface{} // bytes can be data serialized by other languages. if err := fory.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) }   JavaScript  import Fory, { Type, InternalSerializerType } from &quot;@apache-fory/fory&quot;; /** * @apache-fory/hps use v8's fast-calls-api that can be called directly by jit, ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from &quot;@apache-fory/hps&quot;; // Now we describe data structures using JSON, but in the future, we will use more ways. const description = Type.object(&quot;example.foo&quot;, { foo: Type.string(), }); const fory = new Fory({ hps }); const { serialize, deserialize } = fory.registerSerializer(description); const input = serialize({ foo: &quot;hello fory&quot; }); const result = deserialize(input); console.log(result);   Rust  use chrono::{NaiveDate, NaiveDateTime}; use fory::{from_buffer, to_buffer, Fory}; use std::collections::HashMap; #[test] fn complex_struct() { #[derive(Fory, Debug, PartialEq)] #[tag(&quot;example.foo2&quot;)] struct Animal { category: String, } #[derive(Fory, Debug, PartialEq)] #[tag(&quot;example.foo&quot;)] struct Person { c1: Vec&lt;u8&gt;, // binary c2: Vec&lt;i16&gt;, // primitive array animal: Vec&lt;Animal&gt;, c3: Vec&lt;Vec&lt;u8&gt;&gt;, name: String, c4: HashMap&lt;String, String&gt;, age: u16, op: Option&lt;String&gt;, op2: Option&lt;String&gt;, date: NaiveDate, time: NaiveDateTime, c5: f32, c6: f64, } let person: Person = Person { c1: vec![1, 2, 3], c2: vec![5, 6, 7], c3: vec![vec![1, 2], vec![1, 3]], animal: vec![Animal { category: &quot;Dog&quot;.to_string(), }], c4: HashMap::from([ (&quot;hello1&quot;.to_string(), &quot;hello2&quot;.to_string()), (&quot;hello2&quot;.to_string(), &quot;hello3&quot;.to_string()), ]), age: 12, name: &quot;helo&quot;.to_string(), op: Some(&quot;option&quot;.to_string()), op2: None, date: NaiveDate::from_ymd_opt(2025, 12, 12).unwrap(), time: NaiveDateTime::from_timestamp_opt(1689912359, 0).unwrap(), c5: 2.0, c6: 4.0, }; let bin: Vec&lt;u8&gt; = to_buffer(&amp;person); let obj: Person = from_buffer(&amp;bin).expect(&quot;should success&quot;); assert_eq!(person, obj); }   ","version":"0.11","tagName":"h2"},{"title":"Serialize Shared Reference and Circular Reference‚Äã","type":1,"pageTitle":"Xlang Serialization","url":"/docs/0.11/guide/xlang_serialization#serialize-shared-reference-and-circular-reference","content":" Shared reference and circular reference can be serialized automatically, no duplicate data or recursion error.  Java  import org.apache.fory.*; import org.apache.fory.config.*; import java.util.*; public class ReferenceExample { public static class SomeClass { SomeClass f1; Map&lt;String, String&gt; f2; Map&lt;String, String&gt; f3; } public static Object createObject() { SomeClass obj = new SomeClass(); obj.f1 = obj; obj.f2 = ofHashMap(&quot;k1&quot;, &quot;v1&quot;, &quot;k2&quot;, &quot;v2&quot;); obj.f3 = obj.f2; return obj; } // mvn exec:java -Dexec.mainClass=&quot;org.apache.fory.examples.ReferenceExample&quot; public static void main(String[] args) { Fory fory = Fory.builder().withLanguage(Language.XLANG) .withRefTracking(true).build(); fory.register(SomeClass.class, &quot;example.SomeClass&quot;); byte[] bytes = fory.serialize(createObject()); // bytes can be data serialized by other languages. System.out.println(fory.deserialize(bytes)); } }   Python  from typing import Dict import pyfory class SomeClass: f1: &quot;SomeClass&quot; f2: Dict[str, str] f3: Dict[str, str] fory = pyfory.Fory(ref_tracking=True) fory.register_type(SomeClass, typename=&quot;example.SomeClass&quot;) obj = SomeClass() obj.f2 = {&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: &quot;v2&quot;} obj.f1, obj.f3 = obj, obj.f2 data = fory.serialize(obj) # bytes can be data serialized by other languages. print(fory.deserialize(data))   Golang  package main import forygo &quot;github.com/apache/fory/fory/go/fory&quot; import &quot;fmt&quot; func main() { type SomeClass struct { F1 *SomeClass F2 map[string]string F3 map[string]string } fory := forygo.NewFory(true) if err := fory.RegisterTagType(&quot;example.SomeClass&quot;, SomeClass{}); err != nil { panic(err) } value := &amp;SomeClass{F2: map[string]string{&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: &quot;v2&quot;}} value.F3 = value.F2 value.F1 = value bytes, err := fory.Marshal(value) if err != nil { } var newValue interface{} // bytes can be data serialized by other languages. if err := fory.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) }   JavaScript  import Fory, { Type } from '@apache-fory/fory'; /** * @apache-fory/hps use v8's fast-calls-api that can be called directly by jit, ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from '@apache-fory/hps'; const description = Type.object('example.foo', { foo: Type.string(), bar: Type.object('example.foo'), }); const fory = new Fory({ hps }); const { serialize, deserialize } = fory.registerSerializer(description); const data: any = { foo: 'hello fory', }; data.bar = data; const input = serialize(data); const result = deserialize(input); console.log(result.bar.foo === result.foo);   JavaScriptReference cannot be implemented because of rust ownership restrictions  ","version":"0.11","tagName":"h2"},{"title":"Zero-Copy Serialization‚Äã","type":1,"pageTitle":"Xlang Serialization","url":"/docs/0.11/guide/xlang_serialization#zero-copy-serialization","content":" Java  import org.apache.fory.*; import org.apache.fory.config.*; import org.apache.fory.serializer.BufferObject; import org.apache.fory.memory.MemoryBuffer; import java.util.*; import java.util.stream.Collectors; public class ZeroCopyExample { // mvn exec:java -Dexec.mainClass=&quot;io.ray.fory.examples.ZeroCopyExample&quot; public static void main(String[] args) { Fory fory = Fory.builder().withLanguage(Language.XLANG).build(); List&lt;Object&gt; list = ofArrayList(&quot;str&quot;, new byte[1000], new int[100], new double[100]); Collection&lt;BufferObject&gt; bufferObjects = new ArrayList&lt;&gt;(); byte[] bytes = fory.serialize(list, e -&gt; !bufferObjects.add(e)); // bytes can be data serialized by other languages. List&lt;MemoryBuffer&gt; buffers = bufferObjects.stream() .map(BufferObject::toBuffer).collect(Collectors.toList()); System.out.println(fory.deserialize(bytes, buffers)); } }   Python  import array import pyfory import numpy as np fory = pyfory.Fory() list_ = [&quot;str&quot;, bytes(bytearray(1000)), array.array(&quot;i&quot;, range(100)), np.full(100, 0.0, dtype=np.double)] serialized_objects = [] data = fory.serialize(list_, buffer_callback=serialized_objects.append) buffers = [o.to_buffer() for o in serialized_objects] # bytes can be data serialized by other languages. print(fory.deserialize(data, buffers=buffers))   Golang  package main import forygo &quot;github.com/apache/fory/fory/go/fory&quot; import &quot;fmt&quot; func main() { fory := forygo.NewFory() list := []interface{}{&quot;str&quot;, make([]byte, 1000)} buf := fory.NewByteBuffer(nil) var bufferObjects []fory.BufferObject fory.Serialize(buf, list, func(o fory.BufferObject) bool { bufferObjects = append(bufferObjects, o) return false }) var newList []interface{} var buffers []*fory.ByteBuffer for _, o := range bufferObjects { buffers = append(buffers, o.ToBuffer()) } if err := fory.Deserialize(buf, &amp;newList, buffers); err != nil { panic(err) } fmt.Println(newList) }   JavaScript  // Coming soon  ","version":"0.11","tagName":"h2"},{"title":"Install","type":0,"sectionRef":"#","url":"/docs/0.11/start/install","content":"","keywords":"","version":"0.11"},{"title":"Java‚Äã","type":1,"pageTitle":"Install","url":"/docs/0.11/start/install#java","content":" To add a dependency on Apache Fory‚Ñ¢ using Maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-core&lt;/artifactId&gt; &lt;version&gt;0.11.2&lt;/version&gt; &lt;/dependency&gt; &lt;!-- row/arrow format support --&gt; &lt;!-- &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-format&lt;/artifactId&gt; &lt;version&gt;0.11.2&lt;/version&gt; &lt;/dependency&gt; --&gt;   ","version":"0.11","tagName":"h2"},{"title":"Scala‚Äã","type":1,"pageTitle":"Install","url":"/docs/0.11/start/install#scala","content":" To add a dependency on Apache Fory‚Ñ¢scala for scala 2.13 with maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-scala_2.13&lt;/artifactId&gt; &lt;version&gt;0.11.2&lt;/version&gt; &lt;/dependency&gt;   To add a dependency on Apache Fory‚Ñ¢scala for scala 3 with maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-scala_3&lt;/artifactId&gt; &lt;version&gt;0.11.2&lt;/version&gt; &lt;/dependency&gt;   To add a dependency on Apache Fory‚Ñ¢scala for scala 2.13 with sbt, use the following:  libraryDependencies += &quot;org.apache.fory&quot; % &quot;fory-scala_2.13&quot; % &quot;0.11.2&quot;   To add a dependency on Apache Fory‚Ñ¢scala for scala 3 with sbt, use the following:  libraryDependencies += &quot;org.apache.fory&quot; % &quot;fory-scala_3&quot; % &quot;0.11.2&quot;   ","version":"0.11","tagName":"h2"},{"title":"Kotlin‚Äã","type":1,"pageTitle":"Install","url":"/docs/0.11/start/install#kotlin","content":" To add a dependency on Apache Fory‚Ñ¢kotlin with maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-kotlin&lt;/artifactId&gt; &lt;version&gt;0.11.2&lt;/version&gt; &lt;/dependency&gt;   ","version":"0.11","tagName":"h2"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Install","url":"/docs/0.11/start/install#javascript","content":" Apache Fory‚Ñ¢ is NOT yet available on npm, please install from source code now. ","version":"0.11","tagName":"h2"},{"title":"Xlang Serialization Format","type":0,"sectionRef":"#","url":"/docs/0.11/specification/xlang_serialization_spec","content":"","keywords":"","version":"0.11"},{"title":"Cross-language Serialization Specification‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#cross-language-serialization-specification","content":" Format Version History: Version 0.1 - serialization spec formalized  Fory xlang serialization is an automatic object serialization framework that supports reference and polymorphism. Fory will convert an object from/to fory xlang serialization binary format. Fory has two core concepts for xlang serialization:  Fory xlang binary formatFramework implemented in different languages to convert object to/from Fory xlang binary format  The serialization format is a dynamic binary format. The dynamics and reference/polymorphism support make Fory flexible, much more easy to use, but also introduce more complexities compared to static serialization frameworks. So the format will be more complex.  ","version":"0.11","tagName":"h2"},{"title":"Type Systems‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#type-systems","content":" ","version":"0.11","tagName":"h2"},{"title":"Data Types‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#data-types","content":" bool: a boolean value (true or false).int8: a 8-bit signed integer.int16: a 16-bit signed integer.int32: a 32-bit signed integer.var_int32: a 32-bit signed integer which use fory var_int32 encoding.int64: a 64-bit signed integer.var_int64: a 64-bit signed integer which use fory PVL encoding.sli_int64: a 64-bit signed integer which use fory SLI encoding.float16: a 16-bit floating point number.float32: a 32-bit floating point number.float64: a 64-bit floating point number including NaN and Infinity.string: a text string encoded using Latin1/UTF16/UTF-8 encoding.enum: a data type consisting of a set of named values. Rust enum with non-predefined field values are not supported as an enum.named_enum: an enum whose value will be serialized as the registered name.struct: a morphic(final) type serialized by Fory Struct serializer. i.e. it doesn't have subclasses. Suppose we're deserializing List&lt;SomeClass&gt;, we can save dynamic serializer dispatch since SomeClass is morphic(final).compatible_struct: a morphic(final) type serialized by Fory compatible Struct serializer.named_struct: a struct whose type mapping will be encoded as a name.named_compatible_struct: a compatible_struct whose type mapping will be encoded as a name.ext: a type which will be serialized by a customized serializer.named_ext: an ext type whose type mapping will be encoded as a name.list: a sequence of objects.set: an unordered set of unique elements.map: a map of key-value pairs. Mutable types such as list/map/set/array/tensor/arrow are not allowed as key of map.duration: an absolute length of time, independent of any calendar/timezone, as a count of nanoseconds.timestamp: a point in time, independent of any calendar/timezone, as a count of nanoseconds. The count is relative to an epoch at UTC midnight on January 1, 1970.local_date: a naive date without timezone. The count is days relative to an epoch at UTC midnight on Jan 1, 1970.decimal: exact decimal value represented as an integer value in two's complement.binary: an variable-length array of bytes.array: only allow 1d numeric components. Other arrays will be taken as List. The implementation should support the interoperability between array and list. bool_array: one dimensional bool array.int8_array: one dimensional int8 array.int16_array: one dimensional int16 array.int32_array: one dimensional int32 array.int64_array: one dimensional int64 array.float16_array: one dimensional half_float_16 array.float32_array: one dimensional float32 array.float64_array: one dimensional float64 array. tensor: multidimensional array which every sub-array have same size and type.arrow record batch: an arrow record batch object.arrow table: an arrow table object.  Note:  Unsigned int/long are not added here, since not every language support those types.  ","version":"0.11","tagName":"h3"},{"title":"Polymorphisms‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#polymorphisms","content":" For polymorphism, if one non-final class is registered, and only one subclass is registered, then we can take all elements in List/Map have same type, thus reduce runtime check cost.  Collection/Array polymorphism are not fully supported, since some languages such as golang have only one collection type. If users want to get exactly the type he passed, he must pass that type when deserializing or annotate that type to the field of struct.  ","version":"0.11","tagName":"h3"},{"title":"Type disambiguation‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#type-disambiguation","content":" Due to differences between type systems of languages, those types can't be mapped one-to-one between languages. When deserializing, Fory use the target data structure type and the data type in the data jointly to determine how to deserialize and populate the target data structure. For example:  class Foo { int[] intArray; Object[] objects; List&lt;Object&gt; objectList; } class Foo2 { int[] intArray; List&lt;Object&gt; objects; List&lt;Object&gt; objectList; }   intArray has an int32_array type. But both objects and objectList fields in the serialize data have list data type. When deserializing, the implementation will create an Object array for objects, but create a ArrayListfor objectList to populate its elements. And the serialized data of Foo can be deserialized into Foo2 too.  Users can also provide meta hints for fields of a type, or the type whole. Here is an example in java which use annotation to provide such information.  @ForyObject(fieldsNullable = false, trackingRef = false) class Foo { @ForyField(trackingRef = false) int[] intArray; @ForyField(polymorphic = true) Object object; @ForyField(tagId = 1, nullable = true) List&lt;Object&gt; objectList; }   Such information can be provided in other languages too:  cpp: use macro and template.golang: use struct tag.python: use typehint.rust: use macro.  ","version":"0.11","tagName":"h3"},{"title":"Type ID‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#type-id","content":" All internal data types are expressed using an ID in range 0~64. Users can use 0~4096 for representing their types.  ","version":"0.11","tagName":"h3"},{"title":"Spec overview‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#spec-overview","content":" Here is the overall format:  | fory header | object ref meta | object type meta | object value data |   The data are serialized using little endian byte order overall. If bytes swap is costly for some object, Fory will write the byte order for that object into the data instead of converting it to little endian.  ","version":"0.11","tagName":"h2"},{"title":"Fory header‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#fory-header","content":" Fory header consists starts one byte:  | 2 bytes | 4 bits | 1 bit | 1 bit | 1 bit | 1 bit | 1 byte | optional 4 bytes | +--------------+---------------+-------+-------+--------+-------+------------+------------------------------------+ | magic number | reserved bits | oob | xlang | endian | null | language | unsigned int for meta start offset |   magic number: used to identify fory serialization protocol, current version use 0x62d4.null flag: 1 when object is null, 0 otherwise. If an object is null, other bits won't be set.endian flag: 1 when data is encoded by little endian, 0 for big endian.xlang flag: 1 when serialization uses xlang format, 0 when serialization uses Fory java format.oob flag: 1 when passed BufferCallback is not null, 0 otherwise.language: the language when serializing objects, such as JAVA, PYTHON, GO, etc. Fory can use this flag to determine whether spend more time on serialization to make the deserialization faster for dynamic languages.  If meta share mode is enabled, an uncompressed unsigned int is appended to indicate the start offset of metadata.  ","version":"0.11","tagName":"h2"},{"title":"Reference Meta‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#reference-meta","content":" Reference tracking handles whether the object is null, and whether to track reference for the object by writing corresponding flags and maintaining internal state.  Reference flags:  Flag\tByte Value\tDescriptionNULL FLAG\t-3\tThis flag indicates the object is a null value. We don't use another byte to indicate REF, so that we can save one byte. REF FLAG\t-2\tThis flag indicates the object is already serialized previously, and fory will write a ref id with unsigned varint format instead of serialize it again NOT_NULL VALUE FLAG\t-1\tThis flag indicates the object is a non-null value and fory doesn't track ref for this type of object. REF VALUE FLAG\t0\tThis flag indicates the object is referencable and the first time to serialize.  When reference tracking is disabled globally or for specific types, or for certain types within a particular context(e.g., a field of a type), only the NULL and NOT_NULL VALUE flags will be used for reference meta.  For languages which doesn't support reference such as rust, reference tracking must be disabled for correct deserialization by fory rust implementation.  For languages whose object values are not null by default:  In rust, Fory takes Option:None as a null valueIn c++, Fory takes std::nullopt as a null valueIn golang, Fory takes null interface/pointer as a null value  If one want to deserialize in languages like Java/Python/JavaScript, he should mark the type with all fields not-null by default, or using schema-evolution mode to carry the not-null fields info in the data.  ","version":"0.11","tagName":"h2"},{"title":"Type Meta‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#type-meta","content":" For every type to be serialized, it have a type id to indicate its type.  basic types: the type idenum: Type.ENUM + registered idType.NAMED_ENUM + registered namespace+typename list: Type.Listset: Type.SETmap: Type.MAPext: Type.EXT + registered idType.NAMED_EXT + registered namespace+typename struct: Type.STRUCT + struct metaType.NAMED_STRUCT + struct meta  Every type must be registered with an ID or name first. The registration can be used for security check and type identification.  Struct is a special type, depending whether schema compatibility is enabled, Fory will write struct meta differently.  ","version":"0.11","tagName":"h2"},{"title":"Struct Schema consistent‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#struct-schema-consistent","content":" If schema consistent mode is enabled globally when creating fory, type meta will be written as a fory unsigned varint of type_id. Schema evolution related meta will be ignored.If schema evolution mode is enabled globally when creating fory, and current class is configured to use schema consistent mode like struct vs table in flatbuffers: Type meta will be add to captured_type_defs: captured_type_defs[type def stub] = map size ahead when registering type.Get index of the meta in captured_type_defs, write that index as | unsigned varint: index |.  ","version":"0.11","tagName":"h3"},{"title":"Struct Schema evolution‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#struct-schema-evolution","content":" If schema evolution mode is enabled globally when creating fory, and enabled for current type, type meta will be written using one of the following mode. Which mode to use is configured when creating fory.  Normal mode(meta share not enabled): If type meta hasn't been written before, add type defto captured_type_defs: captured_type_defs[type def] = map size.Get index of the meta in captured_type_defs, write that index as | unsigned varint: index |.After finished the serialization of the object graph, fory will start to write captured_type_defs: Firstly, set current to meta start offset of fory header Then write captured_type_defs one by one: buffer.write_var_uint32(len(writting_type_defs) - len(schema_consistent_type_def_stubs)) for type_meta in writting_type_defs: if not type_meta.is_stub(): type_meta.write_type_def(buffer) writing_type_defs = copy(schema_consistent_type_def_stubs) Meta share mode: the writing steps are same as the normal mode, but captured_type_defs will be shared across multiple serializations of different objects. For example, suppose we have a batch to serialize: captured_type_defs = {} stream = ... # add `Type1` to `captured_type_defs` and write `Type1` fory.serialize(stream, [Type1()]) # add `Type2` to `captured_type_defs` and write `Type2`, `Type1` is written before. fory.serialize(stream, [Type1(), Type2()]) # `Type1` and `Type2` are written before, no need to write meta. fory.serialize(stream, [Type1(), Type2()]) Streaming mode(streaming mode doesn't support meta share): If type meta hasn't been written before, the data will be written as: | unsigned varint: 0b11111111 | type def | If type meta has been written before, the data will be written as: | unsigned varint: written index &lt;&lt; 1 | written index is the id in captured_type_defs. With this mode, meta start offset can be omitted.  The normal mode and meta share mode will forbid streaming writing since it needs to look back for update the start offset after the whole object graph writing and meta collecting is finished. Only in this way we can ensure deserialization failure in meta share mode doesn't lost shared meta.  Type Def‚Äã  Here we mainly describe the meta layout for schema evolution mode:  | 8 bytes header | variable bytes | variable bytes | +----------------------+--------------------+-------------------+ | global binary header | meta header | fields meta |   For languages which support inheritance, if parent class and subclass has fields with same name, using field in subclass.  Global binary header‚Äã  50 bits hash + 1bit compress flag + write fields meta + 12 bits meta size. Right is the lower bits.  lower 12 bits are used to encode meta size. If meta size &gt;= 0b1111_1111_1111, then writemeta_ size - 0b1111_1111_1111 next.13rd bit is used to indicate whether to write fields meta. When this class is schema-consistent or use registered serializer, fields meta will be skipped. Class Meta will be used for share namespace + type name only.14rd bit is used to indicate whether meta is compressed.Other 50 bits is used to store the unique hash of flags + all layers class meta.  Meta header‚Äã  Meta header is a 8 bits number value.  Lowest 5 digits 0b00000~0b11110 are used to record num fields. 0b11111 is preserved to indicate that Fory need to read more bytes for length using Fory unsigned int encoding. Note that num_fields is the number of compatible fields. Users can use tag id to mark some fields as compatible fields in schema consistent context. In such cases, schema consistent fields will be serialized first, then compatible fields will be serialized next. At deserialization, Fory will use fields info of those fields which aren't annotated by tag id for deserializing schema consistent fields, then use fields info in meta for deserializing compatible fields.The 6th bit: 0 for registered by id, 1 for registered by name.Remaining 2 bits are reserved for future extension.  Fields meta‚Äã  Format:  | field info: variable bytes | variable bytes | ... | +---------------------------------+-----------------+-----+ | header + type info + field name | next field info | ... |   Field Header‚Äã  Field Header is 8 bits, annotation can be used to provide more specific info. If annotation not exists, fory will infer those info automatically.  The format for field header is:  2 bits field name encoding + 4 bits size + nullability flag + ref tracking flag   Detailed spec:  2 bits field name encoding: encoding: UTF8/ALL_TO_LOWER_SPECIAL/LOWER_UPPER_DIGIT_SPECIAL/TAG_IDIf tag id is used, field name will be written by an unsigned varint tag id, and 2 bits encoding will be 11. size of field name: The 4 bits size: 0~14 will be used to indicate length 1~15, the value 15 indicates to read more bytes, the encoding will encode size - 15 as a varint next.If encoding is TAG_ID, then num_bytes of field name will be used to store tag id. ref tracking: when set to 1, ref tracking will be enabled for this field.nullability: when set to 1, this field can be null.  Field Type Info‚Äã  Field type info is written as unsigned int8. Detailed id spec is:  For struct registered by id, it will be Type.STRUCT.For struct registered by name, it will be Type.NAMED_STRUCT.For enum registered by id, it will be Type.ENUM.For enum registered by name, it will be Type.NAMED_ENUM.For ext type registered by id, it will be Type.EXT.For ext type registered by name, it will be Type.NAMED_EXT.For list/set type, it will be written as Type.LIST/SET, then write element type recursively.For 1D primitive array type, it will be written as Type.XXX_ARRAY.For multi-dimensional primitive array type with same size on each dim, it will be written as Type.TENSOR.For other array type, it will be written as Type.LIST, then write element type recursively.For map type, it will be written as Type.MAP, then write key and value type recursively.For other types supported by fory directly, it will be fory type id for that type.For other types not determined at compile time, write Type.UNKNOWN instead. For such types, actual type will be written when serializing such field values.  Polymorphism spec:  struct/named_struct/ext/named_ext are taken as polymorphic, the meta for those types are written separately instead of inlining here to reduce meta space cost if object of this type is serialized in current object graph multiple times, and the field value may be null too.enum is taken as morphic, if deserialization doesn't have this field, or the type is not enum, enum value will be skipped.list/map/set are taken as morphic, when serializing values of those type, the concrete types won't be written again.Other types that fory supported are taken as morphic too.  List/Set/Map nested type spec:  list: | list type id | nested type id &lt;&lt; 2 + nullability flag + ref tracking flag | ... multi-layer type info |set: | set type id | nested type id &lt;&lt; 2 + nullability flag + ref tracking flag | ... multi-layer type info |map: | set type id | key type info | value type info | Key type format: | nested type id &lt;&lt; 2 + nullability flag + ref tracking flag | ... multi-layer type info |Value type format: | nested type id &lt;&lt; 2 + nullability flag + ref tracking flag | ... multi-layer type info |  Field Name‚Äã  If tag id is set, tag id will be used instead. Otherwise meta string of field name will be written instead.  Field order‚Äã  Field order are left as implementation details, which is not exposed to specification, the deserialization need to resort fields based on Fory fields sort algorithms. In this way, fory can compute statistics for field names or types and using a more compact encoding.  ","version":"0.11","tagName":"h3"},{"title":"Extended Type Meta with Inheritance support‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#extended-type-meta-with-inheritance-support","content":" If one want to support inheritance for struct, one can implement following spec.  ","version":"0.11","tagName":"h2"},{"title":"Schema consistent‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#schema-consistent","content":" Fields are serialized from parent type to leaf type. Fields are sorted using fory struct fields sort algorithms.  ","version":"0.11","tagName":"h3"},{"title":"Schema Evolution‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#schema-evolution","content":" Meta layout for schema evolution mode:  | 8 bytes header | variable bytes | variable bytes | variable bytes | variable bytes | +----------------------+----------------+----------------+--------------------+--------------------+ | global binary header | meta header | fields meta | parent meta header | parent fields meta |   Meta header‚Äã  Meta header is a 64 bits number value encoded in little endian order.  Lowest 4 digits 0b0000~0b1110 are used to record num classes. 0b1111 is preserved to indicate that Fory need to read more bytes for length using Fory unsigned int encoding. If current type doesn't has parent type, or parent type doesn't have fields to serialize, or we're in a context which serialize fields of current type only, num classes will be 1.The 5th bit is used to indicate whether this type needs schema evolution.Other 56 bits are used to store the unique hash of flags + all layers type meta.  Single layer type meta‚Äã  | unsigned varint | var uint | field info: variable bytes | variable bytes | ... | +-----------------+----------+-------------------------------+-----------------+-----+ | num_fields | type id | header + type id + field name | next field info | ... |   Other layers type meta‚Äã  Same encoding algorithm as the previous layer.  ","version":"0.11","tagName":"h3"},{"title":"Meta String‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#meta-string","content":" Meta string is mainly used to encode meta strings such as field names.  ","version":"0.11","tagName":"h2"},{"title":"Encoding Algorithms‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#encoding-algorithms","content":" String binary encoding algorithm:  Algorithm\tPattern\tDescriptionLOWER_SPECIAL\ta-z._$|\tevery char is written using 5 bits, a-z: 0b00000~0b11001, ._$|: 0b11010~0b11101, prepend one bit at the start to indicate whether strip last char since last byte may have 7 redundant bits(1 indicates strip last char) LOWER_UPPER_DIGIT_SPECIAL\ta-zA-Z0~9._\tevery char is written using 6 bits, a-z: 0b00000~0b11001, A-Z: 0b11010~0b110011, 0~9: 0b110100~0b111101, ._: 0b111110~0b111111, prepend one bit at the start to indicate whether strip last char since last byte may have 7 redundant bits(1 indicates strip last char) UTF-8\tany chars\tUTF-8 encoding  Encoding flags:  Encoding Flag\tPattern\tEncoding AlgorithmLOWER_SPECIAL\tevery char is in a-z._|\tLOWER_SPECIAL FIRST_TO_LOWER_SPECIAL\tevery char is in a-z._ except first char is upper case\treplace first upper case char to lower case, then use LOWER_SPECIAL ALL_TO_LOWER_SPECIAL\tevery char is in a-zA-Z._\treplace every upper case char by | + lower case, then use LOWER_SPECIAL, use this encoding if it's smaller than Encoding LOWER_UPPER_DIGIT_SPECIAL LOWER_UPPER_DIGIT_SPECIAL\tevery char is in a-zA-Z._\tuse LOWER_UPPER_DIGIT_SPECIAL encoding if it's smaller than Encoding FIRST_TO_LOWER_SPECIAL UTF8\tany utf-8 char\tuse UTF-8 encoding Compression\tany utf-8 char\tlossless compression  Notes:  Depending on cases, one can choose encoding flags + data jointly, uses 3 bits of first byte for flags and other bytes for data.  ","version":"0.11","tagName":"h3"},{"title":"Value Format‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#value-format","content":" ","version":"0.11","tagName":"h2"},{"title":"Basic types‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#basic-types","content":" bool‚Äã  size: 1 byteformat: 0 for false, 1 for true  int8‚Äã  size: 1 byteformat: write as pure byte.  int16‚Äã  size: 2 bytebyte order: raw bytes of little endian order  unsigned int32‚Äã  size: 4 bytebyte order: raw bytes of little endian order  unsigned varint32‚Äã  size: 1~5 byteFormat: The most significant bit (MSB) in every byte indicates whether to have the next byte. If first bit is set i.e. b &amp; 0x80 == 0x80, then the next byte should be read until the first bit of the next byte is unset.  signed int32‚Äã  size: 4 bytebyte order: raw bytes of little endian order  signed varint32‚Äã  size: 1~5 byteFormat: First convert the number into positive unsigned int by (v &lt;&lt; 1) ^ (v &gt;&gt; 31) ZigZag algorithm, then encode it as an unsigned varint.  unsigned int64‚Äã  size: 8 bytebyte order: raw bytes of little endian order  unsigned varint64‚Äã  size: 1~9 byteFory SLI(Small long as int) Encoding: If long is in [0, 2147483647], encode as 4 bytes int: | little-endian: ((int) value) &lt;&lt; 1 |Otherwise write as 9 bytes: | 0b1 | little-endian 8 bytes long | Fory PVL(Progressive Variable-length Long) Encoding: positive long format: first bit in every byte indicates whether to have the next byte. If first bit is set i.e. b &amp; 0x80 == 0x80, then the next byte should be read until the first bit is unset.  signed int64‚Äã  size: 8 bytebyte order: raw bytes of little endian order  signed varint64‚Äã  size: 1~9 byteFory SLI(Small long as int) Encoding: If long is in [-1073741824, 1073741823], encode as 4 bytes int: | little-endian: ((int) value) &lt;&lt; 1 |Otherwise write as 9 bytes: | 0b1 | little-endian 8 bytes long | Fory PVL(Progressive Variable-length Long) Encoding: First convert the number into positive unsigned long by (v &lt;&lt; 1) ^ (v &gt;&gt; 63) ZigZag algorithm to reduce cost of small negative numbers, then encoding it as an unsigned long.  float32‚Äã  size: 4 byteformat: encode the specified floating-point value according to the IEEE 754 floating-point &quot;single format&quot; bit layout, preserving Not-a-Number (NaN) values, then write as binary by little endian order.  float64‚Äã  size: 8 byteformat: encode the specified floating-point value according to the IEEE 754 floating-point &quot;double format&quot; bit layout, preserving Not-a-Number (NaN) values. then write as binary by little endian order.  ","version":"0.11","tagName":"h3"},{"title":"string‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#string","content":" Format:  | unsigned varint64: size &lt;&lt; 2 `bitor` 2 bits encoding flags | binary data |   size + encoding will be concat as a long and encoded as an unsigned varint64. The little 2 bits is used for encoding: 0 for latin1(ISO-8859-1), 1 for utf-16, 2 for utf-8.encoded string binary data based on encoding: latin/utf-16/utf-8.  Which encoding to choose:  For JDK8: fory detect latin at runtime, if string is latin string, then use latin encoding, otherwise use utf-16.For JDK9+: fory use coder in String object for encoding, latin/utf-16 will be used for encoding.If the string is encoded by utf-8, then fory will use utf-8 to decode the data. Cross-language string serialization of fory uses utf-8 by default.  ","version":"0.11","tagName":"h3"},{"title":"list‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#list","content":" Format:  | unsigned varint64: length | 1 byte elements header | elements data |   elements header‚Äã  In most cases, all elements are same type and not null, elements header will encode those homogeneous information to avoid the cost of writing it for every element. Specifically, there are four kinds of information which will be encoded by elements header, each use one bit:  If track elements ref, use the first bit 0b1 of the header to flag it.If the elements have null, use the second bit 0b10 of the header to flag it. If ref tracking is enabled for this element type, this flag is invalid.If the element types are not the declared type, use the 3rd bit 0b100 of the header to flag it.If the element types are different, use the 4rd bit 0b1000 header to flag it.  By default, all bits are unset, which means all elements won't track ref, all elements are same type, not null and the actual element is the declared type in the custom type field.  The implementation can generate different deserialization code based read header, and look up the generated code from a linear map/list.  elements data‚Äã  Based on the elements header, the serialization of elements data may skip ref flag/null flag/element type info.  fory = ... buffer = ... elems = ... if element_type_is_same: if not is_declared_type: fory.write_type(buffer, elem_type) elem_serializer = get_serializer(...) if track_ref: for elem in elems: if not ref_resolver.write_ref_or_null(buffer, elem): elem_serializer.write(buffer, elem) elif has_null: for elem in elems: if elem is None: buffer.write_byte(null_flag) else: buffer.write_byte(not_null_flag) elem_serializer.write(buffer, elem) else: for elem in elems: elem_serializer.write(buffer, elem) else: if track_ref: for elem in elems: fory.write_ref(buffer, elem) elif has_null: for elem in elems: fory.write_nullable(buffer, elem) else: for elem in elems: fory.write_value(buffer, elem)   CollectionSerializer#writeElementscan be taken as an example.  ","version":"0.11","tagName":"h3"},{"title":"array‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#array","content":" primitive array‚Äã  Primitive array are taken as a binary buffer, serialization will just write the length of array size as an unsigned int, then copy the whole buffer into the stream.  Such serialization won't compress the array. If users want to compress primitive array, users need to register custom serializers for such types or mark it as list type.  Tensor‚Äã  Tensor is a special primitive multi-dimensional array which all dimensions have same size and type. The serialization format is:  | num_dims(unsigned varint) | shape[0](unsigned varint) | shape[...] | shape[N] | element type | data |   The data is continuous to reduce copy and may zero-copy in some cases.  object array‚Äã  Object array is serialized using the list format. Object component type will be taken as list element generic type.  ","version":"0.11","tagName":"h3"},{"title":"map‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#map","content":" Map uses a chunk by chunk based Format:  | length(unsigned varint) | key value chunk data | ... | key value chunk data |   map key-value chunk data‚Äã  Map iteration is too expensive, Fory won't compute the header like for list since it introduceconsiderable overhead. Users can use MapFieldInfo annotation to provide the header in advance. Otherwise Fory will use first key-value pair to predict header optimistically, and update the chunk header if the prediction failed at some pair.  Fory will serialize the map chunk by chunk, every chunk has 255 pairs at most.  | 1 byte | 1 byte | variable bytes | +----------------+----------------+-----------------+ | KV header | chunk size: N | N*2 objects |   KV header:  If track key ref, use the first bit 0b1 of the header to flag it.If the key has null, use the second bit 0b10 of the header to flag it. If ref tracking is enabled for this key type, this flag is invalid.If the actual key type of map is not the declared key type, use the 3rd bit 0b100 of the header to flag it.If track value ref, use the 4th bit 0b1000 of the header to flag it.If the value has null, use the 5th bit 0b10000 of the header to flag it. If ref tracking is enabled for this value type, this flag is invalid.If the value type of map is not the declared value type, use the 6rd bit 0b100000 of the header to flag it.If key or value is null, that key and value will be written as a separate chunk, and chunk size writing will be skipped too.  If streaming write is enabled, which means Fory can't update written chunk size. In such cases, map key-value data format will be:  | 1 byte | variable bytes | +----------------+-----------------+ | KV header | N*2 objects |   KV header will be a header marked by MapFieldInfo in java. For languages such as golang, this can be computed in advance for non-interface types most times. The implementation can generate different deserialization code based read header, and look up the generated code from a linear map/list.  Why serialize chunk by chunk?‚Äã  When fory will use first key-value pair to predict header optimistically, it can't know how many pairs have same meta(tracking kef ref, key has null and so on). If we don't write chunk by chunk with max chunk size, we must write at least X bytes to take up a place for later to update the number which has same elements, X is the num_bytes for encoding varint encoding of map size.  And most map size are smaller than 255, if all pairs have same data, the chunk will be 1. This is common in golang/rust, which object are not reference by default.  Also, if only one or two keys have different meta, we can make it into a different chunk, so that most pairs can share meta.  The implementation can accumulate read count with map size to decide whether to read more chunks.  ","version":"0.11","tagName":"h3"},{"title":"enum‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#enum","content":" Enums are serialized as an unsigned var int. If the order of enum values change, the deserialized enum value may not be the value users expect. In such cases, users must register enum serializer by make it write enum value as an enumerated string with unique hash disabled.  ","version":"0.11","tagName":"h3"},{"title":"decimal‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#decimal","content":" Not supported for now.  ","version":"0.11","tagName":"h3"},{"title":"struct‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#struct","content":" Struct means object of class/pojo/struct/bean/record type. Struct will be serialized by writing its fields data in fory order.  Depending on schema compatibility, structs will have different formats.  field order‚Äã  Field will be ordered as following, every group of fields will have its own order:  primitive fields: larger size type first, smaller later, variable size type last.when same size, sort by type idwhen same size and type id, sort by snake case field nametypes: bool/int8/int16/int32/varint32/int64/varint64/sliint64/float16/float32/float64 nullable primitive fields: same order as primitive fieldsmorphic fields: same type together, then sorted by field name lexicographically using snake case style.unknown fields: same sort algorithms as morphic fieldslist fields: same sort algorithms as morphic fieldsset fields: same sort algorithms as morphic fieldsmap fields: same sort algorithms as morphic fields  Field order‚Äã  Fields in a struct are sorted in a ascending order by:  primitive fields first: bool/int8/int16/int32/varint32/int64/varint64/sliint64/float16/float32/float64, sorted by type id.nullable primitive fieldsmorphic types except list/set/mapunknown typeslist typesset typesmap types  If two fields have same type, then sort by snake_case styled field name.  schema consistent‚Äã  Object will be written as:  | 4 byte | variable bytes | +---------------+------------------+ | type hash | field values |   Type hash is used to check the type schema consistency across languages. Type hash will be the first 32 bits of 56 bits value of the type meta.  Object fields will be serialized one by one using following format:  not null primitive field value: | var bytes | +----------------+ | value data | +----------------+ nullable primitive field value: | one byte | var bytes | +-----------+---------------+ | null flag | field value | +-----------+---------------+ field value of final type with ref tracking: | var bytes | var objects | +-----------+-------------+ | ref meta | value data | +-----------+-------------+ field value of final type without ref tracking: | one byte | var objects | +-----------+-------------+ | null flag | field value | +-----------+-------------+ field value of non-final type with ref tracking: | one byte | var bytes | var objects | +-----------+-------------+-------------+ | ref meta | type meta | value data | +-----------+-------------+-------------+ field value of non-final type without ref tracking: | one byte | var bytes | var objects | +-----------+------------+------------+ | null flag | type meta | value data | +-----------+------------+------------+   Schema evolution‚Äã  Schema evolution have similar format as schema consistent mode for object except:  For the object type, schema consistent mode will write type by id only, but schema evolution mode will write type consisting of field names, types and other meta too, see Type meta.Type meta of final custom type needs to be written too, because peers may not have this type defined.  ","version":"0.11","tagName":"h3"},{"title":"Type‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#type","content":" Type will be serialized using type meta format.  ","version":"0.11","tagName":"h3"},{"title":"Implementation guidelines‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#implementation-guidelines","content":" ","version":"0.11","tagName":"h2"},{"title":"How to reduce memory read/write code‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#how-to-reduce-memory-readwrite-code","content":" Try to merge multiple bytes into an int/long write before writing to reduce memory IO and bound check cost.Read multiple bytes as an int/long, then split into multiple bytes to reduce memory IO and bound check cost.Try to use one varint/long to write flags and length together to save one byte cost and reduce memory io.Condition branches are less expensive compared to memory IO cost unless there are too many branches.  ","version":"0.11","tagName":"h3"},{"title":"Fast deserialization for static languages without runtime codegen support‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.11/specification/xlang_serialization_spec#fast-deserialization-for-static-languages-without-runtime-codegen-support","content":" For type evolution, the serializer will encode the type meta into the serialized data. The deserializer will compare this meta with class meta in the current process, and use the diff to determine how to deserialize the data.  For java/javascript/python, we can use the diff to generate serializer code at runtime and load it as class/function for deserialization. In this way, the type evolution will be as fast as type consist mode.  For C++/Rust, we can't generate the serializer code at runtime. So we need to generate the code at compile-time using meta programming. But at that time, we don't know the type schema in other processes, so we can't generate the serializer code for such inconsistent types. We may need to generate the code which has a loop and compare field name one by one to decide whether to deserialize and assign the field or skip the field value.  One fast way is that we can optimize the string comparison into jump instructions:  Assume the current type has n fields, and the peer type has n1 fields.Generate an auto growing field id from 0 for every sorted field in the current type at the compile time.Compare the received type meta with current type, generate same id if the field name is same, otherwise generate an auto growing id starting from n, cache this meta at runtime.Iterate the fields of received type meta, use a switch to compare the field id to deserialize data and assign/skip field value. Continuous field id will be optimized into jump in switch block, so it will very fast.  Here is an example, suppose process A has a class Foo with version 1 defined as Foo1, process B has a class Foowith version 2 defined as Foo2:  // class Foo with version 1 class Foo1 { int32_t v1; // id 0 std::string v2; // id 1 }; // class Foo with version 2 class Foo2 { // id 0, but will have id 2 in process A bool v0; // id 1, but will have id 0 in process A int32_t v1; // id 2, but will have id 3 in process A int64_t long_value; // id 3, but will have id 1 in process A std::string v2; // id 4, but will have id 4 in process A std::vector&lt;std::string&gt; list; };   When process A received serialized Foo2 from process B, here is how it deserialize the data:  Foo1 foo1 = ...; const std::vector&lt;fory::FieldInfo&gt; &amp;field_infos = type_meta.field_infos; for (const auto &amp;field_info : field_infos) { switch (field_info.field_id) { case 0: foo1.v1 = buffer.read_varint32(); break; case 1: foo1.v2 = fory.read_string(); break; default: fory.skip_data(field_info); } }  ","version":"0.11","tagName":"h3"},{"title":"Community","type":0,"sectionRef":"#","url":"/docs/0.12/community/","content":"","keywords":"","version":"0.12"},{"title":"Mailing list‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.12/community/#mailing-list","content":" Name\tDesc\tSubscribe\tUnsubscribe\tPost\tArchivedev@fory.apache.org\tDevelopment related discussions\tSubscribe\tUnsubscribe\tPost\tArchive commits@fory.apache.org\tAll commits to our repositories\tSubscribe\tUnsubscribe\tRead only list\tArchive  Please make sure subscribe to any list before attempting to post.  If you are not subscribed to the mailing list, your message will either be rejected or you won't receive the response.  ","version":"0.12","tagName":"h2"},{"title":"How to subscribe to a mailing list‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.12/community/#how-to-subscribe-to-a-mailing-list","content":" To post messages, subscribe first by:  Sending an email to listname-subscribe@fory.apache.org with listname replaced accordingly.Replying to the confirmation email you'll receive, keeping the subject line intact.You'll then get a welcome email, and the subscription succeeds.  When discussing code snippets in emails, ensure:  You do not link to files in external services, as such files can change, get deleted or the link might break and thus make an archived email thread useless.You paste text instead of screenshots of text.You keep formatting when pasting code in order to keep the code readable.There are enough import statements to avoid ambiguities.  ","version":"0.12","tagName":"h3"},{"title":"Slack‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.12/community/#slack","content":" You can join the Apache Fory‚Ñ¢ community on Slack.  There are a couple of community rules:  Be respectful and nice.All important decisions and conclusions must be reflected back to the mailing lists. &quot;If it didn't happen on a mailing list, it didn't happen.&quot; - The Apache Mottos.Use Slack threads to keep parallel conversations from overwhelming a channel.Please do not direct message people for troubleshooting, issue assigning and PR review. These should be picked-up voluntarily.  ","version":"0.12","tagName":"h2"},{"title":"Issue tracker‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.12/community/#issue-tracker","content":" We use GitHub Issues to track all issues:  code related issues: https://github.com/apache/fory/issueswebsite related issues: https://github.com/apache/fory-site/issues  You need to have a GitHub account in order to create issues. If you don't have a GitHub account, you can post an email to dev@fory.apache.org.  ","version":"0.12","tagName":"h2"},{"title":"Bug reports‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.12/community/#bug-reports","content":" To report a bug:  Verify that the bug does in fact exist.Search the issue tracker to verify there is no existing issue reporting the bug you've found.Create a bug report on issue tracker.If possible, dive into the source code of fory, and submit a patch for the bug you reported, this helps ensure the bug will be fixed quickly.  ","version":"0.12","tagName":"h3"},{"title":"Reporting a Vulnerability‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.12/community/#reporting-a-vulnerability","content":" Apache Fory‚Ñ¢ is a project of the Apache Software Foundation and follows the ASF vulnerability handling process.  To report a new vulnerability you have discovered please follow the ASF vulnerability reporting process, which explains how to send us details privately.  ","version":"0.12","tagName":"h3"},{"title":"Enhancement‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.12/community/#enhancement","content":" Enhancements or new feature proposals are also welcome. The more concrete and rationale the proposal is, the greater the chance it will be incorporated into future releases.  ","version":"0.12","tagName":"h3"},{"title":"Source code‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.12/community/#source-code","content":" fory core repository: https://github.com/apache/foryfory website repository: https://github.com/apache/fory-site ","version":"0.12","tagName":"h2"},{"title":"Usage","type":0,"sectionRef":"#","url":"/docs/0.11/start/usage","content":"","keywords":"","version":"0.11"},{"title":"Java Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.11/start/usage#java-serialization","content":" import java.util.List; import java.util.Arrays; import org.apache.fory.*; public class Example { public static void main(String[] args) { SomeClass object = new SomeClass(); // Note that Fory instances should be reused between // multiple serializations of different objects. Fory fory = Fory.builder().withLanguage(Language.JAVA) // Allow to deserialize objects unknown types, // more flexible but less secure. // .requireClassRegistration(false) .build(); // Registering types can reduce class name serialization overhead, but not mandatory. // If secure mode enabled, all custom types must be registered. fory.register(SomeClass.class); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes)); } }   ","version":"0.11","tagName":"h2"},{"title":"Scala Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.11/start/usage#scala-serialization","content":" import org.apache.fory.Fory import org.apache.fory.serializer.scala.ScalaSerializers case class Person(name: String, id: Long, github: String) case class Point(x : Int, y : Int, z : Int) object ScalaExample { val fory: Fory = Fory.builder().withScalaOptimizationEnabled(true).build() // Register optimized fory serializers for scala ScalaSerializers.registerSerializers(fory) fory.register(classOf[Person]) fory.register(classOf[Point]) def main(args: Array[String]): Unit = { val p = Person(&quot;Shawn Yang&quot;, 1, &quot;https://github.com/chaokunyang&quot;) println(fory.deserialize(fory.serialize(p))) println(fory.deserialize(fory.serialize(Point(1, 2, 3)))) } }   ","version":"0.11","tagName":"h2"},{"title":"Kotlin Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.11/start/usage#kotlin-serialization","content":" import org.apache.fory.Fory import org.apache.fory.ThreadSafeFory import org.apache.fory.serializer.kotlin.KotlinSerializers data class Person(val name: String, val id: Long, val github: String) data class Point(val x : Int, val y : Int, val z : Int) fun main(args: Array&lt;String&gt;) { // Note: following fory init code should be executed only once in a global scope instead // of initializing it everytime when serialization. val fory: ThreadSafeFory = Fory.builder().requireClassRegistration(true).buildThreadSafeFory() KotlinSerializers.registerSerializers(fory) fory.register(Person::class.java) fory.register(Point::class.java) val p = Person(&quot;Shawn Yang&quot;, 1, &quot;https://github.com/chaokunyang&quot;) println(fory.deserialize(fory.serialize(p))) println(fory.deserialize(fory.serialize(Point(1, 2, 3)))) }   ","version":"0.11","tagName":"h2"},{"title":"CrossLanguage Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.11/start/usage#crosslanguage-serialization","content":" ","version":"0.11","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.11/start/usage#java","content":" import com.google.common.collect.ImmutableMap; import org.apache.fory.*; import java.util.Map; public class ReferenceExample { public static class SomeClass { SomeClass f1; Map&lt;String, String&gt; f2; Map&lt;String, String&gt; f3; } public static Object createObject() { SomeClass obj = new SomeClass(); obj.f1 = obj; obj.f2 = ImmutableMap.of(&quot;k1&quot;, &quot;v1&quot;, &quot;k2&quot;, &quot;v2&quot;); obj.f3 = obj.f2; return obj; } // mvn exec:java -Dexec.mainClass=&quot;io.fory.examples.ReferenceExample&quot; public static void main(String[] args) { Fory fory = Fory.builder().withLanguage(Language.XLANG) .withRefTracking(true).build(); fory.register(SomeClass.class, &quot;example.SomeClass&quot;); byte[] bytes = fory.serialize(createObject()); // bytes can be data serialized by other languages. System.out.println(fory.deserialize(bytes)); ; } }   ","version":"0.11","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.11/start/usage#python","content":" from typing import Dict import pyfory class SomeClass: f1: &quot;SomeClass&quot; f2: Dict[str, str] f3: Dict[str, str] fory = pyfory.Fory(ref_tracking=True) fory.register_class(SomeClass, &quot;example.SomeClass&quot;) obj = SomeClass() obj.f2 = {&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: &quot;v2&quot;} obj.f1, obj.f3 = obj, obj.f2 data = fory.serialize(obj) # bytes can be data serialized by other languages. print(fory.deserialize(data))   ","version":"0.11","tagName":"h3"},{"title":"Golang‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.11/start/usage#golang","content":" package main import ( &quot;fmt&quot; forygo &quot;github.com/apache/fory/go/fory&quot; ) func main() { type SomeClass struct { F1 *SomeClass F2 map[string]string F3 map[string]string } fory := forygo.NewFory(true) if err := fory.RegisterTagType(&quot;example.SomeClass&quot;, SomeClass{}); err != nil { panic(err) } value := &amp;SomeClass{F2: map[string]string{&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: &quot;v2&quot;}} value.F3 = value.F2 value.F1 = value bytes, err := fory.Marshal(value) if err != nil { } var newValue interface{} // bytes can be data serialized by other languages. if err := fory.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) }   ","version":"0.11","tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.11/start/usage#javascript","content":" import Fory, { Type } from &quot;@apache-fory/fory&quot;; /** * @apache-fory/hps use v8's fast-calls-api that can be called directly by jit, ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from &quot;@apache-fory/hps&quot;; // Now we describe data structures using JSON, but in the future, we will use more ways. const description = Type.object(&quot;example.foo&quot;, { foo: Type.string(), }); const fory = new Fory({ hps }); const { serialize, deserialize } = fory.registerSerializer(description); const input = serialize({ foo: &quot;hello fory&quot; }); const result = deserialize(input); console.log(result);   ","version":"0.11","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.11/start/usage#rust","content":" use fory::{from_buffer, to_buffer, Fory}; #[derive(Fory, Debug, PartialEq)] #[tag(&quot;example.foo&quot;)] struct Animal { name: String, category: String, } #[derive(Fory, Debug, PartialEq)] #[tag(&quot;example.bar&quot;)] struct Person { name: String, age: u32, pets: Vec&lt;Animal&gt;, } fn main() { let penson = Person { name: &quot;hello&quot;.to_string(), age: 12, pets: vec![ Animal { name: &quot;world1&quot;.to_string(), category: &quot;cat&quot;.to_string(), }, Animal { name: &quot;world2&quot;.to_string(), category: &quot;dog&quot;.to_string(), }, ], }; let bin = to_buffer(&amp;penson); let obj: Person = from_buffer(&amp;bin).expect(&quot;should success&quot;); assert_eq!(obj, penson); }  ","version":"0.11","tagName":"h3"},{"title":"How to join Apache Fory‚Ñ¢","type":0,"sectionRef":"#","url":"/docs/0.12/community/how_to_join_community","content":"","keywords":"","version":"0.12"},{"title":"Fory Contribution Guide‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.12/community/how_to_join_community#fory-contribution-guide","content":" The Fory team usually conducts development and issue maintenance on GitHub. Please open the GitHub website, click the Sign up button in the upper right corner, register your own account, and take the first step of your open source journey.  In the Fory repository, we have a guide for all open source contributors, introducing contents such as version management and branch management. Please take a few minutes to read and understand it.  ","version":"0.12","tagName":"h2"},{"title":"Your First Pull Request‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.12/community/how_to_join_community#your-first-pull-request","content":" ","version":"0.12","tagName":"h2"},{"title":"Step 0: Install Git‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.12/community/how_to_join_community#step-0-install-git","content":" Git is a version control system used to track and manage code changes in software development projects. It helps developers record and manage the history of the code, facilitating team collaboration, code version control, code merging, and other operations. With Git, you can track each version of each file and easily switch and compare between different versions. Git also provides branch management functionality, allowing multiple concurrent development tasks to be carried out simultaneously.  Visit the official Git website: [https://git-scm.com/] (https://git-scm.com/)Download the latest version of the Git installer.Run the downloaded installer and follow the prompts of the installation wizard to install.After the installation is complete, you can use the git version command in the command line to confirm the successful installation.  ","version":"0.12","tagName":"h3"},{"title":"Step 1: Fork the Project‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.12/community/how_to_join_community#step-1-fork-the-project","content":" First, you need to fork this project. Enter the Fory project page, and click the Fork button in the upper right corner.In your GitHub account, the project xxxx (your GitHub username)/fory will appear.On your local computer, use the following commands to obtain a fory folder:  // ssh git clone git@github.com:xxxx (your GitHub username)/fory.git // https git clone https://github.com/xxxx (your GitHub username)/fory.git   ","version":"0.12","tagName":"h3"},{"title":"Step 2: Obtain the Project Code‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.12/community/how_to_join_community#step-2-obtain-the-project-code","content":" Enter the fory folder and add the remote address of fory:  git remote add upstream https://github.com/apache/fory.git   ","version":"0.12","tagName":"h3"},{"title":"Step 3: Create a Branch‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.12/community/how_to_join_community#step-3-create-a-branch","content":" Alright, now you can start contributing our code. The default branch of Fory is the main branch. Whether it is for function development, bug fixes, or documentation writing, please create a new branch and then merge it to the main branch. Use the following code to create a branch:  // Create a function development branch git checkout -b feat/xxxx // Create a problem-fixing development branch git checkout -b fix/xxxx // Create a documentation, demo branch git checkout -b docs/add-java-demo   Suppose we have created the documentation modification branch docs/add-java-demo and we have added some code and submitted it to the code repository.  git add .git commit -a -m &quot;docs: add java demo and related docs&quot;  ","version":"0.12","tagName":"h3"},{"title":"Step 4: Merge the Modifications‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.12/community/how_to_join_community#step-4-merge-the-modifications","content":" Switch back to your development branch:  git checkout docs/add-java-demo   Submit the updated code to your branch:  git push origin docs/add-java-demo   ","version":"0.12","tagName":"h3"},{"title":"Step 5: Submit a Pull Request‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.12/community/how_to_join_community#step-5-submit-a-pull-request","content":" You can click the Compare &amp; pull request button on your GitHub code repository page. Or create it through the contribute button.  Fill in what type of modification this is.Fill in the associated issue.If there are complex changes, please explain the background and solution.  After filling in the relevant information, click Create pull request to submit.  ","version":"0.12","tagName":"h3"},{"title":"Easily Step into the Fory Open Source Contribution Journey‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.12/community/how_to_join_community#easily-step-into-the-fory-open-source-contribution-journey","content":" &quot;good first issue&quot; is a common label in the open source community, and the purpose of this label is to help new contributors find entry-level issues that are suitable for them.  The entry-level issues of Fory can be viewed through the issue list.  If you currently have the time and willingness to participate in community contributions, you can take a look at good first issue in the issues and select one that interests you and is suitable for you to claim.  ","version":"0.12","tagName":"h2"},{"title":"Embrace the Apache Fory Community‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.12/community/how_to_join_community#embrace-the-apache-fory-community","content":" While you contribute code to Fory, we encourage you to participate in other things that make the community more prosperous, such as:  Offer suggestions for the project's development, functional planning, etc.Create articles, videos, and hold lectures to promote Fory.Write promotion plans and execute them together with the team. ","version":"0.12","tagName":"h2"},{"title":"Java Serialization","type":0,"sectionRef":"#","url":"/docs/0.11/guide/serialization","content":"","keywords":"","version":"0.11"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.11/guide/serialization#quick-start","content":" Note that fory creation is not cheap, the fory instances should be reused between serializations instead of creating it everytime. You should keep fory to a static global variable, or instance variable of some singleton object or limited objects.  Fory for single-thread usage:  import java.util.List; import java.util.Arrays; import org.apache.fory.*; import org.apache.fory.config.*; public class Example { public static void main(String[] args) { SomeClass object = new SomeClass(); // Note that Fory instances should be reused between // multiple serializations of different objects. Fory fory = Fory.builder().withLanguage(Language.JAVA) .requireClassRegistration(true) .build(); // Registering types can reduce class name serialization overhead, but not mandatory. // If class registration enabled, all custom types must be registered. fory.register(SomeClass.class); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes)); } }   Fory for multiple-thread usage:  import java.util.List; import java.util.Arrays; import org.apache.fory.*; import org.apache.fory.config.*; public class Example { public static void main(String[] args) { SomeClass object = new SomeClass(); // Note that Fory instances should be reused between // multiple serializations of different objects. ThreadSafeFory fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().withLanguage(Language.JAVA) .withClassLoader(classLoader).build(); f.register(SomeClass.class); return f; }); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes)); } }   Fory instances reuse example:  import java.util.List; import java.util.Arrays; import org.apache.fory.*; import org.apache.fory.config.*; public class Example { // reuse fory. private static final ThreadSafeFory fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().withLanguage(Language.JAVA) .withClassLoader(classLoader).build(); f.register(SomeClass.class); return f; }); public static void main(String[] args) { SomeClass object = new SomeClass(); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes)); } }   ","version":"0.11","tagName":"h2"},{"title":"ForyBuilder options‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.11/guide/serialization#forybuilder-options","content":" Option Name\tDescription\tDefault ValuetimeRefIgnored\tWhether to ignore reference tracking of all time types registered in TimeSerializers and subclasses of those types when ref tracking is enabled. If ignored, ref tracking of every time type can be enabled by invoking Fory#registerSerializer(Class, Serializer). For example, fory.registerSerializer(Date.class, new DateSerializer(fory, true)). Note that enabling ref tracking should happen before serializer codegen of any types which contain time fields. Otherwise, those fields will still skip ref tracking.\ttrue compressInt\tEnables or disables int compression for smaller size.\ttrue compressLong\tEnables or disables long compression for smaller size.\ttrue compressString\tEnables or disables string compression for smaller size.\tfalse classLoader\tThe classloader should not be updated; Fory caches class metadata. Use LoaderBinding or ThreadSafeFory for classloader updates.\tThread.currentThread().getContextClassLoader() compatibleMode\tType forward/backward compatibility config. Also Related to checkClassVersion config. SCHEMA_CONSISTENT: Class schema must be consistent between serialization peer and deserialization peer. COMPATIBLE: Class schema can be different between serialization peer and deserialization peer. They can add/delete fields independently. See more.\tCompatibleMode.SCHEMA_CONSISTENT checkClassVersion\tDetermines whether to check the consistency of the class schema. If enabled, Fory checks, writes, and checks consistency using the classVersionHash. It will be automatically disabled when CompatibleMode#COMPATIBLE is enabled. Disabling is not recommended unless you can ensure the class won't evolve.\tfalse checkJdkClassSerializable\tEnables or disables checking of Serializable interface for classes under java.*. If a class under java.* is not Serializable, Fory will throw an UnsupportedOperationException.\ttrue registerGuavaTypes\tWhether to pre-register Guava types such as RegularImmutableMap/RegularImmutableList. These types are not public API, but seem pretty stable.\ttrue requireClassRegistration\tDisabling may allow unknown classes to be deserialized, potentially causing security risks.\ttrue suppressClassRegistrationWarnings\tWhether to suppress class registration warnings. The warnings can be used for security audit, but may be annoying, this suppression will be enabled by default.\ttrue metaShareEnabled\tEnables or disables meta share mode.\ttrue if CompatibleMode.Compatible is set, otherwise false. scopedMetaShareEnabled\tScoped meta share focuses on a single serialization process. Metadata created or identified during this process is exclusive to it and is not shared with by other serializations.\ttrue if CompatibleMode.Compatible is set, otherwise false. metaCompressor\tSet a compressor for meta compression. Note that the passed MetaCompressor should be thread-safe. By default, a Deflater based compressor DeflaterMetaCompressor will be used. Users can pass other compressor such as zstd for better compression rate.\tDeflaterMetaCompressor deserializeNonexistentClass\tEnables or disables deserialization/skipping of data for non-existent classes.\ttrue if CompatibleMode.Compatible is set, otherwise false. codeGenEnabled\tDisabling may result in faster initial serialization but slower subsequent serializations.\ttrue asyncCompilationEnabled\tIf enabled, serialization uses interpreter mode first and switches to JIT serialization after async serializer JIT for a class is finished.\tfalse scalaOptimizationEnabled\tEnables or disables Scala-specific serialization optimization.\tfalse copyRef\tWhen disabled, the copy performance will be better. But fory deep copy will ignore circular and shared reference. Same reference of an object graph will be copied into different objects in one Fory#copy.\ttrue serializeEnumByName\tWhen Enabled, fory serialize enum by name instead of ordinal.\tfalse  ","version":"0.11","tagName":"h2"},{"title":"Advanced Usage‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.11/guide/serialization#advanced-usage","content":" ","version":"0.11","tagName":"h2"},{"title":"Apache Fory‚Ñ¢ creation‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.11/guide/serialization#apache-fory-creation","content":" Single thread fory:  Fory fory = Fory.builder() .withLanguage(Language.JAVA) // enable reference tracking for shared/circular reference. // Disable it will have better performance if no duplicate reference. .withRefTracking(false) .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT) // enable type forward/backward compatibility // disable it for small size and better performance. // .withCompatibleMode(CompatibleMode.COMPATIBLE) // enable async multi-threaded compilation. .withAsyncCompilation(true) .build(); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes));   Thread-safe fory:  ThreadSafeFory fory = Fory.builder() .withLanguage(Language.JAVA) // enable reference tracking for shared/circular reference. // Disable it will have better performance if no duplicate reference. .withRefTracking(false) // compress int for smaller size // .withIntCompressed(true) // compress long for smaller size // .withLongCompressed(true) .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT) // enable type forward/backward compatibility // disable it for small size and better performance. // .withCompatibleMode(CompatibleMode.COMPATIBLE) // enable async multi-threaded compilation. .withAsyncCompilation(true) .buildThreadSafeFory(); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes));   ","version":"0.11","tagName":"h3"},{"title":"Handling Class Schema Evolution in Serialization‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.11/guide/serialization#handling-class-schema-evolution-in-serialization","content":" In many systems, the schema of a class used for serialization may change over time. For instance, fields within a class may be added or removed. When serialization and deserialization processes use different versions of jars, the schema of the class being deserialized may differ from the one used during serialization.  By default, Fory serializes objects using the CompatibleMode.SCHEMA_CONSISTENT mode. This mode assumes that the deserialization process uses the same class schema as the serialization process, minimizing payload overhead. However, if there is a schema inconsistency, deserialization will fail.  If the schema is expected to change, to make deserialization succeed, i.e. schema forward/backward compatibility. Users must configure Fory to use CompatibleMode.COMPATIBLE. This can be done using theForyBuilder#withCompatibleMode(CompatibleMode.COMPATIBLE) method. In this compatible mode, deserialization can handle schema changes such as missing or extra fields, allowing it to succeed even when the serialization and deserialization processes have different class schemas.  Here is an example of creating Fory to support schema evolution:  Fory fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .build(); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes));   This compatible mode involves serializing class metadata into the serialized output. Despite Fory's use of sophisticated compression techniques to minimize overhead, there is still some additional space cost associated with class metadata.  To further reduce metadata costs, Fory introduces a class metadata sharing mechanism, which allows the metadata to be sent to the deserialization process only once. For more details, please refer to the Meta Sharing specification.  ","version":"0.11","tagName":"h3"},{"title":"Compression‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.11/guide/serialization#compression","content":" ForyBuilder#withIntCompressed/ForyBuilder#withLongCompressed can be used to compress int/long for smaller size. Normally compress int is enough.  Both compression are enabled by default, if the serialized is not important, for example, you use flatbuffers for serialization before, which doesn't compress anything, then you should disable compression. If your data are all numbers, the compression may bring 80% performance regression.  For int compression, fory use 1~5 bytes for encoding. First bit in every byte indicate whether has next byte. if first bit is set, then next byte will be read util first bit of next byte is unset.  For long compression, fory support two encoding:  Fory SLI(Small long as int) Encoding (used by default): If long is in [-1073741824, 1073741823], encode as 4 bytes int: | little-endian: ((int) value) &lt;&lt; 1 |Otherwise write as 9 bytes: | 0b1 | little-endian 8bytes long | Fory PVL(Progressive Variable-length Long) Encoding: First bit in every byte indicate whether has next byte. if first bit is set, then next byte will be read util first bit of next byte is unset.Negative number will be converted to positive number by (v &lt;&lt; 1) ^ (v &gt;&gt; 63) to reduce cost of small negative numbers.  If a number are long type, it can't be represented by smaller bytes mostly, the compression won't get good enough result, not worthy compared to performance cost. Maybe you should try to disable long compression if you find it didn't bring much space savings.  ","version":"0.11","tagName":"h3"},{"title":"Object deep copy‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.11/guide/serialization#object-deep-copy","content":" Deep copy example:  Fory fory = Fory.builder().withRefCopy(true).build(); SomeClass a = xxx; SomeClass copied = fory.copy(a);   Make fory deep copy ignore circular and shared reference, this deep copy mode will ignore circular and shared reference. Same reference of an object graph will be copied into different objects in one Fory#copy.  Fory fory = Fory.builder().withRefCopy(false).build(); SomeClass a = xxx; SomeClass copied = fory.copy(a);   ","version":"0.11","tagName":"h3"},{"title":"Implement a customized serializer‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.11/guide/serialization#implement-a-customized-serializer","content":" In some cases, you may want to implement a serializer for your type, especially some class customize serialization by JDK writeObject/writeReplace/readObject/readResolve, which is very inefficient. For example, if you don't want following Foo#writeObject got invoked, you can take following FooSerializer as an example:  class Foo { public long f1; private void writeObject(ObjectOutputStream s) throws IOException { System.out.println(f1); s.defaultWriteObject(); } } class FooSerializer extends Serializer&lt;Foo&gt; { public FooSerializer(Fory fory) { super(fory, Foo.class); } @Override public void write(MemoryBuffer buffer, Foo value) { buffer.writeInt64(value.f1); } @Override public Foo read(MemoryBuffer buffer) { Foo foo = new Foo(); foo.f1 = buffer.readInt64(); return foo; } }   Register serializer:  Fory fory = getFory(); fory.registerSerializer(Foo.class, new FooSerializer(fory));   ","version":"0.11","tagName":"h3"},{"title":"Implement Collection Serializer‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.11/guide/serialization#implement-collection-serializer","content":" Similar to maps, when implementing a serializer for a custom Collection type, you must extend CollectionSerializer or AbstractCollectionSerializer. The key difference between these two is that AbstractCollectionSerializer can serialize a class which has a collection-like structure but is not a java Collection subtype.  For collection serializer, this is a special parameter supportCodegenHook needs be configured:  When true: Enables optimized access to collection elements and JIT compilation for better performanceDirect serialization invocation and inline for map key-value items without dynamic serializer dispatch cost.Better performance for standard collection typesRecommended for most collections When false: Uses interfaced-based element access and dynamic serializer dispatch for elements, which have higer costMore flexible for custom collection typesRequired when collection has special serialization needsHandles complex collection implementations  Implement Collection Serializer with JIT support‚Äã  When implementing a Collection serializer with JIT support, you can leverage Fory's existing binary format and collection serialization infrastructure. The key is to properly implement the onCollectionWrite and newCollection methods to handle metadata while letting Fory handle the element serialization.  Here's an example:  public class CustomCollectionSerializer&lt;T extends Collection&gt; extends CollectionSerializer&lt;T&gt; { public CustomCollectionSerializer(Fory fory, Class&lt;T&gt; cls) { // supportCodegenHook controls whether to use JIT compilation super(fory, cls, true); } @Override public Collection onCollectionWrite(MemoryBuffer buffer, T value) { // Write collection size buffer.writeVarUint32Small7(value.size()); // Write any additional collection metadata return value; } @Override public Collection newCollection(MemoryBuffer buffer) { // Create new collection instance Collection collection = super.newCollection(buffer); // Read and set collection size int numElements = getAndClearNumElements(); setNumElements(numElements); return collection; } }   Note that please invoke setNumElements when implementing newCollection to let fory know how many elements to deserialize.  Implement a totally-customzied Collection Serializer without JIT‚Äã  Sometimes you need to serialize a collection type that uses primitive arrays or has special requirements. In such cases, you can implement a serializer with JIT disabled and directly override the write and read methods.  This approach:  Gives you full control over serializationWorks well with primitive arraysBypasses collection iteration overheadAllows direct memory access  Here's an example of a custom integer list backed by a primitive array:  class IntList extends AbstractCollection&lt;Integer&gt; { private final int[] elements; private final int size; public IntList(int size) { this.elements = new int[size]; this.size = size; } public IntList(int[] elements, int size) { this.elements = elements; this.size = size; } @Override public Iterator&lt;Integer&gt; iterator() { return new Iterator&lt;Integer&gt;() { private int index = 0; @Override public boolean hasNext() { return index &lt; size; } @Override public Integer next() { if (!hasNext()) { throw new NoSuchElementException(); } return elements[index++]; } }; } @Override public int size() { return size; } public int get(int index) { if (index &gt;= size) { throw new IndexOutOfBoundsException(); } return elements[index]; } public void set(int index, int value) { if (index &gt;= size) { throw new IndexOutOfBoundsException(); } elements[index] = value; } public int[] getElements() { return elements; } } class IntListSerializer extends AbstractCollectionSerializer&lt;IntList&gt; { public IntListSerializer(Fory fory) { // Disable JIT since we're handling serialization directly super(fory, IntList.class, false); } @Override public void write(MemoryBuffer buffer, IntList value) { // Write size buffer.writeVarUint32Small7(value.size()); // Write elements directly as primitive ints int[] elements = value.getElements(); for (int i = 0; i &lt; value.size(); i++) { buffer.writeVarInt32(elements[i]); } } @Override public IntList read(MemoryBuffer buffer) { // Read size int size = buffer.readVarUint32Small7(); // Create array and read elements int[] elements = new int[size]; for (int i = 0; i &lt; size; i++) { elements[i] = buffer.readVarInt32(); } return new IntList(elements, size); } // These methods are not used when JIT is disabled @Override public Collection onCollectionWrite(MemoryBuffer buffer, IntList value) { throw new UnsupportedOperationException(); } @Override public Collection newCollection(MemoryBuffer buffer) { throw new UnsupportedOperationException(); } @Override public IntList onCollectionRead(Collection collection) { throw new UnsupportedOperationException(); } }   Key Points:  Primitive Array Storage: Uses int[] for direct storageAvoids boxing/unboxing overheadProvides efficient memory layoutEnables direct array access Direct Serialization: Write size firstWrite primitive values directlyNo iteration overheadNo boxing/unboxing during serialization Direct Deserialization: Read size firstCreate primitive arrayRead values directly into arrayCreate list with populated array Disabled JIT: Set supportCodegenHook=falseOverride write/read methodsSkip collection view patternFull control over serialization format  When to Use: this approach is best when:  Working with primitive typesNeed maximum performanceWant to minimize memory overheadHave special serialization requirements  Usage Example:  // Create and populate list IntList list = new IntList(3); list.set(0, 1); list.set(1, 2); list.set(2, 3); // Serialize byte[] bytes = fory.serialize(list); // Deserialize IntList newList = (IntList) fory.deserialize(bytes);   This implementation is particularly efficient for scenarios where:  You're working exclusively with integersPerformance is criticalMemory efficiency is importantSerialization overhead needs to be minimized  Remember that while this approach gives up some of Fory's optimizations, it can provide better performance for specific use cases involving primitive types and direct array access.  Implement Serializer for Collection-like Types‚Äã  Sometimes you may want to implement a serializer for a type that behaves like a collection but isn't a standard Java Collection. This section demonstrates how to implement a serializer for such types.  The key principles for collection-like type serialization are:  Extend AbstractCollectionSerializer for custom collection-like typesEnable JIT optimization with supportCodegenHookProvide efficient element access through viewsMaintain proper size tracking  Here's an example:  class CustomCollectionLike { private final Object[] elements; private final int size; public CustomCollectionLike(int size) { this.elements = new Object[size]; this.size = size; } // Constructor for wrapping existing array public CustomCollectionLike(Object[] elements, int size) { this.elements = elements; this.size = size; } public Object get(int index) { if (index &gt;= size) { throw new IndexOutOfBoundsException(); } return elements[index]; } public int size() { return size; } public Object[] getElements() { return elements; } } // A view class that extends AbstractCollection for simpler implementation class CollectionView extends AbstractCollection&lt;Object&gt; { private final Object[] elements; private final int size; private int writeIndex; // Constructor for serialization (wrapping existing array) public CollectionView(CustomCollectionLike collection) { this.elements = collection.getElements(); this.size = collection.size(); } // Constructor for deserialization public CollectionView(int size) { this.size = size; this.elements = new Object[size]; } @Override public Iterator&lt;Object&gt; iterator() { return new Iterator&lt;Object&gt;() { private int index = 0; @Override public boolean hasNext() { return index &lt; size; } @Override public Object next() { if (!hasNext()) { throw new NoSuchElementException(); } return elements[index++]; } }; } @Override public boolean add(Object element) { if (writeIndex &gt;= size) { throw new IllegalStateException(&quot;Collection is full&quot;); } elements[writeIndex++] = element; return true; } @Override public int size() { return size; } public Object[] getElements() { return elements; } } class CustomCollectionSerializer extends AbstractCollectionSerializer&lt;CustomCollectionLike&gt; { public CustomCollectionSerializer(Fory fory) { super(fory, CustomCollectionLike.class, true); } @Override public Collection onCollectionWrite(MemoryBuffer buffer, CustomCollectionLike value) { buffer.writeVarUint32Small7(value.size()); return new CollectionView(value); } @Override public Collection newCollection(MemoryBuffer buffer) { int numElements = buffer.readVarUint32Small7(); setNumElements(numElements); return new CollectionView(numElements); } @Override public CustomCollectionLike onCollectionRead(Collection collection) { CollectionView view = (CollectionView) collection; return new CustomCollectionLike(view.getElements(), view.size()); } }   Key takeways:  Collection Structure: Array-based storage for elementsFixed size after creationDirect element accessSize tracking View Implementation: Extends AbstractCollection for simplicityProvides iterator for element accessImplements add() for deserializationShares array reference with original type Serializer Features: Uses supportCodegenHook=true for JIT optimizationShares array references when possibleMaintains proper size trackingUses view pattern for serialization Performance Aspects: Direct array accessMinimal object creationArray sharing between instancesEfficient iteration  Note that this implementation provides better performance at the cost of flexibility. Consider your specific use case when choosing this approach.  ","version":"0.11","tagName":"h3"},{"title":"Implement Map Serializer‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.11/guide/serialization#implement-map-serializer","content":" When implementing a serializer for a custom Map type, you must extend MapSerializer or AbstractMapSerializer. The key difference between these two is that AbstractMapSerializer can serialize a class which has a map-like structure but is not a java Map subtype.  Similiar to collection serializer, this is a special parameter supportCodegenHook needs be configured:  When true: Enables optimized access to map elements and JIT compilation for better performanceDirect serialization invocation and inline for map key-value items without dynamic serializer dispatch cost.Better performance for standard map typesRecommended for most maps When false: Uses interfaced-based element access and dynamic serializer dispatch for elements, which have higer costMore flexible for custom map typesRequired when map has special serialization needsHandles complex map implementations  Implement Map Serializer with JIT support‚Äã  When implementing a Map serializer with JIT support, you can leverage Fory's existing chunk-based binary format and map serialization infrastructure. The key is to properly implement the onMapWrite and newMap methods to handle metadata while letting Fory handle the map key-value serialization.  Here's an example of implementing a custom map serializer:  public class CustomMapSerializer&lt;T extends Map&gt; extends MapSerializer&lt;T&gt; { public CustomMapSerializer(Fory fory, Class&lt;T&gt; cls) { // supportCodegenHook is a critical parameter that determines serialization behavior super(fory, cls, true); } @Override public Map onMapWrite(MemoryBuffer buffer, T value) { // Write map size buffer.writeVarUint32Small7(value.size()); // Write any additional map metadata here return value; } @Override public Map newMap(MemoryBuffer buffer) { // Read map size int numElements = buffer.readVarUint32Small7(); setNumElements(numElements); // Create and return new map instance T map = (T) new HashMap(numElements); fory.getRefResolver().reference(map); return map; } }   Note that please invoke setNumElements when implementing newMap to let fory know how many elements to deserialize.  Implement a totally-customzied Map Serializer without JIT‚Äã  Sometimes you may need complete control over the serialization process, or your map type might have special requirements that don't fit the standard patterns. In such cases, you can implement a serializer with supportCodegenHook=false and directly override the write and read methods.  This approach:  Gives you full control over serializationAllows custom binary formatBypasses the standard map serialization patternMay be simpler for special cases  Here's an example:  class FixedValueMap extends AbstractMap&lt;String, Integer&gt; { private final Set&lt;String&gt; keys; private final int fixedValue; public FixedValueMap(Set&lt;String&gt; keys, int fixedValue) { this.keys = keys; this.fixedValue = fixedValue; } @Override public Set&lt;Entry&lt;String, Integer&gt;&gt; entrySet() { Set&lt;Entry&lt;String, Integer&gt;&gt; entries = new HashSet&lt;&gt;(); for (String key : keys) { entries.add(new SimpleEntry&lt;&gt;(key, fixedValue)); } return entries; } @Override public Integer get(Object key) { return keys.contains(key) ? fixedValue : null; } public Set&lt;String&gt; getKeys() { return keys; } public int getFixedValue() { return fixedValue; } } class FixedValueMapSerializer extends AbstractMapSerializer&lt;FixedValueMap&gt; { public FixedValueMapSerializer(Fory fory) { // Disable codegen since we're handling serialization directly super(fory, FixedValueMap.class, false); } @Override public void write(MemoryBuffer buffer, FixedValueMap value) { // Write the fixed value buffer.writeInt32(value.getFixedValue()); // Write the number of keys buffer.writeVarUint32Small7(value.getKeys().size()); // Write each key for (String key : value.getKeys()) { buffer.writeString(key); } } @Override public FixedValueMap read(MemoryBuffer buffer) { // Read the fixed value int fixedValue = buffer.readInt32(); // Read the number of keys int size = buffer.readVarUint32Small7(); Set&lt;String&gt; keys = new HashSet&lt;&gt;(size); for (int i = 0; i &lt; size; i++) { keys.add(buffer.readString()); } return new FixedValueMap(keys, fixedValue); } // These methods are not used when supportCodegenHook is false @Override public Map onMapWrite(MemoryBuffer buffer, FixedValueMap value) { throw new UnsupportedOperationException(); } @Override public FixedValueMap onMapRead(Map map) { throw new UnsupportedOperationException(); } @Override public FixedValueMap onMapCopy(Map map) { throw new UnsupportedOperationException(); } }   Key Points:  Disable Codegen: Set supportCodegenHook=false in constructorFory will use your write/read methods directlyNo JIT optimization will be appliedFull control over serialization format Write Method: Handle all serialization manuallyWrite custom fields firstWrite map entries in your preferred formatControl the exact binary layout Read Method: Handle all deserialization manuallyRead in same order as writtenCreate and populate map instanceRestore custom fields Unused Methods: onMapWrite, onMapRead, onMapCopy are not usedCan throw UnsupportedOperationExceptionOnly write and read are important  When to Use: this approach is best when  Map has custom fields or metadataSpecial serialization format is neededComplete control over binary format is requiredStandard map patterns don't fit  Trade-offs  Advantages: Complete control over serializationCustom binary format possibleSimpler implementation for special casesDirect handling of custom fields Disadvantages: No JIT optimizationPotentially lower performanceManual handling of all serializationMore code to maintain  Remember that disabling codegen means giving up some performance optimizations that Fory provides. Only use this approach when the standard map serialization pattern doesn't meet your needs.  Implement Serializer for Map-like Types‚Äã  Sometimes you may want to implement a serializer for a type that behaves like a map but isn't a standard Java map. This section demonstrates how to implement a serializer for such types.  The key principles for map-like type serialization are:  Extend AbstractMapSerializer for custom collection-like typesEnable JIT optimization with supportCodegenHookProvide efficient element access through viewsMaintain proper size tracking  Here's a complete example:  // It's better to make it to implements the java.util.Map interface, in this way we don't have to implement such serializers by ourself. class CustomMapLike { private final Object[] keyArray; private final Object[] valueArray; private final int size; // Constructor for creating new instance public CustomMapLike(int initialCapacity) { this.keyArray = new Object[initialCapacity]; this.valueArray = new Object[initialCapacity]; this.size = 0; } // Constructor for wrapping existing arrays public CustomMapLike(Object[] keyArray, Object[] valueArray, int size) { this.keyArray = keyArray; this.valueArray = valueArray; this.size = size; } public Integer get(String key) { for (int i = 0; i &lt; size; i++) { if (key.equals(keyArray[i])) { return (Integer) valueArray[i]; } } return null; } public int size() { return size; } public Object[] getKeyArray() { return keyArray; } public Object[] getValueArray() { return valueArray; } } class MapView extends AbstractMap&lt;Object, Object&gt; { private final Object[] keyArray; private final Object[] valueArray; private final int size; private int writeIndex; // Constructor for serialization (wrapping existing CustomMapLike) public MapView(CustomMapLike mapLike) { this.size = mapLike.size(); this.keyArray = mapLike.getKeyArray(); this.valueArray = mapLike.getValueArray(); } // Constructor for deserialization public MapView(int size) { this.size = size; this.keyArray = new Object[size]; this.valueArray = new Object[size]; } @Override public Set&lt;Entry&lt;Object, Object&gt;&gt; entrySet() { return new AbstractSet&lt;Entry&lt;Object, Object&gt;&gt;() { @Override public Iterator&lt;Entry&lt;Object, Object&gt;&gt; iterator() { return new Iterator&lt;Entry&lt;Object, Object&gt;&gt;() { private int index = 0; @Override public boolean hasNext() { return index &lt; size; } @Override public Entry&lt;Object, Object&gt; next() { if (!hasNext()) { throw new NoSuchElementException(); } final int currentIndex = index++; return new SimpleEntry&lt;&gt;( keyArray[currentIndex], valueArray[currentIndex] ); } }; } @Override public int size() { return size; } }; } @Override public Object put(Object key, Object value) { if (writeIndex &gt;= size) { throw new IllegalStateException(&quot;Map is full&quot;); } keyArray[writeIndex] = key; valueArray[writeIndex] = value; writeIndex++; return null; } public Object[] getKeyArray() { return keyArray; } public Object[] getValueArray() { return valueArray; } public int size() { return size; } } class CustomMapLikeSerializer extends AbstractMapSerializer&lt;CustomMapLike&gt; { public CustomMapLikeSerializer(Fory fory) { super(fory, CustomMapLike.class, true); } @Override public Map onMapWrite(MemoryBuffer buffer, CustomMapLike value) { buffer.writeVarUint32Small7(value.size()); // Return a zero-copy view using the same underlying arrays return new MapView(value); } @Override public Map newMap(MemoryBuffer buffer) { int numElements = buffer.readVarUint32Small7(); setNumElements(numElements); // Create a view with new arrays for deserialization return new MapView(numElements); } @Override public CustomMapLike onMapRead(Map map) { MapView view = (MapView) map; // Just pass the arrays directly - no copying needed return new CustomMapLike(view.getKeyArray(), view.getValueArray(), view.size()); } @Override public CustomMapLike onMapCopy(Map map) { MapView view = (MapView) map; // Just pass the arrays directly - no copying needed return new CustomMapLike(view.getKeyArray(), view.getValueArray(), view.size()); } }   ","version":"0.11","tagName":"h3"},{"title":"Register Custom Serializers‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.11/guide/serialization#register-custom-serializers","content":" After implementing your custom serializer, register it with Fory:  Fory fory = Fory.builder() .withLanguage(Language.JAVA) .build(); // Register map serializer fory.registerSerializer(CustomMap.class, new CustomMapSerializer&lt;&gt;(fory, CustomMap.class)); // Register collection serializer fory.registerSerializer(CustomCollection.class, new CustomCollectionSerializer&lt;&gt;(fory, CustomCollection.class));   Note that when implementing custom map or collection serializers:  Always extend the appropriate base class (MapSerializer/AbstractMapSerializer for maps, CollectionSerializer/AbstractCollectionSerializer for collections)Consider the impact of supportCodegenHook on performance and functionalityProperly handle reference tracking if neededImplement proper size management using setNumElements and getAndClearNumElements when supportCodegenHook is true  Besides registering serializes, one can also implement java.io.Externalizable for a class to customize serialization logic, such type will be serialized by fory ExternalizableSerializer.  ","version":"0.11","tagName":"h3"},{"title":"Security & Class Registration‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.11/guide/serialization#security--class-registration","content":" ForyBuilder#requireClassRegistration can be used to disable class registration, this will allow to deserialize objects unknown types, more flexible but may be insecure if the classes contains malicious code.  Do not disable class registration unless you can ensure your environment is secure. Malicious code in init/equals/hashCode can be executed when deserializing unknown/untrusted types when this option disabled.  Class registration can not only reduce security risks, but also avoid classname serialization cost.  You can register class with API Fory#register.  Note that class registration order is important, serialization and deserialization peer should have same registration order.  Fory fory = xxx; fory.register(SomeClass.class); fory.register(SomeClass1.class, 200);   If you invoke ForyBuilder#requireClassRegistration(false) to disable class registration check, you can set org.apache.fory.resolver.ClassChecker by ClassResolver#setClassChecker to control which classes are allowed for serialization. For example, you can allow classes started with org.example.* by:  Fory fory = xxx; fory.getClassResolver().setClassChecker( (classResolver, className) -&gt; className.startsWith(&quot;org.example.&quot;));   AllowListChecker checker = new AllowListChecker(AllowListChecker.CheckLevel.STRICT); ThreadSafeFory fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().requireClassRegistration(true).withClassLoader(classLoader).build(); f.getClassResolver().setClassChecker(checker); checker.addListener(f.getClassResolver()); return f; }); checker.allowClass(&quot;org.example.*&quot;);   Fory also provided a org.apache.fory.resolver.AllowListChecker which is allowed/disallowed list based checker to simplify the customization of class check mechanism. You can use this checker or implement more sophisticated checker by yourself.  ","version":"0.11","tagName":"h3"},{"title":"Register class by name‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.11/guide/serialization#register-class-by-name","content":" Register class by id will have better performance and smaller space overhead. But in some cases, management for a bunch of type id is complex. In such cases, registering class by name using APIregister(Class&lt;?&gt; cls, String namespace, String typeName) is recommended.  fory.register(Foo.class, &quot;demo&quot;, &quot;Foo&quot;);   If there are no duplicate name for type, namespace can be left as empty to reduce serialized size.  Do not use this API to register class since it will increase serialized size a lot compared to register class by id  ","version":"0.11","tagName":"h3"},{"title":"Zero-Copy Serialization‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.11/guide/serialization#zero-copy-serialization","content":" import org.apache.fory.*; import org.apache.fory.config.*; import org.apache.fory.serializer.BufferObject; import org.apache.fory.memory.MemoryBuffer; import java.util.*; import java.util.stream.Collectors; public class ZeroCopyExample { // Note that fory instance should be reused instead of creation every time. static Fory fory = Fory.builder() .withLanguage(Language.JAVA) .build(); // mvn exec:java -Dexec.mainClass=&quot;io.ray.fory.examples.ZeroCopyExample&quot; public static void main(String[] args) { List&lt;Object&gt; list = Arrays.asList(&quot;str&quot;, new byte[1000], new int[100], new double[100]); Collection&lt;BufferObject&gt; bufferObjects = new ArrayList&lt;&gt;(); byte[] bytes = fory.serialize(list, e -&gt; !bufferObjects.add(e)); List&lt;MemoryBuffer&gt; buffers = bufferObjects.stream() .map(BufferObject::toBuffer).collect(Collectors.toList()); System.out.println(fory.deserialize(bytes, buffers)); } }   ","version":"0.11","tagName":"h3"},{"title":"Meta Sharing‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.11/guide/serialization#meta-sharing","content":" Fory supports share type metadata (class name, field name, final field type information, etc.) between multiple serializations in a context (ex. TCP connection), and this information will be sent to the peer during the first serialization in the context. Based on this metadata, the peer can rebuild the same deserializer, which avoids transmitting metadata for subsequent serializations and reduces network traffic pressure and supports type forward/backward compatibility automatically.  // Fory.builder() // .withLanguage(Language.JAVA) // .withRefTracking(false) // // share meta across serialization. // .withMetaContextShare(true) // Not thread-safe fory. MetaContext context = xxx; fory.getSerializationContext().setMetaContext(context); byte[] bytes = fory.serialize(o); // Not thread-safe fory. MetaContext context = xxx; fory.getSerializationContext().setMetaContext(context); fory.deserialize(bytes); // Thread-safe fory fory.setClassLoader(beanA.getClass().getClassLoader()); byte[] serialized = fory.execute( f -&gt; { f.getSerializationContext().setMetaContext(context); return f.serialize(beanA); } ); // thread-safe fory fory.setClassLoader(beanA.getClass().getClassLoader()); Object newObj = fory.execute( f -&gt; { f.getSerializationContext().setMetaContext(context); return f.deserialize(serialized); } );   ","version":"0.11","tagName":"h3"},{"title":"Deserialize non-existent classes‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.11/guide/serialization#deserialize-non-existent-classes","content":" Fory support deserializing non-existent classes, this feature can be enabled by ForyBuilder#deserializeNonexistentClass(true). When enabled, and metadata sharing enabled, Fory will store the deserialized data of this type in a lazy subclass of Map. By using the lazy map implemented by Fory, the rebalance cost of filling map during deserialization can be avoided, which further improves performance. If this data is sent to another process and the class exists in this process, the data will be deserialized into the object of this type without losing any information.  If metadata sharing is not enabled, the new class data will be skipped and an NonexistentSkipClass stub object will be returned.  ","version":"0.11","tagName":"h3"},{"title":"Copy/Map object from one type to another type‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.11/guide/serialization#copymap-object-from-one-type-to-another-type","content":" Fory support mapping object from one type to another type.  Notes: This mapping will execute a deep copy, all mapped fields are serialized into binary and deserialized from that binary to map into another type.All struct types must be registered with same ID, otherwise Fory can not mapping to correct struct type. Be careful when you use Fory#register(Class), because fory will allocate an auto-grown ID which might be inconsistent if you register classes with different order between Fory instance.  public class StructMappingExample { static class Struct1 { int f1; String f2; public Struct1(int f1, String f2) { this.f1 = f1; this.f2 = f2; } } static class Struct2 { int f1; String f2; double f3; } static ThreadSafeFory fory1 = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE).buildThreadSafeFory(); static ThreadSafeFory fory2 = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE).buildThreadSafeFory(); static { fory1.register(Struct1.class); fory2.register(Struct2.class); } public static void main(String[] args) { Struct1 struct1 = new Struct1(10, &quot;abc&quot;); Struct2 struct2 = (Struct2) fory2.deserialize(fory1.serialize(struct1)); Assert.assertEquals(struct2.f1, struct1.f1); Assert.assertEquals(struct2.f2, struct1.f2); struct1 = (Struct1) fory1.deserialize(fory2.serialize(struct2)); Assert.assertEquals(struct1.f1, struct2.f1); Assert.assertEquals(struct1.f2, struct2.f2); } }   ","version":"0.11","tagName":"h3"},{"title":"Migration‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.11/guide/serialization#migration","content":" ","version":"0.11","tagName":"h2"},{"title":"JDK migration‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.11/guide/serialization#jdk-migration","content":" If you use jdk serialization before, and you can't upgrade your client and server at the same time, which is common for online application. Fory provided an util method org.apache.fory.serializer.JavaSerializer.serializedByJDK to check whether the binary are generated by jdk serialization, you use following pattern to make exiting serialization protocol-aware, then upgrade serialization to fory in an async rolling-up way:  if (JavaSerializer.serializedByJDK(bytes)) { ObjectInputStream objectInputStream=xxx; return objectInputStream.readObject(); } else { return fory.deserialize(bytes); }   ","version":"0.11","tagName":"h3"},{"title":"Upgrade fory‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.11/guide/serialization#upgrade-fory","content":" Currently binary compatibility is ensured for minor versions only. For example, if you are using foryv0.2.0, binary compatibility will be provided if you upgrade to fory v0.2.1. But if upgrade to fory v0.4.1, no binary compatibility are ensured. Most of the time there is no need to upgrade fory to newer major version, the current version is fast and compact enough, and we provide some minor fix for recent older versions.  But if you do want to upgrade fory for better performance and smaller size, you need to write fory version as header to serialized data using code like following to keep binary compatibility:  MemoryBuffer buffer = xxx; buffer.writeVarInt32(2); fory.serialize(buffer, obj);   Then for deserialization, you need:  MemoryBuffer buffer = xxx; int foryVersion = buffer.readVarInt32(); Fory fory = getFory(foryVersion); fory.deserialize(buffer);   getFory is a method to load corresponding fory, you can shade and relocate different version of fory to different package, and load fory by version.  If you upgrade fory by minor version, or you won't have data serialized by older fory, you can upgrade fory directly, no need to versioning the data.  ","version":"0.11","tagName":"h3"},{"title":"Trouble shooting‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.11/guide/serialization#trouble-shooting","content":" ","version":"0.11","tagName":"h2"},{"title":"Class inconsistency and class version check‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.11/guide/serialization#class-inconsistency-and-class-version-check","content":" If you create fory without setting CompatibleMode to org.apache.fory.config.CompatibleMode.COMPATIBLE, and you got a strange serialization error, it may be caused by class inconsistency between serialization peer and deserialization peer.  In such cases, you can invoke ForyBuilder#withClassVersionCheck to create fory to validate it, if deserialization throws org.apache.fory.exception.ClassNotCompatibleException, it shows class are inconsistent, and you should create fory withForyBuilder#withCompaibleMode(CompatibleMode.COMPATIBLE).  CompatibleMode.COMPATIBLE has more performance and space cost, do not set it by default if your classes are always consistent between serialization and deserialization.  ","version":"0.11","tagName":"h3"},{"title":"Deserialize POJO into another type‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.11/guide/serialization#deserialize-pojo-into-another-type","content":" Fory allows you to serialize one POJO and deserialize it into a different POJO. The different POJO means the schema inconsistency. Users must to configure Fory withCompatibleMode set to org.apache.fory.config.CompatibleMode.COMPATIBLE.  public class DeserializeIntoType { static class Struct1 { int f1; String f2; public Struct1(int f1, String f2) { this.f1 = f1; this.f2 = f2; } } static class Struct2 { int f1; String f2; double f3; } static ThreadSafeFory fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE).buildThreadSafeFory(); public static void main(String[] args) { Struct1 struct1 = new Struct1(10, &quot;abc&quot;); byte[] data = fory.serializeJavaObject(struct1); Struct2 struct2 = (Struct2) fory.deserializeJavaObject(bytes, Struct2.class); } }   ","version":"0.11","tagName":"h3"},{"title":"Use wrong API for deserialization‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.11/guide/serialization#use-wrong-api-for-deserialization","content":" If you serialize an object by invoking Fory#serialize, you should invoke Fory#deserialize for deserialization instead ofFory#deserializeJavaObject.  If you serialize an object by invoking Fory#serializeJavaObject, you should invoke Fory#deserializeJavaObject for deserialization instead of Fory#deserializeJavaObjectAndClass/Fory#deserialize.  If you serialize an object by invoking Fory#serializeJavaObjectAndClass, you should invoke Fory#deserializeJavaObjectAndClass for deserialization instead of Fory#deserializeJavaObject/Fory#deserialize. ","version":"0.11","tagName":"h3"},{"title":"How to release","type":0,"sectionRef":"#","url":"/docs/0.12/community/how_to_release","content":"","keywords":"","version":"0.12"},{"title":"Introduction‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.12/community/how_to_release#introduction","content":" Source Release is the most important part which Apache values.  Please pay more attention to license and signing issues. Publishing software is a serious thing and has legal consequences.  ","version":"0.12","tagName":"h2"},{"title":"First-time as a release manager‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.12/community/how_to_release#first-time-as-a-release-manager","content":" ","version":"0.12","tagName":"h2"},{"title":"Environmental requirements‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.12/community/how_to_release#environmental-requirements","content":" This release process is operated in the Ubuntu OS, and the following tools are required:  JDK 1.8Apache Maven 3.xPython 3.8GnuPG 2.xGitSVN (apache uses svn to host project releases)Pay attention to setting environment variables: if you configure gpg keys under a different directory, please export GNUPGHOME=$(xxx)  ","version":"0.12","tagName":"h3"},{"title":"Prepare GPG Key‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.12/community/how_to_release#prepare-gpg-key","content":" If you are the first to become a release manager, you need to prepare a gpg key.  Following is a quick setup, you can refer to Apache openpgp doc for further details.  Install GPG‚Äã  sudo apt install gnupg2   Generate GPG Key‚Äã  Please use your apache name and email for generate key  $ gpg --full-gen-key gpg (GnuPG) 2.2.20; Copyright (C) 2020 Free Software Foundation, Inc. This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. Please select what kind of key you want: (1) RSA and RSA (default) (2) DSA and Elgamal (3) DSA (sign only) (4) RSA (sign only) (14) Existing key from card Your selection? 1 # input 1 RSA keys may be between 1024 and 4096 bits long. What keysize do you want? (2048) 4096 # input 4096 Requested keysize is 4096 bits Please specify how long the key should be valid. 0 = key does not expire &lt;n&gt; = key expires in n days &lt;n&gt;w = key expires in n weeks &lt;n&gt;m = key expires in n months &lt;n&gt;y = key expires in n years Key is valid for? (0) 0 # input 0 Key does not expire at all Is this correct? (y/N) y # input y GnuPG needs to construct a user ID to identify your key. Real name: Chaokun Yang # input your name Email address: chaokunyang@apache.org # input your email Comment: CODE SIGNING KEY # input some annotations, optional You selected this USER-ID: &quot;Chaokun &lt;chaokunyang@apache.org&gt;&quot; Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? O # input O We need to generate a lot of random bytes. It is a good idea to perform some other action (type on the keyboard, move the mouse, utilize the disks) during the prime generation; this gives the random number generator a better chance to gain enough entropy. We need to generate a lot of random bytes. It is a good idea to perform some other action (type on the keyboard, move the mouse, utilize the disks) during the prime generation; this gives the random number generator a better chance to gain enough entropy. # Input the security key ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ Please enter this passphrase ‚îÇ ‚îÇ ‚îÇ ‚îÇ Passphrase: _______________________________ ‚îÇ ‚îÇ ‚îÇ ‚îÇ &lt;OK&gt; &lt;Cancel&gt; ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò # key generation will be done after your inputting the key with the following output gpg: key E49B00F626B marked as ultimately trusted gpg: revocation certificate stored as '/Users/chaokunyang/.gnupg/openpgp-revocs.d/1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4.rev' public and secret key created and signed. pub rsa4096 2022-07-12 [SC] 1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4 uid [ultimate] Chaokun &lt;chaokunyang@apache.org&gt; sub rsa4096 2022-07-12 [E]   Upload your public key to public GPG keyserver‚Äã  Firstly, list your key:  gpg --list-keys   The output is like:  -------------------------------------------------- pub rsa4096 2024-03-27 [SC] 1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4 uid [ultimate] chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; sub rsa4096 2024-03-27 [E]   Then, send your key id to key server:  gpg --keyserver keys.openpgp.org --send-key &lt;key-id&gt; # e.g., 1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4   Among them, keys.openpgp.org is a randomly selected keyserver, you can use keyserver.ubuntu.com or any other full-featured keyserver.  Check whether the key is created successfully‚Äã  Uploading takes about one minute; after that, you can check by email at the corresponding keyserver.  Uploading keys to the keyserver is mainly for joining a Web of Trust.  Add your GPG public key to the project KEYS file‚Äã  The svn repository of the release branch is: https://dist.apache.org/repos/dist/release/fory  Please add the public key to KEYS in the release branch:  svn co https://dist.apache.org/repos/dist/release/fory fory-dist # As this step will copy all the versions, it will take some time. If the network is broken, please use svn cleanup to delete the lock before re-execute it. cd fory-dist (gpg --list-sigs YOUR_NAME@apache.org &amp;&amp; gpg --export --armor YOUR_NAME@apache.org) &gt;&gt; KEYS # Append your key to the KEYS file svn add . # It is not needed if the KEYS document exists before. svn ci -m &quot;add gpg key for YOUR_NAME&quot; # Later on, if you are asked to enter a username and password, just use your apache username and password.   Upload the GPG public key to your GitHub account‚Äã  Enter https://github.com/settings/keys to add your GPG key.Please remember to bind the email address used in the GPG key to your GitHub account (https://github.com/settings/emails) if you find &quot;unverified&quot; after adding it.  ","version":"0.12","tagName":"h3"},{"title":"Further reading‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.12/community/how_to_release#further-reading","content":" It's recommended but not mandatory to read following documents before making a release to know more details about apache release:  Release policy: https://www.apache.org/legal/release-policy.htmlTLP release: https://infra.apache.org/release-distributionRelease sign: https://infra.apache.org/release-signing.htmlRelease publish: https://infra.apache.org/release-publishing.htmlRelease download pages: https://infra.apache.org/release-download-pages.htmlPublishing maven artifacts: https://infra.apache.org/publishing-maven-artifacts.html  ","version":"0.12","tagName":"h3"},{"title":"Start discussion about the release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.12/community/how_to_release#start-discussion-about-the-release","content":" Start a discussion about the next release via sending email to: dev@fory.apache.org:  Title:  [DISCUSS] Release Apache Fory ${release_version}   Content:  Hello, Apache Fory Community, This is a call for a discussion to release Apache Fory version ${release_version}. The change lists about this release: https://github.com/apache/fory/compare/v0.12.0...v0.12.1-rc1 Please leave your comments here about this release plan. We will bump the version in repo and start the release process after the discussion. Thanks, ${name}   ","version":"0.12","tagName":"h2"},{"title":"Preparing for release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.12/community/how_to_release#preparing-for-release","content":" If the discussion goes positive, you will need to prepare the release artifiacts.  ","version":"0.12","tagName":"h2"},{"title":"Github branch and tag‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.12/community/how_to_release#github-branch-and-tag","content":" Create a new branch named releases-0.12.0Bump version to $version by executing command python ci/release.py bump_version -l all -version $versionMake a git commit and push the branch to git@github.com:apache/fory.gitCreate a new tag by git tag v0.12.0-rc1, then push it to git@github.com:apache/fory.git  ","version":"0.12","tagName":"h3"},{"title":"Build and upload artifacts to SVN dist/dev repo‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.12/community/how_to_release#build-and-upload-artifacts-to-svn-distdev-repo","content":" First you need to build source release artifacts by python ci/release.py build -v $version.  Then you need to upload it to svn dist repo. The dist repo of the dev branch is: https://dist.apache.org/repos/dist/dev/fory  # As this step will copy all the versions, it will take some time. If the network is broken, please use svn cleanup to delete the lock before re-execute it. svn co https://dist.apache.org/repos/dist/dev/fory fory-dist-dev   Then, upload the artifacts:  cd fory-dist-dev # create a directory named by version mkdir ${release_version}-${rc_version} # copy source code and signature package to the versioned directory cp ${repo_dir}/dist/* ${release_version}-${rc_version} # check svn status svn status # add to svn svn add ${release_version}-${rc_version} # check svn status svn status # commit to SVN remote server svn commit -m &quot;Prepare for fory ${release_version}-${rc_version}&quot;   Visit https://dist.apache.org/repos/dist/dev/fory/ to check the artifacts are uploaded correctly.  ","version":"0.12","tagName":"h3"},{"title":"What to do if something goes wrong‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.12/community/how_to_release#what-to-do-if-something-goes-wrong","content":" If some files are unexpected, you need to remove by svn delete and repeat the above upload process.  ","version":"0.12","tagName":"h3"},{"title":"Voting‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.12/community/how_to_release#voting","content":" ","version":"0.12","tagName":"h2"},{"title":"check version‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.12/community/how_to_release#check-version","content":" Fory requires votes from the Fory Community.  release_version: the version for fory, like 0.12.0.release_candidate_version: the version for voting, like 0.12.0-rc1.maven_artifact_number: the number for Maven staging artifacts, like 1001. Specifically, the maven_artifact_number can be found by searching &quot;fory&quot; on https://repository.apache.org/#stagingRepositories.  ","version":"0.12","tagName":"h3"},{"title":"Build the source code of fory and release it to nexus‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.12/community/how_to_release#build-the-source-code-of-fory-and-release-it-to-nexus","content":" Configure Apache Account Passwords‚Äã  Before publishing Fory to Nexus, you need to securely configure your Apache account credentials. This step is critical as passwords must be encrypted.  First, open your Maven global settings file settings.xml, typically located at ~/.m2/settings.xml. Add or modify the following section:   &lt;servers&gt; &lt;server&gt; &lt;id&gt;apache.snapshots.https&lt;/id&gt; &lt;username&gt;your-apache-username&lt;/username&gt; &lt;password&gt;{your-encrypted-password}&lt;/password&gt; &lt;/server&gt; &lt;server&gt; &lt;id&gt;apache.releases.https&lt;/id&gt; &lt;username&gt;your-apache-username&lt;/username&gt; &lt;password&gt;{your-encrypted-password}&lt;/password&gt; &lt;/server&gt; &lt;/servers&gt;   Important Notes:  Replace your-apache-username with your Apache LDAP usernamePasswords must be encrypted using Maven's password encryption toolEncrypted passwords should be enclosed in curly braces {}  Refer to the official documentation for detailed encryption instructions: Publishing Maven Artifacts  Steps to encrypt your password:  Generate a master password (if you haven't already): mvn --encrypt-master-password your-master-password Save the output to ~/.m2/settings-security.xml: &lt;settingsSecurity&gt; &lt;master&gt;{your-encrypted-master-password}&lt;/master&gt; &lt;/settingsSecurity&gt; Encrypt your Apache account password: mvn --encrypt-password your-apache-password Place the encrypted output into the password field in settings.xml  Build and Publish Java Module‚Äã   # Navigate to the Java module directory cd java # Execute Maven build and deploy to Nexus # -T10: Use 10 threads for parallel build, improving speed # clean: Clean the project # deploy: Deploy to remote repository # -Papache-release: Activate apache-release profile # -DskipTests: Skip tests # -Dgpg.skip=false: Enable GPG signing (required for release verification) mvn -T10 clean deploy -Papache-release -DskipTests -Dgpg.skip=false   Build and Publish Kotlin Module‚Äã   # Return to project root and navigate to Kotlin module cd ../kotlin # Execute the same Maven command as Java module # Configuration parameters are identical to Java module mvn -T10 clean deploy -Papache-release -DskipTests -Dgpg.skip=false   Build and Publish Scala Module‚Äã   # Return to project root and navigate to Scala module cd ../scala # Build and sign JARs for all Scala versions # +publishSigned: Execute publishSigned for all configured Scala versions echo &quot;Starting to build Scala JARs...&quot; sbt +publishSigned # Prepare for upload to Sonatype (Nexus) # sonatypePrepare: Prepare for Maven Central Repository release echo &quot;Starting upload preparation...&quot; sbt sonatypePrepare # Upload packaged JARs to Sonatype # sonatypeBundleUpload: Upload prepared bundles echo &quot;Starting JAR upload...&quot; sbt sonatypeBundleUpload echo &quot;Scala JAR deployment succeeded!&quot;   Lock the Release in Nexus‚Äã  After completing the publication of all modules, perform the following steps in Nexus:  Log in to the Apache Nexus repository management interfaceNavigate to the &quot;Snapshots&quot; or &quot;Releases&quot; repository (depending on your release type)Locate the latest Fory project versionExecute the &quot;Close&quot; operation to validate all uploaded artifactsAfter successful validation, execute the &quot;Release&quot; operation to finalize the deployment  These steps ensure all published artifacts are verified and correctly deployed to the public repository.  ","version":"0.12","tagName":"h3"},{"title":"build a Pre-release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.12/community/how_to_release#build-a-pre-release","content":" You need to build a Pre-release before voting, such as:https://github.com/apache/fory/releases/tag/v0.12.0-rc1  ","version":"0.12","tagName":"h3"},{"title":"Fory Community Vote‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.12/community/how_to_release#fory-community-vote","content":" you need send a email to Fory Community: dev@fory.apache.org:  Title:  [VOTE] Release Apache Fory v${release_version}-${rc_version}   Content:  Hello, Apache Fory Community: This is a call for vote to release Apache Fory version release-${release_version}-${rc_version}. Apache Fory - A blazingly fast multi-language serialization framework powered by JIT and zero-copy. The discussion thread: https://lists.apache.org/thread/xxr3od301g6v3ndj14zqc05byp9qvclh The change lists about this release: https://github.com/apache/fory/compare/v0.12.0...v0.12.1-rc1 The release candidates: https://dist.apache.org/repos/dist/dev/fory/0.5.0-rc3/ The maven staging for this release: https://repository.apache.org/content/repositories/orgapachefory-1003 Git tag for the release: https://github.com/apache/fory/releases/tag/v0.12.0-rc1 Git commit for the release: https://github.com/apache/fory/commit/fae06330edd049bb960536e978a45b97bca66faf The artifacts signed with PGP key [5E580BA4], corresponding to [chaokunyang@apache.org], that can be found in keys file: https://downloads.apache.org/fory/KEYS The vote will be open for at least 72 hours until the necessary number of votes are reached. Please vote accordingly: [ ] +1 approve [ ] +0 no opinion [ ] -1 disapprove with the reason To learn more about Fory, please see https://fory.apache.org/ *Valid check is a requirement for a vote. *Checklist for reference: [ ] Download Fory is valid. [ ] Checksums and PGP signatures are valid. [ ] Source code distributions have correct names matching the current release. [ ] LICENSE and NOTICE files are correct. [ ] All files have license headers if necessary. [ ] No compiled archives bundled in source archive. [ ] Can compile from source. How to Build and Test, please refer to: https://github.com/apache/fory/blob/main/docs/guide/DEVELOPMENT.md Thanks, ${name}   After at least 3 +1 binding vote (from Fory Podling PMC member and committers) and no veto, first, reply to the above voting thread to notify that the voting has ended.  Hi all, The vote for Release Apache Fory v${release_version}-${rc_version} is closed now. Thanks to everyone for helping checking and voting for the release. I will close the vote later in another thread. Best, ${name}   Immediately afterward, launch a new voting thread to claim the voting results.  Title:  [RESULT][VOTE] Release Apache Fory v${release_version}-${rc_version}   Content:  Hello, Apache Fory Community, The vote to release Apache Fory v${release_version}-${rc_version} has passed. The vote PASSED with 3 binding +1 and 0 -1 vote: Binding votes: - xxx - yyy - zzz Vote thread: ${vote_thread_url} Thanks, ${name}   ","version":"0.12","tagName":"h3"},{"title":"What if vote fail‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.12/community/how_to_release#what-if-vote-fail","content":" If the vote failed, click &quot;Drop&quot; to drop the staging Maven artifacts.  Address the raised issues, then bump rc_version and file a new vote again.  ","version":"0.12","tagName":"h3"},{"title":"Official Release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.12/community/how_to_release#official-release","content":" ","version":"0.12","tagName":"h2"},{"title":"Publish artifacts to SVN Release Directory‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.12/community/how_to_release#publish-artifacts-to-svn-release-directory","content":" release_version: the release version for fory, like 0.5.0release_candidate_version: the version for voting, like 0.5.0-rc1  svn mv https://dist.apache.org/repos/dist/dev/fory/${release_version}-${rc_version} https://dist.apache.org/repos/dist/release/fory/${release_version} -m &quot;Release fory ${release_version}&quot;   In the repository at https://dist.apache.org/repos/dist/dev/fory/, if any outdated release_candidate_version are left behind when releasing the release_version, please clear them to keep the dev repository tidy.  When https://archive.apache.org/dist/fory/0.12.0/${release_version} is accessible (confirming that the release_version has been successfully released and archived), we may clean up the previous release version in the release repository, leaving only the current version.  ","version":"0.12","tagName":"h3"},{"title":"Update Fory&Fory-Site content‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.12/community/how_to_release#update-foryfory-site-content","content":" Submit a PR to https://github.com/apache/fory-site to update Fory-site. Reference implementation: #283and #285.  Update Fory-Site‚Äã  In general, the following two key areas need to be modified:  Write a new announcement, for example: Add a new markdown file under the blog folder:  The Apache Fory team is pleased to announce the [?] release. This is a major release that includes [? PR](https://github.com/apache/fory/compare/v[?]...v[?]) from ? distinct contributors. See the [Install](https://fory.apache.org/docs/start/install) Page to learn how to get the libraries for your platform.   Replace versions by upgrading old versions to new ones. For example, in install section, it is necessary to update the documentation for both the development branch and the latest release branch::  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-core&lt;/artifactId&gt; &lt;version&gt;0.11.2&lt;/version&gt; &lt;/dependency&gt;   Update Fory‚Äã  Submit a PR to https://github.com/apache/fury to update README, like #2207.  ","version":"0.12","tagName":"h3"},{"title":"Github officially released‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.12/community/how_to_release#github-officially-released","content":" You need to officially release this version in the Fory project Reference implementation: https://github.com/apache/fory/releases/tag/v0.12.0  ","version":"0.12","tagName":"h3"},{"title":"Release Maven artifacts‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.12/community/how_to_release#release-maven-artifacts","content":" maven_artifact_number: the number for Maven staging artifacts, like 1001.Open https://repository.apache.org/#stagingRepositories.Find the artifact orgapachefory-${maven_artifact_number}, click &quot;Release&quot;.  ","version":"0.12","tagName":"h3"},{"title":"Send the announcement‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.12/community/how_to_release#send-the-announcement","content":" Send the release announcement to dev@fory.apache.org and CC announce@apache.org.  Title:  [ANNOUNCE] Release Apache Fory ${release_version}   Content:  Hi all, The Apache Fory community is pleased to announce that Apache Fory {release_version} has been released! Apache Fory - A blazingly fast multi-language serialization framework powered by JIT and zero-copy. The release notes are available here: https://github.com/apache/fory/releases/tag/v${release_version} For the complete list of changes: https://github.com/apache/fory/compare/v0.12.0...v${release_version} Apache Fory‚Ñ¢ website: https://fory.apache.org/ Download Links: https://fory.apache.org/download Fory Resources: - Fory github repo: https://github.com/apache/fory - Issue: https://github.com/apache/fory/issues - Mailing list: dev@fory.apache.org We are looking to grow our community and welcome new contributors. If you are interested in contributing to Fory, please contact us on the mailing list or on GitHub. We will be happy to help you get started. ------------------ Best Regards, ${your_name}   Remember to use plain text instead of rich text format, or you may be rejected when CC announce@apache.org  After completing the above steps, the Fory release process comes to an end. ","version":"0.12","tagName":"h3"},{"title":"How to verify","type":0,"sectionRef":"#","url":"/docs/0.12/community/how_to_verify","content":"","keywords":"","version":"0.12"},{"title":"Download the candidate version‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/0.12/community/how_to_verify#download-the-candidate-version","content":" #If there is svn locally, you can clone to the local svn co https://dist.apache.org/repos/dist/dev/fory/${release_version}-${rc_version}/ # You can download the material file directly wget https://dist.apache.org/repos/dist/dev/fory/${release_version}-${rc_version}/xxx.xxx   ","version":"0.12","tagName":"h2"},{"title":"Verify checksums and signatures‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/0.12/community/how_to_verify#verify-checksums-and-signatures","content":" First you need to install gpg:  apt-get install gnupg # or yum install gnupg # or brew install gnupg   Then import the Fory release manager's public key:  curl https://downloads.apache.org/fory/KEYS &gt; KEYS # Download KEYS gpg --import KEYS # Import KEYS to local # Then, trust the public key: gpg --edit-key &lt;KEY-used-in-this-version&gt; # Edit the key(mentioned in vote email) # It will enter the interactive mode, use the following command to trust the key: gpg (GnuPG) 2.0.22; Copyright (C) 2013 Free Software Foundation, Inc. This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. pub 4096R/5E580BA4 created: 2024-03-27 expires: never usage: SC trust: unknown validity: unknown sub 4096R/A31EF728 created: 2024-03-27 expires: never usage: E [ unknown] (1). chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; gpg&gt; trust pub 4096R/5E580BA4 created: 2024-03-27 expires: never usage: SC trust: unknown validity: unknown sub 4096R/A31EF728 created: 2024-03-27 expires: never usage: E [ unknown] (1). chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; Please decide how far you trust this user to correctly verify other users' keys (by looking at passports, checking fingerprints from different sources, etc.) 1 = I don't know or won't say 2 = I do NOT trust 3 = I trust marginally 4 = I trust fully 5 = I trust ultimately m = back to the main menu Your decision? 5 Do you really want to set this key to ultimate trust? (y/N) y pub 4096R/5E580BA4 created: 2024-03-27 expires: never usage: SC trust: ultimate validity: unknown sub 4096R/A31EF728 created: 2024-03-27 expires: never usage: E [ unknown] (1). chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; Please note that the shown key validity is not necessarily correct unless you restart the program.   Next verify signature:  for i in *.tar.gz; do echo $i; gpg --verify $i.asc $i; done   If something like the following appears, it means the signature is correct:  apache-fory-0.12.0-src.tar.gz gpg: Signature made Wed 17 Apr 2024 11:49:45 PM CST using RSA key ID 5E580BA4 gpg: checking the trustdb gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model gpg: depth: 0 valid: 1 signed: 0 trust: 0-, 0q, 0n, 0m, 0f, 1u gpg: Good signature from &quot;chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt;&quot;   Then verify checksum:  for i in *.tar.gz; do echo $i; sha512sum --check $i.sha512*; done   It should output something like:  apache-fory-0.12.0-src.tar.gz apache-fory-0.12.0-src.tar.gz: OK   A quick way to verify above is:  curl -s https://raw.githubusercontent.com/apache/fory/main/ci/release.py | python3 - verify -v 0.5.0   ","version":"0.12","tagName":"h2"},{"title":"Check the file content of the source package‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/0.12/community/how_to_verify#check-the-file-content-of-the-source-package","content":" Unzip apache-fory-${release_version}-${rc_version}-src.tar.gz and check the follows:  LICENSE and NOTICE files are correct for the repository.All files have ASF license headers if necessary.Building is OK.  ","version":"0.12","tagName":"h2"},{"title":"Check the Maven artifacts of fory-java‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/0.12/community/how_to_verify#check-the-maven-artifacts-of-fory-java","content":" Download the artifacts from https://repository.apache.org/content/repositories/orgapachefory-${maven_artifact_number}/.  You can check the follows:  Checksum of JARs match the bundled checksum file.Signature of JARs match the bundled signature file.JARs is reproducible locally. This means you can build the JARs on your machine and verify the checksum is the same with the bundled one. ","version":"0.12","tagName":"h2"},{"title":"Nominate Committer","type":0,"sectionRef":"#","url":"/docs/0.12/community/nominate_committer","content":"","keywords":"","version":"0.12"},{"title":"Discusstion‚Äã","type":1,"pageTitle":"Nominate Committer","url":"/docs/0.12/community/nominate_committer#discusstion","content":" Start a discusstion abouthe the candidate via sending email to: private@fory.apache.org  To: private@[project].apache.org Subject: [DISCUSS] New committer: [Candidate Name] I propose to add [Candidate Name] as a committer. [State reasons that you believe they are a good candidate.] [State contribution statistics, if available and relevant.] Please remember that should this candidate be elected as a PMC member at some later date, they will have access to our archives, and be able to read this, so phrase your comments constructively with this in mind.   ","version":"0.12","tagName":"h2"},{"title":"Start vote about the candidate‚Äã","type":1,"pageTitle":"Nominate Committer","url":"/docs/0.12/community/nominate_committer#start-vote-about-the-candidate","content":" Start a vote about the candidate via sending email to: private@fory.apache.org:  candidate name: The full name of the candidate.candidate github_id: The GitHub id of the candidate.  Email Template:  To: private@[PROJECT].apache.org Subject: [VOTE] New committer: [Candidate Name] This is a VOTE to add [Candidate Name] as a committer. This has been discussed here: [Link to DISCUSS thread on lists.apache.org] If you have more to add to the discussion, please do so there, rather than in this VOTE thread. [+1] Yes, add this committer [0] Abstain [-1] No, do not add this committer Voting ends one week from today, i.e. midnight UTC on YYYY-MM-DD https://www.timeanddate.com/counters/customcounter.html?year=YYYY&amp;month=MM&amp;day=DD See voting guidelines at https://community.apache.org/pmc/adding-committers.html   ","version":"0.12","tagName":"h2"},{"title":"Add the candidate to the committer list‚Äã","type":1,"pageTitle":"Nominate Committer","url":"/docs/0.12/community/nominate_committer#add-the-candidate-to-the-committer-list","content":" After the candidate accepts the invitation and the iCLA is recorded, add the candidate to the committer list by whimsy roster tools  ","version":"0.12","tagName":"h2"},{"title":"Announcement‚Äã","type":1,"pageTitle":"Nominate Committer","url":"/docs/0.12/community/nominate_committer#announcement","content":" Once the nominee accepts the invitation and the commit bit is granted, it's encouraged to send an announcement email to dev@fory.apache.org to welcome the new committers. Here is an email template:  To: dev@[PROJECT].apache.org Subject: New committer: [Committer Name] The Project Management Committee (PMC) for Apache [PROJECT] has invited [Committer Name] to become a committer and we are pleased to announce that they have accepted. Please join us in welcoming [Committer Name] to their new role and responsibility in our project community. [Your Name] On behalf of the [Project] PMC  ","version":"0.12","tagName":"h2"},{"title":"Development","type":0,"sectionRef":"#","url":"/docs/0.12/guide/development","content":"","keywords":"","version":"0.12"},{"title":"How to build Fory‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.12/guide/development#how-to-build-fory","content":" Please checkout the source tree from https://github.com/apache/fory.  ","version":"0.12","tagName":"h2"},{"title":"Build Fory Java‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.12/guide/development#build-fory-java","content":" cd java mvn clean compile -DskipTests   Environment Requirements‚Äã  java 1.8+maven 3.6.3+  ","version":"0.12","tagName":"h3"},{"title":"Build Fory Python‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.12/guide/development#build-fory-python","content":" cd python # Uninstall numpy first so that when we install pyarrow, it will install the correct numpy version automatically. # For Python versions less than 3.13, numpy 2 is not currently supported. pip uninstall -y numpy # Install necessary environment for Python &lt; 3.13. pip install pyarrow==15.0.0 Cython wheel pytest # For Python 3.13, pyarrow 18.0.0 is available and requires numpy version greater than 2. # pip install pyarrow==18.0.0 Cython wheel pytest pip install -v -e .   Environment Requirements‚Äã  python 3.6+  ","version":"0.12","tagName":"h3"},{"title":"Build Fory C++‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.12/guide/development#build-fory-c","content":" Build fory row formatÔºö  pip install pyarrow==15.0.0 bazel build //cpp/fory/row:fory_row_format   Build fory row format encoder:  pip install pyarrow==15.0.0 bazel build //cpp/fory/encoder:fory_encoder   Environment Requirements‚Äã  compilers with C++17 supportbazel 6.3.2  ","version":"0.12","tagName":"h3"},{"title":"Build Fory GoLang‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.12/guide/development#build-fory-golang","content":" cd go/fory # run test go test -v # run xlang test go test -v fory_xlang_test.go   Environment Requirements‚Äã  go 1.13+  ","version":"0.12","tagName":"h3"},{"title":"Build Fory Rust‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.12/guide/development#build-fory-rust","content":" cd rust # build cargo build # run test cargo test   Environment Requirements‚Äã  curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh   ","version":"0.12","tagName":"h3"},{"title":"Build Fory JavaScript‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.12/guide/development#build-fory-javascript","content":" cd javascript npm install # run build npm run build # run test npm run test   Environment Requirements‚Äã  node 14+npm 8+  ","version":"0.12","tagName":"h3"},{"title":"Lint Markdown Docs‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.12/guide/development#lint-markdown-docs","content":" # Install prettier globally npm install -g prettier # Fix markdown files prettier --write &quot;**/*.md&quot;   Environment Requirements‚Äã  node 14+npm 8+ ","version":"0.12","tagName":"h3"},{"title":"GraalVM Serialization","type":0,"sectionRef":"#","url":"/docs/0.12/guide/graalvm_serialization","content":"","keywords":"","version":"0.12"},{"title":"GraalVM Native Image‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.12/guide/graalvm_serialization#graalvm-native-image","content":" GraalVM native image can compile java code into native code ahead to build faster, smaller, leaner applications. The native image doesn't have a JIT compiler to compile bytecode into machine code, and doesn't support reflection unless configure reflection file.  Fory runs on GraalVM native image pretty well. Fory generates all serializer code for Fory JIT framework and MethodHandle/LambdaMetafactory at graalvm build time. Then use those generated code for serialization at runtime without any extra cost, the performance is great.  In order to use Fory on graalvm native image, you must create Fory as an static field of a class, and register all classes at the enclosing class initialize time. Then configure native-image.properties underresources/META-INF/native-image/$xxx/native-image.properties to tell graalvm to init the class at native image build time. For example, here we configure org.apache.fory.graalvm.Example class be init at build time:  Args = --initialize-at-build-time=org.apache.fory.graalvm.Example   Another benefit using fory is that you don't have to configure reflection json andserialization json, which is very tedious, cumbersome and inconvenient. When using fory, you just need to invokeorg.apache.fory.Fory.register(Class&lt;?&gt;, boolean) for every type you want to serialize.  Note that Fory asyncCompilationEnabled option will be disabled automatically for graalvm native image since graalvm native image doesn't support JIT at the image run time.  ","version":"0.12","tagName":"h2"},{"title":"Not thread-safe Fory‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.12/guide/graalvm_serialization#not-thread-safe-fory","content":" Example:  import org.apache.fory.Fory; import org.apache.fory.util.Preconditions; import java.util.List; import java.util.Map; public class Example { public record Record ( int f1, String f2, List&lt;String&gt; f3, Map&lt;String, Long&gt; f4) { } static Fory fory; static { fory = Fory.builder().build(); // register and generate serializer code. fory.register(Record.class, true); // ensure lazy initialized serializers being compiled by fory. fory.ensureSerializersCompiled(); } public static void main(String[] args) { Record record = new Record(10, &quot;abc&quot;, List.of(&quot;str1&quot;, &quot;str2&quot;), Map.of(&quot;k1&quot;, 10L, &quot;k2&quot;, 20L)); System.out.println(record); byte[] bytes = fory.serialize(record); Object o = fory.deserialize(bytes); System.out.println(o); Preconditions.checkArgument(record.equals(o)); } }   Then add org.apache.fory.graalvm.Example build time init to native-image.properties configuration:  Args = --initialize-at-build-time=org.apache.fory.graalvm.Example   ","version":"0.12","tagName":"h2"},{"title":"Thread-safe Fory‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.12/guide/graalvm_serialization#thread-safe-fory","content":" import org.apache.fory.Fory; import org.apache.fory.ThreadLocalFory; import org.apache.fory.ThreadSafeFory; import org.apache.fory.util.Preconditions; import java.util.List; import java.util.Map; public class ThreadSafeExample { public record Foo ( int f1, String f2, List&lt;String&gt; f3, Map&lt;String, Long&gt; f4) { } static ThreadSafeFory fory; static { fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().build(); // register and generate serializer code. f.register(Foo.class, true); // ensure lazy initialized serializers being compiled by fory. fory.ensureSerializersCompiled(); return f; }); } public static void main(String[] args) { System.out.println(fory.deserialize(fory.serialize(&quot;abc&quot;))); System.out.println(fory.deserialize(fory.serialize(List.of(1,2,3)))); System.out.println(fory.deserialize(fory.serialize(Map.of(&quot;k1&quot;, 1, &quot;k2&quot;, 2)))); Foo foo = new Foo(10, &quot;abc&quot;, List.of(&quot;str1&quot;, &quot;str2&quot;), Map.of(&quot;k1&quot;, 10L, &quot;k2&quot;, 20L)); System.out.println(foo); byte[] bytes = fory.serialize(foo); Object o = fory.deserialize(bytes); System.out.println(o); } }   Then add org.apache.fory.graalvm.ThreadSafeExample build time init to native-image.properties configuration:  Args = --initialize-at-build-time=org.apache.fory.graalvm.ThreadSafeExample   ","version":"0.12","tagName":"h2"},{"title":"Framework Integration‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.12/guide/graalvm_serialization#framework-integration","content":" For framework developers, if you want to integrate fory for serialization, you can provided a configuration file to let the users to list all the classes they want to serialize, then you can load those classes and invokeorg.apache.fory.Fory.register(Class&lt;?&gt;, boolean) to register those classes in your Fory integration class, and configure that class be initialized at graalvm native image build time.  ","version":"0.12","tagName":"h2"},{"title":"Benchmark‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.12/guide/graalvm_serialization#benchmark","content":" Here we give two class benchmarks between Fory and Graalvm Serialization.  When Fory compression is disabled:  Struct: Fory is 46x speed, 43% size compared to JDK.Pojo: Fory is 12x speed, 56% size compared to JDK.  When Fory compression is enabled:  Struct: Fory is 24x speed, 31% size compared to JDK.Pojo: Fory is 12x speed, 48% size compared to JDK.  See [Benchmark.java] for benchmark code.  ","version":"0.12","tagName":"h2"},{"title":"Struct Benchmark‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.12/guide/graalvm_serialization#struct-benchmark","content":" Class Fields‚Äã  public class Struct implements Serializable { public int f1; public long f2; public float f3; public double f4; public int f5; public long f6; public float f7; public double f8; public int f9; public long f10; public float f11; public double f12; }   Benchmark Results‚Äã  No compression:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Struct Compress number: false Fory size: 76.0 JDK size: 178.0 Fory serialization took mills: 49 JDK serialization took mills: 2254 Compare speed: Fory is 45.70x speed of JDK Compare size: Fory is 0.43x size of JDK   Compress number:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Struct Compress number: true Fory size: 55.0 JDK size: 178.0 Fory serialization took mills: 130 JDK serialization took mills: 3161 Compare speed: Fory is 24.16x speed of JDK Compare size: Fory is 0.31x size of JDK   ","version":"0.12","tagName":"h3"},{"title":"Pojo Benchmark‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.12/guide/graalvm_serialization#pojo-benchmark","content":" Class Fields‚Äã  public class Foo implements Serializable { int f1; String f2; List&lt;String&gt; f3; Map&lt;String, Long&gt; f4; }   Benchmark Results‚Äã  No compression:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Foo Compress number: false Fory size: 541.0 JDK size: 964.0 Fory serialization took mills: 1663 JDK serialization took mills: 16266 Compare speed: Fory is 12.19x speed of JDK Compare size: Fory is 0.56x size of JDK   Compress number:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Foo Compress number: true Fory size: 459.0 JDK size: 964.0 Fory serialization took mills: 1289 JDK serialization took mills: 15069 Compare speed: Fory is 12.11x speed of JDK Compare size: Fory is 0.48x size of JDK  ","version":"0.12","tagName":"h3"},{"title":"Row Format","type":0,"sectionRef":"#","url":"/docs/0.12/guide/row_format","content":"","keywords":"","version":"0.12"},{"title":"Java‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.12/guide/row_format#java","content":" public class Bar { String f1; List&lt;Long&gt; f2; } public class Foo { int f1; List&lt;Integer&gt; f2; Map&lt;String, Integer&gt; f3; List&lt;Bar&gt; f4; } RowEncoder&lt;Foo&gt; encoder = Encoders.bean(Foo.class); Foo foo = new Foo(); foo.f1 = 10; foo.f2 = IntStream.range(0, 1000000).boxed().collect(Collectors.toList()); foo.f3 = IntStream.range(0, 1000000).boxed().collect(Collectors.toMap(i -&gt; &quot;k&quot;+i, i-&gt;i)); List&lt;Bar&gt; bars = new ArrayList&lt;&gt;(1000000); for (int i = 0; i &lt; 1000000; i++) { Bar bar = new Bar(); bar.f1 = &quot;s&quot;+i; bar.f2 = LongStream.range(0, 10).boxed().collect(Collectors.toList()); bars.add(bar); } foo.f4 = bars; // Can be zero-copy read by python BinaryRow binaryRow = encoder.toRow(foo); // can be data from python Foo newFoo = encoder.fromRow(binaryRow); // zero-copy read List&lt;Integer&gt; f2 BinaryArray binaryArray2 = binaryRow.getArray(1); // zero-copy read List&lt;Bar&gt; f4 BinaryArray binaryArray4 = binaryRow.getArray(3); // zero-copy read 11th element of `readList&lt;Bar&gt; f4` BinaryRow barStruct = binaryArray4.getStruct(10); // zero-copy read 6th of f2 of 11th element of `readList&lt;Bar&gt; f4` barStruct.getArray(1).getInt64(5); RowEncoder&lt;Bar&gt; barEncoder = Encoders.bean(Bar.class); // deserialize part of data. Bar newBar = barEncoder.fromRow(barStruct); Bar newBar2 = barEncoder.fromRow(binaryArray4.getStruct(20));   ","version":"0.12","tagName":"h2"},{"title":"Python‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.12/guide/row_format#python","content":" @dataclass class Bar: f1: str f2: List[pa.int64] @dataclass class Foo: f1: pa.int32 f2: List[pa.int32] f3: Dict[str, pa.int32] f4: List[Bar] encoder = pyfory.encoder(Foo) foo = Foo(f1=10, f2=list(range(1000_000)), f3={f&quot;k{i}&quot;: i for i in range(1000_000)}, f4=[Bar(f1=f&quot;s{i}&quot;, f2=list(range(10))) for i in range(1000_000)]) binary: bytes = encoder.to_row(foo).to_bytes() print(f&quot;start: {datetime.datetime.now()}&quot;) foo_row = pyfory.RowData(encoder.schema, binary) print(foo_row.f2[100000], foo_row.f4[100000].f1, foo_row.f4[200000].f2[5]) print(f&quot;end: {datetime.datetime.now()}&quot;) binary = pickle.dumps(foo) print(f&quot;pickle start: {datetime.datetime.now()}&quot;) new_foo = pickle.loads(binary) print(new_foo.f2[100000], new_foo.f4[100000].f1, new_foo.f4[200000].f2[5]) print(f&quot;pickle end: {datetime.datetime.now()}&quot;)   ","version":"0.12","tagName":"h2"},{"title":"Apache Arrow Support‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.12/guide/row_format#apache-arrow-support","content":" Fory Format also supports automatic conversion from/to Arrow Table/RecordBatch.  Java:  Schema schema = TypeInference.inferSchema(BeanA.class); ArrowWriter arrowWriter = ArrowUtils.createArrowWriter(schema); Encoder&lt;BeanA&gt; encoder = Encoders.rowEncoder(BeanA.class); for (int i = 0; i &lt; 10; i++) { BeanA beanA = BeanA.createBeanA(2); arrowWriter.write(encoder.toRow(beanA)); } return arrowWriter.finishAsRecordBatch();   ","version":"0.12","tagName":"h3"},{"title":"Support for Interface and Extension Types‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.12/guide/row_format#support-for-interface-and-extension-types","content":" Fory now supports row format mapping for Java interface types and subclassed (extends) types, enabling more dynamic and flexible data schemas.  These enhancements were introduced in #2243, #2250, and #2256.  ","version":"0.12","tagName":"h2"},{"title":"Example: Interface Mapping with RowEncoder‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.12/guide/row_format#example-interface-mapping-with-rowencoder","content":" public interface Animal { String speak(); } public class Dog implements Animal { public String name; @Override public String speak() { return &quot;Woof&quot;; } } // Encode and decode using RowEncoder with interface type RowEncoder&lt;Animal&gt; encoder = Encoders.bean(Animal.class); Dog dog = new Dog(); dog.name = &quot;Bingo&quot;; BinaryRow row = encoder.toRow(dog); Animal decoded = encoder.fromRow(row); System.out.println(decoded.speak()); // Woof   ","version":"0.12","tagName":"h3"},{"title":"Example: Extension Type with RowEncoder‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.12/guide/row_format#example-extension-type-with-rowencoder","content":" public class Parent { public String parentField; } public class Child extends Parent { public String childField; } // Encode and decode using RowEncoder with parent class type RowEncoder&lt;Parent&gt; encoder = Encoders.bean(Parent.class); Child child = new Child(); child.parentField = &quot;Hello&quot;; child.childField = &quot;World&quot;; BinaryRow row = encoder.toRow(child); Parent decoded = encoder.fromRow(row);   Python:  import pyfory encoder = pyfory.encoder(Foo) encoder.to_arrow_record_batch([foo] * 10000) encoder.to_arrow_table([foo] * 10000)   C++  std::shared_ptr&lt;ArrowWriter&gt; arrow_writer; EXPECT_TRUE( ArrowWriter::Make(schema, ::arrow::default_memory_pool(), &amp;arrow_writer) .ok()); for (auto &amp;row : rows) { EXPECT_TRUE(arrow_writer-&gt;Write(row).ok()); } std::shared_ptr&lt;::arrow::RecordBatch&gt; record_batch; EXPECT_TRUE(arrow_writer-&gt;Finish(&amp;record_batch).ok()); EXPECT_TRUE(record_batch-&gt;Validate().ok()); EXPECT_EQ(record_batch-&gt;num_columns(), schema-&gt;num_fields()); EXPECT_EQ(record_batch-&gt;num_rows(), row_nums);   Schema schema = TypeInference.inferSchema(BeanA.class); ArrowWriter arrowWriter = ArrowUtils.createArrowWriter(schema); Encoder&lt;BeanA&gt; encoder = Encoders.rowEncoder(BeanA.class); for (int i = 0; i &lt; 10; i++) { BeanA beanA = BeanA.createBeanA(2); arrowWriter.write(encoder.toRow(beanA)); } return arrowWriter.finishAsRecordBatch();  ","version":"0.12","tagName":"h3"},{"title":"Type Mapping of Xlang Serialization","type":0,"sectionRef":"#","url":"/docs/0.12/guide/xlang_type_mapping","content":"","keywords":"","version":"0.12"},{"title":"Type Mapping‚Äã","type":1,"pageTitle":"Type Mapping of Xlang Serialization","url":"/docs/0.12/guide/xlang_type_mapping#type-mapping","content":" Fory Type\tFory Type ID\tJava\tPython\tJavascript\tC++\tGolang\tRustbool\t1\tbool/Boolean\tbool\tBoolean\tbool\tbool\tbool int8\t2\tbyte/Byte\tint/pyfory.Int8\tType.int8()\tint8_t\tint8\ti8 int16\t3\tshort/Short\tint/pyfory.Int16\tType.int16()\tint16_t\tint16\ti6 int32\t4\tint/Integer\tint/pyfory.Int32\tType.int32()\tint32_t\tint32\ti32 var_int32\t5\tint/Integer\tint/pyfory.VarInt32\tType.varint32()\tfory::varint32_t\tfory.varint32\tfory::varint32 int64\t6\tlong/Long\tint/pyfory.Int64\tType.int64()\tint64_t\tint64\ti64 var_int64\t7\tlong/Long\tint/pyfory.VarInt64\tType.varint64()\tfory::varint64_t\tfory.varint64\tfory::varint64 sli_int64\t8\tlong/Long\tint/pyfory.SliInt64\tType.sliint64()\tfory::sliint64_t\tfory.sliint64\tfory::sliint64 float16\t9\tfloat/Float\tfloat/pyfory.Float16\tType.float16()\tfory::float16_t\tfory.float16\tfory::f16 float32\t10\tfloat/Float\tfloat/pyfory.Float32\tType.float32()\tfloat\tfloat32\tf32 float64\t11\tdouble/Double\tfloat/pyfory.Float64\tType.float64()\tdouble\tfloat64\tf64 string\t12\tString\tstr\tString\tstring\tstring\tString/str enum\t13\tEnum subclasses\tenum subclasses\t/\tenum\t/\tenum named_enum\t14\tEnum subclasses\tenum subclasses\t/\tenum\t/\tenum struct\t15\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct compatible_struct\t16\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct named_struct\t17\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct named_compatible_struct\t18\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct ext\t19\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct named_ext\t20\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct list\t21\tList/Collection\tlist/tuple\tarray\tvector\tslice\tVec set\t22\tSet\tset\t/\tset\tfory.Set\tSet map\t23\tMap\tdict\tMap\tunordered_map\tmap\tHashMap duration\t24\tDuration\ttimedelta\tNumber\tduration\tDuration\tDuration timestamp\t25\tInstant\tdatetime\tNumber\tstd::chrono::nanoseconds\tTime\tDateTime local_date\t26\tDate\tdatetime\tNumber\tstd::chrono::nanoseconds\tTime\tDateTime decimal\t27\tBigDecimal\tDecimal\tbigint\t/\t/\t/ binary\t28\tbyte[]\tbytes\t/\tuint8_t[n]/vector&lt;T&gt;\t[n]uint8/[]T\tVec&lt;uint8_t&gt; array\t29\tarray\tnp.ndarray\t/\t/\tarray/slice\tVec bool_array\t30\tbool[]\tndarray(np.bool_)\t/\tbool[n]\t[n]bool/[]T\tVec&lt;bool&gt; int8_array\t31\tbyte[]\tndarray(int8)\t/\tint8_t[n]/vector&lt;T&gt;\t[n]int8/[]T\tVec&lt;i18&gt; int16_array\t32\tshort[]\tndarray(int16)\t/\tint16_t[n]/vector&lt;T&gt;\t[n]int16/[]T\tVec&lt;i16&gt; int32_array\t33\tint[]\tndarray(int32)\t/\tint32_t[n]/vector&lt;T&gt;\t[n]int32/[]T\tVec&lt;i32&gt; int64_array\t34\tlong[]\tndarray(int64)\t/\tint64_t[n]/vector&lt;T&gt;\t[n]int64/[]T\tVec&lt;i64&gt; float16_array\t35\tfloat[]\tndarray(float16)\t/\tfory::float16_t[n]/vector&lt;T&gt;\t[n]float16/[]T\tVec&lt;fory::f16&gt; float32_array\t36\tfloat[]\tndarray(float32)\t/\tfloat[n]/vector&lt;T&gt;\t[n]float32/[]T\tVec&lt;f32&gt; float64_array\t37\tdouble[]\tndarray(float64)\t/\tdouble[n]/vector&lt;T&gt;\t[n]float64/[]T\tVec&lt;f64&gt; arrow record batch\t38\t/\t/\t/\t/\t/\t/ arrow table\t39\t/\t/\t/\t/\t/\t/  ","version":"0.12","tagName":"h2"},{"title":"Type info(not implemented currently)‚Äã","type":1,"pageTitle":"Type Mapping of Xlang Serialization","url":"/docs/0.12/guide/xlang_type_mapping#type-infonot-implemented-currently","content":" Due to differences between type systems of languages, those types can't be mapped one-to-one between languages.  If the user notices that one type on a language corresponds to multiple types in Fory type systems, for example, longin java has type int64/varint64/sliint64, it means the language lacks some types, and the user must provide extra type info when using Fory.  ","version":"0.12","tagName":"h2"},{"title":"Type annotation‚Äã","type":1,"pageTitle":"Type Mapping of Xlang Serialization","url":"/docs/0.12/guide/xlang_type_mapping#type-annotation","content":" If the type is a field of another class, users can provide meta hints for fields of a type, or for the whole type. Such information can be provided in other languages too:  java: use annotation.cpp: use macro and template.golang: use struct tag.python: use typehint.rust: use macro.  Here is en example:  Java: class Foo { @Int32Type(varint = true) int f1; List&lt;@Int32Type(varint = true) Integer&gt; f2; } Python: class Foo: f1: Int32Type(varint=True) f2: List[Int32Type(varint=True)]   ","version":"0.12","tagName":"h2"},{"title":"Type wrapper‚Äã","type":1,"pageTitle":"Type Mapping of Xlang Serialization","url":"/docs/0.12/guide/xlang_type_mapping#type-wrapper","content":" If the type is not a field of a class, the user must wrap this type with a Fory type to pass the extra type info.  For example, suppose Fory Java provide a VarInt64 type, when a user invoke fory.serialize(long_value), he need to invoke like fory.serialize(new VarInt64(long_value)). ","version":"0.12","tagName":"h2"},{"title":"Benchmark","type":0,"sectionRef":"#","url":"/docs/0.12/introduction/benchmark","content":"","keywords":"","version":"0.12"},{"title":"Java Serialization‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/0.12/introduction/benchmark#java-serialization","content":"         ","version":"0.12","tagName":"h3"},{"title":"Java Deserialization‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/0.12/introduction/benchmark#java-deserialization","content":"         See benchmarks for more benchmarks about type forward/backward compatibility, off-heap support, zero-copy serialization.  ","version":"0.12","tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/0.12/introduction/benchmark#javascript","content":"   The data used for this bar graph includes a complex object that has many kinds of field types, and the size of the JSON data is 3KB.  See benchmarks for the benchmark code. ","version":"0.12","tagName":"h3"},{"title":"Features","type":0,"sectionRef":"#","url":"/docs/0.12/introduction/features","content":"Features Multiple languages: Java/Python/C++/Golang/Javascript/Rust.Zero-copy: cross-language out-of-band serialization inspired by pickle5 and off-heap read/write.High performance: A highly-extensible JIT framework to generate serializer code at runtime in an async multi-thread way to speed serialization, providing 20-170x speed up by: reduce memory access by inline variable in generated code.reduce virtual method invocation by inline call in generated code.reduce conditional branching.reduce hash lookup.binary protocols: object graph, row format and so on. In addition to cross-language serialization, Apache Fory‚Ñ¢ also features at: Drop-in replace Java serialization frameworks such as JDK/Kryo/Hessian without modifying any code, but 100x faster. It can greatly improve the efficiency of high-performance RPC calls, data transfer and object persistence.JDK serialization 100% compatible, support java custom serializationwriteObject/readObject/writeReplace/readResolve/readObjectNoData natively.Supports shared and circular reference object serialization for golang.Supports automatic object serialization for golang.","keywords":"","version":"0.12"},{"title":"Overview","type":0,"sectionRef":"#","url":"/docs/0.12/introduction/overview","content":"","keywords":"","version":"0.12"},{"title":"Protocols‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.12/introduction/overview#protocols","content":" Different scenarios have different serialization requirements. Apache Fory‚Ñ¢ designed and implemented multiple binary protocols for those requirements:  Cross-language object graph protocol: Cross-language serialize any object automatically, no need for IDL definition, schema compilation and object to/from protocol conversion.Support shared reference and circular reference, no duplicate data or recursion error.Support object polymorphism. Native java/python object graph protocol: highly-optimized based on type system of the language.Row format protocol: a cache-friendly binary random access format, supports skipping serialization and partial serialization, and can convert to column-format automatically.  New protocols can be added easily based on Apache Fory‚Ñ¢ existing buffer, encoding, meta, codegen and other capabilities. All of those share same codebase, and the optimization for one protocol can be reused by another protocol.  ","version":"0.12","tagName":"h2"},{"title":"Compatibility‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.12/introduction/overview#compatibility","content":" ","version":"0.12","tagName":"h2"},{"title":"Schema Compatibility‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.12/introduction/overview#schema-compatibility","content":" Apache Fory‚Ñ¢ java object graph serialization support class schema forward/backward compatibility. The serialization peer and deserialization peer can add/delete fields independently.  We plan to add support cross-language serialization after meta compression are finished.  ","version":"0.12","tagName":"h3"},{"title":"Binary Compatibility‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.12/introduction/overview#binary-compatibility","content":" We are still improving our protocols, binary compatibility are not ensured between Apache Fory‚Ñ¢ releases for now. Please shade Apache Fory‚Ñ¢ if you will upgrade Apache Fory‚Ñ¢ in the future.  Binary compatibility will be ensured before Apache Fory‚Ñ¢ 1.0.  ","version":"0.12","tagName":"h3"},{"title":"Security‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.12/introduction/overview#security","content":" Static serialization such as row format are secure by nature. But dynamic object graph serialization supports deserialize unregistered types, which can introduce security risks.  For example, the deserialization may invoke init constructor or equals/hashCode method, if the method body contains malicious code, the system will be at risks.  Apache Fory‚Ñ¢ provides a class registration mode option and enabled by default for this protocol, which allows deserializing trusted registered types or built-in types only for security.  Apache Fory‚Ñ¢ provides a class registration option and enabled by default for such protocols, which allows only deserializing trusted registered types or built-in types. Do not disable class registration or class registration checks unless you can ensure your environment is indeed secure. We are not responsible for security if you disabled the class registration option.  ","version":"0.12","tagName":"h2"},{"title":"RoadMap‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.12/introduction/overview#roadmap","content":" Meta compression, auto meta sharing and cross-language schema compatibility.AOT Framework for c++/golang to generate code statically.C++/Rust object graph serialization supportGolang/Rust/NodeJS row format supportProtoBuffer compatibility supportProtocols for features and knowledge graph serializationContinuously improve our serialization infrastructure for any new protocols  ","version":"0.12","tagName":"h2"},{"title":"How to Contribute‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.12/introduction/overview#how-to-contribute","content":" Please read the CONTRIBUTING guide for instructions on how to contribute. ","version":"0.12","tagName":"h2"},{"title":"Row Format","type":0,"sectionRef":"#","url":"/docs/0.12/specification/row_format_spec","content":"","keywords":"","version":"0.12"},{"title":"Row Format‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.12/specification/row_format_spec#row-format","content":" Coming soon ","version":"0.12","tagName":"h2"},{"title":"Java Serialization Format","type":0,"sectionRef":"#","url":"/docs/0.12/specification/java_serialization_spec","content":"","keywords":"","version":"0.12"},{"title":"Spec overview‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.12/specification/java_serialization_spec#spec-overview","content":" Fory Java Serialization is an automatic object serialization framework that supports reference and polymorphism. Fory will convert an object from/to fory java serialization binary format. Fory has two core concepts for java serialization:  Fory Java Binary formatFramework to convert object to/from Fory Java Binary format  The serialization format is a dynamic binary format. The dynamics and reference/polymorphism support make Fory flexible, much more easy to use, but also introduce more complexities compared to static serialization frameworks. So the format will be more complex.  Here is the overall format:  | fory header | object ref meta | object class meta | object value data |   The data are serialized using little endian byte order overall. If bytes swap is costly for some object, Fory will write the byte order for that object into the data instead of converting it to little endian.  ","version":"0.12","tagName":"h2"},{"title":"Fory header‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.12/specification/java_serialization_spec#fory-header","content":" Fory header consists starts one byte:  | 4 bits | 1 bit | 1 bit | 1 bit | 1 bit | optional 4 bytes | +---------------+-------+-------+--------+-------+------------------------------------+ | reserved bits | oob | xlang | endian | null | unsigned int for meta start offset |   null flag: 1 when object is null, 0 otherwise. If an object is null, other bits won't be set.endian flag: 1 when data is encoded by little endian, 0 for big endian.xlang flag: 1 when serialization uses xlang format, 0 when serialization uses Fory java format.oob flag: 1 when passed BufferCallback is not null, 0 otherwise.  If meta share mode is enabled, an uncompressed unsigned int is appended to indicate the start offset of metadata.  ","version":"0.12","tagName":"h2"},{"title":"Reference Meta‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.12/specification/java_serialization_spec#reference-meta","content":" Reference tracking handles whether the object is null, and whether to track reference for the object by writing corresponding flags and maintaining internal state.  Reference flags:  Flag\tByte Value\tDescriptionNULL FLAG\t-3\tThis flag indicates the object is a null value. We don't use another byte to indicate REF, so that we can save one byte. REF FLAG\t-2\tThis flag indicates the object is already serialized previously, and fory will write a ref id with unsigned varint format instead of serialize it again NOT_NULL VALUE FLAG\t-1\tThis flag indicates the object is a non-null value and fory doesn't track ref for this type of object. REF VALUE FLAG\t0\tThis flag indicates the object is referencable and the first time to serialize.  When reference tracking is disabled globally or for specific types, or for certain types within a particular context(e.g., a field of a class), only the NULL and NOT_NULL VALUE flags will be used for reference meta.  ","version":"0.12","tagName":"h2"},{"title":"Class Meta‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.12/specification/java_serialization_spec#class-meta","content":" Fory supports to register class by an optional id, the registration can be used for security check and class identification. If a class is registered, it will have a user-provided or an auto-growing unsigned int i.e. class_id.  Depending on whether meta share mode and registration is enabled for current class, Fory will write class meta differently.  ","version":"0.12","tagName":"h2"},{"title":"Schema consistent‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.12/specification/java_serialization_spec#schema-consistent","content":" If schema consistent mode is enabled globally or enabled for current class, class meta will be written as follows:  If class is registered, it will be written as a fory unsigned varint: class_id &lt;&lt; 1.If class is not registered: If class is not an array, fory will write one byte 0bxxxxxxx1 first, then write class name. The first little bit is 1, which is different from first bit 0 of encoded class id. Fory can use this information to determine whether to read class by class id for deserialization. If class is not registered and class is an array, fory will write one byte dimensions &lt;&lt; 1 | 1 first, then write component class subsequently. This can reduce array class name cost if component class is or will be serialized.Class will be written as two enumerated fory unsigned by default: package name and class name. If meta share mode is enabled, class will be written as an unsigned varint which points to index in MetaContext.  ","version":"0.12","tagName":"h3"},{"title":"Schema evolution‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.12/specification/java_serialization_spec#schema-evolution","content":" If schema evolution mode is enabled globally or enabled for current class, class meta will be written as follows:  If meta share mode is not enabled, class meta will be written as schema consistent mode. Additionally, field meta such as field type and name will be written with the field value using a key-value like layout.If meta share mode is enabled, class meta will be written as a meta-share encoded binary if class hasn't been written before, otherwise an unsigned varint id which references to previous written class meta will be written.  ","version":"0.12","tagName":"h3"},{"title":"Meta share‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.12/specification/java_serialization_spec#meta-share","content":" This mode will forbid streaming writing since it needs to look back for update the start offset after the whole object graph writing and meta collecting is finished. Only in this way we can ensure deserialization failure doesn't lost shared meta. Meta streamline will be supported in the future for enclosed meta sharing which doesn't cross multiple serializations of different objects.  For Schema consistent mode, class will be encoded as an enumerated string by full class name. Here we mainly describe the meta layout for schema evolution mode:  | 8 bytes global meta header | 1~2 bytes | variable bytes | variable bytes | variable bytes | +-------------------------------+-------------|--------------------+-------------------+----------------+ | 50 bits hash + 14 bits header | type header | current class meta | parent class meta | ... |   Class meta are encoded from parent class to leaf class, only class with serializable fields will be encoded.  ","version":"0.12","tagName":"h2"},{"title":"Global meta header‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.12/specification/java_serialization_spec#global-meta-header","content":" Meta header is a 64 bits number value encoded in little endian order.  lower 12 bits are used to encode meta size. If meta size &gt;= 0b1111_1111_1111, then writemeta_ size - 0b1111_1111_1111 next.13rd bit is used to indicate whether to write fields meta. When this class is schema-consistent or use registered serializer, fields meta will be skipped. Class Meta will be used for share namespace + type name only.14rd bit is used to indicate whether meta is compressed.Other 50 bits is used to store the unique hash of flags + all layers class meta.  ","version":"0.12","tagName":"h3"},{"title":"Type header‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.12/specification/java_serialization_spec#type-header","content":" Lowest 4 digits 0b0000~0b1110 are used to record num classes. 0b1111 is preserved to indicate that Fory need to read more bytes for length using Fory unsigned int encoding. If current class doesn't has parent class, or parent class doesn't have fields to serialize, or we're in a context which serialize fields of current class only(ObjectStreamSerializer#SlotInfo is an example), num classes will be 1.Other 4 bits are preserved to future extensions.If num classes are greater than or equal to 0b1111, write num_classes - 0b1111 as varuint next.  ","version":"0.12","tagName":"h3"},{"title":"Single layer class meta‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.12/specification/java_serialization_spec#single-layer-class-meta","content":" | unsigned varint | meta string | meta string | field info: variable bytes | variable bytes | ... | +----------------------------+-----------------------+---------------------+-------------------------------+-----------------+-----+ | num fields + register flag | header + package name | header + class name | header + type id + field name | next field info | ... |   num fields: encode num fields &lt;&lt; 1 | register flag(1 when class registered) as unsigned varint. If class is registered, then an unsigned varint class id will be written next, package and class name will be omitted.If current class is schema consistent, then num field will be 0 to flag it.If current class isn't schema consistent, then num field will be the number of compatible fields. For example, users can use tag id to mark some field as compatible field in schema consistent context. In such cases, schema consistent fields will be serialized first, then compatible fields will be serialized next. At deserialization, Fory will use fields info of those fields which aren't annotated by tag id for deserializing schema consistent fields, then use fields info in meta for deserializing compatible fields. Package name encoding(omitted when class is registered): encoding algorithm: UTF8/ALL_TO_LOWER_SPECIAL/LOWER_UPPER_DIGIT_SPECIALHeader: 6 bits size | 2 bits encoding flags. The 6 bits size: 0~63 will be used to indicate size 0~63, the value 63 the size need more byte to read, the encoding will encode size - 63 as a varint next. Class name encoding(omitted when class is registered): encoding algorithm: UTF8/LOWER_UPPER_DIGIT_SPECIAL/FIRST_TO_LOWER_SPECIAL/ALL_TO_LOWER_SPECIALheader: 6 bits size | 2 bits encoding flags. The 6 bits size: 0~63 will be used to indicate size 0~63, the value 63 the size need more byte to read, the encoding will encode size - 63 as a varint next. Field info: header(8 bits): 3 bits size + 2 bits field name encoding + polymorphism flag + nullability flag + ref tracking flag. Users can use annotation to provide those info. 2 bits field name encoding: encoding: UTF8/ALL_TO_LOWER_SPECIAL/LOWER_UPPER_DIGIT_SPECIAL/TAG_IDIf tag id is used, i.e. field name is written by an unsigned varint tag id. 2 bits encoding will be 11. size of field name: The 3 bits size: 0~7 will be used to indicate length 1~7, the value 6 the size read more bytes, the encoding will encode size - 7 as a varint next.If encoding is TAG_ID, then num_bytes of field name will be used to store tag id. ref tracking: when set to 1, ref tracking will be enabled for this field.nullability: when set to 1, this field can be null.polymorphism: when set to 1, the actual type of field will be the declared field type even the type if not final. type id: For registered type-consistent classes, it will be the registered class id.Otherwise it will be encoded as OBJECT_ID if it isn't final and FINAL_OBJECT_ID if it's final. The meta for such types is written separately instead of inlining here is to reduce meta space cost if object of this type is serialized in current object graph multiple times, and the field value may be null too. Field name: If type id is set, type id will be used instead. Otherwise meta string encoding length and data will be written instead.  Field order are left as implementation details, which is not exposed to specification, the deserialization need to resort fields based on Fory field comparator. In this way, fory can compute statistics for field names or types and using a more compact encoding.  ","version":"0.12","tagName":"h3"},{"title":"Other layers class meta‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.12/specification/java_serialization_spec#other-layers-class-meta","content":" Same encoding algorithm as the previous layer except:  header + package name: Header: If package name has been written before: varint index + sharing flag(set) will be writtenIf package name hasn't been written before: If meta string encoding is LOWER_SPECIAL and the length of encoded string &lt;= 64, then header will be6 bits size + encoding flag(set) + sharing flag(unset).Otherwise, header will be 3 bits unset + 3 bits encoding flags + encoding flag(unset) + sharing flag(unset)  ","version":"0.12","tagName":"h3"},{"title":"Meta String‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.12/specification/java_serialization_spec#meta-string","content":" Meta string is mainly used to encode meta strings such as class name and field names.  ","version":"0.12","tagName":"h2"},{"title":"Encoding Algorithms‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.12/specification/java_serialization_spec#encoding-algorithms","content":" String binary encoding algorithm:  Algorithm\tPattern\tDescriptionLOWER_SPECIAL\ta-z._$|\tevery char is written using 5 bits, a-z: 0b00000~0b11001, ._$|: 0b11010~0b11101, prepend one bit at the start to indicate whether strip last char since last byte may have 7 redundant bits(1 indicates strip last char) LOWER_UPPER_DIGIT_SPECIAL\ta-zA-Z0~9._\tevery char is written using 6 bits, a-z: 0b00000~0b11001, A-Z: 0b11010~0b110011, 0~9: 0b110100~0b111101, ._: 0b111110~0b111111, prepend one bit at the start to indicate whether strip last char since last byte may have 7 redundant bits(1 indicates strip last char) UTF-8\tany chars\tUTF-8 encoding  Encoding flags:  Encoding Flag\tPattern\tEncoding AlgorithmLOWER_SPECIAL\tevery char is in a-z._$|\tLOWER_SPECIAL FIRST_TO_LOWER_SPECIAL\tevery char is in a-z[c1,c2] except first char is upper case\treplace first upper case char to lower case, then use LOWER_SPECIAL ALL_TO_LOWER_SPECIAL\tevery char is in a-zA-Z[c1,c2]\treplace every upper case char by | + lower case, then use LOWER_SPECIAL, use this encoding if it's smaller than Encoding LOWER_UPPER_DIGIT_SPECIAL LOWER_UPPER_DIGIT_SPECIAL\tevery char is in a-zA-Z[c1,c2]\tuse LOWER_UPPER_DIGIT_SPECIAL encoding if it's smaller than Encoding FIRST_TO_LOWER_SPECIAL UTF8\tany utf-8 char\tuse UTF-8 encoding Compression\tany utf-8 char\tlossless compression  Notes:  For package name encoding, c1,c2 should be ._; For field/type name encoding, c1,c2 should be _$;Depending on cases, one can choose encoding flags + data jointly, uses 3 bits of first byte for flags and other bytes for data.  ","version":"0.12","tagName":"h3"},{"title":"Shared meta string‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.12/specification/java_serialization_spec#shared-meta-string","content":" The shared meta string format consists of header and encoded string binary. Header of encoded string binary will be inlined in shared meta header.  Header is written using little endian order, Fory can read this flag first to determine how to deserialize the data.  Write by data‚Äã  If string hasn't been written before, the data will be written as follows:  | unsigned varint: string binary size + 1 bit: not written before | 56 bits: unique hash | 3 bits encoding flags + string binary |   If string binary size is less than 16 bytes, the hash will be omitted to save spaces. Unique hash can be omitted too if caller pass a flag to disable it. In such cases, the format will be:  | unsigned varint: string binary size + 1 bit: not written before | 3 bits encoding flags + string binary |   Write by ref‚Äã  If string has been written before, the data will be written as follows:  | unsigned varint: written string id + 1 bit: written before |   ","version":"0.12","tagName":"h3"},{"title":"Value Format‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.12/specification/java_serialization_spec#value-format","content":" ","version":"0.12","tagName":"h2"},{"title":"Basic types‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.12/specification/java_serialization_spec#basic-types","content":" Bool‚Äã  size: 1 byteformat: 0 for false, 1 for true  Byte‚Äã  size: 1 byteformat: write as pure byte.  Short‚Äã  size: 2 bytebyte order: little endian order  Char‚Äã  size: 2 bytebyte order: little endian order  Unsigned int‚Äã  size: 1~5 byteFormat: The most significant bit (MSB) in every byte indicates whether to have the next byte. If first bit is set i.e. b &amp; 0x80 == 0x80, then the next byte should be read until the first bit of the next byte is unset.  Signed int‚Äã  size: 1~5 byteFormat: First convert the number into positive unsigned int by (v &lt;&lt; 1) ^ (v &gt;&gt; 31) ZigZag algorithm, then encoding it as an unsigned int.  Unsigned long‚Äã  size: 1~9 byteFory PVL(Progressive Variable-length Long) Encoding: positive long format: first bit in every byte indicates whether to have the next byte. If first bit is set i.e. b &amp; 0x80 == 0x80, then the next byte should be read until the first bit is unset.  Signed long‚Äã  size: 1~9 byteFory SLI(Small long as int) Encoding: If long is in [-1073741824, 1073741823], encode as 4 bytes int: | little-endian: ((int) value) &lt;&lt; 1 |Otherwise write as 9 bytes: | 0b1 | little-endian 8 bytes long | Fory PVL(Progressive Variable-length Long) Encoding: First convert the number into positive unsigned long by (v &lt;&lt; 1) ^ (v &gt;&gt; 63) ZigZag algorithm to reduce cost of small negative numbers, then encoding it as an unsigned long.  Float‚Äã  size: 4 byteformat: convert float to 4 bytes int by Float.floatToRawIntBits, then write as binary by little endian order.  Double‚Äã  size: 8 byteformat: convert double to 8 bytes int by Double.doubleToRawLongBits, then write as binary by little endian order.  ","version":"0.12","tagName":"h3"},{"title":"String‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.12/specification/java_serialization_spec#string","content":" Format:  | header: size &lt;&lt; 2 | 2 bits encoding flags | binary data |   size + encoding will be concat as a long and encoded as an unsigned var long. The little 2 bits is used for encoding: 0 for latin, 1 for utf-16, 2 for utf-8.encoded string binary data based on encoding: latin/utf-16/utf-8.  Which encoding to choose:  For JDK8: fory detect latin at runtime, if string is latin string, then use latin encoding, otherwise use utf-16.For JDK9+: fory use coder in String object for encoding, latin/utf-16 will be used for encoding.If the string is encoded by utf-8, then fory will use utf-8 to decode the data. But currently fory doesn't enable utf-8 encoding by default for java. Cross-language string serialization of fory uses utf-8 by default.  ","version":"0.12","tagName":"h3"},{"title":"Collection‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.12/specification/java_serialization_spec#collection","content":" All collection serializers must extend AbstractCollectionSerializer.  Format:  length(unsigned varint) | collection header | elements header | elements data   Collection header‚Äã  For ArrayList/LinkedArrayList/HashSet/LinkedHashSet, this will be empty.For TreeSet, this will be ComparatorFor subclass of ArrayList, this may be extra object field info.  Elements header‚Äã  In most cases, all collection elements are same type and not null, elements header will encode those homogeneous information to avoid the cost of writing it for every element. Specifically, there are four kinds of information which will be encoded by elements header, each use one bit:  If track elements ref, use the first bit 0b1 of the header to flag it.If the collection has null, use the second bit 0b10 of the header to flag it. If ref tracking is enabled for this element type, this flag is invalid.If the collection element types are not declared type, use the 3rd bit 0b100 of the header to flag it.If the collection element types are different, use the 4th bit 0b1000 header to flag it.  By default, all bits are unset, which means all elements won't track ref, all elements are same type, not null and the actual element is the declared type in the custom class field.  The implementation can generate different deserialization code based read header, and look up the generated code from a linear map/list.  Elements data‚Äã  Based on the elements header, the serialization of elements data may skip ref flag/null flag/element class info.  CollectionSerializer#write/read can be taken as an example.  ","version":"0.12","tagName":"h3"},{"title":"Array‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.12/specification/java_serialization_spec#array","content":" Primitive array‚Äã  Primitive array are taken as a binary buffer, serialization will just write the length of array size as an unsigned int, then copy the whole buffer into the stream.  Such serialization won't compress the array. If users want to compress primitive array, users need to register custom serializers for such types.  Object array‚Äã  Object array is serialized using the collection format. Object component type will be taken as collection element generic type.  ","version":"0.12","tagName":"h3"},{"title":"Map‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.12/specification/java_serialization_spec#map","content":" All Map serializers must extend AbstractMapSerializer.  Format:  | length(unsigned varint) | map header | key value pairs data |   Map header‚Äã  For HashMap/LinkedHashMap, this will be empty.For TreeMap, this will be ComparatorFor other Map, this may be extra object field info.  Map Key-Value data‚Äã  Map iteration is too expensive, Fory won't compute the header like for collection before since it introduceconsiderable overhead. Users can use MapFieldInfo annotation to provide header in advance. Otherwise Fory will use first key-value pair to predict header optimistically, and update the chunk header if the prediction failed at some pair.  Fory will serialize map chunk by chunk, every chunk has 127 pairs at most.  | 1 byte | 1 byte | variable bytes | +----------------+----------------+-----------------+ | KV header | chunk size: N | N*2 objects |   KV header:  If track key ref, use the first bit 0b1 of the header to flag it.If the key has null, use the second bit 0b10 of the header to flag it. If ref tracking is enabled for this key type, this flag is invalid.If the actual key type of map is not the declared key type, use the 3rd bit 0b100 of the header to flag it.If track value ref, use the 4th bit 0b1000 of the header to flag it.If the value has null, use the 5th bit 0b10000 of the header to flag it. If ref tracking is enabled for this value type, this flag is invalid.If the value type of map is not the declared value type, use the 6rd bit 0b100000 of the header to flag it.If key or value is null, that key and value will be written as a separate chunk, and chunk size writing will be skipped too.  If streaming write is enabled, which means Fory can't update written chunk size. In such cases, map key-value data format will be:  | 1 byte | variable bytes | +----------------+-----------------+ | KV header | N*2 objects |   KV header will be a header marked by MapFieldInfo in java. The implementation can generate different deserialization code based read header, and look up the generated code from a linear map/list.  ","version":"0.12","tagName":"h3"},{"title":"Enum‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.12/specification/java_serialization_spec#enum","content":" Enums are serialized as an unsigned var int. If the order of enum values change, the deserialized enum value may not be the value users expect. In such cases, users must register enum serializer by make it write enum value as an enumerated string with unique hash disabled.  ","version":"0.12","tagName":"h3"},{"title":"Object‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.12/specification/java_serialization_spec#object","content":" Object means object of pojo/struct/bean/record type. Object will be serialized by writing its fields data in fory order.  Depending on schema compatibility, objects will have different formats.  Field order‚Äã  Field will be ordered as following, every group of fields will have its own order:  primitive fields: larger size type first, smaller later, variable size type last.boxed primitive fields: same order as primitive fieldsfinal fields: same type together, then sorted by field name lexicographically.collection fields: same order as final fieldsmap fields: same order as final fieldsother fields: same order as final fields  Schema consistent‚Äã  Object fields will be serialized one by one using following format:  Primitive field value: | var bytes | +----------------+ | value data | +----------------+ Boxed field value: | one byte | var bytes | +-----------+---------------+ | null flag | field value | +-----------+---------------+ field value of final type with ref tracking: | var bytes | var objects | +-----------+-------------+ | ref meta | value data | +-----------+-------------+ field value of final type without ref tracking: | one byte | var objects | +-----------+-------------+ | null flag | field value | +-----------+-------------+ field value of non-final type with ref tracking: | one byte | var bytes | var objects | +-----------+-------------+-------------+ | ref meta | class meta | value data | +-----------+-------------+-------------+ field value of non-final type without ref tracking: | one byte | var bytes | var objects | +-----------+------------+------------+ | null flag | class meta | value data | +-----------+------------+------------+   Schema evolution‚Äã  Schema evolution have similar format as schema consistent mode for object except:  For this object type itself, schema consistent mode will write class by id/name, but schema evolution mode will write class field names, types and other meta too, see Class meta.Class meta of final custom type needs to be written too, because peers may not have this class defined.  ","version":"0.12","tagName":"h3"},{"title":"Class‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.12/specification/java_serialization_spec#class","content":" Class will be serialized using class meta format.  ","version":"0.12","tagName":"h3"},{"title":"Implementation guidelines‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.12/specification/java_serialization_spec#implementation-guidelines","content":" Try to merge multiple bytes into an int/long write before writing to reduce memory IO and bound check cost.Read multiple bytes as an int/long, then split into multiple bytes to reduce memory IO and bound check cost.Try to use one varint/long to write flags and length together to save one byte cost and reduce memory io.Condition branches are less expensive compared to memory IO cost unless there are too many branches. ","version":"0.12","tagName":"h2"},{"title":"Install","type":0,"sectionRef":"#","url":"/docs/0.12/start/install","content":"","keywords":"","version":"0.12"},{"title":"Java‚Äã","type":1,"pageTitle":"Install","url":"/docs/0.12/start/install#java","content":" To add a dependency on Apache Fory‚Ñ¢ using Maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-core&lt;/artifactId&gt; &lt;version&gt;0.12.3&lt;/version&gt; &lt;/dependency&gt; &lt;!-- row/arrow format support --&gt; &lt;!-- &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-format&lt;/artifactId&gt; &lt;version&gt;0.12.3&lt;/version&gt; &lt;/dependency&gt; --&gt;   ","version":"0.12","tagName":"h2"},{"title":"Scala‚Äã","type":1,"pageTitle":"Install","url":"/docs/0.12/start/install#scala","content":" To add a dependency on Apache Fory‚Ñ¢scala for scala 2.13 with maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-scala_2.13&lt;/artifactId&gt; &lt;version&gt;0.12.3&lt;/version&gt; &lt;/dependency&gt;   To add a dependency on Apache Fory‚Ñ¢scala for scala 3 with maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-scala_3&lt;/artifactId&gt; &lt;version&gt;0.12.3&lt;/version&gt; &lt;/dependency&gt;   To add a dependency on Apache Fory‚Ñ¢scala for scala 2.13 with sbt, use the following:  libraryDependencies += &quot;org.apache.fory&quot; % &quot;fory-scala_2.13&quot; % &quot;0.12.3&quot;   To add a dependency on Apache Fory‚Ñ¢scala for scala 3 with sbt, use the following:  libraryDependencies += &quot;org.apache.fory&quot; % &quot;fory-scala_3&quot; % &quot;0.12.3&quot;   ","version":"0.12","tagName":"h2"},{"title":"Kotlin‚Äã","type":1,"pageTitle":"Install","url":"/docs/0.12/start/install#kotlin","content":" To add a dependency on Apache Fory‚Ñ¢kotlin with maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-kotlin&lt;/artifactId&gt; &lt;version&gt;0.12.3&lt;/version&gt; &lt;/dependency&gt;   ","version":"0.12","tagName":"h2"},{"title":"Python‚Äã","type":1,"pageTitle":"Install","url":"/docs/0.12/start/install#python","content":" python -m pip install --upgrade pip pip install pyfory==0.12.3   ","version":"0.12","tagName":"h2"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Install","url":"/docs/0.12/start/install#javascript","content":" Apache Fory‚Ñ¢ is NOT yet available on npm, please install from source code now. ","version":"0.12","tagName":"h2"},{"title":"Xlang Serialization","type":0,"sectionRef":"#","url":"/docs/0.12/guide/xlang_serialization","content":"","keywords":"","version":"0.12"},{"title":"Serialize built-in types‚Äã","type":1,"pageTitle":"Xlang Serialization","url":"/docs/0.12/guide/xlang_serialization#serialize-built-in-types","content":" Common types can be serialized automatically: primitive numeric types, string, binary, array, list, map and so on.  Java  import org.apache.fory.*; import org.apache.fory.config.*; import java.util.*; public class Example1 { public static void main(String[] args) { Fory fory = Fory.builder().withLanguage(Language.XLANG).build(); List&lt;Object&gt; list = ofArrayList(true, false, &quot;str&quot;, -1.1, 1, new int[100], new double[20]); byte[] bytes = fory.serialize(list); // bytes can be data serialized by other languages. fory.deserialize(bytes); Map&lt;Object, Object&gt; map = new HashMap&lt;&gt;(); map.put(&quot;k1&quot;, &quot;v1&quot;); map.put(&quot;k2&quot;, list); map.put(&quot;k3&quot;, -1); bytes = fory.serialize(map); // bytes can be data serialized by other languages. fory.deserialize(bytes); } }   Python  import pyfory import numpy as np fory = pyfory.Fory() object_list = [True, False, &quot;str&quot;, -1.1, 1, np.full(100, 0, dtype=np.int32), np.full(20, 0.0, dtype=np.double)] data = fory.serialize(object_list) # bytes can be data serialized by other languages. new_list = fory.deserialize(data) object_map = {&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: object_list, &quot;k3&quot;: -1} data = fory.serialize(object_map) # bytes can be data serialized by other languages. new_map = fory.deserialize(data) print(new_map)   Golang  package main import forygo &quot;github.com/apache/fory/fory/go/fory&quot; import &quot;fmt&quot; func main() { list := []interface{}{true, false, &quot;str&quot;, -1.1, 1, make([]int32, 10), make([]float64, 20)} fory := forygo.NewFory() bytes, err := fory.Marshal(list) if err != nil { panic(err) } var newValue interface{} // bytes can be data serialized by other languages. if err := fory.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) dict := map[string]interface{}{ &quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: list, &quot;k3&quot;: -1, } bytes, err = fory.Marshal(dict) if err != nil { panic(err) } // bytes can be data serialized by other languages. if err := fory.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) }   JavaScript  import Fory from &quot;@apache-fory/fory&quot;; /** * @apache-fory/hps use v8's fast-calls-api that can be called directly by jit, ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from &quot;@apache-fory/hps&quot;; const fory = new Fory({ hps }); const input = fory.serialize(&quot;hello fory&quot;); const result = fory.deserialize(input); console.log(result);   Rust  use chrono::{NaiveDate, NaiveDateTime}; use fory::{from_buffer, to_buffer, Fory}; use std::collections::HashMap; fn run() { let bin: Vec&lt;u8&gt; = to_buffer(&amp;&quot;hello&quot;.to_string()); let obj: String = from_buffer(&amp;bin).expect(&quot;should success&quot;); assert_eq!(&quot;hello&quot;.to_string(), obj); }   ","version":"0.12","tagName":"h2"},{"title":"Serialize custom types‚Äã","type":1,"pageTitle":"Xlang Serialization","url":"/docs/0.12/guide/xlang_serialization#serialize-custom-types","content":" Serializing user-defined types needs registering the custom type using the register API to establish the mapping relationship between the type in different languages.  Java  import org.apache.fory.*; import org.apache.fory.config.*; import java.util.*; public class Example2 { public static class SomeClass1 { Object f1; Map&lt;Byte, Integer&gt; f2; } public static class SomeClass2 { Object f1; String f2; List&lt;Object&gt; f3; Map&lt;Byte, Integer&gt; f4; Byte f5; Short f6; Integer f7; Long f8; Float f9; Double f10; short[] f11; List&lt;Short&gt; f12; } public static Object createObject() { SomeClass1 obj1 = new SomeClass1(); obj1.f1 = true; obj1.f2 = ofHashMap((byte) -1, 2); SomeClass2 obj = new SomeClass2(); obj.f1 = obj1; obj.f2 = &quot;abc&quot;; obj.f3 = ofArrayList(&quot;abc&quot;, &quot;abc&quot;); obj.f4 = ofHashMap((byte) 1, 2); obj.f5 = Byte.MAX_VALUE; obj.f6 = Short.MAX_VALUE; obj.f7 = Integer.MAX_VALUE; obj.f8 = Long.MAX_VALUE; obj.f9 = 1.0f / 2; obj.f10 = 1 / 3.0; obj.f11 = new short[]{(short) 1, (short) 2}; obj.f12 = ofArrayList((short) -1, (short) 4); return obj; } // mvn exec:java -Dexec.mainClass=&quot;org.apache.fory.examples.Example2&quot; public static void main(String[] args) { Fory fory = Fory.builder().withLanguage(Language.XLANG).build(); fory.register(SomeClass1.class, &quot;example.SomeClass1&quot;); fory.register(SomeClass2.class, &quot;example.SomeClass2&quot;); byte[] bytes = fory.serialize(createObject()); // bytes can be data serialized by other languages. System.out.println(fory.deserialize(bytes)); } }   Python  from dataclasses import dataclass from typing import List, Dict, Any import pyfory, array @dataclass class SomeClass1: f1: Any f2: Dict[pyfory.Int8Type, pyfory.Int32Type] @dataclass class SomeClass2: f1: Any = None f2: str = None f3: List[str] = None f4: Dict[pyfory.Int8Type, pyfory.Int32Type] = None f5: pyfory.Int8Type = None f6: pyfory.Int16Type = None f7: pyfory.Int32Type = None # int type will be taken as `pyfory.Int64Type`. # use `pyfory.Int32Type` for type hint if peer # are more narrow type. f8: int = None f9: pyfory.Float32Type = None # float type will be taken as `pyfory.Float64Type` f10: float = None f11: pyfory.Int16ArrayType = None f12: List[pyfory.Int16Type] = None if __name__ == &quot;__main__&quot;: f = pyfory.Fory() f.register_type(SomeClass1, typename=&quot;example.SomeClass1&quot;) f.register_type(SomeClass2, typename=&quot;example.SomeClass2&quot;) obj1 = SomeClass1(f1=True, f2={-1: 2}) obj = SomeClass2( f1=obj1, f2=&quot;abc&quot;, f3=[&quot;abc&quot;, &quot;abc&quot;], f4={1: 2}, f5=2 ** 7 - 1, f6=2 ** 15 - 1, f7=2 ** 31 - 1, f8=2 ** 63 - 1, f9=1.0 / 2, f10=1 / 3.0, f11=array.array(&quot;h&quot;, [1, 2]), f12=[-1, 4], ) data = f.serialize(obj) # bytes can be data serialized by other languages. print(f.deserialize(data))   Golang  package main import forygo &quot;github.com/apache/fory/fory/go/fory&quot; import &quot;fmt&quot; func main() { type SomeClass1 struct { F1 interface{} F2 string F3 []interface{} F4 map[int8]int32 F5 int8 F6 int16 F7 int32 F8 int64 F9 float32 F10 float64 F11 []int16 F12 fory.Int16Slice } type SomeClas2 struct { F1 interface{} F2 map[int8]int32 } fory := forygo.NewFory() if err := fory.RegisterTagType(&quot;example.SomeClass1&quot;, SomeClass1{}); err != nil { panic(err) } if err := fory.RegisterTagType(&quot;example.SomeClass2&quot;, SomeClass2{}); err != nil { panic(err) } obj1 := &amp;SomeClass1{} obj1.F1 = true obj1.F2 = map[int8]int32{-1: 2} obj := &amp;SomeClass1{} obj.F1 = obj1 obj.F2 = &quot;abc&quot; obj.F3 = []interface{}{&quot;abc&quot;, &quot;abc&quot;} f4 := map[int8]int32{1: 2} obj.F4 = f4 obj.F5 = fory.MaxInt8 obj.F6 = fory.MaxInt16 obj.F7 = fory.MaxInt32 obj.F8 = fory.MaxInt64 obj.F9 = 1.0 / 2 obj.F10 = 1 / 3.0 obj.F11 = []int16{1, 2} obj.F12 = []int16{-1, 4} bytes, err := fory.Marshal(obj); if err != nil { panic(err) } var newValue interface{} // bytes can be data serialized by other languages. if err := fory.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) }   JavaScript  import Fory, { Type, InternalSerializerType } from &quot;@apache-fory/fory&quot;; /** * @apache-fory/hps use v8's fast-calls-api that can be called directly by jit, ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from &quot;@apache-fory/hps&quot;; // Now we describe data structures using JSON, but in the future, we will use more ways. const description = Type.object(&quot;example.foo&quot;, { foo: Type.string(), }); const fory = new Fory({ hps }); const { serialize, deserialize } = fory.registerSerializer(description); const input = serialize({ foo: &quot;hello fory&quot; }); const result = deserialize(input); console.log(result);   Rust  use chrono::{NaiveDate, NaiveDateTime}; use fory::{from_buffer, to_buffer, Fory}; use std::collections::HashMap; #[test] fn complex_struct() { #[derive(Fory, Debug, PartialEq)] #[tag(&quot;example.foo2&quot;)] struct Animal { category: String, } #[derive(Fory, Debug, PartialEq)] #[tag(&quot;example.foo&quot;)] struct Person { c1: Vec&lt;u8&gt;, // binary c2: Vec&lt;i16&gt;, // primitive array animal: Vec&lt;Animal&gt;, c3: Vec&lt;Vec&lt;u8&gt;&gt;, name: String, c4: HashMap&lt;String, String&gt;, age: u16, op: Option&lt;String&gt;, op2: Option&lt;String&gt;, date: NaiveDate, time: NaiveDateTime, c5: f32, c6: f64, } let person: Person = Person { c1: vec![1, 2, 3], c2: vec![5, 6, 7], c3: vec![vec![1, 2], vec![1, 3]], animal: vec![Animal { category: &quot;Dog&quot;.to_string(), }], c4: HashMap::from([ (&quot;hello1&quot;.to_string(), &quot;hello2&quot;.to_string()), (&quot;hello2&quot;.to_string(), &quot;hello3&quot;.to_string()), ]), age: 12, name: &quot;helo&quot;.to_string(), op: Some(&quot;option&quot;.to_string()), op2: None, date: NaiveDate::from_ymd_opt(2025, 12, 12).unwrap(), time: NaiveDateTime::from_timestamp_opt(1689912359, 0).unwrap(), c5: 2.0, c6: 4.0, }; let bin: Vec&lt;u8&gt; = to_buffer(&amp;person); let obj: Person = from_buffer(&amp;bin).expect(&quot;should success&quot;); assert_eq!(person, obj); }   ","version":"0.12","tagName":"h2"},{"title":"Serialize Shared Reference and Circular Reference‚Äã","type":1,"pageTitle":"Xlang Serialization","url":"/docs/0.12/guide/xlang_serialization#serialize-shared-reference-and-circular-reference","content":" Shared reference and circular reference can be serialized automatically, no duplicate data or recursion error.  Java  import org.apache.fory.*; import org.apache.fory.config.*; import java.util.*; public class ReferenceExample { public static class SomeClass { SomeClass f1; Map&lt;String, String&gt; f2; Map&lt;String, String&gt; f3; } public static Object createObject() { SomeClass obj = new SomeClass(); obj.f1 = obj; obj.f2 = ofHashMap(&quot;k1&quot;, &quot;v1&quot;, &quot;k2&quot;, &quot;v2&quot;); obj.f3 = obj.f2; return obj; } // mvn exec:java -Dexec.mainClass=&quot;org.apache.fory.examples.ReferenceExample&quot; public static void main(String[] args) { Fory fory = Fory.builder().withLanguage(Language.XLANG) .withRefTracking(true).build(); fory.register(SomeClass.class, &quot;example.SomeClass&quot;); byte[] bytes = fory.serialize(createObject()); // bytes can be data serialized by other languages. System.out.println(fory.deserialize(bytes)); } }   Python  from typing import Dict import pyfory class SomeClass: f1: &quot;SomeClass&quot; f2: Dict[str, str] f3: Dict[str, str] fory = pyfory.Fory(ref_tracking=True) fory.register_type(SomeClass, typename=&quot;example.SomeClass&quot;) obj = SomeClass() obj.f2 = {&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: &quot;v2&quot;} obj.f1, obj.f3 = obj, obj.f2 data = fory.serialize(obj) # bytes can be data serialized by other languages. print(fory.deserialize(data))   Golang  package main import forygo &quot;github.com/apache/fory/fory/go/fory&quot; import &quot;fmt&quot; func main() { type SomeClass struct { F1 *SomeClass F2 map[string]string F3 map[string]string } fory := forygo.NewFory(true) if err := fory.RegisterTagType(&quot;example.SomeClass&quot;, SomeClass{}); err != nil { panic(err) } value := &amp;SomeClass{F2: map[string]string{&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: &quot;v2&quot;}} value.F3 = value.F2 value.F1 = value bytes, err := fory.Marshal(value) if err != nil { } var newValue interface{} // bytes can be data serialized by other languages. if err := fory.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) }   JavaScript  import Fory, { Type } from '@apache-fory/fory'; /** * @apache-fory/hps use v8's fast-calls-api that can be called directly by jit, ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from '@apache-fory/hps'; const description = Type.object('example.foo', { foo: Type.string(), bar: Type.object('example.foo'), }); const fory = new Fory({ hps }); const { serialize, deserialize } = fory.registerSerializer(description); const data: any = { foo: 'hello fory', }; data.bar = data; const input = serialize(data); const result = deserialize(input); console.log(result.bar.foo === result.foo);   JavaScriptReference cannot be implemented because of rust ownership restrictions  ","version":"0.12","tagName":"h2"},{"title":"Zero-Copy Serialization‚Äã","type":1,"pageTitle":"Xlang Serialization","url":"/docs/0.12/guide/xlang_serialization#zero-copy-serialization","content":" Java  import org.apache.fory.*; import org.apache.fory.config.*; import org.apache.fory.serializer.BufferObject; import org.apache.fory.memory.MemoryBuffer; import java.util.*; import java.util.stream.Collectors; public class ZeroCopyExample { // mvn exec:java -Dexec.mainClass=&quot;io.ray.fory.examples.ZeroCopyExample&quot; public static void main(String[] args) { Fory fory = Fory.builder().withLanguage(Language.XLANG).build(); List&lt;Object&gt; list = ofArrayList(&quot;str&quot;, new byte[1000], new int[100], new double[100]); Collection&lt;BufferObject&gt; bufferObjects = new ArrayList&lt;&gt;(); byte[] bytes = fory.serialize(list, e -&gt; !bufferObjects.add(e)); // bytes can be data serialized by other languages. List&lt;MemoryBuffer&gt; buffers = bufferObjects.stream() .map(BufferObject::toBuffer).collect(Collectors.toList()); System.out.println(fory.deserialize(bytes, buffers)); } }   Python  import array import pyfory import numpy as np fory = pyfory.Fory() list_ = [&quot;str&quot;, bytes(bytearray(1000)), array.array(&quot;i&quot;, range(100)), np.full(100, 0.0, dtype=np.double)] serialized_objects = [] data = fory.serialize(list_, buffer_callback=serialized_objects.append) buffers = [o.to_buffer() for o in serialized_objects] # bytes can be data serialized by other languages. print(fory.deserialize(data, buffers=buffers))   Golang  package main import forygo &quot;github.com/apache/fory/fory/go/fory&quot; import &quot;fmt&quot; func main() { fory := forygo.NewFory() list := []interface{}{&quot;str&quot;, make([]byte, 1000)} buf := fory.NewByteBuffer(nil) var bufferObjects []fory.BufferObject fory.Serialize(buf, list, func(o fory.BufferObject) bool { bufferObjects = append(bufferObjects, o) return false }) var newList []interface{} var buffers []*fory.ByteBuffer for _, o := range bufferObjects { buffers = append(buffers, o.ToBuffer()) } if err := fory.Deserialize(buf, &amp;newList, buffers); err != nil { panic(err) } fmt.Println(newList) }   JavaScript  // Coming soon  ","version":"0.12","tagName":"h2"},{"title":"Xlang Serialization Format","type":0,"sectionRef":"#","url":"/docs/0.12/specification/xlang_serialization_spec","content":"","keywords":"","version":"0.12"},{"title":"Cross-language Serialization Specification‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#cross-language-serialization-specification","content":" Format Version History: Version 0.1 - serialization spec formalized  Fory xlang serialization is an automatic object serialization framework that supports reference and polymorphism. Fory will convert an object from/to fory xlang serialization binary format. Fory has two core concepts for xlang serialization:  Fory xlang binary formatFramework implemented in different languages to convert object to/from Fory xlang binary format  The serialization format is a dynamic binary format. The dynamics and reference/polymorphism support make Fory flexible, much more easy to use, but also introduce more complexities compared to static serialization frameworks. So the format will be more complex.  ","version":"0.12","tagName":"h2"},{"title":"Type Systems‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#type-systems","content":" ","version":"0.12","tagName":"h2"},{"title":"Data Types‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#data-types","content":" bool: a boolean value (true or false).int8: a 8-bit signed integer.int16: a 16-bit signed integer.int32: a 32-bit signed integer.var_int32: a 32-bit signed integer which use fory var_int32 encoding.int64: a 64-bit signed integer.var_int64: a 64-bit signed integer which use fory PVL encoding.sli_int64: a 64-bit signed integer which use fory SLI encoding.float16: a 16-bit floating point number.float32: a 32-bit floating point number.float64: a 64-bit floating point number including NaN and Infinity.string: a text string encoded using Latin1/UTF16/UTF-8 encoding.enum: a data type consisting of a set of named values. Rust enum with non-predefined field values are not supported as an enum.named_enum: an enum whose value will be serialized as the registered name.struct: a morphic(final) type serialized by Fory Struct serializer. i.e. it doesn't have subclasses. Suppose we're deserializing List&lt;SomeClass&gt;, we can save dynamic serializer dispatch since SomeClass is morphic(final).compatible_struct: a morphic(final) type serialized by Fory compatible Struct serializer.named_struct: a struct whose type mapping will be encoded as a name.named_compatible_struct: a compatible_struct whose type mapping will be encoded as a name.ext: a type which will be serialized by a customized serializer.named_ext: an ext type whose type mapping will be encoded as a name.list: a sequence of objects.set: an unordered set of unique elements.map: a map of key-value pairs. Mutable types such as list/map/set/array/tensor/arrow are not allowed as key of map.duration: an absolute length of time, independent of any calendar/timezone, as a count of nanoseconds.timestamp: a point in time, independent of any calendar/timezone, as a count of nanoseconds. The count is relative to an epoch at UTC midnight on January 1, 1970.local_date: a naive date without timezone. The count is days relative to an epoch at UTC midnight on Jan 1, 1970.decimal: exact decimal value represented as an integer value in two's complement.binary: an variable-length array of bytes.array: only allow 1d numeric components. Other arrays will be taken as List. The implementation should support the interoperability between array and list. bool_array: one dimensional bool array.int8_array: one dimensional int8 array.int16_array: one dimensional int16 array.int32_array: one dimensional int32 array.int64_array: one dimensional int64 array.float16_array: one dimensional half_float_16 array.float32_array: one dimensional float32 array.float64_array: one dimensional float64 array. tensor: multidimensional array which every sub-array have same size and type.arrow record batch: an arrow record batch object.arrow table: an arrow table object.  Note:  Unsigned int/long are not added here, since not every language support those types.  ","version":"0.12","tagName":"h3"},{"title":"Polymorphisms‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#polymorphisms","content":" For polymorphism, if one non-final class is registered, and only one subclass is registered, then we can take all elements in List/Map have same type, thus reduce runtime check cost.  Collection/Array polymorphism are not fully supported, since some languages such as golang have only one collection type. If users want to get exactly the type he passed, he must pass that type when deserializing or annotate that type to the field of struct.  ","version":"0.12","tagName":"h3"},{"title":"Type disambiguation‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#type-disambiguation","content":" Due to differences between type systems of languages, those types can't be mapped one-to-one between languages. When deserializing, Fory use the target data structure type and the data type in the data jointly to determine how to deserialize and populate the target data structure. For example:  class Foo { int[] intArray; Object[] objects; List&lt;Object&gt; objectList; } class Foo2 { int[] intArray; List&lt;Object&gt; objects; List&lt;Object&gt; objectList; }   intArray has an int32_array type. But both objects and objectList fields in the serialize data have list data type. When deserializing, the implementation will create an Object array for objects, but create a ArrayListfor objectList to populate its elements. And the serialized data of Foo can be deserialized into Foo2 too.  Users can also provide meta hints for fields of a type, or the type whole. Here is an example in java which use annotation to provide such information.  @ForyObject(fieldsNullable = false, trackingRef = false) class Foo { @ForyField(trackingRef = false) int[] intArray; @ForyField(polymorphic = true) Object object; @ForyField(tagId = 1, nullable = true) List&lt;Object&gt; objectList; }   Such information can be provided in other languages too:  cpp: use macro and template.golang: use struct tag.python: use typehint.rust: use macro.  ","version":"0.12","tagName":"h3"},{"title":"Type ID‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#type-id","content":" All internal data types are expressed using an ID in range 0~64. Users can use 0~4096 for representing their types.  ","version":"0.12","tagName":"h3"},{"title":"Type mapping‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#type-mapping","content":" See Type mapping  ","version":"0.12","tagName":"h3"},{"title":"Spec overview‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#spec-overview","content":" Here is the overall format:  | fory header | object ref meta | object type meta | object value data |   The data are serialized using little endian byte order overall. If bytes swap is costly for some object, Fory will write the byte order for that object into the data instead of converting it to little endian.  ","version":"0.12","tagName":"h2"},{"title":"Fory header‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#fory-header","content":" Fory header consists starts one byte:  | 2 bytes | 4 bits | 1 bit | 1 bit | 1 bit | 1 bit | 1 byte | optional 4 bytes | +--------------+---------------+-------+-------+--------+-------+------------+------------------------------------+ | magic number | reserved bits | oob | xlang | endian | null | language | unsigned int for meta start offset |   magic number: used to identify fory serialization protocol, current version use 0x62d4.null flag: 1 when object is null, 0 otherwise. If an object is null, other bits won't be set.endian flag: 1 when data is encoded by little endian, 0 for big endian.xlang flag: 1 when serialization uses xlang format, 0 when serialization uses Fory java format.oob flag: 1 when passed BufferCallback is not null, 0 otherwise.language: the language when serializing objects, such as JAVA, PYTHON, GO, etc. Fory can use this flag to determine whether spend more time on serialization to make the deserialization faster for dynamic languages.  If meta share mode is enabled, an uncompressed unsigned int is appended to indicate the start offset of metadata.  ","version":"0.12","tagName":"h2"},{"title":"Reference Meta‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#reference-meta","content":" Reference tracking handles whether the object is null, and whether to track reference for the object by writing corresponding flags and maintaining internal state.  Reference flags:  Flag\tByte Value\tDescriptionNULL FLAG\t-3\tThis flag indicates the object is a null value. We don't use another byte to indicate REF, so that we can save one byte. REF FLAG\t-2\tThis flag indicates the object is already serialized previously, and fory will write a ref id with unsigned varint format instead of serialize it again NOT_NULL VALUE FLAG\t-1\tThis flag indicates the object is a non-null value and fory doesn't track ref for this type of object. REF VALUE FLAG\t0\tThis flag indicates the object is referencable and the first time to serialize.  When reference tracking is disabled globally or for specific types, or for certain types within a particular context(e.g., a field of a type), only the NULL and NOT_NULL VALUE flags will be used for reference meta.  For languages which doesn't support reference such as rust, reference tracking must be disabled for correct deserialization by fory rust implementation.  For languages whose object values are not null by default:  In rust, Fory takes Option:None as a null valueIn c++, Fory takes std::nullopt as a null valueIn golang, Fory takes null interface/pointer as a null value  If one want to deserialize in languages like Java/Python/JavaScript, he should mark the type with all fields not-null by default, or using schema-evolution mode to carry the not-null fields info in the data.  ","version":"0.12","tagName":"h2"},{"title":"Type Meta‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#type-meta","content":" For every type to be serialized, it have a type id to indicate its type.  basic types: the type idenum: Type.ENUM + registered idType.NAMED_ENUM + registered namespace+typename list: Type.Listset: Type.SETmap: Type.MAPext: Type.EXT + registered idType.NAMED_EXT + registered namespace+typename struct: Type.STRUCT + struct metaType.NAMED_STRUCT + struct meta  Every type must be registered with an ID or name first. The registration can be used for security check and type identification.  Struct is a special type, depending whether schema compatibility is enabled, Fory will write struct meta differently.  ","version":"0.12","tagName":"h2"},{"title":"Struct Schema consistent‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#struct-schema-consistent","content":" If schema consistent mode is enabled globally when creating fory, type meta will be written as a fory unsigned varint of type_id. Schema evolution related meta will be ignored.If schema evolution mode is enabled globally when creating fory, and current class is configured to use schema consistent mode like struct vs table in flatbuffers: Type meta will be add to captured_type_defs: captured_type_defs[type def stub] = map size ahead when registering type.Get index of the meta in captured_type_defs, write that index as | unsigned varint: index |.  ","version":"0.12","tagName":"h3"},{"title":"Struct Schema evolution‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#struct-schema-evolution","content":" If schema evolution mode is enabled globally when creating fory, and enabled for current type, type meta will be written using one of the following mode. Which mode to use is configured when creating fory.  Normal mode(meta share not enabled): If type meta hasn't been written before, add type defto captured_type_defs: captured_type_defs[type def] = map size.Get index of the meta in captured_type_defs, write that index as | unsigned varint: index |.After finished the serialization of the object graph, fory will start to write captured_type_defs: Firstly, set current to meta start offset of fory header Then write captured_type_defs one by one: buffer.write_var_uint32(len(writting_type_defs) - len(schema_consistent_type_def_stubs)) for type_meta in writting_type_defs: if not type_meta.is_stub(): type_meta.write_type_def(buffer) writing_type_defs = copy(schema_consistent_type_def_stubs) Meta share mode: the writing steps are same as the normal mode, but captured_type_defs will be shared across multiple serializations of different objects. For example, suppose we have a batch to serialize: captured_type_defs = {} stream = ... # add `Type1` to `captured_type_defs` and write `Type1` fory.serialize(stream, [Type1()]) # add `Type2` to `captured_type_defs` and write `Type2`, `Type1` is written before. fory.serialize(stream, [Type1(), Type2()]) # `Type1` and `Type2` are written before, no need to write meta. fory.serialize(stream, [Type1(), Type2()]) Streaming mode(streaming mode doesn't support meta share): If type meta hasn't been written before, the data will be written as: | unsigned varint: 0b11111111 | type def | If type meta has been written before, the data will be written as: | unsigned varint: written index &lt;&lt; 1 | written index is the id in captured_type_defs. With this mode, meta start offset can be omitted.  The normal mode and meta share mode will forbid streaming writing since it needs to look back for update the start offset after the whole object graph writing and meta collecting is finished. Only in this way we can ensure deserialization failure in meta share mode doesn't lost shared meta.  Type Def‚Äã  Here we mainly describe the meta layout for schema evolution mode:  | 8 bytes header | variable bytes | variable bytes | +----------------------+--------------------+-------------------+ | global binary header | meta header | fields meta |   For languages which support inheritance, if parent class and subclass has fields with same name, using field in subclass.  Global binary header‚Äã  50 bits hash + 1bit compress flag + write fields meta + 12 bits meta size. Right is the lower bits.  lower 12 bits are used to encode meta size. If meta size &gt;= 0b1111_1111_1111, then writemeta_ size - 0b1111_1111_1111 next.13rd bit is used to indicate whether to write fields meta. When this class is schema-consistent or use registered serializer, fields meta will be skipped. Class Meta will be used for share namespace + type name only.14rd bit is used to indicate whether meta is compressed.Other 50 bits is used to store the unique hash of flags + all layers class meta.  Meta header‚Äã  Meta header is a 8 bits number value.  Lowest 5 digits 0b00000~0b11110 are used to record num fields. 0b11111 is preserved to indicate that Fory need to read more bytes for length using Fory unsigned int encoding. Note that num_fields is the number of compatible fields. Users can use tag id to mark some fields as compatible fields in schema consistent context. In such cases, schema consistent fields will be serialized first, then compatible fields will be serialized next. At deserialization, Fory will use fields info of those fields which aren't annotated by tag id for deserializing schema consistent fields, then use fields info in meta for deserializing compatible fields.The 6th bit: 0 for registered by id, 1 for registered by name.Remaining 2 bits are reserved for future extension.  Fields meta‚Äã  Format:  | field info: variable bytes | variable bytes | ... | +---------------------------------+-----------------+-----+ | header + type info + field name | next field info | ... |   Field Header‚Äã  Field Header is 8 bits, annotation can be used to provide more specific info. If annotation not exists, fory will infer those info automatically.  The format for field header is:  2 bits field name encoding + 4 bits size + nullability flag + ref tracking flag   Detailed spec:  2 bits field name encoding: encoding: UTF8/ALL_TO_LOWER_SPECIAL/LOWER_UPPER_DIGIT_SPECIAL/TAG_IDIf tag id is used, field name will be written by an unsigned varint tag id, and 2 bits encoding will be 11. size of field name: The 4 bits size: 0~14 will be used to indicate length 1~15, the value 15 indicates to read more bytes, the encoding will encode size - 15 as a varint next.If encoding is TAG_ID, then num_bytes of field name will be used to store tag id. ref tracking: when set to 1, ref tracking will be enabled for this field.nullability: when set to 1, this field can be null.  Field Type Info‚Äã  Field type info is written as unsigned int8. Detailed id spec is:  For struct registered by id, it will be Type.STRUCT.For struct registered by name, it will be Type.NAMED_STRUCT.For enum registered by id, it will be Type.ENUM.For enum registered by name, it will be Type.NAMED_ENUM.For ext type registered by id, it will be Type.EXT.For ext type registered by name, it will be Type.NAMED_EXT.For list/set type, it will be written as Type.LIST/SET, then write element type recursively.For 1D primitive array type, it will be written as Type.XXX_ARRAY.For multi-dimensional primitive array type with same size on each dim, it will be written as Type.TENSOR.For other array type, it will be written as Type.LIST, then write element type recursively.For map type, it will be written as Type.MAP, then write key and value type recursively.For other types supported by fory directly, it will be fory type id for that type.For other types not determined at compile time, write Type.UNKNOWN instead. For such types, actual type will be written when serializing such field values.  Polymorphism spec:  struct/named_struct/ext/named_ext are taken as polymorphic, the meta for those types are written separately instead of inlining here to reduce meta space cost if object of this type is serialized in current object graph multiple times, and the field value may be null too.enum is taken as morphic, if deserialization doesn't have this field, or the type is not enum, enum value will be skipped.list/map/set are taken as morphic, when serializing values of those type, the concrete types won't be written again.Other types that fory supported are taken as morphic too.  List/Set/Map nested type spec:  list: | list type id | nested type id &lt;&lt; 2 + nullability flag + ref tracking flag | ... multi-layer type info |set: | set type id | nested type id &lt;&lt; 2 + nullability flag + ref tracking flag | ... multi-layer type info |map: | set type id | key type info | value type info | Key type format: | nested type id &lt;&lt; 2 + nullability flag + ref tracking flag | ... multi-layer type info |Value type format: | nested type id &lt;&lt; 2 + nullability flag + ref tracking flag | ... multi-layer type info |  Field Name‚Äã  If tag id is set, tag id will be used instead. Otherwise meta string of field name will be written instead.  Field order‚Äã  Field order are left as implementation details, which is not exposed to specification, the deserialization need to resort fields based on Fory fields sort algorithms. In this way, fory can compute statistics for field names or types and using a more compact encoding.  ","version":"0.12","tagName":"h3"},{"title":"Extended Type Meta with Inheritance support‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#extended-type-meta-with-inheritance-support","content":" If one want to support inheritance for struct, one can implement following spec.  ","version":"0.12","tagName":"h2"},{"title":"Schema consistent‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#schema-consistent","content":" Fields are serialized from parent type to leaf type. Fields are sorted using fory struct fields sort algorithms.  ","version":"0.12","tagName":"h3"},{"title":"Schema Evolution‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#schema-evolution","content":" Meta layout for schema evolution mode:  | 8 bytes header | variable bytes | variable bytes | variable bytes | variable bytes | +----------------------+----------------+----------------+--------------------+--------------------+ | global binary header | meta header | fields meta | parent meta header | parent fields meta |   Meta header‚Äã  Meta header is a 64 bits number value encoded in little endian order.  Lowest 4 digits 0b0000~0b1110 are used to record num classes. 0b1111 is preserved to indicate that Fory need to read more bytes for length using Fory unsigned int encoding. If current type doesn't has parent type, or parent type doesn't have fields to serialize, or we're in a context which serialize fields of current type only, num classes will be 1.The 5th bit is used to indicate whether this type needs schema evolution.Other 56 bits are used to store the unique hash of flags + all layers type meta.  Single layer type meta‚Äã  | unsigned varint | var uint | field info: variable bytes | variable bytes | ... | +-----------------+----------+-------------------------------+-----------------+-----+ | num_fields | type id | header + type id + field name | next field info | ... |   Other layers type meta‚Äã  Same encoding algorithm as the previous layer.  ","version":"0.12","tagName":"h3"},{"title":"Meta String‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#meta-string","content":" Meta string is mainly used to encode meta strings such as field names.  ","version":"0.12","tagName":"h2"},{"title":"Encoding Algorithms‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#encoding-algorithms","content":" String binary encoding algorithm:  Algorithm\tPattern\tDescriptionLOWER_SPECIAL\ta-z._$|\tevery char is written using 5 bits, a-z: 0b00000~0b11001, ._$|: 0b11010~0b11101, prepend one bit at the start to indicate whether strip last char since last byte may have 7 redundant bits(1 indicates strip last char) LOWER_UPPER_DIGIT_SPECIAL\ta-zA-Z0~9._\tevery char is written using 6 bits, a-z: 0b00000~0b11001, A-Z: 0b11010~0b110011, 0~9: 0b110100~0b111101, ._: 0b111110~0b111111, prepend one bit at the start to indicate whether strip last char since last byte may have 7 redundant bits(1 indicates strip last char) UTF-8\tany chars\tUTF-8 encoding  Encoding flags:  Encoding Flag\tPattern\tEncoding AlgorithmLOWER_SPECIAL\tevery char is in a-z._|\tLOWER_SPECIAL FIRST_TO_LOWER_SPECIAL\tevery char is in a-z._ except first char is upper case\treplace first upper case char to lower case, then use LOWER_SPECIAL ALL_TO_LOWER_SPECIAL\tevery char is in a-zA-Z._\treplace every upper case char by | + lower case, then use LOWER_SPECIAL, use this encoding if it's smaller than Encoding LOWER_UPPER_DIGIT_SPECIAL LOWER_UPPER_DIGIT_SPECIAL\tevery char is in a-zA-Z._\tuse LOWER_UPPER_DIGIT_SPECIAL encoding if it's smaller than Encoding FIRST_TO_LOWER_SPECIAL UTF8\tany utf-8 char\tuse UTF-8 encoding Compression\tany utf-8 char\tlossless compression  Notes:  Depending on cases, one can choose encoding flags + data jointly, uses 3 bits of first byte for flags and other bytes for data.  ","version":"0.12","tagName":"h3"},{"title":"Value Format‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#value-format","content":" ","version":"0.12","tagName":"h2"},{"title":"Basic types‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#basic-types","content":" bool‚Äã  size: 1 byteformat: 0 for false, 1 for true  int8‚Äã  size: 1 byteformat: write as pure byte.  int16‚Äã  size: 2 bytebyte order: raw bytes of little endian order  unsigned int32‚Äã  size: 4 bytebyte order: raw bytes of little endian order  unsigned varint32‚Äã  size: 1~5 byteFormat: The most significant bit (MSB) in every byte indicates whether to have the next byte. If first bit is set i.e. b &amp; 0x80 == 0x80, then the next byte should be read until the first bit of the next byte is unset.  signed int32‚Äã  size: 4 bytebyte order: raw bytes of little endian order  signed varint32‚Äã  size: 1~5 byteFormat: First convert the number into positive unsigned int by (v &lt;&lt; 1) ^ (v &gt;&gt; 31) ZigZag algorithm, then encode it as an unsigned varint.  unsigned int64‚Äã  size: 8 bytebyte order: raw bytes of little endian order  unsigned varint64‚Äã  size: 1~9 byteFory SLI(Small long as int) Encoding: If long is in [0, 2147483647], encode as 4 bytes int: | little-endian: ((int) value) &lt;&lt; 1 |Otherwise write as 9 bytes: | 0b1 | little-endian 8 bytes long | Fory PVL(Progressive Variable-length Long) Encoding: positive long format: first bit in every byte indicates whether to have the next byte. If first bit is set i.e. b &amp; 0x80 == 0x80, then the next byte should be read until the first bit is unset.  signed int64‚Äã  size: 8 bytebyte order: raw bytes of little endian order  signed varint64‚Äã  size: 1~9 byteFory SLI(Small long as int) Encoding: If long is in [-1073741824, 1073741823], encode as 4 bytes int: | little-endian: ((int) value) &lt;&lt; 1 |Otherwise write as 9 bytes: | 0b1 | little-endian 8 bytes long | Fory PVL(Progressive Variable-length Long) Encoding: First convert the number into positive unsigned long by (v &lt;&lt; 1) ^ (v &gt;&gt; 63) ZigZag algorithm to reduce cost of small negative numbers, then encoding it as an unsigned long.  float32‚Äã  size: 4 byteformat: encode the specified floating-point value according to the IEEE 754 floating-point &quot;single format&quot; bit layout, preserving Not-a-Number (NaN) values, then write as binary by little endian order.  float64‚Äã  size: 8 byteformat: encode the specified floating-point value according to the IEEE 754 floating-point &quot;double format&quot; bit layout, preserving Not-a-Number (NaN) values. then write as binary by little endian order.  ","version":"0.12","tagName":"h3"},{"title":"string‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#string","content":" Format:  | unsigned varint64: size &lt;&lt; 2 `bitor` 2 bits encoding flags | binary data |   size + encoding will be concat as a long and encoded as an unsigned varint64. The little 2 bits is used for encoding: 0 for latin1(ISO-8859-1), 1 for utf-16, 2 for utf-8.encoded string binary data based on encoding: latin/utf-16/utf-8.  Which encoding to choose:  For JDK8: fory detect latin at runtime, if string is latin string, then use latin encoding, otherwise use utf-16.For JDK9+: fory use coder in String object for encoding, latin/utf-16 will be used for encoding.If the string is encoded by utf-8, then fory will use utf-8 to decode the data. Cross-language string serialization of fory uses utf-8 by default.  ","version":"0.12","tagName":"h3"},{"title":"list‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#list","content":" Format:  | unsigned varint64: length | 1 byte elements header | elements data |   elements header‚Äã  In most cases, all elements are same type and not null, elements header will encode those homogeneous information to avoid the cost of writing it for every element. Specifically, there are four kinds of information which will be encoded by elements header, each use one bit:  If track elements ref, use the first bit 0b1 of the header to flag it.If the elements have null, use the second bit 0b10 of the header to flag it. If ref tracking is enabled for this element type, this flag is invalid.If the element types are not the declared type, use the 3rd bit 0b100 of the header to flag it.If the element types are different, use the 4th bit 0b1000 header to flag it.  By default, all bits are unset, which means all elements won't track ref, all elements are same type, not null and the actual element is the declared type in the custom type field.  The implementation can generate different deserialization code based read header, and look up the generated code from a linear map/list.  elements data‚Äã  Based on the elements header, the serialization of elements data may skip ref flag/null flag/element type info.  fory = ... buffer = ... elems = ... if element_type_is_same: if not is_declared_type: fory.write_type(buffer, elem_type) elem_serializer = get_serializer(...) if track_ref: for elem in elems: if not ref_resolver.write_ref_or_null(buffer, elem): elem_serializer.write(buffer, elem) elif has_null: for elem in elems: if elem is None: buffer.write_byte(null_flag) else: buffer.write_byte(not_null_flag) elem_serializer.write(buffer, elem) else: for elem in elems: elem_serializer.write(buffer, elem) else: if track_ref: for elem in elems: fory.write_ref(buffer, elem) elif has_null: for elem in elems: fory.write_nullable(buffer, elem) else: for elem in elems: fory.write_value(buffer, elem)   CollectionSerializer#writeElementscan be taken as an example.  ","version":"0.12","tagName":"h3"},{"title":"array‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#array","content":" primitive array‚Äã  Primitive array are taken as a binary buffer, serialization will just write the length of array size as an unsigned int, then copy the whole buffer into the stream.  Such serialization won't compress the array. If users want to compress primitive array, users need to register custom serializers for such types or mark it as list type.  Tensor‚Äã  Tensor is a special primitive multi-dimensional array which all dimensions have same size and type. The serialization format is:  | num_dims(unsigned varint) | shape[0](unsigned varint) | shape[...] | shape[N] | element type | data |   The data is continuous to reduce copy and may zero-copy in some cases.  object array‚Äã  Object array is serialized using the list format. Object component type will be taken as list element generic type.  ","version":"0.12","tagName":"h3"},{"title":"map‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#map","content":" Map uses a chunk by chunk based Format:  | length(unsigned varint) | key value chunk data | ... | key value chunk data |   map key-value chunk data‚Äã  Map iteration is too expensive, Fory won't compute the header like for list since it introduceconsiderable overhead. Users can use MapFieldInfo annotation to provide the header in advance. Otherwise Fory will use first key-value pair to predict header optimistically, and update the chunk header if the prediction failed at some pair.  Fory will serialize the map chunk by chunk, every chunk has 255 pairs at most.  | 1 byte | 1 byte | variable bytes | +----------------+----------------+-----------------+ | KV header | chunk size: N | N*2 objects |   KV header:  If track key ref, use the first bit 0b1 of the header to flag it.If the key has null, use the second bit 0b10 of the header to flag it. If ref tracking is enabled for this key type, this flag is invalid.If the actual key type of map is not the declared key type, use the 3rd bit 0b100 of the header to flag it.If track value ref, use the 4th bit 0b1000 of the header to flag it.If the value has null, use the 5th bit 0b10000 of the header to flag it. If ref tracking is enabled for this value type, this flag is invalid.If the value type of map is not the declared value type, use the 6rd bit 0b100000 of the header to flag it.If key or value is null, that key and value will be written as a separate chunk, and chunk size writing will be skipped too.  If streaming write is enabled, which means Fory can't update written chunk size. In such cases, map key-value data format will be:  | 1 byte | variable bytes | +----------------+-----------------+ | KV header | N*2 objects |   KV header will be a header marked by MapFieldInfo in java. For languages such as golang, this can be computed in advance for non-interface types most times. The implementation can generate different deserialization code based read header, and look up the generated code from a linear map/list.  Why serialize chunk by chunk?‚Äã  When fory will use first key-value pair to predict header optimistically, it can't know how many pairs have same meta(tracking kef ref, key has null and so on). If we don't write chunk by chunk with max chunk size, we must write at least X bytes to take up a place for later to update the number which has same elements, X is the num_bytes for encoding varint encoding of map size.  And most map size are smaller than 255, if all pairs have same data, the chunk will be 1. This is common in golang/rust, which object are not reference by default.  Also, if only one or two keys have different meta, we can make it into a different chunk, so that most pairs can share meta.  The implementation can accumulate read count with map size to decide whether to read more chunks.  ","version":"0.12","tagName":"h3"},{"title":"enum‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#enum","content":" Enums are serialized as an unsigned var int. If the order of enum values change, the deserialized enum value may not be the value users expect. In such cases, users must register enum serializer by make it write enum value as an enumerated string with unique hash disabled.  ","version":"0.12","tagName":"h3"},{"title":"decimal‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#decimal","content":" Not supported for now.  ","version":"0.12","tagName":"h3"},{"title":"struct‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#struct","content":" Struct means object of class/pojo/struct/bean/record type. Struct will be serialized by writing its fields data in fory order.  Depending on schema compatibility, structs will have different formats.  field order‚Äã  Field will be ordered as following, every group of fields will have its own order:  primitive fields: larger size type first, smaller later, variable size type last.when same size, sort by type idwhen same size and type id, sort by snake case field nametypes: bool/int8/int16/int32/varint32/int64/varint64/sliint64/float16/float32/float64 nullable primitive fields: same order as primitive fieldsmorphic fields: same type together, then sorted by field name lexicographically using snake case style.unknown fields: same sort algorithms as morphic fieldslist fields: same sort algorithms as morphic fieldsset fields: same sort algorithms as morphic fieldsmap fields: same sort algorithms as morphic fields  Field order‚Äã  Fields in a struct are sorted in a ascending order by:  primitive fields first: bool/int8/int16/int32/varint32/int64/varint64/sliint64/float16/float32/float64, sorted by type id.nullable primitive fieldsmorphic types except list/set/mapunknown typeslist typesset typesmap types  If two fields have same type, then sort by snake_case styled field name.  schema consistent‚Äã  Object will be written as:  | 4 byte | variable bytes | +---------------+------------------+ | type hash | field values |   Type hash is used to check the type schema consistency across languages. Type hash will be the first 32 bits of 56 bits value of the type meta.  Object fields will be serialized one by one using following format:  not null primitive field value: | var bytes | +----------------+ | value data | +----------------+ nullable primitive field value: | one byte | var bytes | +-----------+---------------+ | null flag | field value | +-----------+---------------+ field value of final type with ref tracking: | var bytes | var objects | +-----------+-------------+ | ref meta | value data | +-----------+-------------+ field value of final type without ref tracking: | one byte | var objects | +-----------+-------------+ | null flag | field value | +-----------+-------------+ field value of non-final type with ref tracking: | one byte | var bytes | var objects | +-----------+-------------+-------------+ | ref meta | type meta | value data | +-----------+-------------+-------------+ field value of non-final type without ref tracking: | one byte | var bytes | var objects | +-----------+------------+------------+ | null flag | type meta | value data | +-----------+------------+------------+   Schema evolution‚Äã  Schema evolution have similar format as schema consistent mode for object except:  For the object type, schema consistent mode will write type by id only, but schema evolution mode will write type consisting of field names, types and other meta too, see Type meta.Type meta of final custom type needs to be written too, because peers may not have this type defined.  ","version":"0.12","tagName":"h3"},{"title":"Type‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#type","content":" Type will be serialized using type meta format.  ","version":"0.12","tagName":"h3"},{"title":"Implementation guidelines‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#implementation-guidelines","content":" ","version":"0.12","tagName":"h2"},{"title":"How to reduce memory read/write code‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#how-to-reduce-memory-readwrite-code","content":" Try to merge multiple bytes into an int/long write before writing to reduce memory IO and bound check cost.Read multiple bytes as an int/long, then split into multiple bytes to reduce memory IO and bound check cost.Try to use one varint/long to write flags and length together to save one byte cost and reduce memory io.Condition branches are less expensive compared to memory IO cost unless there are too many branches.  ","version":"0.12","tagName":"h3"},{"title":"Fast deserialization for static languages without runtime codegen support‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.12/specification/xlang_serialization_spec#fast-deserialization-for-static-languages-without-runtime-codegen-support","content":" For type evolution, the serializer will encode the type meta into the serialized data. The deserializer will compare this meta with class meta in the current process, and use the diff to determine how to deserialize the data.  For java/javascript/python, we can use the diff to generate serializer code at runtime and load it as class/function for deserialization. In this way, the type evolution will be as fast as type consist mode.  For C++/Rust, we can't generate the serializer code at runtime. So we need to generate the code at compile-time using meta programming. But at that time, we don't know the type schema in other processes, so we can't generate the serializer code for such inconsistent types. We may need to generate the code which has a loop and compare field name one by one to decide whether to deserialize and assign the field or skip the field value.  One fast way is that we can optimize the string comparison into jump instructions:  Assume the current type has n fields, and the peer type has n1 fields.Generate an auto growing field id from 0 for every sorted field in the current type at the compile time.Compare the received type meta with current type, generate same id if the field name is same, otherwise generate an auto growing id starting from n, cache this meta at runtime.Iterate the fields of received type meta, use a switch to compare the field id to deserialize data and assign/skip field value. Continuous field id will be optimized into jump in switch block, so it will very fast.  Here is an example, suppose process A has a class Foo with version 1 defined as Foo1, process B has a class Foowith version 2 defined as Foo2:  // class Foo with version 1 class Foo1 { int32_t v1; // id 0 std::string v2; // id 1 }; // class Foo with version 2 class Foo2 { // id 0, but will have id 2 in process A bool v0; // id 1, but will have id 0 in process A int32_t v1; // id 2, but will have id 3 in process A int64_t long_value; // id 3, but will have id 1 in process A std::string v2; // id 4, but will have id 4 in process A std::vector&lt;std::string&gt; list; };   When process A received serialized Foo2 from process B, here is how it deserialize the data:  Foo1 foo1 = ...; const std::vector&lt;fory::FieldInfo&gt; &amp;field_infos = type_meta.field_infos; for (const auto &amp;field_info : field_infos) { switch (field_info.field_id) { case 0: foo1.v1 = buffer.read_varint32(); break; case 1: foo1.v2 = fory.read_string(); break; default: fory.skip_data(field_info); } }  ","version":"0.12","tagName":"h3"},{"title":"Community","type":0,"sectionRef":"#","url":"/docs/0.13/community/","content":"","keywords":"","version":"0.13"},{"title":"Mailing list‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.13/community/#mailing-list","content":" Name\tDesc\tSubscribe\tUnsubscribe\tPost\tArchivedev@fory.apache.org\tDevelopment related discussions\tSubscribe\tUnsubscribe\tPost\tArchive commits@fory.apache.org\tAll commits to our repositories\tSubscribe\tUnsubscribe\tRead only list\tArchive  Please make sure subscribe to any list before attempting to post.  If you are not subscribed to the mailing list, your message will either be rejected or you won't receive the response.  ","version":"0.13","tagName":"h2"},{"title":"How to subscribe to a mailing list‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.13/community/#how-to-subscribe-to-a-mailing-list","content":" To post messages, subscribe first by:  Sending an email to listname-subscribe@fory.apache.org with listname replaced accordingly.Replying to the confirmation email you'll receive, keeping the subject line intact.You'll then get a welcome email, and the subscription succeeds.  When discussing code snippets in emails, ensure:  You do not link to files in external services, as such files can change, get deleted or the link might break and thus make an archived email thread useless.You paste text instead of screenshots of text.You keep formatting when pasting code in order to keep the code readable.There are enough import statements to avoid ambiguities.  ","version":"0.13","tagName":"h3"},{"title":"Slack‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.13/community/#slack","content":" You can join the Apache Fory‚Ñ¢ community on Slack.  There are a couple of community rules:  Be respectful and nice.All important decisions and conclusions must be reflected back to the mailing lists. &quot;If it didn't happen on a mailing list, it didn't happen.&quot; - The Apache Mottos.Use Slack threads to keep parallel conversations from overwhelming a channel.Please do not direct message people for troubleshooting, issue assigning and PR review. These should be picked-up voluntarily.  ","version":"0.13","tagName":"h2"},{"title":"Issue tracker‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.13/community/#issue-tracker","content":" We use GitHub Issues to track all issues:  code related issues: https://github.com/apache/fory/issueswebsite related issues: https://github.com/apache/fory-site/issues  You need to have a GitHub account in order to create issues. If you don't have a GitHub account, you can post an email to dev@fory.apache.org.  ","version":"0.13","tagName":"h2"},{"title":"Bug reports‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.13/community/#bug-reports","content":" To report a bug:  Verify that the bug does in fact exist.Search the issue tracker to verify there is no existing issue reporting the bug you've found.Create a bug report on issue tracker.If possible, dive into the source code of fory, and submit a patch for the bug you reported, this helps ensure the bug will be fixed quickly.  ","version":"0.13","tagName":"h3"},{"title":"Reporting a Vulnerability‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.13/community/#reporting-a-vulnerability","content":" Apache Fory‚Ñ¢ is a project of the Apache Software Foundation and follows the ASF vulnerability handling process.  To report a new vulnerability you have discovered please follow the ASF vulnerability reporting process, which explains how to send us details privately.  ","version":"0.13","tagName":"h3"},{"title":"Enhancement‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.13/community/#enhancement","content":" Enhancements or new feature proposals are also welcome. The more concrete and rationale the proposal is, the greater the chance it will be incorporated into future releases.  ","version":"0.13","tagName":"h3"},{"title":"Source code‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.13/community/#source-code","content":" fory core repository: https://github.com/apache/foryfory website repository: https://github.com/apache/fory-site ","version":"0.13","tagName":"h2"},{"title":"Usage","type":0,"sectionRef":"#","url":"/docs/0.12/start/usage","content":"","keywords":"","version":"0.12"},{"title":"Java Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.12/start/usage#java-serialization","content":" import java.util.List; import java.util.Arrays; import org.apache.fory.*; public class Example { public static void main(String[] args) { SomeClass object = new SomeClass(); // Note that Fory instances should be reused between // multiple serializations of different objects. Fory fory = Fory.builder().withLanguage(Language.JAVA) // Allow to deserialize objects unknown types, // more flexible but less secure. // .requireClassRegistration(false) .build(); // Registering types can reduce class name serialization overhead, but not mandatory. // If secure mode enabled, all custom types must be registered. fory.register(SomeClass.class); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes)); } }   ","version":"0.12","tagName":"h2"},{"title":"Scala Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.12/start/usage#scala-serialization","content":" import org.apache.fory.Fory import org.apache.fory.serializer.scala.ScalaSerializers case class Person(name: String, id: Long, github: String) case class Point(x : Int, y : Int, z : Int) object ScalaExample { val fory: Fory = Fory.builder().withScalaOptimizationEnabled(true).build() // Register optimized fory serializers for scala ScalaSerializers.registerSerializers(fory) fory.register(classOf[Person]) fory.register(classOf[Point]) def main(args: Array[String]): Unit = { val p = Person(&quot;Shawn Yang&quot;, 1, &quot;https://github.com/chaokunyang&quot;) println(fory.deserialize(fory.serialize(p))) println(fory.deserialize(fory.serialize(Point(1, 2, 3)))) } }   ","version":"0.12","tagName":"h2"},{"title":"Kotlin Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.12/start/usage#kotlin-serialization","content":" import org.apache.fory.Fory import org.apache.fory.ThreadSafeFory import org.apache.fory.serializer.kotlin.KotlinSerializers data class Person(val name: String, val id: Long, val github: String) data class Point(val x : Int, val y : Int, val z : Int) fun main(args: Array&lt;String&gt;) { // Note: following fory init code should be executed only once in a global scope instead // of initializing it everytime when serialization. val fory: ThreadSafeFory = Fory.builder().requireClassRegistration(true).buildThreadSafeFory() KotlinSerializers.registerSerializers(fory) fory.register(Person::class.java) fory.register(Point::class.java) val p = Person(&quot;Shawn Yang&quot;, 1, &quot;https://github.com/chaokunyang&quot;) println(fory.deserialize(fory.serialize(p))) println(fory.deserialize(fory.serialize(Point(1, 2, 3)))) }   ","version":"0.12","tagName":"h2"},{"title":"CrossLanguage Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.12/start/usage#crosslanguage-serialization","content":" ","version":"0.12","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.12/start/usage#java","content":" import com.google.common.collect.ImmutableMap; import org.apache.fory.*; import java.util.Map; public class ReferenceExample { public static class SomeClass { SomeClass f1; Map&lt;String, String&gt; f2; Map&lt;String, String&gt; f3; } public static Object createObject() { SomeClass obj = new SomeClass(); obj.f1 = obj; obj.f2 = ImmutableMap.of(&quot;k1&quot;, &quot;v1&quot;, &quot;k2&quot;, &quot;v2&quot;); obj.f3 = obj.f2; return obj; } // mvn exec:java -Dexec.mainClass=&quot;io.fory.examples.ReferenceExample&quot; public static void main(String[] args) { Fory fory = Fory.builder().withLanguage(Language.XLANG) .withRefTracking(true).build(); fory.register(SomeClass.class, &quot;example.SomeClass&quot;); byte[] bytes = fory.serialize(createObject()); // bytes can be data serialized by other languages. System.out.println(fory.deserialize(bytes)); ; } }   ","version":"0.12","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.12/start/usage#python","content":" from typing import Dict import pyfory class SomeClass: f1: &quot;SomeClass&quot; f2: Dict[str, str] f3: Dict[str, str] fory = pyfory.Fory(ref_tracking=True) fory.register_class(SomeClass, &quot;example.SomeClass&quot;) obj = SomeClass() obj.f2 = {&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: &quot;v2&quot;} obj.f1, obj.f3 = obj, obj.f2 data = fory.serialize(obj) # bytes can be data serialized by other languages. print(fory.deserialize(data))   ","version":"0.12","tagName":"h3"},{"title":"Golang‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.12/start/usage#golang","content":" package main import ( &quot;fmt&quot; forygo &quot;github.com/apache/fory/go/fory&quot; ) func main() { type SomeClass struct { F1 *SomeClass F2 map[string]string F3 map[string]string } fory := forygo.NewFory(true) if err := fory.RegisterTagType(&quot;example.SomeClass&quot;, SomeClass{}); err != nil { panic(err) } value := &amp;SomeClass{F2: map[string]string{&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: &quot;v2&quot;}} value.F3 = value.F2 value.F1 = value bytes, err := fory.Marshal(value) if err != nil { } var newValue interface{} // bytes can be data serialized by other languages. if err := fory.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) }   ","version":"0.12","tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.12/start/usage#javascript","content":" import Fory, { Type } from &quot;@apache-fory/fory&quot;; /** * @apache-fory/hps use v8's fast-calls-api that can be called directly by jit, ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from &quot;@apache-fory/hps&quot;; // Now we describe data structures using JSON, but in the future, we will use more ways. const description = Type.object(&quot;example.foo&quot;, { foo: Type.string(), }); const fory = new Fory({ hps }); const { serialize, deserialize } = fory.registerSerializer(description); const input = serialize({ foo: &quot;hello fory&quot; }); const result = deserialize(input); console.log(result);   ","version":"0.12","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.12/start/usage#rust","content":" use fory::{from_buffer, to_buffer, Fory}; #[derive(Fory, Debug, PartialEq)] #[tag(&quot;example.foo&quot;)] struct Animal { name: String, category: String, } #[derive(Fory, Debug, PartialEq)] #[tag(&quot;example.bar&quot;)] struct Person { name: String, age: u32, pets: Vec&lt;Animal&gt;, } fn main() { let penson = Person { name: &quot;hello&quot;.to_string(), age: 12, pets: vec![ Animal { name: &quot;world1&quot;.to_string(), category: &quot;cat&quot;.to_string(), }, Animal { name: &quot;world2&quot;.to_string(), category: &quot;dog&quot;.to_string(), }, ], }; let bin = to_buffer(&amp;penson); let obj: Person = from_buffer(&amp;bin).expect(&quot;should success&quot;); assert_eq!(obj, penson); }  ","version":"0.12","tagName":"h3"},{"title":"How to join Apache Fory‚Ñ¢","type":0,"sectionRef":"#","url":"/docs/0.13/community/how_to_join_community","content":"","keywords":"","version":"0.13"},{"title":"Fory Contribution Guide‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.13/community/how_to_join_community#fory-contribution-guide","content":" The Fory team usually conducts development and issue maintenance on GitHub. Please open the GitHub website, click the Sign up button in the upper right corner, register your own account, and take the first step of your open source journey.  In the Fory repository, we have a guide for all open source contributors, introducing contents such as version management and branch management. Please take a few minutes to read and understand it.  ","version":"0.13","tagName":"h2"},{"title":"Your First Pull Request‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.13/community/how_to_join_community#your-first-pull-request","content":" ","version":"0.13","tagName":"h2"},{"title":"Step 0: Install Git‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.13/community/how_to_join_community#step-0-install-git","content":" Git is a version control system used to track and manage code changes in software development projects. It helps developers record and manage the history of the code, facilitating team collaboration, code version control, code merging, and other operations. With Git, you can track each version of each file and easily switch and compare between different versions. Git also provides branch management functionality, allowing multiple concurrent development tasks to be carried out simultaneously.  Visit the official Git website: [https://git-scm.com/] (https://git-scm.com/)Download the latest version of the Git installer.Run the downloaded installer and follow the prompts of the installation wizard to install.After the installation is complete, you can use the git version command in the command line to confirm the successful installation.  ","version":"0.13","tagName":"h3"},{"title":"Step 1: Fork the Project‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.13/community/how_to_join_community#step-1-fork-the-project","content":" First, you need to fork this project. Enter the Fory project page, and click the Fork button in the upper right corner.In your GitHub account, the project xxxx (your GitHub username)/fory will appear.On your local computer, use the following commands to obtain a fory folder:  // ssh git clone git@github.com:xxxx (your GitHub username)/fory.git // https git clone https://github.com/xxxx (your GitHub username)/fory.git   ","version":"0.13","tagName":"h3"},{"title":"Step 2: Obtain the Project Code‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.13/community/how_to_join_community#step-2-obtain-the-project-code","content":" Enter the fory folder and add the remote address of fory:  git remote add upstream https://github.com/apache/fory.git   ","version":"0.13","tagName":"h3"},{"title":"Step 3: Create a Branch‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.13/community/how_to_join_community#step-3-create-a-branch","content":" Alright, now you can start contributing our code. The default branch of Fory is the main branch. Whether it is for function development, bug fixes, or documentation writing, please create a new branch and then merge it to the main branch. Use the following code to create a branch:  // Create a function development branch git checkout -b feat/xxxx // Create a problem-fixing development branch git checkout -b fix/xxxx // Create a documentation, demo branch git checkout -b docs/add-java-demo   Suppose we have created the documentation modification branch docs/add-java-demo and we have added some code and submitted it to the code repository.  git add .git commit -a -m &quot;docs: add java demo and related docs&quot;  ","version":"0.13","tagName":"h3"},{"title":"Step 4: Merge the Modifications‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.13/community/how_to_join_community#step-4-merge-the-modifications","content":" Switch back to your development branch:  git checkout docs/add-java-demo   Submit the updated code to your branch:  git push origin docs/add-java-demo   ","version":"0.13","tagName":"h3"},{"title":"Step 5: Submit a Pull Request‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.13/community/how_to_join_community#step-5-submit-a-pull-request","content":" You can click the Compare &amp; pull request button on your GitHub code repository page. Or create it through the contribute button.  Fill in what type of modification this is.Fill in the associated issue.If there are complex changes, please explain the background and solution.  After filling in the relevant information, click Create pull request to submit.  ","version":"0.13","tagName":"h3"},{"title":"Easily Step into the Fory Open Source Contribution Journey‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.13/community/how_to_join_community#easily-step-into-the-fory-open-source-contribution-journey","content":" &quot;good first issue&quot; is a common label in the open source community, and the purpose of this label is to help new contributors find entry-level issues that are suitable for them.  The entry-level issues of Fory can be viewed through the issue list.  If you currently have the time and willingness to participate in community contributions, you can take a look at good first issue in the issues and select one that interests you and is suitable for you to claim.  ","version":"0.13","tagName":"h2"},{"title":"Embrace the Apache Fory‚Ñ¢ Community‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.13/community/how_to_join_community#embrace-the-apache-fory-community","content":" While you contribute code to Fory, we encourage you to participate in other things that make the community more prosperous, such as:  Offer suggestions for the project's development, functional planning, etc.Create articles, videos, and hold lectures to promote Fory.Write promotion plans and execute them together with the team. ","version":"0.13","tagName":"h2"},{"title":"How to verify","type":0,"sectionRef":"#","url":"/docs/0.13/community/how_to_verify","content":"","keywords":"","version":"0.13"},{"title":"Download the candidate version‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/0.13/community/how_to_verify#download-the-candidate-version","content":" #If there is svn locally, you can clone to the local svn co https://dist.apache.org/repos/dist/dev/fory/${release_version}-${rc_version}/ # You can download the material file directly wget https://dist.apache.org/repos/dist/dev/fory/${release_version}-${rc_version}/xxx.xxx   ","version":"0.13","tagName":"h2"},{"title":"Verify checksums and signatures‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/0.13/community/how_to_verify#verify-checksums-and-signatures","content":" First you need to install gpg:  apt-get install gnupg # or yum install gnupg # or brew install gnupg   Then import the Fory release manager's public key:  curl https://downloads.apache.org/fory/KEYS &gt; KEYS # Download KEYS gpg --import KEYS # Import KEYS to local # Then, trust the public key: gpg --edit-key &lt;KEY-used-in-this-version&gt; # Edit the key(mentioned in vote email) # It will enter the interactive mode, use the following command to trust the key: gpg (GnuPG) 2.0.22; Copyright (C) 2013 Free Software Foundation, Inc. This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. pub 4096R/5E580BA4 created: 2024-03-27 expires: never usage: SC trust: unknown validity: unknown sub 4096R/A31EF728 created: 2024-03-27 expires: never usage: E [ unknown] (1). chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; gpg&gt; trust pub 4096R/5E580BA4 created: 2024-03-27 expires: never usage: SC trust: unknown validity: unknown sub 4096R/A31EF728 created: 2024-03-27 expires: never usage: E [ unknown] (1). chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; Please decide how far you trust this user to correctly verify other users' keys (by looking at passports, checking fingerprints from different sources, etc.) 1 = I don't know or won't say 2 = I do NOT trust 3 = I trust marginally 4 = I trust fully 5 = I trust ultimately m = back to the main menu Your decision? 5 Do you really want to set this key to ultimate trust? (y/N) y pub 4096R/5E580BA4 created: 2024-03-27 expires: never usage: SC trust: ultimate validity: unknown sub 4096R/A31EF728 created: 2024-03-27 expires: never usage: E [ unknown] (1). chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; Please note that the shown key validity is not necessarily correct unless you restart the program.   Next verify signature:  for i in *.tar.gz; do echo $i; gpg --verify $i.asc $i; done   If something like the following appears, it means the signature is correct:  apache-fory-0.12.0-src.tar.gz gpg: Signature made Wed 17 Apr 2024 11:49:45 PM CST using RSA key ID 5E580BA4 gpg: checking the trustdb gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model gpg: depth: 0 valid: 1 signed: 0 trust: 0-, 0q, 0n, 0m, 0f, 1u gpg: Good signature from &quot;chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt;&quot;   Then verify checksum:  for i in *.tar.gz; do echo $i; sha512sum --check $i.sha512*; done   It should output something like:  apache-fory-0.12.0-src.tar.gz apache-fory-0.12.0-src.tar.gz: OK   A quick way to verify above is:  curl -s https://raw.githubusercontent.com/apache/fory/main/ci/release.py | python3 - verify -v 0.5.0   ","version":"0.13","tagName":"h2"},{"title":"Check the file content of the source package‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/0.13/community/how_to_verify#check-the-file-content-of-the-source-package","content":" Unzip apache-fory-${release_version}-${rc_version}-src.tar.gz and check the follows:  LICENSE and NOTICE files are correct for the repository.All files have ASF license headers if necessary.Building is OK.  ","version":"0.13","tagName":"h2"},{"title":"Check the Maven artifacts of fory-java‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/0.13/community/how_to_verify#check-the-maven-artifacts-of-fory-java","content":" Download the artifacts from https://repository.apache.org/content/repositories/orgapachefory-${maven_artifact_number}/.  You can check the follows:  Checksum of JARs match the bundled checksum file.Signature of JARs match the bundled signature file.JARs is reproducible locally. This means you can build the JARs on your machine and verify the checksum is the same with the bundled one. ","version":"0.13","tagName":"h2"},{"title":"Development","type":0,"sectionRef":"#","url":"/docs/0.13/guide/development","content":"","keywords":"","version":"0.13"},{"title":"How to build Apache Fory‚Ñ¢‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.13/guide/development#how-to-build-apache-fory","content":" Please checkout the source tree from https://github.com/apache/fory.  ","version":"0.13","tagName":"h2"},{"title":"Build Apache Fory‚Ñ¢ Java‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.13/guide/development#build-apache-fory-java","content":" cd java mvn clean compile -DskipTests   Environment Requirements‚Äã  java 1.8+maven 3.6.3+  ","version":"0.13","tagName":"h3"},{"title":"Build Apache Fory‚Ñ¢ Python‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.13/guide/development#build-apache-fory-python","content":" cd python # Uninstall numpy first so that when we install pyarrow, it will install the correct numpy version automatically. # For Python versions less than 3.13, numpy 2 is not currently supported. pip uninstall -y numpy # Install necessary environment for Python &lt; 3.13. pip install pyarrow==15.0.0 Cython wheel pytest # For Python 3.13, pyarrow 18.0.0 is available and requires numpy version greater than 2. # pip install pyarrow==18.0.0 Cython wheel pytest pip install -v -e .   Environment Requirements‚Äã  python 3.6+  ","version":"0.13","tagName":"h3"},{"title":"Build Apache Fory‚Ñ¢ C++‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.13/guide/development#build-apache-fory-c","content":" Build fory row formatÔºö  pip install pyarrow==15.0.0 bazel build //cpp/fory/row:fory_row_format   Build fory row format encoder:  pip install pyarrow==15.0.0 bazel build //cpp/fory/encoder:fory_encoder   Environment Requirements‚Äã  compilers with C++17 supportbazel 6.3.2  ","version":"0.13","tagName":"h3"},{"title":"Build Apache Fory‚Ñ¢ GoLang‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.13/guide/development#build-apache-fory-golang","content":" cd go/fory # run test go test -v # run xlang test go test -v fory_xlang_test.go   Environment Requirements‚Äã  go 1.13+  ","version":"0.13","tagName":"h3"},{"title":"Build Apache Fory‚Ñ¢ Rust‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.13/guide/development#build-apache-fory-rust","content":" cd rust # build cargo build # run test cargo test # run specific test cargo test -p tests --test $test_file $test_method # run specific test under subdirectory cargo test --test mod $dir$::$test_file::$test_method # debug specific test under subdirectory and get backtrace RUST_BACKTRACE=1 FORY_PANIC_ON_ERROR=1 cargo test --test mod $dir$::$test_file::$test_method # inspect generated code by fory derive macro cargo expand --test mod $mod$::$file$ &gt; expanded.rs   Environment Requirements‚Äã  curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh   ","version":"0.13","tagName":"h3"},{"title":"Build Apache Fory‚Ñ¢ JavaScript‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.13/guide/development#build-apache-fory-javascript","content":" cd javascript npm install # run build npm run build # run test npm run test   Environment Requirements‚Äã  node 14+npm 8+  ","version":"0.13","tagName":"h3"},{"title":"Lint Markdown Docs‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.13/guide/development#lint-markdown-docs","content":" # Install prettier globally npm install -g prettier # Fix markdown files prettier --write &quot;**/*.md&quot;   Environment Requirements‚Äã  node 14+npm 8+  ","version":"0.13","tagName":"h3"},{"title":"Contributing‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.13/guide/development#contributing","content":" For more information, please refer to How to contribute to Apache Fory‚Ñ¢. ","version":"0.13","tagName":"h2"},{"title":"Java Serialization","type":0,"sectionRef":"#","url":"/docs/0.12/guide/serialization","content":"","keywords":"","version":"0.12"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.12/guide/serialization#quick-start","content":" Note that fory creation is not cheap, the fory instances should be reused between serializations instead of creating it everytime. You should keep fory to a static global variable, or instance variable of some singleton object or limited objects.  Fory for single-thread usage:  import java.util.List; import java.util.Arrays; import org.apache.fory.*; import org.apache.fory.config.*; public class Example { public static void main(String[] args) { SomeClass object = new SomeClass(); // Note that Fory instances should be reused between // multiple serializations of different objects. Fory fory = Fory.builder().withLanguage(Language.JAVA) .requireClassRegistration(true) .build(); // Registering types can reduce class name serialization overhead, but not mandatory. // If class registration enabled, all custom types must be registered. fory.register(SomeClass.class); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes)); } }   Fory for multiple-thread usage:  import java.util.List; import java.util.Arrays; import org.apache.fory.*; import org.apache.fory.config.*; public class Example { public static void main(String[] args) { SomeClass object = new SomeClass(); // Note that Fory instances should be reused between // multiple serializations of different objects. ThreadSafeFory fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().withLanguage(Language.JAVA) .withClassLoader(classLoader).build(); f.register(SomeClass.class); return f; }); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes)); } }   Fory instances reuse example:  import java.util.List; import java.util.Arrays; import org.apache.fory.*; import org.apache.fory.config.*; public class Example { // reuse fory. private static final ThreadSafeFory fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().withLanguage(Language.JAVA) .withClassLoader(classLoader).build(); f.register(SomeClass.class); return f; }); public static void main(String[] args) { SomeClass object = new SomeClass(); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes)); } }   ","version":"0.12","tagName":"h2"},{"title":"ForyBuilder options‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.12/guide/serialization#forybuilder-options","content":" Option Name\tDescription\tDefault ValuetimeRefIgnored\tWhether to ignore reference tracking of all time types registered in TimeSerializers and subclasses of those types when ref tracking is enabled. If ignored, ref tracking of every time type can be enabled by invoking Fory#registerSerializer(Class, Serializer). For example, fory.registerSerializer(Date.class, new DateSerializer(fory, true)). Note that enabling ref tracking should happen before serializer codegen of any types which contain time fields. Otherwise, those fields will still skip ref tracking.\ttrue compressInt\tEnables or disables int compression for smaller size.\ttrue compressLong\tEnables or disables long compression for smaller size.\ttrue compressString\tEnables or disables string compression for smaller size.\tfalse classLoader\tThe classloader should not be updated; Fory caches class metadata. Use LoaderBinding or ThreadSafeFory for classloader updates.\tThread.currentThread().getContextClassLoader() compatibleMode\tType forward/backward compatibility config. Also Related to checkClassVersion config. SCHEMA_CONSISTENT: Class schema must be consistent between serialization peer and deserialization peer. COMPATIBLE: Class schema can be different between serialization peer and deserialization peer. They can add/delete fields independently. See more.\tCompatibleMode.SCHEMA_CONSISTENT checkClassVersion\tDetermines whether to check the consistency of the class schema. If enabled, Fory checks, writes, and checks consistency using the classVersionHash. It will be automatically disabled when CompatibleMode#COMPATIBLE is enabled. Disabling is not recommended unless you can ensure the class won't evolve.\tfalse checkJdkClassSerializable\tEnables or disables checking of Serializable interface for classes under java.*. If a class under java.* is not Serializable, Fory will throw an UnsupportedOperationException.\ttrue registerGuavaTypes\tWhether to pre-register Guava types such as RegularImmutableMap/RegularImmutableList. These types are not public API, but seem pretty stable.\ttrue requireClassRegistration\tDisabling may allow unknown classes to be deserialized, potentially causing security risks.\ttrue suppressClassRegistrationWarnings\tWhether to suppress class registration warnings. The warnings can be used for security audit, but may be annoying, this suppression will be enabled by default.\ttrue metaShareEnabled\tEnables or disables meta share mode.\ttrue if CompatibleMode.Compatible is set, otherwise false. scopedMetaShareEnabled\tScoped meta share focuses on a single serialization process. Metadata created or identified during this process is exclusive to it and is not shared with by other serializations.\ttrue if CompatibleMode.Compatible is set, otherwise false. metaCompressor\tSet a compressor for meta compression. Note that the passed MetaCompressor should be thread-safe. By default, a Deflater based compressor DeflaterMetaCompressor will be used. Users can pass other compressor such as zstd for better compression rate.\tDeflaterMetaCompressor deserializeNonexistentClass\tEnables or disables deserialization/skipping of data for non-existent classes.\ttrue if CompatibleMode.Compatible is set, otherwise false. codeGenEnabled\tDisabling may result in faster initial serialization but slower subsequent serializations.\ttrue asyncCompilationEnabled\tIf enabled, serialization uses interpreter mode first and switches to JIT serialization after async serializer JIT for a class is finished.\tfalse scalaOptimizationEnabled\tEnables or disables Scala-specific serialization optimization.\tfalse copyRef\tWhen disabled, the copy performance will be better. But fory deep copy will ignore circular and shared reference. Same reference of an object graph will be copied into different objects in one Fory#copy.\ttrue serializeEnumByName\tWhen Enabled, fory serialize enum by name instead of ordinal.\tfalse  ","version":"0.12","tagName":"h2"},{"title":"Advanced Usage‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.12/guide/serialization#advanced-usage","content":" ","version":"0.12","tagName":"h2"},{"title":"Apache Fory‚Ñ¢ creation‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.12/guide/serialization#apache-fory-creation","content":" Single thread fory:  Fory fory = Fory.builder() .withLanguage(Language.JAVA) // enable reference tracking for shared/circular reference. // Disable it will have better performance if no duplicate reference. .withRefTracking(false) .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT) // enable type forward/backward compatibility // disable it for small size and better performance. // .withCompatibleMode(CompatibleMode.COMPATIBLE) // enable async multi-threaded compilation. .withAsyncCompilation(true) .build(); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes));   Thread-safe fory:  ThreadSafeFory fory = Fory.builder() .withLanguage(Language.JAVA) // enable reference tracking for shared/circular reference. // Disable it will have better performance if no duplicate reference. .withRefTracking(false) // compress int for smaller size // .withIntCompressed(true) // compress long for smaller size // .withLongCompressed(true) .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT) // enable type forward/backward compatibility // disable it for small size and better performance. // .withCompatibleMode(CompatibleMode.COMPATIBLE) // enable async multi-threaded compilation. .withAsyncCompilation(true) .buildThreadSafeFory(); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes));   Note that calling buildThreadSafeFory() on ForyBuilder will create an instance of ThreadLocalFory. This may not be appropriate in environments where virtual threads are used, as each thread will create its own fory instance, a relatively expensive operation. An alternative for virtual threads is to use buildThreadSafeForyPool.  ","version":"0.12","tagName":"h3"},{"title":"Handling Class Schema Evolution in Serialization‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.12/guide/serialization#handling-class-schema-evolution-in-serialization","content":" In many systems, the schema of a class used for serialization may change over time. For instance, fields within a class may be added or removed. When serialization and deserialization processes use different versions of jars, the schema of the class being deserialized may differ from the one used during serialization.  By default, Fory serializes objects using the CompatibleMode.SCHEMA_CONSISTENT mode. This mode assumes that the deserialization process uses the same class schema as the serialization process, minimizing payload overhead. However, if there is a schema inconsistency, deserialization will fail.  If the schema is expected to change, to make deserialization succeed, i.e. schema forward/backward compatibility. Users must configure Fory to use CompatibleMode.COMPATIBLE. This can be done using theForyBuilder#withCompatibleMode(CompatibleMode.COMPATIBLE) method. In this compatible mode, deserialization can handle schema changes such as missing or extra fields, allowing it to succeed even when the serialization and deserialization processes have different class schemas.  Here is an example of creating Fory to support schema evolution:  Fory fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .build(); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes));   This compatible mode involves serializing class metadata into the serialized output. Despite Fory's use of sophisticated compression techniques to minimize overhead, there is still some additional space cost associated with class metadata.  To further reduce metadata costs, Fory introduces a class metadata sharing mechanism, which allows the metadata to be sent to the deserialization process only once. For more details, please refer to the Meta Sharing specification.  ","version":"0.12","tagName":"h3"},{"title":"Compression‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.12/guide/serialization#compression","content":" ForyBuilder#withIntCompressed/ForyBuilder#withLongCompressed can be used to compress int/long for smaller size. Normally compress int is enough.  Both compression are enabled by default, if the serialized is not important, for example, you use flatbuffers for serialization before, which doesn't compress anything, then you should disable compression. If your data are all numbers, the compression may bring 80% performance regression.  For int compression, fory use 1~5 bytes for encoding. First bit in every byte indicate whether has next byte. if first bit is set, then next byte will be read util first bit of next byte is unset.  For long compression, fory support two encoding:  Fory SLI(Small long as int) Encoding (used by default): If long is in [-1073741824, 1073741823], encode as 4 bytes int: | little-endian: ((int) value) &lt;&lt; 1 |Otherwise write as 9 bytes: | 0b1 | little-endian 8bytes long | Fory PVL(Progressive Variable-length Long) Encoding: First bit in every byte indicate whether has next byte. if first bit is set, then next byte will be read util first bit of next byte is unset.Negative number will be converted to positive number by (v &lt;&lt; 1) ^ (v &gt;&gt; 63) to reduce cost of small negative numbers.  If a number are long type, it can't be represented by smaller bytes mostly, the compression won't get good enough result, not worthy compared to performance cost. Maybe you should try to disable long compression if you find it didn't bring much space savings.  ","version":"0.12","tagName":"h3"},{"title":"Object deep copy‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.12/guide/serialization#object-deep-copy","content":" Deep copy example:  Fory fory = Fory.builder().withRefCopy(true).build(); SomeClass a = xxx; SomeClass copied = fory.copy(a);   Make fory deep copy ignore circular and shared reference, this deep copy mode will ignore circular and shared reference. Same reference of an object graph will be copied into different objects in one Fory#copy.  Fory fory = Fory.builder().withRefCopy(false).build(); SomeClass a = xxx; SomeClass copied = fory.copy(a);   ","version":"0.12","tagName":"h3"},{"title":"Implement a customized serializer‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.12/guide/serialization#implement-a-customized-serializer","content":" In some cases, you may want to implement a serializer for your type, especially some class customize serialization by JDK writeObject/writeReplace/readObject/readResolve, which is very inefficient. For example, if you don't want following Foo#writeObject got invoked, you can take following FooSerializer as an example:  class Foo { public long f1; private void writeObject(ObjectOutputStream s) throws IOException { System.out.println(f1); s.defaultWriteObject(); } } class FooSerializer extends Serializer&lt;Foo&gt; { public FooSerializer(Fory fory) { super(fory, Foo.class); } @Override public void write(MemoryBuffer buffer, Foo value) { buffer.writeInt64(value.f1); } @Override public Foo read(MemoryBuffer buffer) { Foo foo = new Foo(); foo.f1 = buffer.readInt64(); return foo; } }   Register serializer:  Fory fory = getFory(); fory.registerSerializer(Foo.class, new FooSerializer(fory));   ","version":"0.12","tagName":"h3"},{"title":"Implement Collection Serializer‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.12/guide/serialization#implement-collection-serializer","content":" Similar to maps, when implementing a serializer for a custom Collection type, you must extend CollectionSerializer or CollectionLikeSerializer. The key difference between these two is that CollectionLikeSerializer can serialize a class which has a collection-like structure but is not a java Collection subtype.  For collection serializer, this is a special parameter supportCodegenHook needs be configured:  When true: Enables optimized access to collection elements and JIT compilation for better performanceDirect serialization invocation and inline for map key-value items without dynamic serializer dispatch cost.Better performance for standard collection typesRecommended for most collections When false: Uses interfaced-based element access and dynamic serializer dispatch for elements, which have higher costMore flexible for custom collection typesRequired when collection has special serialization needsHandles complex collection implementations  Implement Collection Serializer with JIT support‚Äã  When implementing a Collection serializer with JIT support, you can leverage Fory's existing binary format and collection serialization infrastructure. The key is to properly implement the onCollectionWrite and newCollection methods to handle metadata while letting Fory handle the element serialization.  Here's an example:  public class CustomCollectionSerializer&lt;T extends Collection&gt; extends CollectionSerializer&lt;T&gt; { public CustomCollectionSerializer(Fory fory, Class&lt;T&gt; cls) { // supportCodegenHook controls whether to use JIT compilation super(fory, cls, true); } @Override public Collection onCollectionWrite(MemoryBuffer buffer, T value) { // Write collection size buffer.writeVarUint32Small7(value.size()); // Write any additional collection metadata return value; } @Override public Collection newCollection(MemoryBuffer buffer) { // Create new collection instance Collection collection = super.newCollection(buffer); // Read and set collection size int numElements = getAndClearNumElements(); setNumElements(numElements); return collection; } }   Note that please invoke setNumElements when implementing newCollection to let fory know how many elements to deserialize.  Implement a totally-customzied Collection Serializer without JIT‚Äã  Sometimes you need to serialize a collection type that uses primitive arrays or has special requirements. In such cases, you can implement a serializer with JIT disabled and directly override the write and read methods.  This approach:  Gives you full control over serializationWorks well with primitive arraysBypasses collection iteration overheadAllows direct memory access  Here's an example of a custom integer list backed by a primitive array:  class IntList extends AbstractCollection&lt;Integer&gt; { private final int[] elements; private final int size; public IntList(int size) { this.elements = new int[size]; this.size = size; } public IntList(int[] elements, int size) { this.elements = elements; this.size = size; } @Override public Iterator&lt;Integer&gt; iterator() { return new Iterator&lt;Integer&gt;() { private int index = 0; @Override public boolean hasNext() { return index &lt; size; } @Override public Integer next() { if (!hasNext()) { throw new NoSuchElementException(); } return elements[index++]; } }; } @Override public int size() { return size; } public int get(int index) { if (index &gt;= size) { throw new IndexOutOfBoundsException(); } return elements[index]; } public void set(int index, int value) { if (index &gt;= size) { throw new IndexOutOfBoundsException(); } elements[index] = value; } public int[] getElements() { return elements; } } class IntListSerializer extends CollectionLikeSerializer&lt;IntList&gt; { public IntListSerializer(Fory fory) { // Disable JIT since we're handling serialization directly super(fory, IntList.class, false); } @Override public void write(MemoryBuffer buffer, IntList value) { // Write size buffer.writeVarUint32Small7(value.size()); // Write elements directly as primitive ints int[] elements = value.getElements(); for (int i = 0; i &lt; value.size(); i++) { buffer.writeVarInt32(elements[i]); } } @Override public IntList read(MemoryBuffer buffer) { // Read size int size = buffer.readVarUint32Small7(); // Create array and read elements int[] elements = new int[size]; for (int i = 0; i &lt; size; i++) { elements[i] = buffer.readVarInt32(); } return new IntList(elements, size); } // These methods are not used when JIT is disabled @Override public Collection onCollectionWrite(MemoryBuffer buffer, IntList value) { throw new UnsupportedOperationException(); } @Override public Collection newCollection(MemoryBuffer buffer) { throw new UnsupportedOperationException(); } @Override public IntList onCollectionRead(Collection collection) { throw new UnsupportedOperationException(); } }   Key Points:  Primitive Array Storage: Uses int[] for direct storageAvoids boxing/unboxing overheadProvides efficient memory layoutEnables direct array access Direct Serialization: Write size firstWrite primitive values directlyNo iteration overheadNo boxing/unboxing during serialization Direct Deserialization: Read size firstCreate primitive arrayRead values directly into arrayCreate list with populated array Disabled JIT: Set supportCodegenHook=falseOverride write/read methodsSkip collection view patternFull control over serialization format  When to Use: this approach is best when:  Working with primitive typesNeed maximum performanceWant to minimize memory overheadHave special serialization requirements  Usage Example:  // Create and populate list IntList list = new IntList(3); list.set(0, 1); list.set(1, 2); list.set(2, 3); // Serialize byte[] bytes = fory.serialize(list); // Deserialize IntList newList = (IntList) fory.deserialize(bytes);   This implementation is particularly efficient for scenarios where:  You're working exclusively with integersPerformance is criticalMemory efficiency is importantSerialization overhead needs to be minimized  Remember that while this approach gives up some of Fory's optimizations, it can provide better performance for specific use cases involving primitive types and direct array access.  Implement Serializer for Collection-like Types‚Äã  Sometimes you may want to implement a serializer for a type that behaves like a collection but isn't a standard Java Collection. This section demonstrates how to implement a serializer for such types.  The key principles for collection-like type serialization are:  Extend CollectionLikeSerializer for custom collection-like typesEnable JIT optimization with supportCodegenHookProvide efficient element access through viewsMaintain proper size tracking  Here's an example:  class CustomCollectionLike { private final Object[] elements; private final int size; public CustomCollectionLike(int size) { this.elements = new Object[size]; this.size = size; } // Constructor for wrapping existing array public CustomCollectionLike(Object[] elements, int size) { this.elements = elements; this.size = size; } public Object get(int index) { if (index &gt;= size) { throw new IndexOutOfBoundsException(); } return elements[index]; } public int size() { return size; } public Object[] getElements() { return elements; } } // A view class that extends AbstractCollection for simpler implementation class CollectionView extends AbstractCollection&lt;Object&gt; { private final Object[] elements; private final int size; private int writeIndex; // Constructor for serialization (wrapping existing array) public CollectionView(CustomCollectionLike collection) { this.elements = collection.getElements(); this.size = collection.size(); } // Constructor for deserialization public CollectionView(int size) { this.size = size; this.elements = new Object[size]; } @Override public Iterator&lt;Object&gt; iterator() { return new Iterator&lt;Object&gt;() { private int index = 0; @Override public boolean hasNext() { return index &lt; size; } @Override public Object next() { if (!hasNext()) { throw new NoSuchElementException(); } return elements[index++]; } }; } @Override public boolean add(Object element) { if (writeIndex &gt;= size) { throw new IllegalStateException(&quot;Collection is full&quot;); } elements[writeIndex++] = element; return true; } @Override public int size() { return size; } public Object[] getElements() { return elements; } } class CustomCollectionSerializer extends CollectionLikeSerializer&lt;CustomCollectionLike&gt; { public CustomCollectionSerializer(Fory fory) { super(fory, CustomCollectionLike.class, true); } @Override public Collection onCollectionWrite(MemoryBuffer buffer, CustomCollectionLike value) { buffer.writeVarUint32Small7(value.size()); return new CollectionView(value); } @Override public Collection newCollection(MemoryBuffer buffer) { int numElements = buffer.readVarUint32Small7(); setNumElements(numElements); return new CollectionView(numElements); } @Override public CustomCollectionLike onCollectionRead(Collection collection) { CollectionView view = (CollectionView) collection; return new CustomCollectionLike(view.getElements(), view.size()); } }   Key takeways:  Collection Structure: Array-based storage for elementsFixed size after creationDirect element accessSize tracking View Implementation: Extends AbstractCollection for simplicityProvides iterator for element accessImplements add() for deserializationShares array reference with original type Serializer Features: Uses supportCodegenHook=true for JIT optimizationShares array references when possibleMaintains proper size trackingUses view pattern for serialization Performance Aspects: Direct array accessMinimal object creationArray sharing between instancesEfficient iteration  Note that this implementation provides better performance at the cost of flexibility. Consider your specific use case when choosing this approach.  ","version":"0.12","tagName":"h3"},{"title":"Implement Map Serializer‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.12/guide/serialization#implement-map-serializer","content":" When implementing a serializer for a custom Map type, you must extend MapSerializer or MapLikeSerializer. The key difference between these two is that MapLikeSerializer can serialize a class which has a map-like structure but is not a java Map subtype.  Similar to collection serializer, this is a special parameter supportCodegenHook needs be configured:  When true: Enables optimized access to map elements and JIT compilation for better performanceDirect serialization invocation and inline for map key-value items without dynamic serializer dispatch cost.Better performance for standard map typesRecommended for most maps When false: Uses interfaced-based element access and dynamic serializer dispatch for elements, which have higher costMore flexible for custom map typesRequired when map has special serialization needsHandles complex map implementations  Implement Map Serializer with JIT support‚Äã  When implementing a Map serializer with JIT support, you can leverage Fory's existing chunk-based binary format and map serialization infrastructure. The key is to properly implement the onMapWrite and newMap methods to handle metadata while letting Fory handle the map key-value serialization.  Here's an example of implementing a custom map serializer:  public class CustomMapSerializer&lt;T extends Map&gt; extends MapSerializer&lt;T&gt; { public CustomMapSerializer(Fory fory, Class&lt;T&gt; cls) { // supportCodegenHook is a critical parameter that determines serialization behavior super(fory, cls, true); } @Override public Map onMapWrite(MemoryBuffer buffer, T value) { // Write map size buffer.writeVarUint32Small7(value.size()); // Write any additional map metadata here return value; } @Override public Map newMap(MemoryBuffer buffer) { // Read map size int numElements = buffer.readVarUint32Small7(); setNumElements(numElements); // Create and return new map instance T map = (T) new HashMap(numElements); fory.getRefResolver().reference(map); return map; } }   Note that please invoke setNumElements when implementing newMap to let fory know how many elements to deserialize.  Implement a totally-customzied Map Serializer without JIT‚Äã  Sometimes you may need complete control over the serialization process, or your map type might have special requirements that don't fit the standard patterns. In such cases, you can implement a serializer with supportCodegenHook=false and directly override the write and read methods.  This approach:  Gives you full control over serializationAllows custom binary formatBypasses the standard map serialization patternMay be simpler for special cases  Here's an example:  class FixedValueMap extends AbstractMap&lt;String, Integer&gt; { private final Set&lt;String&gt; keys; private final int fixedValue; public FixedValueMap(Set&lt;String&gt; keys, int fixedValue) { this.keys = keys; this.fixedValue = fixedValue; } @Override public Set&lt;Entry&lt;String, Integer&gt;&gt; entrySet() { Set&lt;Entry&lt;String, Integer&gt;&gt; entries = new HashSet&lt;&gt;(); for (String key : keys) { entries.add(new SimpleEntry&lt;&gt;(key, fixedValue)); } return entries; } @Override public Integer get(Object key) { return keys.contains(key) ? fixedValue : null; } public Set&lt;String&gt; getKeys() { return keys; } public int getFixedValue() { return fixedValue; } } class FixedValueMapSerializer extends MapLikeSerializer&lt;FixedValueMap&gt; { public FixedValueMapSerializer(Fory fory) { // Disable codegen since we're handling serialization directly super(fory, FixedValueMap.class, false); } @Override public void write(MemoryBuffer buffer, FixedValueMap value) { // Write the fixed value buffer.writeInt32(value.getFixedValue()); // Write the number of keys buffer.writeVarUint32Small7(value.getKeys().size()); // Write each key for (String key : value.getKeys()) { buffer.writeString(key); } } @Override public FixedValueMap read(MemoryBuffer buffer) { // Read the fixed value int fixedValue = buffer.readInt32(); // Read the number of keys int size = buffer.readVarUint32Small7(); Set&lt;String&gt; keys = new HashSet&lt;&gt;(size); for (int i = 0; i &lt; size; i++) { keys.add(buffer.readString()); } return new FixedValueMap(keys, fixedValue); } // These methods are not used when supportCodegenHook is false @Override public Map onMapWrite(MemoryBuffer buffer, FixedValueMap value) { throw new UnsupportedOperationException(); } @Override public FixedValueMap onMapRead(Map map) { throw new UnsupportedOperationException(); } @Override public FixedValueMap onMapCopy(Map map) { throw new UnsupportedOperationException(); } }   Key Points:  Disable Codegen: Set supportCodegenHook=false in constructorFory will use your write/read methods directlyNo JIT optimization will be appliedFull control over serialization format Write Method: Handle all serialization manuallyWrite custom fields firstWrite map entries in your preferred formatControl the exact binary layout Read Method: Handle all deserialization manuallyRead in same order as writtenCreate and populate map instanceRestore custom fields Unused Methods: onMapWrite, onMapRead, onMapCopy are not usedCan throw UnsupportedOperationExceptionOnly write and read are important  When to Use: this approach is best when  Map has custom fields or metadataSpecial serialization format is neededComplete control over binary format is requiredStandard map patterns don't fit  Trade-offs  Advantages: Complete control over serializationCustom binary format possibleSimpler implementation for special casesDirect handling of custom fields Disadvantages: No JIT optimizationPotentially lower performanceManual handling of all serializationMore code to maintain  Remember that disabling codegen means giving up some performance optimizations that Fory provides. Only use this approach when the standard map serialization pattern doesn't meet your needs.  Implement Serializer for Map-like Types‚Äã  Sometimes you may want to implement a serializer for a type that behaves like a map but isn't a standard Java map. This section demonstrates how to implement a serializer for such types.  The key principles for map-like type serialization are:  Extend MapLikeSerializer for custom collection-like typesEnable JIT optimization with supportCodegenHookProvide efficient element access through viewsMaintain proper size tracking  Here's a complete example:  // It's better to make it to implements the java.util.Map interface, in this way we don't have to implement such serializers by ourself. class CustomMapLike { private final Object[] keyArray; private final Object[] valueArray; private final int size; // Constructor for creating new instance public CustomMapLike(int initialCapacity) { this.keyArray = new Object[initialCapacity]; this.valueArray = new Object[initialCapacity]; this.size = 0; } // Constructor for wrapping existing arrays public CustomMapLike(Object[] keyArray, Object[] valueArray, int size) { this.keyArray = keyArray; this.valueArray = valueArray; this.size = size; } public Integer get(String key) { for (int i = 0; i &lt; size; i++) { if (key.equals(keyArray[i])) { return (Integer) valueArray[i]; } } return null; } public int size() { return size; } public Object[] getKeyArray() { return keyArray; } public Object[] getValueArray() { return valueArray; } } class MapView extends AbstractMap&lt;Object, Object&gt; { private final Object[] keyArray; private final Object[] valueArray; private final int size; private int writeIndex; // Constructor for serialization (wrapping existing CustomMapLike) public MapView(CustomMapLike mapLike) { this.size = mapLike.size(); this.keyArray = mapLike.getKeyArray(); this.valueArray = mapLike.getValueArray(); } // Constructor for deserialization public MapView(int size) { this.size = size; this.keyArray = new Object[size]; this.valueArray = new Object[size]; } @Override public Set&lt;Entry&lt;Object, Object&gt;&gt; entrySet() { return new AbstractSet&lt;Entry&lt;Object, Object&gt;&gt;() { @Override public Iterator&lt;Entry&lt;Object, Object&gt;&gt; iterator() { return new Iterator&lt;Entry&lt;Object, Object&gt;&gt;() { private int index = 0; @Override public boolean hasNext() { return index &lt; size; } @Override public Entry&lt;Object, Object&gt; next() { if (!hasNext()) { throw new NoSuchElementException(); } final int currentIndex = index++; return new SimpleEntry&lt;&gt;( keyArray[currentIndex], valueArray[currentIndex] ); } }; } @Override public int size() { return size; } }; } @Override public Object put(Object key, Object value) { if (writeIndex &gt;= size) { throw new IllegalStateException(&quot;Map is full&quot;); } keyArray[writeIndex] = key; valueArray[writeIndex] = value; writeIndex++; return null; } public Object[] getKeyArray() { return keyArray; } public Object[] getValueArray() { return valueArray; } public int size() { return size; } } class CustomMapLikeSerializer extends MapLikeSerializer&lt;CustomMapLike&gt; { public CustomMapLikeSerializer(Fory fory) { super(fory, CustomMapLike.class, true); } @Override public Map onMapWrite(MemoryBuffer buffer, CustomMapLike value) { buffer.writeVarUint32Small7(value.size()); // Return a zero-copy view using the same underlying arrays return new MapView(value); } @Override public Map newMap(MemoryBuffer buffer) { int numElements = buffer.readVarUint32Small7(); setNumElements(numElements); // Create a view with new arrays for deserialization return new MapView(numElements); } @Override public CustomMapLike onMapRead(Map map) { MapView view = (MapView) map; // Just pass the arrays directly - no copying needed return new CustomMapLike(view.getKeyArray(), view.getValueArray(), view.size()); } @Override public CustomMapLike onMapCopy(Map map) { MapView view = (MapView) map; // Just pass the arrays directly - no copying needed return new CustomMapLike(view.getKeyArray(), view.getValueArray(), view.size()); } }   ","version":"0.12","tagName":"h3"},{"title":"Register Custom Serializers‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.12/guide/serialization#register-custom-serializers","content":" After implementing your custom serializer, register it with Fory:  Fory fory = Fory.builder() .withLanguage(Language.JAVA) .build(); // Register map serializer fory.registerSerializer(CustomMap.class, new CustomMapSerializer&lt;&gt;(fory, CustomMap.class)); // Register collection serializer fory.registerSerializer(CustomCollection.class, new CustomCollectionSerializer&lt;&gt;(fory, CustomCollection.class));   Note that when implementing custom map or collection serializers:  Always extend the appropriate base class (MapSerializer/MapLikeSerializer for maps, CollectionSerializer/CollectionLikeSerializer for collections)Consider the impact of supportCodegenHook on performance and functionalityProperly handle reference tracking if neededImplement proper size management using setNumElements and getAndClearNumElements when supportCodegenHook is true  Besides registering serializes, one can also implement java.io.Externalizable for a class to customize serialization logic, such type will be serialized by fory ExternalizableSerializer.  ","version":"0.12","tagName":"h3"},{"title":"Memory Allocation Customization‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.12/guide/serialization#memory-allocation-customization","content":" Fory provides a MemoryAllocator interface that allows you to customize how memory buffers are allocated and grown during serialization operations. This can be useful for performance optimization, memory pooling, or debugging memory usage.  MemoryAllocator Interface‚Äã  The MemoryAllocator interface defines two key methods:  public interface MemoryAllocator { /** * Allocates a new MemoryBuffer with the specified initial capacity. */ MemoryBuffer allocate(int initialCapacity); /** * Grows an existing buffer to accommodate the new capacity. * The implementation must grow the buffer in-place by modifying * the existing buffer instance. */ MemoryBuffer grow(MemoryBuffer buffer, int newCapacity); }   Using Custom Memory Allocators‚Äã  You can set a global memory allocator that will be used by all MemoryBuffer instances:  // Create a custom allocator MemoryAllocator customAllocator = new MemoryAllocator() { @Override public MemoryBuffer allocate(int initialCapacity) { // Add extra capacity for debugging or pooling return MemoryBuffer.fromByteArray(new byte[initialCapacity + 100]); } @Override public MemoryBuffer grow(MemoryBuffer buffer, int newCapacity) { if (newCapacity &lt;= buffer.size()) { return buffer; } // Custom growth strategy - add 100% extra capacity int newSize = (int) (newCapacity * 2); byte[] data = new byte[newSize]; buffer.copyToUnsafe(0, data, Platform.BYTE_ARRAY_OFFSET, buffer.size()); buffer.initHeapBuffer(data, 0, data.length); return buffer; } }; // Set the custom allocator globally MemoryBuffer.setGlobalAllocator(customAllocator); // All subsequent MemoryBuffer allocations will use your custom allocator Fory fory = Fory.builder().withLanguage(Language.JAVA).build(); byte[] bytes = fory.serialize(someObject); // Uses custom allocator   Default Memory Allocator Behavior‚Äã  The default allocator uses the following growth strategy:  For buffers smaller than BUFFER_GROW_STEP_THRESHOLD (100MB): multiply capacity by 2For larger buffers: multiply capacity by 1.5 (capped at Integer.MAX_VALUE - 8)  This provides a balance between avoiding frequent reallocations and preventing excessive memory usage.  Use Cases‚Äã  Custom memory allocators are useful for:  Memory Pooling: Reuse allocated buffers to reduce GC pressurePerformance Tuning: Use different growth strategies based on your workloadDebugging: Add logging or tracking to monitor memory usageOff-heap Memory: Integrate with off-heap memory management systems  ","version":"0.12","tagName":"h3"},{"title":"Security & Class Registration‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.12/guide/serialization#security--class-registration","content":" ForyBuilder#requireClassRegistration can be used to disable class registration, this will allow to deserialize objects unknown types, more flexible but may be insecure if the classes contains malicious code.  Do not disable class registration unless you can ensure your environment is secure. Malicious code in init/equals/hashCode can be executed when deserializing unknown/untrusted types when this option disabled.  Class registration can not only reduce security risks, but also avoid classname serialization cost.  You can register class with API Fory#register.  Note that class registration order is important, serialization and deserialization peer should have same registration order.  Fory fory = xxx; fory.register(SomeClass.class); fory.register(SomeClass1.class, 200);   If you invoke ForyBuilder#requireClassRegistration(false) to disable class registration check, you can set org.apache.fory.resolver.ClassChecker by ClassResolver#setClassChecker to control which classes are allowed for serialization. For example, you can allow classes started with org.example.* by:  Fory fory = xxx; fory.getClassResolver().setClassChecker( (classResolver, className) -&gt; className.startsWith(&quot;org.example.&quot;));   AllowListChecker checker = new AllowListChecker(AllowListChecker.CheckLevel.STRICT); ThreadSafeFory fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().requireClassRegistration(true).withClassLoader(classLoader).build(); f.getClassResolver().setClassChecker(checker); checker.addListener(f.getClassResolver()); return f; }); checker.allowClass(&quot;org.example.*&quot;);   Fory also provided a org.apache.fory.resolver.AllowListChecker which is allowed/disallowed list based checker to simplify the customization of class check mechanism. You can use this checker or implement more sophisticated checker by yourself.  ","version":"0.12","tagName":"h3"},{"title":"Register class by name‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.12/guide/serialization#register-class-by-name","content":" Register class by id will have better performance and smaller space overhead. But in some cases, management for a bunch of type id is complex. In such cases, registering class by name using APIregister(Class&lt;?&gt; cls, String namespace, String typeName) is recommended.  fory.register(Foo.class, &quot;demo&quot;, &quot;Foo&quot;);   If there are no duplicate name for type, namespace can be left as empty to reduce serialized size.  Do not use this API to register class since it will increase serialized size a lot compared to register class by id  ","version":"0.12","tagName":"h3"},{"title":"Zero-Copy Serialization‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.12/guide/serialization#zero-copy-serialization","content":" import org.apache.fory.*; import org.apache.fory.config.*; import org.apache.fory.serializer.BufferObject; import org.apache.fory.memory.MemoryBuffer; import java.util.*; import java.util.stream.Collectors; public class ZeroCopyExample { // Note that fory instance should be reused instead of creation every time. static Fory fory = Fory.builder() .withLanguage(Language.JAVA) .build(); // mvn exec:java -Dexec.mainClass=&quot;io.ray.fory.examples.ZeroCopyExample&quot; public static void main(String[] args) { List&lt;Object&gt; list = Arrays.asList(&quot;str&quot;, new byte[1000], new int[100], new double[100]); Collection&lt;BufferObject&gt; bufferObjects = new ArrayList&lt;&gt;(); byte[] bytes = fory.serialize(list, e -&gt; !bufferObjects.add(e)); List&lt;MemoryBuffer&gt; buffers = bufferObjects.stream() .map(BufferObject::toBuffer).collect(Collectors.toList()); System.out.println(fory.deserialize(bytes, buffers)); } }   ","version":"0.12","tagName":"h3"},{"title":"Meta Sharing‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.12/guide/serialization#meta-sharing","content":" Fory supports share type metadata (class name, field name, final field type information, etc.) between multiple serializations in a context (ex. TCP connection), and this information will be sent to the peer during the first serialization in the context. Based on this metadata, the peer can rebuild the same deserializer, which avoids transmitting metadata for subsequent serializations and reduces network traffic pressure and supports type forward/backward compatibility automatically.  // Fory.builder() // .withLanguage(Language.JAVA) // .withRefTracking(false) // // share meta across serialization. // .withMetaContextShare(true) // Not thread-safe fory. MetaContext context = xxx; fory.getSerializationContext().setMetaContext(context); byte[] bytes = fory.serialize(o); // Not thread-safe fory. MetaContext context = xxx; fory.getSerializationContext().setMetaContext(context); fory.deserialize(bytes); // Thread-safe fory fory.setClassLoader(beanA.getClass().getClassLoader()); byte[] serialized = fory.execute( f -&gt; { f.getSerializationContext().setMetaContext(context); return f.serialize(beanA); } ); // thread-safe fory fory.setClassLoader(beanA.getClass().getClassLoader()); Object newObj = fory.execute( f -&gt; { f.getSerializationContext().setMetaContext(context); return f.deserialize(serialized); } );   Note that MetaContext is not thread-safe and cannot be reused across instances of fory or multiple threads. In cases of multi-threading, a separate MetaContext must be created for each fory instance.  ","version":"0.12","tagName":"h3"},{"title":"Deserialize non-existent classes‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.12/guide/serialization#deserialize-non-existent-classes","content":" Fory support deserializing non-existent classes, this feature can be enabled by ForyBuilder#deserializeNonexistentClass(true). When enabled, and metadata sharing enabled, Fory will store the deserialized data of this type in a lazy subclass of Map. By using the lazy map implemented by Fory, the rebalance cost of filling map during deserialization can be avoided, which further improves performance. If this data is sent to another process and the class exists in this process, the data will be deserialized into the object of this type without losing any information.  If metadata sharing is not enabled, the new class data will be skipped and an NonexistentSkipClass stub object will be returned.  ","version":"0.12","tagName":"h3"},{"title":"Copy/Map object from one type to another type‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.12/guide/serialization#copymap-object-from-one-type-to-another-type","content":" Fory support mapping object from one type to another type.  Notes: This mapping will execute a deep copy, all mapped fields are serialized into binary and deserialized from that binary to map into another type.All struct types must be registered with same ID, otherwise Fory can not mapping to correct struct type. Be careful when you use Fory#register(Class), because fory will allocate an auto-grown ID which might be inconsistent if you register classes with different order between Fory instance.  public class StructMappingExample { static class Struct1 { int f1; String f2; public Struct1(int f1, String f2) { this.f1 = f1; this.f2 = f2; } } static class Struct2 { int f1; String f2; double f3; } static ThreadSafeFory fory1 = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE).buildThreadSafeFory(); static ThreadSafeFory fory2 = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE).buildThreadSafeFory(); static { fory1.register(Struct1.class); fory2.register(Struct2.class); } public static void main(String[] args) { Struct1 struct1 = new Struct1(10, &quot;abc&quot;); Struct2 struct2 = (Struct2) fory2.deserialize(fory1.serialize(struct1)); Assert.assertEquals(struct2.f1, struct1.f1); Assert.assertEquals(struct2.f2, struct1.f2); struct1 = (Struct1) fory1.deserialize(fory2.serialize(struct2)); Assert.assertEquals(struct1.f1, struct2.f1); Assert.assertEquals(struct1.f2, struct2.f2); } }   ","version":"0.12","tagName":"h3"},{"title":"Migration‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.12/guide/serialization#migration","content":" ","version":"0.12","tagName":"h2"},{"title":"JDK migration‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.12/guide/serialization#jdk-migration","content":" If you use jdk serialization before, and you can't upgrade your client and server at the same time, which is common for online application. Fory provided an util method org.apache.fory.serializer.JavaSerializer.serializedByJDK to check whether the binary are generated by jdk serialization, you use following pattern to make exiting serialization protocol-aware, then upgrade serialization to fory in an async rolling-up way:  if (JavaSerializer.serializedByJDK(bytes)) { ObjectInputStream objectInputStream=xxx; return objectInputStream.readObject(); } else { return fory.deserialize(bytes); }   ","version":"0.12","tagName":"h3"},{"title":"Upgrade fory‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.12/guide/serialization#upgrade-fory","content":" Currently binary compatibility is ensured for minor versions only. For example, if you are using foryv0.2.0, binary compatibility will be provided if you upgrade to fory v0.2.1. But if upgrade to fory v0.4.1, no binary compatibility are ensured. Most of the time there is no need to upgrade fory to newer major version, the current version is fast and compact enough, and we provide some minor fix for recent older versions.  But if you do want to upgrade fory for better performance and smaller size, you need to write fory version as header to serialized data using code like following to keep binary compatibility:  MemoryBuffer buffer = xxx; buffer.writeVarInt32(2); fory.serialize(buffer, obj);   Then for deserialization, you need:  MemoryBuffer buffer = xxx; int foryVersion = buffer.readVarInt32(); Fory fory = getFory(foryVersion); fory.deserialize(buffer);   getFory is a method to load corresponding fory, you can shade and relocate different version of fory to different package, and load fory by version.  If you upgrade fory by minor version, or you won't have data serialized by older fory, you can upgrade fory directly, no need to versioning the data.  ","version":"0.12","tagName":"h3"},{"title":"Trouble shooting‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.12/guide/serialization#trouble-shooting","content":" ","version":"0.12","tagName":"h2"},{"title":"Class inconsistency and class version check‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.12/guide/serialization#class-inconsistency-and-class-version-check","content":" If you create fory without setting CompatibleMode to org.apache.fory.config.CompatibleMode.COMPATIBLE, and you got a strange serialization error, it may be caused by class inconsistency between serialization peer and deserialization peer.  In such cases, you can invoke ForyBuilder#withClassVersionCheck to create fory to validate it, if deserialization throws org.apache.fory.exception.ClassNotCompatibleException, it shows class are inconsistent, and you should create fory withForyBuilder#withCompaibleMode(CompatibleMode.COMPATIBLE).  CompatibleMode.COMPATIBLE has more performance and space cost, do not set it by default if your classes are always consistent between serialization and deserialization.  ","version":"0.12","tagName":"h3"},{"title":"Deserialize POJO into another type‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.12/guide/serialization#deserialize-pojo-into-another-type","content":" Fory allows you to serialize one POJO and deserialize it into a different POJO. The different POJO means the schema inconsistency. Users must to configure Fory withCompatibleMode set to org.apache.fory.config.CompatibleMode.COMPATIBLE.  public class DeserializeIntoType { static class Struct1 { int f1; String f2; public Struct1(int f1, String f2) { this.f1 = f1; this.f2 = f2; } } static class Struct2 { int f1; String f2; double f3; } static ThreadSafeFory fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE).buildThreadSafeFory(); public static void main(String[] args) { Struct1 struct1 = new Struct1(10, &quot;abc&quot;); byte[] data = fory.serializeJavaObject(struct1); Struct2 struct2 = (Struct2) fory.deserializeJavaObject(bytes, Struct2.class); } }   ","version":"0.12","tagName":"h3"},{"title":"Use wrong API for deserialization‚Äã","type":1,"pageTitle":"Java Serialization","url":"/docs/0.12/guide/serialization#use-wrong-api-for-deserialization","content":" If you serialize an object by invoking Fory#serialize, you should invoke Fory#deserialize for deserialization instead ofFory#deserializeJavaObject.  If you serialize an object by invoking Fory#serializeJavaObject, you should invoke Fory#deserializeJavaObject for deserialization instead of Fory#deserializeJavaObjectAndClass/Fory#deserialize.  If you serialize an object by invoking Fory#serializeJavaObjectAndClass, you should invoke Fory#deserializeJavaObjectAndClass for deserialization instead of Fory#deserializeJavaObject/Fory#deserialize. ","version":"0.12","tagName":"h3"},{"title":"How to release","type":0,"sectionRef":"#","url":"/docs/0.13/community/how_to_release","content":"","keywords":"","version":"0.13"},{"title":"Introduction‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.13/community/how_to_release#introduction","content":" Source Release is the most important part which Apache values.  Please pay more attention to license and signing issues. Publishing software is a serious thing and has legal consequences.  ","version":"0.13","tagName":"h2"},{"title":"First-time as a release manager‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.13/community/how_to_release#first-time-as-a-release-manager","content":" ","version":"0.13","tagName":"h2"},{"title":"Environmental requirements‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.13/community/how_to_release#environmental-requirements","content":" This release process is operated in the Ubuntu OS, and the following tools are required:  JDK 1.8Apache Maven 3.xPython 3.8GnuPG 2.xGitSVN (apache uses svn to host project releases)Pay attention to setting environment variables: if you configure gpg keys under a different directory, please export GNUPGHOME=$(xxx)  ","version":"0.13","tagName":"h3"},{"title":"Prepare GPG Key‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.13/community/how_to_release#prepare-gpg-key","content":" If you are the first to become a release manager, you need to prepare a gpg key.  Following is a quick setup, you can refer to Apache openpgp doc for further details.  Install GPG‚Äã  sudo apt install gnupg2   Generate GPG Key‚Äã  Please use your apache name and email for generate key  $ gpg --full-gen-key gpg (GnuPG) 2.2.20; Copyright (C) 2020 Free Software Foundation, Inc. This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. Please select what kind of key you want: (1) RSA and RSA (default) (2) DSA and Elgamal (3) DSA (sign only) (4) RSA (sign only) (14) Existing key from card Your selection? 1 # input 1 RSA keys may be between 1024 and 4096 bits long. What keysize do you want? (2048) 4096 # input 4096 Requested keysize is 4096 bits Please specify how long the key should be valid. 0 = key does not expire &lt;n&gt; = key expires in n days &lt;n&gt;w = key expires in n weeks &lt;n&gt;m = key expires in n months &lt;n&gt;y = key expires in n years Key is valid for? (0) 0 # input 0 Key does not expire at all Is this correct? (y/N) y # input y GnuPG needs to construct a user ID to identify your key. Real name: Chaokun Yang # input your name Email address: chaokunyang@apache.org # input your email Comment: CODE SIGNING KEY # input some annotations, optional You selected this USER-ID: &quot;Chaokun &lt;chaokunyang@apache.org&gt;&quot; Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? O # input O We need to generate a lot of random bytes. It is a good idea to perform some other action (type on the keyboard, move the mouse, utilize the disks) during the prime generation; this gives the random number generator a better chance to gain enough entropy. We need to generate a lot of random bytes. It is a good idea to perform some other action (type on the keyboard, move the mouse, utilize the disks) during the prime generation; this gives the random number generator a better chance to gain enough entropy. # Input the security key ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ Please enter this passphrase ‚îÇ ‚îÇ ‚îÇ ‚îÇ Passphrase: _______________________________ ‚îÇ ‚îÇ ‚îÇ ‚îÇ &lt;OK&gt; &lt;Cancel&gt; ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò # key generation will be done after your inputting the key with the following output gpg: key E49B00F626B marked as ultimately trusted gpg: revocation certificate stored as '/Users/chaokunyang/.gnupg/openpgp-revocs.d/1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4.rev' public and secret key created and signed. pub rsa4096 2022-07-12 [SC] 1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4 uid [ultimate] Chaokun &lt;chaokunyang@apache.org&gt; sub rsa4096 2022-07-12 [E]   Upload your public key to public GPG keyserver‚Äã  Firstly, list your key:  gpg --list-keys   The output is like:  -------------------------------------------------- pub rsa4096 2024-03-27 [SC] 1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4 uid [ultimate] chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; sub rsa4096 2024-03-27 [E]   Then, send your key id to key server:  gpg --keyserver keys.openpgp.org --send-key &lt;key-id&gt; # e.g., 1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4   Among them, keys.openpgp.org is a randomly selected keyserver, you can use keyserver.ubuntu.com or any other full-featured keyserver.  Check whether the key is created successfully‚Äã  Uploading takes about one minute; after that, you can check by email at the corresponding keyserver.  Uploading keys to the keyserver is mainly for joining a Web of Trust.  Add your GPG public key to the project KEYS file‚Äã  The svn repository of the release branch is: https://dist.apache.org/repos/dist/release/fory  Please add the public key to KEYS in the release branch:  svn co https://dist.apache.org/repos/dist/release/fory fory-dist # As this step will copy all the versions, it will take some time. If the network is broken, please use svn cleanup to delete the lock before re-execute it. cd fory-dist (gpg --list-sigs YOUR_NAME@apache.org &amp;&amp; gpg --export --armor YOUR_NAME@apache.org) &gt;&gt; KEYS # Append your key to the KEYS file svn add . # It is not needed if the KEYS document exists before. svn ci -m &quot;add gpg key for YOUR_NAME&quot; # Later on, if you are asked to enter a username and password, just use your apache username and password.   Upload the GPG public key to your GitHub account‚Äã  Enter https://github.com/settings/keys to add your GPG key.Please remember to bind the email address used in the GPG key to your GitHub account (https://github.com/settings/emails) if you find &quot;unverified&quot; after adding it.  ","version":"0.13","tagName":"h3"},{"title":"Further reading‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.13/community/how_to_release#further-reading","content":" It's recommended but not mandatory to read following documents before making a release to know more details about apache release:  Release policy: https://www.apache.org/legal/release-policy.htmlTLP release: https://infra.apache.org/release-distributionRelease sign: https://infra.apache.org/release-signing.htmlRelease publish: https://infra.apache.org/release-publishing.htmlRelease download pages: https://infra.apache.org/release-download-pages.htmlPublishing maven artifacts: https://infra.apache.org/publishing-maven-artifacts.html  ","version":"0.13","tagName":"h3"},{"title":"Start discussion about the release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.13/community/how_to_release#start-discussion-about-the-release","content":" Start a discussion about the next release via sending email to: dev@fory.apache.org:  Title:  [DISCUSS] Release Apache Fory ${release_version}   Content:  Hello, Apache Fory Community, This is a call for a discussion to release Apache Fory version ${release_version}. The change lists about this release: https://github.com/apache/fory/compare/v0.12.0...v0.12.1-rc1 Please leave your comments here about this release plan. We will bump the version in repo and start the release process after the discussion. Thanks, ${name}   ","version":"0.13","tagName":"h2"},{"title":"Preparing for release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.13/community/how_to_release#preparing-for-release","content":" If the discussion goes positive, you will need to prepare the release artifiacts.  ","version":"0.13","tagName":"h2"},{"title":"Github branch and tag‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.13/community/how_to_release#github-branch-and-tag","content":" Create a new branch named releases-0.12.0Bump version to $version by executing command python ci/release.py bump_version -l all -version $versionMake a git commit and push the branch to git@github.com:apache/fory.gitCreate a new tag by git tag v0.12.0-rc1, then push it to git@github.com:apache/fory.git  ","version":"0.13","tagName":"h3"},{"title":"Build and upload artifacts to SVN dist/dev repo‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.13/community/how_to_release#build-and-upload-artifacts-to-svn-distdev-repo","content":" First you need to build source release artifacts by python ci/release.py build -v $version.  Then you need to upload it to svn dist repo. The dist repo of the dev branch is: https://dist.apache.org/repos/dist/dev/fory  # As this step will copy all the versions, it will take some time. If the network is broken, please use svn cleanup to delete the lock before re-execute it. svn co https://dist.apache.org/repos/dist/dev/fory fory-dist-dev   Then, upload the artifacts:  cd fory-dist-dev # create a directory named by version mkdir ${release_version}-${rc_version} # copy source code and signature package to the versioned directory cp ${repo_dir}/dist/* ${release_version}-${rc_version} # check svn status svn status # add to svn svn add ${release_version}-${rc_version} # check svn status svn status # commit to SVN remote server svn commit -m &quot;Prepare for fory ${release_version}-${rc_version}&quot;   Visit https://dist.apache.org/repos/dist/dev/fory/ to check the artifacts are uploaded correctly.  ","version":"0.13","tagName":"h3"},{"title":"What to do if something goes wrong‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.13/community/how_to_release#what-to-do-if-something-goes-wrong","content":" If some files are unexpected, you need to remove by svn delete and repeat the above upload process.  ","version":"0.13","tagName":"h3"},{"title":"Voting‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.13/community/how_to_release#voting","content":" ","version":"0.13","tagName":"h2"},{"title":"check version‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.13/community/how_to_release#check-version","content":" Fory requires votes from the Fory Community.  release_version: the version for fory, like 0.12.0.release_candidate_version: the version for voting, like 0.12.0-rc1.maven_artifact_number: the number for Maven staging artifacts, like 1001. Specifically, the maven_artifact_number can be found by searching &quot;fory&quot; on https://repository.apache.org/#stagingRepositories.  ","version":"0.13","tagName":"h3"},{"title":"Build the source code of fory and release it to nexus‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.13/community/how_to_release#build-the-source-code-of-fory-and-release-it-to-nexus","content":" Configure Apache Account Passwords‚Äã  Before publishing Fory to Nexus, you need to securely configure your Apache account credentials. This step is critical as passwords must be encrypted.  First, open your Maven global settings file settings.xml, typically located at ~/.m2/settings.xml. Add or modify the following section:   &lt;servers&gt; &lt;server&gt; &lt;id&gt;apache.snapshots.https&lt;/id&gt; &lt;username&gt;your-apache-username&lt;/username&gt; &lt;password&gt;{your-encrypted-password}&lt;/password&gt; &lt;/server&gt; &lt;server&gt; &lt;id&gt;apache.releases.https&lt;/id&gt; &lt;username&gt;your-apache-username&lt;/username&gt; &lt;password&gt;{your-encrypted-password}&lt;/password&gt; &lt;/server&gt; &lt;/servers&gt;   Important Notes:  Replace your-apache-username with your Apache LDAP usernamePasswords must be encrypted using Maven's password encryption toolEncrypted passwords should be enclosed in curly braces {}  Refer to the official documentation for detailed encryption instructions: Publishing Maven Artifacts  Steps to encrypt your password:  Generate a master password (if you haven't already): mvn --encrypt-master-password your-master-password Save the output to ~/.m2/settings-security.xml: &lt;settingsSecurity&gt; &lt;master&gt;{your-encrypted-master-password}&lt;/master&gt; &lt;/settingsSecurity&gt; Encrypt your Apache account password: mvn --encrypt-password your-apache-password Place the encrypted output into the password field in settings.xml  Build and Publish Java Module‚Äã   # Navigate to the Java module directory cd java # Execute Maven build and deploy to Nexus # -T10: Use 10 threads for parallel build, improving speed # clean: Clean the project # deploy: Deploy to remote repository # -Papache-release: Activate apache-release profile # -DskipTests: Skip tests # -Dgpg.skip=false: Enable GPG signing (required for release verification) mvn -T10 clean deploy -Papache-release -DskipTests -Dgpg.skip=false   Build and Publish Kotlin Module‚Äã   # Return to project root and navigate to Kotlin module cd ../kotlin # Execute the same Maven command as Java module # Configuration parameters are identical to Java module mvn -T10 clean deploy -Papache-release -DskipTests -Dgpg.skip=false   Build and Publish Scala Module‚Äã   # Return to project root and navigate to Scala module cd ../scala # Build and sign JARs for all Scala versions # +publishSigned: Execute publishSigned for all configured Scala versions echo &quot;Starting to build Scala JARs...&quot; sbt +publishSigned # Prepare for upload to Sonatype (Nexus) # sonatypePrepare: Prepare for Maven Central Repository release echo &quot;Starting upload preparation...&quot; sbt sonatypePrepare # Upload packaged JARs to Sonatype # sonatypeBundleUpload: Upload prepared bundles echo &quot;Starting JAR upload...&quot; sbt sonatypeBundleUpload echo &quot;Scala JAR deployment succeeded!&quot;   Lock the Release in Nexus‚Äã  After completing the publication of all modules, perform the following steps in Nexus:  Log in to the Apache Nexus repository management interfaceNavigate to the &quot;Snapshots&quot; or &quot;Releases&quot; repository (depending on your release type)Locate the latest Fory project versionExecute the &quot;Close&quot; operation to validate all uploaded artifactsAfter successful validation, execute the &quot;Release&quot; operation to finalize the deployment  These steps ensure all published artifacts are verified and correctly deployed to the public repository.  ","version":"0.13","tagName":"h3"},{"title":"build a Pre-release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.13/community/how_to_release#build-a-pre-release","content":" You need to build a Pre-release before voting, such as:https://github.com/apache/fory/releases/tag/v0.12.0-rc1  ","version":"0.13","tagName":"h3"},{"title":"Fory Community Vote‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.13/community/how_to_release#fory-community-vote","content":" you need send a email to Fory Community: dev@fory.apache.org:  Title:  [VOTE] Release Apache Fory v${release_version}-${rc_version}   Content:  Hello, Apache Fory Community: This is a call for vote to release Apache Fory version release-${release_version}-${rc_version}. Apache Fory - A blazingly fast multi-language serialization framework powered by JIT and zero-copy. The discussion thread: https://lists.apache.org/thread/xxr3od301g6v3ndj14zqc05byp9qvclh The change lists about this release: https://github.com/apache/fory/compare/v0.12.0...v0.12.1-rc1 The release candidates: https://dist.apache.org/repos/dist/dev/fory/0.5.0-rc3/ The maven staging for this release: https://repository.apache.org/content/repositories/orgapachefory-1003 Git tag for the release: https://github.com/apache/fory/releases/tag/v0.12.0-rc1 Git commit for the release: https://github.com/apache/fory/commit/fae06330edd049bb960536e978a45b97bca66faf The artifacts signed with PGP key [5E580BA4], corresponding to [chaokunyang@apache.org], that can be found in keys file: https://downloads.apache.org/fory/KEYS The vote will be open for at least 72 hours until the necessary number of votes are reached. Please vote accordingly: [ ] +1 approve [ ] +0 no opinion [ ] -1 disapprove with the reason To learn more about Fory, please see https://fory.apache.org/ *Valid check is a requirement for a vote. *Checklist for reference: [ ] Download Fory is valid. [ ] Checksums and PGP signatures are valid. [ ] Source code distributions have correct names matching the current release. [ ] LICENSE and NOTICE files are correct. [ ] All files have license headers if necessary. [ ] No compiled archives bundled in source archive. [ ] Can compile from source. How to Build and Test, please refer to: https://github.com/apache/fory/blob/main/docs/guide/DEVELOPMENT.md Thanks, ${name}   After at least 3 +1 binding vote (from Fory Podling PMC member and committers) and no veto, first, reply to the above voting thread to notify that the voting has ended.  Hi all, The vote for Release Apache Fory v${release_version}-${rc_version} is closed now. Thanks to everyone for helping checking and voting for the release. I will close the vote later in another thread. Best, ${name}   Immediately afterward, launch a new voting thread to claim the voting results.  Title:  [RESULT][VOTE] Release Apache Fory v${release_version}-${rc_version}   Content:  Hello, Apache Fory Community, The vote to release Apache Fory v${release_version}-${rc_version} has passed. The vote PASSED with 3 binding +1 and 0 -1 vote: Binding votes: - xxx - yyy - zzz Vote thread: ${vote_thread_url} Thanks, ${name}   ","version":"0.13","tagName":"h3"},{"title":"What if vote fail‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.13/community/how_to_release#what-if-vote-fail","content":" If the vote failed, click &quot;Drop&quot; to drop the staging Maven artifacts.  Address the raised issues, then bump rc_version and file a new vote again.  ","version":"0.13","tagName":"h3"},{"title":"Official Release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.13/community/how_to_release#official-release","content":" ","version":"0.13","tagName":"h2"},{"title":"Publish artifacts to SVN Release Directory‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.13/community/how_to_release#publish-artifacts-to-svn-release-directory","content":" release_version: the release version for fory, like 0.5.0release_candidate_version: the version for voting, like 0.5.0-rc1  svn mv https://dist.apache.org/repos/dist/dev/fory/${release_version}-${rc_version} https://dist.apache.org/repos/dist/release/fory/${release_version} -m &quot;Release fory ${release_version}&quot;   In the repository at https://dist.apache.org/repos/dist/dev/fory/, if any outdated release_candidate_version are left behind when releasing the release_version, please clear them to keep the dev repository tidy.  When https://archive.apache.org/dist/fory/0.12.0/${release_version} is accessible (confirming that the release_version has been successfully released and archived), we may clean up the previous release version in the release repository, leaving only the current version.  ","version":"0.13","tagName":"h3"},{"title":"Update Fory&Fory-Site content‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.13/community/how_to_release#update-foryfory-site-content","content":" Submit a PR to https://github.com/apache/fory-site to update Fory-site. Reference implementation: #283and #285.  Update Fory-Site‚Äã  In general, the following two key areas need to be modified:  Write a new announcement, for example: Add a new markdown file under the blog folder:  The Apache Fory team is pleased to announce the [?] release. This is a major release that includes [? PR](https://github.com/apache/fory/compare/v[?]...v[?]) from ? distinct contributors. See the [Install](https://fory.apache.org/docs/start/install) Page to learn how to get the libraries for your platform.   Replace versions by upgrading old versions to new ones. For example, in install section, it is necessary to update the documentation for both the development branch and the latest release branch::  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-core&lt;/artifactId&gt; &lt;version&gt;0.11.2&lt;/version&gt; &lt;/dependency&gt;   Update Fory‚Äã  Submit a PR to https://github.com/apache/fury to update README, like #2207.  ","version":"0.13","tagName":"h3"},{"title":"Github officially released‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.13/community/how_to_release#github-officially-released","content":" You need to officially release this version in the Fory project Reference implementation: https://github.com/apache/fory/releases/tag/v0.12.0  ","version":"0.13","tagName":"h3"},{"title":"Release Maven artifacts‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.13/community/how_to_release#release-maven-artifacts","content":" maven_artifact_number: the number for Maven staging artifacts, like 1001.Open https://repository.apache.org/#stagingRepositories.Find the artifact orgapachefory-${maven_artifact_number}, click &quot;Release&quot;.  ","version":"0.13","tagName":"h3"},{"title":"Send the announcement‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.13/community/how_to_release#send-the-announcement","content":" Send the release announcement to dev@fory.apache.org and CC announce@apache.org.  Title:  [ANNOUNCE] Apache Fory ${release_version} released   Content:  Hi all, The Apache Fory community is pleased to announce that Apache Fory {release_version} has been released! Apache Fory - A blazingly fast multi-language serialization framework powered by JIT and zero-copy. The release notes are available here: https://github.com/apache/fory/releases/tag/v${release_version} For the complete list of changes: https://github.com/apache/fory/compare/v0.12.0...v${release_version} Apache Fory website: https://fory.apache.org/ Download Links: https://fory.apache.org/download Fory Resources: - Fory github repo: https://github.com/apache/fory - Issue: https://github.com/apache/fory/issues - Mailing list: dev@fory.apache.org We are looking to grow our community and welcome new contributors. If you are interested in contributing to Fory, please contact us on the mailing list or on GitHub. We will be happy to help you get started. ------------------ Best Regards, ${your_name}   Remember to use plain text instead of rich text format, or you may be rejected when CC announce@apache.org  After completing the above steps, the Fory release process comes to an end. ","version":"0.13","tagName":"h3"},{"title":"GraalVM Serialization","type":0,"sectionRef":"#","url":"/docs/0.13/guide/graalvm_serialization","content":"","keywords":"","version":"0.13"},{"title":"GraalVM Native Image‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.13/guide/graalvm_serialization#graalvm-native-image","content":" GraalVM native image can compile java code into native code ahead to build faster, smaller, leaner applications. The native image doesn't have a JIT compiler to compile bytecode into machine code, and doesn't support reflection unless configure reflection file.  Apache Fory‚Ñ¢ runs on GraalVM native image pretty well. Apache Fory‚Ñ¢ generates all serializer code for Fory JIT framework and MethodHandle/LambdaMetafactory at graalvm build time. Then use those generated code for serialization at runtime without any extra cost, the performance is great.  In order to use Apache Fory‚Ñ¢ on graalvm native image, you must create Fory as an static field of a class, and register all classes at the enclosing class initialize time. Then configure native-image.properties underresources/META-INF/native-image/$xxx/native-image.properties to tell graalvm to init the class at native image build time. For example, here we configure org.apache.fory.graalvm.Example class be init at build time:  Args = --initialize-at-build-time=org.apache.fory.graalvm.Example   The main benefit of using Fory with GraalVM is that you don't need to configure reflection json orserialization json for your serializable classes! This eliminates the tedious, cumbersome and error-prone configuration process.  Fory achieves this by using codegen instead of reflection - all serialization code is generated at build time when you call:  fory.register(YourClass.class) to register your classesfory.ensureSerializersCompiled() to compile serializers at build time  Note that Fory asyncCompilationEnabled option will be disabled automatically for graalvm native image since graalvm native image doesn't support JIT at the image run time.  ","version":"0.13","tagName":"h2"},{"title":"Registering Your Classes‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.13/guide/graalvm_serialization#registering-your-classes","content":" If you encounter a GraalVM error like:  Type com.example.MyClass is instantiated reflectively but was never registered   This means you need to register your class with Fory. Do NOT add it to reflect-config.json - instead, register it with Fory's codegen system:  static { fory = Fory.builder().build(); // register class fory.register(MyClass.class); // ensure all serializers for registered classes being compiled by fory at graalvm native image build time. fory.ensureSerializersCompiled(); }   And make sure the class executing static registering is initialized at build time in native-image.properties:  Args = --initialize-at-build-time=com.example.MyForySerializer   This approach is much more efficient than reflection-based serialization and eliminates the need for complex GraalVM configuration files.  ","version":"0.13","tagName":"h2"},{"title":"Not thread-safe Fory‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.13/guide/graalvm_serialization#not-thread-safe-fory","content":" Example:  import org.apache.fory.Fory; import org.apache.fory.util.Preconditions; import java.util.List; import java.util.Map; public class Example { public record Record ( int f1, String f2, List&lt;String&gt; f3, Map&lt;String, Long&gt; f4) { } static Fory fory; static { fory = Fory.builder().build(); // register class fory.register(Record.class); // ensure all serializers for registered classes being compiled by fory at graalvm native image build time. fory.ensureSerializersCompiled(); } public static void main(String[] args) { Record record = new Record(10, &quot;abc&quot;, List.of(&quot;str1&quot;, &quot;str2&quot;), Map.of(&quot;k1&quot;, 10L, &quot;k2&quot;, 20L)); System.out.println(record); byte[] bytes = fory.serialize(record); Object o = fory.deserialize(bytes); System.out.println(o); Preconditions.checkArgument(record.equals(o)); } }   Then add org.apache.fory.graalvm.Example build time init to native-image.properties configuration:  Args = --initialize-at-build-time=org.apache.fory.graalvm.Example   ","version":"0.13","tagName":"h2"},{"title":"Thread-safe Fory‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.13/guide/graalvm_serialization#thread-safe-fory","content":" import org.apache.fory.Fory; import org.apache.fory.ThreadLocalFory; import org.apache.fory.ThreadSafeFory; import org.apache.fory.util.Preconditions; import java.util.List; import java.util.Map; public class ThreadSafeExample { public record Foo ( int f1, String f2, List&lt;String&gt; f3, Map&lt;String, Long&gt; f4) { } static ThreadSafeFory fory; static { fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().build(); // register class f.register(Foo.class); // ensure all serializers for registered classes being compiled by fory at graalvm native image build time. fory.ensureSerializersCompiled(); return f; }); } public static void main(String[] args) { System.out.println(fory.deserialize(fory.serialize(&quot;abc&quot;))); System.out.println(fory.deserialize(fory.serialize(List.of(1,2,3)))); System.out.println(fory.deserialize(fory.serialize(Map.of(&quot;k1&quot;, 1, &quot;k2&quot;, 2)))); Foo foo = new Foo(10, &quot;abc&quot;, List.of(&quot;str1&quot;, &quot;str2&quot;), Map.of(&quot;k1&quot;, 10L, &quot;k2&quot;, 20L)); System.out.println(foo); byte[] bytes = fory.serialize(foo); Object o = fory.deserialize(bytes); System.out.println(o); } }   Then add org.apache.fory.graalvm.ThreadSafeExample build time init to native-image.properties configuration:  Args = --initialize-at-build-time=org.apache.fory.graalvm.ThreadSafeExample   ","version":"0.13","tagName":"h2"},{"title":"Framework Integration‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.13/guide/graalvm_serialization#framework-integration","content":" For framework developers, if you want to integrate fory for serialization, you can provided a configuration file to let the users to list all the classes they want to serialize, then you can load those classes and invokeorg.apache.fory.Fory.register(Class&lt;?&gt;) to register those classes in your Fory integration class. After all classes are registered, you need to invoke org.apache.fory.Fory.ensureSerializersCompiled() to compile serializers at build time, and configure that class be initialized at graalvm native image build time.  ","version":"0.13","tagName":"h2"},{"title":"Benchmark‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.13/guide/graalvm_serialization#benchmark","content":" Here we give two class benchmarks between Fory and Graalvm Serialization.  When Fory compression is disabled:  Struct: Fory is 46x speed, 43% size compared to JDK.Pojo: Fory is 12x speed, 56% size compared to JDK.  When Fory compression is enabled:  Struct: Fory is 24x speed, 31% size compared to JDK.Pojo: Fory is 12x speed, 48% size compared to JDK.  See [Benchmark.java] for benchmark code.  ","version":"0.13","tagName":"h2"},{"title":"Struct Benchmark‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.13/guide/graalvm_serialization#struct-benchmark","content":" Class Fields‚Äã  public class Struct implements Serializable { public int f1; public long f2; public float f3; public double f4; public int f5; public long f6; public float f7; public double f8; public int f9; public long f10; public float f11; public double f12; }   Benchmark Results‚Äã  No compression:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Struct Compress number: false Fory size: 76.0 JDK size: 178.0 Fory serialization took mills: 49 JDK serialization took mills: 2254 Compare speed: Fory is 45.70x speed of JDK Compare size: Fory is 0.43x size of JDK   Compress number:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Struct Compress number: true Fory size: 55.0 JDK size: 178.0 Fory serialization took mills: 130 JDK serialization took mills: 3161 Compare speed: Fory is 24.16x speed of JDK Compare size: Fory is 0.31x size of JDK   ","version":"0.13","tagName":"h3"},{"title":"Pojo Benchmark‚Äã","type":1,"pageTitle":"GraalVM Serialization","url":"/docs/0.13/guide/graalvm_serialization#pojo-benchmark","content":" Class Fields‚Äã  public class Foo implements Serializable { int f1; String f2; List&lt;String&gt; f3; Map&lt;String, Long&gt; f4; }   Benchmark Results‚Äã  No compression:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Foo Compress number: false Fory size: 541.0 JDK size: 964.0 Fory serialization took mills: 1663 JDK serialization took mills: 16266 Compare speed: Fory is 12.19x speed of JDK Compare size: Fory is 0.56x size of JDK   Compress number:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Foo Compress number: true Fory size: 459.0 JDK size: 964.0 Fory serialization took mills: 1289 JDK serialization took mills: 15069 Compare speed: Fory is 12.11x speed of JDK Compare size: Fory is 0.48x size of JDK  ","version":"0.13","tagName":"h3"},{"title":"Row Format","type":0,"sectionRef":"#","url":"/docs/0.13/guide/row_format","content":"","keywords":"","version":"0.13"},{"title":"Java‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.13/guide/row_format#java","content":" public class Bar { String f1; List&lt;Long&gt; f2; } public class Foo { int f1; List&lt;Integer&gt; f2; Map&lt;String, Integer&gt; f3; List&lt;Bar&gt; f4; } RowEncoder&lt;Foo&gt; encoder = Encoders.bean(Foo.class); Foo foo = new Foo(); foo.f1 = 10; foo.f2 = IntStream.range(0, 1000000).boxed().collect(Collectors.toList()); foo.f3 = IntStream.range(0, 1000000).boxed().collect(Collectors.toMap(i -&gt; &quot;k&quot;+i, i-&gt;i)); List&lt;Bar&gt; bars = new ArrayList&lt;&gt;(1000000); for (int i = 0; i &lt; 1000000; i++) { Bar bar = new Bar(); bar.f1 = &quot;s&quot;+i; bar.f2 = LongStream.range(0, 10).boxed().collect(Collectors.toList()); bars.add(bar); } foo.f4 = bars; // Can be zero-copy read by python BinaryRow binaryRow = encoder.toRow(foo); // can be data from python Foo newFoo = encoder.fromRow(binaryRow); // zero-copy read List&lt;Integer&gt; f2 BinaryArray binaryArray2 = binaryRow.getArray(1); // zero-copy read List&lt;Bar&gt; f4 BinaryArray binaryArray4 = binaryRow.getArray(3); // zero-copy read 11th element of `readList&lt;Bar&gt; f4` BinaryRow barStruct = binaryArray4.getStruct(10); // zero-copy read 6th of f2 of 11th element of `readList&lt;Bar&gt; f4` barStruct.getArray(1).getInt64(5); RowEncoder&lt;Bar&gt; barEncoder = Encoders.bean(Bar.class); // deserialize part of data. Bar newBar = barEncoder.fromRow(barStruct); Bar newBar2 = barEncoder.fromRow(binaryArray4.getStruct(20));   ","version":"0.13","tagName":"h2"},{"title":"Python‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.13/guide/row_format#python","content":" @dataclass class Bar: f1: str f2: List[pa.int64] @dataclass class Foo: f1: pa.int32 f2: List[pa.int32] f3: Dict[str, pa.int32] f4: List[Bar] encoder = pyfory.encoder(Foo) foo = Foo(f1=10, f2=list(range(1000_000)), f3={f&quot;k{i}&quot;: i for i in range(1000_000)}, f4=[Bar(f1=f&quot;s{i}&quot;, f2=list(range(10))) for i in range(1000_000)]) binary: bytes = encoder.to_row(foo).to_bytes() print(f&quot;start: {datetime.datetime.now()}&quot;) foo_row = pyfory.RowData(encoder.schema, binary) print(foo_row.f2[100000], foo_row.f4[100000].f1, foo_row.f4[200000].f2[5]) print(f&quot;end: {datetime.datetime.now()}&quot;) binary = pickle.dumps(foo) print(f&quot;pickle start: {datetime.datetime.now()}&quot;) new_foo = pickle.loads(binary) print(new_foo.f2[100000], new_foo.f4[100000].f1, new_foo.f4[200000].f2[5]) print(f&quot;pickle end: {datetime.datetime.now()}&quot;)   ","version":"0.13","tagName":"h2"},{"title":"Apache Arrow Support‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.13/guide/row_format#apache-arrow-support","content":" Apache Fory‚Ñ¢ Row Format also supports automatic conversion from/to Arrow Table/RecordBatch.  Java:  Schema schema = TypeInference.inferSchema(BeanA.class); ArrowWriter arrowWriter = ArrowUtils.createArrowWriter(schema); Encoder&lt;BeanA&gt; encoder = Encoders.rowEncoder(BeanA.class); for (int i = 0; i &lt; 10; i++) { BeanA beanA = BeanA.createBeanA(2); arrowWriter.write(encoder.toRow(beanA)); } return arrowWriter.finishAsRecordBatch();   ","version":"0.13","tagName":"h3"},{"title":"Support for Interface and Extension Types‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.13/guide/row_format#support-for-interface-and-extension-types","content":" Fory now supports row format mapping for Java interface types and subclassed (extends) types, enabling more dynamic and flexible data schemas.  These enhancements were introduced in #2243, #2250, and #2256.  ","version":"0.13","tagName":"h2"},{"title":"Example: Interface Mapping with RowEncoder‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.13/guide/row_format#example-interface-mapping-with-rowencoder","content":" public interface Animal { String speak(); } public class Dog implements Animal { public String name; @Override public String speak() { return &quot;Woof&quot;; } } // Encode and decode using RowEncoder with interface type RowEncoder&lt;Animal&gt; encoder = Encoders.bean(Animal.class); Dog dog = new Dog(); dog.name = &quot;Bingo&quot;; BinaryRow row = encoder.toRow(dog); Animal decoded = encoder.fromRow(row); System.out.println(decoded.speak()); // Woof   ","version":"0.13","tagName":"h3"},{"title":"Example: Extension Type with RowEncoder‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.13/guide/row_format#example-extension-type-with-rowencoder","content":" public class Parent { public String parentField; } public class Child extends Parent { public String childField; } // Encode and decode using RowEncoder with parent class type RowEncoder&lt;Parent&gt; encoder = Encoders.bean(Parent.class); Child child = new Child(); child.parentField = &quot;Hello&quot;; child.childField = &quot;World&quot;; BinaryRow row = encoder.toRow(child); Parent decoded = encoder.fromRow(row);   Python:  import pyfory encoder = pyfory.encoder(Foo) encoder.to_arrow_record_batch([foo] * 10000) encoder.to_arrow_table([foo] * 10000)   C++  std::shared_ptr&lt;ArrowWriter&gt; arrow_writer; EXPECT_TRUE( ArrowWriter::Make(schema, ::arrow::default_memory_pool(), &amp;arrow_writer) .ok()); for (auto &amp;row : rows) { EXPECT_TRUE(arrow_writer-&gt;Write(row).ok()); } std::shared_ptr&lt;::arrow::RecordBatch&gt; record_batch; EXPECT_TRUE(arrow_writer-&gt;Finish(&amp;record_batch).ok()); EXPECT_TRUE(record_batch-&gt;Validate().ok()); EXPECT_EQ(record_batch-&gt;num_columns(), schema-&gt;num_fields()); EXPECT_EQ(record_batch-&gt;num_rows(), row_nums);   Schema schema = TypeInference.inferSchema(BeanA.class); ArrowWriter arrowWriter = ArrowUtils.createArrowWriter(schema); Encoder&lt;BeanA&gt; encoder = Encoders.rowEncoder(BeanA.class); for (int i = 0; i &lt; 10; i++) { BeanA beanA = BeanA.createBeanA(2); arrowWriter.write(encoder.toRow(beanA)); } return arrowWriter.finishAsRecordBatch();  ","version":"0.13","tagName":"h3"},{"title":"Benchmark","type":0,"sectionRef":"#","url":"/docs/0.13/introduction/benchmark","content":"","keywords":"","version":"0.13"},{"title":"Java Benchmark‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/0.13/introduction/benchmark#java-benchmark","content":" The following benchmarks compare Fory against popular Java serialization frameworks. Charts labeled &quot;compatible&quot; show schema evolution mode with forward/backward compatibility enabled, while others show schema consistent mode where class schemas must match.  Test Classes:  Struct: Class with 100 primitive fieldsMediaContent: Class from jvm-serializersSample: Class from Kryo benchmark  ","version":"0.13","tagName":"h2"},{"title":"Java Serialization‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/0.13/introduction/benchmark#java-serialization","content":"         ","version":"0.13","tagName":"h3"},{"title":"Java Deserialization‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/0.13/introduction/benchmark#java-deserialization","content":"         Important: Fory's runtime code generation requires proper warm-up for performance measurement:  For additional benchmarks covering type forward/backward compatibility, off-heap support, and zero-copy serialization, see Java Benchmarks.  ","version":"0.13","tagName":"h3"},{"title":"Rust Benchmark‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/0.13/introduction/benchmark#rust-benchmark","content":" Fory Rust demonstrates competitive performance compared to other Rust serialization frameworks.        Note: Results depend on hardware, dataset, and implementation versions. See the Rust guide for how to run benchmarks yourself: https://github.com/apache/fory/blob/main/benchmarks/rust_benchmark/README.md  ","version":"0.13","tagName":"h2"},{"title":"JavaScript Benchmark‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/0.13/introduction/benchmark#javascript-benchmark","content":"   The data used for this bar graph includes a complex object that has many kinds of field types, and the size of the JSON data is 3KB.  See benchmarks for the benchmark code. ","version":"0.13","tagName":"h2"},{"title":"Overview","type":0,"sectionRef":"#","url":"/docs/0.13/introduction/overview","content":"","keywords":"","version":"0.13"},{"title":"Key Features‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.13/introduction/overview#key-features","content":" ","version":"0.13","tagName":"h2"},{"title":"üöÄ High-Performance Serialization‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.13/introduction/overview#-high-performance-serialization","content":" Apache Fory‚Ñ¢ delivers exceptional performance through advanced optimization techniques:  JIT Compilation: Runtime code generation for Java eliminates virtual method calls and inlines hot pathsStatic Code Generation: Compile-time code generation for Rust, C++, and Go delivers peak performance without runtime overheadZero-Copy Operations: Direct memory access without intermediate buffer copies; row format enables random access and partial serializationIntelligent Encoding: Variable-length compression for integers and strings; SIMD acceleration for arrays (Java 16+)Meta Sharing: Class metadata packing reduces redundant type information across serializations  ","version":"0.13","tagName":"h3"},{"title":"üîÑ Cross-Language Serialization‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.13/introduction/overview#-cross-language-serialization","content":" The xlang serialization format enables seamless data exchange across programming languages:  Automatic Type Mapping: Intelligent conversion between language-specific types (type mapping)Reference Preservation: Shared and circular references work correctly across languagesPolymorphism: Objects serialize/deserialize with their actual runtime typesSchema Evolution: Optional forward/backward compatibility for evolving schemasAutomatic Serialization: No IDL or schema definitions required; serialize any object directly without code generation  ","version":"0.13","tagName":"h3"},{"title":"üìä Row Format‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.13/introduction/overview#-row-format","content":" A cache-friendly row format optimized for analytics workloads:  Zero-Copy Random Access: Read individual fields without deserializing entire objectsPartial Operations: Selective field serialization and deserialization for efficiencyApache Arrow Integration: Seamless conversion to columnar format for analytics pipelinesMulti-Language: Available in Java, Python, Rust and C++  ","version":"0.13","tagName":"h3"},{"title":"üîí Security & Production-Readiness‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.13/introduction/overview#-security--production-readiness","content":" Enterprise-grade security and compatibility:  Class Registration: Whitelist-based deserialization control (enabled by default)Depth Limiting: Protection against recursive object graph attacksConfigurable Policies: Custom class checkers and deserialization policiesPlatform Support: Java 8-24, GraalVM native image, multiple OS platforms  ","version":"0.13","tagName":"h3"},{"title":"Protocols‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.13/introduction/overview#protocols","content":" Apache Fory‚Ñ¢ implements multiple binary protocols optimized for different scenarios:  Protocol\tUse Case\tKey FeaturesXlang Serialization\tCross-language object exchange\tAutomatic serialization, references, polymorphism Java Serialization\tHigh-performance Java-only\tDrop-in JDK serialization replacement, 100x faster Row Format\tAnalytics and data processing\tZero-copy random access, Arrow compatibility Python Native\tPython-specific serialization\tPickle/cloudpickle replacement with better performance  All protocols share the same optimized codebase, allowing improvements in one protocol to benefit others.  ","version":"0.13","tagName":"h2"},{"title":"Documentation‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.13/introduction/overview#documentation","content":" ","version":"0.13","tagName":"h2"},{"title":"User Guides‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.13/introduction/overview#user-guides","content":" Guide\tDescription\tSource\tWebsiteJava Serialization\tComprehensive guide for Java serialization\tjava_serialization_guide.md\tüìñ View Cross-Language Serialization\tMulti-language object exchange\txlang_serialization_guide.md\tüìñ View Row Format\tZero-copy random access format\trow_format_guide.md\tüìñ View Python\tPython-specific features and usage\tpython_guide.md\tüìñ View Rust\tRust implementation and patterns\trust_guide.md\tüìñ View Scala\tScala integration and best practices\tscala_guide.md\tüìñ View GraalVM\tNative image support and AOT compilation\tgraalvm_guide.md\tüìñ View Development\tBuilding and contributing to Fory\tDEVELOPMENT.md\tüìñ View  ","version":"0.13","tagName":"h3"},{"title":"Protocol Specifications‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.13/introduction/overview#protocol-specifications","content":" Specification\tDescription\tSource\tWebsiteXlang Serialization\tCross-language binary protocol\txlang_serialization_spec.md\tüìñ View Java Serialization\tJava-optimized protocol\tjava_serialization_spec.md\tüìñ View Row Format\tRow-based binary format\trow_format_spec.md\tüìñ View Type Mapping\tCross-language type conversion\txlang_type_mapping.md\tüìñ View  ","version":"0.13","tagName":"h3"},{"title":"Compatibility‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.13/introduction/overview#compatibility","content":" ","version":"0.13","tagName":"h2"},{"title":"Schema Compatibility‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.13/introduction/overview#schema-compatibility","content":" Apache Fory‚Ñ¢ supports class schema forward/backward compatibility across Java, Python, Rust, and Golang, enabling seamless schema evolution in production systems without requiring coordinated upgrades across all services. Fory provides two schema compatibility modes:  Schema Consistent Mode (Default): Assumes identical class schemas between serialization and deserialization peers. This mode offers minimal serialization overhead, smallest data size, and fastest performance: ideal for stable schemas or controlled environments. Compatible Mode: Supports independent schema evolution with forward and backward compatibility. This mode enables field addition/deletion, limited type evolution, and graceful handling of schema mismatches. Enable using withCompatibleMode(CompatibleMode.COMPATIBLE) in Java, compatible=True in Python, compatible_mode(true) in Rust, or NewFory(true) in Go.  ","version":"0.13","tagName":"h3"},{"title":"Binary Compatibility‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.13/introduction/overview#binary-compatibility","content":" Current Status: Binary compatibility is not guaranteed between Fory major releases as the protocol continues to evolve. However, compatibility is guaranteed between minor versions (e.g., 0.13.x).  Recommendations:  Version your serialized data by Fory major versionPlan migration strategies when upgrading major versionsSee upgrade guide for details  Future: Binary compatibility will be guaranteed starting from Fory 1.0 release.  ","version":"0.13","tagName":"h3"},{"title":"Security‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.13/introduction/overview#security","content":" ","version":"0.13","tagName":"h2"},{"title":"Overview‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.13/introduction/overview#overview","content":" Serialization security varies by protocol:  Row Format: Secure with predefined schemasObject Graph Serialization (Java/Python native): More flexible but requires careful security configuration  Dynamic serialization can deserialize arbitrary types, which may introduces risks. For example, the deserialization may invoke init constructor or equals/hashCode method, if the method body contains malicious code, the system will be at risk.  Fory enables class registration by default for dynamic protocols, allowing only trusted registered types.Do not disable class registration unless you can ensure your environment is secure.  If this option is disabled, you are responsible for serialization security. You should implement and configure a customized ClassChecker or DeserializationPolicy for fine-grained security control  To report security vulnerabilities in Apache Fory‚Ñ¢, please follow the ASF vulnerability reporting process.  ","version":"0.13","tagName":"h3"},{"title":"Community and Support‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.13/introduction/overview#community-and-support","content":" ","version":"0.13","tagName":"h2"},{"title":"Getting Help‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.13/introduction/overview#getting-help","content":" Slack: Join our Slack workspace for community discussionsTwitter/X: Follow @ApacheFory for updates and announcementsGitHub Issues: Report bugs and request features at apache/foryMailing Lists: Subscribe to Apache Fory mailing lists for development discussions  ","version":"0.13","tagName":"h3"},{"title":"Contributing‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.13/introduction/overview#contributing","content":" We welcome contributions! Please read our Contributing Guide to get started.  Ways to Contribute:  üêõ Report bugs and issuesüí° Propose new featuresüìù Improve documentationüîß Submit pull requestsüß™ Add test casesüìä Share benchmarks  See Development Guide for build instructions and development workflow. ","version":"0.13","tagName":"h3"},{"title":"Features","type":0,"sectionRef":"#","url":"/docs/0.13/introduction/features","content":"","keywords":"","version":"0.13"},{"title":"Core Capabilities‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#core-capabilities","content":" ","version":"0.13","tagName":"h2"},{"title":"üöÄ High-Performance Serialization‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#-high-performance-serialization","content":" Apache Fory‚Ñ¢ delivers exceptional performance through advanced optimization techniques:  JIT Compilation: Runtime code generation for Java eliminates virtual method calls and inlines hot pathsStatic Code Generation: Compile-time code generation for Rust, C++, and Go delivers peak performance without runtime overheadZero-Copy Operations: Direct memory access without intermediate buffer copies; row format enables random access and partial serializationIntelligent Encoding: Variable-length compression for integers and strings; SIMD acceleration for arrays (Java 16+)Meta Sharing: Class metadata packing reduces redundant type information across serializations  ","version":"0.13","tagName":"h3"},{"title":"üåç Cross-Language Serialization‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#-cross-language-serialization","content":" The xlang serialization format enables seamless data exchange across programming languages:  Automatic Type Mapping: Intelligent conversion between language-specific types (type mapping)Reference Preservation: Shared and circular references work correctly across languagesPolymorphism: Objects serialize/deserialize with their actual runtime typesSchema Evolution: Optional forward/backward compatibility for evolving schemasAutomatic Serialization: No IDL or schema definitions required; serialize any object directly without code generation  ","version":"0.13","tagName":"h3"},{"title":"üìä Row Format‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#-row-format","content":" A cache-friendly row format optimized for analytics workloads:  Zero-Copy Random Access: Read individual fields without deserializing entire objectsPartial Operations: Selective field serialization and deserialization for efficiencyApache Arrow Integration: Seamless conversion to columnar format for analytics pipelinesMulti-Language: Available in Java, Python, Rust and C++  ","version":"0.13","tagName":"h3"},{"title":"üîí Security & Production-Readiness‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#-security--production-readiness","content":" Enterprise-grade security and compatibility:  Class Registration: Whitelist-based deserialization control (enabled by default)Depth Limiting: Protection against recursive object graph attacksConfigurable Policies: Custom class checkers and deserialization policiesPlatform Support: Java 8-24, GraalVM native image, multiple OS platforms  ","version":"0.13","tagName":"h3"},{"title":"Java Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#java-features","content":" ","version":"0.13","tagName":"h2"},{"title":"üöÄ High Performance‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#-high-performance","content":" JIT Code Generation: Highly-extensible JIT framework generates serializer code at runtime using async multi-threaded compilation, delivering 20-170x speedup through: Inlining variables to reduce memory accessInlining method calls to eliminate virtual dispatch overheadMinimizing conditional branchingEliminating hash lookups Zero-Copy: Direct memory access without intermediate buffer copies; row format supports random access and partial serializationVariable-Length Encoding: Optimized compression for integers, longsMeta Sharing: Cached class metadata reduces redundant type informationSIMD Acceleration: Java Vector API support for array operations (Java 16+)  ","version":"0.13","tagName":"h3"},{"title":"üîß Drop-in Replacement‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#-drop-in-replacement","content":" 100% JDK Serialization Compatible: Supports writeObject/readObject/writeReplace/readResolve/readObjectNoData/ExternalizableJava 8-24 Support: Works across all modern Java versions including Java 17+ recordsGraalVM Native Image: AOT compilation support without reflection configuration  ","version":"0.13","tagName":"h3"},{"title":"üîÑ Advanced Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#-advanced-features","content":" Reference Tracking: Automatic handling of shared and circular referencesSchema Evolution: Forward/backward compatibility for class schema changesPolymorphism: Full support for inheritance hierarchies and interfacesDeep Copy: Efficient deep cloning of complex object graphs with reference preservationSecurity: Class registration and configurable deserialization policies  ","version":"0.13","tagName":"h3"},{"title":"Python Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#python-features","content":" ","version":"0.13","tagName":"h2"},{"title":"üîß Flexible Serialization Modes‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#-flexible-serialization-modes","content":" Python native Mode: Full Python compatibility, drop-in replacement for pickle/cloudpickleCross-Language Mode: Optimized for multi-language data exchangeRow Format: Zero-copy row format for analytics workloads  ","version":"0.13","tagName":"h3"},{"title":"üéØ Versatile Serialization Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#-versatile-serialization-features","content":" Shared/circular reference support for complex object graphs in both Python-native and cross-language modesPolymorphism support for customized types with automatic type dispatchingSchema evolution support for backward/forward compatibility when using dataclasses in cross-language modeOut-of-band buffer support for zero-copy serialization of large data structures like NumPy arrays and Pandas DataFrames, compatible with pickle protocol 5  ","version":"0.13","tagName":"h3"},{"title":"‚ö° Blazing Fast Performance‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#-blazing-fast-performance","content":" Extremely fast performance compared to other serialization frameworksRuntime code generation and Cython-accelerated core implementation for optimal performance  ","version":"0.13","tagName":"h3"},{"title":"üì¶ Compact Data Size‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#-compact-data-size","content":" Compact object graph protocol with minimal space overhead‚Äîup to 3√ó size reduction compared to pickle/cloudpickleMeta packing and sharing to minimize type forward/backward compatibility space overhead  ","version":"0.13","tagName":"h3"},{"title":"üõ°Ô∏è Security & Safety‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#Ô∏è-security--safety","content":" Strict mode prevents deserialization of untrusted types by type registration and checks.Reference tracking for handling circular references safely  ","version":"0.13","tagName":"h3"},{"title":"Rust Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#rust-features","content":" ","version":"0.13","tagName":"h2"},{"title":"üöÄ Why Apache Fory‚Ñ¢ Rust?‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#-why-apache-fory-rust","content":" üî• Blazingly Fast: Zero-copy deserialization and optimized binary protocolsüåç Cross-Language: Seamlessly serialize/deserialize data across Java, Python, C++, Go, JavaScript, and RustüéØ Type-Safe: Compile-time type checking with derive macrosüîÑ Circular References: Automatic tracking of shared and circular references with Rc/Arc and weak pointersüß¨ Polymorphic: Serialize trait objects with Box&lt;dyn Trait&gt;, Rc&lt;dyn Trait&gt;, and Arc&lt;dyn Trait&gt;üì¶ Schema Evolution: Compatible mode for independent schema changes‚ö° Two Modes: Object graph serialization and zero-copy row-based format  ","version":"0.13","tagName":"h3"},{"title":"Object Graph Serialization‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#object-graph-serialization","content":" Automatic serialization of complex object graphs, preserving the structure and relationships between objects. The #[derive(ForyObject)] macro generates efficient serialization code at compile time, eliminating runtime overhead:  Nested struct serialization with arbitrary depthCollection types (Vec, HashMap, HashSet, BTreeMap)Enum type supportOptional fields with Option&lt;T&gt;Automatic handling of primitive types and stringsEfficient binary encoding with variable-length integers  ","version":"0.13","tagName":"h3"},{"title":"Shared and Circular References‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#shared-and-circular-references","content":" Automatically tracks and preserves reference identity for shared objects using Rc&lt;T&gt; and Arc&lt;T&gt;. When the same object is referenced multiple times, Fory serializes it only once and uses reference IDs for subsequent occurrences. This ensures:  Space efficiency: No data duplication in serialized outputReference identity preservation: Deserialized objects maintain the same sharing relationshipsCircular reference support: Use RcWeak&lt;T&gt; and ArcWeak&lt;T&gt; to break cycles  ","version":"0.13","tagName":"h3"},{"title":"Trait Object Serialization‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#trait-object-serialization","content":" Polymorphic serialization through trait objects, enabling dynamic dispatch and type flexibility. This is essential for plugin systems, heterogeneous collections, and extensible architectures. Supported trait object types:  Box&lt;dyn Trait&gt; - Owned trait objectsRc&lt;dyn Trait&gt; - Reference-counted trait objectsArc&lt;dyn Trait&gt; - Thread-safe reference-counted trait objectsVec&lt;Box&lt;dyn Trait&gt;&gt;, HashMap&lt;K, Box&lt;dyn Trait&gt;&gt; - Collections of trait objects  ","version":"0.13","tagName":"h3"},{"title":"Schema Evolution‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#schema-evolution","content":" Schema evolution in Compatible mode, allowing serialization and deserialization peers to have different type definitions. This enables independent evolution of services in distributed systems without breaking compatibility:  Add new fields with default valuesRemove obsolete fields (skipped during deserialization)Change field nullability (T ‚Üî Option&lt;T&gt;)Reorder fields (matched by name, not position)Type-safe fallback to default values for missing fields  ","version":"0.13","tagName":"h3"},{"title":"Custom Serializers‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#custom-serializers","content":" For types that don't support #[derive(ForyObject)], implement the Serializer trait manually. This is useful for:  External types from other cratesTypes with special serialization requirementsLegacy data format compatibilityPerformance-critical custom encoding  ","version":"0.13","tagName":"h3"},{"title":"Row-Based Serialization‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#row-based-serialization","content":" High-performance row format for zero-copy deserialization. Unlike traditional object serialization that reconstructs entire objects in memory, row format enables random access to fields directly from binary data without full deserialization.  Zero-copy access: Read fields without allocating or copying dataPartial deserialization: Access only the fields you needMemory-mapped files: Work with data larger than RAMCache-friendly: Sequential memory layout for better CPU cache utilizationLazy evaluation: Defer expensive operations until field access  ","version":"0.13","tagName":"h3"},{"title":"Scala Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#scala-features","content":" ","version":"0.13","tagName":"h2"},{"title":"Supported Types‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#supported-types","content":" Apache Fory‚Ñ¢ supports all scala object serialization:  case class serialization supportedpojo/bean class serialization supportedobject singleton serialization supportedcollection serialization supportedother types such as tuple/either and basic types are all supported too.  Scala 2 and 3 are both supported.  ","version":"0.13","tagName":"h3"},{"title":"Scala Class Default Values Support‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#scala-class-default-values-support","content":" Fory supports Scala class default values during deserialization when using compatible mode. This feature enables forward/backward compatibility when case classes or regular Scala classes have default parameters.  When a Scala class has default parameters, the Scala compiler generates methods in the companion object (for case classes) or in the class itself (for regular Scala classes) like apply$default$1, apply$default$2, etc. that return the default values. Fory can detect these methods and use them when deserializing objects where certain fields are missing from the serialized data.  ","version":"0.13","tagName":"h3"},{"title":"Kotlin Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#kotlin-features","content":" ","version":"0.13","tagName":"h2"},{"title":"Supported Types‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#supported-types-1","content":" primitives: Byte, Boolean, Int, Short, Long, Char, Float, Double, UByte, UShort, UInt, ULong.Byte, Boolean, Int, Short, Long, Char, Float, Double works out of the box with the default fory java implementation.stdlib collection: ArrayDeque, ArrayList, HashMap,HashSet, LinkedHashSet, LinkedHashMap.ArrayList, HashMap,HashSet, LinkedHashSet, LinkedHashMap works out of the box with the default fory java implementation.String works out of the box with the default fory java implementation.arrays: Array, BooleanArray, ByteArray, CharArray, DoubleArray, FloatArray, IntArray, LongArray, ShortArrayall standard array types work out of the box with the default fory java implementation.unsigned arrays: UByteArray, UShortArray, UIntArray, ULongArrayfrom stdlib: Pair, Triple, Resultkotlin.random: Randomkotlin.ranges: CharRange, CharProgression, IntRange, IntProgression, LongRange, LongProgression, UintRange, UintProgression, ULongRange, ULongProgressionkotlin.text: Regexkotlin.time: Durationkotlin.uuid: Uuid  Additional support is added for the following classes in kotlin:  Unsigned primitives: UByte, UShort, UInt, ULongUnsigned array types: UByteArray, UShortArray, UIntArray, ULongArrayEmpty collections: emptyList, emptyMap, emptySetCollections: ArrayDequekotlin.time: Durationkotlin.uuid: Uuid  ","version":"0.13","tagName":"h3"},{"title":"Data Class Default Value Support‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.13/introduction/features#data-class-default-value-support","content":" Apache Fory‚Ñ¢ Kotlin provides support for Kotlin data class default values during serialization and deserialization. This feature allows for backward and forward compatibility when data class schemas evolve.  When a Kotlin data class has parameters with default values, Apache Fory‚Ñ¢ can:  Detect default values using Kotlin reflectionApply default values during deserialization when fields are missing from serialized dataSupport schema evolution by allowing new fields with defaults to be added without breaking existing serialized data ","version":"0.13","tagName":"h3"},{"title":"Row Format","type":0,"sectionRef":"#","url":"/docs/0.13/specification/row_format_spec","content":"","keywords":"","version":"0.13"},{"title":"Row Format‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.13/specification/row_format_spec#row-format","content":" Coming soon ","version":"0.13","tagName":"h2"},{"title":"Java Serialization Format","type":0,"sectionRef":"#","url":"/docs/0.13/specification/java_serialization_spec","content":"","keywords":"","version":"0.13"},{"title":"Spec overview‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.13/specification/java_serialization_spec#spec-overview","content":" Apache Fory‚Ñ¢ Java Serialization is an automatic object serialization framework that supports reference and polymorphism. Apache Fory‚Ñ¢ will convert an object from/to fory java serialization binary format. Apache Fory‚Ñ¢ has two core concepts for java serialization:  Apache Fory‚Ñ¢ Java Binary formatFramework to convert object to/from Apache Fory‚Ñ¢ Java Binary format  The serialization format is a dynamic binary format. The dynamics and reference/polymorphism support make Apache Fory‚Ñ¢ flexible, much more easy to use, but also introduce more complexities compared to static serialization frameworks. So the format will be more complex.  Here is the overall format:  | fory header | object ref meta | object class meta | object value data |   The data are serialized using little endian byte order overall. If bytes swap is costly for some object, Fory will write the byte order for that object into the data instead of converting it to little endian.  ","version":"0.13","tagName":"h2"},{"title":"Fory header‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.13/specification/java_serialization_spec#fory-header","content":" Fory header consists starts one byte:  | 4 bits | 1 bit | 1 bit | 1 bit | 1 bit | optional 4 bytes | +---------------+-------+-------+--------+-------+------------------------------------+ | reserved bits | oob | xlang | endian | null | unsigned int for meta start offset |   null flag: 1 when object is null, 0 otherwise. If an object is null, other bits won't be set.endian flag: 1 when data is encoded by little endian, 0 for big endian.xlang flag: 1 when serialization uses xlang format, 0 when serialization uses Fory java format.oob flag: 1 when passed BufferCallback is not null, 0 otherwise.  If meta share mode is enabled, an uncompressed unsigned int is appended to indicate the start offset of metadata.  ","version":"0.13","tagName":"h2"},{"title":"Reference Meta‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.13/specification/java_serialization_spec#reference-meta","content":" Reference tracking handles whether the object is null, and whether to track reference for the object by writing corresponding flags and maintaining internal state.  Reference flags:  Flag\tByte Value\tDescriptionNULL FLAG\t-3\tThis flag indicates the object is a null value. We don't use another byte to indicate REF, so that we can save one byte. REF FLAG\t-2\tThis flag indicates the object is already serialized previously, and fory will write a ref id with unsigned varint format instead of serialize it again NOT_NULL VALUE FLAG\t-1\tThis flag indicates the object is a non-null value and fory doesn't track ref for this type of object. REF VALUE FLAG\t0\tThis flag indicates the object is referencable and the first time to serialize.  When reference tracking is disabled globally or for specific types, or for certain types within a particular context(e.g., a field of a class), only the NULL and NOT_NULL VALUE flags will be used for reference meta.  ","version":"0.13","tagName":"h2"},{"title":"Class Meta‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.13/specification/java_serialization_spec#class-meta","content":" Fory supports to register class by an optional id, the registration can be used for security check and class identification. If a class is registered, it will have a user-provided or an auto-growing unsigned int i.e. class_id.  Depending on whether meta share mode and registration is enabled for current class, Fory will write class meta differently.  ","version":"0.13","tagName":"h2"},{"title":"Schema consistent‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.13/specification/java_serialization_spec#schema-consistent","content":" If schema consistent mode is enabled globally or enabled for current class, class meta will be written as follows:  If class is registered, it will be written as a fory unsigned varint: class_id &lt;&lt; 1.If class is not registered: If class is not an array, fory will write one byte 0bxxxxxxx1 first, then write class name. The first little bit is 1, which is different from first bit 0 of encoded class id. Fory can use this information to determine whether to read class by class id for deserialization. If class is not registered and class is an array, fory will write one byte dimensions &lt;&lt; 1 | 1 first, then write component class subsequently. This can reduce array class name cost if component class is or will be serialized.Class will be written as two enumerated fory unsigned by default: package name and class name. If meta share mode is enabled, class will be written as an unsigned varint which points to index in MetaContext.  ","version":"0.13","tagName":"h3"},{"title":"Schema evolution‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.13/specification/java_serialization_spec#schema-evolution","content":" If schema evolution mode is enabled globally or enabled for current class, class meta will be written as follows:  If meta share mode is not enabled, class meta will be written as schema consistent mode. Additionally, field meta such as field type and name will be written with the field value using a key-value like layout.If meta share mode is enabled, class meta will be written as a meta-share encoded binary if class hasn't been written before, otherwise an unsigned varint id which references to previous written class meta will be written.  ","version":"0.13","tagName":"h3"},{"title":"Meta share‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.13/specification/java_serialization_spec#meta-share","content":" This mode will forbid streaming writing since it needs to look back for update the start offset after the whole object graph writing and meta collecting is finished. Only in this way we can ensure deserialization failure doesn't lost shared meta. Meta streamline will be supported in the future for enclosed meta sharing which doesn't cross multiple serializations of different objects.  For Schema consistent mode, class will be encoded as an enumerated string by full class name. Here we mainly describe the meta layout for schema evolution mode:  | 8 bytes global meta header | 1~2 bytes | variable bytes | variable bytes | variable bytes | +-------------------------------+-------------|--------------------+-------------------+----------------+ | 50 bits hash + 14 bits header | type header | current class meta | parent class meta | ... |   Class meta are encoded from parent class to leaf class, only class with serializable fields will be encoded.  ","version":"0.13","tagName":"h2"},{"title":"Global meta header‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.13/specification/java_serialization_spec#global-meta-header","content":" Meta header is a 64 bits number value encoded in little endian order.  lower 12 bits are used to encode meta size. If meta size &gt;= 0b1111_1111_1111, then writemeta_ size - 0b1111_1111_1111 next.13rd bit is used to indicate whether to write fields meta. When this class is schema-consistent or use registered serializer, fields meta will be skipped. Class Meta will be used for share namespace + type name only.14rd bit is used to indicate whether meta is compressed.Other 50 bits is used to store the unique hash of flags + all layers class meta.  ","version":"0.13","tagName":"h3"},{"title":"Type header‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.13/specification/java_serialization_spec#type-header","content":" Lowest 4 digits 0b0000~0b1110 are used to record num classes. 0b1111 is preserved to indicate that Fory need to read more bytes for length using Fory unsigned int encoding. If current class doesn't has parent class, or parent class doesn't have fields to serialize, or we're in a context which serialize fields of current class only(ObjectStreamSerializer#SlotInfo is an example), num classes will be 1.Other 4 bits are preserved to future extensions.If num classes are greater than or equal to 0b1111, write num_classes - 0b1111 as varuint next.  ","version":"0.13","tagName":"h3"},{"title":"Single layer class meta‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.13/specification/java_serialization_spec#single-layer-class-meta","content":" | unsigned varint | meta string | meta string | field info: variable bytes | variable bytes | ... | +----------------------------+-----------------------+---------------------+-------------------------------+-----------------+-----+ | num fields + register flag | header + package name | header + class name | header + type id + field name | next field info | ... |   num fields: encode num fields &lt;&lt; 1 | register flag(1 when class registered) as unsigned varint. If class is registered, then an unsigned varint class id will be written next, package and class name will be omitted.If current class is schema consistent, then num field will be 0 to flag it.If current class isn't schema consistent, then num field will be the number of compatible fields. For example, users can use tag id to mark some field as compatible field in schema consistent context. In such cases, schema consistent fields will be serialized first, then compatible fields will be serialized next. At deserialization, Fory will use fields info of those fields which aren't annotated by tag id for deserializing schema consistent fields, then use fields info in meta for deserializing compatible fields. Package name encoding(omitted when class is registered): encoding algorithm: UTF8/ALL_TO_LOWER_SPECIAL/LOWER_UPPER_DIGIT_SPECIALHeader: 6 bits size | 2 bits encoding flags. The 6 bits size: 0~63 will be used to indicate size 0~63, the value 63 the size need more byte to read, the encoding will encode size - 63 as a varint next. Class name encoding(omitted when class is registered): encoding algorithm: UTF8/LOWER_UPPER_DIGIT_SPECIAL/FIRST_TO_LOWER_SPECIAL/ALL_TO_LOWER_SPECIALheader: 6 bits size | 2 bits encoding flags. The 6 bits size: 0~63 will be used to indicate size 0~63, the value 63 the size need more byte to read, the encoding will encode size - 63 as a varint next. Field info: header(8 bits): 3 bits size + 2 bits field name encoding + polymorphism flag + nullability flag + ref tracking flag. Users can use annotation to provide those info. 2 bits field name encoding: encoding: UTF8/ALL_TO_LOWER_SPECIAL/LOWER_UPPER_DIGIT_SPECIAL/TAG_IDIf tag id is used, i.e. field name is written by an unsigned varint tag id. 2 bits encoding will be 11. size of field name: The 3 bits size: 0~7 will be used to indicate length 1~7, the value 6 the size read more bytes, the encoding will encode size - 7 as a varint next.If encoding is TAG_ID, then num_bytes of field name will be used to store tag id. ref tracking: when set to 1, ref tracking will be enabled for this field.nullability: when set to 1, this field can be null.polymorphism: when set to 1, the actual type of field will be the declared field type even the type if not final. type id: For registered type-consistent classes, it will be the registered class id.Otherwise it will be encoded as OBJECT_ID if it isn't final and FINAL_OBJECT_ID if it's final. The meta for such types is written separately instead of inlining here is to reduce meta space cost if object of this type is serialized in current object graph multiple times, and the field value may be null too. Field name: If type id is set, type id will be used instead. Otherwise meta string encoding length and data will be written instead.  Field order are left as implementation details, which is not exposed to specification, the deserialization need to resort fields based on Fory field comparator. In this way, fory can compute statistics for field names or types and using a more compact encoding.  ","version":"0.13","tagName":"h3"},{"title":"Other layers class meta‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.13/specification/java_serialization_spec#other-layers-class-meta","content":" Same encoding algorithm as the previous layer except:  header + package name: Header: If package name has been written before: varint index + sharing flag(set) will be writtenIf package name hasn't been written before: If meta string encoding is LOWER_SPECIAL and the length of encoded string &lt;= 64, then header will be6 bits size + encoding flag(set) + sharing flag(unset).Otherwise, header will be 3 bits unset + 3 bits encoding flags + encoding flag(unset) + sharing flag(unset)  ","version":"0.13","tagName":"h3"},{"title":"Meta String‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.13/specification/java_serialization_spec#meta-string","content":" Meta string is mainly used to encode meta strings such as class name and field names.  ","version":"0.13","tagName":"h2"},{"title":"Encoding Algorithms‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.13/specification/java_serialization_spec#encoding-algorithms","content":" String binary encoding algorithm:  Algorithm\tPattern\tDescriptionLOWER_SPECIAL\ta-z._$|\tevery char is written using 5 bits, a-z: 0b00000~0b11001, ._$|: 0b11010~0b11101, prepend one bit at the start to indicate whether strip last char since last byte may have 7 redundant bits(1 indicates strip last char) LOWER_UPPER_DIGIT_SPECIAL\ta-zA-Z0~9._\tevery char is written using 6 bits, a-z: 0b00000~0b11001, A-Z: 0b11010~0b110011, 0~9: 0b110100~0b111101, ._: 0b111110~0b111111, prepend one bit at the start to indicate whether strip last char since last byte may have 7 redundant bits(1 indicates strip last char) UTF-8\tany chars\tUTF-8 encoding  Encoding flags:  Encoding Flag\tPattern\tEncoding AlgorithmLOWER_SPECIAL\tevery char is in a-z._$|\tLOWER_SPECIAL FIRST_TO_LOWER_SPECIAL\tevery char is in a-z[c1,c2] except first char is upper case\treplace first upper case char to lower case, then use LOWER_SPECIAL ALL_TO_LOWER_SPECIAL\tevery char is in a-zA-Z[c1,c2]\treplace every upper case char by | + lower case, then use LOWER_SPECIAL, use this encoding if it's smaller than Encoding LOWER_UPPER_DIGIT_SPECIAL LOWER_UPPER_DIGIT_SPECIAL\tevery char is in a-zA-Z[c1,c2]\tuse LOWER_UPPER_DIGIT_SPECIAL encoding if it's smaller than Encoding FIRST_TO_LOWER_SPECIAL UTF8\tany utf-8 char\tuse UTF-8 encoding Compression\tany utf-8 char\tlossless compression  Notes:  For package name encoding, c1,c2 should be ._; For field/type name encoding, c1,c2 should be _$;Depending on cases, one can choose encoding flags + data jointly, uses 3 bits of first byte for flags and other bytes for data.  ","version":"0.13","tagName":"h3"},{"title":"Shared meta string‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.13/specification/java_serialization_spec#shared-meta-string","content":" The shared meta string format consists of header and encoded string binary. Header of encoded string binary will be inlined in shared meta header.  Header is written using little endian order, Fory can read this flag first to determine how to deserialize the data.  Write by data‚Äã  If string hasn't been written before, the data will be written as follows:  | unsigned varint: string binary size + 1 bit: not written before | 56 bits: unique hash | 3 bits encoding flags + string binary |   If string binary size is less than 16 bytes, the hash will be omitted to save spaces. Unique hash can be omitted too if caller pass a flag to disable it. In such cases, the format will be:  | unsigned varint: string binary size + 1 bit: not written before | 3 bits encoding flags + string binary |   Write by ref‚Äã  If string has been written before, the data will be written as follows:  | unsigned varint: written string id + 1 bit: written before |   ","version":"0.13","tagName":"h3"},{"title":"Value Format‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.13/specification/java_serialization_spec#value-format","content":" ","version":"0.13","tagName":"h2"},{"title":"Basic types‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.13/specification/java_serialization_spec#basic-types","content":" Bool‚Äã  size: 1 byteformat: 0 for false, 1 for true  Byte‚Äã  size: 1 byteformat: write as pure byte.  Short‚Äã  size: 2 bytebyte order: little endian order  Char‚Äã  size: 2 bytebyte order: little endian order  Unsigned int‚Äã  size: 1~5 byteFormat: The most significant bit (MSB) in every byte indicates whether to have the next byte. If first bit is set i.e. b &amp; 0x80 == 0x80, then the next byte should be read until the first bit of the next byte is unset.  Signed int‚Äã  size: 1~5 byteFormat: First convert the number into positive unsigned int by (v &lt;&lt; 1) ^ (v &gt;&gt; 31) ZigZag algorithm, then encoding it as an unsigned int.  Unsigned long‚Äã  size: 1~9 byteFory PVL(Progressive Variable-length Long) Encoding: positive long format: first bit in every byte indicates whether to have the next byte. If first bit is set i.e. b &amp; 0x80 == 0x80, then the next byte should be read until the first bit is unset.  Signed long‚Äã  size: 1~9 byteFory SLI(Small long as int) Encoding: If long is in [-1073741824, 1073741823], encode as 4 bytes int: | little-endian: ((int) value) &lt;&lt; 1 |Otherwise write as 9 bytes: | 0b1 | little-endian 8 bytes long | Fory PVL(Progressive Variable-length Long) Encoding: First convert the number into positive unsigned long by (v &lt;&lt; 1) ^ (v &gt;&gt; 63) ZigZag algorithm to reduce cost of small negative numbers, then encoding it as an unsigned long.  Float‚Äã  size: 4 byteformat: convert float to 4 bytes int by Float.floatToRawIntBits, then write as binary by little endian order.  Double‚Äã  size: 8 byteformat: convert double to 8 bytes int by Double.doubleToRawLongBits, then write as binary by little endian order.  ","version":"0.13","tagName":"h3"},{"title":"String‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.13/specification/java_serialization_spec#string","content":" Format:  | header: size &lt;&lt; 2 | 2 bits encoding flags | binary data |   size + encoding will be concat as a long and encoded as an unsigned var long. The little 2 bits is used for encoding: 0 for latin, 1 for utf-16, 2 for utf-8.encoded string binary data based on encoding: latin/utf-16/utf-8.  Which encoding to choose:  For JDK8: fory detect latin at runtime, if string is latin string, then use latin encoding, otherwise use utf-16.For JDK9+: fory use coder in String object for encoding, latin/utf-16 will be used for encoding.If the string is encoded by utf-8, then fory will use utf-8 to decode the data. But currently fory doesn't enable utf-8 encoding by default for java. Cross-language string serialization of fory uses utf-8 by default.  ","version":"0.13","tagName":"h3"},{"title":"Collection‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.13/specification/java_serialization_spec#collection","content":" All collection serializers must extend CollectionLikeSerializer.  Format:  length(unsigned varint) | collection header | elements header | elements data   Collection header‚Äã  For ArrayList/LinkedArrayList/HashSet/LinkedHashSet, this will be empty.For TreeSet, this will be ComparatorFor subclass of ArrayList, this may be extra object field info.  Elements header‚Äã  In most cases, all collection elements are same type and not null, elements header will encode those homogeneous information to avoid the cost of writing it for every element. Specifically, there are four kinds of information which will be encoded by elements header, each use one bit:  If track elements ref, use the first bit 0b1 of the header to flag it.If the collection has null, use the second bit 0b10 of the header to flag it. If ref tracking is enabled for this element type, this flag is invalid.If the collection element types are the declared type, use the 3rd bit 0b100 of the header to flag it.If the collection element types are same, use the 4th bit 0b1000 header to flag it.  By default, all bits are unset, which means all elements won't track ref, all elements are same type, not null and the actual element is the declared type in the custom class field.  The implementation can generate different deserialization code based read header, and look up the generated code from a linear map/list.  Elements data‚Äã  Based on the elements header, the serialization of elements data may skip ref flag/null flag/element class info.  CollectionSerializer#write/read can be taken as an example.  ","version":"0.13","tagName":"h3"},{"title":"Array‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.13/specification/java_serialization_spec#array","content":" Primitive array‚Äã  Primitive array are taken as a binary buffer, serialization will just write the length of array size as an unsigned int, then copy the whole buffer into the stream.  Such serialization won't compress the array. If users want to compress primitive array, users need to register custom serializers for such types.  Object array‚Äã  Object array is serialized using the collection format. Object component type will be taken as collection element generic type.  ","version":"0.13","tagName":"h3"},{"title":"Map‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.13/specification/java_serialization_spec#map","content":" All Map serializers must extend MapLikeSerializer.  Format:  | length(unsigned varint) | map header | key value pairs data |   Map header‚Äã  For HashMap/LinkedHashMap, this will be empty.For TreeMap, this will be ComparatorFor other Map, this may be extra object field info.  Map Key-Value data‚Äã  Map iteration is too expensive, Fory won't compute the header like for collection before since it introduceconsiderable overhead. Users can use MapFieldInfo annotation to provide header in advance. Otherwise Fory will use first key-value pair to predict header optimistically, and update the chunk header if the prediction failed at some pair.  Fory will serialize map chunk by chunk, every chunk has 127 pairs at most.  | 1 byte | 1 byte | variable bytes | +----------------+----------------+-----------------+ | KV header | chunk size: N | N*2 objects |   KV header:  If track key ref, use the first bit 0b1 of the header to flag it.If the key has null, use the second bit 0b10 of the header to flag it. If ref tracking is enabled for this key type, this flag is invalid.If the actual key type of map is the declared key type, use the 3rd bit 0b100 of the header to flag it.If track value ref, use the 4th bit 0b1000 of the header to flag it.If the value has null, use the 5th bit 0b10000 of the header to flag it. If ref tracking is enabled for this value type, this flag is invalid.If the value type of map is the declared value type, use the 6rd bit 0b100000 of the header to flag it.If key or value is null, that key and value will be written as a separate chunk, and chunk size writing will be skipped too.  If streaming write is enabled, which means Fory can't update written chunk size. In such cases, map key-value data format will be:  | 1 byte | variable bytes | +----------------+-----------------+ | KV header | N*2 objects |   KV header will be a header marked by MapFieldInfo in java. The implementation can generate different deserialization code based read header, and look up the generated code from a linear map/list.  ","version":"0.13","tagName":"h3"},{"title":"Enum‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.13/specification/java_serialization_spec#enum","content":" Enums are serialized as an unsigned var int. If the order of enum values change, the deserialized enum value may not be the value users expect. In such cases, users must register enum serializer by make it write enum value as an enumerated string with unique hash disabled.  ","version":"0.13","tagName":"h3"},{"title":"Object‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.13/specification/java_serialization_spec#object","content":" Object means object of pojo/struct/bean/record type. Object will be serialized by writing its fields data in fory order.  Depending on schema compatibility, objects will have different formats.  Field order‚Äã  Field will be ordered as following, every group of fields will have its own order:  primitive fields: larger size type first, smaller later, variable size type last.boxed primitive fields: same order as primitive fieldsfinal fields: same type together, then sorted by field name lexicographically.collection fields: same order as final fieldsmap fields: same order as final fieldsother fields: same order as final fields  Schema consistent‚Äã  Object fields will be serialized one by one using following format:  Primitive field value: | var bytes | +----------------+ | value data | +----------------+ Boxed field value: | one byte | var bytes | +-----------+---------------+ | null flag | field value | +-----------+---------------+ field value of final type with ref tracking: | var bytes | var objects | +-----------+-------------+ | ref meta | value data | +-----------+-------------+ field value of final type without ref tracking: | one byte | var objects | +-----------+-------------+ | null flag | field value | +-----------+-------------+ field value of non-final type with ref tracking: | one byte | var bytes | var objects | +-----------+-------------+-------------+ | ref meta | class meta | value data | +-----------+-------------+-------------+ field value of non-final type without ref tracking: | one byte | var bytes | var objects | +-----------+------------+------------+ | null flag | class meta | value data | +-----------+------------+------------+   Schema evolution‚Äã  Schema evolution have similar format as schema consistent mode for object except:  For this object type itself, schema consistent mode will write class by id/name, but schema evolution mode will write class field names, types and other meta too, see Class meta.Class meta of final custom type needs to be written too, because peers may not have this class defined.  ","version":"0.13","tagName":"h3"},{"title":"Class‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.13/specification/java_serialization_spec#class","content":" Class will be serialized using class meta format.  ","version":"0.13","tagName":"h3"},{"title":"Implementation guidelines‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.13/specification/java_serialization_spec#implementation-guidelines","content":" Try to merge multiple bytes into an int/long write before writing to reduce memory IO and bound check cost.Read multiple bytes as an int/long, then split into multiple bytes to reduce memory IO and bound check cost.Try to use one varint/long to write flags and length together to save one byte cost and reduce memory io.Condition branches are less expensive compared to memory IO cost unless there are too many branches. ","version":"0.13","tagName":"h2"},{"title":"Xlang Type Mapping","type":0,"sectionRef":"#","url":"/docs/0.13/specification/xlang_type_mapping","content":"","keywords":"","version":"0.13"},{"title":"Type Mapping‚Äã","type":1,"pageTitle":"Xlang Type Mapping","url":"/docs/0.13/specification/xlang_type_mapping#type-mapping","content":" Fory Type\tFory Type ID\tJava\tPython\tJavascript\tC++\tGolang\tRustbool\t1\tbool/Boolean\tbool\tBoolean\tbool\tbool\tbool int8\t2\tbyte/Byte\tint/pyfory.Int8\tType.int8()\tint8_t\tint8\ti8 int16\t3\tshort/Short\tint/pyfory.Int16\tType.int16()\tint16_t\tint16\ti6 int32\t4\tint/Integer\tint/pyfory.Int32\tType.int32()\tint32_t\tint32\ti32 var_int32\t5\tint/Integer\tint/pyfory.VarInt32\tType.varint32()\tfory::varint32_t\tfory.varint32\tfory::varint32 int64\t6\tlong/Long\tint/pyfory.Int64\tType.int64()\tint64_t\tint64\ti64 var_int64\t7\tlong/Long\tint/pyfory.VarInt64\tType.varint64()\tfory::varint64_t\tfory.varint64\tfory::varint64 sli_int64\t8\tlong/Long\tint/pyfory.SliInt64\tType.sliint64()\tfory::sliint64_t\tfory.sliint64\tfory::sliint64 float16\t9\tfloat/Float\tfloat/pyfory.Float16\tType.float16()\tfory::float16_t\tfory.float16\tfory::f16 float32\t10\tfloat/Float\tfloat/pyfory.Float32\tType.float32()\tfloat\tfloat32\tf32 float64\t11\tdouble/Double\tfloat/pyfory.Float64\tType.float64()\tdouble\tfloat64\tf64 string\t12\tString\tstr\tString\tstring\tstring\tString/str enum\t13\tEnum subclasses\tenum subclasses\t/\tenum\t/\tenum named_enum\t14\tEnum subclasses\tenum subclasses\t/\tenum\t/\tenum struct\t15\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct compatible_struct\t16\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct named_struct\t17\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct named_compatible_struct\t18\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct ext\t19\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct named_ext\t20\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct list\t21\tList/Collection\tlist/tuple\tarray\tvector\tslice\tVec set\t22\tSet\tset\t/\tset\tfory.Set\tSet map\t23\tMap\tdict\tMap\tunordered_map\tmap\tHashMap duration\t24\tDuration\ttimedelta\tNumber\tduration\tDuration\tDuration timestamp\t25\tInstant\tdatetime\tNumber\tstd::chrono::nanoseconds\tTime\tDateTime local_date\t26\tDate\tdatetime\tNumber\tstd::chrono::nanoseconds\tTime\tDateTime decimal\t27\tBigDecimal\tDecimal\tbigint\t/\t/\t/ binary\t28\tbyte[]\tbytes\t/\tuint8_t[n]/vector&lt;T&gt;\t[n]uint8/[]T\tVec&lt;uint8_t&gt; array\t29\tarray\tnp.ndarray\t/\t/\tarray/slice\tVec bool_array\t30\tbool[]\tndarray(np.bool_)\t/\tbool[n]\t[n]bool/[]T\tVec&lt;bool&gt; int8_array\t31\tbyte[]\tndarray(int8)\t/\tint8_t[n]/vector&lt;T&gt;\t[n]int8/[]T\tVec&lt;i18&gt; int16_array\t32\tshort[]\tndarray(int16)\t/\tint16_t[n]/vector&lt;T&gt;\t[n]int16/[]T\tVec&lt;i16&gt; int32_array\t33\tint[]\tndarray(int32)\t/\tint32_t[n]/vector&lt;T&gt;\t[n]int32/[]T\tVec&lt;i32&gt; int64_array\t34\tlong[]\tndarray(int64)\t/\tint64_t[n]/vector&lt;T&gt;\t[n]int64/[]T\tVec&lt;i64&gt; float16_array\t35\tfloat[]\tndarray(float16)\t/\tfory::float16_t[n]/vector&lt;T&gt;\t[n]float16/[]T\tVec&lt;fory::f16&gt; float32_array\t36\tfloat[]\tndarray(float32)\t/\tfloat[n]/vector&lt;T&gt;\t[n]float32/[]T\tVec&lt;f32&gt; float64_array\t37\tdouble[]\tndarray(float64)\t/\tdouble[n]/vector&lt;T&gt;\t[n]float64/[]T\tVec&lt;f64&gt; arrow record batch\t38\t/\t/\t/\t/\t/\t/ arrow table\t39\t/\t/\t/\t/\t/\t/  ","version":"0.13","tagName":"h2"},{"title":"Type info(not implemented currently)‚Äã","type":1,"pageTitle":"Xlang Type Mapping","url":"/docs/0.13/specification/xlang_type_mapping#type-infonot-implemented-currently","content":" Due to differences between type systems of languages, those types can't be mapped one-to-one between languages.  If the user notices that one type on a language corresponds to multiple types in Fory type systems, for example, longin java has type int64/varint64/sliint64, it means the language lacks some types, and the user must provide extra type info when using Fory.  ","version":"0.13","tagName":"h2"},{"title":"Type annotation‚Äã","type":1,"pageTitle":"Xlang Type Mapping","url":"/docs/0.13/specification/xlang_type_mapping#type-annotation","content":" If the type is a field of another class, users can provide meta hints for fields of a type, or for the whole type. Such information can be provided in other languages too:  java: use annotation.cpp: use macro and template.golang: use struct tag.python: use typehint.rust: use macro.  Here is en example:  Java: class Foo { @Int32Type(varint = true) int f1; List&lt;@Int32Type(varint = true) Integer&gt; f2; } Python: class Foo: f1: Int32Type(varint=True) f2: List[Int32Type(varint=True)]   ","version":"0.13","tagName":"h2"},{"title":"Type wrapper‚Äã","type":1,"pageTitle":"Xlang Type Mapping","url":"/docs/0.13/specification/xlang_type_mapping#type-wrapper","content":" If the type is not a field of a class, the user must wrap this type with a Fory type to pass the extra type info.  For example, suppose Fory Java provide a VarInt64 type, when a user invoke fory.serialize(long_value), he need to invoke like fory.serialize(new VarInt64(long_value)). ","version":"0.13","tagName":"h2"},{"title":"Xlang Serialization","type":0,"sectionRef":"#","url":"/docs/0.13/guide/xlang_serialization","content":"","keywords":"","version":"0.13"},{"title":"Serialize built-in types‚Äã","type":1,"pageTitle":"Xlang Serialization","url":"/docs/0.13/guide/xlang_serialization#serialize-built-in-types","content":" Common types can be serialized automatically: primitive numeric types, string, binary, array, list, map and so on.  Java  import org.apache.fory.*; import org.apache.fory.config.*; import java.util.*; public class Example1 { public static void main(String[] args) { Fory fory = Fory.builder().withLanguage(Language.XLANG).build(); List&lt;Object&gt; list = ofArrayList(true, false, &quot;str&quot;, -1.1, 1, new int[100], new double[20]); byte[] bytes = fory.serialize(list); // bytes can be data serialized by other languages. fory.deserialize(bytes); Map&lt;Object, Object&gt; map = new HashMap&lt;&gt;(); map.put(&quot;k1&quot;, &quot;v1&quot;); map.put(&quot;k2&quot;, list); map.put(&quot;k3&quot;, -1); bytes = fory.serialize(map); // bytes can be data serialized by other languages. fory.deserialize(bytes); } }   Python  import pyfory import numpy as np fory = pyfory.Fory() object_list = [True, False, &quot;str&quot;, -1.1, 1, np.full(100, 0, dtype=np.int32), np.full(20, 0.0, dtype=np.double)] data = fory.serialize(object_list) # bytes can be data serialized by other languages. new_list = fory.deserialize(data) object_map = {&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: object_list, &quot;k3&quot;: -1} data = fory.serialize(object_map) # bytes can be data serialized by other languages. new_map = fory.deserialize(data) print(new_map)   Golang  package main import forygo &quot;github.com/apache/fory/fory/go/fory&quot; import &quot;fmt&quot; func main() { list := []interface{}{true, false, &quot;str&quot;, -1.1, 1, make([]int32, 10), make([]float64, 20)} fory := forygo.NewFory() bytes, err := fory.Marshal(list) if err != nil { panic(err) } var newValue interface{} // bytes can be data serialized by other languages. if err := fory.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) dict := map[string]interface{}{ &quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: list, &quot;k3&quot;: -1, } bytes, err = fory.Marshal(dict) if err != nil { panic(err) } // bytes can be data serialized by other languages. if err := fory.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) }   JavaScript  import Fory from &quot;@apache-fory/fory&quot;; /** * @apache-fory/hps use v8's fast-calls-api that can be called directly by jit, ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from &quot;@apache-fory/hps&quot;; const fory = new Fory({ hps }); const input = fory.serialize(&quot;hello fory&quot;); const result = fory.deserialize(input); console.log(result);   Rust  use chrono::{NaiveDate, NaiveDateTime}; use fory::{from_buffer, to_buffer, Fory}; use std::collections::HashMap; fn run() { let bin: Vec&lt;u8&gt; = to_buffer(&amp;&quot;hello&quot;.to_string()); let obj: String = from_buffer(&amp;bin).expect(&quot;should success&quot;); assert_eq!(&quot;hello&quot;.to_string(), obj); }   ","version":"0.13","tagName":"h2"},{"title":"Serialize custom types‚Äã","type":1,"pageTitle":"Xlang Serialization","url":"/docs/0.13/guide/xlang_serialization#serialize-custom-types","content":" Serializing user-defined types needs registering the custom type using the register API to establish the mapping relationship between the type in different languages.  Java  import org.apache.fory.*; import org.apache.fory.config.*; import java.util.*; public class Example2 { public static class SomeClass1 { Object f1; Map&lt;Byte, Integer&gt; f2; } public static class SomeClass2 { Object f1; String f2; List&lt;Object&gt; f3; Map&lt;Byte, Integer&gt; f4; Byte f5; Short f6; Integer f7; Long f8; Float f9; Double f10; short[] f11; List&lt;Short&gt; f12; } public static Object createObject() { SomeClass1 obj1 = new SomeClass1(); obj1.f1 = true; obj1.f2 = ofHashMap((byte) -1, 2); SomeClass2 obj = new SomeClass2(); obj.f1 = obj1; obj.f2 = &quot;abc&quot;; obj.f3 = ofArrayList(&quot;abc&quot;, &quot;abc&quot;); obj.f4 = ofHashMap((byte) 1, 2); obj.f5 = Byte.MAX_VALUE; obj.f6 = Short.MAX_VALUE; obj.f7 = Integer.MAX_VALUE; obj.f8 = Long.MAX_VALUE; obj.f9 = 1.0f / 2; obj.f10 = 1 / 3.0; obj.f11 = new short[]{(short) 1, (short) 2}; obj.f12 = ofArrayList((short) -1, (short) 4); return obj; } // mvn exec:java -Dexec.mainClass=&quot;org.apache.fory.examples.Example2&quot; public static void main(String[] args) { Fory fory = Fory.builder().withLanguage(Language.XLANG).build(); fory.register(SomeClass1.class, &quot;example.SomeClass1&quot;); fory.register(SomeClass2.class, &quot;example.SomeClass2&quot;); byte[] bytes = fory.serialize(createObject()); // bytes can be data serialized by other languages. System.out.println(fory.deserialize(bytes)); } }   Python  from dataclasses import dataclass from typing import List, Dict, Any import pyfory, array @dataclass class SomeClass1: f1: Any f2: Dict[pyfory.Int8Type, pyfory.Int32Type] @dataclass class SomeClass2: f1: Any = None f2: str = None f3: List[str] = None f4: Dict[pyfory.Int8Type, pyfory.Int32Type] = None f5: pyfory.Int8Type = None f6: pyfory.Int16Type = None f7: pyfory.Int32Type = None # int type will be taken as `pyfory.Int64Type`. # use `pyfory.Int32Type` for type hint if peer # are more narrow type. f8: int = None f9: pyfory.Float32Type = None # float type will be taken as `pyfory.Float64Type` f10: float = None f11: pyfory.Int16ArrayType = None f12: List[pyfory.Int16Type] = None if __name__ == &quot;__main__&quot;: f = pyfory.Fory() f.register_type(SomeClass1, typename=&quot;example.SomeClass1&quot;) f.register_type(SomeClass2, typename=&quot;example.SomeClass2&quot;) obj1 = SomeClass1(f1=True, f2={-1: 2}) obj = SomeClass2( f1=obj1, f2=&quot;abc&quot;, f3=[&quot;abc&quot;, &quot;abc&quot;], f4={1: 2}, f5=2 ** 7 - 1, f6=2 ** 15 - 1, f7=2 ** 31 - 1, f8=2 ** 63 - 1, f9=1.0 / 2, f10=1 / 3.0, f11=array.array(&quot;h&quot;, [1, 2]), f12=[-1, 4], ) data = f.serialize(obj) # bytes can be data serialized by other languages. print(f.deserialize(data))   Golang  package main import forygo &quot;github.com/apache/fory/fory/go/fory&quot; import &quot;fmt&quot; func main() { type SomeClass1 struct { F1 interface{} F2 string F3 []interface{} F4 map[int8]int32 F5 int8 F6 int16 F7 int32 F8 int64 F9 float32 F10 float64 F11 []int16 F12 fory.Int16Slice } type SomeClas2 struct { F1 interface{} F2 map[int8]int32 } fory := forygo.NewFory() if err := fory.RegisterNamedType(SomeClass1{}, &quot;example.SomeClass1&quot;); err != nil { panic(err) } if err := fory.RegisterNamedType(SomeClass2{}, &quot;example.SomeClass2&quot;); err != nil { panic(err) } obj1 := &amp;SomeClass1{} obj1.F1 = true obj1.F2 = map[int8]int32{-1: 2} obj := &amp;SomeClass1{} obj.F1 = obj1 obj.F2 = &quot;abc&quot; obj.F3 = []interface{}{&quot;abc&quot;, &quot;abc&quot;} f4 := map[int8]int32{1: 2} obj.F4 = f4 obj.F5 = fory.MaxInt8 obj.F6 = fory.MaxInt16 obj.F7 = fory.MaxInt32 obj.F8 = fory.MaxInt64 obj.F9 = 1.0 / 2 obj.F10 = 1 / 3.0 obj.F11 = []int16{1, 2} obj.F12 = []int16{-1, 4} bytes, err := fory.Marshal(obj); if err != nil { panic(err) } var newValue interface{} // bytes can be data serialized by other languages. if err := fory.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) }   JavaScript  import Fory, { Type, InternalSerializerType } from &quot;@apache-fory/fory&quot;; /** * @apache-fory/hps use v8's fast-calls-api that can be called directly by jit, ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from &quot;@apache-fory/hps&quot;; // Now we describe data structures using JSON, but in the future, we will use more ways. const description = Type.object(&quot;example.foo&quot;, { foo: Type.string(), }); const fory = new Fory({ hps }); const { serialize, deserialize } = fory.registerSerializer(description); const input = serialize({ foo: &quot;hello fory&quot; }); const result = deserialize(input); console.log(result);   Rust  use chrono::{NaiveDate, NaiveDateTime}; use fory::{from_buffer, to_buffer, Fory}; use std::collections::HashMap; #[test] fn complex_struct() { #[derive(Fory, Debug, PartialEq)] #[tag(&quot;example.foo2&quot;)] struct Animal { category: String, } #[derive(Fory, Debug, PartialEq)] #[tag(&quot;example.foo&quot;)] struct Person { c1: Vec&lt;u8&gt;, // binary c2: Vec&lt;i16&gt;, // primitive array animal: Vec&lt;Animal&gt;, c3: Vec&lt;Vec&lt;u8&gt;&gt;, name: String, c4: HashMap&lt;String, String&gt;, age: u16, op: Option&lt;String&gt;, op2: Option&lt;String&gt;, date: NaiveDate, time: NaiveDateTime, c5: f32, c6: f64, } let person: Person = Person { c1: vec![1, 2, 3], c2: vec![5, 6, 7], c3: vec![vec![1, 2], vec![1, 3]], animal: vec![Animal { category: &quot;Dog&quot;.to_string(), }], c4: HashMap::from([ (&quot;hello1&quot;.to_string(), &quot;hello2&quot;.to_string()), (&quot;hello2&quot;.to_string(), &quot;hello3&quot;.to_string()), ]), age: 12, name: &quot;helo&quot;.to_string(), op: Some(&quot;option&quot;.to_string()), op2: None, date: NaiveDate::from_ymd_opt(2025, 12, 12).unwrap(), time: NaiveDateTime::from_timestamp_opt(1689912359, 0).unwrap(), c5: 2.0, c6: 4.0, }; let bin: Vec&lt;u8&gt; = to_buffer(&amp;person); let obj: Person = from_buffer(&amp;bin).expect(&quot;should success&quot;); assert_eq!(person, obj); }   ","version":"0.13","tagName":"h2"},{"title":"Serialize Shared Reference and Circular Reference‚Äã","type":1,"pageTitle":"Xlang Serialization","url":"/docs/0.13/guide/xlang_serialization#serialize-shared-reference-and-circular-reference","content":" Shared reference and circular reference can be serialized automatically, no duplicate data or recursion error.  Java  import org.apache.fory.*; import org.apache.fory.config.*; import java.util.*; public class ReferenceExample { public static class SomeClass { SomeClass f1; Map&lt;String, String&gt; f2; Map&lt;String, String&gt; f3; } public static Object createObject() { SomeClass obj = new SomeClass(); obj.f1 = obj; obj.f2 = ofHashMap(&quot;k1&quot;, &quot;v1&quot;, &quot;k2&quot;, &quot;v2&quot;); obj.f3 = obj.f2; return obj; } // mvn exec:java -Dexec.mainClass=&quot;org.apache.fory.examples.ReferenceExample&quot; public static void main(String[] args) { Fory fory = Fory.builder().withLanguage(Language.XLANG) .withRefTracking(true).build(); fory.register(SomeClass.class, &quot;example.SomeClass&quot;); byte[] bytes = fory.serialize(createObject()); // bytes can be data serialized by other languages. System.out.println(fory.deserialize(bytes)); } }   Python  from typing import Dict import pyfory class SomeClass: f1: &quot;SomeClass&quot; f2: Dict[str, str] f3: Dict[str, str] fory = pyfory.Fory(ref_tracking=True) fory.register_type(SomeClass, typename=&quot;example.SomeClass&quot;) obj = SomeClass() obj.f2 = {&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: &quot;v2&quot;} obj.f1, obj.f3 = obj, obj.f2 data = fory.serialize(obj) # bytes can be data serialized by other languages. print(fory.deserialize(data))   Golang  package main import forygo &quot;github.com/apache/fory/fory/go/fory&quot; import &quot;fmt&quot; func main() { type SomeClass struct { F1 *SomeClass F2 map[string]string F3 map[string]string } fory := forygo.NewFory(true) if err := fory.Register(SomeClass{}, 65); err != nil { panic(err) } value := &amp;SomeClass{F2: map[string]string{&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: &quot;v2&quot;}} value.F3 = value.F2 value.F1 = value bytes, err := fory.Marshal(value) if err != nil { } var newValue interface{} // bytes can be data serialized by other languages. if err := fory.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) }   JavaScript  import Fory, { Type } from '@apache-fory/fory'; /** * @apache-fory/hps use v8's fast-calls-api that can be called directly by jit, ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from '@apache-fory/hps'; const description = Type.object('example.foo', { foo: Type.string(), bar: Type.object('example.foo'), }); const fory = new Fory({ hps }); const { serialize, deserialize } = fory.registerSerializer(description); const data: any = { foo: 'hello fory', }; data.bar = data; const input = serialize(data); const result = deserialize(input); console.log(result.bar.foo === result.foo);   JavaScriptReference cannot be implemented because of rust ownership restrictions  ","version":"0.13","tagName":"h2"},{"title":"Zero-Copy Serialization‚Äã","type":1,"pageTitle":"Xlang Serialization","url":"/docs/0.13/guide/xlang_serialization#zero-copy-serialization","content":" Java  import org.apache.fory.*; import org.apache.fory.config.*; import org.apache.fory.serializer.BufferObject; import org.apache.fory.memory.MemoryBuffer; import java.util.*; import java.util.stream.Collectors; public class ZeroCopyExample { // mvn exec:java -Dexec.mainClass=&quot;io.ray.fory.examples.ZeroCopyExample&quot; public static void main(String[] args) { Fory fory = Fory.builder().withLanguage(Language.XLANG).build(); List&lt;Object&gt; list = ofArrayList(&quot;str&quot;, new byte[1000], new int[100], new double[100]); Collection&lt;BufferObject&gt; bufferObjects = new ArrayList&lt;&gt;(); byte[] bytes = fory.serialize(list, e -&gt; !bufferObjects.add(e)); // bytes can be data serialized by other languages. List&lt;MemoryBuffer&gt; buffers = bufferObjects.stream() .map(BufferObject::toBuffer).collect(Collectors.toList()); System.out.println(fory.deserialize(bytes, buffers)); } }   Python  import array import pyfory import numpy as np fory = pyfory.Fory() list_ = [&quot;str&quot;, bytes(bytearray(1000)), array.array(&quot;i&quot;, range(100)), np.full(100, 0.0, dtype=np.double)] serialized_objects = [] data = fory.serialize(list_, buffer_callback=serialized_objects.append) buffers = [o.to_buffer() for o in serialized_objects] # bytes can be data serialized by other languages. print(fory.deserialize(data, buffers=buffers))   Golang  package main import forygo &quot;github.com/apache/fory/fory/go/fory&quot; import &quot;fmt&quot; func main() { fory := forygo.NewFory() list := []interface{}{&quot;str&quot;, make([]byte, 1000)} buf := fory.NewByteBuffer(nil) var bufferObjects []fory.BufferObject fory.Serialize(buf, list, func(o fory.BufferObject) bool { bufferObjects = append(bufferObjects, o) return false }) var newList []interface{} var buffers []*fory.ByteBuffer for _, o := range bufferObjects { buffers = append(buffers, o.ToBuffer()) } if err := fory.Deserialize(buf, &amp;newList, buffers); err != nil { panic(err) } fmt.Println(newList) }   JavaScript  // Coming soon  ","version":"0.13","tagName":"h2"},{"title":"Install","type":0,"sectionRef":"#","url":"/docs/0.13/start/install","content":"","keywords":"","version":"0.13"},{"title":"Java‚Äã","type":1,"pageTitle":"Install","url":"/docs/0.13/start/install#java","content":" To add a dependency on Apache Fory‚Ñ¢ using Maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-core&lt;/artifactId&gt; &lt;version&gt;0.13.2&lt;/version&gt; &lt;/dependency&gt; &lt;!-- Optional row format support --&gt; &lt;!-- &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-format&lt;/artifactId&gt; &lt;version&gt;0.13.1&lt;/version&gt; &lt;/dependency&gt; --&gt; &lt;!-- SIMD acceleration for array compression (Java 16+) --&gt; &lt;!-- &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-simd&lt;/artifactId&gt; &lt;version&gt;0.13.1&lt;/version&gt; &lt;/dependency&gt; --&gt;   ","version":"0.13","tagName":"h2"},{"title":"Scala‚Äã","type":1,"pageTitle":"Install","url":"/docs/0.13/start/install#scala","content":" To add a dependency on Apache Fory‚Ñ¢ scala for scala 2.13 with maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-scala_2.13&lt;/artifactId&gt; &lt;version&gt;0.13.2&lt;/version&gt; &lt;/dependency&gt;   To add a dependency on Apache Fory‚Ñ¢ scala for scala 3 with maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-scala_3&lt;/artifactId&gt; &lt;version&gt;0.13.2&lt;/version&gt; &lt;/dependency&gt;   To add a dependency on Apache Fory‚Ñ¢ scala for scala 2.13 with sbt, use the following:  libraryDependencies += &quot;org.apache.fory&quot; % &quot;fory-scala_2.13&quot; % &quot;0.13.2&quot;   To add a dependency on Apache Fory‚Ñ¢ scala for scala 3 with sbt, use the following:  libraryDependencies += &quot;org.apache.fory&quot; % &quot;fory-scala_3&quot; % &quot;0.13.2&quot;   ","version":"0.13","tagName":"h2"},{"title":"Kotlin‚Äã","type":1,"pageTitle":"Install","url":"/docs/0.13/start/install#kotlin","content":" To add a dependency on Apache Fory‚Ñ¢ kotlin with maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-kotlin&lt;/artifactId&gt; &lt;version&gt;0.13.2&lt;/version&gt; &lt;/dependency&gt;   ","version":"0.13","tagName":"h2"},{"title":"Python‚Äã","type":1,"pageTitle":"Install","url":"/docs/0.13/start/install#python","content":" python -m pip install --upgrade pip pip install pyfory==0.13.2   ","version":"0.13","tagName":"h2"},{"title":"Rust‚Äã","type":1,"pageTitle":"Install","url":"/docs/0.13/start/install#rust","content":" [dependencies] fory = &quot;0.14&quot;   or just execute command:  cargo add fory@0.13.2   ","version":"0.13","tagName":"h2"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Install","url":"/docs/0.13/start/install#javascript","content":" Apache Fory‚Ñ¢ is NOT yet available on npm, please install from source code now. ","version":"0.13","tagName":"h2"},{"title":"Xlang Serialization Format","type":0,"sectionRef":"#","url":"/docs/0.13/specification/xlang_serialization_spec","content":"","keywords":"","version":"0.13"},{"title":"Cross-language Serialization Specification‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#cross-language-serialization-specification","content":" Format Version History: Version 0.1 - serialization spec formalized  Apache Fory‚Ñ¢ xlang serialization is an automatic object serialization framework that supports reference and polymorphism. Apache Fory‚Ñ¢ will convert an object from/to fory xlang serialization binary format. Apache Fory‚Ñ¢ has two core concepts for xlang serialization:  Apache Fory‚Ñ¢ xlang binary formatFramework implemented in different languages to convert object to/from Apache Fory‚Ñ¢ xlang binary format  The serialization format is a dynamic binary format. The dynamics and reference/polymorphism support make Apache Fory‚Ñ¢ flexible, much more easy to use, but also introduce more complexities compared to static serialization frameworks. So the format will be more complex.  ","version":"0.13","tagName":"h2"},{"title":"Type Systems‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#type-systems","content":" ","version":"0.13","tagName":"h2"},{"title":"Data Types‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#data-types","content":" bool: a boolean value (true or false).int8: a 8-bit signed integer.int16: a 16-bit signed integer.int32: a 32-bit signed integer.var_int32: a 32-bit signed integer which use fory var_int32 encoding.int64: a 64-bit signed integer.var_int64: a 64-bit signed integer which use fory PVL encoding.sli_int64: a 64-bit signed integer which use fory SLI encoding.float16: a 16-bit floating point number.float32: a 32-bit floating point number.float64: a 64-bit floating point number including NaN and Infinity.string: a text string encoded using Latin1/UTF16/UTF-8 encoding.enum: a data type consisting of a set of named values. Rust enum with non-predefined field values are not supported as an enum.named_enum: an enum whose value will be serialized as the registered name.struct: a morphic(final) type serialized by Fory Struct serializer. i.e. it doesn't have subclasses. Suppose we're deserializing List&lt;SomeClass&gt;, we can save dynamic serializer dispatch since SomeClass is morphic(final).compatible_struct: a morphic(final) type serialized by Fory compatible Struct serializer.named_struct: a struct whose type mapping will be encoded as a name.named_compatible_struct: a compatible_struct whose type mapping will be encoded as a name.ext: a type which will be serialized by a customized serializer.named_ext: an ext type whose type mapping will be encoded as a name.list: a sequence of objects.set: an unordered set of unique elements.map: a map of key-value pairs. Mutable types such as list/map/set/array/tensor/arrow are not allowed as key of map.duration: an absolute length of time, independent of any calendar/timezone, as a count of nanoseconds.timestamp: a point in time, independent of any calendar/timezone, as a count of nanoseconds. The count is relative to an epoch at UTC midnight on January 1, 1970.local_date: a naive date without timezone. The count is days relative to an epoch at UTC midnight on Jan 1, 1970.decimal: exact decimal value represented as an integer value in two's complement.binary: an variable-length array of bytes.array: only allow 1d numeric components. Other arrays will be taken as List. The implementation should support the interoperability between array and list. bool_array: one dimensional bool array.int8_array: one dimensional int8 array.int16_array: one dimensional int16 array.int32_array: one dimensional int32 array.int64_array: one dimensional int64 array.float16_array: one dimensional half_float_16 array.float32_array: one dimensional float32 array.float64_array: one dimensional float64 array. tensor: multidimensional array which every sub-array have same size and type.arrow record batch: an arrow record batch object.arrow table: an arrow table object.  Note:  Unsigned int/long are not added here, since not every language support those types.  ","version":"0.13","tagName":"h3"},{"title":"Polymorphisms‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#polymorphisms","content":" For polymorphism, if one non-final class is registered, and only one subclass is registered, then we can take all elements in List/Map have same type, thus reduce runtime check cost.  Collection/Array polymorphism are not fully supported, since some languages such as golang have only one collection type. If users want to get exactly the type he passed, he must pass that type when deserializing or annotate that type to the field of struct.  ","version":"0.13","tagName":"h3"},{"title":"Type disambiguation‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#type-disambiguation","content":" Due to differences between type systems of languages, those types can't be mapped one-to-one between languages. When deserializing, Fory use the target data structure type and the data type in the data jointly to determine how to deserialize and populate the target data structure. For example:  class Foo { int[] intArray; Object[] objects; List&lt;Object&gt; objectList; } class Foo2 { int[] intArray; List&lt;Object&gt; objects; List&lt;Object&gt; objectList; }   intArray has an int32_array type. But both objects and objectList fields in the serialize data have list data type. When deserializing, the implementation will create an Object array for objects, but create a ArrayListfor objectList to populate its elements. And the serialized data of Foo can be deserialized into Foo2 too.  Users can also provide meta hints for fields of a type, or the type whole. Here is an example in java which use annotation to provide such information.  @ForyObject(fieldsNullable = false, trackingRef = false) class Foo { @ForyField(trackingRef = false) int[] intArray; @ForyField(polymorphic = true) Object object; @ForyField(tagId = 1, nullable = true) List&lt;Object&gt; objectList; }   Such information can be provided in other languages too:  cpp: use macro and template.golang: use struct tag.python: use typehint.rust: use macro.  ","version":"0.13","tagName":"h3"},{"title":"Type ID‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#type-id","content":" All internal data types are expressed using an ID in range 0~64. Users can use 0~4096 for representing their types.  ","version":"0.13","tagName":"h3"},{"title":"Spec overview‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#spec-overview","content":" Here is the overall format:  | fory header | object ref meta | object type meta | object value data |   The data are serialized using little endian byte order overall. If bytes swap is costly for some object, Fory will write the byte order for that object into the data instead of converting it to little endian.  ","version":"0.13","tagName":"h2"},{"title":"Fory header‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#fory-header","content":" Fory header consists starts one byte:  | 2 bytes | 4 bits | 1 bit | 1 bit | 1 bit | 1 bit | 1 byte | optional 4 bytes | +--------------+---------------+-------+-------+--------+-------+------------+------------------------------------+ | magic number | reserved bits | oob | xlang | endian | null | language | unsigned int for meta start offset |   magic number: used to identify fory serialization protocol, current version use 0x62d4.null flag: 1 when object is null, 0 otherwise. If an object is null, other bits won't be set.endian flag: 1 when data is encoded by little endian, 0 for big endian.xlang flag: 1 when serialization uses xlang format, 0 when serialization uses Fory java format.oob flag: 1 when passed BufferCallback is not null, 0 otherwise.language: the language when serializing objects, such as JAVA, PYTHON, GO, etc. Fory can use this flag to determine whether spend more time on serialization to make the deserialization faster for dynamic languages.  If meta share mode is enabled, an uncompressed unsigned int is appended to indicate the start offset of metadata.  ","version":"0.13","tagName":"h2"},{"title":"Reference Meta‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#reference-meta","content":" Reference tracking handles whether the object is null, and whether to track reference for the object by writing corresponding flags and maintaining internal state.  Reference flags:  Flag\tByte Value\tDescriptionNULL FLAG\t-3\tThis flag indicates the object is a null value. We don't use another byte to indicate REF, so that we can save one byte. REF FLAG\t-2\tThis flag indicates the object is already serialized previously, and fory will write a ref id with unsigned varint format instead of serialize it again NOT_NULL VALUE FLAG\t-1\tThis flag indicates the object is a non-null value and fory doesn't track ref for this type of object. REF VALUE FLAG\t0\tThis flag indicates the object is referencable and the first time to serialize.  When reference tracking is disabled globally or for specific types, or for certain types within a particular context(e.g., a field of a type), only the NULL and NOT_NULL VALUE flags will be used for reference meta.  For languages which doesn't support reference such as rust, reference tracking must be disabled for correct deserialization by fory rust implementation.  For languages whose object values are not null by default:  In rust, Fory takes Option:None as a null valueIn c++, Fory takes std::nullopt as a null valueIn golang, Fory takes null interface/pointer as a null value  If one want to deserialize in languages like Java/Python/JavaScript, he should mark the type with all fields not-null by default, or using schema-evolution mode to carry the not-null fields info in the data.  ","version":"0.13","tagName":"h2"},{"title":"Type Meta‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#type-meta","content":" For every type to be serialized, it have a type id to indicate its type.  basic types: the type idenum: Type.ENUM + registered idType.NAMED_ENUM + registered namespace+typename list: Type.Listset: Type.SETmap: Type.MAPext: Type.EXT + registered idType.NAMED_EXT + registered namespace+typename struct: Type.STRUCT + struct metaType.NAMED_STRUCT + struct meta  Every type must be registered with an ID or name first. The registration can be used for security check and type identification.  Struct is a special type, depending whether schema compatibility is enabled, Fory will write struct meta differently.  ","version":"0.13","tagName":"h2"},{"title":"Struct Schema consistent‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#struct-schema-consistent","content":" If schema consistent mode is enabled globally when creating fory, type meta will be written as a fory unsigned varint of type_id. Schema evolution related meta will be ignored.If schema evolution mode is enabled globally when creating fory, and current class is configured to use schema consistent mode like struct vs table in flatbuffers: Type meta will be add to captured_type_defs: captured_type_defs[type def stub] = map size ahead when registering type.Get index of the meta in captured_type_defs, write that index as | unsigned varint: index |.  ","version":"0.13","tagName":"h3"},{"title":"Struct Schema evolution‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#struct-schema-evolution","content":" If schema evolution mode is enabled globally when creating fory, and enabled for current type, type meta will be written using one of the following mode. Which mode to use is configured when creating fory.  Normal mode(meta share not enabled): If type meta hasn't been written before, add type defto captured_type_defs: captured_type_defs[type def] = map size.Get index of the meta in captured_type_defs, write that index as | unsigned varint: index |.After finished the serialization of the object graph, fory will start to write captured_type_defs: Firstly, set current to meta start offset of fory header Then write captured_type_defs one by one: buffer.write_var_uint32(len(writting_type_defs) - len(schema_consistent_type_def_stubs)) for type_meta in writting_type_defs: if not type_meta.is_stub(): type_meta.write_type_def(buffer) writing_type_defs = copy(schema_consistent_type_def_stubs) Meta share mode: the writing steps are same as the normal mode, but captured_type_defs will be shared across multiple serializations of different objects. For example, suppose we have a batch to serialize: captured_type_defs = {} stream = ... # add `Type1` to `captured_type_defs` and write `Type1` fory.serialize(stream, [Type1()]) # add `Type2` to `captured_type_defs` and write `Type2`, `Type1` is written before. fory.serialize(stream, [Type1(), Type2()]) # `Type1` and `Type2` are written before, no need to write meta. fory.serialize(stream, [Type1(), Type2()]) Streaming mode(streaming mode doesn't support meta share): If type meta hasn't been written before, the data will be written as: | unsigned varint: 0b11111111 | type def | If type meta has been written before, the data will be written as: | unsigned varint: written index &lt;&lt; 1 | written index is the id in captured_type_defs. With this mode, meta start offset can be omitted.  The normal mode and meta share mode will forbid streaming writing since it needs to look back for update the start offset after the whole object graph writing and meta collecting is finished. Only in this way we can ensure deserialization failure in meta share mode doesn't lost shared meta.  Type Def‚Äã  Here we mainly describe the meta layout for schema evolution mode:  | 8 bytes header | variable bytes | variable bytes | +----------------------+--------------------+-------------------+ | global binary header | meta header | fields meta |   For languages which support inheritance, if parent class and subclass has fields with same name, using field in subclass.  Global binary header‚Äã  50 bits hash + 1bit compress flag + write fields meta + 12 bits meta size. Right is the lower bits.  lower 12 bits are used to encode meta size. If meta size &gt;= 0b1111_1111_1111, then writemeta_ size - 0b1111_1111_1111 next.13rd bit is used to indicate whether to write fields meta. When this class is schema-consistent or use registered serializer, fields meta will be skipped. Class Meta will be used for share namespace + type name only.14rd bit is used to indicate whether meta is compressed.Other 50 bits is used to store the unique hash of flags + all layers class meta.  Meta header‚Äã  Meta header is a 8 bits number value.  Lowest 5 digits 0b00000~0b11110 are used to record num fields. 0b11111 is preserved to indicate that Fory need to read more bytes for length using Fory unsigned int encoding. Note that num_fields is the number of compatible fields. Users can use tag id to mark some fields as compatible fields in schema consistent context. In such cases, schema consistent fields will be serialized first, then compatible fields will be serialized next. At deserialization, Fory will use fields info of those fields which aren't annotated by tag id for deserializing schema consistent fields, then use fields info in meta for deserializing compatible fields.The 6th bit: 0 for registered by id, 1 for registered by name.Remaining 2 bits are reserved for future extension.  Fields meta‚Äã  Format:  | field info: variable bytes | variable bytes | ... | +---------------------------------+-----------------+-----+ | header + type info + field name | next field info | ... |   Field Header‚Äã  Field Header is 8 bits, annotation can be used to provide more specific info. If annotation not exists, fory will infer those info automatically.  The format for field header is:  2 bits field name encoding + 4 bits size + nullability flag + ref tracking flag   Detailed spec:  2 bits field name encoding: encoding: UTF8/ALL_TO_LOWER_SPECIAL/LOWER_UPPER_DIGIT_SPECIAL/TAG_IDIf tag id is used, field name will be written by an unsigned varint tag id, and 2 bits encoding will be 11. size of field name: The 4 bits size: 0~14 will be used to indicate length 1~15, the value 15 indicates to read more bytes, the encoding will encode size - 15 as a varint next.If encoding is TAG_ID, then num_bytes of field name will be used to store tag id. ref tracking: when set to 1, ref tracking will be enabled for this field.nullability: when set to 1, this field can be null.  Field Type Info‚Äã  Field type info is written as unsigned int8. Detailed id spec is:  For struct registered by id, it will be Type.STRUCT.For struct registered by name, it will be Type.NAMED_STRUCT.For enum registered by id, it will be Type.ENUM.For enum registered by name, it will be Type.NAMED_ENUM.For ext type registered by id, it will be Type.EXT.For ext type registered by name, it will be Type.NAMED_EXT.For list/set type, it will be written as Type.LIST/SET, then write element type recursively.For 1D primitive array type, it will be written as Type.XXX_ARRAY.For multi-dimensional primitive array type with same size on each dim, it will be written as Type.TENSOR.For other array type, it will be written as Type.LIST, then write element type recursively.For map type, it will be written as Type.MAP, then write key and value type recursively.For other types supported by fory directly, it will be fory type id for that type.For other types not determined at compile time, write Type.UNKNOWN instead. For such types, actual type will be written when serializing such field values.  Polymorphism spec:  struct/named_struct/ext/named_ext are taken as polymorphic, the meta for those types are written separately instead of inlining here to reduce meta space cost if object of this type is serialized in current object graph multiple times, and the field value may be null too.enum is taken as morphic, if deserialization doesn't have this field, or the type is not enum, enum value will be skipped.list/map/set are taken as morphic, when serializing values of those type, the concrete types won't be written again.Other types that fory supported are taken as morphic too.  List/Set/Map nested type spec:  list: | list type id | nested type id &lt;&lt; 2 + nullability flag + ref tracking flag | ... multi-layer type info |set: | set type id | nested type id &lt;&lt; 2 + nullability flag + ref tracking flag | ... multi-layer type info |map: | set type id | key type info | value type info | Key type format: | nested type id &lt;&lt; 2 + nullability flag + ref tracking flag | ... multi-layer type info |Value type format: | nested type id &lt;&lt; 2 + nullability flag + ref tracking flag | ... multi-layer type info |  Field Name‚Äã  If tag id is set, tag id will be used instead. Otherwise meta string of field name will be written instead.  Field order‚Äã  Field order are left as implementation details, which is not exposed to specification, the deserialization need to resort fields based on Fory fields sort algorithms. In this way, fory can compute statistics for field names or types and using a more compact encoding.  ","version":"0.13","tagName":"h3"},{"title":"Extended Type Meta with Inheritance support‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#extended-type-meta-with-inheritance-support","content":" If one want to support inheritance for struct, one can implement following spec.  ","version":"0.13","tagName":"h2"},{"title":"Schema consistent‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#schema-consistent","content":" Fields are serialized from parent type to leaf type. Fields are sorted using fory struct fields sort algorithms.  ","version":"0.13","tagName":"h3"},{"title":"Schema Evolution‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#schema-evolution","content":" Meta layout for schema evolution mode:  | 8 bytes header | variable bytes | variable bytes | variable bytes | variable bytes | +----------------------+----------------+----------------+--------------------+--------------------+ | global binary header | meta header | fields meta | parent meta header | parent fields meta |   Meta header‚Äã  Meta header is a 64 bits number value encoded in little endian order.  Lowest 4 digits 0b0000~0b1110 are used to record num classes. 0b1111 is preserved to indicate that Fory need to read more bytes for length using Fory unsigned int encoding. If current type doesn't has parent type, or parent type doesn't have fields to serialize, or we're in a context which serialize fields of current type only, num classes will be 1.The 5th bit is used to indicate whether this type needs schema evolution.Other 56 bits are used to store the unique hash of flags + all layers type meta.  Single layer type meta‚Äã  | unsigned varint | var uint | field info: variable bytes | variable bytes | ... | +-----------------+----------+-------------------------------+-----------------+-----+ | num_fields | type id | header + type id + field name | next field info | ... |   Other layers type meta‚Äã  Same encoding algorithm as the previous layer.  ","version":"0.13","tagName":"h3"},{"title":"Meta String‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#meta-string","content":" Meta string is mainly used to encode meta strings such as field names.  ","version":"0.13","tagName":"h2"},{"title":"Encoding Algorithms‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#encoding-algorithms","content":" String binary encoding algorithm:  Algorithm\tPattern\tDescriptionLOWER_SPECIAL\ta-z._$|\tevery char is written using 5 bits, a-z: 0b00000~0b11001, ._$|: 0b11010~0b11101, prepend one bit at the start to indicate whether strip last char since last byte may have 7 redundant bits(1 indicates strip last char) LOWER_UPPER_DIGIT_SPECIAL\ta-zA-Z0~9._\tevery char is written using 6 bits, a-z: 0b00000~0b11001, A-Z: 0b11010~0b110011, 0~9: 0b110100~0b111101, ._: 0b111110~0b111111, prepend one bit at the start to indicate whether strip last char since last byte may have 7 redundant bits(1 indicates strip last char) UTF-8\tany chars\tUTF-8 encoding  Encoding flags:  Encoding Flag\tPattern\tEncoding AlgorithmLOWER_SPECIAL\tevery char is in a-z._|\tLOWER_SPECIAL FIRST_TO_LOWER_SPECIAL\tevery char is in a-z._ except first char is upper case\treplace first upper case char to lower case, then use LOWER_SPECIAL ALL_TO_LOWER_SPECIAL\tevery char is in a-zA-Z._\treplace every upper case char by | + lower case, then use LOWER_SPECIAL, use this encoding if it's smaller than Encoding LOWER_UPPER_DIGIT_SPECIAL LOWER_UPPER_DIGIT_SPECIAL\tevery char is in a-zA-Z._\tuse LOWER_UPPER_DIGIT_SPECIAL encoding if it's smaller than Encoding FIRST_TO_LOWER_SPECIAL UTF8\tany utf-8 char\tuse UTF-8 encoding Compression\tany utf-8 char\tlossless compression  Notes:  Depending on cases, one can choose encoding flags + data jointly, uses 3 bits of first byte for flags and other bytes for data.  ","version":"0.13","tagName":"h3"},{"title":"Value Format‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#value-format","content":" ","version":"0.13","tagName":"h2"},{"title":"Basic types‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#basic-types","content":" bool‚Äã  size: 1 byteformat: 0 for false, 1 for true  int8‚Äã  size: 1 byteformat: write as pure byte.  int16‚Äã  size: 2 bytebyte order: raw bytes of little endian order  unsigned int32‚Äã  size: 4 bytebyte order: raw bytes of little endian order  unsigned varint32‚Äã  size: 1~5 byteFormat: The most significant bit (MSB) in every byte indicates whether to have the next byte. If first bit is set i.e. b &amp; 0x80 == 0x80, then the next byte should be read until the first bit of the next byte is unset.  signed int32‚Äã  size: 4 bytebyte order: raw bytes of little endian order  signed varint32‚Äã  size: 1~5 byteFormat: First convert the number into positive unsigned int by (v &lt;&lt; 1) ^ (v &gt;&gt; 31) ZigZag algorithm, then encode it as an unsigned varint.  unsigned int64‚Äã  size: 8 bytebyte order: raw bytes of little endian order  unsigned varint64‚Äã  size: 1~9 byteFory SLI(Small long as int) Encoding: If long is in [0, 2147483647], encode as 4 bytes int: | little-endian: ((int) value) &lt;&lt; 1 |Otherwise write as 9 bytes: | 0b1 | little-endian 8 bytes long | Fory PVL(Progressive Variable-length Long) Encoding: positive long format: first bit in every byte indicates whether to have the next byte. If first bit is set i.e. b &amp; 0x80 == 0x80, then the next byte should be read until the first bit is unset.  signed int64‚Äã  size: 8 bytebyte order: raw bytes of little endian order  signed varint64‚Äã  size: 1~9 byteFory SLI(Small long as int) Encoding: If long is in [-1073741824, 1073741823], encode as 4 bytes int: | little-endian: ((int) value) &lt;&lt; 1 |Otherwise write as 9 bytes: | 0b1 | little-endian 8 bytes long | Fory PVL(Progressive Variable-length Long) Encoding: First convert the number into positive unsigned long by (v &lt;&lt; 1) ^ (v &gt;&gt; 63) ZigZag algorithm to reduce cost of small negative numbers, then encoding it as an unsigned long.  float32‚Äã  size: 4 byteformat: encode the specified floating-point value according to the IEEE 754 floating-point &quot;single format&quot; bit layout, preserving Not-a-Number (NaN) values, then write as binary by little endian order.  float64‚Äã  size: 8 byteformat: encode the specified floating-point value according to the IEEE 754 floating-point &quot;double format&quot; bit layout, preserving Not-a-Number (NaN) values. then write as binary by little endian order.  ","version":"0.13","tagName":"h3"},{"title":"string‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#string","content":" Format:  | unsigned varint64: size &lt;&lt; 2 `bitor` 2 bits encoding flags | binary data |   size + encoding will be concat as a long and encoded as an unsigned varint64. The little 2 bits is used for encoding: 0 for latin1(ISO-8859-1), 1 for utf-16, 2 for utf-8.encoded string binary data based on encoding: latin/utf-16/utf-8.  Which encoding to choose:  For JDK8: fory detect latin at runtime, if string is latin string, then use latin encoding, otherwise use utf-16.For JDK9+: fory use coder in String object for encoding, latin/utf-16 will be used for encoding.If the string is encoded by utf-8, then fory will use utf-8 to decode the data. Cross-language string serialization of fory uses utf-8 by default.  ","version":"0.13","tagName":"h3"},{"title":"collection/list‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#collectionlist","content":" Format:  | unsigned varint64: length | 1 byte elements header | elements data |   elements header‚Äã  In most cases, all elements are same type and not null, elements header will encode those homogeneous information to avoid the cost of writing it for every element. Specifically, there are four kinds of information which will be encoded by elements header, each use one bit:  If track elements ref, use the first bit 0b1 of the header to flag it.If the elements have null, use the second bit 0b10 of the header to flag it. If ref tracking is enabled for this element type, this flag is invalid.If the element types are the declared type, use the 3rd bit 0b100 of the header to flag it.If the element types are smae, use the 4th bit 0b1000 header to flag it.  By default, all bits are unset, which means all elements won't track ref, all elements are same type, not null and the actual element is the declared type in the custom type field.  The implementation can generate different deserialization code based read header, and look up the generated code from a linear map/list.  elements data‚Äã  Based on the elements header, the serialization of elements data may skip ref flag/null flag/element type info.  fory = ... buffer = ... elems = ... if element_type_is_same: if not is_declared_type: fory.write_type(buffer, elem_type) elem_serializer = get_serializer(...) if track_ref: for elem in elems: if not ref_resolver.write_ref_or_null(buffer, elem): elem_serializer.write(buffer, elem) elif has_null: for elem in elems: if elem is None: buffer.write_byte(null_flag) else: buffer.write_byte(not_null_flag) elem_serializer.write(buffer, elem) else: for elem in elems: elem_serializer.write(buffer, elem) else: if track_ref: for elem in elems: fory.write_ref(buffer, elem) elif has_null: for elem in elems: fory.write_nullable(buffer, elem) else: for elem in elems: fory.write_value(buffer, elem)   CollectionSerializer#writeElementscan be taken as an example.  ","version":"0.13","tagName":"h3"},{"title":"array‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#array","content":" primitive array‚Äã  Primitive array are taken as a binary buffer, serialization will just write the length of array size as an unsigned int, then copy the whole buffer into the stream.  Such serialization won't compress the array. If users want to compress primitive array, users need to register custom serializers for such types or mark it as list type.  Tensor‚Äã  Tensor is a special primitive multi-dimensional array which all dimensions have same size and type. The serialization format is:  | num_dims(unsigned varint) | shape[0](unsigned varint) | shape[...] | shape[N] | element type | data |   The data is continuous to reduce copy and may zero-copy in some cases.  object array‚Äã  Object array is serialized using the list format. Object component type will be taken as list element generic type.  ","version":"0.13","tagName":"h3"},{"title":"map‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#map","content":" Map uses a chunk by chunk based Format:  | length(unsigned varint) | key value chunk data | ... | key value chunk data |   map key-value chunk data‚Äã  Map iteration is too expensive, Fory won't compute the header like for list since it introduceconsiderable overhead. Users can use MapFieldInfo annotation to provide the header in advance. Otherwise Fory will use first key-value pair to predict header optimistically, and update the chunk header if the prediction failed at some pair.  Fory will serialize the map chunk by chunk, every chunk has 255 pairs at most.  | 1 byte | 1 byte | variable bytes | +----------------+----------------+-----------------+ | KV header | chunk size: N | N*2 objects |   KV header:  If track key ref, use the first bit 0b1 of the header to flag it.If the key has null, use the second bit 0b10 of the header to flag it. If ref tracking is enabled for this key type, this flag is invalid.If the actual key type of map is the declared key type, use the 3rd bit 0b100 of the header to flag it.If track value ref, use the 4th bit 0b1000 of the header to flag it.If the value has null, use the 5th bit 0b10000 of the header to flag it. If ref tracking is enabled for this value type, this flag is invalid.If the value type of map is the declared value type, use the 6rd bit 0b100000 of the header to flag it.If key or value is null, that key and value will be written as a separate chunk, and chunk size writing will be skipped too.  If streaming write is enabled, which means Fory can't update written chunk size. In such cases, map key-value data format will be:  | 1 byte | variable bytes | +----------------+-----------------+ | KV header | N*2 objects |   KV header will be a header marked by MapFieldInfo in java. For languages such as golang, this can be computed in advance for non-interface types most times. The implementation can generate different deserialization code based read header, and look up the generated code from a linear map/list.  Why serialize chunk by chunk?‚Äã  When fory will use first key-value pair to predict header optimistically, it can't know how many pairs have same meta(tracking kef ref, key has null and so on). If we don't write chunk by chunk with max chunk size, we must write at least X bytes to take up a place for later to update the number which has same elements, X is the num_bytes for encoding varint encoding of map size.  And most map size are smaller than 255, if all pairs have same data, the chunk will be 1. This is common in golang/rust, which object are not reference by default.  Also, if only one or two keys have different meta, we can make it into a different chunk, so that most pairs can share meta.  The implementation can accumulate read count with map size to decide whether to read more chunks.  ","version":"0.13","tagName":"h3"},{"title":"enum‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#enum","content":" Enums are serialized as an unsigned var int. If the order of enum values change, the deserialized enum value may not be the value users expect. In such cases, users must register enum serializer by make it write enum value as an enumerated string with unique hash disabled.  ","version":"0.13","tagName":"h3"},{"title":"decimal‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#decimal","content":" Not supported for now.  ","version":"0.13","tagName":"h3"},{"title":"struct‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#struct","content":" Struct means object of class/pojo/struct/bean/record type. Struct will be serialized by writing its fields data in fory order.  Depending on schema compatibility, structs will have different formats.  field order‚Äã  Field will be ordered as following, every group of fields will have its own order:  primitive fields: larger size type first, smaller later, variable size type last.when same size, sort by type idwhen same size and type id, sort by snake case field nametypes: bool/int8/int16/int32/varint32/int64/varint64/sliint64/float16/float32/float64 nullable primitive fields: same order as primitive fieldsother internal type fields: sort by type id then snake case field namelist fields: sort by snake case field nameset fields: sort by snake case field namemap fields: sort by snake case field nameother fields: sort by snake case field name  If two fields have same type, then sort by snake_case styled field name.  schema consistent‚Äã  Object will be written as:  | 4 byte | variable bytes | +---------------+------------------+ | type hash | field values |   Type hash is used to check the type schema consistency across languages. Type hash will be the first 32 bits of 56 bits value of the type meta.  Object fields will be serialized one by one using following format:  not null primitive field value: | var bytes | +----------------+ | value data | +----------------+ nullable primitive field value: | one byte | var bytes | +-----------+---------------+ | null flag | field value | +-----------+---------------+ other interal types supported by fory | var bytes | var objects | +-----------+-------------+ | null flag | value data | +-----------+-------------+ list field type: | one byte | var objects | +-----------+-------------+ | ref meta | value data | set field type: | one byte | var objects | +-----------+-------------+ | ref meta | value data | map field type: | one byte | var objects | +-----------+-------------+ | ref meta | value data | +-----------+-------------+-------------+ other types such as enum/struct/ext | one byte | var bytes | var objects | +-----------+------------+------------+ | ref flag | type meta | value data | +-----------+------------+------------+   Type hash algorithm:  Sort fields by fields sort algorithmStart with string &quot;&quot;Iterate every field, append string by: snow_case(field_name),. For camelcase name, convert it to snow_case first.$type_id,, for other fields, use type id TypeId::UNKNOWN instead.$nullable;, 1 if nullable, 0 otherwise. Then convert string to utf8 bytesCompute murmurhash3_x64_128, and use first 32 bits  Schema evolution‚Äã  Schema evolution have similar format as schema consistent mode for object except:  For the object type, schema consistent mode will write type by id only, but schema evolution mode will write type consisting of field names, types and other meta too, see Type meta.Type meta of final custom type needs to be written too, because peers may not have this type defined.  ","version":"0.13","tagName":"h3"},{"title":"Type‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#type","content":" Type will be serialized using type meta format.  ","version":"0.13","tagName":"h3"},{"title":"Implementation guidelines‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#implementation-guidelines","content":" ","version":"0.13","tagName":"h2"},{"title":"How to reduce memory read/write code‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#how-to-reduce-memory-readwrite-code","content":" Try to merge multiple bytes into an int/long write before writing to reduce memory IO and bound check cost.Read multiple bytes as an int/long, then split into multiple bytes to reduce memory IO and bound check cost.Try to use one varint/long to write flags and length together to save one byte cost and reduce memory io.Condition branches are less expensive compared to memory IO cost unless there are too many branches.  ","version":"0.13","tagName":"h3"},{"title":"Fast deserialization for static languages without runtime codegen support‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.13/specification/xlang_serialization_spec#fast-deserialization-for-static-languages-without-runtime-codegen-support","content":" For type evolution, the serializer will encode the type meta into the serialized data. The deserializer will compare this meta with class meta in the current process, and use the diff to determine how to deserialize the data.  For java/javascript/python, we can use the diff to generate serializer code at runtime and load it as class/function for deserialization. In this way, the type evolution will be as fast as type consist mode.  For C++/Rust, we can't generate the serializer code at runtime. So we need to generate the code at compile-time using meta programming. But at that time, we don't know the type schema in other processes, so we can't generate the serializer code for such inconsistent types. We may need to generate the code which has a loop and compare field name one by one to decide whether to deserialize and assign the field or skip the field value.  One fast way is that we can optimize the string comparison into jump instructions:  Assume the current type has n fields, and the peer type has n1 fields.Generate an auto growing field id from 0 for every sorted field in the current type at the compile time.Compare the received type meta with current type, generate same id if the field name is same, otherwise generate an auto growing id starting from n, cache this meta at runtime.Iterate the fields of received type meta, use a switch to compare the field id to deserialize data and assign/skip field value. Continuous field id will be optimized into jump in switch block, so it will very fast.  Here is an example, suppose process A has a class Foo with version 1 defined as Foo1, process B has a class Foowith version 2 defined as Foo2:  // class Foo with version 1 class Foo1 { int32_t v1; // id 0 std::string v2; // id 1 }; // class Foo with version 2 class Foo2 { // id 0, but will have id 2 in process A bool v0; // id 1, but will have id 0 in process A int32_t v1; // id 2, but will have id 3 in process A int64_t long_value; // id 3, but will have id 1 in process A std::string v2; // id 4, but will have id 4 in process A std::vector&lt;std::string&gt; list; };   When process A received serialized Foo2 from process B, here is how it deserialize the data:  Foo1 foo1 = ...; const std::vector&lt;fory::FieldInfo&gt; &amp;field_infos = type_meta.field_infos; for (const auto &amp;field_info : field_infos) { switch (field_info.field_id) { case 0: foo1.v1 = buffer.read_varint32(); break; case 1: foo1.v2 = fory.read_string(); break; default: fory.skip_data(field_info); } }  ","version":"0.13","tagName":"h3"},{"title":"Usage","type":0,"sectionRef":"#","url":"/docs/0.13/start/usage","content":"","keywords":"","version":"0.13"},{"title":"Native Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.13/start/usage#native-serialization","content":" Always use native mode when working with a single language. Native mode delivers optimal performance by avoiding the type metadata overhead required for cross-language compatibility.  Xlang mode introduces additional metadata encoding costs and restricts serialization to types that are common across all supported languages. Language-specific types will be rejected during serialization in xlang-mode.  ","version":"0.13","tagName":"h2"},{"title":"Java Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.13/start/usage#java-serialization","content":" When you don't need cross-language support, use Java mode for optimal performance.  import org.apache.fory.*; import org.apache.fory.config.*; public class Example { public static class Person { String name; int age; } public static void main(String[] args) { // Create Fory instance - should be reused across serializations BaseFory fory = Fory.builder() .withLanguage(Language.JAVA) .requireClassRegistration(true) // replace `build` with `buildThreadSafeFory` for Thread-Safe Usage .build(); // Register your classes (required when class registration is enabled) fory.register(Person.class); // Serialize Person person = new Person(); person.name = &quot;chaokunyang&quot;; person.age = 28; byte[] bytes = fory.serialize(person); Person result = (Person) fory.deserialize(bytes); System.out.println(result.name + &quot; &quot; + result.age); // Output: chaokunyang 28 } }   For detailed Java usage including compatibility modes, compression, and advanced features, see Java Serialization Guide.  ","version":"0.13","tagName":"h3"},{"title":"Python Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.13/start/usage#python-serialization","content":" Python native mode provides a high-performance drop-in replacement for pickle/cloudpickle with better speed and compatibility.  from dataclasses import dataclass import pyfory @dataclass class Person: name: str age: pyfory.int32 # Create Fory instance - should be reused across serializations fory = pyfory.Fory() # Register your classes (required when class registration is enabled) fory.register_type(Person) person = Person(name=&quot;chaokunyang&quot;, age=28) data = fory.serialize(person) result = fory.deserialize(data) print(result.name, result.age) # Output: chaokunyang 28   For detailed Python usage including type hints, compatibility modes, and advanced features, see Python Guide.  ","version":"0.13","tagName":"h3"},{"title":"Scala Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.13/start/usage#scala-serialization","content":" Scala native mode provides optimized serialization for Scala-specific types including case classes, collections, and Option types.  import org.apache.fory.Fory import org.apache.fory.config.Language import org.apache.fory.serializer.scala.ScalaSerializers case class Person(name: String, age: Int) object Example { def main(args: Array[String]): Unit = { // Create Fory instance - should be reused across serializations val fory = Fory.builder() .withLanguage(Language.JAVA) .requireClassRegistration(true) .build() // Register Scala serializers for Scala-specific types ScalaSerializers.registerSerializers(fory) // Register your case classes fory.register(classOf[Person]) val bytes = fory.serialize(Person(&quot;chaokunyang&quot;, 28)) val result = fory.deserialize(bytes).asInstanceOf[Person] println(s&quot;${result.name} ${result.age}&quot;) // Output: chaokunyang 28 } }   For detailed Scala usage including collection serialization and integration patterns, see Scala Guide.  ","version":"0.13","tagName":"h3"},{"title":"Kotlin Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.13/start/usage#kotlin-serialization","content":" Kotlin native mode provides optimized serialization for Kotlin-specific types including data classes, nullable types, and Kotlin collections.  import org.apache.fory.Fory import org.apache.fory.config.Language import org.apache.fory.serializer.kotlin.KotlinSerializers data class Person(val name: String, val age: Int) fun main() { // Create Fory instance - should be reused across serializations val fory = Fory.builder() .withLanguage(Language.JAVA) .requireClassRegistration(true) .build() // Register Kotlin serializers for Kotlin-specific types KotlinSerializers.registerSerializers(fory) // Register your data classes fory.register(Person::class.java) val bytes = fory.serialize(Person(&quot;chaokunyang&quot;, 28)) val result = fory.deserialize(bytes) as Person println(&quot;${result.name} ${result.age}&quot;) // Output: chaokunyang 28 }   For detailed Kotlin usage including null safety and default value support, see kotlin/README.md.  ","version":"0.13","tagName":"h3"},{"title":"Cross-Language Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.13/start/usage#cross-language-serialization","content":" Only use xlang mode when you need cross-language data exchange. Xlang mode adds type metadata overhead for cross-language compatibility and only supports types that can be mapped across all languages. For single-language use cases, always prefer native mode for better performance.  The following examples demonstrate serializing a Person object across Java and Rust. For other languages (Python, Go, JavaScript, etc.), simply set the language mode to XLANG and follow the same pattern.  ","version":"0.13","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.13/start/usage#java","content":" import org.apache.fory.*; import org.apache.fory.config.*; public class XlangExample { public record Person(String name, int age) {} public static void main(String[] args) { // Create Fory instance with XLANG mode Fory fory = Fory.builder() .withLanguage(Language.XLANG) .build(); // Register with cross-language type id/name fory.register(Person.class, 1); // fory.register(Person.class, &quot;example.Person&quot;); Person person = new Person(&quot;chaokunyang&quot;, 28); byte[] bytes = fory.serialize(person); // bytes can be deserialized by Rust, Python, Go, or other languages Person result = (Person) fory.deserialize(bytes); System.out.println(result.name + &quot; &quot; + result.age); // Output: chaokunyang 28 } }   ","version":"0.13","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.13/start/usage#rust","content":" use fory::{Fory, ForyObject}; #[derive(ForyObject, Debug)] struct Person { name: String, age: i32, } fn main() -&gt; Result&lt;(), Error&gt; { let mut fory = Fory::default(); fory.register::&lt;Person&gt;(1)?; // fory.register_by_name::&lt;Person&gt;(&quot;example.Person&quot;)?; let person = Person { name: &quot;chaokunyang&quot;.to_string(), age: 28, }; let bytes = fory.serialize(&amp;person); // bytes can be deserialized by Java, Python, Go, or other languages let result: Person = fory.deserialize(&amp;bytes)?; println!(&quot;{} {}&quot;, result.name, result.age); // Output: chaokunyang 28 }   ","version":"0.13","tagName":"h3"},{"title":"Golang‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.13/start/usage#golang","content":" type Person struct { name: string age: i32 } fory := fory.NewFory(true) fory.Register(Person{}, 1) person := Person{&quot;chaokunyang&quot;, 28} bytes, err := fory.Marshal(person) var p Person err = fory.Unmarshal(bytes, &amp;p)   ","version":"0.13","tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.13/start/usage#javascript","content":" import Fory, { Type } from &quot;@apache-fory/fory&quot;; /** * @apache-fory/hps use v8's fast-calls-api that can be called directly by jit, ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from &quot;@apache-fory/hps&quot;; // Now we describe data structures using JSON, but in the future, we will use more ways. const description = Type.object(&quot;example.Person&quot;, { name: Type.string(), age: Type.int32(), }); const fory = new Fory({ hps }); const { serialize, deserialize } = fory.registerSerializer(description); const input = serialize({ name: &quot;chaokunyang&quot;, age: 28 }); const result = deserialize(input); console.log(result);   ","version":"0.13","tagName":"h3"},{"title":"Key Points‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.13/start/usage#key-points","content":" Use Language.XLANG mode in all languagesRegister types with consistent IDs or names across all languages: By ID (fory.register(Person.class, 1)): Faster serialization, more compact encoding, but requires coordination to avoid ID conflictsBy name (fory.register(Person.class, &quot;example.Person&quot;)): More flexible, less prone to conflicts, easier to manage across teams, but slightly larger encoding Type IDs/names must match across all languages for successful deserializationOnly use types that have cross-language mappings (see Type Mapping)  For examples with circular references, shared references, and polymorphism across languages, see:  Cross-Language Serialization GuideJava Serialization Guide - Cross LanguagePython Guide - Cross Language  ","version":"0.13","tagName":"h3"},{"title":"Row Format Encoding‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.13/start/usage#row-format-encoding","content":" Row format provides zero-copy random access to serialized data, making it ideal for analytics workloads and data processing pipelines.  ","version":"0.13","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.13/start/usage#java-1","content":" import org.apache.fory.format.*; import java.util.*; import java.util.stream.*; public class Bar { String f1; List&lt;Long&gt; f2; } public class Foo { int f1; List&lt;Integer&gt; f2; Map&lt;String, Integer&gt; f3; List&lt;Bar&gt; f4; } RowEncoder&lt;Foo&gt; encoder = Encoders.bean(Foo.class); Foo foo = new Foo(); foo.f1 = 10; foo.f2 = IntStream.range(0, 1000000).boxed().collect(Collectors.toList()); foo.f3 = IntStream.range(0, 1000000).boxed().collect(Collectors.toMap(i -&gt; &quot;k&quot;+i, i -&gt; i)); List&lt;Bar&gt; bars = new ArrayList&lt;&gt;(1000000); for (int i = 0; i &lt; 1000000; i++) { Bar bar = new Bar(); bar.f1 = &quot;s&quot; + i; bar.f2 = LongStream.range(0, 10).boxed().collect(Collectors.toList()); bars.add(bar); } foo.f4 = bars; // Serialize to row format (can be zero-copy read by Python) BinaryRow binaryRow = encoder.toRow(foo); // Deserialize entire object Foo newFoo = encoder.fromRow(binaryRow); // Zero-copy access to nested fields without full deserialization BinaryArray binaryArray2 = binaryRow.getArray(1); // Access f2 field BinaryArray binaryArray4 = binaryRow.getArray(3); // Access f4 field BinaryRow barStruct = binaryArray4.getStruct(10); // Access 11th Bar element long value = barStruct.getArray(1).getInt64(5); // Access nested value // Partial deserialization RowEncoder&lt;Bar&gt; barEncoder = Encoders.bean(Bar.class); Bar newBar = barEncoder.fromRow(barStruct); Bar newBar2 = barEncoder.fromRow(binaryArray4.getStruct(20));   ","version":"0.13","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.13/start/usage#python","content":" from dataclasses import dataclass from typing import List, Dict import pyarrow as pa import pyfory @dataclass class Bar: f1: str f2: List[pa.int64] @dataclass class Foo: f1: pa.int32 f2: List[pa.int32] f3: Dict[str, pa.int32] f4: List[Bar] encoder = pyfory.encoder(Foo) foo = Foo( f1=10, f2=list(range(1000_000)), f3={f&quot;k{i}&quot;: i for i in range(1000_000)}, f4=[Bar(f1=f&quot;s{i}&quot;, f2=list(range(10))) for i in range(1000_000)] ) # Serialize to row format binary: bytes = encoder.to_row(foo).to_bytes() # Zero-copy random access without full deserialization foo_row = pyfory.RowData(encoder.schema, binary) print(foo_row.f2[100000]) # Access element directly print(foo_row.f4[100000].f1) # Access nested field print(foo_row.f4[200000].f2[5]) # Access deeply nested field   For more details on row format, see Row Format Guide. ","version":"0.13","tagName":"h3"},{"title":"Community","type":0,"sectionRef":"#","url":"/docs/0.14/community/","content":"","keywords":"","version":"0.14"},{"title":"Mailing list‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.14/community/#mailing-list","content":" Name\tDesc\tSubscribe\tUnsubscribe\tPost\tArchivedev@fory.apache.org\tDevelopment related discussions\tSubscribe\tUnsubscribe\tPost\tArchive commits@fory.apache.org\tAll commits to our repositories\tSubscribe\tUnsubscribe\tRead only list\tArchive  Please make sure subscribe to any list before attempting to post.  If you are not subscribed to the mailing list, your message will either be rejected or you won't receive the response.  ","version":"0.14","tagName":"h2"},{"title":"How to subscribe to a mailing list‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.14/community/#how-to-subscribe-to-a-mailing-list","content":" To post messages, subscribe first by:  Sending an email to listname-subscribe@fory.apache.org with listname replaced accordingly.Replying to the confirmation email you'll receive, keeping the subject line intact.You'll then get a welcome email, and the subscription succeeds.  When discussing code snippets in emails, ensure:  You do not link to files in external services, as such files can change, get deleted or the link might break and thus make an archived email thread useless.You paste text instead of screenshots of text.You keep formatting when pasting code in order to keep the code readable.There are enough import statements to avoid ambiguities.  ","version":"0.14","tagName":"h3"},{"title":"Slack‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.14/community/#slack","content":" You can join the Apache Fory‚Ñ¢ community on Slack.  There are a couple of community rules:  Be respectful and nice.All important decisions and conclusions must be reflected back to the mailing lists. &quot;If it didn't happen on a mailing list, it didn't happen.&quot; - The Apache Mottos.Use Slack threads to keep parallel conversations from overwhelming a channel.Please do not direct message people for troubleshooting, issue assigning and PR review. These should be picked-up voluntarily.  ","version":"0.14","tagName":"h2"},{"title":"Issue tracker‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.14/community/#issue-tracker","content":" We use GitHub Issues to track all issues:  code related issues: https://github.com/apache/fory/issueswebsite related issues: https://github.com/apache/fory-site/issues  You need to have a GitHub account in order to create issues. If you don't have a GitHub account, you can post an email to dev@fory.apache.org.  ","version":"0.14","tagName":"h2"},{"title":"Bug reports‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.14/community/#bug-reports","content":" To report a bug:  Verify that the bug does in fact exist.Search the issue tracker to verify there is no existing issue reporting the bug you've found.Create a bug report on issue tracker.If possible, dive into the source code of fory, and submit a patch for the bug you reported, this helps ensure the bug will be fixed quickly.  ","version":"0.14","tagName":"h3"},{"title":"Reporting a Vulnerability‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.14/community/#reporting-a-vulnerability","content":" Apache Fory‚Ñ¢ is a project of the Apache Software Foundation and follows the ASF vulnerability handling process.  To report a new vulnerability you have discovered please follow the ASF vulnerability reporting process, which explains how to send us details privately.  ","version":"0.14","tagName":"h3"},{"title":"Enhancement‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.14/community/#enhancement","content":" Enhancements or new feature proposals are also welcome. The more concrete and rationale the proposal is, the greater the chance it will be incorporated into future releases.  ","version":"0.14","tagName":"h3"},{"title":"Source code‚Äã","type":1,"pageTitle":"Community","url":"/docs/0.14/community/#source-code","content":" fory core repository: https://github.com/apache/foryfory website repository: https://github.com/apache/fory-site ","version":"0.14","tagName":"h2"},{"title":"How to join Apache Fory‚Ñ¢","type":0,"sectionRef":"#","url":"/docs/0.14/community/how_to_join_community","content":"","keywords":"","version":"0.14"},{"title":"Fory Contribution Guide‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.14/community/how_to_join_community#fory-contribution-guide","content":" The Fory team usually conducts development and issue maintenance on GitHub. Please open the GitHub website, click the Sign up button in the upper right corner, register your own account, and take the first step of your open source journey.  In the Fory repository, we have a guide for all open source contributors, introducing contents such as version management and branch management. Please take a few minutes to read and understand it.  ","version":"0.14","tagName":"h2"},{"title":"Your First Pull Request‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.14/community/how_to_join_community#your-first-pull-request","content":" ","version":"0.14","tagName":"h2"},{"title":"Step 0: Install Git‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.14/community/how_to_join_community#step-0-install-git","content":" Git is a version control system used to track and manage code changes in software development projects. It helps developers record and manage the history of the code, facilitating team collaboration, code version control, code merging, and other operations. With Git, you can track each version of each file and easily switch and compare between different versions. Git also provides branch management functionality, allowing multiple concurrent development tasks to be carried out simultaneously.  Visit the official Git website: [https://git-scm.com/] (https://git-scm.com/)Download the latest version of the Git installer.Run the downloaded installer and follow the prompts of the installation wizard to install.After the installation is complete, you can use the git version command in the command line to confirm the successful installation.  ","version":"0.14","tagName":"h3"},{"title":"Step 1: Fork the Project‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.14/community/how_to_join_community#step-1-fork-the-project","content":" First, you need to fork this project. Enter the Fory project page, and click the Fork button in the upper right corner.In your GitHub account, the project xxxx (your GitHub username)/fory will appear.On your local computer, use the following commands to obtain a fory folder:  // ssh git clone git@github.com:xxxx (your GitHub username)/fory.git // https git clone https://github.com/xxxx (your GitHub username)/fory.git   ","version":"0.14","tagName":"h3"},{"title":"Step 2: Obtain the Project Code‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.14/community/how_to_join_community#step-2-obtain-the-project-code","content":" Enter the fory folder and add the remote address of fory:  git remote add upstream https://github.com/apache/fory.git   ","version":"0.14","tagName":"h3"},{"title":"Step 3: Create a Branch‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.14/community/how_to_join_community#step-3-create-a-branch","content":" Alright, now you can start contributing our code. The default branch of Fory is the main branch. Whether it is for function development, bug fixes, or documentation writing, please create a new branch and then merge it to the main branch. Use the following code to create a branch:  // Create a function development branch git checkout -b feat/xxxx // Create a problem-fixing development branch git checkout -b fix/xxxx // Create a documentation, demo branch git checkout -b docs/add-java-demo   Suppose we have created the documentation modification branch docs/add-java-demo and we have added some code and submitted it to the code repository.  git add .git commit -a -m &quot;docs: add java demo and related docs&quot;  ","version":"0.14","tagName":"h3"},{"title":"Step 4: Merge the Modifications‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.14/community/how_to_join_community#step-4-merge-the-modifications","content":" Switch back to your development branch:  git checkout docs/add-java-demo   Submit the updated code to your branch:  git push origin docs/add-java-demo   ","version":"0.14","tagName":"h3"},{"title":"Step 5: Submit a Pull Request‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.14/community/how_to_join_community#step-5-submit-a-pull-request","content":" You can click the Compare &amp; pull request button on your GitHub code repository page. Or create it through the contribute button.  Fill in what type of modification this is.Fill in the associated issue.If there are complex changes, please explain the background and solution.  After filling in the relevant information, click Create pull request to submit.  ","version":"0.14","tagName":"h3"},{"title":"Easily Step into the Fory Open Source Contribution Journey‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.14/community/how_to_join_community#easily-step-into-the-fory-open-source-contribution-journey","content":" &quot;good first issue&quot; is a common label in the open source community, and the purpose of this label is to help new contributors find entry-level issues that are suitable for them.  The entry-level issues of Fory can be viewed through the issue list.  If you currently have the time and willingness to participate in community contributions, you can take a look at good first issue in the issues and select one that interests you and is suitable for you to claim.  ","version":"0.14","tagName":"h2"},{"title":"Embrace the Apache Fory‚Ñ¢ Community‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/0.14/community/how_to_join_community#embrace-the-apache-fory-community","content":" While you contribute code to Fory, we encourage you to participate in other things that make the community more prosperous, such as:  Offer suggestions for the project's development, functional planning, etc.Create articles, videos, and hold lectures to promote Fory.Write promotion plans and execute them together with the team. ","version":"0.14","tagName":"h2"},{"title":"How to verify","type":0,"sectionRef":"#","url":"/docs/0.14/community/how_to_verify","content":"","keywords":"","version":"0.14"},{"title":"Download the candidate version‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/0.14/community/how_to_verify#download-the-candidate-version","content":" #If there is svn locally, you can clone to the local svn co https://dist.apache.org/repos/dist/dev/fory/${release_version}-${rc_version}/ # You can download the material file directly wget https://dist.apache.org/repos/dist/dev/fory/${release_version}-${rc_version}/xxx.xxx   ","version":"0.14","tagName":"h2"},{"title":"Verify checksums and signatures‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/0.14/community/how_to_verify#verify-checksums-and-signatures","content":" First you need to install gpg:  apt-get install gnupg # or yum install gnupg # or brew install gnupg   Then import the Fory release manager's public key:  curl https://downloads.apache.org/fory/KEYS &gt; KEYS # Download KEYS gpg --import KEYS # Import KEYS to local # Then, trust the public key: gpg --edit-key &lt;KEY-used-in-this-version&gt; # Edit the key(mentioned in vote email) # It will enter the interactive mode, use the following command to trust the key: gpg (GnuPG) 2.0.22; Copyright (C) 2013 Free Software Foundation, Inc. This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. pub 4096R/5E580BA4 created: 2024-03-27 expires: never usage: SC trust: unknown validity: unknown sub 4096R/A31EF728 created: 2024-03-27 expires: never usage: E [ unknown] (1). chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; gpg&gt; trust pub 4096R/5E580BA4 created: 2024-03-27 expires: never usage: SC trust: unknown validity: unknown sub 4096R/A31EF728 created: 2024-03-27 expires: never usage: E [ unknown] (1). chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; Please decide how far you trust this user to correctly verify other users' keys (by looking at passports, checking fingerprints from different sources, etc.) 1 = I don't know or won't say 2 = I do NOT trust 3 = I trust marginally 4 = I trust fully 5 = I trust ultimately m = back to the main menu Your decision? 5 Do you really want to set this key to ultimate trust? (y/N) y pub 4096R/5E580BA4 created: 2024-03-27 expires: never usage: SC trust: ultimate validity: unknown sub 4096R/A31EF728 created: 2024-03-27 expires: never usage: E [ unknown] (1). chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; Please note that the shown key validity is not necessarily correct unless you restart the program.   Next verify signature:  for i in *.tar.gz; do echo $i; gpg --verify $i.asc $i; done   If something like the following appears, it means the signature is correct:  apache-fory-0.12.0-src.tar.gz gpg: Signature made Wed 17 Apr 2024 11:49:45 PM CST using RSA key ID 5E580BA4 gpg: checking the trustdb gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model gpg: depth: 0 valid: 1 signed: 0 trust: 0-, 0q, 0n, 0m, 0f, 1u gpg: Good signature from &quot;chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt;&quot;   Then verify checksum:  for i in *.tar.gz; do echo $i; sha512sum --check $i.sha512*; done   It should output something like:  apache-fory-0.12.0-src.tar.gz apache-fory-0.12.0-src.tar.gz: OK   A quick way to verify above is:  curl -s https://raw.githubusercontent.com/apache/fory/main/ci/release.py | python3 - verify -v 0.5.0   ","version":"0.14","tagName":"h2"},{"title":"Check the file content of the source package‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/0.14/community/how_to_verify#check-the-file-content-of-the-source-package","content":" Unzip apache-fory-${release_version}-${rc_version}-src.tar.gz and check the follows:  LICENSE and NOTICE files are correct for the repository.All files have ASF license headers if necessary.Building is OK.  ","version":"0.14","tagName":"h2"},{"title":"Check the Maven artifacts of fory-java‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/0.14/community/how_to_verify#check-the-maven-artifacts-of-fory-java","content":" Download the artifacts from https://repository.apache.org/content/repositories/orgapachefory-${maven_artifact_number}/.  You can check the follows:  Checksum of JARs match the bundled checksum file.Signature of JARs match the bundled signature file.JARs is reproducible locally. This means you can build the JARs on your machine and verify the checksum is the same with the bundled one. ","version":"0.14","tagName":"h2"},{"title":"C++ Serialization Guide","type":0,"sectionRef":"#","url":"/docs/0.14/guide/cpp/","content":"","keywords":"","version":"0.14"},{"title":"Why Apache Fory‚Ñ¢ C++?‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/0.14/guide/cpp/#why-apache-fory-c","content":" üî• Blazingly Fast: Fast serialization and optimized binary protocolsüåç Cross-Language: Seamlessly serialize/deserialize data across Java, Python, C++, Go, JavaScript, and RustüéØ Type-Safe: Compile-time type checking with macro-based struct registrationüîÑ Reference Tracking: Automatic tracking of shared and circular referencesüì¶ Schema Evolution: Compatible mode for independent schema changes‚ö° Two Formats: Object graph serialization and zero-copy row-based formatüßµ Thread Safety: Both single-threaded (fastest) and thread-safe variants  ","version":"0.14","tagName":"h2"},{"title":"Installation‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/0.14/guide/cpp/#installation","content":" The C++ implementation supports both CMake and Bazel build systems.  ","version":"0.14","tagName":"h2"},{"title":"Prerequisites‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/0.14/guide/cpp/#prerequisites","content":" CMake 3.16+ (for CMake build) or Bazel 8+ (for Bazel build)C++17 compatible compiler (GCC 7+, Clang 5+, MSVC 2017+)  ","version":"0.14","tagName":"h3"},{"title":"Using CMake (Recommended)‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/0.14/guide/cpp/#using-cmake-recommended","content":" The easiest way to use Fory is with CMake's FetchContent module:  cmake_minimum_required(VERSION 3.16) project(my_project LANGUAGES CXX) set(CMAKE_CXX_STANDARD 17) set(CMAKE_CXX_STANDARD_REQUIRED ON) include(FetchContent) FetchContent_Declare( fory GIT_REPOSITORY https://github.com/apache/fory.git GIT_TAG v0.14.1 SOURCE_SUBDIR cpp ) FetchContent_MakeAvailable(fory) add_executable(my_app main.cc) target_link_libraries(my_app PRIVATE fory::serialization)   Then build and run:  mkdir build &amp;&amp; cd build cmake .. -DCMAKE_BUILD_TYPE=Release cmake --build . --parallel ./my_app   ","version":"0.14","tagName":"h3"},{"title":"Using Bazel‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/0.14/guide/cpp/#using-bazel","content":" Create a MODULE.bazel file in your project root:  module( name = &quot;my_project&quot;, version = &quot;1.0.0&quot;, ) bazel_dep(name = &quot;rules_cc&quot;, version = &quot;0.1.1&quot;) bazel_dep(name = &quot;fory&quot;, version = &quot;0.14.1&quot;) git_override( module_name = &quot;fory&quot;, remote = &quot;https://github.com/apache/fory.git&quot;, commit = &quot;v0.14.1&quot;, # Or use a specific commit hash for reproducibility )   Create a BUILD file for your application:  cc_binary( name = &quot;my_app&quot;, srcs = [&quot;main.cc&quot;], deps = [&quot;@fory//cpp/fory/serialization:fory_serialization&quot;], )   Then build and run:  bazel build //:my_app bazel run //:my_app   For local development, you can use local_path_override instead:  bazel_dep(name = &quot;fory&quot;, version = &quot;0.14.1&quot;) local_path_override( module_name = &quot;fory&quot;, path = &quot;/path/to/fory&quot;, )   ","version":"0.14","tagName":"h3"},{"title":"Examples‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/0.14/guide/cpp/#examples","content":" See the examples/cpp directory for complete working examples:  hello_world - Object graph serializationhello_row - Row format encoding  ","version":"0.14","tagName":"h3"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/0.14/guide/cpp/#quick-start","content":" ","version":"0.14","tagName":"h2"},{"title":"Basic Example‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/0.14/guide/cpp/#basic-example","content":" #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; // Define a struct struct Person { std::string name; int32_t age; std::vector&lt;std::string&gt; hobbies; bool operator==(const Person &amp;other) const { return name == other.name &amp;&amp; age == other.age &amp;&amp; hobbies == other.hobbies; } }; // Register the struct with Fory (must be in the same namespace) FORY_STRUCT(Person, name, age, hobbies); int main() { // Create a Fory instance auto fory = Fory::builder() .xlang(true) // Enable cross-language mode .track_ref(false) // Disable reference tracking for simple types .build(); // Register the type with a unique ID fory.register_struct&lt;Person&gt;(1); // Create an object Person person{&quot;Alice&quot;, 30, {&quot;reading&quot;, &quot;coding&quot;}}; // Serialize auto result = fory.serialize(person); if (!result.ok()) { // Handle error return 1; } std::vector&lt;uint8_t&gt; bytes = std::move(result).value(); // Deserialize auto deser_result = fory.deserialize&lt;Person&gt;(bytes); if (!deser_result.ok()) { // Handle error return 1; } Person decoded = std::move(deser_result).value(); assert(person == decoded); return 0; }   ","version":"0.14","tagName":"h3"},{"title":"Thread Safety‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/0.14/guide/cpp/#thread-safety","content":" Apache Fory‚Ñ¢ C++ provides two variants for different threading needs:  ","version":"0.14","tagName":"h2"},{"title":"Single-Threaded (Fastest)‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/0.14/guide/cpp/#single-threaded-fastest","content":" // Single-threaded Fory - fastest, NOT thread-safe auto fory = Fory::builder() .xlang(true) .build();   ","version":"0.14","tagName":"h3"},{"title":"Thread-Safe‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/0.14/guide/cpp/#thread-safe","content":" // Thread-safe Fory - uses context pools auto fory = Fory::builder() .xlang(true) .build_thread_safe(); // Can be used from multiple threads safely std::thread t1([&amp;]() { auto result = fory.serialize(obj1); }); std::thread t2([&amp;]() { auto result = fory.serialize(obj2); });   Tip: Perform type registrations before spawning threads so every worker sees the same metadata.  ","version":"0.14","tagName":"h3"},{"title":"Use Cases‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/0.14/guide/cpp/#use-cases","content":" ","version":"0.14","tagName":"h2"},{"title":"Object Serialization‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/0.14/guide/cpp/#object-serialization","content":" Complex data structures with nested objects and referencesCross-language communication in microservicesGeneral-purpose serialization with full type safetySchema evolution with compatible mode  ","version":"0.14","tagName":"h3"},{"title":"Row-Based Serialization‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/0.14/guide/cpp/#row-based-serialization","content":" High-throughput data processingAnalytics workloads requiring fast field accessMemory-constrained environmentsZero-copy scenarios  ","version":"0.14","tagName":"h3"},{"title":"Next Steps‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/0.14/guide/cpp/#next-steps","content":" Configuration - Builder options and modesBasic Serialization - Object graph serializationSchema Evolution - Compatible mode and schema changesType Registration - Registering typesSupported Types - All supported typesCross-Language - XLANG modeRow Format - Zero-copy row-based format ","version":"0.14","tagName":"h2"},{"title":"How to release","type":0,"sectionRef":"#","url":"/docs/0.14/community/how_to_release","content":"","keywords":"","version":"0.14"},{"title":"Introduction‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.14/community/how_to_release#introduction","content":" Source Release is the most important part which Apache values.  Please pay more attention to license and signing issues. Publishing software is a serious thing and has legal consequences.  ","version":"0.14","tagName":"h2"},{"title":"First-time as a release manager‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.14/community/how_to_release#first-time-as-a-release-manager","content":" ","version":"0.14","tagName":"h2"},{"title":"Environmental requirements‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.14/community/how_to_release#environmental-requirements","content":" This release process is operated in the Ubuntu OS, and the following tools are required:  JDK 1.8Apache Maven 3.xPython 3.8GnuPG 2.xGitSVN (apache uses svn to host project releases)Pay attention to setting environment variables: if you configure gpg keys under a different directory, please export GNUPGHOME=$(xxx)  ","version":"0.14","tagName":"h3"},{"title":"Prepare GPG Key‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.14/community/how_to_release#prepare-gpg-key","content":" If you are the first to become a release manager, you need to prepare a gpg key.  Following is a quick setup, you can refer to Apache openpgp doc for further details.  Install GPG‚Äã  sudo apt install gnupg2   Generate GPG Key‚Äã  Please use your apache name and email for generate key  $ gpg --full-gen-key gpg (GnuPG) 2.2.20; Copyright (C) 2020 Free Software Foundation, Inc. This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. Please select what kind of key you want: (1) RSA and RSA (default) (2) DSA and Elgamal (3) DSA (sign only) (4) RSA (sign only) (14) Existing key from card Your selection? 1 # input 1 RSA keys may be between 1024 and 4096 bits long. What keysize do you want? (2048) 4096 # input 4096 Requested keysize is 4096 bits Please specify how long the key should be valid. 0 = key does not expire &lt;n&gt; = key expires in n days &lt;n&gt;w = key expires in n weeks &lt;n&gt;m = key expires in n months &lt;n&gt;y = key expires in n years Key is valid for? (0) 0 # input 0 Key does not expire at all Is this correct? (y/N) y # input y GnuPG needs to construct a user ID to identify your key. Real name: Chaokun Yang # input your name Email address: chaokunyang@apache.org # input your email Comment: CODE SIGNING KEY # input some annotations, optional You selected this USER-ID: &quot;Chaokun &lt;chaokunyang@apache.org&gt;&quot; Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? O # input O We need to generate a lot of random bytes. It is a good idea to perform some other action (type on the keyboard, move the mouse, utilize the disks) during the prime generation; this gives the random number generator a better chance to gain enough entropy. We need to generate a lot of random bytes. It is a good idea to perform some other action (type on the keyboard, move the mouse, utilize the disks) during the prime generation; this gives the random number generator a better chance to gain enough entropy. # Input the security key ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ Please enter this passphrase ‚îÇ ‚îÇ ‚îÇ ‚îÇ Passphrase: _______________________________ ‚îÇ ‚îÇ ‚îÇ ‚îÇ &lt;OK&gt; &lt;Cancel&gt; ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò # key generation will be done after your inputting the key with the following output gpg: key E49B00F626B marked as ultimately trusted gpg: revocation certificate stored as '/Users/chaokunyang/.gnupg/openpgp-revocs.d/1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4.rev' public and secret key created and signed. pub rsa4096 2022-07-12 [SC] 1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4 uid [ultimate] Chaokun &lt;chaokunyang@apache.org&gt; sub rsa4096 2022-07-12 [E]   Upload your public key to public GPG keyserver‚Äã  Firstly, list your key:  gpg --list-keys   The output is like:  -------------------------------------------------- pub rsa4096 2024-03-27 [SC] 1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4 uid [ultimate] chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; sub rsa4096 2024-03-27 [E]   Then, send your key id to key server:  gpg --keyserver keys.openpgp.org --send-key &lt;key-id&gt; # e.g., 1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4   Among them, keys.openpgp.org is a randomly selected keyserver, you can use keyserver.ubuntu.com or any other full-featured keyserver.  Check whether the key is created successfully‚Äã  Uploading takes about one minute; after that, you can check by email at the corresponding keyserver.  Uploading keys to the keyserver is mainly for joining a Web of Trust.  Add your GPG public key to the project KEYS file‚Äã  The svn repository of the release branch is: https://dist.apache.org/repos/dist/release/fory  Please add the public key to KEYS in the release branch:  svn co --depth=files https://dist.apache.org/repos/dist/release/fory fory-dist cd fory-dist (gpg --list-sigs YOUR_NAME@apache.org &amp;&amp; gpg --export --armor YOUR_NAME@apache.org) &gt;&gt; KEYS # Append your key to the KEYS file svn add . # It is not needed if the KEYS document exists before. svn ci -m &quot;add gpg key for YOUR_NAME&quot; # Later on, if you are asked to enter a username and password, just use your apache username and password.   Upload the GPG public key to your GitHub account‚Äã  Enter https://github.com/settings/keys to add your GPG key.Please remember to bind the email address used in the GPG key to your GitHub account (https://github.com/settings/emails) if you find &quot;unverified&quot; after adding it.  ","version":"0.14","tagName":"h3"},{"title":"Further reading‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.14/community/how_to_release#further-reading","content":" It's recommended but not mandatory to read following documents before making a release to know more details about apache release:  Release policy: https://www.apache.org/legal/release-policy.htmlTLP release: https://infra.apache.org/release-distributionRelease sign: https://infra.apache.org/release-signing.htmlRelease publish: https://infra.apache.org/release-publishing.htmlRelease download pages: https://infra.apache.org/release-download-pages.htmlPublishing maven artifacts: https://infra.apache.org/publishing-maven-artifacts.html  ","version":"0.14","tagName":"h3"},{"title":"Start discussion about the release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.14/community/how_to_release#start-discussion-about-the-release","content":" Start a discussion about the next release via sending email to: dev@fory.apache.org:  Title:  [DISCUSS] Release Apache Fory ${release_version}   Content:  Hello, Apache Fory Community, This is a call for a discussion to release Apache Fory version ${release_version}. The change lists about this release: https://github.com/apache/fory/compare/v0.12.0...v0.12.1-rc1 Please leave your comments here about this release plan. We will bump the version in repo and start the release process after the discussion. Thanks, ${name}   ","version":"0.14","tagName":"h2"},{"title":"Preparing for release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.14/community/how_to_release#preparing-for-release","content":" If the discussion goes positive, you will need to prepare the release artifiacts.  ","version":"0.14","tagName":"h2"},{"title":"Github branch and tag‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.14/community/how_to_release#github-branch-and-tag","content":" Create a new branch named releases-0.12.0Bump version to $version by executing command python ci/release.py bump_version -l all -version $versionMake a git commit and push the branch to git@github.com:apache/fory.gitCreate a new tag by git tag v0.12.0-rc1, then push it to git@github.com:apache/fory.git  ","version":"0.14","tagName":"h3"},{"title":"Build and upload artifacts to SVN dist/dev repo‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.14/community/how_to_release#build-and-upload-artifacts-to-svn-distdev-repo","content":" First you need to build source release artifacts by python ci/release.py build -v $version.  Then you need to upload it to svn dist repo. The dist repo of the dev branch is: https://dist.apache.org/repos/dist/dev/fory  # As this step will copy all the versions, it will take some time. If the network is broken, please use svn cleanup to delete the lock before re-execute it. svn co https://dist.apache.org/repos/dist/dev/fory fory-dist-dev   Then, upload the artifacts:  cd fory-dist-dev # create a directory named by version mkdir ${release_version}-${rc_version} # copy source code and signature package to the versioned directory cp ${repo_dir}/dist/* ${release_version}-${rc_version} # check svn status svn status # add to svn svn add ${release_version}-${rc_version} # check svn status svn status # commit to SVN remote server svn commit -m &quot;Prepare for fory ${release_version}-${rc_version}&quot;   Visit https://dist.apache.org/repos/dist/dev/fory/ to check the artifacts are uploaded correctly.  ","version":"0.14","tagName":"h3"},{"title":"What to do if something goes wrong‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.14/community/how_to_release#what-to-do-if-something-goes-wrong","content":" If some files are unexpected, you need to remove by svn delete and repeat the above upload process.  ","version":"0.14","tagName":"h3"},{"title":"Voting‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.14/community/how_to_release#voting","content":" ","version":"0.14","tagName":"h2"},{"title":"check version‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.14/community/how_to_release#check-version","content":" Fory requires votes from the Fory Community.  release_version: the version for fory, like 0.12.0.release_candidate_version: the version for voting, like 0.12.0-rc1.maven_artifact_number: the number for Maven staging artifacts, like 1001. Specifically, the maven_artifact_number can be found by searching &quot;fory&quot; on https://repository.apache.org/#stagingRepositories.  ","version":"0.14","tagName":"h3"},{"title":"Build the source code of fory and release it to nexus‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.14/community/how_to_release#build-the-source-code-of-fory-and-release-it-to-nexus","content":" Configure Apache Account Passwords‚Äã  Before publishing Fory to Nexus, you need to securely configure your Apache account credentials. This step is critical as passwords must be encrypted.  First, open your Maven global settings file settings.xml, typically located at ~/.m2/settings.xml. Add or modify the following section:   &lt;servers&gt; &lt;server&gt; &lt;id&gt;apache.snapshots.https&lt;/id&gt; &lt;username&gt;your-apache-username&lt;/username&gt; &lt;password&gt;{your-encrypted-password}&lt;/password&gt; &lt;/server&gt; &lt;server&gt; &lt;id&gt;apache.releases.https&lt;/id&gt; &lt;username&gt;your-apache-username&lt;/username&gt; &lt;password&gt;{your-encrypted-password}&lt;/password&gt; &lt;/server&gt; &lt;/servers&gt;   Important Notes:  Replace your-apache-username with your Apache LDAP usernamePasswords must be encrypted using Maven's password encryption toolEncrypted passwords should be enclosed in curly braces {}  Refer to the official documentation for detailed encryption instructions: Publishing Maven Artifacts  Steps to encrypt your password:  Generate a master password (if you haven't already): mvn --encrypt-master-password your-master-password Save the output to ~/.m2/settings-security.xml: &lt;settingsSecurity&gt; &lt;master&gt;{your-encrypted-master-password}&lt;/master&gt; &lt;/settingsSecurity&gt; Encrypt your Apache account password: mvn --encrypt-password your-apache-password Place the encrypted output into the password field in settings.xml  Build and Publish Java Module‚Äã   # Navigate to the Java module directory cd java # Execute Maven build and deploy to Nexus # -T10: Use 10 threads for parallel build, improving speed # clean: Clean the project # deploy: Deploy to remote repository # -Papache-release: Activate apache-release profile # -DskipTests: Skip tests # -Dgpg.skip=false: Enable GPG signing (required for release verification) mvn -T10 clean deploy -Papache-release -DskipTests -Dgpg.skip=false   Build and Publish Kotlin Module‚Äã   # Return to project root and navigate to Kotlin module cd ../kotlin # Execute the same Maven command as Java module # Configuration parameters are identical to Java module mvn -T10 clean deploy -Papache-release -DskipTests -Dgpg.skip=false   Build and Publish Scala Module‚Äã   # Return to project root and navigate to Scala module cd ../scala # Build and sign JARs for all Scala versions # +publishSigned: Execute publishSigned for all configured Scala versions echo &quot;Starting to build Scala JARs...&quot; sbt +publishSigned # Prepare for upload to Sonatype (Nexus) # sonatypePrepare: Prepare for Maven Central Repository release echo &quot;Starting upload preparation...&quot; sbt sonatypePrepare # Upload packaged JARs to Sonatype # sonatypeBundleUpload: Upload prepared bundles echo &quot;Starting JAR upload...&quot; sbt sonatypeBundleUpload echo &quot;Scala JAR deployment succeeded!&quot;   Lock the Release in Nexus‚Äã  After completing the publication of all modules, perform the following steps in Nexus:  Log in to the Apache Nexus repository management interfaceNavigate to the &quot;Snapshots&quot; or &quot;Releases&quot; repository (depending on your release type)Locate the latest Fory project versionExecute the &quot;Close&quot; operation to validate all uploaded artifactsAfter successful validation, execute the &quot;Release&quot; operation to finalize the deployment  These steps ensure all published artifacts are verified and correctly deployed to the public repository.  ","version":"0.14","tagName":"h3"},{"title":"build a Pre-release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.14/community/how_to_release#build-a-pre-release","content":" You need to build a Pre-release before voting, such as:https://github.com/apache/fory/releases/tag/v0.12.0-rc1  ","version":"0.14","tagName":"h3"},{"title":"Fory Community Vote‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.14/community/how_to_release#fory-community-vote","content":" you need send a email to Fory Community: dev@fory.apache.org:  Title:  [VOTE] Release Apache Fory v${release_version}-${rc_version}   Content:  Hello, Apache Fory Community: This is a call for vote to release Apache Fory version release-${release_version}-${rc_version}. Apache Fory - A blazingly fast multi-language serialization framework powered by JIT and zero-copy. The discussion thread: https://lists.apache.org/thread/xxr3od301g6v3ndj14zqc05byp9qvclh The change lists about this release: https://github.com/apache/fory/compare/v0.12.0...v0.12.1-rc1 The release candidates: https://dist.apache.org/repos/dist/dev/fory/0.5.0-rc3/ The maven staging for this release: https://repository.apache.org/content/repositories/orgapachefory-1003 Git tag for the release: https://github.com/apache/fory/releases/tag/v0.12.0-rc1 Git commit for the release: https://github.com/apache/fory/commit/fae06330edd049bb960536e978a45b97bca66faf The artifacts signed with PGP key [5E580BA4], corresponding to [chaokunyang@apache.org], that can be found in keys file: https://downloads.apache.org/fory/KEYS The vote will be open for at least 72 hours until the necessary number of votes are reached. Please vote accordingly: [ ] +1 approve [ ] +0 no opinion [ ] -1 disapprove with the reason To learn more about Fory, please see https://fory.apache.org/ *Valid check is a requirement for a vote. *Checklist for reference: [ ] Download Fory is valid. [ ] Checksums and PGP signatures are valid. [ ] Source code distributions have correct names matching the current release. [ ] LICENSE and NOTICE files are correct. [ ] All files have license headers if necessary. [ ] No compiled archives bundled in source archive. [ ] Can compile from source. How to Build and Test, please refer to: https://github.com/apache/fory/blob/main/docs/guide/DEVELOPMENT.md Thanks, ${name}   After at least 3 +1 binding vote (from Fory Podling PMC member and committers) and no veto, first, reply to the above voting thread to notify that the voting has ended.  Hi all, The vote for Release Apache Fory v${release_version}-${rc_version} is closed now. Thanks to everyone for helping checking and voting for the release. I will close the vote later in another thread. Best, ${name}   Immediately afterward, launch a new voting thread to claim the voting results.  Title:  [RESULT][VOTE] Release Apache Fory v${release_version}-${rc_version}   Content:  Hello, Apache Fory Community, The vote to release Apache Fory v${release_version}-${rc_version} has passed. The vote PASSED with 3 binding +1 and 0 -1 vote: Binding votes: - xxx - yyy - zzz Vote thread: ${vote_thread_url} Thanks, ${name}   ","version":"0.14","tagName":"h3"},{"title":"What if vote fail‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.14/community/how_to_release#what-if-vote-fail","content":" If the vote failed, click &quot;Drop&quot; to drop the staging Maven artifacts.  Address the raised issues, then bump rc_version and file a new vote again.  ","version":"0.14","tagName":"h3"},{"title":"Official Release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.14/community/how_to_release#official-release","content":" ","version":"0.14","tagName":"h2"},{"title":"Publish artifacts to SVN Release Directory‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.14/community/how_to_release#publish-artifacts-to-svn-release-directory","content":" release_version: the release version for fory, like 0.5.0release_candidate_version: the version for voting, like 0.5.0-rc1  svn mv https://dist.apache.org/repos/dist/dev/fory/${release_version}-${rc_version} https://dist.apache.org/repos/dist/release/fory/${release_version} -m &quot;Release fory ${release_version}&quot;   In the repository at https://dist.apache.org/repos/dist/dev/fory/, if any outdated release_candidate_version are left behind when releasing the release_version, please clear them to keep the dev repository tidy.  When https://archive.apache.org/dist/fory/0.12.0/${release_version} is accessible (confirming that the release_version has been successfully released and archived), we may clean up the previous release version in the release repository, leaving only the current version.  ","version":"0.14","tagName":"h3"},{"title":"Update Fory&Fory-Site content‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.14/community/how_to_release#update-foryfory-site-content","content":" Submit a PR to https://github.com/apache/fory-site to update Fory-site. Reference implementation: #283and #285.  Update Fory-Site‚Äã  In general, the following two key areas need to be modified:  Write a new announcement, for example: Add a new markdown file under the blog folder:  The Apache Fory team is pleased to announce the [?] release. This is a major release that includes [? PR](https://github.com/apache/fory/compare/v[?]...v[?]) from ? distinct contributors. See the [Install](https://fory.apache.org/docs/start/install) Page to learn how to get the libraries for your platform.   Replace versions by upgrading old versions to new ones. For example, in install section, it is necessary to update the documentation for both the development branch and the latest release branch::  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-core&lt;/artifactId&gt; &lt;version&gt;0.11.2&lt;/version&gt; &lt;/dependency&gt;   Update Fory‚Äã  Submit a PR to https://github.com/apache/fury to update README, like #2207.  ","version":"0.14","tagName":"h3"},{"title":"Github officially released‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.14/community/how_to_release#github-officially-released","content":" You need to officially release this version in the Fory project Reference implementation: https://github.com/apache/fory/releases/tag/v0.12.0  ","version":"0.14","tagName":"h3"},{"title":"Release Maven artifacts‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.14/community/how_to_release#release-maven-artifacts","content":" maven_artifact_number: the number for Maven staging artifacts, like 1001.Open https://repository.apache.org/#stagingRepositories.Find the artifact orgapachefory-${maven_artifact_number}, click &quot;Release&quot;.  ","version":"0.14","tagName":"h3"},{"title":"Send the announcement‚Äã","type":1,"pageTitle":"How to release","url":"/docs/0.14/community/how_to_release#send-the-announcement","content":" Send the release announcement to dev@fory.apache.org and CC announce@apache.org.  Title:  [ANNOUNCE] Apache Fory ${release_version} released   Content:  Hi all, The Apache Fory community is pleased to announce that Apache Fory {release_version} has been released! Apache Fory - A blazingly fast multi-language serialization framework powered by JIT and zero-copy. The release notes are available here: https://github.com/apache/fory/releases/tag/v${release_version} For the complete list of changes: https://github.com/apache/fory/compare/v0.12.0...v${release_version} Apache Fory website: https://fory.apache.org/ Download Links: https://fory.apache.org/download Fory Resources: - Fory github repo: https://github.com/apache/fory - Issue: https://github.com/apache/fory/issues - Mailing list: dev@fory.apache.org We are looking to grow our community and welcome new contributors. If you are interested in contributing to Fory, please contact us on the mailing list or on GitHub. We will be happy to help you get started. ------------------ Best Regards, ${your_name}   Remember to use plain text instead of rich text format, or you may be rejected when CC announce@apache.org  After completing the above steps, the Fory release process comes to an end. ","version":"0.14","tagName":"h3"},{"title":"Java Serialization Guide","type":0,"sectionRef":"#","url":"/docs/0.13/guide/serialization","content":"","keywords":"","version":"0.13"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#quick-start","content":" Note that fory creation is not cheap, the fory instances should be reused between serializations instead of creating it everytime. You should keep fory to a static global variable, or instance variable of some singleton object or limited objects.  Fory for single-thread usage:  import java.util.List; import java.util.Arrays; import org.apache.fory.*; import org.apache.fory.config.*; public class Example { public static void main(String[] args) { SomeClass object = new SomeClass(); // Note that Fory instances should be reused between // multiple serializations of different objects. Fory fory = Fory.builder().withLanguage(Language.JAVA) .requireClassRegistration(true) .build(); // Registering types can reduce class name serialization overhead, but not mandatory. // If class registration enabled, all custom types must be registered. // Registration order must be consistent if id is not specified fory.register(SomeClass.class); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes)); } }   Fory for multiple-thread usage:  import java.util.List; import java.util.Arrays; import org.apache.fory.*; import org.apache.fory.config.*; public class Example { public static void main(String[] args) { SomeClass object = new SomeClass(); // Note that Fory instances should be reused between // multiple serializations of different objects. ThreadSafeFory fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().withLanguage(Language.JAVA) .withClassLoader(classLoader).build(); f.register(SomeClass.class); return f; }); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes)); } }   Fory instances reuse example:  import java.util.List; import java.util.Arrays; import org.apache.fory.*; import org.apache.fory.config.*; public class Example { // reuse fory. private static final ThreadSafeFory fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().withLanguage(Language.JAVA) .withClassLoader(classLoader).build(); f.register(SomeClass.class); return f; }); public static void main(String[] args) { SomeClass object = new SomeClass(); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes)); } }   ","version":"0.13","tagName":"h2"},{"title":"ForyBuilder options‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#forybuilder-options","content":" Option Name\tDescription\tDefault ValuetimeRefIgnored\tWhether to ignore reference tracking of all time types registered in TimeSerializers and subclasses of those types when ref tracking is enabled. If ignored, ref tracking of every time type can be enabled by invoking Fory#registerSerializer(Class, Serializer). For example, fory.registerSerializer(Date.class, new DateSerializer(fory, true)). Note that enabling ref tracking should happen before serializer codegen of any types which contain time fields. Otherwise, those fields will still skip ref tracking.\ttrue compressInt\tEnables or disables int compression for smaller size.\ttrue compressLong\tEnables or disables long compression for smaller size.\ttrue compressIntArray\tEnables or disables SIMD-accelerated compression for int arrays when values can fit in smaller data types. Requires Java 16+.\ttrue compressLongArray\tEnables or disables SIMD-accelerated compression for long arrays when values can fit in smaller data types. Requires Java 16+.\ttrue compressString\tEnables or disables string compression for smaller size.\tfalse classLoader\tThe classloader should not be updated; Fory caches class metadata. Use LoaderBinding or ThreadSafeFory for classloader updates.\tThread.currentThread().getContextClassLoader() compatibleMode\tType forward/backward compatibility config. Also Related to checkClassVersion config. SCHEMA_CONSISTENT: Class schema must be consistent between serialization peer and deserialization peer. COMPATIBLE: Class schema can be different between serialization peer and deserialization peer. They can add/delete fields independently. See more.\tCompatibleMode.SCHEMA_CONSISTENT checkClassVersion\tDetermines whether to check the consistency of the class schema. If enabled, Fory checks, writes, and checks consistency using the classVersionHash. It will be automatically disabled when CompatibleMode#COMPATIBLE is enabled. Disabling is not recommended unless you can ensure the class won't evolve.\tfalse checkJdkClassSerializable\tEnables or disables checking of Serializable interface for classes under java.*. If a class under java.* is not Serializable, Fory will throw an UnsupportedOperationException.\ttrue registerGuavaTypes\tWhether to pre-register Guava types such as RegularImmutableMap/RegularImmutableList. These types are not public API, but seem pretty stable.\ttrue requireClassRegistration\tDisabling may allow unknown classes to be deserialized, potentially causing security risks.\ttrue maxDepth\tSet max depth for deserialization, when depth exceeds, an exception will be thrown. This can be used to refuse deserialization DDOS attack.\t50 suppressClassRegistrationWarnings\tWhether to suppress class registration warnings. The warnings can be used for security audit, but may be annoying, this suppression will be enabled by default.\ttrue metaShareEnabled\tEnables or disables meta share mode.\ttrue if CompatibleMode.Compatible is set, otherwise false. scopedMetaShareEnabled\tScoped meta share focuses on a single serialization process. Metadata created or identified during this process is exclusive to it and is not shared with by other serializations.\ttrue if CompatibleMode.Compatible is set, otherwise false. metaCompressor\tSet a compressor for meta compression. Note that the passed MetaCompressor should be thread-safe. By default, a Deflater based compressor DeflaterMetaCompressor will be used. Users can pass other compressor such as zstd for better compression rate.\tDeflaterMetaCompressor deserializeNonexistentClass\tEnables or disables deserialization/skipping of data for non-existent classes.\ttrue if CompatibleMode.Compatible is set, otherwise false. codeGenEnabled\tDisabling may result in faster initial serialization but slower subsequent serializations.\ttrue asyncCompilationEnabled\tIf enabled, serialization uses interpreter mode first and switches to JIT serialization after async serializer JIT for a class is finished.\tfalse scalaOptimizationEnabled\tEnables or disables Scala-specific serialization optimization.\tfalse copyRef\tWhen disabled, the copy performance will be better. But fory deep copy will ignore circular and shared reference. Same reference of an object graph will be copied into different objects in one Fory#copy.\ttrue serializeEnumByName\tWhen Enabled, fory serialize enum by name instead of ordinal.\tfalse  ","version":"0.13","tagName":"h2"},{"title":"Advanced Usage‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#advanced-usage","content":" ","version":"0.13","tagName":"h2"},{"title":"Fory creation‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#fory-creation","content":" Single thread fory:  Fory fory = Fory.builder() .withLanguage(Language.JAVA) // enable reference tracking for shared/circular reference. // Disable it will have better performance if no duplicate reference. .withRefTracking(false) .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT) // enable type forward/backward compatibility // disable it for small size and better performance. // .withCompatibleMode(CompatibleMode.COMPATIBLE) // enable async multi-threaded compilation. .withAsyncCompilation(true) .build(); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes));   Thread-safe fory:  ThreadSafeFory fory = Fory.builder() .withLanguage(Language.JAVA) // enable reference tracking for shared/circular reference. // Disable it will have better performance if no duplicate reference. .withRefTracking(false) // compress int for smaller size // .withIntCompressed(true) // compress long for smaller size // .withLongCompressed(true) .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT) // enable type forward/backward compatibility // disable it for small size and better performance. // .withCompatibleMode(CompatibleMode.COMPATIBLE) // enable async multi-threaded compilation. .withAsyncCompilation(true) .buildThreadSafeFory(); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes));   Note that calling buildThreadSafeFory() on ForyBuilder will create an instance of ThreadLocalFory. This may not be appropriate in environments where virtual threads are used, as each thread will create its own fory instance, a relatively expensive operation. An alternative for virtual threads is to use buildThreadSafeForyPool.  ","version":"0.13","tagName":"h3"},{"title":"Handling Class Schema Evolution in Serialization‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#handling-class-schema-evolution-in-serialization","content":" In many systems, the schema of a class used for serialization may change over time. For instance, fields within a class may be added or removed. When serialization and deserialization processes use different versions of jars, the schema of the class being deserialized may differ from the one used during serialization.  By default, Fory serializes objects using the CompatibleMode.SCHEMA_CONSISTENT mode. This mode assumes that the deserialization process uses the same class schema as the serialization process, minimizing payload overhead. However, if there is a schema inconsistency, deserialization will fail.  If the schema is expected to change, to make deserialization succeed, i.e. schema forward/backward compatibility. Users must configure Fory to use CompatibleMode.COMPATIBLE. This can be done using theForyBuilder#withCompatibleMode(CompatibleMode.COMPATIBLE) method. In this compatible mode, deserialization can handle schema changes such as missing or extra fields, allowing it to succeed even when the serialization and deserialization processes have different class schemas.  Here is an example of creating Fory to support schema evolution:  Fory fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .build(); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes));   This compatible mode involves serializing class metadata into the serialized output. Despite Fory's use of sophisticated compression techniques to minimize overhead, there is still some additional space cost associated with class metadata.  To further reduce metadata costs, Fory introduces a class metadata sharing mechanism, which allows the metadata to be sent to the deserialization process only once. For more details, please refer to the Meta Sharing specification.  ","version":"0.13","tagName":"h3"},{"title":"Compression‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#compression","content":" ForyBuilder#withIntCompressed/ForyBuilder#withLongCompressed can be used to compress int/long for smaller size. Normally compress int is enough.  Both compression are enabled by default, if the serialized is not important, for example, you use flatbuffers for serialization before, which doesn't compress anything, then you should disable compression. If your data are all numbers, the compression may bring 80% performance regression.  For int compression, fory use 1~5 bytes for encoding. First bit in every byte indicate whether has next byte. if first bit is set, then next byte will be read util first bit of next byte is unset.  For long compression, fory support two encoding:  Fory SLI(Small long as int) Encoding (used by default): If long is in [-1073741824, 1073741823], encode as 4 bytes int: | little-endian: ((int) value) &lt;&lt; 1 |Otherwise write as 9 bytes: | 0b1 | little-endian 8bytes long | Fory PVL(Progressive Variable-length Long) Encoding: First bit in every byte indicate whether has next byte. if first bit is set, then next byte will be read util first bit of next byte is unset.Negative number will be converted to positive number by (v &lt;&lt; 1) ^ (v &gt;&gt; 63) to reduce cost of small negative numbers.  If a number are long type, it can't be represented by smaller bytes mostly, the compression won't get good enough result, not worthy compared to performance cost. Maybe you should try to disable long compression if you find it didn't bring much space savings.  ","version":"0.13","tagName":"h3"},{"title":"Array Compression‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#array-compression","content":" Fory supports SIMD-accelerated compression for primitive arrays (int[] and long[]) when array values can fit in smaller data types. This feature is available on Java 16+ and uses the Vector API for optimal performance.  How Array Compression Works‚Äã  Array compression analyzes arrays to determine if values can be stored using fewer bytes:  int[] ‚Üí byte[]: When all values are in range [-128, 127] (75% size reduction)int[] ‚Üí short[]: When all values are in range [-32768, 32767] (50% size reduction)long[] ‚Üí int[]: When all values fit in integer range (50% size reduction)  Configuration and Registration‚Äã  To enable array compression you must explicitly register the serializers:  Fory fory = Fory.builder() .withLanguage(Language.JAVA) // Enable int array compression .withIntArrayCompressed(true) // Enable long array compression .withLongArrayCompressed(true) .build(); // You must explicitly register compressed array serializers CompressedArraySerializers.registerSerializers(fory);   Note: The fory-simd module must be included in your dependencies for compressed array serializers to be available.  For Maven:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-simd&lt;/artifactId&gt; &lt;version&gt;0.13.2&lt;/version&gt; &lt;/dependency&gt;   ","version":"0.13","tagName":"h3"},{"title":"Object deep copy‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#object-deep-copy","content":" Deep copy example:  Fory fory = Fory.builder().withRefCopy(true).build(); SomeClass a = xxx; SomeClass copied = fory.copy(a);   Make fory deep copy ignore circular and shared reference, this deep copy mode will ignore circular and shared reference. Same reference of an object graph will be copied into different objects in one Fory#copy.  Fory fory = Fory.builder().withRefCopy(false).build(); SomeClass a = xxx; SomeClass copied = fory.copy(a);   ","version":"0.13","tagName":"h3"},{"title":"Cross-Language Serialization‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#cross-language-serialization","content":" Apache Fory‚Ñ¢ supports seamless data exchange between Java and other languages (Python, Rust, Go, JavaScript, etc.) through the xlang serialization format. This enables multi-language microservices, polyglot data pipelines, and cross-platform data sharing.  Enable Cross-Language Mode‚Äã  To serialize data for consumption by other languages, use Language.XLANG mode:  import org.apache.fory.*; import org.apache.fory.config.*; // Create Fory instance with XLANG mode Fory fory = Fory.builder() .withLanguage(Language.XLANG) .withRefTracking(true) // Enable reference tracking for complex graphs .build();   Register Types for Cross-Language Compatibility‚Äã  Types must be registered with consistent IDs or names across all languages. Fory supports two registration methods:  1. Register by ID (Recommended for Performance)  public record Person(String name, int age) {} // Register with numeric ID - faster and more compact fory.register(Person.class, 1); Person person = new Person(&quot;Alice&quot;, 30); byte[] bytes = fory.serialize(person); // bytes can be deserialized by Python, Rust, Go, etc.   Benefits: Faster serialization, smaller binary sizeTrade-offs: Requires coordination to avoid ID conflicts across teams/services  2. Register by Name (Recommended for Flexibility)  public record Person(String name, int age) {} // Register with string name - more flexible fory.register(Person.class, &quot;example.Person&quot;); Person person = new Person(&quot;Alice&quot;, 30); byte[] bytes = fory.serialize(person); // bytes can be deserialized by Python, Rust, Go, etc.   Benefits: Less prone to conflicts, easier management across teams, no coordination neededTrade-offs: Slightly larger binary size due to string encoding  Cross-Language Example: Java ‚Üî Python‚Äã  Java (Serializer)  import org.apache.fory.*; import org.apache.fory.config.*; public record Person(String name, int age) {} public class Example { public static void main(String[] args) { Fory fory = Fory.builder() .withLanguage(Language.XLANG) .withRefTracking(true) .build(); // Register with consistent name fory.register(Person.class, &quot;example.Person&quot;); Person person = new Person(&quot;Bob&quot;, 25); byte[] bytes = fory.serialize(person); // Send bytes to Python service via network/file/queue } }   Python (Deserializer)  import pyfory from dataclasses import dataclass @dataclass class Person: name: str age: pyfory.int32 # Create Fory in xlang mode fory = pyfory.Fory(ref_tracking=True) # Register with the SAME name as Java fory.register_type(Person, typename=&quot;example.Person&quot;) # Deserialize bytes from Java person = fory.deserialize(bytes_from_java) print(f&quot;{person.name}, {person.age}&quot;) # Output: Bob, 25   Handling Circular and Shared References‚Äã  Cross-language mode supports circular and shared references when reference tracking is enabled:  public class Node { public String value; public Node next; public Node parent; } Fory fory = Fory.builder() .withLanguage(Language.XLANG) .withRefTracking(true) // Required for circular references .build(); fory.register(Node.class, &quot;example.Node&quot;); // Create circular reference Node node1 = new Node(); node1.value = &quot;A&quot;; Node node2 = new Node(); node2.value = &quot;B&quot;; node1.next = node2; node2.parent = node1; // Circular reference byte[] bytes = fory.serialize(node1); // Python/Rust/Go can correctly deserialize this with circular references preserved   Type Mapping Considerations‚Äã  Not all Java types have equivalents in other languages. When using xlang mode:  Use primitive types (int, long, double, String) for maximum compatibilityUse standard collections (List, Map, Set) instead of language-specific onesAvoid Java-specific types like Optional, BigDecimal (unless the target language supports them)See Type Mapping Guide for complete compatibility matrix  Compatible Types:  public record UserData( String name, // ‚úÖ Compatible int age, // ‚úÖ Compatible List&lt;String&gt; tags, // ‚úÖ Compatible Map&lt;String, Integer&gt; scores // ‚úÖ Compatible ) {}   Problematic Types:  public record UserData( Optional&lt;String&gt; name, // ‚ùå Not cross-language compatible BigDecimal balance, // ‚ùå Limited support EnumSet&lt;Status&gt; statuses // ‚ùå Java-specific collection ) {}   Performance Considerations‚Äã  Cross-language mode has additional overhead compared to Java-only mode:  Type metadata encoding: Adds extra bytes per typeType resolution: Requires name/ID lookup during deserialization  For best performance:  Use ID-based registration when possible (smaller encoding)Disable reference tracking if you don't need circular references (withRefTracking(false))Use Java mode (Language.JAVA) when only Java serialization is needed  Cross-Language Best Practices‚Äã  Consistent Registration: Ensure all services register types with identical IDs/namesVersion Compatibility: Use compatible mode for schema evolution across services  Troubleshooting Cross-Language Serialization‚Äã  &quot;Type not registered&quot; errors:  Verify type is registered with same ID/name on both sidesCheck if type name has typos or case differences  &quot;Type mismatch&quot; errors:  Ensure field types are compatible across languagesReview Type Mapping Guide  Data corruption or unexpected values:  Verify both sides use Language.XLANG modeEnsure both sides have compatible Fory versions  See Also:  Cross-Language Serialization SpecificationType Mapping ReferencePython Cross-Language GuideRust Cross-Language Guide  ","version":"0.13","tagName":"h3"},{"title":"Implement a customized serializer‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#implement-a-customized-serializer","content":" In some cases, you may want to implement a serializer for your type, especially some class customize serialization by JDK writeObject/writeReplace/readObject/readResolve, which is very inefficient. For example, if you don't want following Foo#writeObject got invoked, you can take following FooSerializer as an example:  class Foo { public long f1; private void writeObject(ObjectOutputStream s) throws IOException { System.out.println(f1); s.defaultWriteObject(); } } class FooSerializer extends Serializer&lt;Foo&gt; { public FooSerializer(Fory fory) { super(fory, Foo.class); } @Override public void write(MemoryBuffer buffer, Foo value) { buffer.writeInt64(value.f1); } @Override public Foo read(MemoryBuffer buffer) { Foo foo = new Foo(); foo.f1 = buffer.readInt64(); return foo; } }   Register serializer:  Fory fory = getFory(); fory.registerSerializer(Foo.class, new FooSerializer(fory));   ","version":"0.13","tagName":"h3"},{"title":"Implement Collection Serializer‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#implement-collection-serializer","content":" Similar to maps, when implementing a serializer for a custom Collection type, you must extend CollectionSerializer or CollectionLikeSerializer. The key difference between these two is that CollectionLikeSerializer can serialize a class which has a collection-like structure but is not a java Collection subtype.  For collection serializer, this is a special parameter supportCodegenHook needs be configured:  When true: Enables optimized access to collection elements and JIT compilation for better performanceDirect serialization invocation and inline for map key-value items without dynamic serializer dispatch cost.Better performance for standard collection typesRecommended for most collections When false: Uses interfaced-based element access and dynamic serializer dispatch for elements, which have higher costMore flexible for custom collection typesRequired when collection has special serialization needsHandles complex collection implementations  Implement Collection Serializer with JIT support‚Äã  When implementing a Collection serializer with JIT support, you can leverage Fory's existing binary format and collection serialization infrastructure. The key is to properly implement the onCollectionWrite and newCollection methods to handle metadata while letting Fory handle the element serialization.  Here's an example:  public class CustomCollectionSerializer&lt;T extends Collection&gt; extends CollectionSerializer&lt;T&gt; { public CustomCollectionSerializer(Fory fory, Class&lt;T&gt; cls) { // supportCodegenHook controls whether to use JIT compilation super(fory, cls, true); } @Override public Collection onCollectionWrite(MemoryBuffer buffer, T value) { // Write collection size buffer.writeVarUint32Small7(value.size()); // Write any additional collection metadata return value; } @Override public Collection newCollection(MemoryBuffer buffer) { // Create new collection instance Collection collection = super.newCollection(buffer); // Read and set collection size int numElements = getAndClearNumElements(); setNumElements(numElements); return collection; } }   Note that please invoke setNumElements when implementing newCollection to let fory know how many elements to deserialize.  Implement a totally-customzied Collection Serializer without JIT‚Äã  Sometimes you need to serialize a collection type that uses primitive arrays or has special requirements. In such cases, you can implement a serializer with JIT disabled and directly override the write and read methods.  This approach:  Gives you full control over serializationWorks well with primitive arraysBypasses collection iteration overheadAllows direct memory access  Here's an example of a custom integer list backed by a primitive array:  class IntList extends AbstractCollection&lt;Integer&gt; { private final int[] elements; private final int size; public IntList(int size) { this.elements = new int[size]; this.size = size; } public IntList(int[] elements, int size) { this.elements = elements; this.size = size; } @Override public Iterator&lt;Integer&gt; iterator() { return new Iterator&lt;Integer&gt;() { private int index = 0; @Override public boolean hasNext() { return index &lt; size; } @Override public Integer next() { if (!hasNext()) { throw new NoSuchElementException(); } return elements[index++]; } }; } @Override public int size() { return size; } public int get(int index) { if (index &gt;= size) { throw new IndexOutOfBoundsException(); } return elements[index]; } public void set(int index, int value) { if (index &gt;= size) { throw new IndexOutOfBoundsException(); } elements[index] = value; } public int[] getElements() { return elements; } } class IntListSerializer extends CollectionLikeSerializer&lt;IntList&gt; { public IntListSerializer(Fory fory) { // Disable JIT since we're handling serialization directly super(fory, IntList.class, false); } @Override public void write(MemoryBuffer buffer, IntList value) { // Write size buffer.writeVarUint32Small7(value.size()); // Write elements directly as primitive ints int[] elements = value.getElements(); for (int i = 0; i &lt; value.size(); i++) { buffer.writeVarInt32(elements[i]); } } @Override public IntList read(MemoryBuffer buffer) { // Read size int size = buffer.readVarUint32Small7(); // Create array and read elements int[] elements = new int[size]; for (int i = 0; i &lt; size; i++) { elements[i] = buffer.readVarInt32(); } return new IntList(elements, size); } // These methods are not used when JIT is disabled @Override public Collection onCollectionWrite(MemoryBuffer buffer, IntList value) { throw new UnsupportedOperationException(); } @Override public Collection newCollection(MemoryBuffer buffer) { throw new UnsupportedOperationException(); } @Override public IntList onCollectionRead(Collection collection) { throw new UnsupportedOperationException(); } }   Key Points:  Primitive Array Storage: Uses int[] for direct storageAvoids boxing/unboxing overheadProvides efficient memory layoutEnables direct array access Direct Serialization: Write size firstWrite primitive values directlyNo iteration overheadNo boxing/unboxing during serialization Direct Deserialization: Read size firstCreate primitive arrayRead values directly into arrayCreate list with populated array Disabled JIT: Set supportCodegenHook=falseOverride write/read methodsSkip collection view patternFull control over serialization format  When to Use: this approach is best when:  Working with primitive typesNeed maximum performanceWant to minimize memory overheadHave special serialization requirements  Usage Example:  // Create and populate list IntList list = new IntList(3); list.set(0, 1); list.set(1, 2); list.set(2, 3); // Serialize byte[] bytes = fory.serialize(list); // Deserialize IntList newList = (IntList) fory.deserialize(bytes);   This implementation is particularly efficient for scenarios where:  You're working exclusively with integersPerformance is criticalMemory efficiency is importantSerialization overhead needs to be minimized  Remember that while this approach gives up some of Fory's optimizations, it can provide better performance for specific use cases involving primitive types and direct array access.  Implement Serializer for Collection-like Types‚Äã  Sometimes you may want to implement a serializer for a type that behaves like a collection but isn't a standard Java Collection. This section demonstrates how to implement a serializer for such types.  The key principles for collection-like type serialization are:  Extend CollectionLikeSerializer for custom collection-like typesEnable JIT optimization with supportCodegenHookProvide efficient element access through viewsMaintain proper size tracking  Here's an example:  class CustomCollectionLike { private final Object[] elements; private final int size; public CustomCollectionLike(int size) { this.elements = new Object[size]; this.size = size; } // Constructor for wrapping existing array public CustomCollectionLike(Object[] elements, int size) { this.elements = elements; this.size = size; } public Object get(int index) { if (index &gt;= size) { throw new IndexOutOfBoundsException(); } return elements[index]; } public int size() { return size; } public Object[] getElements() { return elements; } } // A view class that extends AbstractCollection for simpler implementation class CollectionView extends AbstractCollection&lt;Object&gt; { private final Object[] elements; private final int size; private int writeIndex; // Constructor for serialization (wrapping existing array) public CollectionView(CustomCollectionLike collection) { this.elements = collection.getElements(); this.size = collection.size(); } // Constructor for deserialization public CollectionView(int size) { this.size = size; this.elements = new Object[size]; } @Override public Iterator&lt;Object&gt; iterator() { return new Iterator&lt;Object&gt;() { private int index = 0; @Override public boolean hasNext() { return index &lt; size; } @Override public Object next() { if (!hasNext()) { throw new NoSuchElementException(); } return elements[index++]; } }; } @Override public boolean add(Object element) { if (writeIndex &gt;= size) { throw new IllegalStateException(&quot;Collection is full&quot;); } elements[writeIndex++] = element; return true; } @Override public int size() { return size; } public Object[] getElements() { return elements; } } class CustomCollectionSerializer extends CollectionLikeSerializer&lt;CustomCollectionLike&gt; { public CustomCollectionSerializer(Fory fory) { super(fory, CustomCollectionLike.class, true); } @Override public Collection onCollectionWrite(MemoryBuffer buffer, CustomCollectionLike value) { buffer.writeVarUint32Small7(value.size()); return new CollectionView(value); } @Override public Collection newCollection(MemoryBuffer buffer) { int numElements = buffer.readVarUint32Small7(); setNumElements(numElements); return new CollectionView(numElements); } @Override public CustomCollectionLike onCollectionRead(Collection collection) { CollectionView view = (CollectionView) collection; return new CustomCollectionLike(view.getElements(), view.size()); } }   Key takeways:  Collection Structure: Array-based storage for elementsFixed size after creationDirect element accessSize tracking View Implementation: Extends AbstractCollection for simplicityProvides iterator for element accessImplements add() for deserializationShares array reference with original type Serializer Features: Uses supportCodegenHook=true for JIT optimizationShares array references when possibleMaintains proper size trackingUses view pattern for serialization Performance Aspects: Direct array accessMinimal object creationArray sharing between instancesEfficient iteration  Note that this implementation provides better performance at the cost of flexibility. Consider your specific use case when choosing this approach.  ","version":"0.13","tagName":"h3"},{"title":"Implement Map Serializer‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#implement-map-serializer","content":" When implementing a serializer for a custom Map type, you must extend MapSerializer or MapLikeSerializer. The key difference between these two is that MapLikeSerializer can serialize a class which has a map-like structure but is not a java Map subtype.  Similar to collection serializer, this is a special parameter supportCodegenHook needs be configured:  When true: Enables optimized access to map elements and JIT compilation for better performanceDirect serialization invocation and inline for map key-value items without dynamic serializer dispatch cost.Better performance for standard map typesRecommended for most maps When false: Uses interfaced-based element access and dynamic serializer dispatch for elements, which have higher costMore flexible for custom map typesRequired when map has special serialization needsHandles complex map implementations  Implement Map Serializer with JIT support‚Äã  When implementing a Map serializer with JIT support, you can leverage Fory's existing chunk-based binary format and map serialization infrastructure. The key is to properly implement the onMapWrite and newMap methods to handle metadata while letting Fory handle the map key-value serialization.  Here's an example of implementing a custom map serializer:  public class CustomMapSerializer&lt;T extends Map&gt; extends MapSerializer&lt;T&gt; { public CustomMapSerializer(Fory fory, Class&lt;T&gt; cls) { // supportCodegenHook is a critical parameter that determines serialization behavior super(fory, cls, true); } @Override public Map onMapWrite(MemoryBuffer buffer, T value) { // Write map size buffer.writeVarUint32Small7(value.size()); // Write any additional map metadata here return value; } @Override public Map newMap(MemoryBuffer buffer) { // Read map size int numElements = buffer.readVarUint32Small7(); setNumElements(numElements); // Create and return new map instance T map = (T) new HashMap(numElements); fory.getRefResolver().reference(map); return map; } }   Note that please invoke setNumElements when implementing newMap to let fory know how many elements to deserialize.  Implement a totally-customzied Map Serializer without JIT‚Äã  Sometimes you may need complete control over the serialization process, or your map type might have special requirements that don't fit the standard patterns. In such cases, you can implement a serializer with supportCodegenHook=false and directly override the write and read methods.  This approach:  Gives you full control over serializationAllows custom binary formatBypasses the standard map serialization patternMay be simpler for special cases  Here's an example:  class FixedValueMap extends AbstractMap&lt;String, Integer&gt; { private final Set&lt;String&gt; keys; private final int fixedValue; public FixedValueMap(Set&lt;String&gt; keys, int fixedValue) { this.keys = keys; this.fixedValue = fixedValue; } @Override public Set&lt;Entry&lt;String, Integer&gt;&gt; entrySet() { Set&lt;Entry&lt;String, Integer&gt;&gt; entries = new HashSet&lt;&gt;(); for (String key : keys) { entries.add(new SimpleEntry&lt;&gt;(key, fixedValue)); } return entries; } @Override public Integer get(Object key) { return keys.contains(key) ? fixedValue : null; } public Set&lt;String&gt; getKeys() { return keys; } public int getFixedValue() { return fixedValue; } } class FixedValueMapSerializer extends MapLikeSerializer&lt;FixedValueMap&gt; { public FixedValueMapSerializer(Fory fory) { // Disable codegen since we're handling serialization directly super(fory, FixedValueMap.class, false); } @Override public void write(MemoryBuffer buffer, FixedValueMap value) { // Write the fixed value buffer.writeInt32(value.getFixedValue()); // Write the number of keys buffer.writeVarUint32Small7(value.getKeys().size()); // Write each key for (String key : value.getKeys()) { buffer.writeString(key); } } @Override public FixedValueMap read(MemoryBuffer buffer) { // Read the fixed value int fixedValue = buffer.readInt32(); // Read the number of keys int size = buffer.readVarUint32Small7(); Set&lt;String&gt; keys = new HashSet&lt;&gt;(size); for (int i = 0; i &lt; size; i++) { keys.add(buffer.readString()); } return new FixedValueMap(keys, fixedValue); } // These methods are not used when supportCodegenHook is false @Override public Map onMapWrite(MemoryBuffer buffer, FixedValueMap value) { throw new UnsupportedOperationException(); } @Override public FixedValueMap onMapRead(Map map) { throw new UnsupportedOperationException(); } @Override public FixedValueMap onMapCopy(Map map) { throw new UnsupportedOperationException(); } }   Key Points:  Disable Codegen: Set supportCodegenHook=false in constructorFory will use your write/read methods directlyNo JIT optimization will be appliedFull control over serialization format Write Method: Handle all serialization manuallyWrite custom fields firstWrite map entries in your preferred formatControl the exact binary layout Read Method: Handle all deserialization manuallyRead in same order as writtenCreate and populate map instanceRestore custom fields Unused Methods: onMapWrite, onMapRead, onMapCopy are not usedCan throw UnsupportedOperationExceptionOnly write and read are important  When to Use: this approach is best when  Map has custom fields or metadataSpecial serialization format is neededComplete control over binary format is requiredStandard map patterns don't fit  Trade-offs  Advantages: Complete control over serializationCustom binary format possibleSimpler implementation for special casesDirect handling of custom fields Disadvantages: No JIT optimizationPotentially lower performanceManual handling of all serializationMore code to maintain  Remember that disabling codegen means giving up some performance optimizations that Fory provides. Only use this approach when the standard map serialization pattern doesn't meet your needs.  Implement Serializer for Map-like Types‚Äã  Sometimes you may want to implement a serializer for a type that behaves like a map but isn't a standard Java map. This section demonstrates how to implement a serializer for such types.  The key principles for map-like type serialization are:  Extend MapLikeSerializer for custom collection-like typesEnable JIT optimization with supportCodegenHookProvide efficient element access through viewsMaintain proper size tracking  Here's a complete example:  // It's better to make it to implements the java.util.Map interface, in this way we don't have to implement such serializers by ourself. class CustomMapLike { private final Object[] keyArray; private final Object[] valueArray; private final int size; // Constructor for creating new instance public CustomMapLike(int initialCapacity) { this.keyArray = new Object[initialCapacity]; this.valueArray = new Object[initialCapacity]; this.size = 0; } // Constructor for wrapping existing arrays public CustomMapLike(Object[] keyArray, Object[] valueArray, int size) { this.keyArray = keyArray; this.valueArray = valueArray; this.size = size; } public Integer get(String key) { for (int i = 0; i &lt; size; i++) { if (key.equals(keyArray[i])) { return (Integer) valueArray[i]; } } return null; } public int size() { return size; } public Object[] getKeyArray() { return keyArray; } public Object[] getValueArray() { return valueArray; } } class MapView extends AbstractMap&lt;Object, Object&gt; { private final Object[] keyArray; private final Object[] valueArray; private final int size; private int writeIndex; // Constructor for serialization (wrapping existing CustomMapLike) public MapView(CustomMapLike mapLike) { this.size = mapLike.size(); this.keyArray = mapLike.getKeyArray(); this.valueArray = mapLike.getValueArray(); } // Constructor for deserialization public MapView(int size) { this.size = size; this.keyArray = new Object[size]; this.valueArray = new Object[size]; } @Override public Set&lt;Entry&lt;Object, Object&gt;&gt; entrySet() { return new AbstractSet&lt;Entry&lt;Object, Object&gt;&gt;() { @Override public Iterator&lt;Entry&lt;Object, Object&gt;&gt; iterator() { return new Iterator&lt;Entry&lt;Object, Object&gt;&gt;() { private int index = 0; @Override public boolean hasNext() { return index &lt; size; } @Override public Entry&lt;Object, Object&gt; next() { if (!hasNext()) { throw new NoSuchElementException(); } final int currentIndex = index++; return new SimpleEntry&lt;&gt;( keyArray[currentIndex], valueArray[currentIndex] ); } }; } @Override public int size() { return size; } }; } @Override public Object put(Object key, Object value) { if (writeIndex &gt;= size) { throw new IllegalStateException(&quot;Map is full&quot;); } keyArray[writeIndex] = key; valueArray[writeIndex] = value; writeIndex++; return null; } public Object[] getKeyArray() { return keyArray; } public Object[] getValueArray() { return valueArray; } public int size() { return size; } } class CustomMapLikeSerializer extends MapLikeSerializer&lt;CustomMapLike&gt; { public CustomMapLikeSerializer(Fory fory) { super(fory, CustomMapLike.class, true); } @Override public Map onMapWrite(MemoryBuffer buffer, CustomMapLike value) { buffer.writeVarUint32Small7(value.size()); // Return a zero-copy view using the same underlying arrays return new MapView(value); } @Override public Map newMap(MemoryBuffer buffer) { int numElements = buffer.readVarUint32Small7(); setNumElements(numElements); // Create a view with new arrays for deserialization return new MapView(numElements); } @Override public CustomMapLike onMapRead(Map map) { MapView view = (MapView) map; // Just pass the arrays directly - no copying needed return new CustomMapLike(view.getKeyArray(), view.getValueArray(), view.size()); } @Override public CustomMapLike onMapCopy(Map map) { MapView view = (MapView) map; // Just pass the arrays directly - no copying needed return new CustomMapLike(view.getKeyArray(), view.getValueArray(), view.size()); } }   ","version":"0.13","tagName":"h3"},{"title":"Register Custom Serializers‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#register-custom-serializers","content":" After implementing your custom serializer, register it with Fory:  Fory fory = Fory.builder() .withLanguage(Language.JAVA) .build(); // Register map serializer fory.registerSerializer(CustomMap.class, new CustomMapSerializer&lt;&gt;(fory, CustomMap.class)); // Register collection serializer fory.registerSerializer(CustomCollection.class, new CustomCollectionSerializer&lt;&gt;(fory, CustomCollection.class));   Note that when implementing custom map or collection serializers:  Always extend the appropriate base class (MapSerializer/MapLikeSerializer for maps, CollectionSerializer/CollectionLikeSerializer for collections)Consider the impact of supportCodegenHook on performance and functionalityProperly handle reference tracking if neededImplement proper size management using setNumElements and getAndClearNumElements when supportCodegenHook is true  Besides registering serializes, one can also implement java.io.Externalizable for a class to customize serialization logic, such type will be serialized by fory ExternalizableSerializer.  ","version":"0.13","tagName":"h3"},{"title":"Memory Allocation Customization‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#memory-allocation-customization","content":" Fory provides a MemoryAllocator interface that allows you to customize how memory buffers are allocated and grown during serialization operations. This can be useful for performance optimization, memory pooling, or debugging memory usage.  MemoryAllocator Interface‚Äã  The MemoryAllocator interface defines two key methods:  public interface MemoryAllocator { /** * Allocates a new MemoryBuffer with the specified initial capacity. */ MemoryBuffer allocate(int initialCapacity); /** * Grows an existing buffer to accommodate the new capacity. * The implementation must grow the buffer in-place by modifying * the existing buffer instance. */ MemoryBuffer grow(MemoryBuffer buffer, int newCapacity); }   Using Custom Memory Allocators‚Äã  You can set a global memory allocator that will be used by all MemoryBuffer instances:  // Create a custom allocator MemoryAllocator customAllocator = new MemoryAllocator() { @Override public MemoryBuffer allocate(int initialCapacity) { // Add extra capacity for debugging or pooling return MemoryBuffer.fromByteArray(new byte[initialCapacity + 100]); } @Override public MemoryBuffer grow(MemoryBuffer buffer, int newCapacity) { if (newCapacity &lt;= buffer.size()) { return buffer; } // Custom growth strategy - add 100% extra capacity int newSize = (int) (newCapacity * 2); byte[] data = new byte[newSize]; buffer.copyToUnsafe(0, data, Platform.BYTE_ARRAY_OFFSET, buffer.size()); buffer.initHeapBuffer(data, 0, data.length); return buffer; } }; // Set the custom allocator globally MemoryBuffer.setGlobalAllocator(customAllocator); // All subsequent MemoryBuffer allocations will use your custom allocator Fory fory = Fory.builder().withLanguage(Language.JAVA).build(); byte[] bytes = fory.serialize(someObject); // Uses custom allocator   Default Memory Allocator Behavior‚Äã  The default allocator uses the following growth strategy:  For buffers smaller than BUFFER_GROW_STEP_THRESHOLD (100MB): multiply capacity by 2For larger buffers: multiply capacity by 1.5 (capped at Integer.MAX_VALUE - 8)  This provides a balance between avoiding frequent reallocations and preventing excessive memory usage.  Use Cases‚Äã  Custom memory allocators are useful for:  Memory Pooling: Reuse allocated buffers to reduce GC pressurePerformance Tuning: Use different growth strategies based on your workloadDebugging: Add logging or tracking to monitor memory usageOff-heap Memory: Integrate with off-heap memory management systems  ","version":"0.13","tagName":"h3"},{"title":"Security‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#security","content":" Class Registration‚Äã  ForyBuilder#requireClassRegistration can be used to disable class registration, this will allow to deserialize objects unknown types, more flexible but may be insecure if the classes contains malicious code.  Do not disable class registration unless you can ensure your environment is secure. Malicious code in init/equals/hashCode can be executed when deserializing unknown/untrusted types when this option disabled.  Class registration can not only reduce security risks, but also avoid classname serialization cost.  You can register class with API Fory#register.  Note that class registration order is important, serialization and deserialization peer should have same registration order.  Fory fory = xxx; fory.register(SomeClass.class); fory.register(SomeClass1.class, 200);   If you invoke ForyBuilder#requireClassRegistration(false) to disable class registration check, you can set org.apache.fory.resolver.ClassChecker by ClassResolver#setClassChecker to control which classes are allowed for serialization. For example, you can allow classes started with org.example.* by:  Fory fory = xxx; fory.getClassResolver().setClassChecker( (classResolver, className) -&gt; className.startsWith(&quot;org.example.&quot;));   AllowListChecker checker = new AllowListChecker(AllowListChecker.CheckLevel.STRICT); ThreadSafeFory fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().requireClassRegistration(true).withClassLoader(classLoader).build(); f.getClassResolver().setClassChecker(checker); checker.addListener(f.getClassResolver()); return f; }); checker.allowClass(&quot;org.example.*&quot;);   Fory also provided a org.apache.fory.resolver.AllowListChecker which is allowed/disallowed list based checker to simplify the customization of class check mechanism. You can use this checker or implement more sophisticated checker by yourself.  Limit max deserization depth‚Äã  Fory also provides a ForyBuilder#withMaxDepth to limit max deserialization depth. The default max depth is 50.  If max depth is reached, Fory will throw ForyException. This can be used to prevent malicious data from causing stack overflow or other issues.  ","version":"0.13","tagName":"h3"},{"title":"Register class by name‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#register-class-by-name","content":" Register class by id will have better performance and smaller space overhead. But in some cases, management for a bunch of type id is complex. In such cases, registering class by name using APIregister(Class&lt;?&gt; cls, String namespace, String typeName) is recommended.  fory.register(Foo.class, &quot;demo&quot;, &quot;Foo&quot;);   If there are no duplicate name for type, namespace can be left as empty to reduce serialized size.  Do not use this API to register class since it will increase serialized size a lot compared to register class by id  ","version":"0.13","tagName":"h3"},{"title":"Zero-Copy Serialization‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#zero-copy-serialization","content":" import org.apache.fory.*; import org.apache.fory.config.*; import org.apache.fory.serializer.BufferObject; import org.apache.fory.memory.MemoryBuffer; import java.util.*; import java.util.stream.Collectors; public class ZeroCopyExample { // Note that fory instance should be reused instead of creation every time. static Fory fory = Fory.builder() .withLanguage(Language.JAVA) .build(); // mvn exec:java -Dexec.mainClass=&quot;io.ray.fory.examples.ZeroCopyExample&quot; public static void main(String[] args) { List&lt;Object&gt; list = Arrays.asList(&quot;str&quot;, new byte[1000], new int[100], new double[100]); Collection&lt;BufferObject&gt; bufferObjects = new ArrayList&lt;&gt;(); byte[] bytes = fory.serialize(list, e -&gt; !bufferObjects.add(e)); List&lt;MemoryBuffer&gt; buffers = bufferObjects.stream() .map(BufferObject::toBuffer).collect(Collectors.toList()); System.out.println(fory.deserialize(bytes, buffers)); } }   ","version":"0.13","tagName":"h3"},{"title":"Meta Sharing‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#meta-sharing","content":" Fory supports share type metadata (class name, field name, final field type information, etc.) between multiple serializations in a context (ex. TCP connection), and this information will be sent to the peer during the first serialization in the context. Based on this metadata, the peer can rebuild the same deserializer, which avoids transmitting metadata for subsequent serializations and reduces network traffic pressure and supports type forward/backward compatibility automatically.  // Fory.builder() // .withLanguage(Language.JAVA) // .withRefTracking(false) // // share meta across serialization. // .withMetaContextShare(true) // Not thread-safe fory. MetaContext context = xxx; fory.getSerializationContext().setMetaContext(context); byte[] bytes = fory.serialize(o); // Not thread-safe fory. MetaContext context = xxx; fory.getSerializationContext().setMetaContext(context); fory.deserialize(bytes); // Thread-safe fory fory.setClassLoader(beanA.getClass().getClassLoader()); byte[] serialized = fory.execute( f -&gt; { f.getSerializationContext().setMetaContext(context); return f.serialize(beanA); } ); // thread-safe fory fory.setClassLoader(beanA.getClass().getClassLoader()); Object newObj = fory.execute( f -&gt; { f.getSerializationContext().setMetaContext(context); return f.deserialize(serialized); } );   Note that MetaContext is not thread-safe and cannot be reused across instances of fory or multiple threads. In cases of multi-threading, a separate MetaContext must be created for each fory instance.  ","version":"0.13","tagName":"h3"},{"title":"Deserialize non-existent classes‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#deserialize-non-existent-classes","content":" Fory support deserializing non-existent classes, this feature can be enabled by ForyBuilder#deserializeNonexistentClass(true). When enabled, and metadata sharing enabled, Fory will store the deserialized data of this type in a lazy subclass of Map. By using the lazy map implemented by Fory, the rebalance cost of filling map during deserialization can be avoided, which further improves performance. If this data is sent to another process and the class exists in this process, the data will be deserialized into the object of this type without losing any information.  If metadata sharing is not enabled, the new class data will be skipped and an NonexistentSkipClass stub object will be returned.  ","version":"0.13","tagName":"h3"},{"title":"Copy/Map object from one type to another type‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#copymap-object-from-one-type-to-another-type","content":" Fory support mapping object from one type to another type.  Notes: This mapping will execute a deep copy, all mapped fields are serialized into binary and deserialized from that binary to map into another type.All struct types must be registered with same ID, otherwise Fory can not mapping to correct struct type. Be careful when you use Fory#register(Class), because fory will allocate an auto-grown ID which might be inconsistent if you register classes with different order between Fory instance.  public class StructMappingExample { static class Struct1 { int f1; String f2; public Struct1(int f1, String f2) { this.f1 = f1; this.f2 = f2; } } static class Struct2 { int f1; String f2; double f3; } static ThreadSafeFory fory1 = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE).buildThreadSafeFory(); static ThreadSafeFory fory2 = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE).buildThreadSafeFory(); static { fory1.register(Struct1.class); fory2.register(Struct2.class); } public static void main(String[] args) { Struct1 struct1 = new Struct1(10, &quot;abc&quot;); Struct2 struct2 = (Struct2) fory2.deserialize(fory1.serialize(struct1)); Assert.assertEquals(struct2.f1, struct1.f1); Assert.assertEquals(struct2.f2, struct1.f2); struct1 = (Struct1) fory1.deserialize(fory2.serialize(struct2)); Assert.assertEquals(struct1.f1, struct2.f1); Assert.assertEquals(struct1.f2, struct2.f2); } }   ","version":"0.13","tagName":"h3"},{"title":"Logging‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#logging","content":" ForyLogger‚Äã  By default Fory uses a custom logger ForyLogger for internal needs. It builds resulting logged data into single string and sends it directly to System.out. The result line layout is similar to (in Log4j notation):  %d{yyyy-MM-dd hh:mm:ss} %p %C:%L [%t] - %m%n   The layout can't be changed.  Example output:  2025-11-07 08:49:59 INFO CompileUnit:55 [main] - Generate code for org.apache.fory.builder.SerializedLambdaForyCodec_0 took 35 ms. 2025-11-07 08:50:00 INFO JaninoUtils:121 [main] - Compile [SerializedLambdaForyCodec_0] take 144 ms   Slf4jLogger‚Äã  If more sophisticated logger is required, configure Fory to use Slf4j via LoggerFactory.useSlf4jLogging(). For example enabling Slf4j before creating Fory:  public static final ThreadSafeFory FORY; static { LoggerFactory.useSlf4jLogging(true); FORY = Fory.builder() .buildThreadSafeFory(); }   Note: Enabling Slf4j via useSlf4jLogging will be ignored when the application runs in a GraalVM native image.  Suppress Fory logs‚Äã  Both ForyLogger and Slf4jLogger allow controling log outpul level or suppressing logs entirely. Configure logger level via LoggerFactory.setLogLevel(), for example:  static { // to log only WARN and high LoggerFactory.setLogLevel(LogLevel.WARN_LEVEL); // to disable at all LoggerFactory.disableLogging(); }   Note: Selected logging level is applied before Slfj4 implementation's logger level. So if you set WARN_LEVEL (as in the example above) then you will not see INFO messages from Fory even if INFO is enabled in Logback.  ","version":"0.13","tagName":"h3"},{"title":"Migration‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#migration","content":" ","version":"0.13","tagName":"h2"},{"title":"JDK migration‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#jdk-migration","content":" If you use jdk serialization before, and you can't upgrade your client and server at the same time, which is common for online application. Fory provided an util method org.apache.fory.serializer.JavaSerializer.serializedByJDK to check whether the binary are generated by jdk serialization, you use following pattern to make exiting serialization protocol-aware, then upgrade serialization to fory in an async rolling-up way:  if (JavaSerializer.serializedByJDK(bytes)) { ObjectInputStream objectInputStream=xxx; return objectInputStream.readObject(); } else { return fory.deserialize(bytes); }   ","version":"0.13","tagName":"h3"},{"title":"Upgrade fory‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#upgrade-fory","content":" Currently binary compatibility is ensured for minor versions only. For example, if you are using foryv0.2.0, binary compatibility will be provided if you upgrade to fory v0.2.1. But if upgrade to fory v0.4.1, no binary compatibility are ensured. Most of the time there is no need to upgrade fory to newer major version, the current version is fast and compact enough, and we provide some minor fix for recent older versions.  But if you do want to upgrade fory for better performance and smaller size, you need to write fory version as header to serialized data using code like following to keep binary compatibility:  MemoryBuffer buffer = xxx; buffer.writeVarInt32(2); fory.serialize(buffer, obj);   Then for deserialization, you need:  MemoryBuffer buffer = xxx; int foryVersion = buffer.readVarInt32(); Fory fory = getFory(foryVersion); fory.deserialize(buffer);   getFory is a method to load corresponding fory, you can shade and relocate different version of fory to different package, and load fory by version.  If you upgrade fory by minor version, or you won't have data serialized by older fory, you can upgrade fory directly, no need to versioning the data.  ","version":"0.13","tagName":"h3"},{"title":"Trouble shooting‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#trouble-shooting","content":" ","version":"0.13","tagName":"h2"},{"title":"Class inconsistency and class version check‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#class-inconsistency-and-class-version-check","content":" If you create fory without setting CompatibleMode to org.apache.fory.config.CompatibleMode.COMPATIBLE, and you got a strange serialization error, it may be caused by class inconsistency between serialization peer and deserialization peer.  In such cases, you can invoke ForyBuilder#withClassVersionCheck to create fory to validate it, if deserialization throws org.apache.fory.exception.ClassNotCompatibleException, it shows class are inconsistent, and you should create fory withForyBuilder#withCompaibleMode(CompatibleMode.COMPATIBLE).  CompatibleMode.COMPATIBLE has more performance and space cost, do not set it by default if your classes are always consistent between serialization and deserialization.  ","version":"0.13","tagName":"h3"},{"title":"Deserialize POJO into another type‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#deserialize-pojo-into-another-type","content":" Fory allows you to serialize one POJO and deserialize it into a different POJO. The different POJO means the schema inconsistency. Users must to configure Fory withCompatibleMode set to org.apache.fory.config.CompatibleMode.COMPATIBLE.  public class DeserializeIntoType { static class Struct1 { int f1; String f2; public Struct1(int f1, String f2) { this.f1 = f1; this.f2 = f2; } } static class Struct2 { int f1; String f2; double f3; } static ThreadSafeFory fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE).buildThreadSafeFory(); public static void main(String[] args) { Struct1 struct1 = new Struct1(10, &quot;abc&quot;); byte[] data = fory.serializeJavaObject(struct1); Struct2 struct2 = (Struct2) fory.deserializeJavaObject(bytes, Struct2.class); } }   ","version":"0.13","tagName":"h3"},{"title":"Use wrong API for deserialization‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.13/guide/serialization#use-wrong-api-for-deserialization","content":" If you serialize an object by invoking Fory#serialize, you should invoke Fory#deserialize for deserialization instead ofFory#deserializeJavaObject.  If you serialize an object by invoking Fory#serializeJavaObject, you should invoke Fory#deserializeJavaObject for deserialization instead of Fory#deserializeJavaObjectAndClass/Fory#deserialize.  If you serialize an object by invoking Fory#serializeJavaObjectAndClass, you should invoke Fory#deserializeJavaObjectAndClass for deserialization instead of Fory#deserializeJavaObject/Fory#deserialize. ","version":"0.13","tagName":"h3"},{"title":"Cross-Language Serialization","type":0,"sectionRef":"#","url":"/docs/0.14/guide/cpp/cross_language","content":"","keywords":"","version":"0.14"},{"title":"Overview‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/cpp/cross_language#overview","content":" Apache Fory‚Ñ¢ enables seamless data exchange between C++, Java, Python, Go, Rust, and JavaScript. The xlang (cross-language) mode ensures binary compatibility across all supported languages.  ","version":"0.14","tagName":"h2"},{"title":"Enabling Cross-Language Mode‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/cpp/cross_language#enabling-cross-language-mode","content":" #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; auto fory = Fory::builder() .xlang(true) // Enable cross-language mode .build();   ","version":"0.14","tagName":"h2"},{"title":"Cross-Language Example‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/cpp/cross_language#cross-language-example","content":" ","version":"0.14","tagName":"h2"},{"title":"C++ Producer‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/cpp/cross_language#c-producer","content":" #include &quot;fory/serialization/fory.h&quot; #include &lt;fstream&gt; using namespace fory::serialization; struct Message { std::string topic; int64_t timestamp; std::map&lt;std::string, std::string&gt; headers; std::vector&lt;uint8_t&gt; payload; bool operator==(const Message &amp;other) const { return topic == other.topic &amp;&amp; timestamp == other.timestamp &amp;&amp; headers == other.headers &amp;&amp; payload == other.payload; } }; FORY_STRUCT(Message, topic, timestamp, headers, payload); int main() { auto fory = Fory::builder().xlang(true).build(); fory.register_struct&lt;Message&gt;(100); Message msg{ &quot;events.user&quot;, 1699999999000, {{&quot;content-type&quot;, &quot;application/json&quot;}}, {'h', 'e', 'l', 'l', 'o'} }; auto result = fory.serialize(msg); if (result.ok()) { auto bytes = std::move(result).value(); // Write to file, send over network, etc. std::ofstream file(&quot;message.bin&quot;, std::ios::binary); file.write(reinterpret_cast&lt;const char*&gt;(bytes.data()), bytes.size()); } return 0; }   ","version":"0.14","tagName":"h3"},{"title":"Java Consumer‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/cpp/cross_language#java-consumer","content":" import org.apache.fory.Fory; import org.apache.fory.config.Language; public class Message { public String topic; public long timestamp; public Map&lt;String, String&gt; headers; public byte[] payload; } public class Consumer { public static void main(String[] args) throws Exception { Fory fory = Fory.builder() .withLanguage(Language.XLANG) .build(); fory.register(Message.class, 100); // Same ID as C++ byte[] bytes = Files.readAllBytes(Path.of(&quot;message.bin&quot;)); Message msg = (Message) fory.deserialize(bytes); System.out.println(&quot;Topic: &quot; + msg.topic); System.out.println(&quot;Timestamp: &quot; + msg.timestamp); } }   ","version":"0.14","tagName":"h3"},{"title":"Python Consumer‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/cpp/cross_language#python-consumer","content":" import pyfory class Message: topic: str timestamp: int headers: dict[str, str] payload: bytes fory = pyfory.Fory() fory.register(Message, type_id=100) # Same ID as C++ with open(&quot;message.bin&quot;, &quot;rb&quot;) as f: data = f.read() msg = fory.deserialize(data) print(f&quot;Topic: {msg.topic}&quot;) print(f&quot;Timestamp: {msg.timestamp}&quot;)   ","version":"0.14","tagName":"h3"},{"title":"Type Mapping‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/cpp/cross_language#type-mapping","content":" ","version":"0.14","tagName":"h2"},{"title":"Primitive Types‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/cpp/cross_language#primitive-types","content":" C++ Type\tJava Type\tPython Type\tGo Type\tRust Typebool\tboolean\tbool\tbool\tbool int8_t\tbyte\tint\tint8\ti8 int16_t\tshort\tint\tint16\ti16 int32_t\tint\tint\tint32\ti32 int64_t\tlong\tint\tint64\ti64 float\tfloat\tfloat\tfloat32\tf32 double\tdouble\tfloat\tfloat64\tf64  ","version":"0.14","tagName":"h3"},{"title":"String Types‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/cpp/cross_language#string-types","content":" C++ Type\tJava Type\tPython Type\tGo Type\tRust Typestd::string\tString\tstr\tstring\tString  ","version":"0.14","tagName":"h3"},{"title":"Collection Types‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/cpp/cross_language#collection-types","content":" C++ Type\tJava Type\tPython Type\tGo Typestd::vector&lt;T&gt;\tList&lt;T&gt;\tlist\t[]T std::set&lt;T&gt;\tSet&lt;T&gt;\tset\tmap[T]struct{} std::map&lt;K,V&gt;\tMap&lt;K,V&gt;\tdict\tmap[K]V  ","version":"0.14","tagName":"h3"},{"title":"Temporal Types‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/cpp/cross_language#temporal-types","content":" C++ Type\tJava Type\tPython Type\tGo TypeTimestamp\tInstant\tdatetime\ttime.Time Duration\tDuration\ttimedelta\ttime.Duration LocalDate\tLocalDate\tdatetime.date\ttime.Time  ","version":"0.14","tagName":"h3"},{"title":"Field Order Requirements‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/cpp/cross_language#field-order-requirements","content":" Critical: Field will be sorted by their snake_cased field name, converted name must be considten across langauges  ","version":"0.14","tagName":"h2"},{"title":"C++‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/cpp/cross_language#c","content":" struct Person { std::string name; // Field 0 int32_t age; // Field 1 std::string email; // Field 2 }; FORY_STRUCT(Person, name, age, email); // Order matters!   ","version":"0.14","tagName":"h3"},{"title":"Java‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/cpp/cross_language#java","content":" public class Person { public String name; // Field 0 public int age; // Field 1 public String email; // Field 2 }   ","version":"0.14","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/cpp/cross_language#python","content":" class Person: name: str # Field 0 age: int # Field 1 email: str # Field 2   ","version":"0.14","tagName":"h3"},{"title":"Type ID Consistency‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/cpp/cross_language#type-id-consistency","content":" All languages must use the same type IDs:  // C++ fory.register_struct&lt;Person&gt;(100); fory.register_struct&lt;Address&gt;(101); fory.register_struct&lt;Order&gt;(102);   // Java fory.register(Person.class, 100); fory.register(Address.class, 101); fory.register(Order.class, 102);   # Python fory.register(Person, type_id=100) fory.register(Address, type_id=101) fory.register(Order, type_id=102)   ","version":"0.14","tagName":"h2"},{"title":"Compatible Mode‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/cpp/cross_language#compatible-mode","content":" For schema evolution across language boundaries:  // C++ with compatible mode auto fory = Fory::builder() .xlang(true) .compatible(true) // Enable schema evolution .build();   Compatible mode allows:  Adding new fields (with defaults)Removing unused fieldsReordering fields  ","version":"0.14","tagName":"h2"},{"title":"Troubleshooting‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/cpp/cross_language#troubleshooting","content":" ","version":"0.14","tagName":"h2"},{"title":"Type Mismatch Errors‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/cpp/cross_language#type-mismatch-errors","content":" Error: Type mismatch: expected 100, got 101   Solution: Ensure type IDs match across all languages.  ","version":"0.14","tagName":"h3"},{"title":"Encoding Errors‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/cpp/cross_language#encoding-errors","content":" Error: Invalid UTF-8 sequence   Solution: Ensure strings are valid UTF-8 in all languages.  ","version":"0.14","tagName":"h3"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/cpp/cross_language#related-topics","content":" Configuration - Builder optionsType Registration - Registering typesSupported Types - Type compatibility ","version":"0.14","tagName":"h2"},{"title":"Basic Serialization","type":0,"sectionRef":"#","url":"/docs/0.14/guide/cpp/basic_serialization","content":"","keywords":"","version":"0.14"},{"title":"Object Graph Serialization‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/cpp/basic_serialization#object-graph-serialization","content":" Apache Fory‚Ñ¢ provides automatic serialization of complex object graphs, preserving the structure and relationships between objects. The FORY_STRUCT macro generates efficient serialization code at compile time, eliminating runtime overhead.  Key capabilities:  Nested struct serialization with arbitrary depthCollection types (vector, set, map)Optional fields with std::optional&lt;T&gt;Smart pointers (std::shared_ptr, std::unique_ptr)Automatic handling of primitive types and stringsEfficient binary encoding with variable-length integers  #include &quot;fory/serialization/fory.h&quot; #include &lt;vector&gt; #include &lt;map&gt; using namespace fory::serialization; // Define structs struct Address { std::string street; std::string city; std::string country; bool operator==(const Address &amp;other) const { return street == other.street &amp;&amp; city == other.city &amp;&amp; country == other.country; } }; FORY_STRUCT(Address, street, city, country); struct Person { std::string name; int32_t age; Address address; std::vector&lt;std::string&gt; hobbies; std::map&lt;std::string, std::string&gt; metadata; bool operator==(const Person &amp;other) const { return name == other.name &amp;&amp; age == other.age &amp;&amp; address == other.address &amp;&amp; hobbies == other.hobbies &amp;&amp; metadata == other.metadata; } }; FORY_STRUCT(Person, name, age, address, hobbies, metadata); int main() { auto fory = Fory::builder().xlang(true).build(); fory.register_struct&lt;Address&gt;(100); fory.register_struct&lt;Person&gt;(200); Person person{ &quot;John Doe&quot;, 30, {&quot;123 Main St&quot;, &quot;New York&quot;, &quot;USA&quot;}, {&quot;reading&quot;, &quot;coding&quot;}, {{&quot;role&quot;, &quot;developer&quot;}} }; auto result = fory.serialize(person); auto decoded = fory.deserialize&lt;Person&gt;(result.value()); assert(person == decoded.value()); }   ","version":"0.14","tagName":"h2"},{"title":"Serialization APIs‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/cpp/basic_serialization#serialization-apis","content":" ","version":"0.14","tagName":"h2"},{"title":"Serialize to New Vector‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/cpp/basic_serialization#serialize-to-new-vector","content":" auto fory = Fory::builder().xlang(true).build(); fory.register_struct&lt;MyStruct&gt;(1); MyStruct obj{/* ... */}; // Serialize - returns Result&lt;std::vector&lt;uint8_t&gt;, Error&gt; auto result = fory.serialize(obj); if (result.ok()) { std::vector&lt;uint8_t&gt; bytes = std::move(result).value(); // Use bytes... } else { // Handle error std::cerr &lt;&lt; result.error().to_string() &lt;&lt; std::endl; }   ","version":"0.14","tagName":"h3"},{"title":"Serialize to Existing Buffer‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/cpp/basic_serialization#serialize-to-existing-buffer","content":" // Serialize to existing Buffer (fastest path) Buffer buffer; auto result = fory.serialize_to(buffer, obj); if (result.ok()) { size_t bytes_written = result.value(); // buffer now contains serialized data } // Serialize to existing vector (zero-copy) std::vector&lt;uint8_t&gt; output; auto result = fory.serialize_to(output, obj); if (result.ok()) { size_t bytes_written = result.value(); // output now contains serialized data }   ","version":"0.14","tagName":"h3"},{"title":"Deserialize from Byte Array‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/cpp/basic_serialization#deserialize-from-byte-array","content":" // Deserialize from raw pointer auto result = fory.deserialize&lt;MyStruct&gt;(data_ptr, data_size); if (result.ok()) { MyStruct obj = std::move(result).value(); } // Deserialize from vector std::vector&lt;uint8_t&gt; data = /* ... */; auto result = fory.deserialize&lt;MyStruct&gt;(data); // Deserialize from Buffer (updates reader_index) Buffer buffer(data); auto result = fory.deserialize&lt;MyStruct&gt;(buffer);   ","version":"0.14","tagName":"h3"},{"title":"Error Handling‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/cpp/basic_serialization#error-handling","content":" Fory uses a Result&lt;T, Error&gt; type for error handling:  auto result = fory.serialize(obj); // Check if operation succeeded if (result.ok()) { auto value = std::move(result).value(); // Use value... } else { Error error = result.error(); std::cerr &lt;&lt; &quot;Error: &quot; &lt;&lt; error.to_string() &lt;&lt; std::endl; } // Or use FORY_TRY macro for early return FORY_TRY(bytes, fory.serialize(obj)); // Use bytes directly...   Common error types:  Error::type_mismatch - Type ID mismatch during deserializationError::invalid_data - Invalid or corrupted dataError::buffer_out_of_bound - Buffer overflow/underflowError::type_error - Type registration error  ","version":"0.14","tagName":"h2"},{"title":"The FORY_STRUCT Macro‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/cpp/basic_serialization#the-fory_struct-macro","content":" The FORY_STRUCT macro registers a struct for serialization:  struct MyStruct { int32_t x; std::string y; std::vector&lt;int32_t&gt; z; }; // Must be in the same namespace as the struct FORY_STRUCT(MyStruct, x, y, z);   The macro:  Generates compile-time field metadataEnables ADL (Argument-Dependent Lookup) for serializationCreates efficient serialization code via template specialization  Requirements:  Must be placed in the same namespace as the struct (for ADL)All listed fields must be serializable typesField order in the macro determines serialization order  ","version":"0.14","tagName":"h2"},{"title":"Nested Structs‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/cpp/basic_serialization#nested-structs","content":" Nested structs are fully supported:  struct Inner { int32_t value; }; FORY_STRUCT(Inner, value); struct Outer { Inner inner; std::string label; }; FORY_STRUCT(Outer, inner, label); // Both must be registered fory.register_struct&lt;Inner&gt;(1); fory.register_struct&lt;Outer&gt;(2);   ","version":"0.14","tagName":"h2"},{"title":"Performance Tips‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/cpp/basic_serialization#performance-tips","content":" Buffer Reuse: Use serialize_to(buffer, obj) with pre-allocated buffersPre-registration: Register all types before serialization startsSingle-Threaded: Use build() instead of build_thread_safe() when possibleDisable Tracking: Use track_ref(false) when references aren't neededCompact Encoding: Variable-length encoding for space efficiency  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/cpp/basic_serialization#related-topics","content":" Configuration - Builder optionsType Registration - Registering typesSupported Types - All supported types ","version":"0.14","tagName":"h2"},{"title":"Configuration","type":0,"sectionRef":"#","url":"/docs/0.14/guide/cpp/configuration","content":"","keywords":"","version":"0.14"},{"title":"Serialization Modes‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/cpp/configuration#serialization-modes","content":" Apache Fory‚Ñ¢ supports two serialization modes:  ","version":"0.14","tagName":"h2"},{"title":"SchemaConsistent Mode (Default)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/cpp/configuration#schemaconsistent-mode-default","content":" Type declarations must match exactly between peers:  auto fory = Fory::builder().build(); // SchemaConsistent by default   ","version":"0.14","tagName":"h3"},{"title":"Compatible Mode‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/cpp/configuration#compatible-mode","content":" Allows independent schema evolution:  auto fory = Fory::builder().compatible(true).build();   ","version":"0.14","tagName":"h3"},{"title":"Builder Pattern‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/cpp/configuration#builder-pattern","content":" Use ForyBuilder to construct Fory instances with custom configuration:  #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; // Default configuration auto fory = Fory::builder().build(); // Compatible mode for schema evolution auto fory = Fory::builder() .compatible(true) .build(); // Cross-language mode auto fory = Fory::builder() .xlang(true) .build(); // Full configuration auto fory = Fory::builder() .compatible(true) .xlang(true) .track_ref(true) .max_dyn_depth(10) .check_struct_version(true) .build();   ","version":"0.14","tagName":"h2"},{"title":"Configuration Options‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/cpp/configuration#configuration-options","content":" ","version":"0.14","tagName":"h2"},{"title":"xlang(bool)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/cpp/configuration#xlangbool","content":" Enable/disable cross-language (xlang) serialization mode.  auto fory = Fory::builder() .xlang(true) // Enable cross-language compatibility .build();   When enabled, includes metadata for cross-language compatibility with Java, Python, Go, Rust, and JavaScript.  Default: true  ","version":"0.14","tagName":"h3"},{"title":"compatible(bool)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/cpp/configuration#compatiblebool","content":" Enable/disable compatible mode for schema evolution.  auto fory = Fory::builder() .compatible(true) // Enable schema evolution .build();   When enabled, supports reading data serialized with different schema versions.  Default: false  ","version":"0.14","tagName":"h3"},{"title":"track_ref(bool)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/cpp/configuration#track_refbool","content":" Enable/disable reference tracking for shared and circular references.  auto fory = Fory::builder() .track_ref(true) // Enable reference tracking .build();   When enabled, avoids duplicating shared objects and handles cycles.  Default: true  ","version":"0.14","tagName":"h3"},{"title":"max_dyn_depth(uint32_t)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/cpp/configuration#max_dyn_depthuint32_t","content":" Set maximum allowed nesting depth for dynamically-typed objects.  auto fory = Fory::builder() .max_dyn_depth(10) // Allow up to 10 levels .build();   This limits the maximum depth for nested polymorphic object serialization (e.g., shared_ptr&lt;Base&gt;, unique_ptr&lt;Base&gt;). This prevents stack overflow from deeply nested structures in dynamic serialization scenarios.  Default: 5  When to adjust:  Increase: For legitimate deeply nested data structuresDecrease: For stricter security requirements or shallow data structures  ","version":"0.14","tagName":"h3"},{"title":"check_struct_version(bool)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/cpp/configuration#check_struct_versionbool","content":" Enable/disable struct version checking.  auto fory = Fory::builder() .check_struct_version(true) // Enable version checking .build();   When enabled, validates type hashes to detect schema mismatches.  Default: false  ","version":"0.14","tagName":"h3"},{"title":"Thread-Safe vs Single-Threaded‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/cpp/configuration#thread-safe-vs-single-threaded","content":" ","version":"0.14","tagName":"h2"},{"title":"Single-Threaded (Fastest)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/cpp/configuration#single-threaded-fastest","content":" auto fory = Fory::builder() .xlang(true) .build(); // Returns Fory   Single-threaded Fory is the fastest option, but NOT thread-safe. Use one instance per thread.  ","version":"0.14","tagName":"h3"},{"title":"Thread-Safe‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/cpp/configuration#thread-safe","content":" auto fory = Fory::builder() .xlang(true) .build_thread_safe(); // Returns ThreadSafeFory   ThreadSafeFory uses a pool of Fory instances to provide thread-safe serialization. Slightly slower due to pool overhead, but safe to use from multiple threads concurrently.  ","version":"0.14","tagName":"h3"},{"title":"Configuration Summary‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/cpp/configuration#configuration-summary","content":" Option\tDescription\tDefaultxlang(bool)\tEnable cross-language mode\ttrue compatible(bool)\tEnable schema evolution\tfalse track_ref(bool)\tEnable reference tracking\ttrue max_dyn_depth(uint32_t)\tMaximum nesting depth for dynamic types\t5 check_struct_version(bool)\tEnable struct version checking\tfalse  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/cpp/configuration#related-topics","content":" Basic Serialization - Using configured ForyCross-Language - XLANG mode detailsType Registration - Registering types ","version":"0.14","tagName":"h2"},{"title":"Type Registration","type":0,"sectionRef":"#","url":"/docs/0.14/guide/cpp/type_registration","content":"","keywords":"","version":"0.14"},{"title":"Overview‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/0.14/guide/cpp/type_registration#overview","content":" Apache Fory‚Ñ¢ requires explicit type registration for struct types. This design enables:  Cross-Language Compatibility: Registered type IDs are used across language boundariesType Safety: Detects type mismatches at deserialization timePolymorphic Serialization: Enables serialization of polymorphic objects via smart pointers  ","version":"0.14","tagName":"h2"},{"title":"Registering Structs‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/0.14/guide/cpp/type_registration#registering-structs","content":" Use register_struct&lt;T&gt;(type_id) to register a struct type:  #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; struct Person { std::string name; int32_t age; }; FORY_STRUCT(Person, name, age); int main() { auto fory = Fory::builder().xlang(true).build(); // Register with a unique type ID fory.register_struct&lt;Person&gt;(100); Person person{&quot;Alice&quot;, 30}; auto bytes = fory.serialize(person).value(); auto decoded = fory.deserialize&lt;Person&gt;(bytes).value(); }   ","version":"0.14","tagName":"h2"},{"title":"Type ID Guidelines‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/0.14/guide/cpp/type_registration#type-id-guidelines","content":" Type IDs must be:  Unique: Each type must have a unique ID within a Fory instanceConsistent: Same ID must be used across all languages and versions  User-registered type IDs are in a separate namespace from built-in type IDs, so you can start from 0:  // User type IDs can start from 0 fory.register_struct&lt;Address&gt;(0); fory.register_struct&lt;Person&gt;(1); fory.register_struct&lt;Order&gt;(2);   ","version":"0.14","tagName":"h2"},{"title":"Registering Enums‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/0.14/guide/cpp/type_registration#registering-enums","content":" Use register_enum&lt;T&gt;(type_id) to register an enum type. For simple enums with continuous values starting from 0, no macro is needed:  // Simple continuous enum - no FORY_ENUM needed enum class Color { RED, GREEN, BLUE }; // Values: 0, 1, 2 // Register with register_enum fory.register_enum&lt;Color&gt;(0);   For enums with non-continuous values, use the FORY_ENUM macro to map values to ordinals:  // Non-continuous enum values - FORY_ENUM required enum class Priority { LOW = 10, MEDIUM = 50, HIGH = 100 }; FORY_ENUM(Priority, LOW, MEDIUM, HIGH); // Global namespace enum (prefix with ::) enum LegacyStatus { UNKNOWN = -1, OK = 0, ERROR = 1 }; FORY_ENUM(::LegacyStatus, UNKNOWN, OK, ERROR); // Register after FORY_ENUM fory.register_enum&lt;Priority&gt;(1); fory.register_enum&lt;LegacyStatus&gt;(2);   When to use FORY_ENUM:  Enum values don't start from 0Enum values are not continuous (e.g., 10, 50, 100)You need name-to-value mapping at compile time  ","version":"0.14","tagName":"h2"},{"title":"Thread-Safe Registration‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/0.14/guide/cpp/type_registration#thread-safe-registration","content":" For ThreadSafeFory, register types before spawning threads:  auto fory = Fory::builder().xlang(true).build_thread_safe(); // Register all types first fory.register_struct&lt;TypeA&gt;(100); fory.register_struct&lt;TypeB&gt;(101); // Now safe to use from multiple threads std::thread t1([&amp;]() { auto result = fory.serialize(obj_a); }); std::thread t2([&amp;]() { auto result = fory.serialize(obj_b); });   ","version":"0.14","tagName":"h2"},{"title":"Cross-Language Registration‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/0.14/guide/cpp/type_registration#cross-language-registration","content":" For cross-language compatibility, ensure:  Same Type ID: Use identical IDs in all languagesCompatible Types: Use equivalent types across languages  ","version":"0.14","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/0.14/guide/cpp/type_registration#java","content":" Fory fory = Fory.builder().build(); fory.register(Person.class, 100); fory.register(Address.class, 101);   ","version":"0.14","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/0.14/guide/cpp/type_registration#python","content":" import pyfory fory = pyfory.Fory() fory.register(Person, 100) fory.register(Address, 101)   ","version":"0.14","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/0.14/guide/cpp/type_registration#c","content":" auto fory = Fory::builder().xlang(true).build(); fory.register_struct&lt;Person&gt;(100); fory.register_struct&lt;Address&gt;(101);   ","version":"0.14","tagName":"h3"},{"title":"Built-in Type IDs‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/0.14/guide/cpp/type_registration#built-in-type-ids","content":" Built-in types have pre-assigned type IDs and don't need registration:  Type ID\tType0\tNONE 1\tBOOL 2\tINT8 3\tINT16 4\tINT32 5\tVAR_INT32 6\tINT64 7\tVAR_INT64 8\tSLI_INT64 9\tFLOAT16 10\tFLOAT32 11\tFLOAT64 12\tSTRING 13\tLIST 14\tMAP 15\tSET 16\tTIMESTAMP 17\tDURATION 18\tLOCAL_DATE 19\tDECIMAL 20\tBINARY 21\tARRAY 22\tBOOL_ARRAY 23-28\tINT_ARRAY variants 29-31\tFLOAT_ARRAY variants 32\tSTRUCT 33\tCOMPATIBLE_STRUCT 34\tNAMED_STRUCT 35\tNAMEDCOMPATIBLE... 36\tEXT 37\tNAMED_EXT 63\tUNKNOWN  ","version":"0.14","tagName":"h2"},{"title":"Error Handling‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/0.14/guide/cpp/type_registration#error-handling","content":" Registration errors are checked at serialization/deserialization time:  // Attempting to serialize unregistered type auto result = fory.serialize(unregistered_obj); if (!result.ok()) { // Error: &quot;Type not registered: ...&quot; std::cerr &lt;&lt; result.error().to_string() &lt;&lt; std::endl; } // Type ID mismatch during deserialization auto result = fory.deserialize&lt;WrongType&gt;(bytes); if (!result.ok()) { // Error: &quot;Type mismatch: expected X, got Y&quot; std::cerr &lt;&lt; result.error().to_string() &lt;&lt; std::endl; }   ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/0.14/guide/cpp/type_registration#related-topics","content":" Basic Serialization - Using registered typesCross-Language - Cross-language considerationsSupported Types - All supported types ","version":"0.14","tagName":"h2"},{"title":"Supported Types","type":0,"sectionRef":"#","url":"/docs/0.14/guide/cpp/supported_types","content":"","keywords":"","version":"0.14"},{"title":"Primitive Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/0.14/guide/cpp/supported_types#primitive-types","content":" All C++ primitive types are supported with efficient binary encoding:  Type\tSize\tFory TypeId\tNotesbool\t1 byte\tBOOL\tTrue/false int8_t\t1 byte\tINT8\tSigned byte uint8_t\t1 byte\tINT8\tUnsigned byte int16_t\t2 byte\tINT16\tSigned short uint16_t\t2 byte\tINT16\tUnsigned short int32_t\t4 byte\tINT32\tSigned integer uint32_t\t4 byte\tINT32\tUnsigned integer int64_t\t8 byte\tINT64\tSigned long uint64_t\t8 byte\tINT64\tUnsigned long float\t4 byte\tFLOAT32\tIEEE 754 single double\t8 byte\tFLOAT64\tIEEE 754 double char\t1 byte\tINT8\tCharacter (as signed) char16_t\t2 byte\tINT16\t16-bits characters char32_t\t4 byte\tINT32\t32-bits characters  int32_t value = 42; auto bytes = fory.serialize(value).value(); auto decoded = fory.deserialize&lt;int32_t&gt;(bytes).value(); assert(value == decoded);   ","version":"0.14","tagName":"h2"},{"title":"String Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/0.14/guide/cpp/supported_types#string-types","content":" Type\tFory TypeId\tNotesstd::string\tSTRING\tUTF-8 encoded std::string_view\tSTRING\tZero-copy view (read) std::u16string\tSTRING\tUTF-16 (converted) binary\tBINARY\tRaw bytes without length  std::string text = &quot;Hello, World!&quot;; auto bytes = fory.serialize(text).value(); auto decoded = fory.deserialize&lt;std::string&gt;(bytes).value(); assert(text == decoded);   ","version":"0.14","tagName":"h2"},{"title":"Collection Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/0.14/guide/cpp/supported_types#collection-types","content":" ","version":"0.14","tagName":"h2"},{"title":"Vector / List‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/0.14/guide/cpp/supported_types#vector--list","content":" std::vector&lt;T&gt; for any serializable element type:  std::vector&lt;int32_t&gt; numbers{1, 2, 3, 4, 5}; auto bytes = fory.serialize(numbers).value(); auto decoded = fory.deserialize&lt;std::vector&lt;int32_t&gt;&gt;(bytes).value(); // Nested vectors std::vector&lt;std::vector&lt;std::string&gt;&gt; nested{ {&quot;a&quot;, &quot;b&quot;}, {&quot;c&quot;, &quot;d&quot;, &quot;e&quot;} };   ","version":"0.14","tagName":"h3"},{"title":"Set‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/0.14/guide/cpp/supported_types#set","content":" std::set&lt;T&gt; and std::unordered_set&lt;T&gt;:  std::set&lt;std::string&gt; tags{&quot;cpp&quot;, &quot;serialization&quot;, &quot;fory&quot;}; auto bytes = fory.serialize(tags).value(); auto decoded = fory.deserialize&lt;std::set&lt;std::string&gt;&gt;(bytes).value(); std::unordered_set&lt;int32_t&gt; ids{1, 2, 3};   ","version":"0.14","tagName":"h3"},{"title":"Map‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/0.14/guide/cpp/supported_types#map","content":" std::map&lt;K, V&gt; and std::unordered_map&lt;K, V&gt;:  std::map&lt;std::string, int32_t&gt; scores{ {&quot;Alice&quot;, 100}, {&quot;Bob&quot;, 95} }; auto bytes = fory.serialize(scores).value(); auto decoded = fory.deserialize&lt;std::map&lt;std::string, int32_t&gt;&gt;(bytes).value(); // Unordered map std::unordered_map&lt;int32_t, std::string&gt; lookup{ {1, &quot;one&quot;}, {2, &quot;two&quot;} };   ","version":"0.14","tagName":"h3"},{"title":"Smart Pointers‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/0.14/guide/cpp/supported_types#smart-pointers","content":" ","version":"0.14","tagName":"h2"},{"title":"std::optional‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/0.14/guide/cpp/supported_types#stdoptional","content":" Nullable wrapper for any type:  std::optional&lt;int32_t&gt; maybe_value = 42; std::optional&lt;int32_t&gt; empty_value = std::nullopt; auto bytes = fory.serialize(maybe_value).value(); auto decoded = fory.deserialize&lt;std::optional&lt;int32_t&gt;&gt;(bytes).value(); assert(decoded.has_value() &amp;&amp; *decoded == 42);   ","version":"0.14","tagName":"h3"},{"title":"std::shared_ptr‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/0.14/guide/cpp/supported_types#stdshared_ptr","content":" Shared ownership with reference tracking:  auto shared = std::make_shared&lt;Person&gt;(&quot;Alice&quot;, 30); auto bytes = fory.serialize(shared).value(); auto decoded = fory.deserialize&lt;std::shared_ptr&lt;Person&gt;&gt;(bytes).value();   With reference tracking enabled (track_ref(true)):  Shared objects are serialized onceReferences to the same object are preservedCircular references are handled automatically  ","version":"0.14","tagName":"h3"},{"title":"std::unique_ptr‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/0.14/guide/cpp/supported_types#stdunique_ptr","content":" Exclusive ownership:  auto unique = std::make_unique&lt;Person&gt;(&quot;Bob&quot;, 25); auto bytes = fory.serialize(unique).value(); auto decoded = fory.deserialize&lt;std::unique_ptr&lt;Person&gt;&gt;(bytes).value();   ","version":"0.14","tagName":"h3"},{"title":"Variant Type‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/0.14/guide/cpp/supported_types#variant-type","content":" std::variant&lt;Ts...&gt; for type-safe unions:  using MyVariant = std::variant&lt;int32_t, std::string, double&gt;; MyVariant v1 = 42; MyVariant v2 = std::string(&quot;hello&quot;); MyVariant v3 = 3.14; auto bytes = fory.serialize(v1).value(); auto decoded = fory.deserialize&lt;MyVariant&gt;(bytes).value(); assert(std::get&lt;int32_t&gt;(decoded) == 42);   ","version":"0.14","tagName":"h2"},{"title":"std::monostate‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/0.14/guide/cpp/supported_types#stdmonostate","content":" Empty variant alternative:  using OptionalInt = std::variant&lt;std::monostate, int32_t&gt;; OptionalInt empty = std::monostate{}; OptionalInt value = 42;   ","version":"0.14","tagName":"h3"},{"title":"Temporal Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/0.14/guide/cpp/supported_types#temporal-types","content":" ","version":"0.14","tagName":"h2"},{"title":"Duration‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/0.14/guide/cpp/supported_types#duration","content":" std::chrono::nanoseconds:  using Duration = std::chrono::nanoseconds; Duration d = std::chrono::seconds(30); auto bytes = fory.serialize(d).value(); auto decoded = fory.deserialize&lt;Duration&gt;(bytes).value();   ","version":"0.14","tagName":"h3"},{"title":"Timestamp‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/0.14/guide/cpp/supported_types#timestamp","content":" Point in time since Unix epoch:  using Timestamp = std::chrono::time_point&lt;std::chrono::system_clock, std::chrono::nanoseconds&gt;; Timestamp now = std::chrono::system_clock::now(); auto bytes = fory.serialize(now).value(); auto decoded = fory.deserialize&lt;Timestamp&gt;(bytes).value();   ","version":"0.14","tagName":"h3"},{"title":"LocalDate‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/0.14/guide/cpp/supported_types#localdate","content":" Days since Unix epoch:  LocalDate date{18628}; // Days since 1970-01-01 auto bytes = fory.serialize(date).value(); auto decoded = fory.deserialize&lt;LocalDate&gt;(bytes).value();   ","version":"0.14","tagName":"h3"},{"title":"User-Defined Structs‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/0.14/guide/cpp/supported_types#user-defined-structs","content":" Any struct can be made serializable with FORY_STRUCT:  struct Point { double x; double y; double z; }; FORY_STRUCT(Point, x, y, z); struct Line { Point start; Point end; std::string label; }; FORY_STRUCT(Line, start, end, label);   ","version":"0.14","tagName":"h2"},{"title":"Enum Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/0.14/guide/cpp/supported_types#enum-types","content":" Both scoped and unscoped enums are supported with FORY_ENUM:  // Scoped enum (C++11 enum class) enum class Color { RED = 0, GREEN = 1, BLUE = 2 }; // Unscoped enum with incontinuous values enum Priority : int32_t { LOW = -10, NORMAL = 0, HIGH = 10 }; FORY_ENUM(Priority, LOW, NORMAL, HIGH); // Usage Color c = Color::GREEN; auto bytes = fory.serialize(c).value(); auto decoded = fory.deserialize&lt;Color&gt;(bytes).value();   ","version":"0.14","tagName":"h2"},{"title":"Unsupported Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/0.14/guide/cpp/supported_types#unsupported-types","content":" Currently not supported:  Raw pointers (T*) - use smart pointers insteadstd::tuple&lt;Ts...&gt; - use structs insteadstd::array&lt;T, N&gt; - use std::vector&lt;T&gt; insteadFunction pointersReferences (T&amp;, const T&amp;) - by value only  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/0.14/guide/cpp/supported_types#related-topics","content":" Basic Serialization - Using these typesType Registration - Registering typesCross-Language - Cross-language compatibility ","version":"0.14","tagName":"h2"},{"title":"Schema Evolution","type":0,"sectionRef":"#","url":"/docs/0.14/guide/cpp/schema_evolution","content":"","keywords":"","version":"0.14"},{"title":"Compatible Mode‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/cpp/schema_evolution#compatible-mode","content":" Enable schema evolution with compatible(true):  #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; // Version 1: Original schema struct PersonV1 { std::string name; int32_t age; }; FORY_STRUCT(PersonV1, name, age); // Version 2: Added email field struct PersonV2 { std::string name; int32_t age; std::string email; // NEW FIELD }; FORY_STRUCT(PersonV2, name, age, email); int main() { // Create separate Fory instances for each schema version auto fory_v1 = Fory::builder() .compatible(true) // Enable schema evolution .xlang(true) .build(); auto fory_v2 = Fory::builder() .compatible(true) .xlang(true) .build(); // Register with the SAME type ID for schema evolution constexpr uint32_t PERSON_TYPE_ID = 100; fory_v1.register_struct&lt;PersonV1&gt;(PERSON_TYPE_ID); fory_v2.register_struct&lt;PersonV2&gt;(PERSON_TYPE_ID); // Serialize with V1 PersonV1 v1{&quot;Alice&quot;, 30}; auto bytes = fory_v1.serialize(v1).value(); // Deserialize as V2 - email gets default value (empty string) auto v2 = fory_v2.deserialize&lt;PersonV2&gt;(bytes).value(); assert(v2.name == &quot;Alice&quot;); assert(v2.age == 30); assert(v2.email == &quot;&quot;); // Default value for missing field return 0; }   ","version":"0.14","tagName":"h2"},{"title":"Schema Evolution Features‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/cpp/schema_evolution#schema-evolution-features","content":" Compatible mode supports the following schema changes:  Change Type\tSupport\tBehaviorAdd new fields\t‚úÖ\tMissing fields use default values Remove fields\t‚úÖ\tExtra fields are skipped Reorder fields\t‚úÖ\tFields matched by name, not position Change nullability\t‚úÖ\tT ‚Üî std::optional&lt;T&gt; Change field types\t‚ùå\tTypes must be compatible Rename fields\t‚ùå\tField names must match (case-sensitive)  ","version":"0.14","tagName":"h2"},{"title":"Adding Fields (Backward Compatibility)‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/cpp/schema_evolution#adding-fields-backward-compatibility","content":" When deserializing old data with a new schema that has additional fields:  // Old schema (V1) struct ProductV1 { std::string name; double price; }; FORY_STRUCT(ProductV1, name, price); // New schema (V2) with additional fields struct ProductV2 { std::string name; double price; std::vector&lt;std::string&gt; tags; // NEW std::map&lt;std::string, std::string&gt; attributes; // NEW }; FORY_STRUCT(ProductV2, name, price, tags, attributes); // Serialize V1 ProductV1 v1{&quot;Laptop&quot;, 999.99}; auto bytes = fory_v1.serialize(v1).value(); // Deserialize as V2 auto v2 = fory_v2.deserialize&lt;ProductV2&gt;(bytes).value(); assert(v2.name == &quot;Laptop&quot;); assert(v2.price == 999.99); assert(v2.tags.empty()); // Default: empty vector assert(v2.attributes.empty()); // Default: empty map   ","version":"0.14","tagName":"h2"},{"title":"Removing Fields (Forward Compatibility)‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/cpp/schema_evolution#removing-fields-forward-compatibility","content":" When deserializing new data with an old schema that has fewer fields:  // Full schema struct UserFull { int64_t id; std::string username; std::string email; std::string password_hash; int32_t login_count; }; FORY_STRUCT(UserFull, id, username, email, password_hash, login_count); // Minimal schema (removed 3 fields) struct UserMinimal { int64_t id; std::string username; }; FORY_STRUCT(UserMinimal, id, username); // Serialize full version UserFull full{12345, &quot;johndoe&quot;, &quot;john@example.com&quot;, &quot;hash123&quot;, 42}; auto bytes = fory_full.serialize(full).value(); // Deserialize as minimal - extra fields are skipped auto minimal = fory_minimal.deserialize&lt;UserMinimal&gt;(bytes).value(); assert(minimal.id == 12345); assert(minimal.username == &quot;johndoe&quot;); // email, password_hash, login_count are skipped   ","version":"0.14","tagName":"h2"},{"title":"Field Reordering‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/cpp/schema_evolution#field-reordering","content":" In compatible mode, fields are matched by name, not by position:  // Original field order struct ConfigOriginal { std::string host; int32_t port; bool enable_ssl; std::string protocol; }; FORY_STRUCT(ConfigOriginal, host, port, enable_ssl, protocol); // Reordered fields struct ConfigReordered { bool enable_ssl; // Moved to first std::string protocol; // Moved to second std::string host; // Moved to third int32_t port; // Moved to last }; FORY_STRUCT(ConfigReordered, enable_ssl, protocol, host, port); // Serialize with original order ConfigOriginal orig{&quot;localhost&quot;, 8080, true, &quot;https&quot;}; auto bytes = fory_orig.serialize(orig).value(); // Deserialize with different field order - works correctly auto reordered = fory_reord.deserialize&lt;ConfigReordered&gt;(bytes).value(); assert(reordered.host == &quot;localhost&quot;); assert(reordered.port == 8080); assert(reordered.enable_ssl == true); assert(reordered.protocol == &quot;https&quot;);   ","version":"0.14","tagName":"h2"},{"title":"Nested Struct Evolution‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/cpp/schema_evolution#nested-struct-evolution","content":" Schema evolution works recursively for nested structs:  // V1 Address struct AddressV1 { std::string street; std::string city; }; FORY_STRUCT(AddressV1, street, city); // V2 Address with new fields struct AddressV2 { std::string street; std::string city; std::string country; // NEW std::string zipcode; // NEW }; FORY_STRUCT(AddressV2, street, city, country, zipcode); // V1 Employee with V1 Address struct EmployeeV1 { std::string name; AddressV1 home_address; }; FORY_STRUCT(EmployeeV1, name, home_address); // V2 Employee with V2 Address and new field struct EmployeeV2 { std::string name; AddressV2 home_address; // Nested struct evolved std::string employee_id; // NEW }; FORY_STRUCT(EmployeeV2, name, home_address, employee_id); // Register types with same IDs constexpr uint32_t ADDRESS_TYPE_ID = 100; constexpr uint32_t EMPLOYEE_TYPE_ID = 101; fory_v1.register_struct&lt;AddressV1&gt;(ADDRESS_TYPE_ID); fory_v1.register_struct&lt;EmployeeV1&gt;(EMPLOYEE_TYPE_ID); fory_v2.register_struct&lt;AddressV2&gt;(ADDRESS_TYPE_ID); fory_v2.register_struct&lt;EmployeeV2&gt;(EMPLOYEE_TYPE_ID); // Serialize V1 EmployeeV1 emp_v1{&quot;Jane Doe&quot;, {&quot;123 Main St&quot;, &quot;NYC&quot;}}; auto bytes = fory_v1.serialize(emp_v1).value(); // Deserialize as V2 auto emp_v2 = fory_v2.deserialize&lt;EmployeeV2&gt;(bytes).value(); assert(emp_v2.name == &quot;Jane Doe&quot;); assert(emp_v2.home_address.street == &quot;123 Main St&quot;); assert(emp_v2.home_address.city == &quot;NYC&quot;); assert(emp_v2.home_address.country == &quot;&quot;); // Default assert(emp_v2.home_address.zipcode == &quot;&quot;); // Default assert(emp_v2.employee_id == &quot;&quot;); // Default   ","version":"0.14","tagName":"h2"},{"title":"Bidirectional Evolution‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/cpp/schema_evolution#bidirectional-evolution","content":" Schema evolution works in both directions:  // V2 -&gt; V1 (downgrade) PersonV2 v2{&quot;Charlie&quot;, 35, &quot;charlie@example.com&quot;}; auto bytes = fory_v2.serialize(v2).value(); auto v1 = fory_v1.deserialize&lt;PersonV1&gt;(bytes).value(); assert(v1.name == &quot;Charlie&quot;); assert(v1.age == 35); // email field is discarded during deserialization   ","version":"0.14","tagName":"h2"},{"title":"Default Values‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/cpp/schema_evolution#default-values","content":" When fields are missing, C++ default initialization is used:  Type\tDefault Valueint8_t, int16_t...\t0 float, double\t0.0 bool\tfalse std::string\t&quot;&quot; std::vector&lt;T&gt;\tEmpty vector std::map&lt;K,V&gt;\tEmpty map std::set&lt;T&gt;\tEmpty set std::optional&lt;T&gt;\tstd::nullopt Struct types\tDefault-constructed  ","version":"0.14","tagName":"h2"},{"title":"Schema Consistent Mode (Default)‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/cpp/schema_evolution#schema-consistent-mode-default","content":" Without compatible mode, schemas must match exactly:  // Strict mode (default) auto fory = Fory::builder() .compatible(false) // Default: schema must match .xlang(true) .build(); // Serialization/deserialization requires identical schemas // Schema mismatches may cause errors or undefined behavior   Use SchemaConsistent mode when:  Schemas are guaranteed to match (same binary version)Maximum performance is required (less metadata overhead)You control both serialization and deserialization  Use Compatible mode when:  Schemas may evolve independentlyCross-version compatibility is requiredDifferent services may have different schema versions  ","version":"0.14","tagName":"h2"},{"title":"Type ID Requirements‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/cpp/schema_evolution#type-id-requirements","content":" For schema evolution to work:  Same Type ID: Different versions of the same struct must use the same type IDConsistent IDs: Type IDs must be consistent across all Fory instancesRegister All Versions: Each Fory instance registers its own struct version  constexpr uint32_t PERSON_TYPE_ID = 100; // Instance 1 uses PersonV1 fory_v1.register_struct&lt;PersonV1&gt;(PERSON_TYPE_ID); // Instance 2 uses PersonV2 fory_v2.register_struct&lt;PersonV2&gt;(PERSON_TYPE_ID); // Same type ID enables schema evolution   ","version":"0.14","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/cpp/schema_evolution#best-practices","content":" ","version":"0.14","tagName":"h2"},{"title":"1. Plan for Evolution‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/cpp/schema_evolution#1-plan-for-evolution","content":" Design schemas with future changes in mind:  // Good: Use optional for fields that might be removed struct Config { std::string host; int32_t port; std::optional&lt;std::string&gt; deprecated_field; // Can be removed later };   ","version":"0.14","tagName":"h3"},{"title":"2. Use Meaningful Default Values‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/cpp/schema_evolution#2-use-meaningful-default-values","content":" Consider what default values make sense for new fields:  struct Settings { int32_t timeout_ms; // Default: 0 (might want a sensible default) bool enabled; // Default: false std::string mode; // Default: &quot;&quot; (might want &quot;default&quot;) };   ","version":"0.14","tagName":"h3"},{"title":"3. Document Schema Versions‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/cpp/schema_evolution#3-document-schema-versions","content":" Track schema changes for debugging:  // V1: Initial schema (2024-01-01) // V2: Added email field (2024-02-01) // V3: Added phone, address fields (2024-03-01)   ","version":"0.14","tagName":"h3"},{"title":"4. Test Evolution Paths‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/cpp/schema_evolution#4-test-evolution-paths","content":" Test both upgrade and downgrade scenarios:  // Test V1 -&gt; V2 // Test V2 -&gt; V1 // Test V1 -&gt; V3 // Test V3 -&gt; V1   ","version":"0.14","tagName":"h3"},{"title":"Cross-Language Schema Evolution‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/cpp/schema_evolution#cross-language-schema-evolution","content":" Schema evolution works across languages when using xlang mode:  // C++ with compatible mode auto fory = Fory::builder() .compatible(true) .xlang(true) .build();   // Java with compatible mode Fory fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .withLanguage(Language.XLANG) .build();   Both instances can exchange data even with different schema versions.  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/cpp/schema_evolution#related-topics","content":" Configuration - Enabling compatible modeType Registration - Type ID managementCross-Language - Cross-language considerations ","version":"0.14","tagName":"h2"},{"title":"Development","type":0,"sectionRef":"#","url":"/docs/0.14/guide/development","content":"","keywords":"","version":"0.14"},{"title":"How to build Apache Fory‚Ñ¢‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.14/guide/development#how-to-build-apache-fory","content":" Please checkout the source tree from https://github.com/apache/fory.  ","version":"0.14","tagName":"h2"},{"title":"Build Apache Fory‚Ñ¢ Java‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.14/guide/development#build-apache-fory-java","content":" cd java mvn clean compile -DskipTests   Environment Requirements‚Äã  java 1.8+maven 3.6.3+  ","version":"0.14","tagName":"h3"},{"title":"Build Apache Fory‚Ñ¢ Python‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.14/guide/development#build-apache-fory-python","content":" cd python # Uninstall numpy first so that when we install pyarrow, it will install the correct numpy version automatically. # For Python versions less than 3.13, numpy 2 is not currently supported. pip uninstall -y numpy # Install necessary environment for Python &lt; 3.13. pip install pyarrow Cython wheel pytest # pip install pyarrow Cython wheel pytest pip install -v -e .   Environment Requirements‚Äã  python 3.6+  ","version":"0.14","tagName":"h3"},{"title":"Build Apache Fory‚Ñ¢ C++‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.14/guide/development#build-apache-fory-c","content":" Build fory row formatÔºö  bazel build //cpp/fory/row:fory_row_format   Build fory row format encoder:  bazel build //cpp/fory/encoder:fory_encoder   Environment Requirements‚Äã  compilers with C++17 supportbazel 6.3.2  ","version":"0.14","tagName":"h3"},{"title":"Build Apache Fory‚Ñ¢ GoLang‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.14/guide/development#build-apache-fory-golang","content":" cd go/fory # run test go test -v ./... # run xlang test go test -v fory_xlang_test.go   Environment Requirements‚Äã  go 1.13+  ","version":"0.14","tagName":"h3"},{"title":"Build Apache Fory‚Ñ¢ Rust‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.14/guide/development#build-apache-fory-rust","content":" cd rust # build cargo build # run test cargo test # run specific test cargo test -p tests --test $test_file $test_method # run specific test under subdirectory cargo test --test mod $dir$::$test_file::$test_method # debug specific test under subdirectory and get backtrace RUST_BACKTRACE=1 FORY_PANIC_ON_ERROR=1 cargo test --test mod $dir$::$test_file::$test_method # inspect generated code by fory derive macro cargo expand --test mod $mod$::$file$ &gt; expanded.rs   Environment Requirements‚Äã  curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh   ","version":"0.14","tagName":"h3"},{"title":"Build Apache Fory‚Ñ¢ JavaScript‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.14/guide/development#build-apache-fory-javascript","content":" cd javascript npm install # run build npm run build # run test npm run test   Environment Requirements‚Äã  node 14+npm 8+  ","version":"0.14","tagName":"h3"},{"title":"Lint Markdown Docs‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.14/guide/development#lint-markdown-docs","content":" # Install prettier globally npm install -g prettier # Fix markdown files prettier --write &quot;**/*.md&quot;   Environment Requirements‚Äã  node 14+npm 8+  ","version":"0.14","tagName":"h3"},{"title":"Contributing‚Äã","type":1,"pageTitle":"Development","url":"/docs/0.14/guide/development#contributing","content":" For more information, please refer to How to contribute to Apache Fory‚Ñ¢. ","version":"0.14","tagName":"h2"},{"title":"Row Format","type":0,"sectionRef":"#","url":"/docs/0.14/guide/cpp/row_format","content":"","keywords":"","version":"0.14"},{"title":"Overview‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#overview","content":" Apache Fory‚Ñ¢ Row Format is a binary format optimized for:  Random Access: Read any field without deserializing the entire objectZero-Copy: Direct memory access without data copyingCache-Friendly: Contiguous memory layout for CPU cache efficiencyColumnar Conversion: Easy conversion to Apache Arrow formatPartial Serialization: Serialize only needed fields  ","version":"0.14","tagName":"h2"},{"title":"When to Use Row Format‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#when-to-use-row-format","content":" Use Case\tRow Format\tObject GraphAnalytics/OLAP\t‚úÖ\t‚ùå Random field access\t‚úÖ\t‚ùå Full object serialization\t‚ùå\t‚úÖ Complex object graphs\t‚ùå\t‚úÖ Reference tracking\t‚ùå\t‚úÖ Cross-language (simple types)\t‚úÖ\t‚úÖ  ","version":"0.14","tagName":"h2"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#quick-start","content":" #include &quot;fory/encoder/row_encoder.h&quot; #include &quot;fory/row/writer.h&quot; using namespace fory::row; using namespace fory::row::encoder; // Define a struct struct Person { int32_t id; std::string name; float score; }; // Register field metadata (required for row encoding) FORY_FIELD_INFO(Person, id, name, score); int main() { // Create encoder RowEncoder&lt;Person&gt; encoder; // Encode a person Person person{1, &quot;Alice&quot;, 95.5f}; encoder.Encode(person); // Get the encoded row auto row = encoder.GetWriter().ToRow(); // Random access to fields int32_t id = row-&gt;GetInt32(0); std::string name = row-&gt;GetString(1); float score = row-&gt;GetFloat(2); assert(id == 1); assert(name == &quot;Alice&quot;); assert(score == 95.5f); return 0; }   ","version":"0.14","tagName":"h2"},{"title":"Row Encoder‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#row-encoder","content":" ","version":"0.14","tagName":"h2"},{"title":"Basic Usage‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#basic-usage","content":" The RowEncoder&lt;T&gt; template class provides type-safe encoding:  #include &quot;fory/encoder/row_encoder.h&quot; // Define struct with FORY_FIELD_INFO struct Point { double x; double y; }; FORY_FIELD_INFO(Point, x, y); // Create encoder RowEncoder&lt;Point&gt; encoder; // Access schema (for inspection) const Schema&amp; schema = encoder.GetSchema(); std::cout &lt;&lt; &quot;Fields: &quot; &lt;&lt; schema.field_names().size() &lt;&lt; std::endl; // Encode value Point p{1.0, 2.0}; encoder.Encode(p); // Get result as Row auto row = encoder.GetWriter().ToRow();   ","version":"0.14","tagName":"h3"},{"title":"Nested Structs‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#nested-structs","content":" struct Address { std::string city; std::string country; }; FORY_FIELD_INFO(Address, city, country); struct Person { std::string name; Address address; }; FORY_FIELD_INFO(Person, name, address); // Encode nested struct RowEncoder&lt;Person&gt; encoder; Person person{&quot;Alice&quot;, {&quot;New York&quot;, &quot;USA&quot;}}; encoder.Encode(person); auto row = encoder.GetWriter().ToRow(); std::string name = row-&gt;GetString(0); // Access nested struct auto address_row = row-&gt;GetStruct(1); std::string city = address_row-&gt;GetString(0); std::string country = address_row-&gt;GetString(1);   ","version":"0.14","tagName":"h3"},{"title":"Arrays / Lists‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#arrays--lists","content":" struct Record { std::vector&lt;int32_t&gt; values; std::string label; }; FORY_FIELD_INFO(Record, values, label); RowEncoder&lt;Record&gt; encoder; Record record{{1, 2, 3, 4, 5}, &quot;test&quot;}; encoder.Encode(record); auto row = encoder.GetWriter().ToRow(); auto array = row-&gt;GetArray(0); int count = array-&gt;num_elements(); for (int i = 0; i &lt; count; i++) { int32_t value = array-&gt;GetInt32(i); }   ","version":"0.14","tagName":"h3"},{"title":"Encoding Arrays Directly‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#encoding-arrays-directly","content":" // Encode a vector directly (not inside a struct) std::vector&lt;Person&gt; people{ {&quot;Alice&quot;, {&quot;NYC&quot;, &quot;USA&quot;}}, {&quot;Bob&quot;, {&quot;London&quot;, &quot;UK&quot;}} }; RowEncoder&lt;decltype(people)&gt; encoder; encoder.Encode(people); // Get array data auto array = encoder.GetWriter().CopyToArrayData(); auto first_person = array-&gt;GetStruct(0); std::string first_name = first_person-&gt;GetString(0);   ","version":"0.14","tagName":"h3"},{"title":"Row Data Access‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#row-data-access","content":" ","version":"0.14","tagName":"h2"},{"title":"Row Class‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#row-class","content":" The Row class provides random access to struct fields:  class Row { public: // Null check bool IsNullAt(int i) const; // Primitive getters bool GetBoolean(int i) const; int8_t GetInt8(int i) const; int16_t GetInt16(int i) const; int32_t GetInt32(int i) const; int64_t GetInt64(int i) const; float GetFloat(int i) const; double GetDouble(int i) const; // String/binary getter std::string GetString(int i) const; std::vector&lt;uint8_t&gt; GetBinary(int i) const; // Nested types std::shared_ptr&lt;Row&gt; GetStruct(int i) const; std::shared_ptr&lt;ArrayData&gt; GetArray(int i) const; std::shared_ptr&lt;MapData&gt; GetMap(int i) const; // Metadata int num_fields() const; SchemaPtr schema() const; // Debug std::string ToString() const; };   ","version":"0.14","tagName":"h3"},{"title":"ArrayData Class‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#arraydata-class","content":" The ArrayData class provides access to list/array elements:  class ArrayData { public: // Null check bool IsNullAt(int i) const; // Element count int num_elements() const; // Primitive getters (same as Row) int32_t GetInt32(int i) const; // ... other primitives // String getter std::string GetString(int i) const; // Nested types std::shared_ptr&lt;Row&gt; GetStruct(int i) const; std::shared_ptr&lt;ArrayData&gt; GetArray(int i) const; std::shared_ptr&lt;MapData&gt; GetMap(int i) const; // Type info ListTypePtr type() const; };   ","version":"0.14","tagName":"h3"},{"title":"MapData Class‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#mapdata-class","content":" The MapData class provides access to map key-value pairs:  class MapData { public: // Element count int num_elements(); // Access keys and values as arrays std::shared_ptr&lt;ArrayData&gt; keys_array(); std::shared_ptr&lt;ArrayData&gt; values_array(); // Type info MapTypePtr type(); };   ","version":"0.14","tagName":"h3"},{"title":"Schema and Types‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#schema-and-types","content":" ","version":"0.14","tagName":"h2"},{"title":"Schema Definition‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#schema-definition","content":" Schemas define the structure of row data:  #include &quot;fory/row/schema.h&quot; using namespace fory::row; // Create schema programmatically auto person_schema = schema({ field(&quot;id&quot;, int32()), field(&quot;name&quot;, utf8()), field(&quot;score&quot;, float32()), field(&quot;active&quot;, boolean()) }); // Access schema info for (const auto&amp; f : person_schema-&gt;fields()) { std::cout &lt;&lt; f-&gt;name() &lt;&lt; &quot;: &quot; &lt;&lt; f-&gt;type()-&gt;name() &lt;&lt; std::endl; }   ","version":"0.14","tagName":"h3"},{"title":"Type System‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#type-system","content":" Available types for row format:  // Primitive types DataTypePtr boolean(); // bool DataTypePtr int8(); // int8_t DataTypePtr int16(); // int16_t DataTypePtr int32(); // int32_t DataTypePtr int64(); // int64_t DataTypePtr float32(); // float DataTypePtr float64(); // double // String and binary DataTypePtr utf8(); // std::string DataTypePtr binary(); // std::vector&lt;uint8_t&gt; // Complex types DataTypePtr list(DataTypePtr element_type); DataTypePtr map(DataTypePtr key_type, DataTypePtr value_type); DataTypePtr struct_(std::vector&lt;FieldPtr&gt; fields);   ","version":"0.14","tagName":"h3"},{"title":"Type Inference‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#type-inference","content":" The RowEncodeTrait template automatically infers types:  // Type inference for primitives RowEncodeTrait&lt;int32_t&gt;::Type(); // Returns int32() RowEncodeTrait&lt;float&gt;::Type(); // Returns float32() RowEncodeTrait&lt;std::string&gt;::Type(); // Returns utf8() // Type inference for collections RowEncodeTrait&lt;std::vector&lt;int32_t&gt;&gt;::Type(); // Returns list(int32()) // Type inference for maps RowEncodeTrait&lt;std::map&lt;std::string, int32_t&gt;&gt;::Type(); // Returns map(utf8(), int32()) // Type inference for structs (requires FORY_FIELD_INFO) RowEncodeTrait&lt;Person&gt;::Type(); // Returns struct_({...}) RowEncodeTrait&lt;Person&gt;::Schema(); // Returns schema({...})   ","version":"0.14","tagName":"h3"},{"title":"Row Writer‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#row-writer","content":" ","version":"0.14","tagName":"h2"},{"title":"RowWriter‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#rowwriter","content":" For manual row construction:  #include &quot;fory/row/writer.h&quot; // Create schema auto my_schema = schema({ field(&quot;x&quot;, int32()), field(&quot;y&quot;, float64()), field(&quot;name&quot;, utf8()) }); // Create writer RowWriter writer(my_schema); writer.Reset(); // Write fields writer.Write(0, 42); // x = 42 writer.Write(1, 3.14); // y = 3.14 writer.WriteString(2, &quot;test&quot;); // name = &quot;test&quot; // Get result auto row = writer.ToRow();   ","version":"0.14","tagName":"h3"},{"title":"ArrayWriter‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#arraywriter","content":" For manual array construction:  // Create array type auto array_type = list(int32()); // Create writer ArrayWriter writer(array_type); writer.Reset(5); // 5 elements // Write elements for (int i = 0; i &lt; 5; i++) { writer.Write(i, i * 10); } // Get result auto array = writer.CopyToArrayData();   ","version":"0.14","tagName":"h3"},{"title":"Null Values‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#null-values","content":" // Set null at specific index writer.SetNullAt(2); // Field 2 is null // Check null when reading if (!row-&gt;IsNullAt(2)) { std::string value = row-&gt;GetString(2); }   ","version":"0.14","tagName":"h3"},{"title":"Memory Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#memory-layout","content":" ","version":"0.14","tagName":"h2"},{"title":"Row Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#row-layout","content":" +------------------+--------------------+--------------------+ | Null Bitmap | Fixed-Size Data | Variable-Size Data | +------------------+--------------------+--------------------+ | ceil(n/8) B | 8 * n bytes | variable | +------------------+--------------------+--------------------+   Null Bitmap: One bit per field, indicates null valuesFixed-Size Data: 8 bytes per field (primitives stored directly, offset+size for variable)Variable-Size Data: Strings, arrays, nested structs  ","version":"0.14","tagName":"h3"},{"title":"Array Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#array-layout","content":" +------------+------------------+--------------------+--------------------+ | Num Elems | Null Bitmap | Fixed-Size Data | Variable-Size Data | +------------+------------------+--------------------+--------------------+ | 8 bytes | ceil(n/8) bytes | elem_size * n | variable | +------------+------------------+--------------------+--------------------+   ","version":"0.14","tagName":"h3"},{"title":"Map Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#map-layout","content":" +------------------+------------------+ | Keys Array | Values Array | +------------------+------------------+   ","version":"0.14","tagName":"h3"},{"title":"Performance Tips‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#performance-tips","content":" ","version":"0.14","tagName":"h2"},{"title":"1. Reuse Encoders‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#1-reuse-encoders","content":" RowEncoder&lt;Person&gt; encoder; // Encode multiple records for (const auto&amp; person : people) { encoder.Encode(person); auto row = encoder.GetWriter().ToRow(); // Process row... }   ","version":"0.14","tagName":"h3"},{"title":"2. Pre-allocate Buffer‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#2-pre-allocate-buffer","content":" // Get buffer reference for pre-allocation auto&amp; buffer = encoder.GetWriter().buffer(); buffer-&gt;Reserve(expected_size);   ","version":"0.14","tagName":"h3"},{"title":"3. Batch Processing‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#3-batch-processing","content":" // Process in batches for better cache utilization std::vector&lt;Person&gt; batch; batch.reserve(BATCH_SIZE); while (hasMore()) { batch.clear(); fillBatch(batch); for (const auto&amp; person : batch) { encoder.Encode(person); process(encoder.GetWriter().ToRow()); } }   ","version":"0.14","tagName":"h3"},{"title":"4. Zero-Copy Reading‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#4-zero-copy-reading","content":" // Point to existing buffer (zero-copy) Row row(schema); row.PointTo(buffer, offset, size); // Access fields directly from buffer int32_t id = row.GetInt32(0);   ","version":"0.14","tagName":"h3"},{"title":"Supported Types Summary‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#supported-types-summary","content":" C++ Type\tRow Type\tFixed Sizebool\tboolean()\t1 byte int8_t\tint8()\t1 byte int16_t\tint16()\t2 bytes int32_t\tint32()\t4 bytes int64_t\tint64()\t8 bytes float\tfloat32()\t4 bytes double\tfloat64()\t8 bytes std::string\tutf8()\tVariable std::vector&lt;T&gt;\tlist(T)\tVariable std::map&lt;K,V&gt;\tmap(K,V)\tVariable std::optional&lt;T&gt;\tInner type\tNullable Struct (FORY_FIELD_INFO)\tstruct_({...})\tVariable  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/cpp/row_format#related-topics","content":" Basic Serialization - Object graph serializationConfiguration - Builder optionsSupported Types - All supported types ","version":"0.14","tagName":"h2"},{"title":"Java Serialization Guide","type":0,"sectionRef":"#","url":"/docs/0.14/guide/java/","content":"","keywords":"","version":"0.14"},{"title":"Features‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.14/guide/java/#features","content":" ","version":"0.14","tagName":"h2"},{"title":"High Performance‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.14/guide/java/#high-performance","content":" JIT Code Generation: Highly-extensible JIT framework generates serializer code at runtime using async multi-threaded compilation, delivering 20-170x speedup through: Inlining variables to reduce memory accessInlining method calls to eliminate virtual dispatch overheadMinimizing conditional branchingEliminating hash lookups Zero-Copy: Direct memory access without intermediate buffer copies; row format supports random access and partial serializationVariable-Length Encoding: Optimized compression for integers, longsMeta Sharing: Cached class metadata reduces redundant type informationSIMD Acceleration: Java Vector API support for array operations (Java 16+)  ","version":"0.14","tagName":"h3"},{"title":"Drop-in Replacement‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.14/guide/java/#drop-in-replacement","content":" 100% JDK Serialization Compatible: Supports writeObject/readObject/writeReplace/readResolve/readObjectNoData/ExternalizableJava 8-24 Support: Works across all modern Java versions including Java 17+ recordsGraalVM Native Image: AOT compilation support without reflection configuration  ","version":"0.14","tagName":"h3"},{"title":"Advanced Features‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.14/guide/java/#advanced-features","content":" Reference Tracking: Automatic handling of shared and circular referencesSchema Evolution: Forward/backward compatibility for class schema changesPolymorphism: Full support for inheritance hierarchies and interfacesDeep Copy: Efficient deep cloning of complex object graphs with reference preservationSecurity: Class registration and configurable deserialization policies  ","version":"0.14","tagName":"h3"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.14/guide/java/#quick-start","content":" Note that Fory creation is not cheap, the Fory instances should be reused between serializations instead of creating it every time. You should keep Fory as a static global variable, or instance variable of some singleton object or limited objects.  ","version":"0.14","tagName":"h2"},{"title":"Single-Thread Usage‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.14/guide/java/#single-thread-usage","content":" import java.util.List; import java.util.Arrays; import org.apache.fory.*; import org.apache.fory.config.*; public class Example { public static void main(String[] args) { SomeClass object = new SomeClass(); // Note that Fory instances should be reused between // multiple serializations of different objects. Fory fory = Fory.builder().withLanguage(Language.JAVA) .requireClassRegistration(true) .build(); // Registering types can reduce class name serialization overhead, but not mandatory. // If class registration enabled, all custom types must be registered. // Registration order must be consistent if id is not specified fory.register(SomeClass.class); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes)); } }   ","version":"0.14","tagName":"h3"},{"title":"Multi-Thread Usage‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.14/guide/java/#multi-thread-usage","content":" import java.util.List; import java.util.Arrays; import org.apache.fory.*; import org.apache.fory.config.*; public class Example { public static void main(String[] args) { SomeClass object = new SomeClass(); // Note that Fory instances should be reused between // multiple serializations of different objects. ThreadSafeFory fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().withLanguage(Language.JAVA) .withClassLoader(classLoader).build(); f.register(SomeClass.class, 1); return f; }); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes)); } }   ","version":"0.14","tagName":"h3"},{"title":"Fory Instance Reuse Pattern‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.14/guide/java/#fory-instance-reuse-pattern","content":" import java.util.List; import java.util.Arrays; import org.apache.fory.*; import org.apache.fory.config.*; public class Example { // reuse fory. private static final ThreadSafeFory fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().withLanguage(Language.JAVA) .withClassLoader(classLoader).build(); f.register(SomeClass.class, 1); return f; }); public static void main(String[] args) { SomeClass object = new SomeClass(); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes)); } }   ","version":"0.14","tagName":"h3"},{"title":"Thread Safety‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.14/guide/java/#thread-safety","content":" Fory provides multiple options for thread-safe serialization:  ","version":"0.14","tagName":"h2"},{"title":"ThreadLocalFory‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.14/guide/java/#threadlocalfory","content":" Uses thread-local storage to maintain separate Fory instances per thread:  ThreadSafeFory fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().withLanguage(Language.JAVA) .withClassLoader(classLoader).build(); f.register(SomeClass.class, 1); return f; }); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes));   ","version":"0.14","tagName":"h3"},{"title":"ThreadSafeForyPool‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.14/guide/java/#threadsafeforypool","content":" For virtual threads or environments where thread-local storage is not appropriate, use buildThreadSafeForyPool:  ThreadSafeFory fory = Fory.builder() .withLanguage(Language.JAVA) .withRefTracking(false) .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT) .withAsyncCompilation(true) .buildThreadSafeForyPool(minPoolSize, maxPoolSize);   Note that calling buildThreadSafeFory() on ForyBuilder will create an instance of ThreadLocalFory. This may not be appropriate in environments where virtual threads are used, as each thread will create its own Fory instance, a relatively expensive operation. An alternative for virtual threads is to use buildThreadSafeForyPool.  ","version":"0.14","tagName":"h3"},{"title":"Builder Methods‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.14/guide/java/#builder-methods","content":" // Single-thread Fory Fory fory = Fory.builder() .withLanguage(Language.JAVA) .withRefTracking(false) .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT) .withAsyncCompilation(true) .build(); // Thread-safe Fory (ThreadLocalFory) ThreadSafeFory fory = Fory.builder() .withLanguage(Language.JAVA) .withRefTracking(false) .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT) .withAsyncCompilation(true) .buildThreadSafeFory();   ","version":"0.14","tagName":"h3"},{"title":"Next Steps‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/0.14/guide/java/#next-steps","content":" Configuration Options - Learn about ForyBuilder optionsBasic Serialization - Detailed serialization patternsType Registration - Class registration and securityCustom Serializers - Implement custom serializersCross-Language Serialization - Serialize data for other languages ","version":"0.14","tagName":"h2"},{"title":"GraalVM Guide","type":0,"sectionRef":"#","url":"/docs/0.14/guide/graalvm_serialization","content":"","keywords":"","version":"0.14"},{"title":"GraalVM Native Image‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/0.14/guide/graalvm_serialization#graalvm-native-image","content":" GraalVM native image compiles Java code into native executables ahead-of-time, resulting in faster startup and lower memory usage. However, native images don't support runtime JIT compilation or reflection without explicit configuration.  Apache Fory‚Ñ¢ works excellently with GraalVM native image by using codegen instead of reflection. All serializer code is generated at build time, eliminating the need for reflection configuration files in most cases.  ","version":"0.14","tagName":"h2"},{"title":"How It Works‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/0.14/guide/graalvm_serialization#how-it-works","content":" Fory generates serialization code at GraalVM build time when you:  Create Fory as a static fieldRegister all classes in a static initializerCall fory.ensureSerializersCompiled() to compile serializersConfigure the class to initialize at build time via native-image.properties  The main benefit: You don't need to configure reflection json or serialization json for most serializable classes.  Note: Fory's asyncCompilationEnabled option is automatically disabled for GraalVM native image since runtime JIT is not supported.  ","version":"0.14","tagName":"h2"},{"title":"Basic Usage‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/0.14/guide/graalvm_serialization#basic-usage","content":" ","version":"0.14","tagName":"h2"},{"title":"Step 1: Create Fory and Register Classes‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/0.14/guide/graalvm_serialization#step-1-create-fory-and-register-classes","content":" import org.apache.fory.Fory; public class Example { // Must be static field static Fory fory; static { fory = Fory.builder().build(); fory.register(MyClass.class); fory.register(AnotherClass.class); // Compile all serializers at build time fory.ensureSerializersCompiled(); } public static void main(String[] args) { byte[] bytes = fory.serialize(new MyClass()); MyClass obj = (MyClass) fory.deserialize(bytes); } }   ","version":"0.14","tagName":"h3"},{"title":"Step 2: Configure Build-Time Initialization‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/0.14/guide/graalvm_serialization#step-2-configure-build-time-initialization","content":" Create resources/META-INF/native-image/your-group/your-artifact/native-image.properties:  Args = --initialize-at-build-time=com.example.Example   ","version":"0.14","tagName":"h3"},{"title":"ForyGraalVMFeature (Optional)‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/0.14/guide/graalvm_serialization#forygraalvmfeature-optional","content":" For most types with public constructors, the basic setup above is sufficient. However, some advanced cases require reflection registration:  Private constructors (classes without accessible no-arg constructor)Private inner classes/recordsDynamic proxy serialization  The fory-graalvm-feature module automatically handles these cases, eliminating the need for manual reflect-config.json configuration.  ","version":"0.14","tagName":"h2"},{"title":"Adding the Dependency‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/0.14/guide/graalvm_serialization#adding-the-dependency","content":" &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-graalvm-feature&lt;/artifactId&gt; &lt;version&gt;${fory.version}&lt;/version&gt; &lt;/dependency&gt;   ","version":"0.14","tagName":"h3"},{"title":"Enabling the Feature‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/0.14/guide/graalvm_serialization#enabling-the-feature","content":" Add to your native-image.properties:  Args = --initialize-at-build-time=com.example.Example \\ --features=org.apache.fory.graalvm.feature.ForyGraalVMFeature   ","version":"0.14","tagName":"h3"},{"title":"What ForyGraalVMFeature Handles‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/0.14/guide/graalvm_serialization#what-forygraalvmfeature-handles","content":" Scenario\tWithout Feature\tWith FeaturePublic classes with no-arg ctor\t‚úÖ Works\t‚úÖ Works Private constructors\t‚ùå Needs reflect-config.json\t‚úÖ Auto-registered Private inner records\t‚ùå Needs reflect-config.json\t‚úÖ Auto-registered Dynamic proxies\t‚ùå Needs manual config\t‚úÖ Auto-registered  ","version":"0.14","tagName":"h3"},{"title":"Example with Private Record‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/0.14/guide/graalvm_serialization#example-with-private-record","content":" public class Example { // Private inner record - requires ForyGraalVMFeature private record PrivateRecord(int id, String name) {} static Fory fory; static { fory = Fory.builder().build(); fory.register(PrivateRecord.class); fory.ensureSerializersCompiled(); } }   ","version":"0.14","tagName":"h3"},{"title":"Example with Dynamic Proxy‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/0.14/guide/graalvm_serialization#example-with-dynamic-proxy","content":" import org.apache.fory.util.GraalvmSupport; public class ProxyExample { public interface MyService { String execute(); } static Fory fory; static { fory = Fory.builder().build(); // Register proxy interface for serialization GraalvmSupport.registerProxySupport(MyService.class); fory.ensureSerializersCompiled(); } }   ","version":"0.14","tagName":"h3"},{"title":"Thread-Safe Fory‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/0.14/guide/graalvm_serialization#thread-safe-fory","content":" For multi-threaded applications, use ThreadLocalFory:  import org.apache.fory.Fory; import org.apache.fory.ThreadLocalFory; import org.apache.fory.ThreadSafeFory; public class ThreadSafeExample { public record Foo(int f1, String f2, List&lt;String&gt; f3) {} static ThreadSafeFory fory; static { fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().build(); f.register(Foo.class); f.ensureSerializersCompiled(); return f; }); } public static void main(String[] args) { Foo foo = new Foo(10, &quot;abc&quot;, List.of(&quot;str1&quot;, &quot;str2&quot;)); byte[] bytes = fory.serialize(foo); Foo result = (Foo) fory.deserialize(bytes); } }   ","version":"0.14","tagName":"h2"},{"title":"Troubleshooting‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/0.14/guide/graalvm_serialization#troubleshooting","content":" ","version":"0.14","tagName":"h2"},{"title":"\"Type is instantiated reflectively but was never registered\"‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/0.14/guide/graalvm_serialization#type-is-instantiated-reflectively-but-was-never-registered","content":" If you see this error:  Type com.example.MyClass is instantiated reflectively but was never registered   Solution: Register the class with Fory (don't add to reflect-config.json):  fory.register(MyClass.class); fory.ensureSerializersCompiled();   If the class has a private constructor, either:  Add fory-graalvm-feature dependency, orCreate a reflect-config.json for that specific class  ","version":"0.14","tagName":"h3"},{"title":"Framework Integration‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/0.14/guide/graalvm_serialization#framework-integration","content":" For framework developers integrating Fory:  Provide a configuration file for users to list serializable classesLoad those classes and call fory.register(Class&lt;?&gt;) for eachCall fory.ensureSerializersCompiled() after all registrationsConfigure your integration class for build-time initialization  ","version":"0.14","tagName":"h2"},{"title":"Benchmark‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/0.14/guide/graalvm_serialization#benchmark","content":" Performance comparison between Fory and GraalVM JDK Serialization:  Type\tCompression\tSpeed\tSizeStruct\tOff\t46x faster\t43% Struct\tOn\t24x faster\t31% Pojo\tOff\t12x faster\t56% Pojo\tOn\t12x faster\t48%  See Benchmark.java for benchmark code.  ","version":"0.14","tagName":"h2"},{"title":"Struct Benchmark‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/0.14/guide/graalvm_serialization#struct-benchmark","content":" Class Fields‚Äã  public class Struct implements Serializable { public int f1; public long f2; public float f3; public double f4; public int f5; public long f6; public float f7; public double f8; public int f9; public long f10; public float f11; public double f12; }   Benchmark Results‚Äã  No compression:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Struct Compress number: false Fory size: 76.0 JDK size: 178.0 Fory serialization took mills: 49 JDK serialization took mills: 2254 Compare speed: Fory is 45.70x speed of JDK Compare size: Fory is 0.43x size of JDK   Compress number:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Struct Compress number: true Fory size: 55.0 JDK size: 178.0 Fory serialization took mills: 130 JDK serialization took mills: 3161 Compare speed: Fory is 24.16x speed of JDK Compare size: Fory is 0.31x size of JDK   ","version":"0.14","tagName":"h3"},{"title":"Pojo Benchmark‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/0.14/guide/graalvm_serialization#pojo-benchmark","content":" Class Fields‚Äã  public class Foo implements Serializable { int f1; String f2; List&lt;String&gt; f3; Map&lt;String, Long&gt; f4; }   Benchmark Results‚Äã  No compression:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Foo Compress number: false Fory size: 541.0 JDK size: 964.0 Fory serialization took mills: 1663 JDK serialization took mills: 16266 Compare speed: Fory is 12.19x speed of JDK Compare size: Fory is 0.56x size of JDK   Compress number:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Foo Compress number: true Fory size: 459.0 JDK size: 964.0 Fory serialization took mills: 1289 JDK serialization took mills: 15069 Compare speed: Fory is 12.11x speed of JDK Compare size: Fory is 0.48x size of JDK  ","version":"0.14","tagName":"h3"},{"title":"Advanced Features","type":0,"sectionRef":"#","url":"/docs/0.14/guide/java/advanced_features","content":"","keywords":"","version":"0.14"},{"title":"Zero-Copy Serialization‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/0.14/guide/java/advanced_features#zero-copy-serialization","content":" Fory supports zero-copy serialization for efficient handling of large binary data:  import org.apache.fory.*; import org.apache.fory.config.*; import org.apache.fory.serializer.BufferObject; import org.apache.fory.memory.MemoryBuffer; import java.util.*; import java.util.stream.Collectors; public class ZeroCopyExample { // Note that fory instance should be reused instead of creation every time. static Fory fory = Fory.builder() .withLanguage(Language.JAVA) .build(); public static void main(String[] args) { List&lt;Object&gt; list = Arrays.asList(&quot;str&quot;, new byte[1000], new int[100], new double[100]); Collection&lt;BufferObject&gt; bufferObjects = new ArrayList&lt;&gt;(); byte[] bytes = fory.serialize(list, e -&gt; !bufferObjects.add(e)); List&lt;MemoryBuffer&gt; buffers = bufferObjects.stream() .map(BufferObject::toBuffer).collect(Collectors.toList()); System.out.println(fory.deserialize(bytes, buffers)); } }   ","version":"0.14","tagName":"h2"},{"title":"Object Deep Copy‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/0.14/guide/java/advanced_features#object-deep-copy","content":" Fory provides efficient deep copy functionality:  ","version":"0.14","tagName":"h2"},{"title":"With Reference Tracking‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/0.14/guide/java/advanced_features#with-reference-tracking","content":" Fory fory = Fory.builder().withRefCopy(true).build(); SomeClass a = xxx; SomeClass copied = fory.copy(a);   ","version":"0.14","tagName":"h3"},{"title":"Without Reference Tracking (Better Performance)‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/0.14/guide/java/advanced_features#without-reference-tracking-better-performance","content":" When disabled, deep copy will ignore circular and shared references. Same reference of an object graph will be copied into different objects in one Fory#copy:  Fory fory = Fory.builder().withRefCopy(false).build(); SomeClass a = xxx; SomeClass copied = fory.copy(a);   ","version":"0.14","tagName":"h3"},{"title":"Memory Allocation Customization‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/0.14/guide/java/advanced_features#memory-allocation-customization","content":" Fory provides a MemoryAllocator interface that allows you to customize how memory buffers are allocated and grown during serialization operations. This can be useful for performance optimization, memory pooling, or debugging memory usage.  ","version":"0.14","tagName":"h2"},{"title":"MemoryAllocator Interface‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/0.14/guide/java/advanced_features#memoryallocator-interface","content":" The MemoryAllocator interface defines two key methods:  public interface MemoryAllocator { /** * Allocates a new MemoryBuffer with the specified initial capacity. */ MemoryBuffer allocate(int initialCapacity); /** * Grows an existing buffer to accommodate the new capacity. * The implementation must grow the buffer in-place by modifying * the existing buffer instance. */ MemoryBuffer grow(MemoryBuffer buffer, int newCapacity); }   ","version":"0.14","tagName":"h3"},{"title":"Using Custom Memory Allocators‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/0.14/guide/java/advanced_features#using-custom-memory-allocators","content":" You can set a global memory allocator that will be used by all MemoryBuffer instances:  // Create a custom allocator MemoryAllocator customAllocator = new MemoryAllocator() { @Override public MemoryBuffer allocate(int initialCapacity) { // Add extra capacity for debugging or pooling return MemoryBuffer.fromByteArray(new byte[initialCapacity + 100]); } @Override public MemoryBuffer grow(MemoryBuffer buffer, int newCapacity) { if (newCapacity &lt;= buffer.size()) { return buffer; } // Custom growth strategy - add 100% extra capacity int newSize = (int) (newCapacity * 2); byte[] data = new byte[newSize]; buffer.copyToUnsafe(0, data, Platform.BYTE_ARRAY_OFFSET, buffer.size()); buffer.initHeapBuffer(data, 0, data.length); return buffer; } }; // Set the custom allocator globally MemoryBuffer.setGlobalAllocator(customAllocator); // All subsequent MemoryBuffer allocations will use your custom allocator Fory fory = Fory.builder().withLanguage(Language.JAVA).build(); byte[] bytes = fory.serialize(someObject); // Uses custom allocator   ","version":"0.14","tagName":"h3"},{"title":"Default Memory Allocator Behavior‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/0.14/guide/java/advanced_features#default-memory-allocator-behavior","content":" The default allocator uses the following growth strategy:  For buffers smaller than BUFFER_GROW_STEP_THRESHOLD (100MB): multiply capacity by 2For larger buffers: multiply capacity by 1.5 (capped at Integer.MAX_VALUE - 8)  This provides a balance between avoiding frequent reallocations and preventing excessive memory usage.  ","version":"0.14","tagName":"h3"},{"title":"Use Cases‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/0.14/guide/java/advanced_features#use-cases","content":" Custom memory allocators are useful for:  Memory Pooling: Reuse allocated buffers to reduce GC pressurePerformance Tuning: Use different growth strategies based on your workloadDebugging: Add logging or tracking to monitor memory usageOff-heap Memory: Integrate with off-heap memory management systems  ","version":"0.14","tagName":"h3"},{"title":"Logging‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/0.14/guide/java/advanced_features#logging","content":" ","version":"0.14","tagName":"h2"},{"title":"ForyLogger‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/0.14/guide/java/advanced_features#forylogger","content":" By default, Fory uses a custom logger ForyLogger for internal needs. It builds resulting logged data into a single string and sends it directly to System.out. The result line layout is similar to (in Log4j notation):  %d{yyyy-MM-dd hh:mm:ss} %p %C:%L [%t] - %m%n   The layout can't be changed.  Example output:  2025-11-07 08:49:59 INFO CompileUnit:55 [main] - Generate code for org.apache.fory.builder.SerializedLambdaForyCodec_0 took 35 ms. 2025-11-07 08:50:00 INFO JaninoUtils:121 [main] - Compile [SerializedLambdaForyCodec_0] take 144 ms   ","version":"0.14","tagName":"h3"},{"title":"Slf4jLogger‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/0.14/guide/java/advanced_features#slf4jlogger","content":" If a more sophisticated logger is required, configure Fory to use Slf4j via LoggerFactory.useSlf4jLogging(). For example, enabling Slf4j before creating Fory:  public static final ThreadSafeFory FORY; static { LoggerFactory.useSlf4jLogging(true); FORY = Fory.builder() .buildThreadSafeFory(); }   Note: Enabling Slf4j via useSlf4jLogging will be ignored when the application runs in a GraalVM native image.  ","version":"0.14","tagName":"h3"},{"title":"Suppress Fory Logs‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/0.14/guide/java/advanced_features#suppress-fory-logs","content":" Both ForyLogger and Slf4jLogger allow controlling log output level or suppressing logs entirely. Configure logger level via LoggerFactory.setLogLevel():  static { // to log only WARN and higher LoggerFactory.setLogLevel(LogLevel.WARN_LEVEL); // to disable logging entirely LoggerFactory.disableLogging(); }   Note: Selected logging level is applied before Slf4j implementation's logger level. So if you set WARN_LEVEL (as in the example above) then you will not see INFO messages from Fory even if INFO is enabled in Logback.  ","version":"0.14","tagName":"h3"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/0.14/guide/java/advanced_features#related-topics","content":" Compression - Data compression optionsConfiguration Options - All ForyBuilder optionsCross-Language Serialization - XLANG mode ","version":"0.14","tagName":"h2"},{"title":"Basic Serialization","type":0,"sectionRef":"#","url":"/docs/0.14/guide/java/basic_serialization","content":"","keywords":"","version":"0.14"},{"title":"Creating Fory Instances‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/java/basic_serialization#creating-fory-instances","content":" ","version":"0.14","tagName":"h2"},{"title":"Single-Thread Fory‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/java/basic_serialization#single-thread-fory","content":" For single-threaded applications:  Fory fory = Fory.builder() .withLanguage(Language.JAVA) // enable reference tracking for shared/circular reference. // Disable it will have better performance if no duplicate reference. .withRefTracking(false) .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT) // enable type forward/backward compatibility // disable it for small size and better performance. // .withCompatibleMode(CompatibleMode.COMPATIBLE) // enable async multi-threaded compilation. .withAsyncCompilation(true) .build(); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes));   ","version":"0.14","tagName":"h3"},{"title":"Thread-Safe Fory‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/java/basic_serialization#thread-safe-fory","content":" For multi-threaded applications:  ThreadSafeFory fory = Fory.builder() .withLanguage(Language.JAVA) // enable reference tracking for shared/circular reference. // Disable it will have better performance if no duplicate reference. .withRefTracking(false) // compress int for smaller size // .withIntCompressed(true) // compress long for smaller size // .withLongCompressed(true) .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT) // enable type forward/backward compatibility // disable it for small size and better performance. // .withCompatibleMode(CompatibleMode.COMPATIBLE) // enable async multi-threaded compilation. .withAsyncCompilation(true) .buildThreadSafeFory(); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes));   ","version":"0.14","tagName":"h3"},{"title":"Object Deep Copy‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/java/basic_serialization#object-deep-copy","content":" Fory provides efficient deep copy functionality:  ","version":"0.14","tagName":"h2"},{"title":"With Reference Tracking‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/java/basic_serialization#with-reference-tracking","content":" Fory fory = Fory.builder().withRefCopy(true).build(); SomeClass a = xxx; SomeClass copied = fory.copy(a);   ","version":"0.14","tagName":"h3"},{"title":"Without Reference Tracking (Better Performance)‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/java/basic_serialization#without-reference-tracking-better-performance","content":" When disabled, deep copy will ignore circular and shared references. Same reference of an object graph will be copied into different objects in one Fory#copy:  Fory fory = Fory.builder().withRefCopy(false).build(); SomeClass a = xxx; SomeClass copied = fory.copy(a);   ","version":"0.14","tagName":"h3"},{"title":"Serialization APIs‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/java/basic_serialization#serialization-apis","content":" ","version":"0.14","tagName":"h2"},{"title":"Basic Serialize/Deserialize‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/java/basic_serialization#basic-serializedeserialize","content":" // Serialize object to byte array byte[] bytes = fory.serialize(object); // Deserialize byte array to object Object obj = fory.deserialize(bytes);   ","version":"0.14","tagName":"h3"},{"title":"Serialize/Deserialize with Type‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/java/basic_serialization#serializedeserialize-with-type","content":" // Serialize with explicit type byte[] bytes = fory.serializeJavaObject(object); // Deserialize with expected type MyClass obj = fory.deserializeJavaObject(bytes, MyClass.class);   ","version":"0.14","tagName":"h3"},{"title":"Serialize/Deserialize with Type Info‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/java/basic_serialization#serializedeserialize-with-type-info","content":" // Serialize with type information byte[] bytes = fory.serializeJavaObjectAndClass(object); // Deserialize with embedded type info Object obj = fory.deserializeJavaObjectAndClass(bytes);   ","version":"0.14","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/java/basic_serialization#best-practices","content":" Reuse Fory instances: Creating Fory is expensive, always reuse instancesUse appropriate thread safety: Choose between single-thread and thread-safe based on your needsRegister classes: Register frequently used classes for better performanceConfigure reference tracking: Disable if you don't have circular/shared references  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/java/basic_serialization#related-topics","content":" Configuration Options - All ForyBuilder optionsType Registration - Class registrationTroubleshooting - Common API usage issues ","version":"0.14","tagName":"h2"},{"title":"Compression","type":0,"sectionRef":"#","url":"/docs/0.14/guide/java/compression","content":"","keywords":"","version":"0.14"},{"title":"Integer Compression‚Äã","type":1,"pageTitle":"Compression","url":"/docs/0.14/guide/java/compression#integer-compression","content":" ForyBuilder#withIntCompressed/ForyBuilder#withLongCompressed can be used to compress int/long for smaller size. Normally compressing int is enough.  Both compression options are enabled by default. If the serialized size is not important (for example, you use FlatBuffers for serialization before, which doesn't compress anything), then you should disable compression. If your data are all numbers, the compression may bring 80% performance regression.  ","version":"0.14","tagName":"h2"},{"title":"Int Compression‚Äã","type":1,"pageTitle":"Compression","url":"/docs/0.14/guide/java/compression#int-compression","content":" For int compression, Fory uses 1~5 bytes for encoding. The first bit in every byte indicates whether there is a next byte. If the first bit is set, then the next byte will be read until the first bit of the next byte is unset.  ","version":"0.14","tagName":"h3"},{"title":"Long Compression‚Äã","type":1,"pageTitle":"Compression","url":"/docs/0.14/guide/java/compression#long-compression","content":" For long compression, Fory supports two encodings:  SLI (Small Long as Int) Encoding (Default)‚Äã  If long is in [-1073741824, 1073741823], encode as 4 bytes int: | little-endian: ((int) value) &lt;&lt; 1 |Otherwise write as 9 bytes: | 0b1 | little-endian 8bytes long |  PVL (Progressive Variable-length Long) Encoding‚Äã  First bit in every byte indicates whether there is a next byte. If first bit is set, then next byte will be read until first bit of next byte is unset.Negative numbers will be converted to positive numbers by (v &lt;&lt; 1) ^ (v &gt;&gt; 63) to reduce cost of small negative numbers.  If a number is of long type but can't be represented by smaller bytes mostly, the compression won't get good enough results‚Äînot worthy compared to performance cost. Maybe you should try to disable long compression if you find it didn't bring much space savings.  ","version":"0.14","tagName":"h3"},{"title":"Array Compression‚Äã","type":1,"pageTitle":"Compression","url":"/docs/0.14/guide/java/compression#array-compression","content":" Fory supports SIMD-accelerated compression for primitive arrays (int[] and long[]) when array values can fit in smaller data types. This feature is available on Java 16+ and uses the Vector API for optimal performance.  ","version":"0.14","tagName":"h2"},{"title":"How Array Compression Works‚Äã","type":1,"pageTitle":"Compression","url":"/docs/0.14/guide/java/compression#how-array-compression-works","content":" Array compression analyzes arrays to determine if values can be stored using fewer bytes:  int[] ‚Üí byte[]: When all values are in range [-128, 127] (75% size reduction)int[] ‚Üí short[]: When all values are in range [-32768, 32767] (50% size reduction)long[] ‚Üí int[]: When all values fit in integer range (50% size reduction)  ","version":"0.14","tagName":"h3"},{"title":"Configuration and Registration‚Äã","type":1,"pageTitle":"Compression","url":"/docs/0.14/guide/java/compression#configuration-and-registration","content":" To enable array compression, you must explicitly register the serializers:  Fory fory = Fory.builder() .withLanguage(Language.JAVA) // Enable int array compression .withIntArrayCompressed(true) // Enable long array compression .withLongArrayCompressed(true) .build(); // You must explicitly register compressed array serializers CompressedArraySerializers.registerSerializers(fory);   Note: The fory-simd module must be included in your dependencies for compressed array serializers to be available.  ","version":"0.14","tagName":"h3"},{"title":"Maven Dependency‚Äã","type":1,"pageTitle":"Compression","url":"/docs/0.14/guide/java/compression#maven-dependency","content":" &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-simd&lt;/artifactId&gt; &lt;version&gt;0.14.1&lt;/version&gt; &lt;/dependency&gt;   ","version":"0.14","tagName":"h3"},{"title":"String Compression‚Äã","type":1,"pageTitle":"Compression","url":"/docs/0.14/guide/java/compression#string-compression","content":" String compression can be enabled via ForyBuilder#withStringCompressed(true). This is disabled by default.  ","version":"0.14","tagName":"h2"},{"title":"Configuration Summary‚Äã","type":1,"pageTitle":"Compression","url":"/docs/0.14/guide/java/compression#configuration-summary","content":" Option\tDescription\tDefaultcompressInt\tEnable int compression\ttrue compressLong\tEnable long compression\ttrue compressIntArray\tEnable SIMD int array compression (Java 16+)\ttrue compressLongArray\tEnable SIMD long array compression (Java 16+)\ttrue compressString\tEnable string compression\tfalse  ","version":"0.14","tagName":"h2"},{"title":"Performance Considerations‚Äã","type":1,"pageTitle":"Compression","url":"/docs/0.14/guide/java/compression#performance-considerations","content":" Disable compression for numeric-heavy data: If your data is mostly numbers, compression overhead may not be worth itArray compression requires Java 16+: Uses Vector API for SIMD accelerationLong compression may not help large values: If most longs can't fit in smaller representations, disable itString compression has overhead: Only enable if strings are highly compressible  ","version":"0.14","tagName":"h2"},{"title":"Example Configuration‚Äã","type":1,"pageTitle":"Compression","url":"/docs/0.14/guide/java/compression#example-configuration","content":" // For mostly numeric data - disable compression Fory fory = Fory.builder() .withLanguage(Language.JAVA) .withIntCompressed(false) .withLongCompressed(false) .build(); // For mixed data with arrays - enable array compression Fory fory = Fory.builder() .withLanguage(Language.JAVA) .withIntCompressed(true) .withLongCompressed(true) .withIntArrayCompressed(true) .withLongArrayCompressed(true) .build(); CompressedArraySerializers.registerSerializers(fory);   ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Compression","url":"/docs/0.14/guide/java/compression#related-topics","content":" Configuration Options - All ForyBuilder optionsAdvanced Features - Memory management ","version":"0.14","tagName":"h2"},{"title":"Configuration Options","type":0,"sectionRef":"#","url":"/docs/0.14/guide/java/configuration","content":"","keywords":"","version":"0.14"},{"title":"ForyBuilder Options‚Äã","type":1,"pageTitle":"Configuration Options","url":"/docs/0.14/guide/java/configuration#forybuilder-options","content":" Option Name\tDescription\tDefault ValuetimeRefIgnored\tWhether to ignore reference tracking of all time types registered in TimeSerializers and subclasses of those types when ref tracking is enabled. If ignored, ref tracking of every time type can be enabled by invoking Fory#registerSerializer(Class, Serializer). For example, fory.registerSerializer(Date.class, new DateSerializer(fory, true)). Note that enabling ref tracking should happen before serializer codegen of any types which contain time fields. Otherwise, those fields will still skip ref tracking.\ttrue compressInt\tEnables or disables int compression for smaller size.\ttrue compressLong\tEnables or disables long compression for smaller size.\ttrue compressIntArray\tEnables or disables SIMD-accelerated compression for int arrays when values can fit in smaller data types. Requires Java 16+.\ttrue compressLongArray\tEnables or disables SIMD-accelerated compression for long arrays when values can fit in smaller data types. Requires Java 16+.\ttrue compressString\tEnables or disables string compression for smaller size.\tfalse classLoader\tThe classloader should not be updated; Fory caches class metadata. Use LoaderBinding or ThreadSafeFory for classloader updates.\tThread.currentThread().getContextClassLoader() compatibleMode\tType forward/backward compatibility config. Also Related to checkClassVersion config. SCHEMA_CONSISTENT: Class schema must be consistent between serialization peer and deserialization peer. COMPATIBLE: Class schema can be different between serialization peer and deserialization peer. They can add/delete fields independently. See more.\tCompatibleMode.SCHEMA_CONSISTENT checkClassVersion\tDetermines whether to check the consistency of the class schema. If enabled, Fory checks, writes, and checks consistency using the classVersionHash. It will be automatically disabled when CompatibleMode#COMPATIBLE is enabled. Disabling is not recommended unless you can ensure the class won't evolve.\tfalse checkJdkClassSerializable\tEnables or disables checking of Serializable interface for classes under java.*. If a class under java.* is not Serializable, Fory will throw an UnsupportedOperationException.\ttrue registerGuavaTypes\tWhether to pre-register Guava types such as RegularImmutableMap/RegularImmutableList. These types are not public API, but seem pretty stable.\ttrue requireClassRegistration\tDisabling may allow unknown classes to be deserialized, potentially causing security risks.\ttrue maxDepth\tSet max depth for deserialization, when depth exceeds, an exception will be thrown. This can be used to refuse deserialization DDOS attack.\t50 suppressClassRegistrationWarnings\tWhether to suppress class registration warnings. The warnings can be used for security audit, but may be annoying, this suppression will be enabled by default.\ttrue metaShareEnabled\tEnables or disables meta share mode.\ttrue if CompatibleMode.Compatible is set, otherwise false. scopedMetaShareEnabled\tScoped meta share focuses on a single serialization process. Metadata created or identified during this process is exclusive to it and is not shared with by other serializations.\ttrue if CompatibleMode.Compatible is set, otherwise false. metaCompressor\tSet a compressor for meta compression. Note that the passed MetaCompressor should be thread-safe. By default, a Deflater based compressor DeflaterMetaCompressor will be used. Users can pass other compressor such as zstd for better compression rate.\tDeflaterMetaCompressor deserializeNonexistentClass\tEnables or disables deserialization/skipping of data for non-existent classes.\ttrue if CompatibleMode.Compatible is set, otherwise false. codeGenEnabled\tDisabling may result in faster initial serialization but slower subsequent serializations.\ttrue asyncCompilationEnabled\tIf enabled, serialization uses interpreter mode first and switches to JIT serialization after async serializer JIT for a class is finished.\tfalse scalaOptimizationEnabled\tEnables or disables Scala-specific serialization optimization.\tfalse copyRef\tWhen disabled, the copy performance will be better. But fory deep copy will ignore circular and shared reference. Same reference of an object graph will be copied into different objects in one Fory#copy.\ttrue serializeEnumByName\tWhen Enabled, fory serialize enum by name instead of ordinal.\tfalse  ","version":"0.14","tagName":"h2"},{"title":"Example Configuration‚Äã","type":1,"pageTitle":"Configuration Options","url":"/docs/0.14/guide/java/configuration#example-configuration","content":" Fory fory = Fory.builder() .withLanguage(Language.JAVA) // enable reference tracking for shared/circular reference. // Disable it will have better performance if no duplicate reference. .withRefTracking(false) // compress int for smaller size .withIntCompressed(true) // compress long for smaller size .withLongCompressed(true) .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT) // enable type forward/backward compatibility // disable it for small size and better performance. // .withCompatibleMode(CompatibleMode.COMPATIBLE) // enable async multi-threaded compilation. .withAsyncCompilation(true) .build();   ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Configuration Options","url":"/docs/0.14/guide/java/configuration#related-topics","content":" Schema Evolution - Compatible mode and meta sharingCompression - Int, long, and array compression detailsType Registration - Class registration options ","version":"0.14","tagName":"h2"},{"title":"Migration Guide","type":0,"sectionRef":"#","url":"/docs/0.14/guide/java/migration","content":"","keywords":"","version":"0.14"},{"title":"JDK Serialization Migration‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/0.14/guide/java/migration#jdk-serialization-migration","content":" If you use JDK serialization before and can't upgrade your client and server at the same time (which is common for online applications), Fory provides a utility method org.apache.fory.serializer.JavaSerializer.serializedByJDK to check whether the binary was generated by JDK serialization.  You can use the following pattern to make existing serialization protocol-aware, then upgrade serialization to Fory in an async rolling-up way:  if (JavaSerializer.serializedByJDK(bytes)) { ObjectInputStream objectInputStream = xxx; return objectInputStream.readObject(); } else { return fory.deserialize(bytes); }   This allows you to:  Deploy new code that can read both JDK and Fory serialized dataGradually migrate serialization to ForyEventually remove JDK serialization support  ","version":"0.14","tagName":"h2"},{"title":"Upgrade Fory‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/0.14/guide/java/migration#upgrade-fory","content":" ","version":"0.14","tagName":"h2"},{"title":"Minor Version Upgrades‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/0.14/guide/java/migration#minor-version-upgrades","content":" Currently, binary compatibility is ensured for minor versions only. For example, if you are using Fory v0.2.0, binary compatibility will be provided if you upgrade to Fory v0.2.1.  If you upgrade by minor version, or you won't have data serialized by older Fory, you can upgrade Fory directly without any special handling.  ","version":"0.14","tagName":"h3"},{"title":"Major Version Upgrades‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/0.14/guide/java/migration#major-version-upgrades","content":" If you upgrade to Fory v0.4.1 from v0.2.x, no binary compatibility is ensured.  Most of the time there is no need to upgrade Fory to a newer major version‚Äîthe current version is fast and compact enough, and we provide some minor fixes for recent older versions.  ","version":"0.14","tagName":"h3"},{"title":"Versioning Serialized Data‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/0.14/guide/java/migration#versioning-serialized-data","content":" If you do want to upgrade Fory for better performance and smaller size, you need to write the Fory version as a header to serialized data using code like the following to keep binary compatibility:  Serialization with Version Header‚Äã  MemoryBuffer buffer = xxx; buffer.writeVarInt32(2); // Write Fory version fory.serialize(buffer, obj);   Deserialization with Version Header‚Äã  MemoryBuffer buffer = xxx; int foryVersion = buffer.readVarInt32(); Fory fory = getFory(foryVersion); fory.deserialize(buffer);   getFory is a method to load the corresponding Fory version. You can shade and relocate different versions of Fory to different packages, and load Fory by version.  ","version":"0.14","tagName":"h3"},{"title":"Shading Example‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/0.14/guide/java/migration#shading-example","content":" &lt;!-- Maven Shade Plugin configuration for multiple Fory versions --&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;shade-fory-v1&lt;/id&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;shade&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;relocations&gt; &lt;relocation&gt; &lt;pattern&gt;org.apache.fory&lt;/pattern&gt; &lt;shadedPattern&gt;com.myapp.fory.v1&lt;/shadedPattern&gt; &lt;/relocation&gt; &lt;/relocations&gt; &lt;/configuration&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt;   ","version":"0.14","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/0.14/guide/java/migration#best-practices","content":" Test thoroughly before upgrading: Ensure compatibility with existing serialized dataUse version headers for long-term storage: If data persists across Fory versionsMaintain backward compatibility: Keep old Fory versions available for reading legacy dataMonitor after upgrade: Watch for deserialization errors in production  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/0.14/guide/java/migration#related-topics","content":" Configuration Options - ForyBuilder optionsSchema Evolution - Handling class changesTroubleshooting - Common migration issues ","version":"0.14","tagName":"h2"},{"title":"Cross-Language Serialization","type":0,"sectionRef":"#","url":"/docs/0.14/guide/java/cross_language","content":"","keywords":"","version":"0.14"},{"title":"Enable Cross-Language Mode‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/java/cross_language#enable-cross-language-mode","content":" To serialize data for consumption by other languages, use Language.XLANG mode:  import org.apache.fory.*; import org.apache.fory.config.*; // Create Fory instance with XLANG mode Fory fory = Fory.builder() .withLanguage(Language.XLANG) .withRefTracking(true) // Enable reference tracking for complex graphs .build();   ","version":"0.14","tagName":"h2"},{"title":"Register Types for Cross-Language Compatibility‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/java/cross_language#register-types-for-cross-language-compatibility","content":" Types must be registered with consistent IDs or names across all languages. Fory supports two registration methods:  ","version":"0.14","tagName":"h2"},{"title":"Register by ID (Recommended for Performance)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/java/cross_language#register-by-id-recommended-for-performance","content":" public record Person(String name, int age) {} // Register with numeric ID - faster and more compact fory.register(Person.class, 1); Person person = new Person(&quot;Alice&quot;, 30); byte[] bytes = fory.serialize(person); // bytes can be deserialized by Python, Rust, Go, etc.   Benefits: Faster serialization, smaller binary sizeTrade-offs: Requires coordination to avoid ID conflicts across teams/services  ","version":"0.14","tagName":"h3"},{"title":"Register by Name (Recommended for Flexibility)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/java/cross_language#register-by-name-recommended-for-flexibility","content":" public record Person(String name, int age) {} // Register with string name - more flexible fory.register(Person.class, &quot;example.Person&quot;); Person person = new Person(&quot;Alice&quot;, 30); byte[] bytes = fory.serialize(person); // bytes can be deserialized by Python, Rust, Go, etc.   Benefits: Less prone to conflicts, easier management across teams, no coordination neededTrade-offs: Slightly larger binary size due to string encoding  ","version":"0.14","tagName":"h3"},{"title":"Cross-Language Example: Java ‚Üî Python‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/java/cross_language#cross-language-example-java--python","content":" ","version":"0.14","tagName":"h2"},{"title":"Java (Serializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/java/cross_language#java-serializer","content":" import org.apache.fory.*; import org.apache.fory.config.*; public record Person(String name, int age) {} public class Example { public static void main(String[] args) { Fory fory = Fory.builder() .withLanguage(Language.XLANG) .withRefTracking(true) .build(); // Register with consistent name fory.register(Person.class, &quot;example.Person&quot;); Person person = new Person(&quot;Bob&quot;, 25); byte[] bytes = fory.serialize(person); // Send bytes to Python service via network/file/queue } }   ","version":"0.14","tagName":"h3"},{"title":"Python (Deserializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/java/cross_language#python-deserializer","content":" import pyfory from dataclasses import dataclass @dataclass class Person: name: str age: pyfory.int32 # Create Fory in xlang mode fory = pyfory.Fory(ref_tracking=True) # Register with the SAME name as Java fory.register_type(Person, typename=&quot;example.Person&quot;) # Deserialize bytes from Java person = fory.deserialize(bytes_from_java) print(f&quot;{person.name}, {person.age}&quot;) # Output: Bob, 25   ","version":"0.14","tagName":"h3"},{"title":"Handling Circular and Shared References‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/java/cross_language#handling-circular-and-shared-references","content":" Cross-language mode supports circular and shared references when reference tracking is enabled:  public class Node { public String value; public Node next; public Node parent; } Fory fory = Fory.builder() .withLanguage(Language.XLANG) .withRefTracking(true) // Required for circular references .build(); fory.register(Node.class, &quot;example.Node&quot;); // Create circular reference Node node1 = new Node(); node1.value = &quot;A&quot;; Node node2 = new Node(); node2.value = &quot;B&quot;; node1.next = node2; node2.parent = node1; // Circular reference byte[] bytes = fory.serialize(node1); // Python/Rust/Go can correctly deserialize this with circular references preserved   ","version":"0.14","tagName":"h2"},{"title":"Type Mapping Considerations‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/java/cross_language#type-mapping-considerations","content":" Not all Java types have equivalents in other languages. When using xlang mode:  Use primitive types (int, long, double, String) for maximum compatibilityUse standard collections (List, Map, Set) instead of language-specific onesAvoid Java-specific types like Optional, BigDecimal (unless the target language supports them)See Type Mapping Guide for complete compatibility matrix  ","version":"0.14","tagName":"h2"},{"title":"Compatible Types‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/java/cross_language#compatible-types","content":" public record UserData( String name, // ‚úÖ Compatible int age, // ‚úÖ Compatible List&lt;String&gt; tags, // ‚úÖ Compatible Map&lt;String, Integer&gt; scores // ‚úÖ Compatible ) {}   ","version":"0.14","tagName":"h3"},{"title":"Problematic Types‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/java/cross_language#problematic-types","content":" public record UserData( Optional&lt;String&gt; name, // ‚ùå Not cross-language compatible BigDecimal balance, // ‚ùå Limited support EnumSet&lt;Status&gt; statuses // ‚ùå Java-specific collection ) {}   ","version":"0.14","tagName":"h3"},{"title":"Performance Considerations‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/java/cross_language#performance-considerations","content":" Cross-language mode has additional overhead compared to Java-only mode:  Type metadata encoding: Adds extra bytes per typeType resolution: Requires name/ID lookup during deserialization  For best performance:  Use ID-based registration when possible (smaller encoding)Disable reference tracking if you don't need circular references (withRefTracking(false))Use Java mode (Language.JAVA) when only Java serialization is needed  ","version":"0.14","tagName":"h2"},{"title":"Cross-Language Best Practices‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/java/cross_language#cross-language-best-practices","content":" Consistent Registration: Ensure all services register types with identical IDs/namesVersion Compatibility: Use compatible mode for schema evolution across services  ","version":"0.14","tagName":"h2"},{"title":"Troubleshooting Cross-Language Serialization‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/java/cross_language#troubleshooting-cross-language-serialization","content":" ","version":"0.14","tagName":"h2"},{"title":"\"Type not registered\" errors‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/java/cross_language#type-not-registered-errors","content":" Verify type is registered with same ID/name on both sidesCheck if type name has typos or case differences  ","version":"0.14","tagName":"h3"},{"title":"\"Type mismatch\" errors‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/java/cross_language#type-mismatch-errors","content":" Ensure field types are compatible across languagesReview Type Mapping Guide  ","version":"0.14","tagName":"h3"},{"title":"Data corruption or unexpected values‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/java/cross_language#data-corruption-or-unexpected-values","content":" Verify both sides use Language.XLANG modeEnsure both sides have compatible Fory versions  ","version":"0.14","tagName":"h3"},{"title":"See Also‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/java/cross_language#see-also","content":" Cross-Language Serialization SpecificationType Mapping ReferencePython Cross-Language GuideRust Cross-Language Guide  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/java/cross_language#related-topics","content":" Schema Evolution - Compatible modeType Registration - Registration methodsRow Format - Cross-language row format ","version":"0.14","tagName":"h2"},{"title":"Row Format","type":0,"sectionRef":"#","url":"/docs/0.14/guide/java/row_format","content":"","keywords":"","version":"0.14"},{"title":"Overview‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/java/row_format#overview","content":" Row format is a cache-friendly binary random access format that supports:  Zero-copy access: Read fields directly from binary without allocating objectsPartial deserialization: Access only the fields you needSkipping serialization: Skip serialization of fields you don't needCross-language compatibility: Works across Python, Java, C++, and other languagesColumn format conversion: Can convert to Apache Arrow columnar format automatically  ","version":"0.14","tagName":"h2"},{"title":"Basic Usage‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/java/row_format#basic-usage","content":" public class Bar { String f1; List&lt;Long&gt; f2; } public class Foo { int f1; List&lt;Integer&gt; f2; Map&lt;String, Integer&gt; f3; List&lt;Bar&gt; f4; } RowEncoder&lt;Foo&gt; encoder = Encoders.bean(Foo.class); // Create large dataset Foo foo = new Foo(); foo.f1 = 10; foo.f2 = IntStream.range(0, 1_000_000).boxed().collect(Collectors.toList()); foo.f3 = IntStream.range(0, 1_000_000).boxed().collect(Collectors.toMap(i -&gt; &quot;k&quot; + i, i -&gt; i)); List&lt;Bar&gt; bars = new ArrayList&lt;&gt;(1_000_000); for (int i = 0; i &lt; 1_000_000; i++) { Bar bar = new Bar(); bar.f1 = &quot;s&quot; + i; bar.f2 = LongStream.range(0, 10).boxed().collect(Collectors.toList()); bars.add(bar); } foo.f4 = bars; // Encode to row format (cross-language compatible with Python/C++) BinaryRow binaryRow = encoder.toRow(foo); // Zero-copy random access without full deserialization BinaryArray f2Array = binaryRow.getArray(1); // Access f2 list BinaryArray f4Array = binaryRow.getArray(3); // Access f4 list BinaryRow bar10 = f4Array.getStruct(10); // Access 11th Bar long value = bar10.getArray(1).getInt64(5); // Access 6th element of bar.f2 // Partial deserialization - only deserialize what you need RowEncoder&lt;Bar&gt; barEncoder = Encoders.bean(Bar.class); Bar bar1 = barEncoder.fromRow(f4Array.getStruct(10)); // Deserialize 11th Bar only Bar bar2 = barEncoder.fromRow(f4Array.getStruct(20)); // Deserialize 21st Bar only // Full deserialization when needed Foo newFoo = encoder.fromRow(binaryRow);   ","version":"0.14","tagName":"h2"},{"title":"Key Benefits‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/java/row_format#key-benefits","content":" Feature\tDescriptionZero-Copy Access\tRead nested fields without deserializing entire object Memory Efficiency\tMemory-map large datasets directly from disk Cross-Language\tBinary format compatible between Java, Python, C++ Partial Deserialization\tDeserialize only specific elements you need High Performance\tSkip unnecessary data parsing for analytics workloads  ","version":"0.14","tagName":"h2"},{"title":"When to Use Row Format‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/java/row_format#when-to-use-row-format","content":" Row format is ideal for:  Analytics workloads: When you only need to access specific fieldsLarge datasets: When full deserialization is too expensiveMemory-mapped files: Working with data larger than RAMData pipelines: Processing data without full object reconstructionCross-language data sharing: When data needs to be accessed from multiple languages  ","version":"0.14","tagName":"h2"},{"title":"Cross-Language Compatibility‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/java/row_format#cross-language-compatibility","content":" Row format works seamlessly across languages. The same binary data can be accessed from:  ","version":"0.14","tagName":"h2"},{"title":"Python‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/java/row_format#python","content":" import pyfory import pyarrow as pa from dataclasses import dataclass from typing import List, Dict @dataclass class Bar: f1: str f2: List[pa.int64] @dataclass class Foo: f1: pa.int32 f2: List[pa.int32] f3: Dict[str, pa.int32] f4: List[Bar] encoder = pyfory.encoder(Foo) binary: bytes = encoder.to_row(foo).to_bytes() # Zero-copy access foo_row = pyfory.RowData(encoder.schema, binary) print(foo_row.f2[100000]) print(foo_row.f4[100000].f1)   ","version":"0.14","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/java/row_format#c","content":" #include &quot;fory/encoder/row_encoder.h&quot; #include &quot;fory/row/writer.h&quot; struct Bar { std::string f1; std::vector&lt;int64_t&gt; f2; }; FORY_FIELD_INFO(Bar, f1, f2); struct Foo { int32_t f1; std::vector&lt;int32_t&gt; f2; std::map&lt;std::string, int32_t&gt; f3; std::vector&lt;Bar&gt; f4; }; FORY_FIELD_INFO(Foo, f1, f2, f3, f4); fory::encoder::RowEncoder&lt;Foo&gt; encoder; encoder.Encode(foo); auto row = encoder.GetWriter().ToRow(); // Zero-copy random access auto f2_array = row-&gt;GetArray(1); auto f4_array = row-&gt;GetArray(3); auto bar10 = f4_array-&gt;GetStruct(10); int64_t value = bar10-&gt;GetArray(1)-&gt;GetInt64(5); std::string str = bar10-&gt;GetString(0);   ","version":"0.14","tagName":"h3"},{"title":"Performance Comparison‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/java/row_format#performance-comparison","content":" Operation\tObject Format\tRow FormatFull deserialization\tAllocates all objects\tZero allocation Single field access\tFull deserialization required\tDirect offset read Memory usage\tFull object graph in memory\tOnly accessed fields Suitable for\tSmall objects, full access\tLarge objects, selective access  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/java/row_format#related-topics","content":" Cross-Language Serialization - XLANG modeAdvanced Features - Zero-copy serializationRow Format Specification - Protocol details ","version":"0.14","tagName":"h2"},{"title":"Schema Evolution","type":0,"sectionRef":"#","url":"/docs/0.14/guide/java/schema_evolution","content":"","keywords":"","version":"0.14"},{"title":"Handling Class Schema Evolution‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/java/schema_evolution#handling-class-schema-evolution","content":" In many systems, the schema of a class used for serialization may change over time. For instance, fields within a class may be added or removed. When serialization and deserialization processes use different versions of jars, the schema of the class being deserialized may differ from the one used during serialization.  ","version":"0.14","tagName":"h2"},{"title":"Default Mode: SCHEMA_CONSISTENT‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/java/schema_evolution#default-mode-schema_consistent","content":" By default, Fory serializes objects using the CompatibleMode.SCHEMA_CONSISTENT mode. This mode assumes that the deserialization process uses the same class schema as the serialization process, minimizing payload overhead. However, if there is a schema inconsistency, deserialization will fail.  ","version":"0.14","tagName":"h3"},{"title":"Compatible Mode‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/java/schema_evolution#compatible-mode","content":" If the schema is expected to change, to make deserialization succeed (i.e., schema forward/backward compatibility), users must configure Fory to use CompatibleMode.COMPATIBLE. This can be done using the ForyBuilder#withCompatibleMode(CompatibleMode.COMPATIBLE) method.  In this compatible mode, deserialization can handle schema changes such as missing or extra fields, allowing it to succeed even when the serialization and deserialization processes have different class schemas.  Fory fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .build(); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes));   This compatible mode involves serializing class metadata into the serialized output. Despite Fory's use of sophisticated compression techniques to minimize overhead, there is still some additional space cost associated with class metadata.  ","version":"0.14","tagName":"h3"},{"title":"Meta Sharing‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/java/schema_evolution#meta-sharing","content":" To further reduce metadata costs, Fory introduces a class metadata sharing mechanism, which allows the metadata to be sent to the deserialization process only once.  Fory supports sharing type metadata (class name, field name, final field type information, etc.) between multiple serializations in a context (ex. TCP connection). This information will be sent to the peer during the first serialization in the context. Based on this metadata, the peer can rebuild the same deserializer, which avoids transmitting metadata for subsequent serializations and reduces network traffic pressure while supporting type forward/backward compatibility automatically.  ","version":"0.14","tagName":"h2"},{"title":"Using Meta Sharing‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/java/schema_evolution#using-meta-sharing","content":" // Fory.builder() // .withLanguage(Language.JAVA) // .withRefTracking(false) // // share meta across serialization. // .withMetaContextShare(true) // Not thread-safe fory. MetaContext context = xxx; fory.getSerializationContext().setMetaContext(context); byte[] bytes = fory.serialize(o); // Not thread-safe fory. MetaContext context = xxx; fory.getSerializationContext().setMetaContext(context); fory.deserialize(bytes);   ","version":"0.14","tagName":"h3"},{"title":"Thread-Safe Meta Sharing‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/java/schema_evolution#thread-safe-meta-sharing","content":" // Thread-safe fory fory.setClassLoader(beanA.getClass().getClassLoader()); byte[] serialized = fory.execute( f -&gt; { f.getSerializationContext().setMetaContext(context); return f.serialize(beanA); } ); // Thread-safe fory fory.setClassLoader(beanA.getClass().getClassLoader()); Object newObj = fory.execute( f -&gt; { f.getSerializationContext().setMetaContext(context); return f.deserialize(serialized); } );   Note: MetaContext is not thread-safe and cannot be reused across instances of Fory or multiple threads. In cases of multi-threading, a separate MetaContext must be created for each Fory instance.  For more details, please refer to the Meta Sharing specification.  ","version":"0.14","tagName":"h3"},{"title":"Deserialize Non-existent Classes‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/java/schema_evolution#deserialize-non-existent-classes","content":" Fory supports deserializing non-existent classes. This feature can be enabled by ForyBuilder#deserializeNonexistentClass(true).  When enabled and metadata sharing is enabled, Fory will store the deserialized data of this type in a lazy subclass of Map. By using the lazy map implemented by Fory, the rebalance cost of filling map during deserialization can be avoided, which further improves performance.  If this data is sent to another process and the class exists in this process, the data will be deserialized into the object of this type without losing any information.  If metadata sharing is not enabled, the new class data will be skipped and a NonexistentSkipClass stub object will be returned.  ","version":"0.14","tagName":"h2"},{"title":"Copy/Map Object from One Type to Another‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/java/schema_evolution#copymap-object-from-one-type-to-another","content":" Fory supports mapping objects from one type to another type.  Notes:  This mapping will execute a deep copy. All mapped fields are serialized into binary and deserialized from that binary to map into another type.All struct types must be registered with the same ID, otherwise Fory cannot map to the correct struct type. Be careful when you use Fory#register(Class), because Fory will allocate an auto-grown ID which might be inconsistent if you register classes with different order between Fory instances.  public class StructMappingExample { static class Struct1 { int f1; String f2; public Struct1(int f1, String f2) { this.f1 = f1; this.f2 = f2; } } static class Struct2 { int f1; String f2; double f3; } static ThreadSafeFory fory1 = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE).buildThreadSafeFory(); static ThreadSafeFory fory2 = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE).buildThreadSafeFory(); static { fory1.register(Struct1.class); fory2.register(Struct2.class); } public static void main(String[] args) { Struct1 struct1 = new Struct1(10, &quot;abc&quot;); Struct2 struct2 = (Struct2) fory2.deserialize(fory1.serialize(struct1)); Assert.assertEquals(struct2.f1, struct1.f1); Assert.assertEquals(struct2.f2, struct1.f2); struct1 = (Struct1) fory1.deserialize(fory2.serialize(struct2)); Assert.assertEquals(struct1.f1, struct2.f1); Assert.assertEquals(struct1.f2, struct2.f2); } }   ","version":"0.14","tagName":"h2"},{"title":"Deserialize POJO into Another Type‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/java/schema_evolution#deserialize-pojo-into-another-type","content":" Fory allows you to serialize one POJO and deserialize it into a different POJO. The different POJO means schema inconsistency. Users must configure Fory with CompatibleMode set to org.apache.fory.config.CompatibleMode.COMPATIBLE.  public class DeserializeIntoType { static class Struct1 { int f1; String f2; public Struct1(int f1, String f2) { this.f1 = f1; this.f2 = f2; } } static class Struct2 { int f1; String f2; double f3; } static ThreadSafeFory fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE).buildThreadSafeFory(); public static void main(String[] args) { Struct1 struct1 = new Struct1(10, &quot;abc&quot;); byte[] data = fory.serializeJavaObject(struct1); Struct2 struct2 = (Struct2) fory.deserializeJavaObject(bytes, Struct2.class); } }   ","version":"0.14","tagName":"h2"},{"title":"Configuration Options‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/java/schema_evolution#configuration-options","content":" Option\tDescription\tDefaultcompatibleMode\tSCHEMA_CONSISTENT or COMPATIBLE\tSCHEMA_CONSISTENT checkClassVersion\tCheck class schema consistency\tfalse metaShareEnabled\tEnable meta sharing\ttrue if Compatible mode scopedMetaShareEnabled\tScoped meta share per serialization\ttrue if Compatible mode deserializeNonexistentClass\tHandle non-existent classes\ttrue if Compatible mode metaCompressor\tCompressor for meta compression\tDeflaterMetaCompressor  ","version":"0.14","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/java/schema_evolution#best-practices","content":" Use COMPATIBLE mode for evolving schemas: When classes may change between versionsEnable meta sharing for network communication: Reduces bandwidth for repeated serializationsUse consistent type IDs for struct mapping: Ensure same registration order or explicit IDsConsider space overhead: Compatible mode adds metadata, balance with your requirements  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/java/schema_evolution#related-topics","content":" Configuration Options - All ForyBuilder optionsCross-Language Serialization - XLANG modeTroubleshooting - Common schema issues ","version":"0.14","tagName":"h2"},{"title":"Type Registration & Security","type":0,"sectionRef":"#","url":"/docs/0.14/guide/java/type_registration","content":"","keywords":"","version":"0.14"},{"title":"Class Registration‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/0.14/guide/java/type_registration#class-registration","content":" ForyBuilder#requireClassRegistration can be used to disable class registration. This will allow deserializing objects of unknown types, which is more flexible but may be insecure if the classes contain malicious code.  Do not disable class registration unless you can ensure your environment is secure. Malicious code in init/equals/hashCode can be executed when deserializing unknown/untrusted types when this option is disabled.  Class registration can not only reduce security risks, but also avoid classname serialization cost.  ","version":"0.14","tagName":"h2"},{"title":"Register by ID‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/0.14/guide/java/type_registration#register-by-id","content":" You can register class with API Fory#register:  Fory fory = xxx; fory.register(SomeClass.class); fory.register(SomeClass1.class, 1);   Note that class registration order is important. Serialization and deserialization peers should have the same registration order.  ","version":"0.14","tagName":"h3"},{"title":"Register by Name‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/0.14/guide/java/type_registration#register-by-name","content":" Register class by ID will have better performance and smaller space overhead. But in some cases, management for a bunch of type IDs is complex. In such cases, registering class by name using API register(Class&lt;?&gt; cls, String namespace, String typeName) is recommended:  fory.register(Foo.class, &quot;demo&quot;, &quot;Foo&quot;);   If there are no duplicate names for types, namespace can be left as empty to reduce serialized size.  Do not use this API to register class since it will increase serialized size a lot compared to registering class by ID.  ","version":"0.14","tagName":"h3"},{"title":"Security Configuration‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/0.14/guide/java/type_registration#security-configuration","content":" ","version":"0.14","tagName":"h2"},{"title":"Class Checker‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/0.14/guide/java/type_registration#class-checker","content":" If you invoke ForyBuilder#requireClassRegistration(false) to disable class registration check, you can set org.apache.fory.resolver.ClassChecker by ClassResolver#setClassChecker to control which classes are allowed for serialization.  For example, you can allow classes started with org.example.*:  Fory fory = xxx; fory.getClassResolver().setClassChecker( (classResolver, className) -&gt; className.startsWith(&quot;org.example.&quot;));   ","version":"0.14","tagName":"h3"},{"title":"AllowListChecker‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/0.14/guide/java/type_registration#allowlistchecker","content":" Fory provides a org.apache.fory.resolver.AllowListChecker which is an allowed/disallowed list based checker to simplify the customization of class check mechanism:  AllowListChecker checker = new AllowListChecker(AllowListChecker.CheckLevel.STRICT); ThreadSafeFory fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().requireClassRegistration(true).withClassLoader(classLoader).build(); f.getClassResolver().setClassChecker(checker); checker.addListener(f.getClassResolver()); return f; }); checker.allowClass(&quot;org.example.*&quot;);   You can use this checker or implement a more sophisticated checker by yourself.  ","version":"0.14","tagName":"h3"},{"title":"Limit Max Deserialization Depth‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/0.14/guide/java/type_registration#limit-max-deserialization-depth","content":" Fory provides ForyBuilder#withMaxDepth to limit max deserialization depth. The default max depth is 50.  If max depth is reached, Fory will throw ForyException. This can be used to prevent malicious data from causing stack overflow or other issues.  Fory fory = Fory.builder() .withLanguage(Language.JAVA) .withMaxDepth(100) // Set custom max depth .build();   ","version":"0.14","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/0.14/guide/java/type_registration#best-practices","content":" Always enable class registration in production: Use requireClassRegistration(true)Use ID-based registration for performance: Numeric IDs are faster than string namesMaintain consistent registration order: Same order on both serialization and deserialization sidesSet appropriate max depth: Prevent stack overflow attacksUse AllowListChecker for fine-grained control: When you need flexible class filtering  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/0.14/guide/java/type_registration#related-topics","content":" Configuration Options - ForyBuilder security optionsCustom Serializers - Register custom serializersTroubleshooting - Common registration issues ","version":"0.14","tagName":"h2"},{"title":"Troubleshooting","type":0,"sectionRef":"#","url":"/docs/0.14/guide/java/troubleshooting","content":"","keywords":"","version":"0.14"},{"title":"Class Inconsistency and Class Version Check‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/java/troubleshooting#class-inconsistency-and-class-version-check","content":" If you create Fory without setting CompatibleMode to org.apache.fory.config.CompatibleMode.COMPATIBLE, and you get a strange serialization error, it may be caused by class inconsistency between the serialization peer and deserialization peer.  In such cases, you can invoke ForyBuilder#withClassVersionCheck to create Fory to validate it. If deserialization throws org.apache.fory.exception.ClassNotCompatibleException, it shows classes are inconsistent, and you should create Fory with ForyBuilder#withCompatibleMode(CompatibleMode.COMPATIBLE).  // Enable class version check to diagnose issues Fory fory = Fory.builder() .withLanguage(Language.JAVA) .withClassVersionCheck(true) .build(); // If ClassNotCompatibleException is thrown, use compatible mode Fory fory = Fory.builder() .withLanguage(Language.JAVA) .withCompatibleMode(CompatibleMode.COMPATIBLE) .build();   Note: CompatibleMode.COMPATIBLE has more performance and space cost. Do not set it by default if your classes are always consistent between serialization and deserialization.  ","version":"0.14","tagName":"h2"},{"title":"Using Wrong API for Deserialization‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/java/troubleshooting#using-wrong-api-for-deserialization","content":" Make sure you use the matching API pairs:  Serialization API\tDeserialization APIFory#serialize\tFory#deserialize Fory#serializeJavaObject\tFory#deserializeJavaObject Fory#serializeJavaObjectAndClass\tFory#deserializeJavaObjectAndClass  Wrong usage examples:  // ‚ùå Wrong: serialize with serialize, deserialize with deserializeJavaObject byte[] bytes = fory.serialize(object); Object result = fory.deserializeJavaObject(bytes, MyClass.class); // Wrong! // ‚ùå Wrong: serialize with serializeJavaObject, deserialize with deserialize byte[] bytes = fory.serializeJavaObject(object); Object result = fory.deserialize(bytes); // Wrong!   Correct usage:  // ‚úÖ Correct: matching API pairs byte[] bytes = fory.serialize(object); Object result = fory.deserialize(bytes); byte[] bytes = fory.serializeJavaObject(object); MyClass result = fory.deserializeJavaObject(bytes, MyClass.class); byte[] bytes = fory.serializeJavaObjectAndClass(object); Object result = fory.deserializeJavaObjectAndClass(bytes);   ","version":"0.14","tagName":"h2"},{"title":"Deserialize POJO into Another Type‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/java/troubleshooting#deserialize-pojo-into-another-type","content":" If you want to serialize one POJO and deserialize it into a different POJO type, you must use CompatibleMode.COMPATIBLE:  public class DeserializeIntoType { static class Struct1 { int f1; String f2; public Struct1(int f1, String f2) { this.f1 = f1; this.f2 = f2; } } static class Struct2 { int f1; String f2; double f3; } static ThreadSafeFory fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE).buildThreadSafeFory(); public static void main(String[] args) { Struct1 struct1 = new Struct1(10, &quot;abc&quot;); byte[] data = fory.serializeJavaObject(struct1); Struct2 struct2 = (Struct2) fory.deserializeJavaObject(data, Struct2.class); } }   ","version":"0.14","tagName":"h2"},{"title":"Common Error Messages‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/java/troubleshooting#common-error-messages","content":" ","version":"0.14","tagName":"h2"},{"title":"\"Class not registered\"‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/java/troubleshooting#class-not-registered","content":" Cause: Class registration is required but the class wasn't registered.  Solution: Register the class before serialization:  fory.register(MyClass.class); // or with explicit ID fory.register(MyClass.class, 100);   ","version":"0.14","tagName":"h3"},{"title":"\"ClassNotCompatibleException\"‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/java/troubleshooting#classnotcompatibleexception","content":" Cause: Class schema differs between serialization and deserialization.  Solution: Use compatible mode:  Fory fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .build();   ","version":"0.14","tagName":"h3"},{"title":"\"Max depth exceeded\"‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/java/troubleshooting#max-depth-exceeded","content":" Cause: Object graph is too deep, possibly indicating a circular reference attack.  Solution: Increase max depth if legitimate, or check for malicious data:  Fory fory = Fory.builder() .withMaxDepth(100) // Increase from default 50 .build();   ","version":"0.14","tagName":"h3"},{"title":"\"Serializer not found\"‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/java/troubleshooting#serializer-not-found","content":" Cause: No serializer registered for the type.  Solution: Register a custom serializer:  fory.registerSerializer(MyClass.class, new MyClassSerializer(fory));   ","version":"0.14","tagName":"h3"},{"title":"Performance Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/java/troubleshooting#performance-issues","content":" ","version":"0.14","tagName":"h2"},{"title":"Slow Initial Serialization‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/java/troubleshooting#slow-initial-serialization","content":" Cause: JIT compilation happening on first serialization.  Solution: Enable async compilation:  Fory fory = Fory.builder() .withAsyncCompilation(true) .build();   ","version":"0.14","tagName":"h3"},{"title":"High Memory Usage‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/java/troubleshooting#high-memory-usage","content":" Cause: Large object graphs or reference tracking overhead.  Solutions:  Disable reference tracking if not needed: .withRefTracking(false)Use custom memory allocator for poolingConsider row format for large datasets  ","version":"0.14","tagName":"h3"},{"title":"Large Serialized Size‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/java/troubleshooting#large-serialized-size","content":" Cause: Metadata overhead or uncompressed data.  Solutions:  Enable compression: .withIntCompressed(true), .withLongCompressed(true)Use compatible mode only when neededRegister classes to avoid class name serialization  ","version":"0.14","tagName":"h3"},{"title":"Debugging Tips‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/java/troubleshooting#debugging-tips","content":" Enable class version check to diagnose schema issuesCheck API pairing - ensure serialize/deserialize APIs matchVerify registration order - must be consistent across peersEnable logging to see internal operations:  LoggerFactory.setLogLevel(LogLevel.DEBUG_LEVEL);   ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/java/troubleshooting#related-topics","content":" Configuration Options - All ForyBuilder optionsSchema Evolution - Compatible mode detailsType Registration - Registration best practicesMigration Guide - Upgrading Fory versions ","version":"0.14","tagName":"h2"},{"title":"Kotlin Serialization Guide","type":0,"sectionRef":"#","url":"/docs/0.14/guide/kotlin/","content":"","keywords":"","version":"0.14"},{"title":"Features‚Äã","type":1,"pageTitle":"Kotlin Serialization Guide","url":"/docs/0.14/guide/kotlin/#features","content":" Fory Kotlin inherits all features from Fory Java, plus Kotlin-specific optimizations:  High Performance: JIT code generation, zero-copy, 20-170x faster than traditional serializationKotlin Type Support: Optimized serializers for data classes, unsigned types, ranges, and stdlib typesDefault Value Support: Automatic handling of Kotlin data class default parameters during schema evolutionSchema Evolution: Forward/backward compatibility for class schema changes  See Java Features for complete feature list.  ","version":"0.14","tagName":"h2"},{"title":"Installation‚Äã","type":1,"pageTitle":"Kotlin Serialization Guide","url":"/docs/0.14/guide/kotlin/#installation","content":" ","version":"0.14","tagName":"h2"},{"title":"Maven‚Äã","type":1,"pageTitle":"Kotlin Serialization Guide","url":"/docs/0.14/guide/kotlin/#maven","content":" &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-kotlin&lt;/artifactId&gt; &lt;version&gt;0.14.1&lt;/version&gt; &lt;/dependency&gt;   ","version":"0.14","tagName":"h3"},{"title":"Gradle‚Äã","type":1,"pageTitle":"Kotlin Serialization Guide","url":"/docs/0.14/guide/kotlin/#gradle","content":" implementation(&quot;org.apache.fory:fory-kotlin:0.14.1&quot;)   ","version":"0.14","tagName":"h3"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Kotlin Serialization Guide","url":"/docs/0.14/guide/kotlin/#quick-start","content":" import org.apache.fory.Fory import org.apache.fory.ThreadSafeFory import org.apache.fory.serializer.kotlin.KotlinSerializers data class Person(val name: String, val id: Long, val github: String) data class Point(val x: Int, val y: Int, val z: Int) fun main() { // Create Fory instance (should be reused) val fory: ThreadSafeFory = Fory.builder() .requireClassRegistration(true) .buildThreadSafeFory() // Register Kotlin serializers KotlinSerializers.registerSerializers(fory) // Register your classes fory.register(Person::class.java) fory.register(Point::class.java) val p = Person(&quot;Shawn Yang&quot;, 1, &quot;https://github.com/chaokunyang&quot;) println(fory.deserialize(fory.serialize(p))) println(fory.deserialize(fory.serialize(Point(1, 2, 3)))) }   ","version":"0.14","tagName":"h2"},{"title":"Built on Fory Java‚Äã","type":1,"pageTitle":"Kotlin Serialization Guide","url":"/docs/0.14/guide/kotlin/#built-on-fory-java","content":" Fory Kotlin is built on top of Fory Java. Most configuration options, features, and concepts from Fory Java apply directly to Kotlin. Refer to the Java documentation for:  Configuration Options - All ForyBuilder optionsBasic Serialization - Serialization patterns and APIsType Registration - Class registration and securitySchema Evolution - Forward/backward compatibilityCustom Serializers - Implement custom serializersCompression - Int, long, and string compressionTroubleshooting - Common issues and solutions  ","version":"0.14","tagName":"h2"},{"title":"Kotlin-Specific Documentation‚Äã","type":1,"pageTitle":"Kotlin Serialization Guide","url":"/docs/0.14/guide/kotlin/#kotlin-specific-documentation","content":" Fory Creation - Kotlin-specific Fory setup requirementsType Serialization - Serializing Kotlin typesDefault Values - Kotlin data class default values support ","version":"0.14","tagName":"h2"},{"title":"Default Values","type":0,"sectionRef":"#","url":"/docs/0.14/guide/kotlin/default_values","content":"","keywords":"","version":"0.14"},{"title":"Overview‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/0.14/guide/kotlin/default_values#overview","content":" When a Kotlin data class has parameters with default values, Fory can:  Detect default values using Kotlin reflectionApply default values during deserialization when fields are missing from serialized dataSupport schema evolution by allowing new fields with defaults to be added without breaking existing serialized data  ","version":"0.14","tagName":"h2"},{"title":"Usage‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/0.14/guide/kotlin/default_values#usage","content":" This feature is automatically enabled when:  Compatible mode is enabled (withCompatibleMode(CompatibleMode.COMPATIBLE))Kotlin serializers are registered (KotlinSerializers.registerSerializers(fory))A field is missing from the serialized data but exists in the target class with a default value  ","version":"0.14","tagName":"h2"},{"title":"Example‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/0.14/guide/kotlin/default_values#example","content":" import org.apache.fory.Fory import org.apache.fory.config.CompatibleMode import org.apache.fory.serializer.kotlin.KotlinSerializers // Original data class data class User(val name: String, val age: Int) // Evolved data class with new field and default value data class UserV2(val name: String, val age: Int, val email: String = &quot;default@example.com&quot;) fun main() { val fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .build() KotlinSerializers.registerSerializers(fory) fory.register(User::class.java) fory.register(UserV2::class.java) // Serialize with old schema val oldUser = User(&quot;John&quot;, 30) val serialized = fory.serialize(oldUser) // Deserialize with new schema - missing field gets default value val newUser = fory.deserialize(serialized) as UserV2 println(newUser) // UserV2(name=John, age=30, email=default@example.com) }   ","version":"0.14","tagName":"h2"},{"title":"Supported Default Value Types‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/0.14/guide/kotlin/default_values#supported-default-value-types","content":" The following types are supported for default values:  Primitive types: Int, Long, Double, Float, Boolean, Byte, Short, CharUnsigned types: UInt, ULong, UByte, UShortString: StringCollections: List, Set, Map (with default instances)Custom objects: Any object that can be instantiated via reflection  ","version":"0.14","tagName":"h2"},{"title":"Complex Default Values‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/0.14/guide/kotlin/default_values#complex-default-values","content":" Default values can be complex expressions:  data class ConfigV1(val name: String) data class ConfigV2( val name: String, val settings: Map&lt;String, String&gt; = mapOf(&quot;default&quot; to &quot;value&quot;), val tags: List&lt;String&gt; = listOf(&quot;default&quot;), val enabled: Boolean = true, val retryCount: Int = 3 ) val fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .build() KotlinSerializers.registerSerializers(fory) val original = ConfigV1(&quot;myConfig&quot;) val serialized = fory.serialize(original) val deserialized = fory.deserialize(serialized) as ConfigV2 // deserialized.name == &quot;myConfig&quot; // deserialized.settings == mapOf(&quot;default&quot; to &quot;value&quot;) // deserialized.tags == listOf(&quot;default&quot;) // deserialized.enabled == true // deserialized.retryCount == 3   ","version":"0.14","tagName":"h2"},{"title":"Nullable Fields with Defaults‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/0.14/guide/kotlin/default_values#nullable-fields-with-defaults","content":" Nullable fields with default values are also supported:  data class PersonV1(val name: String) data class PersonV2( val name: String, val nickname: String? = null, val age: Int? = null ) val original = PersonV1(&quot;John&quot;) val serialized = fory.serialize(original) val deserialized = fory.deserialize(serialized) as PersonV2 // deserialized.name == &quot;John&quot; // deserialized.nickname == null (default) // deserialized.age == null (default)   ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/0.14/guide/kotlin/default_values#related-topics","content":" Schema Evolution - Forward/backward compatibility in JavaFory Creation - Setting up Fory with compatible mode ","version":"0.14","tagName":"h2"},{"title":"Fory Creation","type":0,"sectionRef":"#","url":"/docs/0.14/guide/kotlin/fory_creation","content":"","keywords":"","version":"0.14"},{"title":"Basic Setup‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/0.14/guide/kotlin/fory_creation#basic-setup","content":" When using Fory for Kotlin serialization, register Kotlin serializers via KotlinSerializers.registerSerializers(fory):  import org.apache.fory.Fory import org.apache.fory.serializer.kotlin.KotlinSerializers val fory = Fory.builder() .requireClassRegistration(true) .build() // Register Kotlin serializers KotlinSerializers.registerSerializers(fory)   ","version":"0.14","tagName":"h2"},{"title":"Thread Safety‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/0.14/guide/kotlin/fory_creation#thread-safety","content":" Fory instance creation is not cheap. Instances should be shared between multiple serializations.  ","version":"0.14","tagName":"h2"},{"title":"Single-Thread Usage‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/0.14/guide/kotlin/fory_creation#single-thread-usage","content":" import org.apache.fory.Fory import org.apache.fory.serializer.kotlin.KotlinSerializers object ForyHolder { val fory: Fory = Fory.builder() .requireClassRegistration(true) .build().also { KotlinSerializers.registerSerializers(it) } }   ","version":"0.14","tagName":"h3"},{"title":"Multi-Thread Usage‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/0.14/guide/kotlin/fory_creation#multi-thread-usage","content":" For multi-threaded applications, use ThreadSafeFory:  import org.apache.fory.Fory import org.apache.fory.ThreadSafeFory import org.apache.fory.ThreadLocalFory import org.apache.fory.serializer.kotlin.KotlinSerializers object ForyHolder { val fory: ThreadSafeFory = ThreadLocalFory { classLoader -&gt; Fory.builder() .withClassLoader(classLoader) .requireClassRegistration(true) .build().also { KotlinSerializers.registerSerializers(it) } } }   ","version":"0.14","tagName":"h3"},{"title":"Using Builder Methods‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/0.14/guide/kotlin/fory_creation#using-builder-methods","content":" // Thread-safe Fory val fory: ThreadSafeFory = Fory.builder() .requireClassRegistration(true) .buildThreadSafeFory() KotlinSerializers.registerSerializers(fory)   ","version":"0.14","tagName":"h3"},{"title":"Configuration Options‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/0.14/guide/kotlin/fory_creation#configuration-options","content":" All configuration options from Fory Java are available. See Java Configuration Options for the complete list.  Common options for Kotlin:  import org.apache.fory.Fory import org.apache.fory.config.CompatibleMode import org.apache.fory.serializer.kotlin.KotlinSerializers val fory = Fory.builder() // Enable reference tracking for circular references .withRefTracking(true) // Enable schema evolution support .withCompatibleMode(CompatibleMode.COMPATIBLE) // Enable async compilation for better startup performance .withAsyncCompilation(true) // Compression options .withIntCompressed(true) .withLongCompressed(true) .build() KotlinSerializers.registerSerializers(fory)  ","version":"0.14","tagName":"h2"},{"title":"Python Serialization Guide","type":0,"sectionRef":"#","url":"/docs/0.14/guide/python/","content":"","keywords":"","version":"0.14"},{"title":"Key Features‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/0.14/guide/python/#key-features","content":" ","version":"0.14","tagName":"h2"},{"title":"Flexible Serialization Modes‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/0.14/guide/python/#flexible-serialization-modes","content":" Python native Mode: Full Python compatibility, drop-in replacement for pickle/cloudpickleCross-Language Mode: Optimized for multi-language data exchangeRow Format: Zero-copy row format for analytics workloads  ","version":"0.14","tagName":"h3"},{"title":"Versatile Serialization Features‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/0.14/guide/python/#versatile-serialization-features","content":" Shared/circular reference support for complex object graphs in both Python-native and cross-language modesPolymorphism support for customized types with automatic type dispatchingSchema evolution support for backward/forward compatibility when using dataclasses in cross-language modeOut-of-band buffer support for zero-copy serialization of large data structures like NumPy arrays and Pandas DataFrames, compatible with pickle protocol 5  ","version":"0.14","tagName":"h3"},{"title":"Blazing Fast Performance‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/0.14/guide/python/#blazing-fast-performance","content":" Extremely fast performance compared to other serialization frameworksRuntime code generation and Cython-accelerated core implementation for optimal performance  ","version":"0.14","tagName":"h3"},{"title":"Compact Data Size‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/0.14/guide/python/#compact-data-size","content":" Compact object graph protocol with minimal space overhead‚Äîup to 3√ó size reduction compared to pickle/cloudpickleMeta packing and sharing to minimize type forward/backward compatibility space overhead  ","version":"0.14","tagName":"h3"},{"title":"Security & Safety‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/0.14/guide/python/#security--safety","content":" Strict mode prevents deserialization of untrusted types by type registration and checks.Reference tracking for handling circular references safely  ","version":"0.14","tagName":"h3"},{"title":"Installation‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/0.14/guide/python/#installation","content":" ","version":"0.14","tagName":"h2"},{"title":"Basic Installation‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/0.14/guide/python/#basic-installation","content":" pip install pyfory   ","version":"0.14","tagName":"h3"},{"title":"Optional Dependencies‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/0.14/guide/python/#optional-dependencies","content":" # Install with row format support (requires Apache Arrow) pip install pyfory[format] # Install from source for development git clone https://github.com/apache/fory.git cd fory/python pip install -e &quot;.[dev,format]&quot;   ","version":"0.14","tagName":"h3"},{"title":"Requirements‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/0.14/guide/python/#requirements","content":" Python: 3.8 or higherOS: Linux, macOS, Windows  ","version":"0.14","tagName":"h3"},{"title":"Thread Safety‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/0.14/guide/python/#thread-safety","content":" pyfory provides ThreadSafeFory for thread-safe serialization using thread-local storage:  import pyfory import threading from dataclasses import dataclass @dataclass class Person: name: str age: int # Create thread-safe Fory instance fory = pyfory.ThreadSafeFory(xlang=False, ref=True) fory.register(Person) # Use in multiple threads safely def serialize_in_thread(thread_id): person = Person(name=f&quot;User{thread_id}&quot;, age=25 + thread_id) data = fory.serialize(person) result = fory.deserialize(data) print(f&quot;Thread {thread_id}: {result}&quot;) threads = [threading.Thread(target=serialize_in_thread, args=(i,)) for i in range(10)] for t in threads: t.start() for t in threads: t.join()   Key Features:  Instance Pool: Maintains a pool of Fory instances protected by a lock for thread safetyShared Configuration: All registrations must be done upfront and are applied to all instancesSame API: Drop-in replacement for Fory class with identical methodsRegistration Safety: Prevents registration after first use to ensure consistency  When to Use:  Multi-threaded Applications: Web servers, concurrent workers, parallel processingShared Fory Instances: When multiple threads need to serialize/deserialize dataThread Pools: Applications using thread pools or concurrent.futures  ","version":"0.14","tagName":"h2"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/0.14/guide/python/#quick-start","content":" import pyfory from dataclasses import dataclass @dataclass class Person: name: str age: int # Create Fory instance fory = pyfory.Fory(xlang=False, ref=True) fory.register(Person) person = Person(&quot;Alice&quot;, 30) data = fory.serialize(person) result = fory.deserialize(data) print(result) # Person(name='Alice', age=30)   ","version":"0.14","tagName":"h2"},{"title":"Next Steps‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/0.14/guide/python/#next-steps","content":" Configuration - Fory parameters and modesBasic Serialization - Basic usage patternsPython Native Mode - Functions, lambdas, classesCross-Language - XLANG modeRow Format - Zero-copy row formatSecurity - Security best practices  ","version":"0.14","tagName":"h2"},{"title":"Links‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/0.14/guide/python/#links","content":" Documentation: https://fory.apache.org/docs/latest/python_guide/GitHub: https://github.com/apache/foryPyPI: https://pypi.org/project/pyfory/Issues: https://github.com/apache/fory/issuesSlack: https://join.slack.com/t/fory-project/shared_invite/zt-36g0qouzm-kcQSvV_dtfbtBKHRwT5gsw ","version":"0.14","tagName":"h2"},{"title":"Custom Serializers","type":0,"sectionRef":"#","url":"/docs/0.14/guide/java/custom_serializers","content":"","keywords":"","version":"0.14"},{"title":"Basic Custom Serializer‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/java/custom_serializers#basic-custom-serializer","content":" In some cases, you may want to implement a serializer for your type, especially for classes that customize serialization using JDK writeObject/writeReplace/readObject/readResolve, which is very inefficient.  For example, if you don't want the following Foo#writeObject to be invoked, you can implement a custom serializer:  class Foo { public long f1; private void writeObject(ObjectOutputStream s) throws IOException { System.out.println(f1); s.defaultWriteObject(); } } class FooSerializer extends Serializer&lt;Foo&gt; { public FooSerializer(Fory fory) { super(fory, Foo.class); } @Override public void write(MemoryBuffer buffer, Foo value) { buffer.writeInt64(value.f1); } @Override public Foo read(MemoryBuffer buffer) { Foo foo = new Foo(); foo.f1 = buffer.readInt64(); return foo; } }   ","version":"0.14","tagName":"h2"},{"title":"Register the Serializer‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/java/custom_serializers#register-the-serializer","content":" Fory fory = getFory(); fory.registerSerializer(Foo.class, new FooSerializer(fory));   Besides registering serializers, you can also implement java.io.Externalizable for a class to customize serialization logic. Such types will be serialized by Fory's ExternalizableSerializer.  ","version":"0.14","tagName":"h3"},{"title":"Collection Serializer‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/java/custom_serializers#collection-serializer","content":" When implementing a serializer for a custom Collection type, you must extend CollectionSerializer or CollectionLikeSerializer. The key difference is that CollectionLikeSerializer can serialize a class which has a collection-like structure but is not a Java Collection subtype.  ","version":"0.14","tagName":"h2"},{"title":"supportCodegenHook Parameter‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/java/custom_serializers#supportcodegenhook-parameter","content":" This special parameter controls serialization behavior:  When true:  Enables optimized access to collection elements and JIT compilation for better performanceDirect serialization invocation and inline for collection items without dynamic serializer dispatch costBetter performance for standard collection typesRecommended for most collections  When false:  Uses interface-based element access and dynamic serializer dispatch for elements (higher cost)More flexible for custom collection typesRequired when collection has special serialization needsHandles complex collection implementations  ","version":"0.14","tagName":"h3"},{"title":"Collection Serializer with JIT Support‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/java/custom_serializers#collection-serializer-with-jit-support","content":" When implementing a Collection serializer with JIT support, leverage Fory's existing binary format and collection serialization infrastructure:  public class CustomCollectionSerializer&lt;T extends Collection&gt; extends CollectionSerializer&lt;T&gt; { public CustomCollectionSerializer(Fory fory, Class&lt;T&gt; cls) { // supportCodegenHook controls whether to use JIT compilation super(fory, cls, true); } @Override public Collection onCollectionWrite(MemoryBuffer buffer, T value) { // Write collection size buffer.writeVarUint32Small7(value.size()); // Write any additional collection metadata return value; } @Override public Collection newCollection(MemoryBuffer buffer) { // Create new collection instance Collection collection = super.newCollection(buffer); // Read and set collection size int numElements = getAndClearNumElements(); setNumElements(numElements); return collection; } }   Note: Invoke setNumElements when implementing newCollection to let Fory know how many elements to deserialize.  ","version":"0.14","tagName":"h3"},{"title":"Custom Collection Serializer without JIT‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/java/custom_serializers#custom-collection-serializer-without-jit","content":" For collections that use primitive arrays or have special requirements, implement a serializer with JIT disabled:  class IntList extends AbstractCollection&lt;Integer&gt; { private final int[] elements; private final int size; public IntList(int size) { this.elements = new int[size]; this.size = size; } public IntList(int[] elements, int size) { this.elements = elements; this.size = size; } @Override public Iterator&lt;Integer&gt; iterator() { return new Iterator&lt;Integer&gt;() { private int index = 0; @Override public boolean hasNext() { return index &lt; size; } @Override public Integer next() { if (!hasNext()) { throw new NoSuchElementException(); } return elements[index++]; } }; } @Override public int size() { return size; } public int get(int index) { if (index &gt;= size) { throw new IndexOutOfBoundsException(); } return elements[index]; } public void set(int index, int value) { if (index &gt;= size) { throw new IndexOutOfBoundsException(); } elements[index] = value; } public int[] getElements() { return elements; } } class IntListSerializer extends CollectionLikeSerializer&lt;IntList&gt; { public IntListSerializer(Fory fory) { // Disable JIT since we're handling serialization directly super(fory, IntList.class, false); } @Override public void write(MemoryBuffer buffer, IntList value) { // Write size buffer.writeVarUint32Small7(value.size()); // Write elements directly as primitive ints int[] elements = value.getElements(); for (int i = 0; i &lt; value.size(); i++) { buffer.writeVarInt32(elements[i]); } } @Override public IntList read(MemoryBuffer buffer) { // Read size int size = buffer.readVarUint32Small7(); // Create array and read elements int[] elements = new int[size]; for (int i = 0; i &lt; size; i++) { elements[i] = buffer.readVarInt32(); } return new IntList(elements, size); } // These methods are not used when JIT is disabled @Override public Collection onCollectionWrite(MemoryBuffer buffer, IntList value) { throw new UnsupportedOperationException(); } @Override public Collection newCollection(MemoryBuffer buffer) { throw new UnsupportedOperationException(); } @Override public IntList onCollectionRead(Collection collection) { throw new UnsupportedOperationException(); } }   When to use this approach:  Working with primitive typesNeed maximum performanceWant to minimize memory overheadHave special serialization requirements  ","version":"0.14","tagName":"h3"},{"title":"Collection-like Type Serializer‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/java/custom_serializers#collection-like-type-serializer","content":" For types that behave like collections but aren't standard Java Collections:  class CustomCollectionLike { private final Object[] elements; private final int size; public CustomCollectionLike(int size) { this.elements = new Object[size]; this.size = 0; } public CustomCollectionLike(Object[] elements, int size) { this.elements = elements; this.size = size; } public Object get(int index) { if (index &gt;= size) { throw new IndexOutOfBoundsException(); } return elements[index]; } public int size() { return size; } public Object[] getElements() { return elements; } } class CollectionView extends AbstractCollection&lt;Object&gt; { private final Object[] elements; private final int size; private int writeIndex; public CollectionView(CustomCollectionLike collection) { this.elements = collection.getElements(); this.size = collection.size(); } public CollectionView(int size) { this.size = size; this.elements = new Object[size]; } @Override public Iterator&lt;Object&gt; iterator() { return new Iterator&lt;Object&gt;() { private int index = 0; @Override public boolean hasNext() { return index &lt; size; } @Override public Object next() { if (!hasNext()) { throw new NoSuchElementException(); } return elements[index++]; } }; } @Override public boolean add(Object element) { if (writeIndex &gt;= size) { throw new IllegalStateException(&quot;Collection is full&quot;); } elements[writeIndex++] = element; return true; } @Override public int size() { return size; } public Object[] getElements() { return elements; } } class CustomCollectionSerializer extends CollectionLikeSerializer&lt;CustomCollectionLike&gt; { public CustomCollectionSerializer(Fory fory) { super(fory, CustomCollectionLike.class, true); } @Override public Collection onCollectionWrite(MemoryBuffer buffer, CustomCollectionLike value) { buffer.writeVarUint32Small7(value.size()); return new CollectionView(value); } @Override public Collection newCollection(MemoryBuffer buffer) { int numElements = buffer.readVarUint32Small7(); setNumElements(numElements); return new CollectionView(numElements); } @Override public CustomCollectionLike onCollectionRead(Collection collection) { CollectionView view = (CollectionView) collection; return new CustomCollectionLike(view.getElements(), view.size()); } }   ","version":"0.14","tagName":"h3"},{"title":"Map Serializer‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/java/custom_serializers#map-serializer","content":" When implementing a serializer for a custom Map type, extend MapSerializer or MapLikeSerializer. The key difference is that MapLikeSerializer can serialize a class which has a map-like structure but is not a Java Map subtype.  ","version":"0.14","tagName":"h2"},{"title":"Map Serializer with JIT Support‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/java/custom_serializers#map-serializer-with-jit-support","content":" public class CustomMapSerializer&lt;T extends Map&gt; extends MapSerializer&lt;T&gt; { public CustomMapSerializer(Fory fory, Class&lt;T&gt; cls) { // supportCodegenHook is a critical parameter that determines serialization behavior super(fory, cls, true); } @Override public Map onMapWrite(MemoryBuffer buffer, T value) { // Write map size buffer.writeVarUint32Small7(value.size()); // Write any additional map metadata here return value; } @Override public Map newMap(MemoryBuffer buffer) { // Read map size int numElements = buffer.readVarUint32Small7(); setNumElements(numElements); // Create and return new map instance T map = (T) new HashMap(numElements); fory.getRefResolver().reference(map); return map; } }   Note: Invoke setNumElements when implementing newMap to let Fory know how many elements to deserialize.  ","version":"0.14","tagName":"h3"},{"title":"Custom Map Serializer without JIT‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/java/custom_serializers#custom-map-serializer-without-jit","content":" For complete control over the serialization process:  class FixedValueMap extends AbstractMap&lt;String, Integer&gt; { private final Set&lt;String&gt; keys; private final int fixedValue; public FixedValueMap(Set&lt;String&gt; keys, int fixedValue) { this.keys = keys; this.fixedValue = fixedValue; } @Override public Set&lt;Entry&lt;String, Integer&gt;&gt; entrySet() { Set&lt;Entry&lt;String, Integer&gt;&gt; entries = new HashSet&lt;&gt;(); for (String key : keys) { entries.add(new SimpleEntry&lt;&gt;(key, fixedValue)); } return entries; } @Override public Integer get(Object key) { return keys.contains(key) ? fixedValue : null; } public Set&lt;String&gt; getKeys() { return keys; } public int getFixedValue() { return fixedValue; } } class FixedValueMapSerializer extends MapLikeSerializer&lt;FixedValueMap&gt; { public FixedValueMapSerializer(Fory fory) { // Disable codegen since we're handling serialization directly super(fory, FixedValueMap.class, false); } @Override public void write(MemoryBuffer buffer, FixedValueMap value) { // Write the fixed value buffer.writeInt32(value.getFixedValue()); // Write the number of keys buffer.writeVarUint32Small7(value.getKeys().size()); // Write each key for (String key : value.getKeys()) { buffer.writeString(key); } } @Override public FixedValueMap read(MemoryBuffer buffer) { // Read the fixed value int fixedValue = buffer.readInt32(); // Read the number of keys int size = buffer.readVarUint32Small7(); Set&lt;String&gt; keys = new HashSet&lt;&gt;(size); for (int i = 0; i &lt; size; i++) { keys.add(buffer.readString()); } return new FixedValueMap(keys, fixedValue); } // These methods are not used when supportCodegenHook is false @Override public Map onMapWrite(MemoryBuffer buffer, FixedValueMap value) { throw new UnsupportedOperationException(); } @Override public FixedValueMap onMapRead(Map map) { throw new UnsupportedOperationException(); } @Override public FixedValueMap onMapCopy(Map map) { throw new UnsupportedOperationException(); } }   ","version":"0.14","tagName":"h3"},{"title":"Map-like Type Serializer‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/java/custom_serializers#map-like-type-serializer","content":" For types that behave like maps but aren't standard Java Maps:  class CustomMapLike { private final Object[] keyArray; private final Object[] valueArray; private final int size; public CustomMapLike(int initialCapacity) { this.keyArray = new Object[initialCapacity]; this.valueArray = new Object[initialCapacity]; this.size = 0; } public CustomMapLike(Object[] keyArray, Object[] valueArray, int size) { this.keyArray = keyArray; this.valueArray = valueArray; this.size = size; } public Integer get(String key) { for (int i = 0; i &lt; size; i++) { if (key.equals(keyArray[i])) { return (Integer) valueArray[i]; } } return null; } public int size() { return size; } public Object[] getKeyArray() { return keyArray; } public Object[] getValueArray() { return valueArray; } } class MapView extends AbstractMap&lt;Object, Object&gt; { private final Object[] keyArray; private final Object[] valueArray; private final int size; private int writeIndex; public MapView(CustomMapLike mapLike) { this.size = mapLike.size(); this.keyArray = mapLike.getKeyArray(); this.valueArray = mapLike.getValueArray(); } public MapView(int size) { this.size = size; this.keyArray = new Object[size]; this.valueArray = new Object[size]; } @Override public Set&lt;Entry&lt;Object, Object&gt;&gt; entrySet() { return new AbstractSet&lt;Entry&lt;Object, Object&gt;&gt;() { @Override public Iterator&lt;Entry&lt;Object, Object&gt;&gt; iterator() { return new Iterator&lt;Entry&lt;Object, Object&gt;&gt;() { private int index = 0; @Override public boolean hasNext() { return index &lt; size; } @Override public Entry&lt;Object, Object&gt; next() { if (!hasNext()) { throw new NoSuchElementException(); } final int currentIndex = index++; return new SimpleEntry&lt;&gt;( keyArray[currentIndex], valueArray[currentIndex] ); } }; } @Override public int size() { return size; } }; } @Override public Object put(Object key, Object value) { if (writeIndex &gt;= size) { throw new IllegalStateException(&quot;Map is full&quot;); } keyArray[writeIndex] = key; valueArray[writeIndex] = value; writeIndex++; return null; } public Object[] getKeyArray() { return keyArray; } public Object[] getValueArray() { return valueArray; } public int size() { return size; } } class CustomMapLikeSerializer extends MapLikeSerializer&lt;CustomMapLike&gt; { public CustomMapLikeSerializer(Fory fory) { super(fory, CustomMapLike.class, true); } @Override public Map onMapWrite(MemoryBuffer buffer, CustomMapLike value) { buffer.writeVarUint32Small7(value.size()); return new MapView(value); } @Override public Map newMap(MemoryBuffer buffer) { int numElements = buffer.readVarUint32Small7(); setNumElements(numElements); return new MapView(numElements); } @Override public CustomMapLike onMapRead(Map map) { MapView view = (MapView) map; return new CustomMapLike(view.getKeyArray(), view.getValueArray(), view.size()); } @Override public CustomMapLike onMapCopy(Map map) { MapView view = (MapView) map; return new CustomMapLike(view.getKeyArray(), view.getValueArray(), view.size()); } }   ","version":"0.14","tagName":"h3"},{"title":"Registering Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/java/custom_serializers#registering-custom-serializers","content":" Fory fory = Fory.builder() .withLanguage(Language.JAVA) .build(); // Register map serializer fory.registerSerializer(CustomMap.class, new CustomMapSerializer&lt;&gt;(fory, CustomMap.class)); // Register collection serializer fory.registerSerializer(CustomCollection.class, new CustomCollectionSerializer&lt;&gt;(fory, CustomCollection.class));   ","version":"0.14","tagName":"h2"},{"title":"Key Points‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/java/custom_serializers#key-points","content":" When implementing custom map or collection serializers:  Always extend the appropriate base class (MapSerializer/MapLikeSerializer for maps, CollectionSerializer/CollectionLikeSerializer for collections)Consider the impact of supportCodegenHook on performance and functionalityProperly handle reference tracking if neededImplement proper size management using setNumElements and getAndClearNumElements when supportCodegenHook is true  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/java/custom_serializers#related-topics","content":" Type Registration - Register serializersSchema Evolution - Compatible mode considerationsConfiguration Options - Serialization options ","version":"0.14","tagName":"h2"},{"title":"Type Serialization","type":0,"sectionRef":"#","url":"/docs/0.14/guide/kotlin/type_serialization","content":"","keywords":"","version":"0.14"},{"title":"Setup‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/kotlin/type_serialization#setup","content":" All examples assume the following setup:  import org.apache.fory.Fory import org.apache.fory.serializer.kotlin.KotlinSerializers val fory = Fory.builder() .requireClassRegistration(false) .build() KotlinSerializers.registerSerializers(fory)   ","version":"0.14","tagName":"h2"},{"title":"Data Class‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/kotlin/type_serialization#data-class","content":" data class Person(val name: String, val age: Int, val id: Long) fory.register(Person::class.java) val p = Person(&quot;John&quot;, 30, 1L) println(fory.deserialize(fory.serialize(p)))   ","version":"0.14","tagName":"h2"},{"title":"Unsigned Primitives‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/kotlin/type_serialization#unsigned-primitives","content":" Kotlin unsigned types are fully supported:  val uByte: UByte = 255u val uShort: UShort = 65535u val uInt: UInt = 4294967295u val uLong: ULong = 18446744073709551615u println(fory.deserialize(fory.serialize(uByte))) println(fory.deserialize(fory.serialize(uShort))) println(fory.deserialize(fory.serialize(uInt))) println(fory.deserialize(fory.serialize(uLong)))   ","version":"0.14","tagName":"h2"},{"title":"Unsigned Arrays‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/kotlin/type_serialization#unsigned-arrays","content":" val uByteArray = ubyteArrayOf(1u, 2u, 255u) val uShortArray = ushortArrayOf(1u, 2u, 65535u) val uIntArray = uintArrayOf(1u, 2u, 4294967295u) val uLongArray = ulongArrayOf(1u, 2u, 18446744073709551615u) println(fory.deserialize(fory.serialize(uByteArray)).contentToString()) println(fory.deserialize(fory.serialize(uShortArray)).contentToString()) println(fory.deserialize(fory.serialize(uIntArray)).contentToString()) println(fory.deserialize(fory.serialize(uLongArray)).contentToString())   ","version":"0.14","tagName":"h2"},{"title":"Stdlib Types‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/kotlin/type_serialization#stdlib-types","content":" ","version":"0.14","tagName":"h2"},{"title":"Pair and Triple‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/kotlin/type_serialization#pair-and-triple","content":" val pair = Pair(&quot;key&quot;, 42) val triple = Triple(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;) println(fory.deserialize(fory.serialize(pair))) println(fory.deserialize(fory.serialize(triple)))   ","version":"0.14","tagName":"h3"},{"title":"Result‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/kotlin/type_serialization#result","content":" val success: Result&lt;Int&gt; = Result.success(42) val failure: Result&lt;Int&gt; = Result.failure(Exception(&quot;error&quot;)) println(fory.deserialize(fory.serialize(success))) println(fory.deserialize(fory.serialize(failure)))   ","version":"0.14","tagName":"h3"},{"title":"Ranges and Progressions‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/kotlin/type_serialization#ranges-and-progressions","content":" val intRange = 1..10 val longRange = 1L..100L val charRange = 'a'..'z' println(fory.deserialize(fory.serialize(intRange))) println(fory.deserialize(fory.serialize(longRange))) println(fory.deserialize(fory.serialize(charRange))) // Progressions val intProgression = 1..10 step 2 val longProgression = 1L..100L step 10 println(fory.deserialize(fory.serialize(intProgression))) println(fory.deserialize(fory.serialize(longProgression)))   ","version":"0.14","tagName":"h2"},{"title":"Collections‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/kotlin/type_serialization#collections","content":" ","version":"0.14","tagName":"h2"},{"title":"ArrayDeque‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/kotlin/type_serialization#arraydeque","content":" val deque = ArrayDeque&lt;String&gt;() deque.addFirst(&quot;first&quot;) deque.addLast(&quot;last&quot;) println(fory.deserialize(fory.serialize(deque)))   ","version":"0.14","tagName":"h3"},{"title":"Empty Collections‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/kotlin/type_serialization#empty-collections","content":" val emptyList = emptyList&lt;String&gt;() val emptySet = emptySet&lt;Int&gt;() val emptyMap = emptyMap&lt;String, Int&gt;() println(fory.deserialize(fory.serialize(emptyList))) println(fory.deserialize(fory.serialize(emptySet))) println(fory.deserialize(fory.serialize(emptyMap)))   ","version":"0.14","tagName":"h3"},{"title":"Duration‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/kotlin/type_serialization#duration","content":" import kotlin.time.Duration import kotlin.time.Duration.Companion.hours import kotlin.time.Duration.Companion.minutes val duration: Duration = 2.hours + 30.minutes println(fory.deserialize(fory.serialize(duration)))   ","version":"0.14","tagName":"h2"},{"title":"Regex‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/kotlin/type_serialization#regex","content":" val regex = Regex(&quot;[a-zA-Z]+&quot;) println(fory.deserialize(fory.serialize(regex)))   ","version":"0.14","tagName":"h2"},{"title":"UUID (Kotlin 2.0+)‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/kotlin/type_serialization#uuid-kotlin-20","content":" import kotlin.uuid.Uuid val uuid = Uuid.random() println(fory.deserialize(fory.serialize(uuid)))   ","version":"0.14","tagName":"h2"},{"title":"Types Working Out of the Box‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/kotlin/type_serialization#types-working-out-of-the-box","content":" The following types work with the default Fory Java implementation without needing KotlinSerializers:  Primitives: Byte, Boolean, Int, Short, Long, Char, Float, DoubleString: StringCollections: ArrayList, HashMap, HashSet, LinkedHashSet, LinkedHashMapArrays: Array, BooleanArray, ByteArray, CharArray, DoubleArray, FloatArray, IntArray, LongArray, ShortArray  However, it's recommended to always call KotlinSerializers.registerSerializers(fory) to ensure all Kotlin types are properly supported. ","version":"0.14","tagName":"h2"},{"title":"Basic Serialization","type":0,"sectionRef":"#","url":"/docs/0.14/guide/python/basic_serialization","content":"","keywords":"","version":"0.14"},{"title":"Basic Object Serialization‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/python/basic_serialization#basic-object-serialization","content":" Serialize and deserialize Python objects with a simple API:  import pyfory # Create Fory instance fory = pyfory.Fory(xlang=True) # Serialize any Python object data = fory.dumps({&quot;name&quot;: &quot;Alice&quot;, &quot;age&quot;: 30, &quot;scores&quot;: [95, 87, 92]}) # Deserialize back to Python object obj = fory.loads(data) print(obj) # {'name': 'Alice', 'age': 30, 'scores': [95, 87, 92]}   Note: dumps()/loads() are aliases for serialize()/deserialize(). Both APIs are identical, use whichever feels more intuitive.  ","version":"0.14","tagName":"h2"},{"title":"Custom Class Serialization‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/python/basic_serialization#custom-class-serialization","content":" Fory automatically handles dataclasses and custom types:  import pyfory from dataclasses import dataclass from typing import List, Dict @dataclass class Person: name: str age: int scores: List[int] metadata: Dict[str, str] # Python mode - supports all Python types including dataclasses fory = pyfory.Fory(xlang=False, ref=True) fory.register(Person) person = Person(&quot;Bob&quot;, 25, [88, 92, 85], {&quot;team&quot;: &quot;engineering&quot;}) data = fory.serialize(person) result = fory.deserialize(data) print(result) # Person(name='Bob', age=25, ...)   ","version":"0.14","tagName":"h2"},{"title":"Reference Tracking & Circular References‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/python/basic_serialization#reference-tracking--circular-references","content":" Handle shared references and circular dependencies safely:  import pyfory f = pyfory.Fory(ref=True) # Enable reference tracking # Handle circular references safely class Node: def __init__(self, value): self.value = value self.children = [] self.parent = None root = Node(&quot;root&quot;) child = Node(&quot;child&quot;) child.parent = root # Circular reference root.children.append(child) # Serializes without infinite recursion data = f.serialize(root) result = f.deserialize(data) assert result.children[0].parent is result # Reference preserved   ","version":"0.14","tagName":"h2"},{"title":"API Reference‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/python/basic_serialization#api-reference","content":" ","version":"0.14","tagName":"h2"},{"title":"Serialization Methods‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/python/basic_serialization#serialization-methods","content":" # Serialize to bytes data: bytes = fory.serialize(obj) data: bytes = fory.dumps(obj) # Alias # Deserialize from bytes obj = fory.deserialize(data) obj = fory.loads(data) # Alias   ","version":"0.14","tagName":"h3"},{"title":"With Out-of-Band Buffers‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/python/basic_serialization#with-out-of-band-buffers","content":" # Serialize with buffer callback buffer_objects = [] data = fory.serialize(obj, buffer_callback=buffer_objects.append) # Deserialize with buffers buffers = [obj.getbuffer() for obj in buffer_objects] obj = fory.deserialize(data, buffers=buffers)   ","version":"0.14","tagName":"h3"},{"title":"Performance Tips‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/python/basic_serialization#performance-tips","content":" Disable ref=True if not needed: Reference tracking has overheadUse type_id instead of typename: Integer IDs are faster than string namesReuse Fory instances: Create once, use many timesEnable Cython: Make sure ENABLE_FORY_CYTHON_SERIALIZATION=1  # Good: Reuse instance fory = pyfory.Fory() for obj in objects: data = fory.dumps(obj) # Bad: Create new instance each time for obj in objects: fory = pyfory.Fory() # Wasteful! data = fory.dumps(obj)   ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/python/basic_serialization#related-topics","content":" Configuration - Fory parametersType Registration - Registration patternsPython Native Mode - Functions and lambdas ","version":"0.14","tagName":"h2"},{"title":"Configuration","type":0,"sectionRef":"#","url":"/docs/0.14/guide/python/configuration","content":"","keywords":"","version":"0.14"},{"title":"Fory Class‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/python/configuration#fory-class","content":" The main serialization interface:  class Fory: def __init__( self, xlang: bool = False, ref: bool = False, strict: bool = True, compatible: bool = False, max_depth: int = 50 )   ","version":"0.14","tagName":"h2"},{"title":"ThreadSafeFory Class‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/python/configuration#threadsafefory-class","content":" Thread-safe serialization interface using thread-local storage:  class ThreadSafeFory: def __init__( self, xlang: bool = False, ref: bool = False, strict: bool = True, compatible: bool = False, max_depth: int = 50 )   ","version":"0.14","tagName":"h2"},{"title":"Parameters‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/python/configuration#parameters","content":" Parameter\tType\tDefault\tDescriptionxlang\tbool\tFalse\tEnable cross-language serialization. When False, enables Python-native mode supporting all Python objects. When True, enables cross-language mode compatible with Java, Go, Rust, etc. ref\tbool\tFalse\tEnable reference tracking for shared/circular references. Disable for better performance if your data has no shared references. strict\tbool\tTrue\tRequire type registration for security. Highly recommended for production. Only disable in trusted environments. compatible\tbool\tFalse\tEnable schema evolution in cross-language mode, allowing fields to be added/removed while maintaining compatibility. max_depth\tint\t50\tMaximum deserialization depth for security, preventing stack overflow attacks.  ","version":"0.14","tagName":"h2"},{"title":"Key Methods‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/python/configuration#key-methods","content":" # Serialization (serialize/deserialize are identical to dumps/loads) data: bytes = fory.serialize(obj) obj = fory.deserialize(data) # Alternative API (aliases) data: bytes = fory.dumps(obj) obj = fory.loads(data) # Type registration by id (for Python mode) fory.register(MyClass, type_id=123) fory.register(MyClass, type_id=123, serializer=custom_serializer) # Type registration by name (for cross-language mode) fory.register(MyClass, typename=&quot;my.package.MyClass&quot;) fory.register(MyClass, typename=&quot;my.package.MyClass&quot;, serializer=custom_serializer)   ","version":"0.14","tagName":"h2"},{"title":"Language Modes Comparison‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/python/configuration#language-modes-comparison","content":" Feature\tPython Mode (xlang=False)\tCross-Language Mode (xlang=True)Use Case\tPure Python applications\tMulti-language systems Compatibility\tPython only\tJava, Go, Rust, C++, JavaScript, etc. Supported Types\tAll Python types\tCross-language compatible types only Functions/Lambdas\t‚úì Supported\t‚úó Not allowed Local Classes\t‚úì Supported\t‚úó Not allowed Dynamic Classes\t‚úì Supported\t‚úó Not allowed Schema Evolution\t‚úì Supported (with compatible=True)\t‚úì Supported (with compatible=True) Performance\tExtremely fast\tVery fast Data Size\tCompact\tCompact with type metadata  ","version":"0.14","tagName":"h2"},{"title":"Python Mode (xlang=False)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/python/configuration#python-mode-xlangfalse","content":" Python mode supports all Python types including functions, classes, and closures:  import pyfory # Full Python compatibility mode fory = pyfory.Fory(xlang=False, ref=True, strict=False) # Supports ALL Python objects: data = fory.dumps({ 'function': lambda x: x * 2, # Functions and lambdas 'class': type('Dynamic', (), {}), # Dynamic classes 'method': str.upper, # Methods 'nested': {'circular_ref': None} # Circular references (when ref=True) }) # Drop-in replacement for pickle/cloudpickle import pickle obj = [1, 2, {&quot;nested&quot;: [3, 4]}] assert fory.loads(fory.dumps(obj)) == pickle.loads(pickle.dumps(obj))   ","version":"0.14","tagName":"h2"},{"title":"Cross-Language Mode (xlang=True)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/python/configuration#cross-language-mode-xlangtrue","content":" Cross-language mode restricts types to those compatible across all Fory implementations:  import pyfory # Cross-language compatibility mode f = pyfory.Fory(xlang=True, ref=True) # Only supports cross-language compatible types f.register(MyDataClass, typename=&quot;com.example.MyDataClass&quot;) # Data can be read by Java, Go, Rust, etc. data = f.serialize(MyDataClass(field1=&quot;value&quot;, field2=42))   ","version":"0.14","tagName":"h2"},{"title":"Example Configurations‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/python/configuration#example-configurations","content":" ","version":"0.14","tagName":"h2"},{"title":"Production Configuration‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/python/configuration#production-configuration","content":" import pyfory # Recommended settings for production fory = pyfory.Fory( xlang=False, # Use True if you need cross-language support ref=False, # Enable if you have shared/circular references strict=True, # CRITICAL: Always True in production compatible=False, # Enable only if you need schema evolution max_depth=20 # Adjust based on your data structure depth ) # Register all types upfront fory.register(UserModel, type_id=100) fory.register(OrderModel, type_id=101) fory.register(ProductModel, type_id=102)   ","version":"0.14","tagName":"h3"},{"title":"Development Configuration‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/python/configuration#development-configuration","content":" import pyfory # Development settings (more permissive) fory = pyfory.Fory( xlang=False, ref=True, strict=False, # Allow any type for development max_depth=1000 # Higher limit for development )   ","version":"0.14","tagName":"h3"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/python/configuration#related-topics","content":" Basic Serialization - Using configured ForyType Registration - Registration patternsSecurity - Security best practices ","version":"0.14","tagName":"h2"},{"title":"Cross-Language Serialization","type":0,"sectionRef":"#","url":"/docs/0.14/guide/python/cross_language","content":"","keywords":"","version":"0.14"},{"title":"Enable Cross-Language Mode‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/python/cross_language#enable-cross-language-mode","content":" To use xlang mode, create Fory with xlang=True:  import pyfory fory = pyfory.Fory(xlang=True, ref=False, strict=True)   ","version":"0.14","tagName":"h2"},{"title":"Cross-Language Example‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/python/cross_language#cross-language-example","content":" ","version":"0.14","tagName":"h2"},{"title":"Python (Serializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/python/cross_language#python-serializer","content":" import pyfory from dataclasses import dataclass # Cross-language mode for interoperability f = pyfory.Fory(xlang=True, ref=True) # Register type for cross-language compatibility @dataclass class Person: name: str age: pyfory.int32 f.register(Person, typename=&quot;example.Person&quot;) person = Person(&quot;Charlie&quot;, 35) binary_data = f.serialize(person) # binary_data can now be sent to Java, Go, etc.   ","version":"0.14","tagName":"h3"},{"title":"Java (Deserializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/python/cross_language#java-deserializer","content":" import org.apache.fory.*; public class Person { public String name; public int age; } Fory fory = Fory.builder() .withLanguage(Language.XLANG) .withRefTracking(true) .build(); fory.register(Person.class, &quot;example.Person&quot;); Person person = (Person) fory.deserialize(binaryData);   ","version":"0.14","tagName":"h3"},{"title":"Rust (Deserializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/python/cross_language#rust-deserializer","content":" use fory::Fory; use fory::ForyObject; #[derive(ForyObject)] struct Person { name: String, age: i32, } let mut fory = Fory::default() .compatible(true) .xlang(true); fory.register_by_namespace::&lt;Person&gt;(&quot;example&quot;, &quot;Person&quot;); let person: Person = fory.deserialize(&amp;binary_data)?;   ","version":"0.14","tagName":"h3"},{"title":"Type Annotations for Cross-Language‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/python/cross_language#type-annotations-for-cross-language","content":" Use pyfory type annotations for explicit cross-language type mapping:  from dataclasses import dataclass import pyfory @dataclass class TypedData: int_value: pyfory.int32 # 32-bit integer long_value: pyfory.int64 # 64-bit integer float_value: pyfory.float32 # 32-bit float double_value: pyfory.float64 # 64-bit float   ","version":"0.14","tagName":"h2"},{"title":"Type Mapping‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/python/cross_language#type-mapping","content":" Python\tJava\tRust\tGostr\tString\tString\tstring int\tlong\ti64\tint64 pyfory.int32\tint\ti32\tint32 pyfory.int64\tlong\ti64\tint64 float\tdouble\tf64\tfloat64 pyfory.float32\tfloat\tf32\tfloat32 list\tList\tVec\t[]T dict\tMap\tHashMap\tmap[K]V  ","version":"0.14","tagName":"h2"},{"title":"Differences from Python Native Mode‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/python/cross_language#differences-from-python-native-mode","content":" The binary protocol and API are similar to pyfory's python-native mode, but Python-native mode can serialize any Python object‚Äîincluding global functions, local functions, lambdas, local classes, and types with customized serialization using __getstate__/__reduce__/__reduce_ex__, which are not allowed in xlang mode.  ","version":"0.14","tagName":"h2"},{"title":"See Also‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/python/cross_language#see-also","content":" Cross-Language Serialization SpecificationType Mapping ReferenceJava Cross-Language GuideRust Cross-Language Guide  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/python/cross_language#related-topics","content":" Configuration - XLANG mode settingsSchema Evolution - Compatible modeType Registration - Registration patterns ","version":"0.14","tagName":"h2"},{"title":"Migration Guide","type":0,"sectionRef":"#","url":"/docs/0.14/guide/python/migration","content":"","keywords":"","version":"0.14"},{"title":"From Pickle‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/0.14/guide/python/migration#from-pickle","content":" Replace pickle with Fory for better performance while keeping the same API:  # Before (pickle) import pickle data = pickle.dumps(obj) result = pickle.loads(data) # After (Fory - drop-in replacement with better performance) import pyfory f = pyfory.Fory(xlang=False, ref=True, strict=False) data = f.dumps(obj) # Faster and more compact result = f.loads(data) # Faster deserialization # Benefits: # - 2-10x faster serialization # - 2-5x faster deserialization # - Up to 3x smaller data size # - Same API, better performance   ","version":"0.14","tagName":"h2"},{"title":"From JSON‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/0.14/guide/python/migration#from-json","content":" Unlike JSON, Fory supports arbitrary Python types including functions:  # Before (JSON - limited types) import json data = json.dumps({&quot;name&quot;: &quot;Alice&quot;, &quot;age&quot;: 30}) result = json.loads(data) # After (Fory - all Python types) import pyfory f = pyfory.Fory() data = f.dumps({&quot;name&quot;: &quot;Alice&quot;, &quot;age&quot;: 30, &quot;func&quot;: lambda x: x}) result = f.loads(data)   ","version":"0.14","tagName":"h2"},{"title":"Key Differences‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/0.14/guide/python/migration#key-differences","content":" Feature\tpickle\tJSON\tpyforyPerformance\tModerate\tSlow\tFast Data Size\tLarge\tLarge\tCompact Type Support\tAll Python\tLimited\tAll Python Cross-Language\tNo\tYes\tYes (xlang mode) Security\tLow\tHigh\tConfigurable  ","version":"0.14","tagName":"h2"},{"title":"Migration Tips‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/0.14/guide/python/migration#migration-tips","content":" Start with strict=False to ensure compatibilityAdd type registration for performance and securityTest thoroughly before deployingMonitor performance improvements  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/0.14/guide/python/migration#related-topics","content":" Configuration - Fory parametersPython Native Mode - Pickle replacement featuresSecurity - Security best practices ","version":"0.14","tagName":"h2"},{"title":"Custom Serializers","type":0,"sectionRef":"#","url":"/docs/0.14/guide/python/custom_serializers","content":"","keywords":"","version":"0.14"},{"title":"Implementing Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/python/custom_serializers#implementing-custom-serializers","content":" Override write/read for Python mode, xwrite/xread for cross-language:  import pyfory from pyfory.serializer import Serializer from dataclasses import dataclass @dataclass class Foo: f1: int f2: str class FooSerializer(Serializer): def __init__(self, fory, cls): super().__init__(fory, cls) def write(self, buffer, obj: Foo): # Custom serialization logic buffer.write_varint32(obj.f1) buffer.write_string(obj.f2) def read(self, buffer): # Custom deserialization logic f1 = buffer.read_varint32() f2 = buffer.read_string() return Foo(f1, f2) # For cross-language mode def xwrite(self, buffer, obj: Foo): buffer.write_int32(obj.f1) buffer.write_string(obj.f2) def xread(self, buffer): return Foo(buffer.read_int32(), buffer.read_string()) f = pyfory.Fory() f.register(Foo, type_id=100, serializer=FooSerializer(f, Foo)) # Now Foo uses your custom serializer data = f.dumps(Foo(42, &quot;hello&quot;)) result = f.loads(data) print(result) # Foo(f1=42, f2='hello')   ","version":"0.14","tagName":"h2"},{"title":"Buffer API‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/python/custom_serializers#buffer-api","content":" ","version":"0.14","tagName":"h2"},{"title":"Write Methods‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/python/custom_serializers#write-methods","content":" # Integers buffer.write_int8(value) buffer.write_int16(value) buffer.write_int32(value) buffer.write_int64(value) # Variable-length integers buffer.write_varint32(value) buffer.write_varint64(value) # Floating point buffer.write_float32(value) buffer.write_float64(value) # Strings and bytes buffer.write_string(value) buffer.write_bytes(value) # Boolean buffer.write_bool(value)   ","version":"0.14","tagName":"h3"},{"title":"Read Methods‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/python/custom_serializers#read-methods","content":" # Integers value = buffer.read_int8() value = buffer.read_int16() value = buffer.read_int32() value = buffer.read_int64() # Variable-length integers value = buffer.read_varint32() value = buffer.read_varint64() # Floating point value = buffer.read_float32() value = buffer.read_float64() # Strings and bytes value = buffer.read_string() value = buffer.read_bytes(length) # Boolean value = buffer.read_bool()   ","version":"0.14","tagName":"h3"},{"title":"When to Use Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/python/custom_serializers#when-to-use-custom-serializers","content":" External types from other packagesTypes with special serialization requirementsLegacy data format compatibilityPerformance-critical custom encodingTypes that don't work well with automatic serialization  ","version":"0.14","tagName":"h2"},{"title":"Registering Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/python/custom_serializers#registering-custom-serializers","content":" fory = pyfory.Fory() # Register with type_id fory.register(MyClass, type_id=100, serializer=MySerializer(fory, MyClass)) # Register with typename (for xlang) fory.register(MyClass, typename=&quot;com.example.MyClass&quot;, serializer=MySerializer(fory, MyClass))   ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/python/custom_serializers#related-topics","content":" Type Registration - Registration patternsConfiguration - Fory parametersCross-Language - xwrite/xread for xlang ","version":"0.14","tagName":"h2"},{"title":"NumPy & Scientific Computing","type":0,"sectionRef":"#","url":"/docs/0.14/guide/python/numpy_integration","content":"","keywords":"","version":"0.14"},{"title":"NumPy Array Serialization‚Äã","type":1,"pageTitle":"NumPy & Scientific Computing","url":"/docs/0.14/guide/python/numpy_integration#numpy-array-serialization","content":" Large arrays use zero-copy when possible:  import pyfory import numpy as np f = pyfory.Fory() # Numpy arrays are supported natively arrays = { 'matrix': np.random.rand(1000, 1000), 'vector': np.arange(10000), 'bool_mask': np.random.choice([True, False], size=5000) } data = f.serialize(arrays) result = f.deserialize(data) # Zero-copy for compatible array types assert np.array_equal(arrays['matrix'], result['matrix'])   ","version":"0.14","tagName":"h2"},{"title":"Pandas DataFrames‚Äã","type":1,"pageTitle":"NumPy & Scientific Computing","url":"/docs/0.14/guide/python/numpy_integration#pandas-dataframes","content":" Fory can serialize Pandas DataFrames efficiently:  import pyfory import pandas as pd import numpy as np f = pyfory.Fory(xlang=False, ref=False, strict=False) df = pd.DataFrame({ 'a': np.arange(1000, dtype=np.float64), 'b': np.arange(1000, dtype=np.int64), 'c': ['text'] * 1000 }) data = f.serialize(df) result = f.deserialize(data) assert df.equals(result)   ","version":"0.14","tagName":"h2"},{"title":"Zero-Copy with Out-of-Band Buffers‚Äã","type":1,"pageTitle":"NumPy & Scientific Computing","url":"/docs/0.14/guide/python/numpy_integration#zero-copy-with-out-of-band-buffers","content":" For maximum performance with large arrays, use out-of-band serialization:  import pyfory import numpy as np f = pyfory.Fory(xlang=False, ref=False, strict=False) # Large array array = np.random.rand(10000, 1000) # Out-of-band for zero-copy buffer_objects = [] data = f.serialize(array, buffer_callback=buffer_objects.append) buffers = [obj.getbuffer() for obj in buffer_objects] result = f.deserialize(data, buffers=buffers) assert np.array_equal(array, result)   ","version":"0.14","tagName":"h2"},{"title":"Supported Array Types‚Äã","type":1,"pageTitle":"NumPy & Scientific Computing","url":"/docs/0.14/guide/python/numpy_integration#supported-array-types","content":" np.ndarray (all dtypes)np.matrixStructured arraysRecord arrays  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"NumPy & Scientific Computing","url":"/docs/0.14/guide/python/numpy_integration#related-topics","content":" Out-of-Band Serialization - Zero-copy buffersBasic Serialization - Standard usage ","version":"0.14","tagName":"h2"},{"title":"Python Native Mode","type":0,"sectionRef":"#","url":"/docs/0.14/guide/python/native_mode","content":"","keywords":"","version":"0.14"},{"title":"Overview‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/0.14/guide/python/native_mode#overview","content":" The binary protocol and API are similar to Fory's xlang mode, but Python-native mode can serialize any Python object‚Äîincluding global functions, local functions, lambdas, local classes and types with customized serialization using __getstate__/__reduce__/__reduce_ex__, which are not allowed in xlang mode.  To use Python-native mode, create Fory with xlang=False:  import pyfory fory = pyfory.Fory(xlang=False, ref=False, strict=True)   ","version":"0.14","tagName":"h2"},{"title":"Drop-in Replacement for Pickle/Cloudpickle‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/0.14/guide/python/native_mode#drop-in-replacement-for-picklecloudpickle","content":" pyfory can serialize any Python object with the following configuration:  For circular references: Set ref=True to enable reference trackingFor functions/classes: Set strict=False to allow deserialization of dynamic types  ‚ö†Ô∏è Security Warning: When strict=False, Fory will deserialize arbitrary types, which can pose security risks if data comes from untrusted sources. Only use strict=False in controlled environments where you trust the data source completely.  ","version":"0.14","tagName":"h2"},{"title":"Common Usage‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/0.14/guide/python/native_mode#common-usage","content":" import pyfory # Create Fory instance fory = pyfory.Fory(xlang=False, ref=True, strict=False) # serialize common Python objects data = fory.dumps({&quot;name&quot;: &quot;Alice&quot;, &quot;age&quot;: 30, &quot;scores&quot;: [95, 87, 92]}) print(fory.loads(data)) # serialize custom objects from dataclasses import dataclass @dataclass class Person: name: str age: int person = Person(&quot;Bob&quot;, 25) data = fory.dumps(person) print(fory.loads(data)) # Person(name='Bob', age=25)   ","version":"0.14","tagName":"h3"},{"title":"Serialize Global Functions‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/0.14/guide/python/native_mode#serialize-global-functions","content":" Capture and serialize functions defined at module level. Fory deserialize and return same function object:  import pyfory fory = pyfory.Fory(xlang=False, ref=True, strict=False) def my_global_function(x): return 10 * x data = fory.dumps(my_global_function) print(fory.loads(data)(10)) # 100   ","version":"0.14","tagName":"h2"},{"title":"Serialize Local Functions/Lambdas‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/0.14/guide/python/native_mode#serialize-local-functionslambdas","content":" Serialize functions with closures and lambda expressions. Fory captures the closure variables automatically:  import pyfory fory = pyfory.Fory(xlang=False, ref=True, strict=False) # Local functions with closures def my_function(): local_var = 10 def local_func(x): return x * local_var return local_func data = fory.dumps(my_function()) print(fory.loads(data)(10)) # 100 # Lambdas data = fory.dumps(lambda x: 10 * x) print(fory.loads(data)(10)) # 100   ","version":"0.14","tagName":"h2"},{"title":"Serialize Global Classes/Methods‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/0.14/guide/python/native_mode#serialize-global-classesmethods","content":" Serialize class objects, instance methods, class methods, and static methods:  from dataclasses import dataclass import pyfory fory = pyfory.Fory(xlang=False, ref=True, strict=False) @dataclass class Person: name: str age: int def f(self, x): return self.age * x @classmethod def g(cls, x): return 10 * x @staticmethod def h(x): return 10 * x # Serialize global class print(fory.loads(fory.dumps(Person))(&quot;Bob&quot;, 25)) # Person(name='Bob', age=25) # Serialize instance method print(fory.loads(fory.dumps(Person(&quot;Bob&quot;, 20).f))(10)) # 200 # Serialize class method print(fory.loads(fory.dumps(Person.g))(10)) # 100 # Serialize static method print(fory.loads(fory.dumps(Person.h))(10)) # 100   ","version":"0.14","tagName":"h2"},{"title":"Serialize Local Classes/Methods‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/0.14/guide/python/native_mode#serialize-local-classesmethods","content":" Serialize classes defined inside functions along with their methods:  from dataclasses import dataclass import pyfory fory = pyfory.Fory(xlang=False, ref=True, strict=False) def create_local_class(): class LocalClass: def f(self, x): return 10 * x @classmethod def g(cls, x): return 10 * x @staticmethod def h(x): return 10 * x return LocalClass # Serialize local class data = fory.dumps(create_local_class()) print(fory.loads(data)().f(10)) # 100 # Serialize local class instance method data = fory.dumps(create_local_class()().f) print(fory.loads(data)(10)) # 100 # Serialize local class method data = fory.dumps(create_local_class().g) print(fory.loads(data)(10)) # 100 # Serialize local class static method data = fory.dumps(create_local_class().h) print(fory.loads(data)(10)) # 100   ","version":"0.14","tagName":"h2"},{"title":"Performance Comparison‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/0.14/guide/python/native_mode#performance-comparison","content":" import pyfory import pickle import timeit fory = pyfory.Fory(xlang=False, ref=True, strict=False) obj = {f&quot;key{i}&quot;: f&quot;value{i}&quot; for i in range(10000)} print(f&quot;Fory: {timeit.timeit(lambda: fory.dumps(obj), number=1000):.3f}s&quot;) print(f&quot;Pickle: {timeit.timeit(lambda: pickle.dumps(obj), number=1000):.3f}s&quot;)   ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/0.14/guide/python/native_mode#related-topics","content":" Configuration - Python mode configurationOut-of-Band Serialization - Zero-copy buffersSecurity - DeserializationPolicy ","version":"0.14","tagName":"h2"},{"title":"Out-of-Band Serialization","type":0,"sectionRef":"#","url":"/docs/0.14/guide/python/out_of_band","content":"","keywords":"","version":"0.14"},{"title":"Overview‚Äã","type":1,"pageTitle":"Out-of-Band Serialization","url":"/docs/0.14/guide/python/out_of_band#overview","content":" Out-of-band serialization separates metadata from the actual data buffers, allowing for:  Zero-copy transfers when sending data over networks or IPC using memoryviewImproved performance for large datasetsPickle5 compatibility using pickle.PickleBufferFlexible stream support - write to any writable object (files, BytesIO, sockets, etc.)  ","version":"0.14","tagName":"h2"},{"title":"Basic Out-of-Band Serialization‚Äã","type":1,"pageTitle":"Out-of-Band Serialization","url":"/docs/0.14/guide/python/out_of_band#basic-out-of-band-serialization","content":" import pyfory import numpy as np fory = pyfory.Fory(xlang=False, ref=False, strict=False) # Large numpy array array = np.arange(10000, dtype=np.float64) # Serialize with out-of-band buffers buffer_objects = [] serialized_data = fory.serialize(array, buffer_callback=buffer_objects.append) # Convert buffer objects to memoryview for zero-copy transmission # For contiguous buffers (bytes, numpy arrays), this is zero-copy # For non-contiguous data, a copy may be created to ensure contiguity buffers = [obj.getbuffer() for obj in buffer_objects] # Deserialize with out-of-band buffers (accepts memoryview, bytes, or Buffer) deserialized_array = fory.deserialize(serialized_data, buffers=buffers) assert np.array_equal(array, deserialized_array)   ","version":"0.14","tagName":"h2"},{"title":"Out-of-Band with Pandas DataFrames‚Äã","type":1,"pageTitle":"Out-of-Band Serialization","url":"/docs/0.14/guide/python/out_of_band#out-of-band-with-pandas-dataframes","content":" import pyfory import pandas as pd import numpy as np fory = pyfory.Fory(xlang=False, ref=False, strict=False) # Create a DataFrame with numeric columns df = pd.DataFrame({ 'a': np.arange(1000, dtype=np.float64), 'b': np.arange(1000, dtype=np.int64), 'c': ['text'] * 1000 }) # Serialize with out-of-band buffers buffer_objects = [] serialized_data = fory.serialize(df, buffer_callback=buffer_objects.append) buffers = [obj.getbuffer() for obj in buffer_objects] # Deserialize deserialized_df = fory.deserialize(serialized_data, buffers=buffers) assert df.equals(deserialized_df)   ","version":"0.14","tagName":"h2"},{"title":"Selective Out-of-Band Serialization‚Äã","type":1,"pageTitle":"Out-of-Band Serialization","url":"/docs/0.14/guide/python/out_of_band#selective-out-of-band-serialization","content":" Control which buffers go out-of-band by providing a callback that returns True to keep data in-band or False to send it out-of-band:  import pyfory import numpy as np fory = pyfory.Fory(xlang=False, ref=True, strict=False) arr1 = np.arange(1000, dtype=np.float64) arr2 = np.arange(2000, dtype=np.float64) data = [arr1, arr2] buffer_objects = [] counter = 0 def selective_callback(buffer_object): global counter counter += 1 # Only send even-numbered buffers out-of-band if counter % 2 == 0: buffer_objects.append(buffer_object) return False # Out-of-band return True # In-band serialized = fory.serialize(data, buffer_callback=selective_callback) buffers = [obj.getbuffer() for obj in buffer_objects] deserialized = fory.deserialize(serialized, buffers=buffers)   ","version":"0.14","tagName":"h2"},{"title":"Pickle5 Compatibility‚Äã","type":1,"pageTitle":"Out-of-Band Serialization","url":"/docs/0.14/guide/python/out_of_band#pickle5-compatibility","content":" Fory's out-of-band serialization is fully compatible with pickle protocol 5:  import pyfory import pickle fory = pyfory.Fory(xlang=False, ref=False, strict=False) # PickleBuffer objects are automatically supported data = b&quot;Large binary data&quot; pickle_buffer = pickle.PickleBuffer(data) # Serialize with buffer callback for out-of-band handling buffer_objects = [] serialized = fory.serialize(pickle_buffer, buffer_callback=buffer_objects.append) buffers = [obj.getbuffer() for obj in buffer_objects] # Deserialize with buffers deserialized = fory.deserialize(serialized, buffers=buffers) assert bytes(deserialized.raw()) == data   ","version":"0.14","tagName":"h2"},{"title":"Writing Buffers to Different Streams‚Äã","type":1,"pageTitle":"Out-of-Band Serialization","url":"/docs/0.14/guide/python/out_of_band#writing-buffers-to-different-streams","content":" The BufferObject.write_to() method accepts any writable stream object:  import pyfory import numpy as np import io fory = pyfory.Fory(xlang=False, ref=False, strict=False) array = np.arange(1000, dtype=np.float64) # Collect out-of-band buffers buffer_objects = [] serialized = fory.serialize(array, buffer_callback=buffer_objects.append) # Write to different stream types for buffer_obj in buffer_objects: # Write to BytesIO (in-memory stream) bytes_stream = io.BytesIO() buffer_obj.write_to(bytes_stream) # Write to file with open('/tmp/buffer_data.bin', 'wb') as f: buffer_obj.write_to(f) # Get zero-copy memoryview (for contiguous buffers) mv = buffer_obj.getbuffer() assert isinstance(mv, memoryview)   Note: For contiguous memory buffers (like bytes, numpy arrays), getbuffer() returns a zero-copy memoryview. For non-contiguous data, a copy may be created to ensure contiguity.  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Out-of-Band Serialization","url":"/docs/0.14/guide/python/out_of_band#related-topics","content":" NumPy Integration - NumPy array serializationBasic Serialization - Standard serializationConfiguration - Fory parameters ","version":"0.14","tagName":"h2"},{"title":"Schema Evolution","type":0,"sectionRef":"#","url":"/docs/0.14/guide/python/schema_evolution","content":"","keywords":"","version":"0.14"},{"title":"Enable Compatible Mode‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/python/schema_evolution#enable-compatible-mode","content":" import pyfory f = pyfory.Fory(xlang=True, compatible=True)   ","version":"0.14","tagName":"h2"},{"title":"Schema Evolution Example‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/python/schema_evolution#schema-evolution-example","content":" import pyfory from dataclasses import dataclass # Version 1: Original class @dataclass class User: name: str age: int f = pyfory.Fory(xlang=True, compatible=True) f.register(User, typename=&quot;User&quot;) data = f.dumps(User(&quot;Alice&quot;, 30)) # Version 2: Add new field (backward compatible) @dataclass class User: name: str age: int email: str = &quot;unknown@example.com&quot; # New field with default # Can still deserialize old data user = f.loads(data) print(user.email) # &quot;unknown@example.com&quot;   ","version":"0.14","tagName":"h2"},{"title":"Supported Changes‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/python/schema_evolution#supported-changes","content":" Add new fields: With default valuesRemove fields: Old data with extra fields will be skippedReorder fields: Fields are matched by name, not position  ","version":"0.14","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/python/schema_evolution#best-practices","content":" Always provide default values for new fieldsUse typename for cross-language compatibilityTest schema changes before deployingDocument schema versions for your team  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/python/schema_evolution#related-topics","content":" Configuration - Compatible mode settingsCross-Language - Schema evolution across languagesType Registration - Registration patterns ","version":"0.14","tagName":"h2"},{"title":"Row Format","type":0,"sectionRef":"#","url":"/docs/0.14/guide/python/row_format","content":"","keywords":"","version":"0.14"},{"title":"Overview‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/python/row_format#overview","content":" Row format drastically reduces overhead when working with large objects where only partial data access is needed. It also supports memory-mapped files for ultra-low memory footprint.  Key Benefits:  Feature\tDescriptionZero-Copy Access\tRead nested fields without deserializing entire object Memory Efficiency\tMemory-map large datasets directly from disk Cross-Language\tBinary format compatible between Python, Java, C++ Partial Deserialization\tDeserialize only specific elements you need High Performance\tSkip unnecessary data parsing for analytics workloads  ","version":"0.14","tagName":"h2"},{"title":"Basic Usage‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/python/row_format#basic-usage","content":" import pyfory import pyarrow as pa from dataclasses import dataclass from typing import List, Dict @dataclass class Bar: f1: str f2: List[pa.int64] @dataclass class Foo: f1: pa.int32 f2: List[pa.int32] f3: Dict[str, pa.int32] f4: List[Bar] # Create encoder for row format encoder = pyfory.encoder(Foo) # Create large dataset foo = Foo( f1=10, f2=list(range(1_000_000)), f3={f&quot;k{i}&quot;: i for i in range(1_000_000)}, f4=[Bar(f1=f&quot;s{i}&quot;, f2=list(range(10))) for i in range(1_000_000)] ) # Encode to row format binary: bytes = encoder.to_row(foo).to_bytes() # Zero-copy access - no full deserialization needed! foo_row = pyfory.RowData(encoder.schema, binary) print(foo_row.f2[100000]) # Access 100,000th element directly print(foo_row.f4[100000].f1) # Access nested field directly print(foo_row.f4[200000].f2[5]) # Access deeply nested field directly   ","version":"0.14","tagName":"h2"},{"title":"Cross-Language Compatibility‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/python/row_format#cross-language-compatibility","content":" Row format works seamlessly across languages. The same binary data can be accessed from Java and C++.  ","version":"0.14","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/python/row_format#java","content":" public class Bar { String f1; List&lt;Long&gt; f2; } public class Foo { int f1; List&lt;Integer&gt; f2; Map&lt;String, Integer&gt; f3; List&lt;Bar&gt; f4; } RowEncoder&lt;Foo&gt; encoder = Encoders.bean(Foo.class); // Encode to row format (cross-language compatible with Python) BinaryRow binaryRow = encoder.toRow(foo); // Zero-copy random access without full deserialization BinaryArray f2Array = binaryRow.getArray(1); // Access f2 list BinaryArray f4Array = binaryRow.getArray(3); // Access f4 list BinaryRow bar10 = f4Array.getStruct(10); // Access 11th Bar long value = bar10.getArray(1).getInt64(5); // Access 6th element of bar.f2 // Partial deserialization - only deserialize what you need RowEncoder&lt;Bar&gt; barEncoder = Encoders.bean(Bar.class); Bar bar1 = barEncoder.fromRow(f4Array.getStruct(10)); // Deserialize 11th Bar only Bar bar2 = barEncoder.fromRow(f4Array.getStruct(20)); // Deserialize 21st Bar only   ","version":"0.14","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/python/row_format#c","content":" #include &quot;fory/encoder/row_encoder.h&quot; #include &quot;fory/row/writer.h&quot; struct Bar { std::string f1; std::vector&lt;int64_t&gt; f2; }; FORY_FIELD_INFO(Bar, f1, f2); struct Foo { int32_t f1; std::vector&lt;int32_t&gt; f2; std::map&lt;std::string, int32_t&gt; f3; std::vector&lt;Bar&gt; f4; }; FORY_FIELD_INFO(Foo, f1, f2, f3, f4); fory::encoder::RowEncoder&lt;Foo&gt; encoder; encoder.Encode(foo); auto row = encoder.GetWriter().ToRow(); // Zero-copy random access without full deserialization auto f2_array = row-&gt;GetArray(1); // Access f2 list auto f4_array = row-&gt;GetArray(3); // Access f4 list auto bar10 = f4_array-&gt;GetStruct(10); // Access 11th Bar int64_t value = bar10-&gt;GetArray(1)-&gt;GetInt64(5); // Access 6th element of bar.f2 std::string str = bar10-&gt;GetString(0); // Access bar.f1   ","version":"0.14","tagName":"h3"},{"title":"Installation‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/python/row_format#installation","content":" Row format requires Apache Arrow:  pip install pyfory[format]   ","version":"0.14","tagName":"h2"},{"title":"When to Use Row Format‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/python/row_format#when-to-use-row-format","content":" Analytics workloads: When you only need to access specific fieldsLarge datasets: When full deserialization is too expensiveMemory-mapped files: Working with data larger than RAMData pipelines: Processing data without full object reconstructionCross-language data sharing: When data needs to be accessed from multiple languages  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/python/row_format#related-topics","content":" Cross-Language Serialization - XLANG modeBasic Serialization - Object serializationRow Format Specification - Protocol details ","version":"0.14","tagName":"h2"},{"title":"Security Best Practices","type":0,"sectionRef":"#","url":"/docs/0.14/guide/python/security","content":"","keywords":"","version":"0.14"},{"title":"Production Configuration‚Äã","type":1,"pageTitle":"Security Best Practices","url":"/docs/0.14/guide/python/security#production-configuration","content":" Never disable strict=True in production unless your environment is completely trusted:  import pyfory # Recommended production settings f = pyfory.Fory( xlang=False, # or True for cross-language ref=True, # Handle circular references strict=True, # IMPORTANT: Prevent malicious data max_depth=100 # Prevent deep recursion attacks ) # Explicitly register allowed types f.register(UserModel, type_id=100) f.register(OrderModel, type_id=101) # Never set strict=False in production with untrusted data!   ","version":"0.14","tagName":"h2"},{"title":"Development vs Production‚Äã","type":1,"pageTitle":"Security Best Practices","url":"/docs/0.14/guide/python/security#development-vs-production","content":" Use environment variables to switch between configurations:  import pyfory import os # Development configuration if os.getenv('ENV') == 'development': fory = pyfory.Fory( xlang=False, ref=True, strict=False, # Allow any type for development max_depth=1000 # Higher limit for development ) else: # Production configuration (security hardened) fory = pyfory.Fory( xlang=False, ref=True, strict=True, # CRITICAL: Require registration max_depth=100 # Reasonable limit ) # Register only known safe types for idx, model_class in enumerate([UserModel, ProductModel, OrderModel]): fory.register(model_class, type_id=100 + idx)   ","version":"0.14","tagName":"h2"},{"title":"DeserializationPolicy‚Äã","type":1,"pageTitle":"Security Best Practices","url":"/docs/0.14/guide/python/security#deserializationpolicy","content":" When strict=False is necessary (e.g., deserializing functions/lambdas), use DeserializationPolicy to implement fine-grained security controls during deserialization.  Why use DeserializationPolicy?  Block dangerous classes/modules (e.g., subprocess.Popen)Intercept and validate __reduce__ callables before invocationSanitize sensitive data during __setstate__Replace or reject deserialized objects based on custom rules  ","version":"0.14","tagName":"h2"},{"title":"Blocking Dangerous Classes‚Äã","type":1,"pageTitle":"Security Best Practices","url":"/docs/0.14/guide/python/security#blocking-dangerous-classes","content":" import pyfory from pyfory import DeserializationPolicy dangerous_modules = {'subprocess', 'os', '__builtin__'} class SafeDeserializationPolicy(DeserializationPolicy): &quot;&quot;&quot;Block potentially dangerous classes during deserialization.&quot;&quot;&quot; def validate_class(self, cls, is_local, **kwargs): # Block dangerous modules if cls.__module__ in dangerous_modules: raise ValueError(f&quot;Blocked dangerous class: {cls.__module__}.{cls.__name__}&quot;) return None def intercept_reduce_call(self, callable_obj, args, **kwargs): # Block specific callable invocations during __reduce__ if getattr(callable_obj, '__name__', &quot;&quot;) == 'Popen': raise ValueError(&quot;Blocked attempt to invoke subprocess.Popen&quot;) return None def intercept_setstate(self, obj, state, **kwargs): # Sanitize sensitive data if isinstance(state, dict) and 'password' in state: state['password'] = '***REDACTED***' return None # Create Fory with custom security policy policy = SafeDeserializationPolicy() fory = pyfory.Fory(xlang=False, ref=True, strict=False, policy=policy) # Now deserialization is protected by your custom policy data = fory.serialize(my_object) result = fory.deserialize(data) # Policy hooks will be invoked   ","version":"0.14","tagName":"h3"},{"title":"Available Policy Hooks‚Äã","type":1,"pageTitle":"Security Best Practices","url":"/docs/0.14/guide/python/security#available-policy-hooks","content":" Hook\tDescriptionvalidate_class(cls, is_local)\tValidate/block class types during deserialization validate_module(module, is_local)\tValidate/block module imports validate_function(func, is_local)\tValidate/block function references intercept_reduce_call(callable_obj, args)\tIntercept __reduce__ invocations inspect_reduced_object(obj)\tInspect/replace objects created via __reduce__ intercept_setstate(obj, state)\tSanitize state before __setstate__ authorize_instantiation(cls, args, kwargs)\tControl class instantiation  See also: pyfory/policy.py contains detailed documentation and examples for each hook.  ","version":"0.14","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Security Best Practices","url":"/docs/0.14/guide/python/security#best-practices","content":" Always use strict=True in productionUse DeserializationPolicy when strict=False is necessaryBlock dangerous modules (subprocess, os, etc.)Set appropriate max_depth to prevent stack overflowValidate data sources before deserializationLog security events for auditing  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Security Best Practices","url":"/docs/0.14/guide/python/security#related-topics","content":" Type Registration - Registration and strict modeConfiguration - Fory parametersPython Native Mode - Functions and lambdas ","version":"0.14","tagName":"h2"},{"title":"Troubleshooting","type":0,"sectionRef":"#","url":"/docs/0.14/guide/python/troubleshooting","content":"","keywords":"","version":"0.14"},{"title":"Common Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/python/troubleshooting#common-issues","content":" ","version":"0.14","tagName":"h2"},{"title":"ImportError with Format Features‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/python/troubleshooting#importerror-with-format-features","content":" # Solution: Install Row format support pip install pyfory[format] # Or install from source with format support pip install -e &quot;.[format]&quot;   ","version":"0.14","tagName":"h3"},{"title":"Slow Serialization Performance‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/python/troubleshooting#slow-serialization-performance","content":" # Check if Cython acceleration is enabled import pyfory print(pyfory.ENABLE_FORY_CYTHON_SERIALIZATION) # Should be True # If False, Cython extension may not be compiled correctly # Reinstall with: pip install --force-reinstall --no-cache-dir pyfory   ","version":"0.14","tagName":"h3"},{"title":"Cross-Language Compatibility Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/python/troubleshooting#cross-language-compatibility-issues","content":" # Use explicit type registration with consistent naming f = pyfory.Fory(xlang=True) f.register(MyClass, typename=&quot;com.package.MyClass&quot;) # Use same name in all languages   ","version":"0.14","tagName":"h3"},{"title":"Circular Reference Errors or Duplicate Data‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/python/troubleshooting#circular-reference-errors-or-duplicate-data","content":" # Enable reference tracking f = pyfory.Fory(ref=True) # Required for circular references # Example with circular reference class Node: def __init__(self, value): self.value = value self.next = None node1 = Node(1) node2 = Node(2) node1.next = node2 node2.next = node1 # Circular reference data = f.dumps(node1) result = f.loads(data) assert result.next.next is result # Circular reference preserved   ","version":"0.14","tagName":"h3"},{"title":"Schema Evolution Not Working‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/python/troubleshooting#schema-evolution-not-working","content":" # Enable compatible mode for schema evolution f = pyfory.Fory(xlang=True, compatible=True) # Version 1: Original class @dataclass class User: name: str age: int f.register(User, typename=&quot;User&quot;) data = f.dumps(User(&quot;Alice&quot;, 30)) # Version 2: Add new field (backward compatible) @dataclass class User: name: str age: int email: str = &quot;unknown@example.com&quot; # New field with default # Can still deserialize old data user = f.loads(data) print(user.email) # &quot;unknown@example.com&quot;   ","version":"0.14","tagName":"h3"},{"title":"Type Registration Errors in Strict Mode‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/python/troubleshooting#type-registration-errors-in-strict-mode","content":" # Register all custom types before serialization f = pyfory.Fory(strict=True) # Must register before use f.register(MyClass, type_id=100) f.register(AnotherClass, type_id=101) # Or disable strict mode (NOT recommended for production) f = pyfory.Fory(strict=False) # Use only in trusted environments   ","version":"0.14","tagName":"h3"},{"title":"Debug Mode‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/python/troubleshooting#debug-mode","content":" Set environment variable BEFORE importing pyfory to disable Cython for debugging:  import os os.environ['ENABLE_FORY_CYTHON_SERIALIZATION'] = '0' import pyfory # Now uses pure Python implementation # This is useful for: # 1. Debugging protocol issues # 2. Understanding serialization behavior # 3. Development without recompiling Cython   ","version":"0.14","tagName":"h2"},{"title":"Error Handling‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/python/troubleshooting#error-handling","content":" Handle common serialization errors gracefully:  import pyfory from pyfory.error import TypeUnregisteredError, TypeNotCompatibleError fory = pyfory.Fory(strict=True) try: data = fory.dumps(my_object) except TypeUnregisteredError as e: print(f&quot;Type not registered: {e}&quot;) # Register the type and retry fory.register(type(my_object), type_id=100) data = fory.dumps(my_object) except Exception as e: print(f&quot;Serialization failed: {e}&quot;) try: obj = fory.loads(data) except TypeNotCompatibleError as e: print(f&quot;Schema mismatch: {e}&quot;) # Handle version mismatch except Exception as e: print(f&quot;Deserialization failed: {e}&quot;)   ","version":"0.14","tagName":"h2"},{"title":"Development Setup‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/python/troubleshooting#development-setup","content":" git clone https://github.com/apache/fory.git cd fory/python # Install dependencies pip install -e &quot;.[dev,format]&quot; # Run tests pytest -v -s . # Run specific test pytest -v -s pyfory/tests/test_serializer.py # Format code ruff format . ruff check --fix .   ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/python/troubleshooting#related-topics","content":" Configuration - Fory parametersType Registration - Registration best practicesSecurity - Security configuration ","version":"0.14","tagName":"h2"},{"title":"Type Registration & Security","type":0,"sectionRef":"#","url":"/docs/0.14/guide/python/type_registration","content":"","keywords":"","version":"0.14"},{"title":"Type Registration‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/0.14/guide/python/type_registration#type-registration","content":" In strict mode, only registered types can be deserialized. This prevents arbitrary code execution:  import pyfory # Strict mode (recommended for production) f = pyfory.Fory(strict=True) class SafeClass: def __init__(self, data): self.data = data # Must register types in strict mode f.register(SafeClass, typename=&quot;com.example.SafeClass&quot;) # Now serialization works obj = SafeClass(&quot;safe data&quot;) data = f.serialize(obj) result = f.deserialize(data) # Unregistered types will raise an exception class UnsafeClass: pass # This will fail in strict mode try: f.serialize(UnsafeClass()) except Exception as e: print(&quot;Security protection activated!&quot;)   ","version":"0.14","tagName":"h2"},{"title":"Registration Patterns‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/0.14/guide/python/type_registration#registration-patterns","content":" ","version":"0.14","tagName":"h2"},{"title":"Pattern 1: Simple Registration‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/0.14/guide/python/type_registration#pattern-1-simple-registration","content":" fory.register(MyClass, type_id=100)   ","version":"0.14","tagName":"h3"},{"title":"Pattern 2: Cross-Language with Typename‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/0.14/guide/python/type_registration#pattern-2-cross-language-with-typename","content":" fory.register(MyClass, typename=&quot;com.example.MyClass&quot;)   ","version":"0.14","tagName":"h3"},{"title":"Pattern 3: With Custom Serializer‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/0.14/guide/python/type_registration#pattern-3-with-custom-serializer","content":" fory.register(MyClass, type_id=100, serializer=MySerializer(fory, MyClass))   ","version":"0.14","tagName":"h3"},{"title":"Pattern 4: Batch Registration‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/0.14/guide/python/type_registration#pattern-4-batch-registration","content":" type_id = 100 for model_class in [User, Order, Product, Invoice]: fory.register(model_class, type_id=type_id) type_id += 1   ","version":"0.14","tagName":"h3"},{"title":"Security Modes‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/0.14/guide/python/type_registration#security-modes","content":" ","version":"0.14","tagName":"h2"},{"title":"Strict Mode (Recommended)‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/0.14/guide/python/type_registration#strict-mode-recommended","content":" # Always use strict=True in production fory = pyfory.Fory(strict=True) # Explicitly register allowed types fory.register(UserModel, type_id=100) fory.register(OrderModel, type_id=101)   ","version":"0.14","tagName":"h3"},{"title":"Non-Strict Mode‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/0.14/guide/python/type_registration#non-strict-mode","content":" ‚ö†Ô∏è Security Warning: When strict=False, Fory will deserialize arbitrary types, which can pose security risks if data comes from untrusted sources. Only use strict=False in controlled environments where you trust the data source completely.  # Only in trusted environments fory = pyfory.Fory(xlang=False, ref=True, strict=False)   If you do need to use strict=False, configure a DeserializationPolicy:  from pyfory import DeserializationPolicy class SafePolicy(DeserializationPolicy): def validate_class(self, cls, is_local, **kwargs): # Block dangerous modules if cls.__module__ in {'subprocess', 'os', '__builtin__'}: raise ValueError(f&quot;Blocked: {cls}&quot;) return None fory = pyfory.Fory(xlang=False, strict=False, policy=SafePolicy())   ","version":"0.14","tagName":"h3"},{"title":"Max Depth Protection‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/0.14/guide/python/type_registration#max-depth-protection","content":" Limit deserialization depth to prevent stack overflow attacks:  fory = pyfory.Fory( strict=True, max_depth=100 # Adjust based on your data structure depth )   ","version":"0.14","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/0.14/guide/python/type_registration#best-practices","content":" Always use strict=True in productionUse type_id for performance, typename for flexibilityRegister all types upfront before any serializationSet appropriate max_depth based on your data structuresUse DeserializationPolicy when strict=False is necessary  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/0.14/guide/python/type_registration#related-topics","content":" Configuration - Fory parametersSecurity - DeserializationPolicy detailsCustom Serializers - Custom serialization ","version":"0.14","tagName":"h2"},{"title":"Rust Serialization Guide","type":0,"sectionRef":"#","url":"/docs/0.14/guide/rust/","content":"","keywords":"","version":"0.14"},{"title":"Why Apache Fory‚Ñ¢ Rust?‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/0.14/guide/rust/#why-apache-fory-rust","content":" üî• Blazingly Fast: Zero-copy deserialization and optimized binary protocolsüåç Cross-Language: Seamlessly serialize/deserialize data across Java, Python, C++, Go, JavaScript, and RustüéØ Type-Safe: Compile-time type checking with derive macrosüîÑ Circular References: Automatic tracking of shared and circular references with Rc/Arc and weak pointersüß¨ Polymorphic: Serialize trait objects with Box&lt;dyn Trait&gt;, Rc&lt;dyn Trait&gt;, and Arc&lt;dyn Trait&gt;üì¶ Schema Evolution: Compatible mode for independent schema changes‚ö° Two Formats: Object graph serialization and zero-copy row-based format  ","version":"0.14","tagName":"h2"},{"title":"Crates‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/0.14/guide/rust/#crates","content":" Crate\tDescription\tVersionfory\tHigh-level API with derive macros fory-core\tCore serialization engine fory-derive\tProcedural macros\t  ","version":"0.14","tagName":"h2"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/0.14/guide/rust/#quick-start","content":" Add Apache Fory‚Ñ¢ to your Cargo.toml:  [dependencies] fory = &quot;0.14&quot;   ","version":"0.14","tagName":"h2"},{"title":"Basic Example‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/0.14/guide/rust/#basic-example","content":" use fory::{Fory, Error, Reader}; use fory::ForyObject; #[derive(ForyObject, Debug, PartialEq)] struct User { name: String, age: i32, email: String, } fn main() -&gt; Result&lt;(), Error&gt; { let mut fory = Fory::default(); fory.register::&lt;User&gt;(1)?; let user = User { name: &quot;Alice&quot;.to_string(), age: 30, email: &quot;alice@example.com&quot;.to_string(), }; // Serialize let bytes = fory.serialize(&amp;user)?; // Deserialize let decoded: User = fory.deserialize(&amp;bytes)?; assert_eq!(user, decoded); // Serialize to specified buffer let mut buf: Vec&lt;u8&gt; = vec![]; fory.serialize_to(&amp;mut buf, &amp;user)?; // Deserialize from specified buffer let mut reader = Reader::new(&amp;buf); let decoded: User = fory.deserialize_from(&amp;mut reader)?; assert_eq!(user, decoded); Ok(()) }   ","version":"0.14","tagName":"h3"},{"title":"Thread Safety‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/0.14/guide/rust/#thread-safety","content":" Apache Fory‚Ñ¢ Rust is fully thread-safe: Fory implements both Send and Sync, so one configured instance can be shared across threads for concurrent work. The internal read/write context pools are lazily initialized with thread-safe primitives, letting worker threads reuse buffers without coordination.  use fory::{Fory, Error}; use fory::ForyObject; use std::sync::Arc; use std::thread; #[derive(ForyObject, Clone, Copy, Debug, PartialEq)] struct Item { value: i32, } fn main() -&gt; Result&lt;(), Error&gt; { let mut fory = Fory::default(); fory.register::&lt;Item&gt;(1000)?; let fory = Arc::new(fory); let handles: Vec&lt;_&gt; = (0..8) .map(|i| { let shared = Arc::clone(&amp;fory); thread::spawn(move || { let item = Item { value: i }; shared.serialize(&amp;item) }) }) .collect(); for handle in handles { let bytes = handle.join().unwrap()?; let item: Item = fory.deserialize(&amp;bytes)?; assert!(item.value &gt;= 0); } Ok(()) }   Tip: Perform registrations (such as fory.register::&lt;T&gt;(id)) before spawning threads so every worker sees the same metadata. Once configured, wrapping the instance in Arc is enough to fan out serialization and deserialization tasks safely.  ","version":"0.14","tagName":"h2"},{"title":"Architecture‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/0.14/guide/rust/#architecture","content":" The Rust implementation consists of three main crates:  fory/ # High-level API ‚îú‚îÄ‚îÄ src/lib.rs # Public API exports fory-core/ # Core serialization engine ‚îú‚îÄ‚îÄ src/ ‚îÇ ‚îú‚îÄ‚îÄ fory.rs # Main serialization entry point ‚îÇ ‚îú‚îÄ‚îÄ buffer.rs # Binary buffer management ‚îÇ ‚îú‚îÄ‚îÄ serializer/ # Type-specific serializers ‚îÇ ‚îú‚îÄ‚îÄ resolver/ # Type resolution and metadata ‚îÇ ‚îú‚îÄ‚îÄ meta/ # Meta string compression ‚îÇ ‚îú‚îÄ‚îÄ row/ # Row format implementation ‚îÇ ‚îî‚îÄ‚îÄ types.rs # Type definitions fory-derive/ # Procedural macros ‚îú‚îÄ‚îÄ src/ ‚îÇ ‚îú‚îÄ‚îÄ object/ # ForyObject macro ‚îÇ ‚îî‚îÄ‚îÄ fory_row.rs # ForyRow macro   ","version":"0.14","tagName":"h2"},{"title":"Use Cases‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/0.14/guide/rust/#use-cases","content":" ","version":"0.14","tagName":"h2"},{"title":"Object Serialization‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/0.14/guide/rust/#object-serialization","content":" Complex data structures with nested objects and referencesCross-language communication in microservicesGeneral-purpose serialization with full type safetySchema evolution with compatible modeGraph-like data structures with circular references  ","version":"0.14","tagName":"h3"},{"title":"Row-Based Serialization‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/0.14/guide/rust/#row-based-serialization","content":" High-throughput data processingAnalytics workloads requiring fast field accessMemory-constrained environmentsReal-time data streaming applicationsZero-copy scenarios  ","version":"0.14","tagName":"h3"},{"title":"Next Steps‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/0.14/guide/rust/#next-steps","content":" Configuration - Fory builder options and modesBasic Serialization - Object graph serializationReferences - Shared and circular referencesPolymorphism - Trait object serializationCross-Language - XLANG modeRow Format - Zero-copy row-based format ","version":"0.14","tagName":"h2"},{"title":"Basic Serialization","type":0,"sectionRef":"#","url":"/docs/0.14/guide/rust/basic_serialization","content":"","keywords":"","version":"0.14"},{"title":"Object Graph Serialization‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/rust/basic_serialization#object-graph-serialization","content":" Apache Fory‚Ñ¢ provides automatic serialization of complex object graphs, preserving the structure and relationships between objects. The #[derive(ForyObject)] macro generates efficient serialization code at compile time, eliminating runtime overhead.  Key capabilities:  Nested struct serialization with arbitrary depthCollection types (Vec, HashMap, HashSet, BTreeMap)Optional fields with Option&lt;T&gt;Automatic handling of primitive types and stringsEfficient binary encoding with variable-length integers  use fory::{Fory, Error}; use fory::ForyObject; use std::collections::HashMap; #[derive(ForyObject, Debug, PartialEq)] struct Person { name: String, age: i32, address: Address, hobbies: Vec&lt;String&gt;, metadata: HashMap&lt;String, String&gt;, } #[derive(ForyObject, Debug, PartialEq)] struct Address { street: String, city: String, country: String, } let mut fory = Fory::default(); fory.register::&lt;Address&gt;(100); fory.register::&lt;Person&gt;(200); let person = Person { name: &quot;John Doe&quot;.to_string(), age: 30, address: Address { street: &quot;123 Main St&quot;.to_string(), city: &quot;New York&quot;.to_string(), country: &quot;USA&quot;.to_string(), }, hobbies: vec![&quot;reading&quot;.to_string(), &quot;coding&quot;.to_string()], metadata: HashMap::from([ (&quot;role&quot;.to_string(), &quot;developer&quot;.to_string()), ]), }; let bytes = fory.serialize(&amp;person); let decoded: Person = fory.deserialize(&amp;bytes)?; assert_eq!(person, decoded);   ","version":"0.14","tagName":"h2"},{"title":"Supported Types‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/rust/basic_serialization#supported-types","content":" ","version":"0.14","tagName":"h2"},{"title":"Primitive Types‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/rust/basic_serialization#primitive-types","content":" Rust Type\tDescriptionbool\tBoolean i8, i16, i32, i64\tSigned integers f32, f64\tFloating point String\tUTF-8 string  ","version":"0.14","tagName":"h3"},{"title":"Collections‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/rust/basic_serialization#collections","content":" Rust Type\tDescriptionVec&lt;T&gt;\tDynamic array VecDeque&lt;T&gt;\tDouble-ended queue LinkedList&lt;T&gt;\tDoubly-linked list HashMap&lt;K, V&gt;\tHash map BTreeMap&lt;K, V&gt;\tOrdered map HashSet&lt;T&gt;\tHash set BTreeSet&lt;T&gt;\tOrdered set BinaryHeap&lt;T&gt;\tBinary heap Option&lt;T&gt;\tOptional value  ","version":"0.14","tagName":"h3"},{"title":"Smart Pointers‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/rust/basic_serialization#smart-pointers","content":" Rust Type\tDescriptionBox&lt;T&gt;\tHeap allocation Rc&lt;T&gt;\tReference counting (shared refs tracked) Arc&lt;T&gt;\tThread-safe reference counting (shared refs tracked) RcWeak&lt;T&gt;\tWeak reference to Rc&lt;T&gt; (breaks circular refs) ArcWeak&lt;T&gt;\tWeak reference to Arc&lt;T&gt; (breaks circular refs) RefCell&lt;T&gt;\tInterior mutability (runtime borrow checking) Mutex&lt;T&gt;\tThread-safe interior mutability  ","version":"0.14","tagName":"h3"},{"title":"Date and Time‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/rust/basic_serialization#date-and-time","content":" Rust Type\tDescriptionchrono::NaiveDate\tDate without timezone chrono::NaiveDateTime\tTimestamp without timezone  ","version":"0.14","tagName":"h3"},{"title":"Custom Types‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/rust/basic_serialization#custom-types","content":" Macro\tDescription#[derive(ForyObject)]\tObject graph serialization #[derive(ForyRow)]\tRow-based serialization  ","version":"0.14","tagName":"h3"},{"title":"Serialization APIs‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/rust/basic_serialization#serialization-apis","content":" use fory::{Fory, Reader}; let mut fory = Fory::default(); fory.register::&lt;MyStruct&gt;(1)?; let obj = MyStruct { /* ... */ }; // Basic serialize/deserialize let bytes = fory.serialize(&amp;obj)?; let decoded: MyStruct = fory.deserialize(&amp;bytes)?; // Serialize to existing buffer let mut buf: Vec&lt;u8&gt; = vec![]; fory.serialize_to(&amp;mut buf, &amp;obj)?; // Deserialize from reader let mut reader = Reader::new(&amp;buf); let decoded: MyStruct = fory.deserialize_from(&amp;mut reader)?;   ","version":"0.14","tagName":"h2"},{"title":"Performance Tips‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/rust/basic_serialization#performance-tips","content":" Zero-Copy Deserialization: Row format enables direct memory access without copyingBuffer Pre-allocation: Minimizes memory allocations during serializationCompact Encoding: Variable-length encoding for space efficiencyLittle-Endian: Optimized for modern CPU architecturesReference Deduplication: Shared objects serialized only once  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/0.14/guide/rust/basic_serialization#related-topics","content":" Type Registration - Registering typesReferences - Shared and circular referencesCustom Serializers - Manual serialization ","version":"0.14","tagName":"h2"},{"title":"Configuration","type":0,"sectionRef":"#","url":"/docs/0.14/guide/rust/configuration","content":"","keywords":"","version":"0.14"},{"title":"Serialization Modes‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/rust/configuration#serialization-modes","content":" Apache Fory‚Ñ¢ supports two serialization modes:  ","version":"0.14","tagName":"h2"},{"title":"SchemaConsistent Mode (Default)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/rust/configuration#schemaconsistent-mode-default","content":" Type declarations must match exactly between peers:  let fory = Fory::default(); // SchemaConsistent by default   ","version":"0.14","tagName":"h3"},{"title":"Compatible Mode‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/rust/configuration#compatible-mode","content":" Allows independent schema evolution:  let fory = Fory::default().compatible(true);   ","version":"0.14","tagName":"h3"},{"title":"Configuration Options‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/rust/configuration#configuration-options","content":" ","version":"0.14","tagName":"h2"},{"title":"Maximum Dynamic Object Nesting Depth‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/rust/configuration#maximum-dynamic-object-nesting-depth","content":" Apache Fory‚Ñ¢ provides protection against stack overflow from deeply nested dynamic objects during deserialization. By default, the maximum nesting depth is set to 5 levels for trait objects and containers.  Default configuration:  let fory = Fory::default(); // max_dyn_depth = 5   Custom depth limit:  let fory = Fory::default().max_dyn_depth(10); // Allow up to 10 levels   When to adjust:  Increase: For legitimate deeply nested data structuresDecrease: For stricter security requirements or shallow data structures  Protected types:  Box&lt;dyn Any&gt;, Rc&lt;dyn Any&gt;, Arc&lt;dyn Any&gt;Box&lt;dyn Trait&gt;, Rc&lt;dyn Trait&gt;, Arc&lt;dyn Trait&gt; (trait objects)RcWeak&lt;T&gt;, ArcWeak&lt;T&gt;Collection types (Vec, HashMap, HashSet)Nested struct types in Compatible mode  Note: Static data types (non-dynamic types) are secure by nature and not subject to depth limits, as their structure is known at compile time.  ","version":"0.14","tagName":"h3"},{"title":"Cross-Language Mode‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/rust/configuration#cross-language-mode","content":" Enable cross-language serialization:  let fory = Fory::default() .compatible(true) .xlang(true);   ","version":"0.14","tagName":"h3"},{"title":"Builder Pattern‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/rust/configuration#builder-pattern","content":" use fory::Fory; // Default configuration let fory = Fory::default(); // Compatible mode for schema evolution let fory = Fory::default().compatible(true); // Cross-language mode let fory = Fory::default() .compatible(true) .xlang(true); // Custom depth limit let fory = Fory::default().max_dyn_depth(10); // Combined configuration let fory = Fory::default() .compatible(true) .xlang(true) .max_dyn_depth(10);   ","version":"0.14","tagName":"h2"},{"title":"Configuration Summary‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/rust/configuration#configuration-summary","content":" Option\tDescription\tDefaultcompatible(bool)\tEnable schema evolution\tfalse xlang(bool)\tEnable cross-language mode\tfalse max_dyn_depth(u32)\tMaximum nesting depth for dynamic types\t5  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/0.14/guide/rust/configuration#related-topics","content":" Basic Serialization - Using configured ForySchema Evolution - Compatible mode detailsCross-Language - XLANG mode ","version":"0.14","tagName":"h2"},{"title":"Cross-Language Serialization","type":0,"sectionRef":"#","url":"/docs/0.14/guide/rust/cross_language","content":"","keywords":"","version":"0.14"},{"title":"Enable Cross-Language Mode‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/rust/cross_language#enable-cross-language-mode","content":" use fory::Fory; // Enable cross-language mode let mut fory = Fory::default() .compatible(true) .xlang(true); // Register types with consistent IDs across languages fory.register::&lt;MyStruct&gt;(100); // Or use namespace-based registration fory.register_by_namespace::&lt;MyStruct&gt;(&quot;com.example&quot;, &quot;MyStruct&quot;);   ","version":"0.14","tagName":"h2"},{"title":"Type Registration for Cross-Language‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/rust/cross_language#type-registration-for-cross-language","content":" ","version":"0.14","tagName":"h2"},{"title":"Register by ID‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/rust/cross_language#register-by-id","content":" For fast, compact serialization with consistent IDs across languages:  let mut fory = Fory::default() .compatible(true) .xlang(true); fory.register::&lt;User&gt;(100); // Same ID in Java, Python, etc.   ","version":"0.14","tagName":"h3"},{"title":"Register by Namespace‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/rust/cross_language#register-by-namespace","content":" For more flexible type naming:  fory.register_by_namespace::&lt;User&gt;(&quot;com.example&quot;, &quot;User&quot;);   ","version":"0.14","tagName":"h3"},{"title":"Cross-Language Example‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/rust/cross_language#cross-language-example","content":" ","version":"0.14","tagName":"h2"},{"title":"Rust (Serializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/rust/cross_language#rust-serializer","content":" use fory::Fory; use fory::ForyObject; #[derive(ForyObject)] struct Person { name: String, age: i32, } let mut fory = Fory::default() .compatible(true) .xlang(true); fory.register::&lt;Person&gt;(100); let person = Person { name: &quot;Alice&quot;.to_string(), age: 30, }; let bytes = fory.serialize(&amp;person)?; // bytes can be deserialized by Java, Python, etc.   ","version":"0.14","tagName":"h3"},{"title":"Java (Deserializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/rust/cross_language#java-deserializer","content":" import org.apache.fory.*; import org.apache.fory.config.*; public class Person { public String name; public int age; } Fory fory = Fory.builder() .withLanguage(Language.XLANG) .withRefTracking(true) .build(); fory.register(Person.class, 100); // Same ID as Rust Person person = (Person) fory.deserialize(bytesFromRust);   ","version":"0.14","tagName":"h3"},{"title":"Python (Deserializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/rust/cross_language#python-deserializer","content":" import pyfory from dataclasses import dataclass @dataclass class Person: name: str age: pyfory.int32 fory = pyfory.Fory(ref_tracking=True) fory.register_type(Person, type_id=100) # Same ID as Rust person = fory.deserialize(bytes_from_rust)   ","version":"0.14","tagName":"h3"},{"title":"Type Mapping‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/rust/cross_language#type-mapping","content":" See xlang_type_mapping.md for complete type mapping across languages.  ","version":"0.14","tagName":"h2"},{"title":"Common Type Mappings‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/rust/cross_language#common-type-mappings","content":" Rust\tJava\tPythoni32\tint\tint32 i64\tlong\tint64 f32\tfloat\tfloat32 f64\tdouble\tfloat64 String\tString\tstr Vec&lt;T&gt;\tList&lt;T&gt;\tList[T] HashMap&lt;K,V&gt;\tMap&lt;K,V&gt;\tDict[K,V] Option&lt;T&gt;\tnullable T\tOptional[T]  ","version":"0.14","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/rust/cross_language#best-practices","content":" Use consistent type IDs across all languagesEnable compatible mode for schema evolutionRegister all types before serializationTest cross-language compatibility during development  ","version":"0.14","tagName":"h2"},{"title":"See Also‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/rust/cross_language#see-also","content":" Cross-Language Serialization SpecificationType Mapping ReferenceJava Cross-Language GuidePython Cross-Language Guide  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/0.14/guide/rust/cross_language#related-topics","content":" Configuration - XLANG mode configurationSchema Evolution - Compatible modeType Registration - Registration methods ","version":"0.14","tagName":"h2"},{"title":"Custom Serializers","type":0,"sectionRef":"#","url":"/docs/0.14/guide/rust/custom_serializers","content":"","keywords":"","version":"0.14"},{"title":"When to Use Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/rust/custom_serializers#when-to-use-custom-serializers","content":" External types from other cratesTypes with special serialization requirementsLegacy data format compatibilityPerformance-critical custom encoding  ","version":"0.14","tagName":"h2"},{"title":"Implementing the Serializer Trait‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/rust/custom_serializers#implementing-the-serializer-trait","content":" use fory::{Fory, ReadContext, WriteContext, Serializer, ForyDefault, Error}; use std::any::Any; #[derive(Debug, PartialEq)] struct CustomType { value: i32, name: String, } impl Serializer for CustomType { fn fory_write_data(&amp;self, context: &amp;mut WriteContext, is_field: bool) { context.writer.write_i32(self.value); context.writer.write_varuint32(self.name.len() as u32); context.writer.write_utf8_string(&amp;self.name); } fn fory_read_data(context: &amp;mut ReadContext, is_field: bool) -&gt; Result&lt;Self, Error&gt; { let value = context.reader.read_i32(); let len = context.reader.read_varuint32() as usize; let name = context.reader.read_utf8_string(len); Ok(Self { value, name }) } fn fory_type_id_dyn(&amp;self, type_resolver: &amp;TypeResolver) -&gt; u32 { Self::fory_get_type_id(type_resolver) } fn as_any(&amp;self) -&gt; &amp;dyn Any { self } } impl ForyDefault for CustomType { fn fory_default() -&gt; Self { Self::default() } }   ","version":"0.14","tagName":"h2"},{"title":"Registering Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/rust/custom_serializers#registering-custom-serializers","content":" let mut fory = Fory::default(); fory.register_serializer::&lt;CustomType&gt;(100); let custom = CustomType { value: 42, name: &quot;test&quot;.to_string(), }; let bytes = fory.serialize(&amp;custom); let decoded: CustomType = fory.deserialize(&amp;bytes)?; assert_eq!(custom, decoded);   ","version":"0.14","tagName":"h2"},{"title":"WriteContext and ReadContext‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/rust/custom_serializers#writecontext-and-readcontext","content":" The WriteContext and ReadContext provide access to:  writer/reader: Binary buffer operationstype_resolver: Type registration informationref_resolver: Reference tracking (for shared/circular references)  ","version":"0.14","tagName":"h2"},{"title":"Common Writer Methods‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/rust/custom_serializers#common-writer-methods","content":" // Primitive types context.writer.write_i8(value); context.writer.write_i16(value); context.writer.write_i32(value); context.writer.write_i64(value); context.writer.write_f32(value); context.writer.write_f64(value); context.writer.write_bool(value); // Variable-length integers context.writer.write_varint32(value); context.writer.write_varuint32(value); // Strings context.writer.write_utf8_string(&amp;string);   ","version":"0.14","tagName":"h3"},{"title":"Common Reader Methods‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/rust/custom_serializers#common-reader-methods","content":" // Primitive types let value = context.reader.read_i8(); let value = context.reader.read_i16(); let value = context.reader.read_i32(); let value = context.reader.read_i64(); let value = context.reader.read_f32(); let value = context.reader.read_f64(); let value = context.reader.read_bool(); // Variable-length integers let value = context.reader.read_varint32(); let value = context.reader.read_varuint32(); // Strings let string = context.reader.read_utf8_string(len);   ","version":"0.14","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/rust/custom_serializers#best-practices","content":" Use variable-length encoding for integers that may be smallWrite length first for variable-length dataHandle errors properly in read methodsImplement ForyDefault for schema evolution support  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/0.14/guide/rust/custom_serializers#related-topics","content":" Type Registration - Registering serializersBasic Serialization - Using ForyObject deriveSchema Evolution - Compatible mode ","version":"0.14","tagName":"h2"},{"title":"Shared & Circular References","type":0,"sectionRef":"#","url":"/docs/0.14/guide/rust/references","content":"","keywords":"","version":"0.14"},{"title":"Shared References‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/0.14/guide/rust/references#shared-references","content":" When the same object is referenced multiple times, Fory serializes it only once and uses reference IDs for subsequent occurrences. This ensures:  Space efficiency: No data duplication in serialized outputReference identity preservation: Deserialized objects maintain the same sharing relationshipsCircular reference support: Use RcWeak&lt;T&gt; and ArcWeak&lt;T&gt; to break cycles  ","version":"0.14","tagName":"h2"},{"title":"Shared References with Rc‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/0.14/guide/rust/references#shared-references-with-rc","content":" use fory::Fory; use std::rc::Rc; let fory = Fory::default(); // Create a shared value let shared = Rc::new(String::from(&quot;shared_value&quot;)); // Reference it multiple times let data = vec![shared.clone(), shared.clone(), shared.clone()]; // The shared value is serialized only once let bytes = fory.serialize(&amp;data); let decoded: Vec&lt;Rc&lt;String&gt;&gt; = fory.deserialize(&amp;bytes)?; // Verify reference identity is preserved assert_eq!(decoded.len(), 3); assert_eq!(*decoded[0], &quot;shared_value&quot;); // All three Rc pointers point to the same object assert!(Rc::ptr_eq(&amp;decoded[0], &amp;decoded[1])); assert!(Rc::ptr_eq(&amp;decoded[1], &amp;decoded[2]));   ","version":"0.14","tagName":"h3"},{"title":"Shared References with Arc‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/0.14/guide/rust/references#shared-references-with-arc","content":" For thread-safe shared references, use Arc&lt;T&gt;:  use fory::Fory; use std::sync::Arc; let fory = Fory::default(); let shared = Arc::new(String::from(&quot;shared_value&quot;)); let data = vec![shared.clone(), shared.clone()]; let bytes = fory.serialize(&amp;data); let decoded: Vec&lt;Arc&lt;String&gt;&gt; = fory.deserialize(&amp;bytes)?; assert!(Arc::ptr_eq(&amp;decoded[0], &amp;decoded[1]));   ","version":"0.14","tagName":"h3"},{"title":"Circular References with Weak Pointers‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/0.14/guide/rust/references#circular-references-with-weak-pointers","content":" To serialize circular references like parent-child relationships or doubly-linked structures, use RcWeak&lt;T&gt; or ArcWeak&lt;T&gt; to break the cycle.  How it works:  Weak pointers serialize as references to their target objectsIf the strong pointer has been dropped, weak serializes as NullForward references (weak appearing before target) are resolved via callbacksAll clones of a weak pointer share the same internal cell for automatic updates  ","version":"0.14","tagName":"h2"},{"title":"Circular References with RcWeak‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/0.14/guide/rust/references#circular-references-with-rcweak","content":" use fory::{Fory, Error}; use fory::ForyObject; use fory::RcWeak; use std::rc::Rc; use std::cell::RefCell; #[derive(ForyObject, Debug)] struct Node { value: i32, parent: RcWeak&lt;RefCell&lt;Node&gt;&gt;, children: Vec&lt;Rc&lt;RefCell&lt;Node&gt;&gt;&gt;, } let mut fory = Fory::default(); fory.register::&lt;Node&gt;(2000); // Build a parent-child tree let parent = Rc::new(RefCell::new(Node { value: 1, parent: RcWeak::new(), children: vec![], })); let child1 = Rc::new(RefCell::new(Node { value: 2, parent: RcWeak::from(&amp;parent), children: vec![], })); let child2 = Rc::new(RefCell::new(Node { value: 3, parent: RcWeak::from(&amp;parent), children: vec![], })); parent.borrow_mut().children.push(child1.clone()); parent.borrow_mut().children.push(child2.clone()); // Serialize and deserialize the circular structure let bytes = fory.serialize(&amp;parent); let decoded: Rc&lt;RefCell&lt;Node&gt;&gt; = fory.deserialize(&amp;bytes)?; // Verify the circular relationship assert_eq!(decoded.borrow().children.len(), 2); for child in &amp;decoded.borrow().children { let upgraded_parent = child.borrow().parent.upgrade().unwrap(); assert!(Rc::ptr_eq(&amp;decoded, &amp;upgraded_parent)); }   ","version":"0.14","tagName":"h3"},{"title":"Thread-Safe Circular Graphs with Arc‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/0.14/guide/rust/references#thread-safe-circular-graphs-with-arc","content":" use fory::{Fory, Error}; use fory::ForyObject; use fory::ArcWeak; use std::sync::{Arc, Mutex}; #[derive(ForyObject)] struct Node { val: i32, parent: ArcWeak&lt;Mutex&lt;Node&gt;&gt;, children: Vec&lt;Arc&lt;Mutex&lt;Node&gt;&gt;&gt;, } let mut fory = Fory::default(); fory.register::&lt;Node&gt;(6000); let parent = Arc::new(Mutex::new(Node { val: 10, parent: ArcWeak::new(), children: vec![], })); let child1 = Arc::new(Mutex::new(Node { val: 20, parent: ArcWeak::from(&amp;parent), children: vec![], })); let child2 = Arc::new(Mutex::new(Node { val: 30, parent: ArcWeak::from(&amp;parent), children: vec![], })); parent.lock().unwrap().children.push(child1.clone()); parent.lock().unwrap().children.push(child2.clone()); let bytes = fory.serialize(&amp;parent); let decoded: Arc&lt;Mutex&lt;Node&gt;&gt; = fory.deserialize(&amp;bytes)?; assert_eq!(decoded.lock().unwrap().children.len(), 2); for child in &amp;decoded.lock().unwrap().children { let upgraded_parent = child.lock().unwrap().parent.upgrade().unwrap(); assert!(Arc::ptr_eq(&amp;decoded, &amp;upgraded_parent)); }   ","version":"0.14","tagName":"h3"},{"title":"Supported Smart Pointer Types‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/0.14/guide/rust/references#supported-smart-pointer-types","content":" Type\tDescriptionRc&lt;T&gt;\tReference counting, shared refs tracked Arc&lt;T&gt;\tThread-safe reference counting, shared refs tracked RcWeak&lt;T&gt;\tWeak reference to Rc&lt;T&gt;, breaks circular refs ArcWeak&lt;T&gt;\tWeak reference to Arc&lt;T&gt;, breaks circular refs RefCell&lt;T&gt;\tInterior mutability with runtime borrow checking Mutex&lt;T&gt;\tThread-safe interior mutability  ","version":"0.14","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/0.14/guide/rust/references#best-practices","content":" Use Rc/Arc for shared data: Let Fory handle deduplicationUse weak pointers for cycles: Prevent infinite recursionPrefer Arc for thread-safe scenarios: When data crosses thread boundariesCombine with RefCell/Mutex: For interior mutability  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/0.14/guide/rust/references#related-topics","content":" Basic Serialization - Supported typesPolymorphism - Trait objects with Rc/ArcConfiguration - Reference tracking options ","version":"0.14","tagName":"h2"},{"title":"Row Format","type":0,"sectionRef":"#","url":"/docs/0.14/guide/rust/row_format","content":"","keywords":"","version":"0.14"},{"title":"Overview‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/rust/row_format#overview","content":" Unlike traditional object serialization that reconstructs entire objects in memory, row format enables random access to fields directly from binary data without full deserialization.  Key benefits:  Zero-copy access: Read fields without allocating or copying dataPartial deserialization: Access only the fields you needMemory-mapped files: Work with data larger than RAMCache-friendly: Sequential memory layout for better CPU cache utilizationLazy evaluation: Defer expensive operations until field access  ","version":"0.14","tagName":"h2"},{"title":"When to Use Row Format‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/rust/row_format#when-to-use-row-format","content":" Analytics workloads with selective field accessLarge datasets where only a subset of fields is neededMemory-constrained environmentsHigh-throughput data pipelinesReading from memory-mapped files or shared memory  ","version":"0.14","tagName":"h2"},{"title":"Basic Usage‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/rust/row_format#basic-usage","content":" use fory::{to_row, from_row}; use fory::ForyRow; use std::collections::BTreeMap; #[derive(ForyRow)] struct UserProfile { id: i64, username: String, email: String, scores: Vec&lt;i32&gt;, preferences: BTreeMap&lt;String, String&gt;, is_active: bool, } let profile = UserProfile { id: 12345, username: &quot;alice&quot;.to_string(), email: &quot;alice@example.com&quot;.to_string(), scores: vec![95, 87, 92, 88], preferences: BTreeMap::from([ (&quot;theme&quot;.to_string(), &quot;dark&quot;.to_string()), (&quot;language&quot;.to_string(), &quot;en&quot;.to_string()), ]), is_active: true, }; // Serialize to row format let row_data = to_row(&amp;profile); // Zero-copy deserialization - no object allocation! let row = from_row::&lt;UserProfile&gt;(&amp;row_data); // Access fields directly from binary data assert_eq!(row.id(), 12345); assert_eq!(row.username(), &quot;alice&quot;); assert_eq!(row.email(), &quot;alice@example.com&quot;); assert_eq!(row.is_active(), true); // Access collections efficiently let scores = row.scores(); assert_eq!(scores.size(), 4); assert_eq!(scores.get(0), 95); assert_eq!(scores.get(1), 87); let prefs = row.preferences(); assert_eq!(prefs.keys().size(), 2); assert_eq!(prefs.keys().get(0), &quot;language&quot;); assert_eq!(prefs.values().get(0), &quot;en&quot;);   ","version":"0.14","tagName":"h2"},{"title":"How It Works‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/rust/row_format#how-it-works","content":" Fields are encoded in a binary row with fixed offsets for primitivesVariable-length data (strings, collections) stored with offset pointersNull bitmap tracks which fields are presentNested structures supported through recursive row encoding  ","version":"0.14","tagName":"h2"},{"title":"Performance Comparison‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/rust/row_format#performance-comparison","content":" Operation\tObject Format\tRow FormatFull deserialization\tAllocates all objects\tZero allocation Single field access\tFull deserialization required\tDirect offset read Memory usage\tFull object graph in memory\tOnly accessed fields in memory Suitable for\tSmall objects, full access\tLarge objects, selective access  ","version":"0.14","tagName":"h2"},{"title":"ForyRow vs ForyObject‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/rust/row_format#foryrow-vs-foryobject","content":" Feature\t#[derive(ForyRow)]\t#[derive(ForyObject)]Deserialization\tZero-copy, lazy\tFull object reconstruction Field access\tDirect from binary\tNormal struct access Memory usage\tMinimal\tFull object Best for\tAnalytics, large data\tGeneral serialization  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/rust/row_format#related-topics","content":" Basic Serialization - Object graph serializationCross-Language - Row format across languagesRow Format Specification - Protocol details ","version":"0.14","tagName":"h2"},{"title":"Trait Object Serialization","type":0,"sectionRef":"#","url":"/docs/0.14/guide/rust/polymorphism","content":"","keywords":"","version":"0.14"},{"title":"Supported Trait Object Types‚Äã","type":1,"pageTitle":"Trait Object Serialization","url":"/docs/0.14/guide/rust/polymorphism#supported-trait-object-types","content":" Box&lt;dyn Trait&gt; - Owned trait objectsRc&lt;dyn Trait&gt; - Reference-counted trait objectsArc&lt;dyn Trait&gt; - Thread-safe reference-counted trait objectsVec&lt;Box&lt;dyn Trait&gt;&gt;, HashMap&lt;K, Box&lt;dyn Trait&gt;&gt; - Collections of trait objects  ","version":"0.14","tagName":"h2"},{"title":"Basic Trait Object Serialization‚Äã","type":1,"pageTitle":"Trait Object Serialization","url":"/docs/0.14/guide/rust/polymorphism#basic-trait-object-serialization","content":" use fory::{Fory, register_trait_type}; use fory::Serializer; use fory::ForyObject; trait Animal: Serializer { fn speak(&amp;self) -&gt; String; fn name(&amp;self) -&gt; &amp;str; } #[derive(ForyObject)] struct Dog { name: String, breed: String } impl Animal for Dog { fn speak(&amp;self) -&gt; String { &quot;Woof!&quot;.to_string() } fn name(&amp;self) -&gt; &amp;str { &amp;self.name } } #[derive(ForyObject)] struct Cat { name: String, color: String } impl Animal for Cat { fn speak(&amp;self) -&gt; String { &quot;Meow!&quot;.to_string() } fn name(&amp;self) -&gt; &amp;str { &amp;self.name } } // Register trait implementations register_trait_type!(Animal, Dog, Cat); #[derive(ForyObject)] struct Zoo { star_animal: Box&lt;dyn Animal&gt;, } let mut fory = Fory::default().compatible(true); fory.register::&lt;Dog&gt;(100); fory.register::&lt;Cat&gt;(101); fory.register::&lt;Zoo&gt;(102); let zoo = Zoo { star_animal: Box::new(Dog { name: &quot;Buddy&quot;.to_string(), breed: &quot;Labrador&quot;.to_string(), }), }; let bytes = fory.serialize(&amp;zoo); let decoded: Zoo = fory.deserialize(&amp;bytes)?; assert_eq!(decoded.star_animal.name(), &quot;Buddy&quot;); assert_eq!(decoded.star_animal.speak(), &quot;Woof!&quot;);   ","version":"0.14","tagName":"h2"},{"title":"Serializing dyn Any Trait Objects‚Äã","type":1,"pageTitle":"Trait Object Serialization","url":"/docs/0.14/guide/rust/polymorphism#serializing-dyn-any-trait-objects","content":" Apache Fory‚Ñ¢ supports serializing Rc&lt;dyn Any&gt; and Arc&lt;dyn Any&gt; for runtime type dispatch:  Key points:  Works with any type that implements SerializerRequires downcasting after deserialization to access the concrete typeType information is preserved during serializationUseful for plugin systems and dynamic type handling  use std::rc::Rc; use std::any::Any; let dog_rc: Rc&lt;dyn Animal&gt; = Rc::new(Dog { name: &quot;Rex&quot;.to_string(), breed: &quot;Golden&quot;.to_string() }); // Convert to Rc&lt;dyn Any&gt; for serialization let dog_any: Rc&lt;dyn Any&gt; = dog_rc.clone(); // Serialize the Any wrapper let bytes = fory.serialize(&amp;dog_any); let decoded: Rc&lt;dyn Any&gt; = fory.deserialize(&amp;bytes)?; // Downcast back to the concrete type let unwrapped = decoded.downcast_ref::&lt;Dog&gt;().unwrap(); assert_eq!(unwrapped.name, &quot;Rex&quot;);   For thread-safe scenarios, use Arc&lt;dyn Any&gt;:  use std::sync::Arc; use std::any::Any; let dog_arc: Arc&lt;dyn Animal&gt; = Arc::new(Dog { name: &quot;Buddy&quot;.to_string(), breed: &quot;Labrador&quot;.to_string() }); // Convert to Arc&lt;dyn Any&gt; let dog_any: Arc&lt;dyn Any&gt; = dog_arc.clone(); let bytes = fory.serialize(&amp;dog_any); let decoded: Arc&lt;dyn Any&gt; = fory.deserialize(&amp;bytes)?; // Downcast to concrete type let unwrapped = decoded.downcast_ref::&lt;Dog&gt;().unwrap(); assert_eq!(unwrapped.name, &quot;Buddy&quot;);   ","version":"0.14","tagName":"h2"},{"title":"Rc/Arc-Based Trait Objects in Structs‚Äã","type":1,"pageTitle":"Trait Object Serialization","url":"/docs/0.14/guide/rust/polymorphism#rcarc-based-trait-objects-in-structs","content":" For fields with Rc&lt;dyn Trait&gt; or Arc&lt;dyn Trait&gt;, Fory automatically handles the conversion:  use std::sync::Arc; use std::rc::Rc; use std::collections::HashMap; #[derive(ForyObject)] struct AnimalShelter { animals_rc: Vec&lt;Rc&lt;dyn Animal&gt;&gt;, animals_arc: Vec&lt;Arc&lt;dyn Animal&gt;&gt;, registry: HashMap&lt;String, Arc&lt;dyn Animal&gt;&gt;, } let mut fory = Fory::default().compatible(true); fory.register::&lt;Dog&gt;(100); fory.register::&lt;Cat&gt;(101); fory.register::&lt;AnimalShelter&gt;(102); let shelter = AnimalShelter { animals_rc: vec![ Rc::new(Dog { name: &quot;Rex&quot;.to_string(), breed: &quot;Golden&quot;.to_string() }), Rc::new(Cat { name: &quot;Mittens&quot;.to_string(), color: &quot;Gray&quot;.to_string() }), ], animals_arc: vec![ Arc::new(Dog { name: &quot;Buddy&quot;.to_string(), breed: &quot;Labrador&quot;.to_string() }), ], registry: HashMap::from([ (&quot;pet1&quot;.to_string(), Arc::new(Dog { name: &quot;Max&quot;.to_string(), breed: &quot;Shepherd&quot;.to_string() }) as Arc&lt;dyn Animal&gt;), ]), }; let bytes = fory.serialize(&amp;shelter); let decoded: AnimalShelter = fory.deserialize(&amp;bytes)?; assert_eq!(decoded.animals_rc[0].name(), &quot;Rex&quot;); assert_eq!(decoded.animals_arc[0].speak(), &quot;Woof!&quot;);   ","version":"0.14","tagName":"h2"},{"title":"Standalone Trait Object Serialization‚Äã","type":1,"pageTitle":"Trait Object Serialization","url":"/docs/0.14/guide/rust/polymorphism#standalone-trait-object-serialization","content":" Due to Rust's orphan rule, Rc&lt;dyn Trait&gt; and Arc&lt;dyn Trait&gt; cannot implement Serializer directly. For standalone serialization (not inside struct fields), the register_trait_type! macro generates wrapper types.  Note: If you don't want to use wrapper types, you can serialize as Rc&lt;dyn Any&gt; or Arc&lt;dyn Any&gt; instead (see the dyn Any section above).  The register_trait_type! macro generates AnimalRc and AnimalArc wrapper types:  // For Rc&lt;dyn Trait&gt; let dog_rc: Rc&lt;dyn Animal&gt; = Rc::new(Dog { name: &quot;Rex&quot;.to_string(), breed: &quot;Golden&quot;.to_string() }); let wrapper = AnimalRc::from(dog_rc); let bytes = fory.serialize(&amp;wrapper); let decoded: AnimalRc = fory.deserialize(&amp;bytes)?; // Unwrap back to Rc&lt;dyn Animal&gt; let unwrapped: Rc&lt;dyn Animal&gt; = decoded.unwrap(); assert_eq!(unwrapped.name(), &quot;Rex&quot;); // For Arc&lt;dyn Trait&gt; let dog_arc: Arc&lt;dyn Animal&gt; = Arc::new(Dog { name: &quot;Buddy&quot;.to_string(), breed: &quot;Labrador&quot;.to_string() }); let wrapper = AnimalArc::from(dog_arc); let bytes = fory.serialize(&amp;wrapper); let decoded: AnimalArc = fory.deserialize(&amp;bytes)?; let unwrapped: Arc&lt;dyn Animal&gt; = decoded.unwrap(); assert_eq!(unwrapped.name(), &quot;Buddy&quot;);   ","version":"0.14","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Trait Object Serialization","url":"/docs/0.14/guide/rust/polymorphism#best-practices","content":" Use register_trait_type! to register all trait implementationsEnable compatible mode for trait objects: .compatible(true)Register all concrete types before serializationPrefer dyn Any for simpler standalone serialization  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Trait Object Serialization","url":"/docs/0.14/guide/rust/polymorphism#related-topics","content":" References - Rc/Arc shared referencesSchema Evolution - Compatible modeType Registration - Registering types ","version":"0.14","tagName":"h2"},{"title":"Schema Evolution","type":0,"sectionRef":"#","url":"/docs/0.14/guide/rust/schema_evolution","content":"","keywords":"","version":"0.14"},{"title":"Compatible Mode‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/rust/schema_evolution#compatible-mode","content":" Enable schema evolution with compatible(true):  use fory::Fory; use fory::ForyObject; use std::collections::HashMap; #[derive(ForyObject, Debug)] struct PersonV1 { name: String, age: i32, address: String, } #[derive(ForyObject, Debug)] struct PersonV2 { name: String, age: i32, // address removed // phone added phone: Option&lt;String&gt;, metadata: HashMap&lt;String, String&gt;, } let mut fory1 = Fory::default().compatible(true); fory1.register::&lt;PersonV1&gt;(1); let mut fory2 = Fory::default().compatible(true); fory2.register::&lt;PersonV2&gt;(1); let person_v1 = PersonV1 { name: &quot;Alice&quot;.to_string(), age: 30, address: &quot;123 Main St&quot;.to_string(), }; // Serialize with V1 let bytes = fory1.serialize(&amp;person_v1); // Deserialize with V2 - missing fields get default values let person_v2: PersonV2 = fory2.deserialize(&amp;bytes)?; assert_eq!(person_v2.name, &quot;Alice&quot;); assert_eq!(person_v2.age, 30); assert_eq!(person_v2.phone, None);   ","version":"0.14","tagName":"h2"},{"title":"Schema Evolution Features‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/rust/schema_evolution#schema-evolution-features","content":" Add new fields with default valuesRemove obsolete fields (skipped during deserialization)Change field nullability (T ‚Üî Option&lt;T&gt;)Reorder fields (matched by name, not position)Type-safe fallback to default values for missing fields  ","version":"0.14","tagName":"h2"},{"title":"Compatibility Rules‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/rust/schema_evolution#compatibility-rules","content":" Field names must match (case-sensitive)Type changes are not supported (except nullable/non-nullable)Nested struct types must be registered on both sides  ","version":"0.14","tagName":"h2"},{"title":"Enum Support‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/rust/schema_evolution#enum-support","content":" Apache Fory‚Ñ¢ supports three types of enum variants with full schema evolution in Compatible mode:  Variant Types:  Unit: C-style enums (Status::Active)Unnamed: Tuple-like variants (Message::Pair(String, i32))Named: Struct-like variants (Event::Click { x: i32, y: i32 })  use fory::{Fory, ForyObject}; #[derive(Default, ForyObject, Debug, PartialEq)] enum Value { #[default] Null, Bool(bool), Number(f64), Text(String), Object { name: String, value: i32 }, } let mut fory = Fory::default(); fory.register::&lt;Value&gt;(1)?; let value = Value::Object { name: &quot;score&quot;.to_string(), value: 100 }; let bytes = fory.serialize(&amp;value)?; let decoded: Value = fory.deserialize(&amp;bytes)?; assert_eq!(value, decoded);   ","version":"0.14","tagName":"h2"},{"title":"Enum Schema Evolution‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/rust/schema_evolution#enum-schema-evolution","content":" Compatible mode enables robust schema evolution with variant type encoding (2 bits):  0b0 = Unit, 0b1 = Unnamed, 0b10 = Named  use fory::{Fory, ForyObject}; // Old version #[derive(ForyObject)] enum OldEvent { Click { x: i32, y: i32 }, Scroll { delta: f64 }, } // New version - added field and variant #[derive(Default, ForyObject)] enum NewEvent { #[default] Unknown, Click { x: i32, y: i32, timestamp: u64 }, // Added field Scroll { delta: f64 }, KeyPress(String), // New variant } let mut fory = Fory::builder().compatible().build(); // Serialize with old schema let old_bytes = fory.serialize(&amp;OldEvent::Click { x: 100, y: 200 })?; // Deserialize with new schema - timestamp gets default value (0) let new_event: NewEvent = fory.deserialize(&amp;old_bytes)?; assert!(matches!(new_event, NewEvent::Click { x: 100, y: 200, timestamp: 0 }));   Evolution capabilities:  Unknown variants ‚Üí Falls back to default variantNamed variant fields ‚Üí Add/remove fields (missing fields use defaults)Unnamed variant elements ‚Üí Add/remove elements (extras skipped, missing use defaults)Variant type mismatches ‚Üí Automatically uses default value for current variant  Best practices:  Always mark a default variant with #[default]Named variants provide better evolution than unnamedUse compatible mode for cross-version communication  ","version":"0.14","tagName":"h3"},{"title":"Tuple Support‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/rust/schema_evolution#tuple-support","content":" Apache Fory‚Ñ¢ supports tuples up to 22 elements out of the box with efficient serialization in both compatible and non-compatible modes.  Features:  Automatic serialization for tuples from 1 to 22 elementsHeterogeneous type support (each element can be a different type)Schema evolution in Compatible mode (handles missing/extra elements)  Serialization modes:  Non-compatible mode: Serializes elements sequentially without collection headers for minimal overheadCompatible mode: Uses collection protocol with type metadata for schema evolution  use fory::{Fory, Error}; let mut fory = Fory::default(); // Tuple with heterogeneous types let data: (i32, String, bool, Vec&lt;i32&gt;) = ( 42, &quot;hello&quot;.to_string(), true, vec![1, 2, 3], ); let bytes = fory.serialize(&amp;data)?; let decoded: (i32, String, bool, Vec&lt;i32&gt;) = fory.deserialize(&amp;bytes)?; assert_eq!(data, decoded);   ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/0.14/guide/rust/schema_evolution#related-topics","content":" Configuration - Enabling compatible modePolymorphism - Trait objects with schema evolutionCross-Language - Schema evolution across languages ","version":"0.14","tagName":"h2"},{"title":"Troubleshooting","type":0,"sectionRef":"#","url":"/docs/0.14/guide/rust/troubleshooting","content":"","keywords":"","version":"0.14"},{"title":"Common Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/rust/troubleshooting#common-issues","content":" ","version":"0.14","tagName":"h2"},{"title":"Type Registry Errors‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/rust/troubleshooting#type-registry-errors","content":" Error: TypeId ... not found in type_info registry  Cause: The type was never registered with the current Fory instance.  Solution: Register the type before serialization:  let mut fory = Fory::default(); fory.register::&lt;MyStruct&gt;(100)?; // Register before use   Confirm that:  Every serializable struct or trait implementation calls fory.register::&lt;T&gt;(type_id)The same IDs are reused on the deserialize side  ","version":"0.14","tagName":"h3"},{"title":"Type Mismatch Errors‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/rust/troubleshooting#type-mismatch-errors","content":" Cause: Field types are incompatible or schema has changed.  Solution:  Enable compatible mode for schema evolutionEnsure field types match across versions  let fory = Fory::default().compatible(true);   ","version":"0.14","tagName":"h3"},{"title":"Debugging Techniques‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/rust/troubleshooting#debugging-techniques","content":" ","version":"0.14","tagName":"h2"},{"title":"Enable Panic on Error for Backtraces‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/rust/troubleshooting#enable-panic-on-error-for-backtraces","content":" Toggle FORY_PANIC_ON_ERROR=1 alongside RUST_BACKTRACE=1 to panic at the exact site an error is constructed:  RUST_BACKTRACE=1 FORY_PANIC_ON_ERROR=1 cargo test --features tests   Reset the variable afterwards to avoid aborting user-facing code paths.  ","version":"0.14","tagName":"h3"},{"title":"Struct Field Tracing‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/rust/troubleshooting#struct-field-tracing","content":" Add the #[fory(debug)] attribute alongside #[derive(ForyObject)] to emit hook invocations:  #[derive(ForyObject)] #[fory(debug)] struct MyStruct { field1: i32, field2: String, }   Once compiled with debug hooks, call these functions to plug in custom callbacks:  set_before_write_field_funcset_after_write_field_funcset_before_read_field_funcset_after_read_field_func  Use reset_struct_debug_hooks() when you want the defaults back.  ","version":"0.14","tagName":"h3"},{"title":"Lightweight Logging‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/rust/troubleshooting#lightweight-logging","content":" Without custom hooks, enable ENABLE_FORY_DEBUG_OUTPUT=1 to print field-level read/write events:  ENABLE_FORY_DEBUG_OUTPUT=1 cargo test --features tests   This is especially useful when investigating alignment or cursor mismatches.  ","version":"0.14","tagName":"h3"},{"title":"Inspect Generated Code‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/rust/troubleshooting#inspect-generated-code","content":" Use cargo expand to inspect code generated by Fory derive macros:  cargo expand --test mod $mod$::$file$ &gt; expanded.rs   ","version":"0.14","tagName":"h3"},{"title":"Running Tests‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/rust/troubleshooting#running-tests","content":" ","version":"0.14","tagName":"h2"},{"title":"Run All Tests‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/rust/troubleshooting#run-all-tests","content":" cargo test --features tests   ","version":"0.14","tagName":"h3"},{"title":"Run Specific Test‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/rust/troubleshooting#run-specific-test","content":" cargo test -p tests --test $test_file $test_method   ","version":"0.14","tagName":"h3"},{"title":"Run Test with Debugging‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/rust/troubleshooting#run-test-with-debugging","content":" RUST_BACKTRACE=1 FORY_PANIC_ON_ERROR=1 ENABLE_FORY_DEBUG_OUTPUT=1 \\ cargo test --test mod $dir$::$test_file::$test_method -- --nocapture   ","version":"0.14","tagName":"h3"},{"title":"Test-Time Hygiene‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/rust/troubleshooting#test-time-hygiene","content":" Some integration tests expect FORY_PANIC_ON_ERROR to remain unset. Export it only for focused debugging sessions:  # For specific debugging only FORY_PANIC_ON_ERROR=1 cargo test -p tests --test specific_test -- --nocapture # Normal test run (without panic on error) cargo test --features tests   ","version":"0.14","tagName":"h2"},{"title":"Error Handling Best Practices‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/rust/troubleshooting#error-handling-best-practices","content":" Prefer the static constructors on fory_core::error::Error:  Error::type_mismatchError::invalid_dataError::unknown  This keeps diagnostics consistent and makes opt-in panics work correctly.  ","version":"0.14","tagName":"h2"},{"title":"Quick Reference‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/rust/troubleshooting#quick-reference","content":" Environment Variable\tPurposeRUST_BACKTRACE=1\tEnable stack traces FORY_PANIC_ON_ERROR=1\tPanic at error site for debugging ENABLE_FORY_DEBUG_OUTPUT=1\tPrint field-level read/write events  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/rust/troubleshooting#related-topics","content":" Configuration - Fory optionsType Registration - Registration best practicesSchema Evolution - Compatible mode ","version":"0.14","tagName":"h2"},{"title":"Type Registration","type":0,"sectionRef":"#","url":"/docs/0.14/guide/rust/type_registration","content":"","keywords":"","version":"0.14"},{"title":"Register by ID‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/0.14/guide/rust/type_registration#register-by-id","content":" Register types with a numeric ID for fast, compact serialization:  use fory::Fory; use fory::ForyObject; #[derive(ForyObject)] struct User { name: String, age: i32, } let mut fory = Fory::default(); fory.register::&lt;User&gt;(1)?; let user = User { name: &quot;Alice&quot;.to_string(), age: 30, }; let bytes = fory.serialize(&amp;user)?; let decoded: User = fory.deserialize(&amp;bytes)?;   ","version":"0.14","tagName":"h2"},{"title":"Register by Namespace‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/0.14/guide/rust/type_registration#register-by-namespace","content":" For cross-language compatibility, register with namespace and type name:  let mut fory = Fory::default() .compatible(true) .xlang(true); // Register with namespace-based naming fory.register_by_namespace::&lt;MyStruct&gt;(&quot;com.example&quot;, &quot;MyStruct&quot;);   ","version":"0.14","tagName":"h2"},{"title":"Register Custom Serializer‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/0.14/guide/rust/type_registration#register-custom-serializer","content":" For types that need custom serialization logic:  let mut fory = Fory::default(); fory.register_serializer::&lt;CustomType&gt;(100);   ","version":"0.14","tagName":"h2"},{"title":"Registration Order‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/0.14/guide/rust/type_registration#registration-order","content":" When using ID-based registration without explicit IDs, the registration order matters. Ensure consistent registration order between serialization and deserialization:  // Serializer side let mut fory = Fory::default(); fory.register::&lt;TypeA&gt;(1)?; fory.register::&lt;TypeB&gt;(2)?; fory.register::&lt;TypeC&gt;(3)?; // Deserializer side - MUST use same order let mut fory = Fory::default(); fory.register::&lt;TypeA&gt;(1)?; fory.register::&lt;TypeB&gt;(2)?; fory.register::&lt;TypeC&gt;(3)?;   ","version":"0.14","tagName":"h2"},{"title":"Thread-Safe Registration‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/0.14/guide/rust/type_registration#thread-safe-registration","content":" Perform all registrations before spawning threads:  use std::sync::Arc; use std::thread; let mut fory = Fory::default(); fory.register::&lt;User&gt;(1)?; fory.register::&lt;Order&gt;(2)?; // Now share across threads let fory = Arc::new(fory); let handles: Vec&lt;_&gt; = (0..4) .map(|_| { let shared = Arc::clone(&amp;fory); thread::spawn(move || { // Use fory for serialization }) }) .collect();   ","version":"0.14","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/0.14/guide/rust/type_registration#best-practices","content":" Use consistent IDs: Same type ID across all languages for cross-language compatibilityRegister before threading: Complete all registrations before spawning threadsUse namespace for xlang: Makes type names consistent across languagesExplicit IDs for stability: Avoid auto-generated IDs in production  ","version":"0.14","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/0.14/guide/rust/type_registration#related-topics","content":" Configuration - Fory builder optionsCross-Language - XLANG mode registrationCustom Serializers - Custom serialization ","version":"0.14","tagName":"h2"},{"title":"Scala Serialization Guide","type":0,"sectionRef":"#","url":"/docs/0.14/guide/scala/","content":"","keywords":"","version":"0.14"},{"title":"Features‚Äã","type":1,"pageTitle":"Scala Serialization Guide","url":"/docs/0.14/guide/scala/#features","content":" Fory Scala inherits all features from Fory Java, plus Scala-specific optimizations:  High Performance: JIT code generation, zero-copy, 20-170x faster than traditional serializationScala Type Support: Optimized serializers for case classes, singletons, collections, tuples, Option, EitherDefault Value Support: Automatic handling of Scala class default parameters during schema evolutionSingleton Preservation: object singletons maintain referential equality after deserializationSchema Evolution: Forward/backward compatibility for class schema changes  See Java Features for complete feature list.  ","version":"0.14","tagName":"h2"},{"title":"Installation‚Äã","type":1,"pageTitle":"Scala Serialization Guide","url":"/docs/0.14/guide/scala/#installation","content":" Add the dependency with sbt:  libraryDependencies += &quot;org.apache.fory&quot; %% &quot;fory-scala&quot; % &quot;0.14.1&quot;   ","version":"0.14","tagName":"h2"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Scala Serialization Guide","url":"/docs/0.14/guide/scala/#quick-start","content":" import org.apache.fory.Fory import org.apache.fory.serializer.scala.ScalaSerializers case class Person(name: String, id: Long, github: String) case class Point(x: Int, y: Int, z: Int) object ScalaExample { // Create Fory with Scala optimization enabled val fory: Fory = Fory.builder() .withScalaOptimizationEnabled(true) .build() // Register optimized Fory serializers for Scala ScalaSerializers.registerSerializers(fory) // Register your classes fory.register(classOf[Person]) fory.register(classOf[Point]) def main(args: Array[String]): Unit = { val p = Person(&quot;Shawn Yang&quot;, 1, &quot;https://github.com/chaokunyang&quot;) println(fory.deserialize(fory.serialize(p))) println(fory.deserialize(fory.serialize(Point(1, 2, 3)))) } }   ","version":"0.14","tagName":"h2"},{"title":"Built on Fory Java‚Äã","type":1,"pageTitle":"Scala Serialization Guide","url":"/docs/0.14/guide/scala/#built-on-fory-java","content":" Fory Scala is built on top of Fory Java. Most configuration options, features, and concepts from Fory Java apply directly to Scala. Refer to the Java documentation for:  Configuration Options - All ForyBuilder optionsBasic Serialization - Serialization patterns and APIsType Registration - Class registration and securitySchema Evolution - Forward/backward compatibilityCustom Serializers - Implement custom serializersCompression - Int, long, and string compressionTroubleshooting - Common issues and solutions  ","version":"0.14","tagName":"h2"},{"title":"Scala-Specific Documentation‚Äã","type":1,"pageTitle":"Scala Serialization Guide","url":"/docs/0.14/guide/scala/#scala-specific-documentation","content":" Fory Creation - Scala-specific Fory setup requirementsType Serialization - Serializing Scala typesDefault Values - Scala class default values support ","version":"0.14","tagName":"h2"},{"title":"Cross-Language Serialization Guide","type":0,"sectionRef":"#","url":"/docs/0.14/guide/xlang/","content":"","keywords":"","version":"0.14"},{"title":"Features‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/0.14/guide/xlang/#features","content":" No IDL Required: Serialize any object automatically without Protocol Buffers, Thrift, or other IDL definitionsMulti-Language Support: Java, Python, C++, Go, Rust, JavaScript all interoperate seamlesslyReference Support: Shared and circular references work across language boundariesSchema Evolution: Forward/backward compatibility when class definitions changeZero-Copy: Out-of-band serialization for large binary dataHigh Performance: JIT compilation and optimized binary protocol  ","version":"0.14","tagName":"h2"},{"title":"Supported Languages‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/0.14/guide/xlang/#supported-languages","content":" Language\tStatus\tPackageJava\t‚úÖ\torg.apache.fory:fory-core Python\t‚úÖ\tpyfory C++\t‚úÖ\tBazel/CMake build Go\t‚úÖ\tgithub.com/apache/fory/go/fory Rust\t‚úÖ\tfory crate JavaScript\t‚úÖ\t@apache-fory/fory  ","version":"0.14","tagName":"h2"},{"title":"When to Use Xlang Mode‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/0.14/guide/xlang/#when-to-use-xlang-mode","content":" Use xlang mode when:  Building multi-language microservicesCreating polyglot data pipelinesSharing data between frontend (JavaScript) and backend (Java/Python/Go)  Use language-native mode when:  All serialization/deserialization happens in the same languageMaximum performance is required (native mode is faster)You need language-specific features (Python pickle compatibility, Java serialization hooks)  ","version":"0.14","tagName":"h2"},{"title":"Quick Example‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/0.14/guide/xlang/#quick-example","content":" ","version":"0.14","tagName":"h2"},{"title":"Java (Producer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/0.14/guide/xlang/#java-producer","content":" import org.apache.fory.*; import org.apache.fory.config.*; public class Person { public String name; public int age; } Fory fory = Fory.builder() .withLanguage(Language.XLANG) .build(); fory.register(Person.class, &quot;example.Person&quot;); Person person = new Person(); person.name = &quot;Alice&quot;; person.age = 30; byte[] bytes = fory.serialize(person); // Send bytes to Python, Go, Rust, etc.   ","version":"0.14","tagName":"h3"},{"title":"Python (Consumer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/0.14/guide/xlang/#python-consumer","content":" import pyfory from dataclasses import dataclass @dataclass class Person: name: str age: pyfory.Int32Type fory = pyfory.Fory() fory.register_type(Person, typename=&quot;example.Person&quot;) # Receive bytes from Java person = fory.deserialize(bytes_from_java) print(f&quot;{person.name}, {person.age}&quot;) # Alice, 30   ","version":"0.14","tagName":"h3"},{"title":"Documentation‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/0.14/guide/xlang/#documentation","content":" Topic\tDescriptionGetting Started\tInstallation and basic setup for all languages Type Mapping\tCross-language type mapping reference Serialization\tBuilt-in types, custom types, reference handling Zero-Copy\tOut-of-band serialization for large data Row Format\tCache-friendly binary format with random access Troubleshooting\tCommon issues and solutions  ","version":"0.14","tagName":"h2"},{"title":"Language-Specific Guides‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/0.14/guide/xlang/#language-specific-guides","content":" For language-specific details and API reference:  Java Cross-Language GuidePython Cross-Language GuideC++ Cross-Language GuideRust Cross-Language Guide  ","version":"0.14","tagName":"h2"},{"title":"Specifications‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/0.14/guide/xlang/#specifications","content":" Xlang Serialization Specification - Binary protocol detailsType Mapping Specification - Complete type mapping reference ","version":"0.14","tagName":"h2"},{"title":"Default Values","type":0,"sectionRef":"#","url":"/docs/0.14/guide/scala/default_values","content":"","keywords":"","version":"0.14"},{"title":"Overview‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/0.14/guide/scala/default_values#overview","content":" When a Scala class has default parameters, the Scala compiler generates methods in the companion object (for case classes) or in the class itself (for regular Scala classes) like apply$default$1, apply$default$2, etc. that return the default values. Fory can detect these methods and use them when deserializing objects where certain fields are missing from the serialized data.  ","version":"0.14","tagName":"h2"},{"title":"Supported Class Types‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/0.14/guide/scala/default_values#supported-class-types","content":" Fory supports default values for:  Case classes with default parametersRegular Scala classes with default parameters in their primary constructorNested case classes with default parameters  ","version":"0.14","tagName":"h2"},{"title":"How It Works‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/0.14/guide/scala/default_values#how-it-works","content":" Detection: Fory detects if a class is a Scala class by checking for the presence of default value methods (apply$default$N or $default$N). Default Value Discovery: For case classes: Fory scans the companion object for methods named apply$default$1, apply$default$2, etc.For regular Scala classes: Fory scans the class itself for methods named $default$1, $default$2, etc. Field Mapping: During deserialization, Fory identifies fields that exist in the target class but are missing from the serialized data. Value Application: After reading all available fields from the serialized data, Fory applies default values to any missing fields.  ","version":"0.14","tagName":"h2"},{"title":"Usage‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/0.14/guide/scala/default_values#usage","content":" This feature is automatically enabled when:  Compatible mode is enabled (withCompatibleMode(CompatibleMode.COMPATIBLE))The target class is detected as a Scala class with default valuesA field is missing from the serialized data but exists in the target class  No additional configuration is required.  ","version":"0.14","tagName":"h2"},{"title":"Examples‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/0.14/guide/scala/default_values#examples","content":" ","version":"0.14","tagName":"h2"},{"title":"Case Class with Default Values‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/0.14/guide/scala/default_values#case-class-with-default-values","content":" import org.apache.fory.Fory import org.apache.fory.config.CompatibleMode import org.apache.fory.serializer.scala.ScalaSerializers // Class WITHOUT default values (for serialization) case class PersonV1(name: String) // Class WITH default values (for deserialization) case class PersonV2(name: String, age: Int = 25, city: String = &quot;Unknown&quot;) val fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .withScalaOptimizationEnabled(true) .build() ScalaSerializers.registerSerializers(fory) // Serialize using class without default values val original = PersonV1(&quot;John&quot;) val serialized = fory.serialize(original) // Deserialize into class with default values // Missing fields will use defaults val deserialized = fory.deserialize(serialized).asInstanceOf[PersonV2] // deserialized.name == &quot;John&quot; // deserialized.age == 25 (default) // deserialized.city == &quot;Unknown&quot; (default)   ","version":"0.14","tagName":"h3"},{"title":"Regular Scala Class with Default Values‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/0.14/guide/scala/default_values#regular-scala-class-with-default-values","content":" // Class WITHOUT default values (for serialization) class EmployeeV1(val name: String) // Class WITH default values (for deserialization) class EmployeeV2( val name: String, val age: Int = 30, val department: String = &quot;Engineering&quot; ) val fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .withScalaOptimizationEnabled(true) .build() ScalaSerializers.registerSerializers(fory) // Serialize using class without default values val original = new EmployeeV1(&quot;Jane&quot;) val serialized = fory.serialize(original) // Deserialize into class with default values val deserialized = fory.deserialize(serialized).asInstanceOf[EmployeeV2] // deserialized.name == &quot;Jane&quot; // deserialized.age == 30 (default) // deserialized.department == &quot;Engineering&quot; (default)   ","version":"0.14","tagName":"h3"},{"title":"Complex Default Values‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/0.14/guide/scala/default_values#complex-default-values","content":" Default values can be complex expressions:  // Class WITHOUT default values (for serialization) case class ConfigV1(name: String) // Class WITH default values (for deserialization) case class ConfigV2( name: String, settings: Map[String, String] = Map(&quot;default&quot; -&gt; &quot;value&quot;), tags: List[String] = List(&quot;default&quot;), enabled: Boolean = true ) val fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .withScalaOptimizationEnabled(true) .build() ScalaSerializers.registerSerializers(fory) val original = ConfigV1(&quot;myConfig&quot;) val serialized = fory.serialize(original) val deserialized = fory.deserialize(serialized).asInstanceOf[ConfigV2] // deserialized.name == &quot;myConfig&quot; // deserialized.settings == Map(&quot;default&quot; -&gt; &quot;value&quot;) // deserialized.tags == List(&quot;default&quot;) // deserialized.enabled == true   ","version":"0.14","tagName":"h3"},{"title":"Nested Case Classes‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/0.14/guide/scala/default_values#nested-case-classes","content":" object Models { // Class WITHOUT default values (for serialization) case class PersonV1(name: String) // Classes WITH default values (for deserialization) case class Address(street: String, city: String = &quot;DefaultCity&quot;) case class PersonV2(name: String, address: Address = Address(&quot;DefaultStreet&quot;)) } val fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .withScalaOptimizationEnabled(true) .build() ScalaSerializers.registerSerializers(fory) val original = Models.PersonV1(&quot;Alice&quot;) val serialized = fory.serialize(original) val deserialized = fory.deserialize(serialized).asInstanceOf[Models.PersonV2] // deserialized.name == &quot;Alice&quot; // deserialized.address == Address(&quot;DefaultStreet&quot;, &quot;DefaultCity&quot;)   ","version":"0.14","tagName":"h3"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/0.14/guide/scala/default_values#related-topics","content":" Schema Evolution - Forward/backward compatibility in JavaFory Creation - Setting up Fory with compatible mode ","version":"0.14","tagName":"h2"},{"title":"Fory Creation","type":0,"sectionRef":"#","url":"/docs/0.14/guide/scala/fory_creation","content":"","keywords":"","version":"0.14"},{"title":"Basic Setup‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/0.14/guide/scala/fory_creation#basic-setup","content":" When using Fory for Scala serialization, you must:  Enable Scala optimization via withScalaOptimizationEnabled(true)Register Scala serializers via ScalaSerializers.registerSerializers(fory)  import org.apache.fory.Fory import org.apache.fory.serializer.scala.ScalaSerializers val fory = Fory.builder() .withScalaOptimizationEnabled(true) .build() // Register optimized Fory serializers for Scala ScalaSerializers.registerSerializers(fory)   ","version":"0.14","tagName":"h2"},{"title":"Registering Scala Internal Types‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/0.14/guide/scala/fory_creation#registering-scala-internal-types","content":" Depending on the object types you serialize, you may need to register some Scala internal types:  fory.register(Class.forName(&quot;scala.Enumeration.Val&quot;))   To avoid such registration, you can disable class registration:  val fory = Fory.builder() .withScalaOptimizationEnabled(true) .requireClassRegistration(false) .build()   Note: Disabling class registration allows deserialization of unknown types. This is more flexible but may be insecure if the classes contain malicious code.  ","version":"0.14","tagName":"h2"},{"title":"Reference Tracking‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/0.14/guide/scala/fory_creation#reference-tracking","content":" Circular references are common in Scala. Reference tracking should be enabled with withRefTracking(true):  val fory = Fory.builder() .withScalaOptimizationEnabled(true) .withRefTracking(true) .build()   Note: If you don't enable reference tracking, StackOverflowError may occur for some Scala versions when serializing Scala Enumeration.  ","version":"0.14","tagName":"h2"},{"title":"Thread Safety‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/0.14/guide/scala/fory_creation#thread-safety","content":" Fory instance creation is not cheap. Instances should be shared between multiple serializations.  ","version":"0.14","tagName":"h2"},{"title":"Single-Thread Usage‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/0.14/guide/scala/fory_creation#single-thread-usage","content":" import org.apache.fory.Fory import org.apache.fory.serializer.scala.ScalaSerializers object ForyHolder { val fory: Fory = { val f = Fory.builder() .withScalaOptimizationEnabled(true) .build() ScalaSerializers.registerSerializers(f) f } }   ","version":"0.14","tagName":"h3"},{"title":"Multi-Thread Usage‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/0.14/guide/scala/fory_creation#multi-thread-usage","content":" For multi-threaded applications, use ThreadSafeFory:  import org.apache.fory.ThreadSafeFory import org.apache.fory.ThreadLocalFory import org.apache.fory.serializer.scala.ScalaSerializers object ForyHolder { val fory: ThreadSafeFory = new ThreadLocalFory(classLoader =&gt; { val f = Fory.builder() .withScalaOptimizationEnabled(true) .withClassLoader(classLoader) .build() ScalaSerializers.registerSerializers(f) f }) }   ","version":"0.14","tagName":"h3"},{"title":"Configuration Options‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/0.14/guide/scala/fory_creation#configuration-options","content":" All configuration options from Fory Java are available. See Java Configuration Options for the complete list.  Common options for Scala:  import org.apache.fory.Fory import org.apache.fory.config.CompatibleMode import org.apache.fory.serializer.scala.ScalaSerializers val fory = Fory.builder() .withScalaOptimizationEnabled(true) // Enable reference tracking for circular references .withRefTracking(true) // Enable schema evolution support .withCompatibleMode(CompatibleMode.COMPATIBLE) // Enable async compilation for better startup performance .withAsyncCompilation(true) .build() ScalaSerializers.registerSerializers(fory)  ","version":"0.14","tagName":"h2"},{"title":"Type Serialization","type":0,"sectionRef":"#","url":"/docs/0.14/guide/scala/type_serialization","content":"","keywords":"","version":"0.14"},{"title":"Setup‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/scala/type_serialization#setup","content":" All examples assume the following setup:  import org.apache.fory.Fory import org.apache.fory.serializer.scala.ScalaSerializers val fory = Fory.builder() .withScalaOptimizationEnabled(true) .build() ScalaSerializers.registerSerializers(fory)   ","version":"0.14","tagName":"h2"},{"title":"Case Class‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/scala/type_serialization#case-class","content":" case class Person(github: String, age: Int, id: Long) fory.register(classOf[Person]) val p = Person(&quot;https://github.com/chaokunyang&quot;, 18, 1) println(fory.deserialize(fory.serialize(p)))   ","version":"0.14","tagName":"h2"},{"title":"POJO Class‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/scala/type_serialization#pojo-class","content":" class Foo(f1: Int, f2: String) { override def toString: String = s&quot;Foo($f1, $f2)&quot; } fory.register(classOf[Foo]) println(fory.deserialize(fory.serialize(new Foo(1, &quot;chaokunyang&quot;))))   ","version":"0.14","tagName":"h2"},{"title":"Object Singleton‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/scala/type_serialization#object-singleton","content":" Scala object singletons are serialized and deserialized to the same instance:  object MySingleton { val value = 42 } fory.register(MySingleton.getClass) val o1 = fory.deserialize(fory.serialize(MySingleton)) val o2 = fory.deserialize(fory.serialize(MySingleton)) println(o1 == o2) // true   ","version":"0.14","tagName":"h2"},{"title":"Collection‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/scala/type_serialization#collection","content":" Scala collections are fully supported:  val seq = Seq(1, 2) val list = List(&quot;a&quot;, &quot;b&quot;) val map = Map(&quot;a&quot; -&gt; 1, &quot;b&quot; -&gt; 2) println(fory.deserialize(fory.serialize(seq))) println(fory.deserialize(fory.serialize(list))) println(fory.deserialize(fory.serialize(map)))   ","version":"0.14","tagName":"h2"},{"title":"Tuple‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/scala/type_serialization#tuple","content":" All Scala tuple types (Tuple1 through Tuple22) are supported:  val tuple2 = (100, 10000L) println(fory.deserialize(fory.serialize(tuple2))) val tuple4 = (100, 10000L, 10000L, &quot;str&quot;) println(fory.deserialize(fory.serialize(tuple4)))   ","version":"0.14","tagName":"h2"},{"title":"Enum‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/scala/type_serialization#enum","content":" ","version":"0.14","tagName":"h2"},{"title":"Scala 3 Enum‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/scala/type_serialization#scala-3-enum","content":" enum Color { case Red, Green, Blue } fory.register(classOf[Color]) println(fory.deserialize(fory.serialize(Color.Green)))   ","version":"0.14","tagName":"h3"},{"title":"Scala 2 Enumeration‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/scala/type_serialization#scala-2-enumeration","content":" object ColorEnum extends Enumeration { type ColorEnum = Value val Red, Green, Blue = Value } fory.register(Class.forName(&quot;scala.Enumeration.Val&quot;)) println(fory.deserialize(fory.serialize(ColorEnum.Green)))   Note: For Scala 2 Enumeration, you may need to register scala.Enumeration.Val or enable reference tracking to avoid StackOverflowError.  ","version":"0.14","tagName":"h3"},{"title":"Option‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/scala/type_serialization#option","content":" val some: Option[Long] = Some(100) println(fory.deserialize(fory.serialize(some))) val none: Option[Long] = None println(fory.deserialize(fory.serialize(none)))   ","version":"0.14","tagName":"h2"},{"title":"Either‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/scala/type_serialization#either","content":" val right: Either[String, Int] = Right(42) println(fory.deserialize(fory.serialize(right))) val left: Either[String, Int] = Left(&quot;error&quot;) println(fory.deserialize(fory.serialize(left)))   ","version":"0.14","tagName":"h2"},{"title":"Nested Types‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/0.14/guide/scala/type_serialization#nested-types","content":" Complex nested structures are fully supported:  case class Address(street: String, city: String) case class Company(name: String, address: Address) case class Employee(name: String, company: Company, tags: List[String]) fory.register(classOf[Address]) fory.register(classOf[Company]) fory.register(classOf[Employee]) val employee = Employee( &quot;John&quot;, Company(&quot;Acme&quot;, Address(&quot;123 Main St&quot;, &quot;Springfield&quot;)), List(&quot;developer&quot;, &quot;scala&quot;) ) println(fory.deserialize(fory.serialize(employee)))  ","version":"0.14","tagName":"h2"},{"title":"Row Format","type":0,"sectionRef":"#","url":"/docs/0.14/guide/xlang/row_format","content":"","keywords":"","version":"0.14"},{"title":"Features‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/xlang/row_format#features","content":" Zero-Copy Random Access: Read specific fields directly from binary dataPartial Serialization: Skip unnecessary fields during serializationCross-Language Compatible: Row format data can be shared between Java, Python, and C++Apache Arrow Integration: Convert row format to/from Arrow RecordBatch for analytics (Java/Python)  ","version":"0.14","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/xlang/row_format#java","content":" public class Bar { String f1; List&lt;Long&gt; f2; } public class Foo { int f1; List&lt;Integer&gt; f2; Map&lt;String, Integer&gt; f3; List&lt;Bar&gt; f4; } RowEncoder&lt;Foo&gt; encoder = Encoders.bean(Foo.class); Foo foo = new Foo(); foo.f1 = 10; foo.f2 = IntStream.range(0, 1000000).boxed().collect(Collectors.toList()); foo.f3 = IntStream.range(0, 1000000).boxed().collect(Collectors.toMap(i -&gt; &quot;k&quot;+i, i-&gt;i)); List&lt;Bar&gt; bars = new ArrayList&lt;&gt;(1000000); for (int i = 0; i &lt; 1000000; i++) { Bar bar = new Bar(); bar.f1 = &quot;s&quot;+i; bar.f2 = LongStream.range(0, 10).boxed().collect(Collectors.toList()); bars.add(bar); } foo.f4 = bars; // Can be zero-copy read by Python BinaryRow binaryRow = encoder.toRow(foo); // Can be data from Python Foo newFoo = encoder.fromRow(binaryRow); // Zero-copy read List&lt;Integer&gt; f2 BinaryArray binaryArray2 = binaryRow.getArray(1); // Zero-copy read List&lt;Bar&gt; f4 BinaryArray binaryArray4 = binaryRow.getArray(3); // Zero-copy read 11th element of List&lt;Bar&gt; f4 BinaryRow barStruct = binaryArray4.getStruct(10); // Zero-copy read 6th element of f2 of 11th element of List&lt;Bar&gt; f4 barStruct.getArray(1).getInt64(5); RowEncoder&lt;Bar&gt; barEncoder = Encoders.bean(Bar.class); // Deserialize part of data Bar newBar = barEncoder.fromRow(barStruct); Bar newBar2 = barEncoder.fromRow(binaryArray4.getStruct(20));   ","version":"0.14","tagName":"h2"},{"title":"Python‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/xlang/row_format#python","content":" @dataclass class Bar: f1: str f2: List[pa.int64] @dataclass class Foo: f1: pa.int32 f2: List[pa.int32] f3: Dict[str, pa.int32] f4: List[Bar] encoder = pyfory.encoder(Foo) foo = Foo(f1=10, f2=list(range(1000_000)), f3={f&quot;k{i}&quot;: i for i in range(1000_000)}, f4=[Bar(f1=f&quot;s{i}&quot;, f2=list(range(10))) for i in range(1000_000)]) binary: bytes = encoder.to_row(foo).to_bytes() print(f&quot;start: {datetime.datetime.now()}&quot;) foo_row = pyfory.RowData(encoder.schema, binary) print(foo_row.f2[100000], foo_row.f4[100000].f1, foo_row.f4[200000].f2[5]) print(f&quot;end: {datetime.datetime.now()}&quot;) binary = pickle.dumps(foo) print(f&quot;pickle start: {datetime.datetime.now()}&quot;) new_foo = pickle.loads(binary) print(new_foo.f2[100000], new_foo.f4[100000].f1, new_foo.f4[200000].f2[5]) print(f&quot;pickle end: {datetime.datetime.now()}&quot;)   ","version":"0.14","tagName":"h2"},{"title":"Apache Arrow Support‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/xlang/row_format#apache-arrow-support","content":" Fory Row Format supports automatic conversion from/to Arrow Table/RecordBatch for analytics workloads.  ","version":"0.14","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/xlang/row_format#java-1","content":" Schema schema = TypeInference.inferSchema(BeanA.class); ArrowWriter arrowWriter = ArrowUtils.createArrowWriter(schema); Encoder&lt;BeanA&gt; encoder = Encoders.rowEncoder(BeanA.class); for (int i = 0; i &lt; 10; i++) { BeanA beanA = BeanA.createBeanA(2); arrowWriter.write(encoder.toRow(beanA)); } return arrowWriter.finishAsRecordBatch();   ","version":"0.14","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/xlang/row_format#python-1","content":" import pyfory encoder = pyfory.encoder(Foo) encoder.to_arrow_record_batch([foo] * 10000) encoder.to_arrow_table([foo] * 10000)   ","version":"0.14","tagName":"h3"},{"title":"Support for Interface and Extension Types‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/xlang/row_format#support-for-interface-and-extension-types","content":" Fory supports row format mapping for Java interface types and subclassed (extends) types, enabling more dynamic and flexible data schemas.  These enhancements were introduced in #2243, #2250, and #2256.  ","version":"0.14","tagName":"h2"},{"title":"Example: Interface Mapping with RowEncoder‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/xlang/row_format#example-interface-mapping-with-rowencoder","content":" public interface Animal { String speak(); } public class Dog implements Animal { public String name; @Override public String speak() { return &quot;Woof&quot;; } } // Encode and decode using RowEncoder with interface type RowEncoder&lt;Animal&gt; encoder = Encoders.bean(Animal.class); Dog dog = new Dog(); dog.name = &quot;Bingo&quot;; BinaryRow row = encoder.toRow(dog); Animal decoded = encoder.fromRow(row); System.out.println(decoded.speak()); // Woof   ","version":"0.14","tagName":"h3"},{"title":"Example: Extension Type with RowEncoder‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/xlang/row_format#example-extension-type-with-rowencoder","content":" public class Parent { public String parentField; } public class Child extends Parent { public String childField; } // Encode and decode using RowEncoder with parent class type RowEncoder&lt;Parent&gt; encoder = Encoders.bean(Parent.class); Child child = new Child(); child.parentField = &quot;Hello&quot;; child.childField = &quot;World&quot;; BinaryRow row = encoder.toRow(child); Parent decoded = encoder.fromRow(row);   ","version":"0.14","tagName":"h3"},{"title":"See Also‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/guide/xlang/row_format#see-also","content":" Row Format Specification - Binary format detailsJava Row Format Guide - Java-specific row format documentationPython Row Format Guide - Python-specific row format documentation ","version":"0.14","tagName":"h2"},{"title":"Troubleshooting","type":0,"sectionRef":"#","url":"/docs/0.14/guide/xlang/xlang_troubleshooting","content":"","keywords":"","version":"0.14"},{"title":"Type Registration Errors‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/xlang/xlang_troubleshooting#type-registration-errors","content":" ","version":"0.14","tagName":"h2"},{"title":"\"Type not registered\" Error‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/xlang/xlang_troubleshooting#type-not-registered-error","content":" Symptom:  Error: Type 'example.Person' is not registered   Cause: The type was not registered before deserialization, or the type name doesn't match.  Solution:  Ensure the type is registered with the same name on both sides: // Java fory.register(Person.class, &quot;example.Person&quot;); # Python fory.register_type(Person, typename=&quot;example.Person&quot;) Check for typos or case differences in type names Register types before any serialization/deserialization calls  ","version":"0.14","tagName":"h3"},{"title":"\"Type ID mismatch\" Error‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/xlang/xlang_troubleshooting#type-id-mismatch-error","content":" Symptom:  Error: Expected type ID 100, got 101   Cause: Different type IDs used across languages.  Solution: Use consistent type IDs:  // Java fory.register(Person.class, 100); fory.register(Address.class, 101);   # Python fory.register_type(Person, type_id=100) fory.register_type(Address, type_id=101)   ","version":"0.14","tagName":"h3"},{"title":"Type Mapping Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/xlang/xlang_troubleshooting#type-mapping-issues","content":" ","version":"0.14","tagName":"h2"},{"title":"Integer Overflow‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/xlang/xlang_troubleshooting#integer-overflow","content":" Symptom: Values are truncated or wrapped unexpectedly.  Cause: Using different integer sizes across languages.  Solution:  In Python, use explicit type annotations: @dataclass class Data: value: pyfory.Int32Type # Not just 'int' Ensure integer ranges are compatible: int8: -128 to 127int16: -32,768 to 32,767int32: -2,147,483,648 to 2,147,483,647  ","version":"0.14","tagName":"h3"},{"title":"Float Precision Loss‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/xlang/xlang_troubleshooting#float-precision-loss","content":" Symptom: Float values have unexpected precision.  Cause: Mixing float32 and float64 types.  Solution:  Use consistent float types: @dataclass class Data: value: pyfory.Float32Type # Explicit 32-bit float Be aware that Python's float maps to float64 by default  ","version":"0.14","tagName":"h3"},{"title":"String Encoding Errors‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/xlang/xlang_troubleshooting#string-encoding-errors","content":" Symptom:  Error: Invalid UTF-8 sequence   Cause: Non-UTF-8 encoded strings.  Solution:  Ensure all strings are valid UTF-8 In Python, decode bytes before serialization: text = raw_bytes.decode('utf-8')   ","version":"0.14","tagName":"h3"},{"title":"Field Order Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/xlang/xlang_troubleshooting#field-order-issues","content":" ","version":"0.14","tagName":"h2"},{"title":"\"Field mismatch\" Error‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/xlang/xlang_troubleshooting#field-mismatch-error","content":" Symptom: Deserialized objects have wrong field values.  Cause: Field order differs between languages.  Solution: Fory sorts fields by their snake_cased names. Ensure field names are consistent:  // Java - fields will be sorted: age, email, name public class Person { public String name; public int age; public String email; }   # Python - same field order @dataclass class Person: name: str age: pyfory.Int32Type email: str   ","version":"0.14","tagName":"h3"},{"title":"Reference Tracking Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/xlang/xlang_troubleshooting#reference-tracking-issues","content":" ","version":"0.14","tagName":"h2"},{"title":"Stack Overflow with Circular References‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/xlang/xlang_troubleshooting#stack-overflow-with-circular-references","content":" Symptom:  StackOverflowError or RecursionError   Cause: Reference tracking is disabled but data has circular references.  Solution: Enable reference tracking:  // Java Fory fory = Fory.builder() .withLanguage(Language.XLANG) .withRefTracking(true) .build();   # Python fory = pyfory.Fory(ref_tracking=True)   ","version":"0.14","tagName":"h3"},{"title":"Duplicate Objects‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/xlang/xlang_troubleshooting#duplicate-objects","content":" Symptom: Shared objects are duplicated after deserialization.  Cause: Reference tracking is disabled.  Solution: Enable reference tracking if objects are shared within the graph.  ","version":"0.14","tagName":"h3"},{"title":"Language Mode Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/xlang/xlang_troubleshooting#language-mode-issues","content":" ","version":"0.14","tagName":"h2"},{"title":"\"Invalid magic number\" Error‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/xlang/xlang_troubleshooting#invalid-magic-number-error","content":" Symptom:  Error: Invalid magic number in header   Cause: One side is using Java-native mode instead of xlang mode.  Solution: Ensure both sides use xlang mode:  // Java - must use Language.XLANG Fory fory = Fory.builder() .withLanguage(Language.XLANG) .build();   ","version":"0.14","tagName":"h3"},{"title":"Incompatible Types in Xlang Mode‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/xlang/xlang_troubleshooting#incompatible-types-in-xlang-mode","content":" Symptom:  Error: Type 'Optional' is not supported in xlang mode   Cause: Using Java-specific types that don't have cross-language equivalents.  Solution: Use compatible types:  // Instead of Optional&lt;String&gt; public String email; // nullable // Instead of BigDecimal public double amount; // Instead of EnumSet&lt;Status&gt; public Set&lt;Status&gt; statuses;   ","version":"0.14","tagName":"h3"},{"title":"Version Compatibility‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/xlang/xlang_troubleshooting#version-compatibility","content":" ","version":"0.14","tagName":"h2"},{"title":"Serialization Format Changed‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/xlang/xlang_troubleshooting#serialization-format-changed","content":" Symptom: Deserialization fails after upgrading Fory.  Cause: Breaking changes in serialization format.  Solution:  Ensure all services use compatible Fory versionsCheck release notes for breaking changesConsider using schema evolution (compatible mode) for gradual upgrades  ","version":"0.14","tagName":"h3"},{"title":"Debugging Tips‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/xlang/xlang_troubleshooting#debugging-tips","content":" ","version":"0.14","tagName":"h2"},{"title":"Enable Debug Logging‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/xlang/xlang_troubleshooting#enable-debug-logging","content":" Java:  // Add to JVM options -Dfory.debug=true   Python:  import logging logging.getLogger('pyfory').setLevel(logging.DEBUG)   ","version":"0.14","tagName":"h3"},{"title":"Inspect Serialized Data‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/xlang/xlang_troubleshooting#inspect-serialized-data","content":" Use hex dump to inspect the binary format:  data = fory.serialize(obj) print(data.hex())   ","version":"0.14","tagName":"h3"},{"title":"Test Round-Trip‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/xlang/xlang_troubleshooting#test-round-trip","content":" Always test round-trip serialization in each language:  byte[] bytes = fory.serialize(obj); Object result = fory.deserialize(bytes); assert obj.equals(result);   ","version":"0.14","tagName":"h3"},{"title":"Cross-Language Testing‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/xlang/xlang_troubleshooting#cross-language-testing","content":" Test serialization across all target languages before deployment:  # Serialize in Java java -jar serializer.jar &gt; data.bin # Deserialize in Python python deserializer.py data.bin   ","version":"0.14","tagName":"h3"},{"title":"Common Mistakes‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/xlang/xlang_troubleshooting#common-mistakes","content":" Not registering types: Always register custom types before useInconsistent type names/IDs: Use the same names/IDs across all languagesForgetting xlang mode: Use Language.XLANG in JavaWrong type annotations: Use pyfory.Int32Type etc. in PythonIgnoring reference tracking: Enable for circular/shared references  ","version":"0.14","tagName":"h2"},{"title":"See Also‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/0.14/guide/xlang/xlang_troubleshooting#see-also","content":" Type Mapping - Cross-language type mapping referenceGetting Started - Setup guideJava Troubleshooting - Java-specific issuesPython Troubleshooting - Python-specific issues ","version":"0.14","tagName":"h2"},{"title":"Getting Started","type":0,"sectionRef":"#","url":"/docs/0.14/guide/xlang/xlang_getting_started","content":"","keywords":"","version":"0.14"},{"title":"Installation‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/0.14/guide/xlang/xlang_getting_started#installation","content":" ","version":"0.14","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/0.14/guide/xlang/xlang_getting_started#java","content":" Maven:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-core&lt;/artifactId&gt; &lt;version&gt;0.14.1&lt;/version&gt; &lt;/dependency&gt;   Gradle:  implementation 'org.apache.fory:fory-core:0.14.1'   ","version":"0.14","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/0.14/guide/xlang/xlang_getting_started#python","content":" pip install pyfory   ","version":"0.14","tagName":"h3"},{"title":"Go‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/0.14/guide/xlang/xlang_getting_started#go","content":" go get github.com/apache/fory/go/fory   ","version":"0.14","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/0.14/guide/xlang/xlang_getting_started#rust","content":" [dependencies] fory = &quot;0.14&quot;   ","version":"0.14","tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/0.14/guide/xlang/xlang_getting_started#javascript","content":" npm install @apache-fory/fory   ","version":"0.14","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/0.14/guide/xlang/xlang_getting_started#c","content":" Use Bazel or CMake to build from source. See C++ Guide for details.  ","version":"0.14","tagName":"h3"},{"title":"Enable Cross-Language Mode‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/0.14/guide/xlang/xlang_getting_started#enable-cross-language-mode","content":" Each language requires enabling xlang mode to ensure binary compatibility across languages.  ","version":"0.14","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/0.14/guide/xlang/xlang_getting_started#java-1","content":" import org.apache.fory.*; import org.apache.fory.config.*; Fory fory = Fory.builder() .withLanguage(Language.XLANG) // Enable cross-language mode .withRefTracking(true) // Optional: for circular references .build();   ","version":"0.14","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/0.14/guide/xlang/xlang_getting_started#python-1","content":" import pyfory # xlang mode is enabled by default fory = pyfory.Fory() # Explicit configuration fory = pyfory.Fory(ref_tracking=True)   ","version":"0.14","tagName":"h3"},{"title":"Go‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/0.14/guide/xlang/xlang_getting_started#go-1","content":" import forygo &quot;github.com/apache/fory/go/fory&quot; fory := forygo.NewFory() // Or with reference tracking fory := forygo.NewFory(true)   ","version":"0.14","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/0.14/guide/xlang/xlang_getting_started#rust-1","content":" use fory::Fory; let fory = Fory::default();   ","version":"0.14","tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/0.14/guide/xlang/xlang_getting_started#javascript-1","content":" import Fory from &quot;@apache-fory/fory&quot;; const fory = new Fory();   ","version":"0.14","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/0.14/guide/xlang/xlang_getting_started#c-1","content":" #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; auto fory = Fory::builder() .xlang(true) .build();   ","version":"0.14","tagName":"h3"},{"title":"Type Registration‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/0.14/guide/xlang/xlang_getting_started#type-registration","content":" Custom types must be registered with consistent names or IDs across all languages.  ","version":"0.14","tagName":"h2"},{"title":"Register by Name (Recommended)‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/0.14/guide/xlang/xlang_getting_started#register-by-name-recommended","content":" Using string names is more flexible and less prone to conflicts:  Java:  fory.register(Person.class, &quot;example.Person&quot;);   Python:  fory.register_type(Person, typename=&quot;example.Person&quot;)   Go:  fory.RegisterNamedType(Person{}, &quot;example.Person&quot;)   Rust:  #[derive(Fory)] #[tag(&quot;example.Person&quot;)] struct Person { name: String, age: i32, }   JavaScript:  const description = Type.object(&quot;example.Person&quot;, { name: Type.string(), age: Type.int32(), }); fory.registerSerializer(description);   C++:  fory.register_struct&lt;Person&gt;(&quot;example.Person&quot;); // For enums, use register_enum: // fory.register_enum&lt;Color&gt;(&quot;example.Color&quot;);   ","version":"0.14","tagName":"h3"},{"title":"Register by ID‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/0.14/guide/xlang/xlang_getting_started#register-by-id","content":" Using numeric IDs is faster and produces smaller binary output:  Java:  fory.register(Person.class, 100);   Python:  fory.register_type(Person, type_id=100)   Go:  fory.Register(Person{}, 100)   C++:  fory.register_struct&lt;Person&gt;(100); // For enums, use register_enum: // fory.register_enum&lt;Color&gt;(101);   ","version":"0.14","tagName":"h3"},{"title":"Hello World Example‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/0.14/guide/xlang/xlang_getting_started#hello-world-example","content":" A complete example showing serialization in Java and deserialization in Python:  ","version":"0.14","tagName":"h2"},{"title":"Java (Serializer)‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/0.14/guide/xlang/xlang_getting_started#java-serializer","content":" import org.apache.fory.*; import org.apache.fory.config.*; import java.nio.file.*; public class Person { public String name; public int age; } public class HelloWorld { public static void main(String[] args) throws Exception { Fory fory = Fory.builder() .withLanguage(Language.XLANG) .build(); fory.register(Person.class, &quot;example.Person&quot;); Person person = new Person(); person.name = &quot;Alice&quot;; person.age = 30; byte[] bytes = fory.serialize(person); Files.write(Path.of(&quot;person.bin&quot;), bytes); System.out.println(&quot;Serialized to person.bin&quot;); } }   ","version":"0.14","tagName":"h3"},{"title":"Python (Deserializer)‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/0.14/guide/xlang/xlang_getting_started#python-deserializer","content":" import pyfory from dataclasses import dataclass @dataclass class Person: name: str age: pyfory.Int32Type fory = pyfory.Fory() fory.register_type(Person, typename=&quot;example.Person&quot;) with open(&quot;person.bin&quot;, &quot;rb&quot;) as f: data = f.read() person = fory.deserialize(data) print(f&quot;Name: {person.name}, Age: {person.age}&quot;) # Output: Name: Alice, Age: 30   ","version":"0.14","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/0.14/guide/xlang/xlang_getting_started#best-practices","content":" Use consistent type names: Ensure all languages use the same type name or IDEnable reference tracking: If your data has circular or shared referencesReuse Fory instances: Creating Fory is expensive; reuse instancesUse type annotations: In Python, use pyfory.Int32Type etc. for precise type mappingTest cross-language: Verify serialization works across all target languages  ","version":"0.14","tagName":"h2"},{"title":"Next Steps‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/0.14/guide/xlang/xlang_getting_started#next-steps","content":" Type Mapping - Cross-language type mapping referenceSerialization - Detailed serialization examplesTroubleshooting - Common issues and solutions ","version":"0.14","tagName":"h2"},{"title":"Benchmark","type":0,"sectionRef":"#","url":"/docs/0.14/introduction/benchmark","content":"","keywords":"","version":"0.14"},{"title":"Java Benchmark‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/0.14/introduction/benchmark#java-benchmark","content":" The following benchmarks compare Fory against popular Java serialization frameworks. Charts labeled &quot;compatible&quot; show schema evolution mode with forward/backward compatibility enabled, while others show schema consistent mode where class schemas must match.  Test Classes:  Struct: Class with 100 primitive fieldsMediaContent: Class from jvm-serializersSample: Class from Kryo benchmark  ","version":"0.14","tagName":"h2"},{"title":"Java Serialization‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/0.14/introduction/benchmark#java-serialization","content":"         ","version":"0.14","tagName":"h3"},{"title":"Java Deserialization‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/0.14/introduction/benchmark#java-deserialization","content":"         Important: Fory's runtime code generation requires proper warm-up for performance measurement:  For additional benchmarks covering type forward/backward compatibility, off-heap support, and zero-copy serialization, see Java Benchmarks.  ","version":"0.14","tagName":"h3"},{"title":"Rust Benchmark‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/0.14/introduction/benchmark#rust-benchmark","content":" Fory Rust demonstrates competitive performance compared to other Rust serialization frameworks.        Note: Results depend on hardware, dataset, and implementation versions. See the Rust guide for how to run benchmarks yourself: https://github.com/apache/fory/blob/main/benchmarks/rust_benchmark/README.md  ","version":"0.14","tagName":"h2"},{"title":"C++ Benchmark‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/0.14/introduction/benchmark#c-benchmark","content":" Fory C++ demonstrates competitive performance compared to Protobuf C++ serialization framework.    ","version":"0.14","tagName":"h2"},{"title":"JavaScript Benchmark‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/0.14/introduction/benchmark#javascript-benchmark","content":"   The data used for this bar graph includes a complex object that has many kinds of field types, and the size of the JSON data is 3KB.  See benchmarks for the benchmark code. ","version":"0.14","tagName":"h2"},{"title":"Features","type":0,"sectionRef":"#","url":"/docs/0.14/introduction/features","content":"","keywords":"","version":"0.14"},{"title":"Core Capabilities‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#core-capabilities","content":" ","version":"0.14","tagName":"h2"},{"title":"üöÄ High-Performance Serialization‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#-high-performance-serialization","content":" Apache Fory‚Ñ¢ delivers exceptional performance through advanced optimization techniques:  JIT Compilation: Runtime code generation for Java eliminates virtual method calls and inlines hot pathsStatic Code Generation: Compile-time code generation for Rust, C++, and Go delivers peak performance without runtime overheadZero-Copy Operations: Direct memory access without intermediate buffer copies; row format enables random access and partial serializationIntelligent Encoding: Variable-length compression for integers and strings; SIMD acceleration for arrays (Java 16+)Meta Sharing: Class metadata packing reduces redundant type information across serializations  ","version":"0.14","tagName":"h3"},{"title":"üåç Cross-Language Serialization‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#-cross-language-serialization","content":" The xlang serialization format enables seamless data exchange across programming languages:  Automatic Type Mapping: Intelligent conversion between language-specific types (type mapping)Reference Preservation: Shared and circular references work correctly across languagesPolymorphism: Objects serialize/deserialize with their actual runtime typesSchema Evolution: Optional forward/backward compatibility for evolving schemasAutomatic Serialization: No IDL or schema definitions required; serialize any object directly without code generation  ","version":"0.14","tagName":"h3"},{"title":"üìä Row Format‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#-row-format","content":" A cache-friendly row format optimized for analytics workloads:  Zero-Copy Random Access: Read individual fields without deserializing entire objectsPartial Operations: Selective field serialization and deserialization for efficiencyApache Arrow Integration: Seamless conversion to columnar format for analytics pipelinesMulti-Language: Available in Java, Python, Rust and C++  ","version":"0.14","tagName":"h3"},{"title":"üîí Security & Production-Readiness‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#-security--production-readiness","content":" Enterprise-grade security and compatibility:  Class Registration: Whitelist-based deserialization control (enabled by default)Depth Limiting: Protection against recursive object graph attacksConfigurable Policies: Custom class checkers and deserialization policiesPlatform Support: Java 8-24, GraalVM native image, multiple OS platforms  ","version":"0.14","tagName":"h3"},{"title":"Java Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#java-features","content":" ","version":"0.14","tagName":"h2"},{"title":"üöÄ High Performance‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#-high-performance","content":" JIT Code Generation: Highly-extensible JIT framework generates serializer code at runtime using async multi-threaded compilation, delivering 20-170x speedup through: Inlining variables to reduce memory accessInlining method calls to eliminate virtual dispatch overheadMinimizing conditional branchingEliminating hash lookups Zero-Copy: Direct memory access without intermediate buffer copies; row format supports random access and partial serializationVariable-Length Encoding: Optimized compression for integers, longsMeta Sharing: Cached class metadata reduces redundant type informationSIMD Acceleration: Java Vector API support for array operations (Java 16+)  ","version":"0.14","tagName":"h3"},{"title":"üîß Drop-in Replacement‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#-drop-in-replacement","content":" 100% JDK Serialization Compatible: Supports writeObject/readObject/writeReplace/readResolve/readObjectNoData/ExternalizableJava 8-24 Support: Works across all modern Java versions including Java 17+ recordsGraalVM Native Image: AOT compilation support without reflection configuration  ","version":"0.14","tagName":"h3"},{"title":"üîÑ Advanced Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#-advanced-features","content":" Reference Tracking: Automatic handling of shared and circular referencesSchema Evolution: Forward/backward compatibility for class schema changesPolymorphism: Full support for inheritance hierarchies and interfacesDeep Copy: Efficient deep cloning of complex object graphs with reference preservationSecurity: Class registration and configurable deserialization policies  ","version":"0.14","tagName":"h3"},{"title":"Python Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#python-features","content":" ","version":"0.14","tagName":"h2"},{"title":"üîß Flexible Serialization Modes‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#-flexible-serialization-modes","content":" Python native Mode: Full Python compatibility, drop-in replacement for pickle/cloudpickleCross-Language Mode: Optimized for multi-language data exchangeRow Format: Zero-copy row format for analytics workloads  ","version":"0.14","tagName":"h3"},{"title":"üéØ Versatile Serialization Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#-versatile-serialization-features","content":" Shared/circular reference support for complex object graphs in both Python-native and cross-language modesPolymorphism support for customized types with automatic type dispatchingSchema evolution support for backward/forward compatibility when using dataclasses in cross-language modeOut-of-band buffer support for zero-copy serialization of large data structures like NumPy arrays and Pandas DataFrames, compatible with pickle protocol 5  ","version":"0.14","tagName":"h3"},{"title":"‚ö° Blazing Fast Performance‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#-blazing-fast-performance","content":" Extremely fast performance compared to other serialization frameworksRuntime code generation and Cython-accelerated core implementation for optimal performance  ","version":"0.14","tagName":"h3"},{"title":"üì¶ Compact Data Size‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#-compact-data-size","content":" Compact object graph protocol with minimal space overhead‚Äîup to 3√ó size reduction compared to pickle/cloudpickleMeta packing and sharing to minimize type forward/backward compatibility space overhead  ","version":"0.14","tagName":"h3"},{"title":"üõ°Ô∏è Security & Safety‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#Ô∏è-security--safety","content":" Strict mode prevents deserialization of untrusted types by type registration and checks.Reference tracking for handling circular references safely  ","version":"0.14","tagName":"h3"},{"title":"Rust Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#rust-features","content":" ","version":"0.14","tagName":"h2"},{"title":"üöÄ Why Apache Fory‚Ñ¢ Rust?‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#-why-apache-fory-rust","content":" üî• Blazingly Fast: Zero-copy deserialization and optimized binary protocolsüåç Cross-Language: Seamlessly serialize/deserialize data across Java, Python, C++, Go, JavaScript, and RustüéØ Type-Safe: Compile-time type checking with derive macrosüîÑ Circular References: Automatic tracking of shared and circular references with Rc/Arc and weak pointersüß¨ Polymorphic: Serialize trait objects with Box&lt;dyn Trait&gt;, Rc&lt;dyn Trait&gt;, and Arc&lt;dyn Trait&gt;üì¶ Schema Evolution: Compatible mode for independent schema changes‚ö° Two Modes: Object graph serialization and zero-copy row-based format  ","version":"0.14","tagName":"h3"},{"title":"Object Graph Serialization‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#object-graph-serialization","content":" Automatic serialization of complex object graphs, preserving the structure and relationships between objects. The #[derive(ForyObject)] macro generates efficient serialization code at compile time, eliminating runtime overhead:  Nested struct serialization with arbitrary depthCollection types (Vec, HashMap, HashSet, BTreeMap)Enum type supportOptional fields with Option&lt;T&gt;Automatic handling of primitive types and stringsEfficient binary encoding with variable-length integers  ","version":"0.14","tagName":"h3"},{"title":"Shared and Circular References‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#shared-and-circular-references","content":" Automatically tracks and preserves reference identity for shared objects using Rc&lt;T&gt; and Arc&lt;T&gt;. When the same object is referenced multiple times, Fory serializes it only once and uses reference IDs for subsequent occurrences. This ensures:  Space efficiency: No data duplication in serialized outputReference identity preservation: Deserialized objects maintain the same sharing relationshipsCircular reference support: Use RcWeak&lt;T&gt; and ArcWeak&lt;T&gt; to break cycles  ","version":"0.14","tagName":"h3"},{"title":"Trait Object Serialization‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#trait-object-serialization","content":" Polymorphic serialization through trait objects, enabling dynamic dispatch and type flexibility. This is essential for plugin systems, heterogeneous collections, and extensible architectures. Supported trait object types:  Box&lt;dyn Trait&gt; - Owned trait objectsRc&lt;dyn Trait&gt; - Reference-counted trait objectsArc&lt;dyn Trait&gt; - Thread-safe reference-counted trait objectsVec&lt;Box&lt;dyn Trait&gt;&gt;, HashMap&lt;K, Box&lt;dyn Trait&gt;&gt; - Collections of trait objects  ","version":"0.14","tagName":"h3"},{"title":"Schema Evolution‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#schema-evolution","content":" Schema evolution in Compatible mode, allowing serialization and deserialization peers to have different type definitions. This enables independent evolution of services in distributed systems without breaking compatibility:  Add new fields with default valuesRemove obsolete fields (skipped during deserialization)Change field nullability (T ‚Üî Option&lt;T&gt;)Reorder fields (matched by name, not position)Type-safe fallback to default values for missing fields  ","version":"0.14","tagName":"h3"},{"title":"Custom Serializers‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#custom-serializers","content":" For types that don't support #[derive(ForyObject)], implement the Serializer trait manually. This is useful for:  External types from other cratesTypes with special serialization requirementsLegacy data format compatibilityPerformance-critical custom encoding  ","version":"0.14","tagName":"h3"},{"title":"Row-Based Serialization‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#row-based-serialization","content":" High-performance row format for zero-copy deserialization. Unlike traditional object serialization that reconstructs entire objects in memory, row format enables random access to fields directly from binary data without full deserialization.  Zero-copy access: Read fields without allocating or copying dataPartial deserialization: Access only the fields you needMemory-mapped files: Work with data larger than RAMCache-friendly: Sequential memory layout for better CPU cache utilizationLazy evaluation: Defer expensive operations until field access  ","version":"0.14","tagName":"h3"},{"title":"Scala Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#scala-features","content":" ","version":"0.14","tagName":"h2"},{"title":"Supported Types‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#supported-types","content":" Apache Fory‚Ñ¢ supports all scala object serialization:  case class serialization supportedpojo/bean class serialization supportedobject singleton serialization supportedcollection serialization supportedother types such as tuple/either and basic types are all supported too.  Scala 2 and 3 are both supported.  ","version":"0.14","tagName":"h3"},{"title":"Scala Class Default Values Support‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#scala-class-default-values-support","content":" Fory supports Scala class default values during deserialization when using compatible mode. This feature enables forward/backward compatibility when case classes or regular Scala classes have default parameters.  When a Scala class has default parameters, the Scala compiler generates methods in the companion object (for case classes) or in the class itself (for regular Scala classes) like apply$default$1, apply$default$2, etc. that return the default values. Fory can detect these methods and use them when deserializing objects where certain fields are missing from the serialized data.  ","version":"0.14","tagName":"h3"},{"title":"Kotlin Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#kotlin-features","content":" ","version":"0.14","tagName":"h2"},{"title":"Supported Types‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#supported-types-1","content":" primitives: Byte, Boolean, Int, Short, Long, Char, Float, Double, UByte, UShort, UInt, ULong.Byte, Boolean, Int, Short, Long, Char, Float, Double works out of the box with the default fory java implementation.stdlib collection: ArrayDeque, ArrayList, HashMap,HashSet, LinkedHashSet, LinkedHashMap.ArrayList, HashMap,HashSet, LinkedHashSet, LinkedHashMap works out of the box with the default fory java implementation.String works out of the box with the default fory java implementation.arrays: Array, BooleanArray, ByteArray, CharArray, DoubleArray, FloatArray, IntArray, LongArray, ShortArrayall standard array types work out of the box with the default fory java implementation.unsigned arrays: UByteArray, UShortArray, UIntArray, ULongArrayfrom stdlib: Pair, Triple, Resultkotlin.random: Randomkotlin.ranges: CharRange, CharProgression, IntRange, IntProgression, LongRange, LongProgression, UintRange, UintProgression, ULongRange, ULongProgressionkotlin.text: Regexkotlin.time: Durationkotlin.uuid: Uuid  Additional support is added for the following classes in kotlin:  Unsigned primitives: UByte, UShort, UInt, ULongUnsigned array types: UByteArray, UShortArray, UIntArray, ULongArrayEmpty collections: emptyList, emptyMap, emptySetCollections: ArrayDequekotlin.time: Durationkotlin.uuid: Uuid  ","version":"0.14","tagName":"h3"},{"title":"Data Class Default Value Support‚Äã","type":1,"pageTitle":"Features","url":"/docs/0.14/introduction/features#data-class-default-value-support","content":" Apache Fory‚Ñ¢ Kotlin provides support for Kotlin data class default values during serialization and deserialization. This feature allows for backward and forward compatibility when data class schemas evolve.  When a Kotlin data class has parameters with default values, Apache Fory‚Ñ¢ can:  Detect default values using Kotlin reflectionApply default values during deserialization when fields are missing from serialized dataSupport schema evolution by allowing new fields with defaults to be added without breaking existing serialized data ","version":"0.14","tagName":"h3"},{"title":"Zero-Copy Serialization","type":0,"sectionRef":"#","url":"/docs/0.14/guide/xlang/xlang_zero_copy","content":"","keywords":"","version":"0.14"},{"title":"When to Use Zero-Copy‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/0.14/guide/xlang/xlang_zero_copy#when-to-use-zero-copy","content":" Use zero-copy serialization when:  Serializing large byte arrays or binary blobsWorking with numeric arrays (int[], double[], etc.)Transferring data over high-performance networksMemory efficiency is critical  ","version":"0.14","tagName":"h2"},{"title":"How It Works‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/0.14/guide/xlang/xlang_zero_copy#how-it-works","content":" Serialization: Large buffers are extracted and returned separately via a callbackTransport: The main serialized data and buffer objects are transmitted separatelyDeserialization: Buffers are provided back to reconstruct the original object  This avoids copying large data into the main serialization buffer.  ","version":"0.14","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/0.14/guide/xlang/xlang_zero_copy#java","content":" import org.apache.fory.*; import org.apache.fory.config.*; import org.apache.fory.serializer.BufferObject; import org.apache.fory.memory.MemoryBuffer; import java.util.*; import java.util.stream.Collectors; public class ZeroCopyExample { public static void main(String[] args) { Fory fory = Fory.builder().withLanguage(Language.XLANG).build(); // Data with large arrays List&lt;Object&gt; list = List.of( &quot;str&quot;, new byte[1000], // Large byte array new int[100], // Large int array new double[100] // Large double array ); // Collect buffer objects during serialization Collection&lt;BufferObject&gt; bufferObjects = new ArrayList&lt;&gt;(); byte[] bytes = fory.serialize(list, e -&gt; !bufferObjects.add(e)); // Convert to buffers for transport List&lt;MemoryBuffer&gt; buffers = bufferObjects.stream() .map(BufferObject::toBuffer) .collect(Collectors.toList()); // Deserialize with buffers Object result = fory.deserialize(bytes, buffers); System.out.println(result); } }   ","version":"0.14","tagName":"h2"},{"title":"Python‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/0.14/guide/xlang/xlang_zero_copy#python","content":" import array import pyfory import numpy as np fory = pyfory.Fory() # Data with large arrays data = [ &quot;str&quot;, bytes(bytearray(1000)), # Large byte array array.array(&quot;i&quot;, range(100)), # Large int array np.full(100, 0.0, dtype=np.double) # Large numpy array ] # Collect buffer objects during serialization serialized_objects = [] serialized_data = fory.serialize(data, buffer_callback=serialized_objects.append) # Convert to buffers for transport buffers = [obj.to_buffer() for obj in serialized_objects] # Deserialize with buffers result = fory.deserialize(serialized_data, buffers=buffers) print(result)   ","version":"0.14","tagName":"h2"},{"title":"Go‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/0.14/guide/xlang/xlang_zero_copy#go","content":" package main import forygo &quot;github.com/apache/fory/go/fory&quot; import &quot;fmt&quot; func main() { fory := forygo.NewFory() // Data with large arrays list := []interface{}{ &quot;str&quot;, make([]byte, 1000), // Large byte array } buf := fory.NewByteBuffer(nil) var bufferObjects []fory.BufferObject // Collect buffer objects during serialization fory.Serialize(buf, list, func(o fory.BufferObject) bool { bufferObjects = append(bufferObjects, o) return false }) // Convert to buffers for transport var buffers []*fory.ByteBuffer for _, o := range bufferObjects { buffers = append(buffers, o.ToBuffer()) } // Deserialize with buffers var newList []interface{} if err := fory.Deserialize(buf, &amp;newList, buffers); err != nil { panic(err) } fmt.Println(newList) }   ","version":"0.14","tagName":"h2"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/0.14/guide/xlang/xlang_zero_copy#javascript","content":" // Zero-copy support coming soon   ","version":"0.14","tagName":"h2"},{"title":"Use Cases‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/0.14/guide/xlang/xlang_zero_copy#use-cases","content":" ","version":"0.14","tagName":"h2"},{"title":"High-Performance Data Transfer‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/0.14/guide/xlang/xlang_zero_copy#high-performance-data-transfer","content":" When sending large datasets over the network:  // Sender Collection&lt;BufferObject&gt; buffers = new ArrayList&lt;&gt;(); byte[] metadata = fory.serialize(dataObject, e -&gt; !buffers.add(e)); // Send metadata and buffers separately network.sendMetadata(metadata); for (BufferObject buf : buffers) { network.sendBuffer(buf.toBuffer()); } // Receiver byte[] metadata = network.receiveMetadata(); List&lt;MemoryBuffer&gt; buffers = network.receiveBuffers(); Object data = fory.deserialize(metadata, buffers);   ","version":"0.14","tagName":"h3"},{"title":"Memory-Mapped Files‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/0.14/guide/xlang/xlang_zero_copy#memory-mapped-files","content":" Zero-copy works well with memory-mapped files:  // Write Collection&lt;BufferObject&gt; buffers = new ArrayList&lt;&gt;(); byte[] data = fory.serialize(largeObject, e -&gt; !buffers.add(e)); writeToFile(&quot;data.bin&quot;, data); for (int i = 0; i &lt; buffers.size(); i++) { writeToFile(&quot;buffer&quot; + i + &quot;.bin&quot;, buffers.get(i).toBuffer()); } // Read byte[] data = readFromFile(&quot;data.bin&quot;); List&lt;MemoryBuffer&gt; buffers = readBufferFiles(); Object result = fory.deserialize(data, buffers);   ","version":"0.14","tagName":"h3"},{"title":"Performance Considerations‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/0.14/guide/xlang/xlang_zero_copy#performance-considerations","content":" Threshold: Small arrays may not benefit from zero-copy due to callback overheadNetwork: Zero-copy is most beneficial when buffers can be sent without copyingMemory: Reduces peak memory usage by avoiding buffer copies  ","version":"0.14","tagName":"h2"},{"title":"See Also‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/0.14/guide/xlang/xlang_zero_copy#see-also","content":" Serialization - Standard serialization examplesPython Out-of-Band Guide - Python-specific zero-copy details ","version":"0.14","tagName":"h2"},{"title":"Overview","type":0,"sectionRef":"#","url":"/docs/0.14/introduction/overview","content":"","keywords":"","version":"0.14"},{"title":"Quick Example‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.14/introduction/overview#quick-example","content":" Cross-language serialization ‚Äî serialize in Rust, deserialize in Python:  Rust  use fory::{Fory, ForyObject}; #[derive(ForyObject, Debug, PartialEq)] struct User { name: String, age: i32, } fn main() { let mut fory = Fory::default().xlang(true); fory.register::&lt;User&gt;(1); let user = User { name: &quot;Alice&quot;.to_string(), age: 30 }; let bytes = fory.serialize(&amp;user).unwrap(); let decoded: User = fory.deserialize(&amp;bytes).unwrap(); println!(&quot;{:?}&quot;, decoded); // User { name: &quot;Alice&quot;, age: 30 } }   Python  import pyfory from dataclasses import dataclass @dataclass class User: name: str age: pyfory.int32 fory = pyfory.Fory(xlang=True) fory.register(User, type_id=1) user = User(name=&quot;Alice&quot;, age=30) data = fory.serialize(user) decoded = fory.deserialize(data) print(decoded) # User(name='Alice', age=30)   ","version":"0.14","tagName":"h2"},{"title":"Key Features‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.14/introduction/overview#key-features","content":" ","version":"0.14","tagName":"h2"},{"title":"üöÄ High-Performance Serialization‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.14/introduction/overview#-high-performance-serialization","content":" Apache Fory‚Ñ¢ delivers exceptional performance through advanced optimization techniques:  JIT Compilation: Runtime code generation for Java eliminates virtual method calls and inlines hot pathsStatic Code Generation: Compile-time code generation for Rust, C++, and Go delivers peak performance without runtime overheadZero-Copy Operations: Direct memory access without intermediate buffer copies; row format enables random access and partial serializationIntelligent Encoding: Variable-length compression for integers and strings; SIMD acceleration for arrays (Java 16+)Meta Sharing: Class metadata packing reduces redundant type information across serializations  ","version":"0.14","tagName":"h3"},{"title":"üîÑ Cross-Language Serialization‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.14/introduction/overview#-cross-language-serialization","content":" The xlang serialization format enables seamless data exchange across programming languages:  Automatic Type Mapping: Intelligent conversion between language-specific types (type mapping)Reference Preservation: Shared and circular references work correctly across languagesPolymorphism: Objects serialize/deserialize with their actual runtime typesSchema Evolution: Optional forward/backward compatibility for evolving schemasAutomatic Serialization: No IDL or schema definitions required; serialize any object directly without code generation  ","version":"0.14","tagName":"h3"},{"title":"üìä Row Format‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.14/introduction/overview#-row-format","content":" A cache-friendly row format optimized for analytics workloads:  Zero-Copy Random Access: Read individual fields without deserializing entire objectsPartial Operations: Selective field serialization and deserialization for efficiencyApache Arrow Integration: Seamless conversion to columnar format for analytics pipelinesMulti-Language: Available in Java, Python, Rust and C++  ","version":"0.14","tagName":"h3"},{"title":"üîí Security & Production-Readiness‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.14/introduction/overview#-security--production-readiness","content":" Enterprise-grade security and compatibility:  Class Registration: Whitelist-based deserialization control (enabled by default)Depth Limiting: Protection against recursive object graph attacksConfigurable Policies: Custom class checkers and deserialization policiesPlatform Support: Java 8-24, GraalVM native image, multiple OS platforms  ","version":"0.14","tagName":"h3"},{"title":"Protocols‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.14/introduction/overview#protocols","content":" Apache Fory‚Ñ¢ implements multiple binary protocols optimized for different scenarios:  Protocol\tUse Case\tKey FeaturesXlang Serialization\tCross-language object exchange\tAutomatic serialization, references, polymorphism Java Serialization\tHigh-performance Java-only\tDrop-in JDK serialization replacement, 100x faster Row Format\tAnalytics and data processing\tZero-copy random access, Arrow compatibility Python Native\tPython-specific serialization\tPickle/cloudpickle replacement with better performance  All protocols share the same optimized codebase, allowing improvements in one protocol to benefit others.  ","version":"0.14","tagName":"h2"},{"title":"Documentation‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.14/introduction/overview#documentation","content":" ","version":"0.14","tagName":"h2"},{"title":"User Guides‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.14/introduction/overview#user-guides","content":" Guide\tDescription\tSource\tWebsiteJava Serialization\tComprehensive guide for Java serialization\tJava Guide\tüìñ View Cross-Language Serialization\tMulti-language object exchange\tXlang Guide\tüìñ View Row Format\tZero-copy random access format\tJava Row Format\tüìñ View Python\tPython-specific features and usage\tPython Guide\tüìñ View Rust\tRust implementation and patterns\tRust Guide\tüìñ View Scala\tScala integration and best practices\tScala Guide\tüìñ View GraalVM\tNative image support and AOT compilation\tGraalVM Guide\tüìñ View Development\tBuilding and contributing to Fory\tDevelopment\tüìñ View  ","version":"0.14","tagName":"h3"},{"title":"Protocol Specifications‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.14/introduction/overview#protocol-specifications","content":" Specification\tDescription\tSource\tWebsiteXlang Serialization\tCross-language binary protocol\txlang_serialization_spec.md\tüìñ View Java Serialization\tJava-optimized protocol\tjava_serialization_spec.md\tüìñ View Row Format\tRow-based binary format\trow_format_spec.md\tüìñ View Type Mapping\tCross-language type conversion\txlang_type_mapping.md\tüìñ View  ","version":"0.14","tagName":"h3"},{"title":"Compatibility‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.14/introduction/overview#compatibility","content":" ","version":"0.14","tagName":"h2"},{"title":"Schema Compatibility‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.14/introduction/overview#schema-compatibility","content":" Apache Fory‚Ñ¢ supports class schema forward/backward compatibility across Java, Python, Rust, and Golang, enabling seamless schema evolution in production systems without requiring coordinated upgrades across all services. Fory provides two schema compatibility modes:  Schema Consistent Mode (Default): Assumes identical class schemas between serialization and deserialization peers. This mode offers minimal serialization overhead, smallest data size, and fastest performance: ideal for stable schemas or controlled environments. Compatible Mode: Supports independent schema evolution with forward and backward compatibility. This mode enables field addition/deletion, limited type evolution, and graceful handling of schema mismatches. Enable using withCompatibleMode(CompatibleMode.COMPATIBLE) in Java, compatible=True in Python, compatible_mode(true) in Rust, or NewFory(true) in Go.  ","version":"0.14","tagName":"h3"},{"title":"Binary Compatibility‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.14/introduction/overview#binary-compatibility","content":" Current Status: Binary compatibility is not guaranteed between Fory major releases as the protocol continues to evolve. However, compatibility is guaranteed between minor versions (e.g., 0.13.x).  Recommendations:  Version your serialized data by Fory major versionPlan migration strategies when upgrading major versionsSee upgrade guide for details  Future: Binary compatibility will be guaranteed starting from Fory 1.0 release.  ","version":"0.14","tagName":"h3"},{"title":"Security‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.14/introduction/overview#security","content":" ","version":"0.14","tagName":"h2"},{"title":"Overview‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.14/introduction/overview#overview","content":" Serialization security varies by protocol:  Row Format: Secure with predefined schemasObject Graph Serialization (Java/Python native): More flexible but requires careful security configuration  Dynamic serialization can deserialize arbitrary types, which may introduces risks. For example, the deserialization may invoke init constructor or equals/hashCode method, if the method body contains malicious code, the system will be at risk.  Fory enables class registration by default for dynamic protocols, allowing only trusted registered types.Do not disable class registration unless you can ensure your environment is secure.  If this option is disabled, you are responsible for serialization security. You should implement and configure a customized ClassChecker or DeserializationPolicy for fine-grained security control  To report security vulnerabilities in Apache Fory‚Ñ¢, please follow the ASF vulnerability reporting process.  ","version":"0.14","tagName":"h3"},{"title":"Community and Support‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.14/introduction/overview#community-and-support","content":" ","version":"0.14","tagName":"h2"},{"title":"Getting Help‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.14/introduction/overview#getting-help","content":" Slack: Join our Slack workspace for community discussionsTwitter/X: Follow @ApacheFory for updates and announcementsGitHub Issues: Report bugs and request features at apache/foryMailing Lists: Subscribe to Apache Fory mailing lists for development discussions  ","version":"0.14","tagName":"h3"},{"title":"Contributing‚Äã","type":1,"pageTitle":"Overview","url":"/docs/0.14/introduction/overview#contributing","content":" We welcome contributions! Please read our Contributing Guide to get started.  Ways to Contribute:  üêõ Report bugs and issuesüí° Propose new featuresüìù Improve documentationüîß Submit pull requestsüß™ Add test casesüìä Share benchmarks  See Development Guide for build instructions and development workflow. ","version":"0.14","tagName":"h3"},{"title":"Serialization","type":0,"sectionRef":"#","url":"/docs/0.14/guide/xlang/xlang_serialization","content":"","keywords":"","version":"0.14"},{"title":"Serialize Built-in Types‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/0.14/guide/xlang/xlang_serialization#serialize-built-in-types","content":" Common types can be serialized automatically without registration: primitive numeric types, string, binary, array, list, map, and more.  ","version":"0.14","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/0.14/guide/xlang/xlang_serialization#java","content":" import org.apache.fory.*; import org.apache.fory.config.*; import java.util.*; public class Example1 { public static void main(String[] args) { Fory fory = Fory.builder().withLanguage(Language.XLANG).build(); List&lt;Object&gt; list = ofArrayList(true, false, &quot;str&quot;, -1.1, 1, new int[100], new double[20]); byte[] bytes = fory.serialize(list); // bytes can be deserialized by other languages fory.deserialize(bytes); Map&lt;Object, Object&gt; map = new HashMap&lt;&gt;(); map.put(&quot;k1&quot;, &quot;v1&quot;); map.put(&quot;k2&quot;, list); map.put(&quot;k3&quot;, -1); bytes = fory.serialize(map); // bytes can be deserialized by other languages fory.deserialize(bytes); } }   ","version":"0.14","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/0.14/guide/xlang/xlang_serialization#python","content":" import pyfory import numpy as np fory = pyfory.Fory() object_list = [True, False, &quot;str&quot;, -1.1, 1, np.full(100, 0, dtype=np.int32), np.full(20, 0.0, dtype=np.double)] data = fory.serialize(object_list) # bytes can be deserialized by other languages new_list = fory.deserialize(data) object_map = {&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: object_list, &quot;k3&quot;: -1} data = fory.serialize(object_map) # bytes can be deserialized by other languages new_map = fory.deserialize(data) print(new_map)   ","version":"0.14","tagName":"h3"},{"title":"Go‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/0.14/guide/xlang/xlang_serialization#go","content":" package main import forygo &quot;github.com/apache/fory/go/fory&quot; import &quot;fmt&quot; func main() { list := []interface{}{true, false, &quot;str&quot;, -1.1, 1, make([]int32, 10), make([]float64, 20)} fory := forygo.NewFory() bytes, err := fory.Marshal(list) if err != nil { panic(err) } var newValue interface{} // bytes can be deserialized by other languages if err := fory.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) dict := map[string]interface{}{ &quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: list, &quot;k3&quot;: -1, } bytes, err = fory.Marshal(dict) if err != nil { panic(err) } // bytes can be deserialized by other languages if err := fory.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) }   ","version":"0.14","tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/0.14/guide/xlang/xlang_serialization#javascript","content":" import Fory from &quot;@apache-fory/fory&quot;; /** * @apache-fory/hps use v8's fast-calls-api that can be called directly by jit, * ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment. * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from &quot;@apache-fory/hps&quot;; const fory = new Fory({ hps }); const input = fory.serialize(&quot;hello fory&quot;); const result = fory.deserialize(input); console.log(result);   ","version":"0.14","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/0.14/guide/xlang/xlang_serialization#rust","content":" use fory::{from_buffer, to_buffer, Fory}; use std::collections::HashMap; fn run() { let bin: Vec&lt;u8&gt; = to_buffer(&amp;&quot;hello&quot;.to_string()); let obj: String = from_buffer(&amp;bin).expect(&quot;should success&quot;); assert_eq!(&quot;hello&quot;.to_string(), obj); }   ","version":"0.14","tagName":"h3"},{"title":"Serialize Custom Types‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/0.14/guide/xlang/xlang_serialization#serialize-custom-types","content":" User-defined types must be registered using the register API to establish the mapping relationship between types in different languages. Use consistent type names across all languages.  ","version":"0.14","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/0.14/guide/xlang/xlang_serialization#java-1","content":" import org.apache.fory.*; import org.apache.fory.config.*; import java.util.*; public class Example2 { public static class SomeClass1 { Object f1; Map&lt;Byte, Integer&gt; f2; } public static class SomeClass2 { Object f1; String f2; List&lt;Object&gt; f3; Map&lt;Byte, Integer&gt; f4; Byte f5; Short f6; Integer f7; Long f8; Float f9; Double f10; short[] f11; List&lt;Short&gt; f12; } public static Object createObject() { SomeClass1 obj1 = new SomeClass1(); obj1.f1 = true; obj1.f2 = ofHashMap((byte) -1, 2); SomeClass2 obj = new SomeClass2(); obj.f1 = obj1; obj.f2 = &quot;abc&quot;; obj.f3 = ofArrayList(&quot;abc&quot;, &quot;abc&quot;); obj.f4 = ofHashMap((byte) 1, 2); obj.f5 = Byte.MAX_VALUE; obj.f6 = Short.MAX_VALUE; obj.f7 = Integer.MAX_VALUE; obj.f8 = Long.MAX_VALUE; obj.f9 = 1.0f / 2; obj.f10 = 1 / 3.0; obj.f11 = new short[]{(short) 1, (short) 2}; obj.f12 = ofArrayList((short) -1, (short) 4); return obj; } // mvn exec:java -Dexec.mainClass=&quot;org.apache.fory.examples.Example2&quot; public static void main(String[] args) { Fory fory = Fory.builder().withLanguage(Language.XLANG).build(); fory.register(SomeClass1.class, &quot;example.SomeClass1&quot;); fory.register(SomeClass2.class, &quot;example.SomeClass2&quot;); byte[] bytes = fory.serialize(createObject()); // bytes can be deserialized by other languages System.out.println(fory.deserialize(bytes)); } }   ","version":"0.14","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/0.14/guide/xlang/xlang_serialization#python-1","content":" from dataclasses import dataclass from typing import List, Dict, Any import pyfory, array @dataclass class SomeClass1: f1: Any f2: Dict[pyfory.Int8Type, pyfory.Int32Type] @dataclass class SomeClass2: f1: Any = None f2: str = None f3: List[str] = None f4: Dict[pyfory.Int8Type, pyfory.Int32Type] = None f5: pyfory.Int8Type = None f6: pyfory.Int16Type = None f7: pyfory.Int32Type = None # int type will be taken as `pyfory.Int64Type`. # use `pyfory.Int32Type` for type hint if peer uses more narrow type. f8: int = None f9: pyfory.Float32Type = None # float type will be taken as `pyfory.Float64Type` f10: float = None f11: pyfory.Int16ArrayType = None f12: List[pyfory.Int16Type] = None if __name__ == &quot;__main__&quot;: f = pyfory.Fory() f.register_type(SomeClass1, typename=&quot;example.SomeClass1&quot;) f.register_type(SomeClass2, typename=&quot;example.SomeClass2&quot;) obj1 = SomeClass1(f1=True, f2={-1: 2}) obj = SomeClass2( f1=obj1, f2=&quot;abc&quot;, f3=[&quot;abc&quot;, &quot;abc&quot;], f4={1: 2}, f5=2 ** 7 - 1, f6=2 ** 15 - 1, f7=2 ** 31 - 1, f8=2 ** 63 - 1, f9=1.0 / 2, f10=1 / 3.0, f11=array.array(&quot;h&quot;, [1, 2]), f12=[-1, 4], ) data = f.serialize(obj) # bytes can be deserialized by other languages print(f.deserialize(data))   ","version":"0.14","tagName":"h3"},{"title":"Go‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/0.14/guide/xlang/xlang_serialization#go-1","content":" package main import forygo &quot;github.com/apache/fory/go/fory&quot; import &quot;fmt&quot; func main() { type SomeClass1 struct { F1 interface{} F2 string F3 []interface{} F4 map[int8]int32 F5 int8 F6 int16 F7 int32 F8 int64 F9 float32 F10 float64 F11 []int16 F12 fory.Int16Slice } type SomeClass2 struct { F1 interface{} F2 map[int8]int32 } fory := forygo.NewFory() if err := fory.RegisterTagType(&quot;example.SomeClass1&quot;, SomeClass1{}); err != nil { panic(err) } if err := fory.RegisterTagType(&quot;example.SomeClass2&quot;, SomeClass2{}); err != nil { panic(err) } obj1 := &amp;SomeClass1{} obj1.F1 = true obj1.F2 = map[int8]int32{-1: 2} obj := &amp;SomeClass1{} obj.F1 = obj1 obj.F2 = &quot;abc&quot; obj.F3 = []interface{}{&quot;abc&quot;, &quot;abc&quot;} f4 := map[int8]int32{1: 2} obj.F4 = f4 obj.F5 = fory.MaxInt8 obj.F6 = fory.MaxInt16 obj.F7 = fory.MaxInt32 obj.F8 = fory.MaxInt64 obj.F9 = 1.0 / 2 obj.F10 = 1 / 3.0 obj.F11 = []int16{1, 2} obj.F12 = []int16{-1, 4} bytes, err := fory.Marshal(obj); if err != nil { panic(err) } var newValue interface{} // bytes can be deserialized by other languages if err := fory.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) }   ","version":"0.14","tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/0.14/guide/xlang/xlang_serialization#javascript-1","content":" import Fory, { Type, InternalSerializerType } from &quot;@apache-fory/fory&quot;; /** * @apache-fory/hps use v8's fast-calls-api that can be called directly by jit, * ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment. * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from &quot;@apache-fory/hps&quot;; // Describe data structures using JSON schema const description = Type.object(&quot;example.foo&quot;, { foo: Type.string(), }); const fory = new Fory({ hps }); const { serialize, deserialize } = fory.registerSerializer(description); const input = serialize({ foo: &quot;hello fory&quot; }); const result = deserialize(input); console.log(result);   ","version":"0.14","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/0.14/guide/xlang/xlang_serialization#rust-1","content":" use chrono::{NaiveDate, NaiveDateTime}; use fory::{from_buffer, to_buffer, Fory}; use std::collections::HashMap; #[test] fn complex_struct() { #[derive(Fory, Debug, PartialEq)] #[tag(&quot;example.foo2&quot;)] struct Animal { category: String, } #[derive(Fory, Debug, PartialEq)] #[tag(&quot;example.foo&quot;)] struct Person { c1: Vec&lt;u8&gt;, // binary c2: Vec&lt;i16&gt;, // primitive array animal: Vec&lt;Animal&gt;, c3: Vec&lt;Vec&lt;u8&gt;&gt;, name: String, c4: HashMap&lt;String, String&gt;, age: u16, op: Option&lt;String&gt;, op2: Option&lt;String&gt;, date: NaiveDate, time: NaiveDateTime, c5: f32, c6: f64, } let person: Person = Person { c1: vec![1, 2, 3], c2: vec![5, 6, 7], c3: vec![vec![1, 2], vec![1, 3]], animal: vec![Animal { category: &quot;Dog&quot;.to_string(), }], c4: HashMap::from([ (&quot;hello1&quot;.to_string(), &quot;hello2&quot;.to_string()), (&quot;hello2&quot;.to_string(), &quot;hello3&quot;.to_string()), ]), age: 12, name: &quot;helo&quot;.to_string(), op: Some(&quot;option&quot;.to_string()), op2: None, date: NaiveDate::from_ymd_opt(2025, 12, 12).unwrap(), time: NaiveDateTime::from_timestamp_opt(1689912359, 0).unwrap(), c5: 2.0, c6: 4.0, }; let bin: Vec&lt;u8&gt; = to_buffer(&amp;person); let obj: Person = from_buffer(&amp;bin).expect(&quot;should success&quot;); assert_eq!(person, obj); }   ","version":"0.14","tagName":"h3"},{"title":"Serialize Shared and Circular References‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/0.14/guide/xlang/xlang_serialization#serialize-shared-and-circular-references","content":" Shared references and circular references can be serialized automatically with no duplicate data or recursion errors. Enable reference tracking to use this feature.  ","version":"0.14","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/0.14/guide/xlang/xlang_serialization#java-2","content":" import org.apache.fory.*; import org.apache.fory.config.*; import java.util.*; public class ReferenceExample { public static class SomeClass { SomeClass f1; Map&lt;String, String&gt; f2; Map&lt;String, String&gt; f3; } public static Object createObject() { SomeClass obj = new SomeClass(); obj.f1 = obj; obj.f2 = ofHashMap(&quot;k1&quot;, &quot;v1&quot;, &quot;k2&quot;, &quot;v2&quot;); obj.f3 = obj.f2; return obj; } // mvn exec:java -Dexec.mainClass=&quot;org.apache.fory.examples.ReferenceExample&quot; public static void main(String[] args) { Fory fory = Fory.builder().withLanguage(Language.XLANG) .withRefTracking(true).build(); fory.register(SomeClass.class, &quot;example.SomeClass&quot;); byte[] bytes = fory.serialize(createObject()); // bytes can be deserialized by other languages System.out.println(fory.deserialize(bytes)); } }   ","version":"0.14","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/0.14/guide/xlang/xlang_serialization#python-2","content":" from typing import Dict import pyfory class SomeClass: f1: &quot;SomeClass&quot; f2: Dict[str, str] f3: Dict[str, str] fory = pyfory.Fory(ref_tracking=True) fory.register_type(SomeClass, typename=&quot;example.SomeClass&quot;) obj = SomeClass() obj.f2 = {&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: &quot;v2&quot;} obj.f1, obj.f3 = obj, obj.f2 data = fory.serialize(obj) # bytes can be deserialized by other languages print(fory.deserialize(data))   ","version":"0.14","tagName":"h3"},{"title":"Go‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/0.14/guide/xlang/xlang_serialization#go-2","content":" package main import forygo &quot;github.com/apache/fory/go/fory&quot; import &quot;fmt&quot; func main() { type SomeClass struct { F1 *SomeClass F2 map[string]string F3 map[string]string } fory := forygo.NewFory(true) if err := fory.Register(SomeClass{}, 65); err != nil { panic(err) } value := &amp;SomeClass{F2: map[string]string{&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: &quot;v2&quot;}} value.F3 = value.F2 value.F1 = value bytes, err := fory.Marshal(value) if err != nil { panic(err) } var newValue interface{} // bytes can be deserialized by other languages if err := fory.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) }   ","version":"0.14","tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/0.14/guide/xlang/xlang_serialization#javascript-2","content":" import Fory, { Type } from &quot;@apache-fory/fory&quot;; /** * @apache-fory/hps use v8's fast-calls-api that can be called directly by jit, * ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment. * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from &quot;@apache-fory/hps&quot;; const description = Type.object(&quot;example.foo&quot;, { foo: Type.string(), bar: Type.object(&quot;example.foo&quot;), }); const fory = new Fory({ hps }); const { serialize, deserialize } = fory.registerSerializer(description); const data: any = { foo: &quot;hello fory&quot;, }; data.bar = data; const input = serialize(data); const result = deserialize(input); console.log(result.bar.foo === result.foo);   ","version":"0.14","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/0.14/guide/xlang/xlang_serialization#rust-2","content":" Circular references cannot be implemented in Rust due to ownership restrictions.  ","version":"0.14","tagName":"h3"},{"title":"See Also‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/0.14/guide/xlang/xlang_serialization#see-also","content":" Zero-Copy Serialization - Out-of-band serialization for large dataType Mapping - Cross-language type mapping referenceGetting Started - Installation and setupXlang Serialization Specification - Binary protocol details ","version":"0.14","tagName":"h2"},{"title":"Java Serialization Format","type":0,"sectionRef":"#","url":"/docs/0.14/specification/java_serialization_spec","content":"","keywords":"","version":"0.14"},{"title":"Spec overview‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.14/specification/java_serialization_spec#spec-overview","content":" Apache Fory‚Ñ¢ Java Serialization is an automatic object serialization framework that supports reference and polymorphism. Apache Fory‚Ñ¢ will convert an object from/to fory java serialization binary format. Apache Fory‚Ñ¢ has two core concepts for java serialization:  Apache Fory‚Ñ¢ Java Binary formatFramework to convert object to/from Apache Fory‚Ñ¢ Java Binary format  The serialization format is a dynamic binary format. The dynamics and reference/polymorphism support make Apache Fory‚Ñ¢ flexible, much more easy to use, but also introduce more complexities compared to static serialization frameworks. So the format will be more complex.  Here is the overall format:  | fory header | object ref meta | object class meta | object value data |   The data are serialized using little endian byte order overall. If bytes swap is costly for some object, Fory will write the byte order for that object into the data instead of converting it to little endian.  ","version":"0.14","tagName":"h2"},{"title":"Fory header‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.14/specification/java_serialization_spec#fory-header","content":" Fory header consists starts one byte:  | 4 bits | 1 bit | 1 bit | 1 bit | 1 bit | optional 4 bytes | +---------------+-------+-------+--------+-------+------------------------------------+ | reserved bits | oob | xlang | endian | null | unsigned int for meta start offset |   null flag: 1 when object is null, 0 otherwise. If an object is null, other bits won't be set.endian flag: 1 when data is encoded by little endian, 0 for big endian.xlang flag: 1 when serialization uses xlang format, 0 when serialization uses Fory java format.oob flag: 1 when passed BufferCallback is not null, 0 otherwise.  If meta share mode is enabled, an uncompressed unsigned int is appended to indicate the start offset of metadata.  ","version":"0.14","tagName":"h2"},{"title":"Reference Meta‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.14/specification/java_serialization_spec#reference-meta","content":" Reference tracking handles whether the object is null, and whether to track reference for the object by writing corresponding flags and maintaining internal state.  Reference flags:  Flag\tByte Value\tDescriptionNULL FLAG\t-3\tThis flag indicates the object is a null value. We don't use another byte to indicate REF, so that we can save one byte. REF FLAG\t-2\tThis flag indicates the object is already serialized previously, and fory will write a ref id with unsigned varint format instead of serialize it again NOT_NULL VALUE FLAG\t-1\tThis flag indicates the object is a non-null value and fory doesn't track ref for this type of object. REF VALUE FLAG\t0\tThis flag indicates the object is referencable and the first time to serialize.  When reference tracking is disabled globally or for specific types, or for certain types within a particular context(e.g., a field of a class), only the NULL and NOT_NULL VALUE flags will be used for reference meta.  ","version":"0.14","tagName":"h2"},{"title":"Class Meta‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.14/specification/java_serialization_spec#class-meta","content":" Fory supports to register class by an optional id, the registration can be used for security check and class identification. If a class is registered, it will have a user-provided or an auto-growing unsigned int i.e. class_id.  Depending on whether meta share mode and registration is enabled for current class, Fory will write class meta differently.  ","version":"0.14","tagName":"h2"},{"title":"Schema consistent‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.14/specification/java_serialization_spec#schema-consistent","content":" If schema consistent mode is enabled globally or enabled for current class, class meta will be written as follows:  If class is registered, it will be written as a fory unsigned varint: class_id &lt;&lt; 1.If class is not registered: If class is not an array, fory will write one byte 0bxxxxxxx1 first, then write class name. The first little bit is 1, which is different from first bit 0 of encoded class id. Fory can use this information to determine whether to read class by class id for deserialization. If class is not registered and class is an array, fory will write one byte dimensions &lt;&lt; 1 | 1 first, then write component class subsequently. This can reduce array class name cost if component class is or will be serialized.Class will be written as two enumerated fory unsigned by default: package name and class name. If meta share mode is enabled, class will be written as an unsigned varint which points to index in MetaContext.  ","version":"0.14","tagName":"h3"},{"title":"Schema evolution‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.14/specification/java_serialization_spec#schema-evolution","content":" If schema evolution mode is enabled globally or enabled for current class, class meta will be written as follows:  If meta share mode is not enabled, class meta will be written as schema consistent mode. Additionally, field meta such as field type and name will be written with the field value using a key-value like layout.If meta share mode is enabled, class meta will be written as a meta-share encoded binary if class hasn't been written before, otherwise an unsigned varint id which references to previous written class meta will be written.  ","version":"0.14","tagName":"h3"},{"title":"Meta share‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.14/specification/java_serialization_spec#meta-share","content":" This mode will forbid streaming writing since it needs to look back for update the start offset after the whole object graph writing and meta collecting is finished. Only in this way we can ensure deserialization failure doesn't lost shared meta. Meta streamline will be supported in the future for enclosed meta sharing which doesn't cross multiple serializations of different objects.  For Schema consistent mode, class will be encoded as an enumerated string by full class name. Here we mainly describe the meta layout for schema evolution mode:  | 8 bytes global meta header | 1~2 bytes | variable bytes | variable bytes | variable bytes | +-------------------------------+-------------|--------------------+-------------------+----------------+ | 50 bits hash + 14 bits header | type header | current class meta | parent class meta | ... |   Class meta are encoded from parent class to leaf class, only class with serializable fields will be encoded.  ","version":"0.14","tagName":"h2"},{"title":"Global meta header‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.14/specification/java_serialization_spec#global-meta-header","content":" Meta header is a 64 bits number value encoded in little endian order.  lower 12 bits are used to encode meta size. If meta size &gt;= 0b1111_1111_1111, then writemeta_ size - 0b1111_1111_1111 next.13rd bit is used to indicate whether to write fields meta. When this class is schema-consistent or use registered serializer, fields meta will be skipped. Class Meta will be used for share namespace + type name only.14rd bit is used to indicate whether meta is compressed.Other 50 bits is used to store the unique hash of flags + all layers class meta.  ","version":"0.14","tagName":"h3"},{"title":"Type header‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.14/specification/java_serialization_spec#type-header","content":" Lowest 4 digits 0b0000~0b1110 are used to record num classes. 0b1111 is preserved to indicate that Fory need to read more bytes for length using Fory unsigned int encoding. If current class doesn't has parent class, or parent class doesn't have fields to serialize, or we're in a context which serialize fields of current class only(ObjectStreamSerializer#SlotInfo is an example), num classes will be 1.Other 4 bits are preserved to future extensions.If num classes are greater than or equal to 0b1111, write num_classes - 0b1111 as varuint next.  ","version":"0.14","tagName":"h3"},{"title":"Single layer class meta‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.14/specification/java_serialization_spec#single-layer-class-meta","content":" | unsigned varint | meta string | meta string | field info: variable bytes | variable bytes | ... | +----------------------------+-----------------------+---------------------+-------------------------------+-----------------+-----+ | num fields + register flag | header + package name | header + class name | header + type id + field name | next field info | ... |   num fields: encode num fields &lt;&lt; 1 | register flag(1 when class registered) as unsigned varint. If class is registered, then an unsigned varint class id will be written next, package and class name will be omitted.If current class is schema consistent, then num field will be 0 to flag it.If current class isn't schema consistent, then num field will be the number of compatible fields. For example, users can use tag id to mark some field as compatible field in schema consistent context. In such cases, schema consistent fields will be serialized first, then compatible fields will be serialized next. At deserialization, Fory will use fields info of those fields which aren't annotated by tag id for deserializing schema consistent fields, then use fields info in meta for deserializing compatible fields. Package name encoding(omitted when class is registered): encoding algorithm: UTF8/ALL_TO_LOWER_SPECIAL/LOWER_UPPER_DIGIT_SPECIALHeader: 6 bits size | 2 bits encoding flags. The 6 bits size: 0~63 will be used to indicate size 0~63, the value 63 the size need more byte to read, the encoding will encode size - 63 as a varint next. Class name encoding(omitted when class is registered): encoding algorithm: UTF8/LOWER_UPPER_DIGIT_SPECIAL/FIRST_TO_LOWER_SPECIAL/ALL_TO_LOWER_SPECIALheader: 6 bits size | 2 bits encoding flags. The 6 bits size: 0~63 will be used to indicate size 0~63, the value 63 the size need more byte to read, the encoding will encode size - 63 as a varint next. Field info: header(8 bits): 3 bits size + 2 bits field name encoding + polymorphism flag + nullability flag + ref tracking flag. Users can use annotation to provide those info. 2 bits field name encoding: encoding: UTF8/ALL_TO_LOWER_SPECIAL/LOWER_UPPER_DIGIT_SPECIAL/TAG_IDIf tag id is used, i.e. field name is written by an unsigned varint tag id. 2 bits encoding will be 11. size of field name: The 3 bits size: 0~7 will be used to indicate length 1~7, the value 6 the size read more bytes, the encoding will encode size - 7 as a varint next.If encoding is TAG_ID, then num_bytes of field name will be used to store tag id. ref tracking: when set to 1, ref tracking will be enabled for this field.nullability: when set to 1, this field can be null.polymorphism: when set to 1, the actual type of field will be the declared field type even the type if not final. type id: For registered type-consistent classes, it will be the registered class id.Otherwise it will be encoded as OBJECT_ID if it isn't final and FINAL_OBJECT_ID if it's final. The meta for such types is written separately instead of inlining here is to reduce meta space cost if object of this type is serialized in current object graph multiple times, and the field value may be null too. Field name: If type id is set, type id will be used instead. Otherwise meta string encoding length and data will be written instead.  Field order are left as implementation details, which is not exposed to specification, the deserialization need to resort fields based on Fory field comparator. In this way, fory can compute statistics for field names or types and using a more compact encoding.  ","version":"0.14","tagName":"h3"},{"title":"Other layers class meta‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.14/specification/java_serialization_spec#other-layers-class-meta","content":" Same encoding algorithm as the previous layer except:  header + package name: Header: If package name has been written before: varint index + sharing flag(set) will be writtenIf package name hasn't been written before: If meta string encoding is LOWER_SPECIAL and the length of encoded string &lt;= 64, then header will be6 bits size + encoding flag(set) + sharing flag(unset).Otherwise, header will be 3 bits unset + 3 bits encoding flags + encoding flag(unset) + sharing flag(unset)  ","version":"0.14","tagName":"h3"},{"title":"Meta String‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.14/specification/java_serialization_spec#meta-string","content":" Meta string is mainly used to encode meta strings such as class name and field names.  ","version":"0.14","tagName":"h2"},{"title":"Encoding Algorithms‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.14/specification/java_serialization_spec#encoding-algorithms","content":" String binary encoding algorithm:  Algorithm\tPattern\tDescriptionLOWER_SPECIAL\ta-z._$|\tevery char is written using 5 bits, a-z: 0b00000~0b11001, ._$|: 0b11010~0b11101, prepend one bit at the start to indicate whether strip last char since last byte may have 7 redundant bits(1 indicates strip last char) LOWER_UPPER_DIGIT_SPECIAL\ta-zA-Z0~9._\tevery char is written using 6 bits, a-z: 0b00000~0b11001, A-Z: 0b11010~0b110011, 0~9: 0b110100~0b111101, ._: 0b111110~0b111111, prepend one bit at the start to indicate whether strip last char since last byte may have 7 redundant bits(1 indicates strip last char) UTF-8\tany chars\tUTF-8 encoding  Encoding flags:  Encoding Flag\tPattern\tEncoding AlgorithmLOWER_SPECIAL\tevery char is in a-z._$|\tLOWER_SPECIAL FIRST_TO_LOWER_SPECIAL\tevery char is in a-z[c1,c2] except first char is upper case\treplace first upper case char to lower case, then use LOWER_SPECIAL ALL_TO_LOWER_SPECIAL\tevery char is in a-zA-Z[c1,c2]\treplace every upper case char by | + lower case, then use LOWER_SPECIAL, use this encoding if it's smaller than Encoding LOWER_UPPER_DIGIT_SPECIAL LOWER_UPPER_DIGIT_SPECIAL\tevery char is in a-zA-Z[c1,c2]\tuse LOWER_UPPER_DIGIT_SPECIAL encoding if it's smaller than Encoding FIRST_TO_LOWER_SPECIAL UTF8\tany utf-8 char\tuse UTF-8 encoding Compression\tany utf-8 char\tlossless compression  Notes:  For package name encoding, c1,c2 should be ._; For field/type name encoding, c1,c2 should be _$;Depending on cases, one can choose encoding flags + data jointly, uses 3 bits of first byte for flags and other bytes for data.  ","version":"0.14","tagName":"h3"},{"title":"Shared meta string‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.14/specification/java_serialization_spec#shared-meta-string","content":" The shared meta string format consists of header and encoded string binary. Header of encoded string binary will be inlined in shared meta header.  Header is written using little endian order, Fory can read this flag first to determine how to deserialize the data.  Write by data‚Äã  If string hasn't been written before, the data will be written as follows:  | unsigned varint: string binary size + 1 bit: not written before | 56 bits: unique hash | 3 bits encoding flags + string binary |   If string binary size is less than 16 bytes, the hash will be omitted to save spaces. Unique hash can be omitted too if caller pass a flag to disable it. In such cases, the format will be:  | unsigned varint: string binary size + 1 bit: not written before | 3 bits encoding flags + string binary |   Write by ref‚Äã  If string has been written before, the data will be written as follows:  | unsigned varint: written string id + 1 bit: written before |   ","version":"0.14","tagName":"h3"},{"title":"Value Format‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.14/specification/java_serialization_spec#value-format","content":" ","version":"0.14","tagName":"h2"},{"title":"Basic types‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.14/specification/java_serialization_spec#basic-types","content":" Bool‚Äã  size: 1 byteformat: 0 for false, 1 for true  Byte‚Äã  size: 1 byteformat: write as pure byte.  Short‚Äã  size: 2 bytebyte order: little endian order  Char‚Äã  size: 2 bytebyte order: little endian order  Unsigned int‚Äã  size: 1~5 byteFormat: The most significant bit (MSB) in every byte indicates whether to have the next byte. If first bit is set i.e. b &amp; 0x80 == 0x80, then the next byte should be read until the first bit of the next byte is unset.  Signed int‚Äã  size: 1~5 byteFormat: First convert the number into positive unsigned int by (v &lt;&lt; 1) ^ (v &gt;&gt; 31) ZigZag algorithm, then encoding it as an unsigned int.  Unsigned long‚Äã  size: 1~9 byteFory PVL(Progressive Variable-length Long) Encoding: positive long format: first bit in every byte indicates whether to have the next byte. If first bit is set i.e. b &amp; 0x80 == 0x80, then the next byte should be read until the first bit is unset.  Signed long‚Äã  size: 1~9 byteFory SLI(Small long as int) Encoding: If long is in [-1073741824, 1073741823], encode as 4 bytes int: | little-endian: ((int) value) &lt;&lt; 1 |Otherwise write as 9 bytes: | 0b1 | little-endian 8 bytes long | Fory PVL(Progressive Variable-length Long) Encoding: First convert the number into positive unsigned long by (v &lt;&lt; 1) ^ (v &gt;&gt; 63) ZigZag algorithm to reduce cost of small negative numbers, then encoding it as an unsigned long.  Float‚Äã  size: 4 byteformat: convert float to 4 bytes int by Float.floatToRawIntBits, then write as binary by little endian order.  Double‚Äã  size: 8 byteformat: convert double to 8 bytes int by Double.doubleToRawLongBits, then write as binary by little endian order.  ","version":"0.14","tagName":"h3"},{"title":"String‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.14/specification/java_serialization_spec#string","content":" Format:  | header: size &lt;&lt; 2 | 2 bits encoding flags | binary data |   size + encoding will be concat as a long and encoded as an unsigned var long. The little 2 bits is used for encoding: 0 for latin, 1 for utf-16, 2 for utf-8.encoded string binary data based on encoding: latin/utf-16/utf-8.  Which encoding to choose:  For JDK8: fory detect latin at runtime, if string is latin string, then use latin encoding, otherwise use utf-16.For JDK9+: fory use coder in String object for encoding, latin/utf-16 will be used for encoding.If the string is encoded by utf-8, then fory will use utf-8 to decode the data. But currently fory doesn't enable utf-8 encoding by default for java. Cross-language string serialization of fory uses utf-8 by default.  ","version":"0.14","tagName":"h3"},{"title":"Collection‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.14/specification/java_serialization_spec#collection","content":" All collection serializers must extend CollectionLikeSerializer.  Format:  length(unsigned varint) | collection header | elements header | elements data   Collection header‚Äã  For ArrayList/LinkedArrayList/HashSet/LinkedHashSet, this will be empty.For TreeSet, this will be ComparatorFor subclass of ArrayList, this may be extra object field info.  Elements header‚Äã  In most cases, all collection elements are same type and not null, elements header will encode those homogeneous information to avoid the cost of writing it for every element. Specifically, there are four kinds of information which will be encoded by elements header, each use one bit:  If track elements ref, use the first bit 0b1 of the header to flag it.If the collection has null, use the second bit 0b10 of the header to flag it. If ref tracking is enabled for this element type, this flag is invalid.If the collection element types are the declared type, use the 3rd bit 0b100 of the header to flag it.If the collection element types are same, use the 4th bit 0b1000 header to flag it.  By default, all bits are unset, which means all elements won't track ref, all elements are same type, not null and the actual element is the declared type in the custom class field.  The implementation can generate different deserialization code based read header, and look up the generated code from a linear map/list.  Elements data‚Äã  Based on the elements header, the serialization of elements data may skip ref flag/null flag/element class info.  CollectionSerializer#write/read can be taken as an example.  ","version":"0.14","tagName":"h3"},{"title":"Array‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.14/specification/java_serialization_spec#array","content":" Primitive array‚Äã  Primitive array are taken as a binary buffer, serialization will just write the length of array size as an unsigned int, then copy the whole buffer into the stream.  Such serialization won't compress the array. If users want to compress primitive array, users need to register custom serializers for such types.  Object array‚Äã  Object array is serialized using the collection format. Object component type will be taken as collection element generic type.  ","version":"0.14","tagName":"h3"},{"title":"Map‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.14/specification/java_serialization_spec#map","content":" All Map serializers must extend MapLikeSerializer.  Format:  | length(unsigned varint) | map header | key value pairs data |   Map header‚Äã  For HashMap/LinkedHashMap, this will be empty.For TreeMap, this will be ComparatorFor other Map, this may be extra object field info.  Map Key-Value data‚Äã  Map iteration is too expensive, Fory won't compute the header like for collection before since it introduceconsiderable overhead. Users can use MapFieldInfo annotation to provide header in advance. Otherwise Fory will use first key-value pair to predict header optimistically, and update the chunk header if the prediction failed at some pair.  Fory will serialize map chunk by chunk, every chunk has 127 pairs at most.  | 1 byte | 1 byte | variable bytes | +----------------+----------------+-----------------+ | KV header | chunk size: N | N*2 objects |   KV header:  If track key ref, use the first bit 0b1 of the header to flag it.If the key has null, use the second bit 0b10 of the header to flag it. If ref tracking is enabled for this key type, this flag is invalid.If the actual key type of map is the declared key type, use the 3rd bit 0b100 of the header to flag it.If track value ref, use the 4th bit 0b1000 of the header to flag it.If the value has null, use the 5th bit 0b10000 of the header to flag it. If ref tracking is enabled for this value type, this flag is invalid.If the value type of map is the declared value type, use the 6rd bit 0b100000 of the header to flag it.If key or value is null, that key and value will be written as a separate chunk, and chunk size writing will be skipped too.  If streaming write is enabled, which means Fory can't update written chunk size. In such cases, map key-value data format will be:  | 1 byte | variable bytes | +----------------+-----------------+ | KV header | N*2 objects |   KV header will be a header marked by MapFieldInfo in java. The implementation can generate different deserialization code based read header, and look up the generated code from a linear map/list.  ","version":"0.14","tagName":"h3"},{"title":"Enum‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.14/specification/java_serialization_spec#enum","content":" Enums are serialized as an unsigned var int. If the order of enum values change, the deserialized enum value may not be the value users expect. In such cases, users must register enum serializer by make it write enum value as an enumerated string with unique hash disabled.  ","version":"0.14","tagName":"h3"},{"title":"Object‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.14/specification/java_serialization_spec#object","content":" Object means object of pojo/struct/bean/record type. Object will be serialized by writing its fields data in fory order.  Depending on schema compatibility, objects will have different formats.  Field order‚Äã  Field will be ordered as following, every group of fields will have its own order:  primitive fields: larger size type first, smaller later, variable size type last.boxed primitive fields: same order as primitive fieldsfinal fields: same type together, then sorted by field name lexicographically.collection fields: same order as final fieldsmap fields: same order as final fieldsother fields: same order as final fields  Schema consistent‚Äã  Object fields will be serialized one by one using following format:  Primitive field value: | var bytes | +----------------+ | value data | +----------------+ Boxed field value: | one byte | var bytes | +-----------+---------------+ | null flag | field value | +-----------+---------------+ field value of final type with ref tracking: | var bytes | var objects | +-----------+-------------+ | ref meta | value data | +-----------+-------------+ field value of final type without ref tracking: | one byte | var objects | +-----------+-------------+ | null flag | field value | +-----------+-------------+ field value of non-final type with ref tracking: | one byte | var bytes | var objects | +-----------+-------------+-------------+ | ref meta | class meta | value data | +-----------+-------------+-------------+ field value of non-final type without ref tracking: | one byte | var bytes | var objects | +-----------+------------+------------+ | null flag | class meta | value data | +-----------+------------+------------+   Schema evolution‚Äã  Schema evolution have similar format as schema consistent mode for object except:  For this object type itself, schema consistent mode will write class by id/name, but schema evolution mode will write class field names, types and other meta too, see Class meta.Class meta of final custom type needs to be written too, because peers may not have this class defined.  ","version":"0.14","tagName":"h3"},{"title":"Class‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.14/specification/java_serialization_spec#class","content":" Class will be serialized using class meta format.  ","version":"0.14","tagName":"h3"},{"title":"Implementation guidelines‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/0.14/specification/java_serialization_spec#implementation-guidelines","content":" Try to merge multiple bytes into an int/long write before writing to reduce memory IO and bound check cost.Read multiple bytes as an int/long, then split into multiple bytes to reduce memory IO and bound check cost.Try to use one varint/long to write flags and length together to save one byte cost and reduce memory io.Condition branches are less expensive compared to memory IO cost unless there are too many branches. ","version":"0.14","tagName":"h2"},{"title":"Row Format","type":0,"sectionRef":"#","url":"/docs/0.14/specification/row_format_spec","content":"","keywords":"","version":"0.14"},{"title":"Overview‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#overview","content":" Apache Fory Row Format is a cache-friendly, random-access binary format designed for high-performance data processing. Unlike traditional serialization formats that require full deserialization, the row format enables:  Random Field Access: Read individual fields without deserializing the entire rowZero-Copy Operations: Direct memory access without data transformationCache-Friendly Layout: Optimized memory layout for CPU cache efficiencyCross-Language Support: Consistent binary format across Java, C++, and Python  Fory provides two row format variants:  Format\tLanguages\tUse CaseStandard Format\tJava, C++, Python\tCross-language compatibility Compact Format\tJava only\tSpace efficiency, smaller rows  ","version":"0.14","tagName":"h2"},{"title":"Format Comparison‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#format-comparison","content":" Feature\tStandard Format\tCompact FormatField Slot Size\tFixed 8 bytes\tNatural width (1, 2, 4, or 8 bytes) Null Bitmap Size\t8-byte aligned\tByte-aligned, can borrow padding Null Bitmap Position\tBefore field slots\tAfter field slots (at end) Fixed-Size Structs\tVariable region (offset+size)\tInline in fixed region Field Ordering\tSchema-defined order\tSorted by alignment All Non-Nullable\tBitmap still present\tBitmap skipped entirely Alignment\tStrict 8-byte\tRelaxed (2, 4, or 8-byte)    ","version":"0.14","tagName":"h2"},{"title":"Standard Row Format‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#standard-row-format","content":" The standard format prioritizes cross-language compatibility and simplicity with uniform 8-byte field slots.  ","version":"0.14","tagName":"h2"},{"title":"Design Principles‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#design-principles","content":" 8-Byte Alignment: All major structures are aligned to 8-byte boundaries for optimal memory accessFixed-Width Field Slots: Every field uses an 8-byte slot for uniform offset calculationNull Bitmap: Compact null tracking using bit vectorsRelative Offsets: Variable-length data uses relative offsets for sub-buffer navigation  ","version":"0.14","tagName":"h3"},{"title":"Row Binary Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#row-binary-layout","content":" A row stores structured data with the following layout:  +----------------+------------------+------------------+-----+------------------+------------------+ | Null Bitmap | Field 0 Slot | Field 1 Slot | ... | Field N-1 Slot | Variable Data | +----------------+------------------+------------------+-----+------------------+------------------+ | B bytes | 8 bytes | 8 bytes | | 8 bytes | Variable size |   Null Bitmap‚Äã  The null bitmap tracks which fields contain null values:  Size: ((num_fields + 63) / 64) * 8 bytes (rounded up to nearest 8-byte word)Encoding: Each bit corresponds to a field index Bit value 1 = field is nullBit value 0 = field is not null Bit Order: Bit 0 of the first byte corresponds to field 0  Example: For 10 fields, bitmap size = ((10 + 63) / 64) * 8 = 8 bytes  Field Slots‚Äã  Each field occupies a fixed 8-byte slot regardless of its actual data type:  Slot Offset: bitmap_size + field_index * 8Total Fixed Region: bitmap_size + num_fields * 8 bytes  Field Slot Contents by Type:  Type Category\tSlot ContentsFixed-width\tValue stored directly (zero-padded) Variable-width\tOffset + Size encoding (see below)  Variable-Width Data Encoding‚Äã  Variable-length fields (strings, arrays, maps, nested structs) store an offset-size pair in their slot:  +---------------------------+---------------------------+ | Relative Offset | Size | | (32 bits) | (32 bits) | +---------------------------+---------------------------+ |&lt;-------------- 64-bit field slot value --------------&gt;|   Relative Offset (upper 32 bits): Offset from the row's base addressSize (lower 32 bits): Size of the variable-width data in bytes  Encoding:  offset_and_size = (relative_offset &lt;&lt; 32) | size   Decoding:  relative_offset = (offset_and_size &gt;&gt; 32) &amp; 0xFFFFFFFF size = offset_and_size &amp; 0xFFFFFFFF   Variable Data Region‚Äã  Variable-length data is stored after the fixed region:  Data is written sequentially as fields are setEach variable-length value is padded to 8-byte alignmentPadding bytes are zeroed for deterministic output  ","version":"0.14","tagName":"h3"},{"title":"Array Binary Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#array-binary-layout","content":" Arrays store homogeneous sequences of elements:  +------------------+------------------+------------------+ | Element Count | Null Bitmap | Element Data | +------------------+------------------+------------------+ | 8 bytes | B bytes | Variable size |   Array Header‚Äã  Field\tSize\tDescriptionElement Count\t8 bytes\tNumber of elements (uint64) Null Bitmap\t((count + 63) / 64) * 8 bytes\tPer-element null flags  Header Size: 8 + ((num_elements + 63) / 64) * 8 bytes  Array Element Data‚Äã  Elements are stored contiguously after the header:  Fixed-width elements: Stored with their natural width (1, 2, 4, or 8 bytes)Variable-width elements: Stored as 8-byte offset+size pairs  Element Offset: header_size + element_index * element_size  Data Region Size: Rounded up to nearest 8-byte boundary  Array Element Sizes‚Äã  Element Type\tElement Sizebool\t1 byte int8\t1 byte int16\t2 bytes int32\t4 bytes int64\t8 bytes float32\t4 bytes float64\t8 bytes string/binary\t8 bytes (offset+size) array/map/struct\t8 bytes (offset+size)  ","version":"0.14","tagName":"h3"},{"title":"Map Binary Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#map-binary-layout","content":" Maps store key-value pairs as two separate arrays:  +------------------+------------------+------------------+ | Keys Array Size | Keys Array | Values Array | +------------------+------------------+------------------+ | 8 bytes | Variable size | Variable size |   Map Structure‚Äã  Field\tSize\tDescriptionKeys Array Size\t8 bytes\tTotal size of keys array in bytes Keys Array\tVariable\tFull array structure for keys Values Array\tVariable\tFull array structure for values  Keys Array Offset: base_offset + 8Values Array Offset: base_offset + 8 + keys_array_size  Both keys and values arrays follow the standard array binary layout.  ","version":"0.14","tagName":"h3"},{"title":"Nested Struct Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#nested-struct-layout","content":" Nested structs are stored as complete row structures within the variable data region:  Parent field slot contains offset+size pointing to nested rowNested row has its own null bitmap and field slotsSupports arbitrary nesting depth  Parent Row: +----------------+------------------+------------------+ | Null Bitmap | ... Slots ... | Nested Row Data | +----------------+------------------+------------------+ | ^ | offset+size | +-------------------&gt;+ Nested Row: +----------------+------------------+------------------+ | Null Bitmap | Field Slots | Variable Data | +----------------+------------------+------------------+     ","version":"0.14","tagName":"h3"},{"title":"Compact Row Format (Java Only)‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#compact-row-format-java-only","content":" The compact format provides space-efficient encoding with additional optimizations. It is currently implemented in Java only.  Note: The compact format is still under development and may not be stable yet.  ","version":"0.14","tagName":"h2"},{"title":"Design Principles‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#design-principles-1","content":" Natural Width Storage: Fixed-size fields use their natural byte width instead of 8 bytesAlignment-Based Field Sorting: Fields are sorted by alignment requirements to minimize paddingConditional Null Bitmap: Null bitmap is omitted when all fields are non-nullableInline Fixed-Size Structs: Nested structs with all fixed-size fields are stored inline  ","version":"0.14","tagName":"h3"},{"title":"Compact Row Binary Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#compact-row-binary-layout","content":" +------------------+------------------+-----+------------------+----------------+------------------+ | Field 0 Value | Field 1 Value | ... | Field N-1 Value | Null Bitmap | Variable Data | +------------------+------------------+-----+------------------+----------------+------------------+ | W0 bytes | W1 bytes | | WN-1 bytes | B bytes (opt) | Variable size |   Key Differences from Standard Format‚Äã  Field Slot Sizes: Each field uses its natural width (Wi = type width or 8 for variable)Null Bitmap Position: Placed after field slots, can borrow alignment paddingField Order: Fields are sorted by alignment (8-byte ‚Üí 4-byte ‚Üí 2-byte ‚Üí 1-byte ‚Üí variable)Conditional Bitmap: Skipped entirely if all fields are non-nullable  Null Bitmap (Compact)‚Äã  Size: (num_nullable_fields + 7) / 8 bytes (byte-aligned, not 8-byte aligned)Skipped: When all fields are primitive/non-nullablePosition: After all fixed-size field slots, can use alignment padding space  Field Sorting Algorithm‚Äã  Fields are sorted to minimize padding and optimize alignment:  Priority order (highest to lowest): 1. Fields with 8-byte alignment (int64, float64, variable-width) 2. Fields with 4-byte alignment (int32, float32) 3. Fields with 2-byte alignment (int16) 4. Fields with 1-byte alignment (int8, bool)   Within each alignment group, larger fields come first.  Fixed-Size Struct Inlining‚Äã  Nested structs with all fixed-size fields are stored inline in the parent row:  Standard Format (nested struct with 2 int32 fields):  Parent slot: [offset (4 bytes) | size (4 bytes)] ‚Üí Points to nested row (8+ bytes elsewhere)   Compact Format (same nested struct):  Parent slot: [int32 field 0 | int32 field 1] ‚Üí 8 bytes total, inline   This eliminates the offset+size indirection for fixed-size nested structures.  Fixed-Width Calculation‚Äã  A field's fixed width is determined recursively:  Primitive types: Natural byte width (1, 2, 4, or 8)Struct types: Sum of all child fixed widths (if all children are fixed-width)Variable types (string, array, map): Returns -1 (uses 8-byte offset+size slot)  fixed_width(field) = if primitive: type_width if struct and all_children_fixed: header_bytes + sum(fixed_width(child) for each child) else: -1 (variable, uses 8-byte slot)   ","version":"0.14","tagName":"h3"},{"title":"Compact Array Binary Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#compact-array-binary-layout","content":" +------------------+------------------+------------------+ | Element Count | Null Bitmap | Element Data | +------------------+------------------+------------------+ | 4 bytes | B bytes (opt) | Variable size |   Compact Array Header‚Äã  Field\tSize\tDescriptionElement Count\t4 bytes\tNumber of elements (int32) Null Bitmap\t(count + 7) / 8 bytes (opt)\tPer-element null flags  Header Size Calculation:  header_size = 4 + (element_nullable ? (num_elements + 7) / 8 : 0) // Round to 8-byte boundary only if element width is 8-byte aligned if (fixed_width % 8 == 0): header_size = round_to_8_bytes(header_size)   Key Differences from Standard Array‚Äã  Element Count: 4 bytes instead of 8 bytesNull Bitmap: Byte-aligned, skipped if elements are non-nullableFixed-Size Structs: Inline storage for fixed-width struct elements    ","version":"0.14","tagName":"h3"},{"title":"Common Specifications‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#common-specifications","content":" The following specifications apply to both standard and compact formats.  ","version":"0.14","tagName":"h2"},{"title":"Type Encoding‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#type-encoding","content":" Primitive Types‚Äã  Type\tWidth\tEncodingbool\t1 byte\t0x00 (false) or 0x01 (true) int8\t1 byte\tTwo's complement int16\t2 bytes\tTwo's complement, little-endian int32\t4 bytes\tTwo's complement, little-endian int64\t8 bytes\tTwo's complement, little-endian float32\t4 bytes\tIEEE 754 single precision float64\t8 bytes\tIEEE 754 double precision  Temporal Types‚Äã  Type\tWidth\tEncodingtimestamp\t8 bytes\tMicroseconds since Unix epoch (int64) date32\t4 bytes\tDays since Unix epoch (int32) duration\t8 bytes\tDuration in microseconds (int64)  String and Binary‚Äã  Encoding: UTF-8 for strings, raw bytes for binaryStorage: Offset+size pair in field slot, data in variable regionPadding: Data padded to 8-byte alignment (standard) or natural alignment (compact)  ","version":"0.14","tagName":"h3"},{"title":"Null Handling‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#null-handling","content":" Row Null Handling‚Äã  Null fields have their corresponding bit set to 1 in the null bitmapField slot contents are undefined for null fields (standard) or zeroed (compact)Reading a null field returns a null/empty value indicator  Array Null Handling‚Äã  Null elements have their corresponding bit set to 1 in the array's null bitmapElement data is undefined for null elementsCompact format: Bitmap skipped if elements are non-nullable  Variable-Width Null Semantics‚Äã  When reading variable-width data from a null field:  Returns size of -1 or equivalent null indicatorNo data access is performed  ","version":"0.14","tagName":"h3"},{"title":"Alignment and Padding‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#alignment-and-padding","content":" Standard Format Alignment‚Äã  Null Bitmap: Size rounded to 8-byte boundaryField Slots: Always 8 bytes eachVariable Data: Each value padded to 8-byte boundaryArray Data: Total data region padded to 8-byte boundary  Compact Format Alignment‚Äã  Field Slots: Natural width (1, 2, 4, or 8 bytes)Null Bitmap: Byte-aligned, placed after fieldsVariable Data: Padded to 8-byte boundary only when neededHeader: May use relaxed alignment for smaller overhead  Padding Bytes‚Äã  All padding bytes must be set to zeroEnsures deterministic serialization outputPrevents information leakage from uninitialized memory  ","version":"0.14","tagName":"h3"},{"title":"Size Calculations‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#size-calculations","content":" ","version":"0.14","tagName":"h2"},{"title":"Standard Row Size‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#standard-row-size","content":" row_size = bitmap_size + num_fields * 8 + variable_data_size where: bitmap_size = ((num_fields + 63) / 64) * 8 variable_data_size = sum of (padded_size for each variable field) padded_size = ((size + 7) / 8) * 8   ","version":"0.14","tagName":"h3"},{"title":"Compact Row Size‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#compact-row-size","content":" row_size = fixed_region_size + bitmap_size + variable_data_size where: fixed_region_size = sum of (fixed_width(field) or 8 for each field) bitmap_size = all_non_nullable ? 0 : (num_nullable_fields + 7) / 8 // May be rounded to 8-byte boundary if has variable fields   ","version":"0.14","tagName":"h3"},{"title":"Standard Array Size‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#standard-array-size","content":" array_size = header_size + data_size where: header_size = 8 + ((num_elements + 63) / 64) * 8 data_size = ((num_elements * element_size + 7) / 8) * 8   ","version":"0.14","tagName":"h3"},{"title":"Compact Array Size‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#compact-array-size","content":" array_size = header_size + data_size where: header_size = 4 + (element_nullable ? (num_elements + 7) / 8 : 0) // header_size rounded to 8 if element_width % 8 == 0 data_size = num_elements * element_width   ","version":"0.14","tagName":"h3"},{"title":"Map Size‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#map-size","content":" map_size = 8 + keys_array_size + values_array_size   ","version":"0.14","tagName":"h3"},{"title":"Summary Tables‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#summary-tables","content":" ","version":"0.14","tagName":"h2"},{"title":"Layout Summary‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#layout-summary","content":" Component\tStandard Format\tCompact FormatRow Header\t((N + 63) / 64) * 8 bytes\t0 or (N + 7) / 8 bytes (at end) Row Field Slots\tN * 8 bytes\tsum(field_widths) bytes Array Header\t8 + ((E + 63) / 64) * 8 bytes\t4 + (E + 7) / 8 bytes (if nullable) Array Elements\tE * element_size (8-aligned)\tE * element_width Map Header\t8 bytes\t8 bytes Offset+Size Pair\t8 bytes (32-bit offset + size)\t8 bytes (same)  Where N = number of fields, E = number of elements  ","version":"0.14","tagName":"h3"},{"title":"Type Width Summary‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#type-width-summary","content":" Category\tStorage Width\tStandard Slot\tCompact Slotbool\t1 byte\t8 bytes\t1 byte int8\t1 byte\t8 bytes\t1 byte int16\t2 bytes\t8 bytes\t2 bytes int32\t4 bytes\t8 bytes\t4 bytes int64\t8 bytes\t8 bytes\t8 bytes float32\t4 bytes\t8 bytes\t4 bytes float64\t8 bytes\t8 bytes\t8 bytes string/binary\tVariable\t8 bytes\t8 bytes array\tVariable\t8 bytes\t8 bytes map\tVariable\t8 bytes\t8 bytes struct\tVariable\t8 bytes\tinline or 8  ","version":"0.14","tagName":"h3"},{"title":"Implementation Notes‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#implementation-notes","content":" ","version":"0.14","tagName":"h2"},{"title":"Endianness‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#endianness","content":" All multi-byte integers are stored in little-endian formatFloating-point values use native IEEE 754 representation  ","version":"0.14","tagName":"h3"},{"title":"Memory Safety‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#memory-safety","content":" Writers must zero padding bytes to prevent information leakageReaders must validate offsets and sizes before accessing dataBuffer bounds checking is required for untrusted input  ","version":"0.14","tagName":"h3"},{"title":"Performance Considerations‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#performance-considerations","content":" Standard Format:  Fixed 8-byte slots enable O(1) field access with simple arithmetic8-byte alignment optimizes CPU cache line usageBest for cross-language interoperability  Compact Format:  Smaller row sizes reduce memory bandwidthField sorting minimizes padding wasteInline structs eliminate pointer chasingRelaxed alignment may have slight CPU overhead on some architectures  ","version":"0.14","tagName":"h3"},{"title":"When to Use Each Format‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/0.14/specification/row_format_spec#when-to-use-each-format","content":" Scenario\tRecommended FormatCross-language data exchange\tStandard Java-only, memory-constrained\tCompact Many small primitive fields\tCompact Many nested fixed-size structs\tCompact Maximum read performance\tStandard Interoperability with C++/Python\tStandard ","version":"0.14","tagName":"h3"},{"title":"Xlang Type Mapping","type":0,"sectionRef":"#","url":"/docs/0.14/specification/xlang_type_mapping","content":"","keywords":"","version":"0.14"},{"title":"Type Mapping‚Äã","type":1,"pageTitle":"Xlang Type Mapping","url":"/docs/0.14/specification/xlang_type_mapping#type-mapping","content":" Fory Type\tFory Type ID\tJava\tPython\tJavascript\tC++\tGolang\tRustbool\t1\tbool/Boolean\tbool\tBoolean\tbool\tbool\tbool int8\t2\tbyte/Byte\tint/pyfory.Int8\tType.int8()\tint8_t\tint8\ti8 int16\t3\tshort/Short\tint/pyfory.Int16\tType.int16()\tint16_t\tint16\ti6 int32\t4\tint/Integer\tint/pyfory.Int32\tType.int32()\tint32_t\tint32\ti32 var_int32\t5\tint/Integer\tint/pyfory.VarInt32\tType.varint32()\tfory::varint32_t\tfory.varint32\tfory::varint32 int64\t6\tlong/Long\tint/pyfory.Int64\tType.int64()\tint64_t\tint64\ti64 var_int64\t7\tlong/Long\tint/pyfory.VarInt64\tType.varint64()\tfory::varint64_t\tfory.varint64\tfory::varint64 sli_int64\t8\tlong/Long\tint/pyfory.SliInt64\tType.sliint64()\tfory::sliint64_t\tfory.sliint64\tfory::sliint64 float16\t9\tfloat/Float\tfloat/pyfory.Float16\tType.float16()\tfory::float16_t\tfory.float16\tfory::f16 float32\t10\tfloat/Float\tfloat/pyfory.Float32\tType.float32()\tfloat\tfloat32\tf32 float64\t11\tdouble/Double\tfloat/pyfory.Float64\tType.float64()\tdouble\tfloat64\tf64 string\t12\tString\tstr\tString\tstring\tstring\tString/str enum\t13\tEnum subclasses\tenum subclasses\t/\tenum\t/\tenum named_enum\t14\tEnum subclasses\tenum subclasses\t/\tenum\t/\tenum struct\t15\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct compatible_struct\t16\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct named_struct\t17\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct named_compatible_struct\t18\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct ext\t19\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct named_ext\t20\tpojo/record\tdata class / type with type hints\tobject\tstruct/class\tstruct\tstruct list\t21\tList/Collection\tlist/tuple\tarray\tvector\tslice\tVec set\t22\tSet\tset\t/\tset\tfory.Set\tSet map\t23\tMap\tdict\tMap\tunordered_map\tmap\tHashMap duration\t24\tDuration\ttimedelta\tNumber\tduration\tDuration\tDuration timestamp\t25\tInstant\tdatetime\tNumber\tstd::chrono::nanoseconds\tTime\tDateTime local_date\t26\tDate\tdatetime\tNumber\tstd::chrono::nanoseconds\tTime\tDateTime decimal\t27\tBigDecimal\tDecimal\tbigint\t/\t/\t/ binary\t28\tbyte[]\tbytes\t/\tuint8_t[n]/vector&lt;T&gt;\t[n]uint8/[]T\tVec&lt;uint8_t&gt; array\t29\tarray\tnp.ndarray\t/\t/\tarray/slice\tVec bool_array\t30\tbool[]\tndarray(np.bool_)\t/\tbool[n]\t[n]bool/[]T\tVec&lt;bool&gt; int8_array\t31\tbyte[]\tndarray(int8)\t/\tint8_t[n]/vector&lt;T&gt;\t[n]int8/[]T\tVec&lt;i18&gt; int16_array\t32\tshort[]\tndarray(int16)\t/\tint16_t[n]/vector&lt;T&gt;\t[n]int16/[]T\tVec&lt;i16&gt; int32_array\t33\tint[]\tndarray(int32)\t/\tint32_t[n]/vector&lt;T&gt;\t[n]int32/[]T\tVec&lt;i32&gt; int64_array\t34\tlong[]\tndarray(int64)\t/\tint64_t[n]/vector&lt;T&gt;\t[n]int64/[]T\tVec&lt;i64&gt; float16_array\t35\tfloat[]\tndarray(float16)\t/\tfory::float16_t[n]/vector&lt;T&gt;\t[n]float16/[]T\tVec&lt;fory::f16&gt; float32_array\t36\tfloat[]\tndarray(float32)\t/\tfloat[n]/vector&lt;T&gt;\t[n]float32/[]T\tVec&lt;f32&gt; float64_array\t37\tdouble[]\tndarray(float64)\t/\tdouble[n]/vector&lt;T&gt;\t[n]float64/[]T\tVec&lt;f64&gt; union\t38\t/\t/\t/\tstd::variant&lt;Ts...&gt;\t/\ttagged union enum none\t39\tnull\tNone\tnull\tstd::monostate\tnil\t()  ","version":"0.14","tagName":"h2"},{"title":"Type info(not implemented currently)‚Äã","type":1,"pageTitle":"Xlang Type Mapping","url":"/docs/0.14/specification/xlang_type_mapping#type-infonot-implemented-currently","content":" Due to differences between type systems of languages, those types can't be mapped one-to-one between languages.  If the user notices that one type on a language corresponds to multiple types in Fory type systems, for example, longin java has type int64/varint64/sliint64, it means the language lacks some types, and the user must provide extra type info when using Fory.  ","version":"0.14","tagName":"h2"},{"title":"Type annotation‚Äã","type":1,"pageTitle":"Xlang Type Mapping","url":"/docs/0.14/specification/xlang_type_mapping#type-annotation","content":" If the type is a field of another class, users can provide meta hints for fields of a type, or for the whole type. Such information can be provided in other languages too:  java: use annotation.cpp: use macro and template.golang: use struct tag.python: use typehint.rust: use macro.  Here is en example:  Java: class Foo { @Int32Type(varint = true) int f1; List&lt;@Int32Type(varint = true) Integer&gt; f2; } Python: class Foo: f1: Int32Type(varint=True) f2: List[Int32Type(varint=True)]   ","version":"0.14","tagName":"h2"},{"title":"Type wrapper‚Äã","type":1,"pageTitle":"Xlang Type Mapping","url":"/docs/0.14/specification/xlang_type_mapping#type-wrapper","content":" If the type is not a field of a class, the user must wrap this type with a Fory type to pass the extra type info.  For example, suppose Fory Java provide a VarInt64 type, when a user invoke fory.serialize(long_value), he need to invoke like fory.serialize(new VarInt64(long_value)). ","version":"0.14","tagName":"h2"},{"title":"Install","type":0,"sectionRef":"#","url":"/docs/0.14/start/install","content":"","keywords":"","version":"0.14"},{"title":"Java‚Äã","type":1,"pageTitle":"Install","url":"/docs/0.14/start/install#java","content":" To add a dependency on Apache Fory‚Ñ¢ using Maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-core&lt;/artifactId&gt; &lt;version&gt;0.14.1&lt;/version&gt; &lt;/dependency&gt; &lt;!-- Optional row format support --&gt; &lt;!-- &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-format&lt;/artifactId&gt; &lt;version&gt;0.13.1&lt;/version&gt; &lt;/dependency&gt; --&gt; &lt;!-- SIMD acceleration for array compression (Java 16+) --&gt; &lt;!-- &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-simd&lt;/artifactId&gt; &lt;version&gt;0.13.1&lt;/version&gt; &lt;/dependency&gt; --&gt;   ","version":"0.14","tagName":"h2"},{"title":"Scala‚Äã","type":1,"pageTitle":"Install","url":"/docs/0.14/start/install#scala","content":" To add a dependency on Apache Fory‚Ñ¢ scala for scala 2.13 with maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-scala_2.13&lt;/artifactId&gt; &lt;version&gt;0.14.1&lt;/version&gt; &lt;/dependency&gt;   To add a dependency on Apache Fory‚Ñ¢ scala for scala 3 with maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-scala_3&lt;/artifactId&gt; &lt;version&gt;0.14.1&lt;/version&gt; &lt;/dependency&gt;   To add a dependency on Apache Fory‚Ñ¢ scala for scala 2.13 with sbt, use the following:  libraryDependencies += &quot;org.apache.fory&quot; % &quot;fory-scala_2.13&quot; % &quot;0.14.1&quot;   To add a dependency on Apache Fory‚Ñ¢ scala for scala 3 with sbt, use the following:  libraryDependencies += &quot;org.apache.fory&quot; % &quot;fory-scala_3&quot; % &quot;0.14.1&quot;   ","version":"0.14","tagName":"h2"},{"title":"Kotlin‚Äã","type":1,"pageTitle":"Install","url":"/docs/0.14/start/install#kotlin","content":" To add a dependency on Apache Fory‚Ñ¢ kotlin with maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-kotlin&lt;/artifactId&gt; &lt;version&gt;0.14.1&lt;/version&gt; &lt;/dependency&gt;   ","version":"0.14","tagName":"h2"},{"title":"Python‚Äã","type":1,"pageTitle":"Install","url":"/docs/0.14/start/install#python","content":" python -m pip install --upgrade pip pip install pyfory==0.14.1   ","version":"0.14","tagName":"h2"},{"title":"Rust‚Äã","type":1,"pageTitle":"Install","url":"/docs/0.14/start/install#rust","content":" [dependencies] fory = &quot;0.14&quot;   or just execute command:  cargo add fory@0.14.1   ","version":"0.14","tagName":"h2"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Install","url":"/docs/0.14/start/install#javascript","content":" Apache Fory‚Ñ¢ is NOT yet available on npm, please install from source code now. ","version":"0.14","tagName":"h2"},{"title":"C++ Benchmark Performance Report","type":0,"sectionRef":"#","url":"/docs/next/benchmarks/cpp/","content":"","keywords":"","version":"dev"},{"title":"How to Generate This Report‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/#how-to-generate-this-report","content":" cd benchmarks/cpp/build ./fory_benchmark --benchmark_format=json --benchmark_out=benchmark_results.json cd .. python benchmark_report.py --json-file build/benchmark_results.json --output-dir report   ","version":"dev","tagName":"h2"},{"title":"Hardware & OS Info‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/#hardware--os-info","content":" Key\tValueOS\tDarwin 24.6.0 Machine\tarm64 Processor\tarm CPU Cores (Physical)\t12 CPU Cores (Logical)\t12 Total RAM (GB)\t48.0 Benchmark Date\t2026-02-19T10:19:31+08:00 CPU Cores (from benchmark)\t12  ","version":"dev","tagName":"h2"},{"title":"Benchmark Plots‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/#benchmark-plots","content":" All class-level plots below show throughput (ops/sec).  ","version":"dev","tagName":"h2"},{"title":"Throughput‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/#throughput","content":"   ","version":"dev","tagName":"h3"},{"title":"Mediacontent‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/#mediacontent","content":"   ","version":"dev","tagName":"h3"},{"title":"Mediacontentlist‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/#mediacontentlist","content":"   ","version":"dev","tagName":"h3"},{"title":"Sample‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/#sample","content":"   ","version":"dev","tagName":"h3"},{"title":"Samplelist‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/#samplelist","content":"   ","version":"dev","tagName":"h3"},{"title":"Struct‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/#struct","content":"   ","version":"dev","tagName":"h3"},{"title":"Structlist‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/#structlist","content":"   ","version":"dev","tagName":"h3"},{"title":"Benchmark Results‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/#benchmark-results","content":" ","version":"dev","tagName":"h2"},{"title":"Timing Results (nanoseconds)‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/#timing-results-nanoseconds","content":" Datatype\tOperation\tfory (ns)\tprotobuf (ns)\tmsgpack (ns)\tFastestMediaContent\tSerialize\t120.4\t863.8\t281.1\tfory MediaContent\tDeserialize\t397.9\t1197.9\t2768.6\tfory MediaContentList\tSerialize\t480.9\t4744.3\t1407.5\tfory MediaContentList\tDeserialize\t2022.1\t6426.0\t13595.9\tfory Sample\tSerialize\t72.8\t92.0\t296.1\tfory Sample\tDeserialize\t328.2\t641.2\t2642.9\tfory SampleList\tSerialize\t287.3\t4761.2\t1506.7\tfory SampleList\tDeserialize\t1711.8\t4875.2\t13232.0\tfory Struct\tSerialize\t27.3\t32.4\t55.2\tfory Struct\tDeserialize\t21.4\t25.0\t747.3\tfory StructList\tSerialize\t69.4\t419.8\t285.9\tfory StructList\tDeserialize\t129.4\t334.4\t3385.8\tfory  ","version":"dev","tagName":"h3"},{"title":"Throughput Results (ops/sec)‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/#throughput-results-opssec","content":" Datatype\tOperation\tfory TPS\tprotobuf TPS\tmsgpack TPS\tFastestMediaContent\tSerialize\t8,306,128\t1,157,712\t3,557,700\tfory MediaContent\tDeserialize\t2,513,488\t834,808\t361,190\tfory MediaContentList\tSerialize\t2,079,229\t210,777\t710,492\tfory MediaContentList\tDeserialize\t494,523\t155,617\t73,551\tfory Sample\tSerialize\t13,745,041\t10,871,787\t3,377,292\tfory Sample\tDeserialize\t3,047,224\t1,559,633\t378,369\tfory SampleList\tSerialize\t3,481,110\t210,029\t663,693\tfory SampleList\tDeserialize\t584,168\t205,121\t75,574\tfory Struct\tSerialize\t36,672,581\t30,900,039\t18,114,682\tfory Struct\tDeserialize\t46,637,124\t39,947,557\t1,338,225\tfory StructList\tSerialize\t14,419,548\t2,381,886\t3,497,903\tfory StructList\tDeserialize\t7,729,173\t2,990,652\t295,353\tfory  ","version":"dev","tagName":"h3"},{"title":"Serialized Data Sizes (bytes)‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/#serialized-data-sizes-bytes","content":" Datatype\tfory\tprotobuf\tmsgpackStruct\t58\t61\t55 Sample\t446\t375\t530 MediaContent\t365\t301\t480 StructList\t184\t315\t289 SampleList\t1980\t1890\t2664 MediaContentList\t1535\t1520\t2421 ","version":"dev","tagName":"h3"},{"title":"C++ Benchmark Performance Report","type":0,"sectionRef":"#","url":"/docs/next/benchmarks/cpp/REPORT","content":"","keywords":"","version":"dev"},{"title":"How to Generate This Report‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/REPORT#how-to-generate-this-report","content":" cd benchmarks/cpp/build ./fory_benchmark --benchmark_format=json --benchmark_out=benchmark_results.json cd .. python benchmark_report.py --json-file build/benchmark_results.json --output-dir report   ","version":"dev","tagName":"h2"},{"title":"Hardware & OS Info‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/REPORT#hardware--os-info","content":" Key\tValueOS\tDarwin 24.6.0 Machine\tarm64 Processor\tarm CPU Cores (Physical)\t12 CPU Cores (Logical)\t12 Total RAM (GB)\t48.0 Benchmark Date\t2026-02-06T20:00:20+08:00 CPU Cores (from benchmark)\t12  ","version":"dev","tagName":"h2"},{"title":"Benchmark Plots‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/REPORT#benchmark-plots","content":" ","version":"dev","tagName":"h2"},{"title":"Mediacontent‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/REPORT#mediacontent","content":"   ","version":"dev","tagName":"h3"},{"title":"Mediacontentlist‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/REPORT#mediacontentlist","content":"   ","version":"dev","tagName":"h3"},{"title":"Sample‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/REPORT#sample","content":"   ","version":"dev","tagName":"h3"},{"title":"Samplelist‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/REPORT#samplelist","content":"   ","version":"dev","tagName":"h3"},{"title":"Struct‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/REPORT#struct","content":"   ","version":"dev","tagName":"h3"},{"title":"Structlist‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/REPORT#structlist","content":"   ","version":"dev","tagName":"h3"},{"title":"Throughput‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/REPORT#throughput","content":"   ","version":"dev","tagName":"h3"},{"title":"Benchmark Results‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/REPORT#benchmark-results","content":" ","version":"dev","tagName":"h2"},{"title":"Timing Results (nanoseconds)‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/REPORT#timing-results-nanoseconds","content":" Datatype\tOperation\tFory (ns)\tProtobuf (ns)\tFasterMediacontent\tSerialize\t512.0\t1990.9\tFory (3.9x) Mediacontent\tDeserialize\t1674.1\t2516.6\tFory (1.5x) Mediacontentlist\tSerialize\t2261.0\t10804.2\tFory (4.8x) Mediacontentlist\tDeserialize\t6943.5\t13375.9\tFory (1.9x) Sample\tSerialize\t241.7\t309.4\tFory (1.3x) Sample\tDeserialize\t1055.8\t1361.5\tFory (1.3x) Samplelist\tSerialize\t963.2\t11716.7\tFory (12.2x) Samplelist\tDeserialize\t5295.9\t12162.2\tFory (2.3x) Struct\tSerialize\t117.1\t169.6\tFory (1.4x) Struct\tDeserialize\t138.6\t156.2\tFory (1.1x) Structlist\tSerialize\t308.4\t1299.4\tFory (4.2x) Structlist\tDeserialize\t706.2\t1188.0\tFory (1.7x)  ","version":"dev","tagName":"h3"},{"title":"Throughput Results (ops/sec)‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/REPORT#throughput-results-opssec","content":" Datatype\tOperation\tFory TPS\tProtobuf TPS\tFasterMediacontent\tSerialize\t1,952,940\t502,295\tFory (3.9x) Mediacontent\tDeserialize\t597,343\t397,356\tFory (1.5x) Mediacontentlist\tSerialize\t442,277\t92,557\tFory (4.8x) Mediacontentlist\tDeserialize\t144,020\t74,761\tFory (1.9x) Sample\tSerialize\t4,138,037\t3,232,073\tFory (1.3x) Sample\tDeserialize\t947,188\t734,472\tFory (1.3x) Samplelist\tSerialize\t1,038,236\t85,348\tFory (12.2x) Samplelist\tDeserialize\t188,825\t82,222\tFory (2.3x) Struct\tSerialize\t8,542,313\t5,896,325\tFory (1.4x) Struct\tDeserialize\t7,217,541\t6,403,969\tFory (1.1x) Structlist\tSerialize\t3,242,105\t769,562\tFory (4.2x) Structlist\tDeserialize\t1,416,005\t841,739\tFory (1.7x)  ","version":"dev","tagName":"h3"},{"title":"Serialized Data Sizes (bytes)‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/next/benchmarks/cpp/REPORT#serialized-data-sizes-bytes","content":" Datatype\tFory\tProtobufStruct\t58\t61 Sample\t446\t375 MediaContent\t365\t301 StructList\t184\t315 SampleList\t1980\t1890 MediaContentList\t1535\t1520 ","version":"dev","tagName":"h3"},{"title":"Go Serialization Benchmark Report","type":0,"sectionRef":"#","url":"/docs/next/benchmarks/go/","content":"","keywords":"","version":"dev"},{"title":"System Information‚Äã","type":1,"pageTitle":"Go Serialization Benchmark Report","url":"/docs/next/benchmarks/go/#system-information","content":" OS: Darwin 24.6.0Architecture: arm64Python: 3.10.8  ","version":"dev","tagName":"h2"},{"title":"Performance Charts‚Äã","type":1,"pageTitle":"Go Serialization Benchmark Report","url":"/docs/next/benchmarks/go/#performance-charts","content":"   ","version":"dev","tagName":"h2"},{"title":"Performance Summary‚Äã","type":1,"pageTitle":"Go Serialization Benchmark Report","url":"/docs/next/benchmarks/go/#performance-summary","content":" Data Type\tOperation\tFory (ops/s)\tProtobuf (ops/s)\tMsgpack (ops/s)\tFory vs PB\tFory vs MPStruct\tSerialize\t15.16M\t10.23M\t5.41M\t1.48x\t2.80x Struct\tDeserialize\t12.10M\t11.01M\t3.23M\t1.10x\t3.75x Structlist\tSerialize\t1.58M\t561K\t299K\t2.82x\t5.28x Structlist\tDeserialize\t1.10M\t529K\t175K\t2.09x\t6.30x Sample\tSerialize\t7.28M\t2.72M\t670K\t2.68x\t10.87x Sample\tDeserialize\t3.79M\t2.37M\t376K\t1.60x\t10.09x Samplelist\tSerialize\t510K\t141K\t38K\t3.61x\t13.34x Samplelist\tDeserialize\t236K\t107K\t19K\t2.20x\t12.66x Mediacontent\tSerialize\t3.72M\t2.12M\t1.29M\t1.75x\t2.88x Mediacontent\tDeserialize\t2.34M\t1.81M\t698K\t1.30x\t3.35x Mediacontentlist\tSerialize\t268K\t110K\t72K\t2.44x\t3.72x Mediacontentlist\tDeserialize\t138K\t87K\t36K\t1.58x\t3.86x  ","version":"dev","tagName":"h2"},{"title":"Detailed Timing (ns/op)‚Äã","type":1,"pageTitle":"Go Serialization Benchmark Report","url":"/docs/next/benchmarks/go/#detailed-timing-nsop","content":" Data Type\tOperation\tFory\tProtobuf\tMsgpackStruct\tSerialize\t66.0\t97.8\t184.9 Struct\tDeserialize\t82.7\t90.9\t309.6 Structlist\tSerialize\t632.8\t1783.0\t3340.0 Structlist\tDeserialize\t906.4\t1891.0\t5709.0 Sample\tSerialize\t137.3\t367.3\t1492.0 Sample\tDeserialize\t263.6\t422.2\t2661.0 Samplelist\tSerialize\t1962.0\t7087.0\t26169.0 Samplelist\tDeserialize\t4234.0\t9321.0\t53615.0 Mediacontent\tSerialize\t268.8\t471.1\t773.7 Mediacontent\tDeserialize\t426.9\t553.1\t1432.0 Mediacontentlist\tSerialize\t3736.0\t9107.0\t13911.0 Mediacontentlist\tDeserialize\t7247.0\t11435.0\t27975.0  ","version":"dev","tagName":"h2"},{"title":"Serialized Data Sizes (bytes)‚Äã","type":1,"pageTitle":"Go Serialization Benchmark Report","url":"/docs/next/benchmarks/go/#serialized-data-sizes-bytes","content":" Data Type\tFory\tProtobuf\tMsgpackStruct\t58\t61\t57 Sample\t446\t375\t524 MediaContent\t342\t301\t400 StructList\t560\t1260\t1146 SampleList\t7600\t7560\t10486 MediaContentList\t5776\t6080\t8006 ","version":"dev","tagName":"h3"},{"title":"README","type":0,"sectionRef":"#","url":"/docs/next/benchmarks/rust/","content":"","keywords":"","version":"dev"},{"title":"Performance Comparison Report‚Äã","type":1,"pageTitle":"README","url":"/docs/next/benchmarks/rust/#performance-comparison-report","content":" Generated on 2025-10-26 18:36:41  How to generate performance report:  cd benchmarks/rust cargo bench 2&gt;&amp;1 | tee cargo_bench.log python benchmark_report.py --log-file cargo_bench.log --output-dir=report_output   ","version":"dev","tagName":"h2"},{"title":"Hardware & OS Info‚Äã","type":1,"pageTitle":"README","url":"/docs/next/benchmarks/rust/#hardware--os-info","content":" Key\tValueOS\tDarwin 24.5.0 Machine\tarm64 Processor\tarm CPU Cores (Physical)\t12 CPU Cores (Logical)\t12 Total RAM (GB)\t48.0  ","version":"dev","tagName":"h3"},{"title":"Benchmark Plots‚Äã","type":1,"pageTitle":"README","url":"/docs/next/benchmarks/rust/#benchmark-plots","content":" company    ecommerce_data    person    simple_list    simple_map    simple_struct    system_data    ","version":"dev","tagName":"h3"},{"title":"Serialize Results‚Äã","type":1,"pageTitle":"README","url":"/docs/next/benchmarks/rust/#serialize-results","content":" Datatype\tSize\tOperation\tFory TPS\tJSON TPS\tProtobuf TPS\tFastestcompany\tsmall\tserialize\t10,063,906\t761,673\t896,620\tfory company\tmedium\tserialize\t412,507\t33,835\t37,590\tfory company\tlarge\tserialize\t9,183\t793\t880\tfory ecommerce_data\tsmall\tserialize\t2,350,729\t206,262\t256,970\tfory ecommerce_data\tmedium\tserialize\t59,977\t4,699\t5,242\tfory ecommerce_data\tlarge\tserialize\t3,727\t266\t295\tfory person\tsmall\tserialize\t13,632,522\t1,345,189\t1,475,035\tfory person\tmedium\tserialize\t3,839,656\t337,610\t369,031\tfory person\tlarge\tserialize\t907,853\t79,631\t91,408\tfory simple_list\tsmall\tserialize\t27,726,945\t4,874,957\t4,643,172\tfory simple_list\tmedium\tserialize\t4,770,765\t401,558\t397,551\tfory simple_list\tlarge\tserialize\t606,061\t41,061\t44,565\tfory simple_map\tsmall\tserialize\t22,862,369\t3,888,025\t2,695,999\tfory simple_map\tmedium\tserialize\t2,128,973\t204,319\t193,132\tfory simple_map\tlarge\tserialize\t177,847\t18,419\t18,668\tfory simple_struct\tsmall\tserialize\t35,729,598\t10,167,045\t8,633,342\tfory simple_struct\tmedium\tserialize\t34,988,279\t9,737,098\t6,433,350\tfory simple_struct\tlarge\tserialize\t31,801,558\t4,545,041\t7,420,049\tfory system_data\tsmall\tserialize\t5,382,131\t468,033\t569,930\tfory system_data\tmedium\tserialize\t174,240\t11,896\t14,753\tfory system_data\tlarge\tserialize\t10,671\t876\t1,040\tfory  ","version":"dev","tagName":"h3"},{"title":"Deserialize Results‚Äã","type":1,"pageTitle":"README","url":"/docs/next/benchmarks/rust/#deserialize-results","content":" Datatype\tSize\tOperation\tFory TPS\tJSON TPS\tProtobuf TPS\tFastestcompany\tsmall\tdeserialize\t1,145,593\t718,597\t917,431\tfory company\tmedium\tdeserialize\t35,195\t24,474\t25,057\tfory company\tlarge\tdeserialize\t836\t623\t623\tfory ecommerce_data\tsmall\tdeserialize\t278,427\t183,237\t241,109\tfory ecommerce_data\tmedium\tdeserialize\t5,622\t3,820\t4,249\tfory ecommerce_data\tlarge\tdeserialize\t298\t204\t217\tfory person\tsmall\tdeserialize\t1,924,372\t1,214,388\t1,675,631\tfory person\tmedium\tdeserialize\t371,016\t265,280\t266,333\tfory person\tlarge\tdeserialize\t84,839\t63,975\t61,820\tfory simple_list\tsmall\tdeserialize\t6,129,329\t3,599,582\t4,429,286\tfory simple_list\tmedium\tdeserialize\t460,745\t305,409\t337,336\tfory simple_list\tlarge\tdeserialize\t54,348\t33,962\t38,776\tfory simple_map\tsmall\tdeserialize\t3,686,364\t3,090,426\t3,477,051\tfory simple_map\tmedium\tdeserialize\t171,774\t126,638\t119,323\tfory simple_map\tlarge\tdeserialize\t16,501\t10,920\t10,853\tfory simple_struct\tsmall\tdeserialize\t31,476,235\t12,948,168\t28,280,543\tfory simple_struct\tmedium\tdeserialize\t30,077,902\t10,431,118\t23,012,841\tfory simple_struct\tlarge\tdeserialize\t28,201,585\t8,955,759\t23,528,858\tfory system_data\tsmall\tdeserialize\t644,870\t421,106\t549,209\tfory system_data\tmedium\tdeserialize\t14,322\t9,205\t10,565\tfory system_data\tlarge\tdeserialize\t961\t634\t706\tfory ","version":"dev","tagName":"h3"},{"title":"Xlang Serialization Format","type":0,"sectionRef":"#","url":"/docs/0.14/specification/xlang_serialization_spec","content":"","keywords":"","version":"0.14"},{"title":"Cross-language Serialization Specification‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#cross-language-serialization-specification","content":" Apache Fory‚Ñ¢ xlang serialization enables automatic cross-language object serialization with support for shared references, circular references, and polymorphism. Unlike traditional serialization frameworks that require IDL definitions and schema compilation, Fory serializes objects directly without any intermediate steps.  Key characteristics:  Automatic: No IDL definition, no schema compilation, no manual object-to-protocol conversionCross-language: Same binary format works seamlessly across Java, Python, C++, Rust, Go, JavaScript, and moreReference-aware: Handles shared references and circular references without duplication or infinite recursionPolymorphic: Supports object polymorphism with runtime type resolution  This specification defines the Fory xlang binary format. The format is dynamic rather than static, which enables flexibility and ease of use at the cost of additional complexity in the wire format.  ","version":"0.14","tagName":"h2"},{"title":"Type Systems‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#type-systems","content":" ","version":"0.14","tagName":"h2"},{"title":"Data Types‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#data-types","content":" bool: a boolean value (true or false).int8: a 8-bit signed integer.int16: a 16-bit signed integer.int32: a 32-bit signed integer.var_int32: a 32-bit signed integer which use fory var_int32 encoding.int64: a 64-bit signed integer.var_int64: a 64-bit signed integer which use fory PVL encoding.sli_int64: a 64-bit signed integer which use fory SLI encoding.float16: a 16-bit floating point number.float32: a 32-bit floating point number.float64: a 64-bit floating point number including NaN and Infinity.string: a text string encoded using Latin1/UTF16/UTF-8 encoding.enum: a data type consisting of a set of named values. Rust enum with non-predefined field values are not supported as an enum.named_enum: an enum whose value will be serialized as the registered name.struct: a morphic(final) type serialized by Fory Struct serializer. i.e. it doesn't have subclasses. Suppose we're deserializing List&lt;SomeClass&gt;, we can save dynamic serializer dispatch since SomeClass is morphic(final).compatible_struct: a morphic(final) type serialized by Fory compatible Struct serializer.named_struct: a struct whose type mapping will be encoded as a name.named_compatible_struct: a compatible_struct whose type mapping will be encoded as a name.ext: a type which will be serialized by a customized serializer.named_ext: an ext type whose type mapping will be encoded as a name.list: a sequence of objects.set: an unordered set of unique elements.map: a map of key-value pairs. Mutable types such as list/map/set/array are not allowed as key of map.duration: an absolute length of time, independent of any calendar/timezone, as a count of nanoseconds.timestamp: a point in time, independent of any calendar/timezone, as a count of nanoseconds. The count is relative to an epoch at UTC midnight on January 1, 1970.local_date: a naive date without timezone. The count is days relative to an epoch at UTC midnight on Jan 1, 1970.decimal: exact decimal value represented as an integer value in two's complement.binary: an variable-length array of bytes.array: only allow 1d numeric components. Other arrays will be taken as List. The implementation should support the interoperability between array and list. bool_array: one dimensional bool array.int8_array: one dimensional int8 array.int16_array: one dimensional int16 array.int32_array: one dimensional int32 array.int64_array: one dimensional int64 array.float16_array: one dimensional half_float_16 array.float32_array: one dimensional float32 array.float64_array: one dimensional float64 array. union: a tagged union type that can hold one of several alternative types. The active alternative is identified by an index.none: represents an empty/unit value with no data (e.g., for empty union alternatives).  Note:  Unsigned int/long are not added here, since not every language support those types.  ","version":"0.14","tagName":"h3"},{"title":"Polymorphisms‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#polymorphisms","content":" For polymorphism, if one non-final class is registered, and only one subclass is registered, then we can take all elements in List/Map have same type, thus reduce runtime check cost.  Collection/Array polymorphism are not fully supported, since some languages such as golang have only one collection type. If users want to get exactly the type he passed, he must pass that type when deserializing or annotate that type to the field of struct.  ","version":"0.14","tagName":"h3"},{"title":"Type disambiguation‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#type-disambiguation","content":" Due to differences between type systems of languages, those types can't be mapped one-to-one between languages. When deserializing, Fory use the target data structure type and the data type in the data jointly to determine how to deserialize and populate the target data structure. For example:  class Foo { int[] intArray; Object[] objects; List&lt;Object&gt; objectList; } class Foo2 { int[] intArray; List&lt;Object&gt; objects; List&lt;Object&gt; objectList; }   intArray has an int32_array type. But both objects and objectList fields in the serialize data have list data type. When deserializing, the implementation will create an Object array for objects, but create a ArrayListfor objectList to populate its elements. And the serialized data of Foo can be deserialized into Foo2 too.  Users can also provide meta hints for fields of a type, or the type whole. Here is an example in java which use annotation to provide such information.  @ForyObject(fieldsNullable = false, trackingRef = false) class Foo { @ForyField(trackingRef = false) int[] intArray; @ForyField(polymorphic = true) Object object; @ForyField(tagId = 1, nullable = true) List&lt;Object&gt; objectList; }   Such information can be provided in other languages too:  cpp: use macro and template.golang: use struct tag.python: use typehint.rust: use macro.  ","version":"0.14","tagName":"h3"},{"title":"Type ID‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#type-id","content":" All internal data types are expressed using an ID in range 0~64. Users can use IDs in range 0~8192 for registering their custom types (struct/ext/enum). User type IDs are in a separate namespace and combined with internal type IDs via bit shifting:(user_type_id &lt;&lt; 8) | internal_type_id.  Internal Type ID Table‚Äã  Type ID\tName\tDescription0\tUNKNOWN\tUnknown type, used for dynamic typing 1\tBOOL\tBoolean value 2\tINT8\t8-bit signed integer 3\tINT16\t16-bit signed integer 4\tINT32\t32-bit signed integer 5\tVAR_INT32\tVariable-length encoded 32-bit signed integer 6\tINT64\t64-bit signed integer 7\tVAR_INT64\tVariable-length encoded 64-bit signed integer 8\tSLI_INT64\tSmall Long as Int encoded 64-bit signed integer 9\tFLOAT16\t16-bit floating point (half precision) 10\tFLOAT32\t32-bit floating point (single precision) 11\tFLOAT64\t64-bit floating point (double precision) 12\tSTRING\tUTF-8/UTF-16/Latin1 encoded string 13\tENUM\tEnum registered by numeric ID 14\tNAMED_ENUM\tEnum registered by namespace + type name 15\tSTRUCT\tStruct registered by numeric ID (schema consistent) 16\tCOMPATIBLE_STRUCT\tStruct with schema evolution support (by ID) 17\tNAMED_STRUCT\tStruct registered by namespace + type name 18\tNAMED_COMPATIBLE_STRUCT\tStruct with schema evolution (by name) 19\tEXT\tExtension type registered by numeric ID 20\tNAMED_EXT\tExtension type registered by namespace + type name 21\tLIST\tOrdered collection (List, Array, Vector) 22\tSET\tUnordered collection of unique elements 23\tMAP\tKey-value mapping 24\tDURATION\tTime duration (seconds + nanoseconds) 25\tTIMESTAMP\tPoint in time (nanoseconds since epoch) 26\tLOCAL_DATE\tDate without timezone (days since epoch) 27\tDECIMAL\tArbitrary precision decimal 28\tBINARY\tRaw binary data 29\tARRAY\tGeneric array type 30\tBOOL_ARRAY\t1D boolean array 31\tINT8_ARRAY\t1D int8 array 32\tINT16_ARRAY\t1D int16 array 33\tINT32_ARRAY\t1D int32 array 34\tINT64_ARRAY\t1D int64 array 35\tFLOAT16_ARRAY\t1D float16 array 36\tFLOAT32_ARRAY\t1D float32 array 37\tFLOAT64_ARRAY\t1D float64 array 38\tUNION\tTagged union type (one of several alternatives) 39\tNONE\tEmpty/unit type (no data)  Type ID Encoding for User Types‚Äã  When registering user types (struct/ext/enum), the full type ID combines user ID and internal type ID:  Full Type ID = (user_type_id &lt;&lt; 8) | internal_type_id   Examples:  User ID\tType\tInternal ID\tFull Type ID\tDecimal0\tSTRUCT\t15\t(0 &lt;&lt; 8) | 15\t15 0\tENUM\t13\t(0 &lt;&lt; 8) | 13\t13 1\tSTRUCT\t15\t(1 &lt;&lt; 8) | 15\t271 1\tCOMPATIBLE_STRUCT\t16\t(1 &lt;&lt; 8) | 16\t272 2\tNAMED_STRUCT\t17\t(2 &lt;&lt; 8) | 17\t529  When reading type IDs:  Extract internal type: internal_type_id = full_type_id &amp; 0xFFExtract user type ID: user_type_id = full_type_id &gt;&gt; 8  ","version":"0.14","tagName":"h3"},{"title":"Type mapping‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#type-mapping","content":" See Type mapping  ","version":"0.14","tagName":"h3"},{"title":"Spec overview‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#spec-overview","content":" Here is the overall format:  | fory header | object ref meta | object type meta | object value data |   The data are serialized using little endian byte order overall. If bytes swap is costly for some object, Fory will write the byte order for that object into the data instead of converting it to little endian.  ","version":"0.14","tagName":"h2"},{"title":"Fory header‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#fory-header","content":" Fory header format for xlang serialization:  | 2 bytes | 1 byte bitmap | 1 byte | optional 4 bytes | +--------------+--------------------------------+------------+------------------------------------+ | magic number | 4 bits reserved | 4 bits meta | language | unsigned int for meta start offset |   Detailed byte layout:  Byte 0-1: Magic number (0x62d4) - little endian Byte 2: Bitmap flags - Bit 0: null flag (0x01) - Bit 1: endian flag (0x02) - Bit 2: xlang flag (0x04) - Bit 3: oob flag (0x08) - Bits 4-7: reserved Byte 3: Language ID (only present when xlang flag is set) Byte 4-7: Meta start offset (only present when meta share mode is enabled)   magic number: 0x62d4 (2 bytes, little endian) - used to identify fory xlang serialization protocol.null flag (bit 0): 1 when object is null, 0 otherwise. If an object is null, only this flag and endian flag are set.endian flag (bit 1): 1 when data is encoded by little endian, 0 for big endian. Modern implementations always use little endian.xlang flag (bit 2): 1 when serialization uses Fory xlang format, 0 when serialization uses Fory language-native format.oob flag (bit 3): 1 when out-of-band serialization is enabled (BufferCallback is not null), 0 otherwise.language: 1 byte indicating the source language. This allows deserializers to optimize for specific language characteristics.  ","version":"0.14","tagName":"h2"},{"title":"Language IDs‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#language-ids","content":" Language\tIDXLANG\t0 JAVA\t1 PYTHON\t2 CPP\t3 GO\t4 JAVASCRIPT\t5 RUST\t6 DART\t7  ","version":"0.14","tagName":"h3"},{"title":"Meta Start Offset‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#meta-start-offset","content":" If compatible mode is enabled, an uncompressed unsigned int32 (4 bytes, little endian) is appended to indicate the start offset of metadata. During serialization, this is initially written as a placeholder (e.g., -1 or 0), then updated after all objects are serialized and metadata is collected.  ","version":"0.14","tagName":"h3"},{"title":"Reference Meta‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#reference-meta","content":" Reference tracking handles whether the object is null, and whether to track reference for the object by writing corresponding flags and maintaining internal state.  ","version":"0.14","tagName":"h2"},{"title":"Reference Flags‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#reference-flags","content":" Flag\tByte Value (int8)\tHex\tDescriptionNULL FLAG\t-3\t0xFD\tObject is null. No further bytes are written for this object. REF FLAG\t-2\t0xFE\tObject was already serialized. Followed by unsigned varint32 reference ID. NOT_NULL VALUE FLAG\t-1\t0xFF\tObject is non-null but reference tracking is disabled for this type. Object data follows immediately. REF VALUE FLAG\t0\t0x00\tObject is referencable and this is its first occurrence. Object data follows. Assigns next reference ID.  ","version":"0.14","tagName":"h3"},{"title":"Reference Tracking Algorithm‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#reference-tracking-algorithm","content":" Writing:  function write_ref_or_null(buffer, obj): if obj is null: buffer.write_int8(NULL_FLAG) // -3 return true // done, no more data to write if reference_tracking_enabled: ref_id = lookup_written_objects(obj) if ref_id exists: buffer.write_int8(REF_FLAG) // -2 buffer.write_varuint32(ref_id) return true // done, reference written else: buffer.write_int8(REF_VALUE_FLAG) // 0 add_to_written_objects(obj, next_ref_id++) return false // continue to serialize object data else: buffer.write_int8(NOT_NULL_VALUE_FLAG) // -1 return false // continue to serialize object data   Reading:  function read_ref_or_null(buffer): flag = buffer.read_int8() switch flag: case NULL_FLAG (-3): return (null, true) // null object, done case REF_FLAG (-2): ref_id = buffer.read_varuint32() obj = get_from_read_objects(ref_id) return (obj, true) // referenced object, done case NOT_NULL_VALUE_FLAG (-1): return (null, false) // non-null, continue reading case REF_VALUE_FLAG (0): reserve_ref_slot() // will be filled after reading return (null, false) // non-null, continue reading   ","version":"0.14","tagName":"h3"},{"title":"Reference ID Assignment‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#reference-id-assignment","content":" Reference IDs are assigned sequentially starting from 0The ID is assigned when REF_VALUE_FLAG is written (first occurrence)Objects are stored in a list/map indexed by their reference IDFor reading, a placeholder slot is reserved before deserializing the object, then filled after  ","version":"0.14","tagName":"h3"},{"title":"When Reference Tracking is Disabled‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#when-reference-tracking-is-disabled","content":" When reference tracking is disabled globally or for specific types, only the NULL and NOT_NULL VALUE flags will be used for reference meta. This reduces overhead for types that are known not to have references.  ","version":"0.14","tagName":"h3"},{"title":"Language-Specific Considerations‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#language-specific-considerations","content":" Languages with nullable and reference types by default (Java, Python, JavaScript):  In xlang mode, for cross-language compatibility:  All fields are treated as not-null by defaultReference tracking is disabled by defaultUsers can explicitly mark fields as nullable or enable reference tracking via annotationsOptional types (e.g., java.util.Optional, typing.Optional) are treated as nullable  Annotation examples:  // Java: use @ForyField annotation public class MyClass { @ForyField(nullable = true, ref = true) private Object refField; @ForyField(nullable = false) private String requiredField; }   # Python: use typing with fory field descriptors from pyfory import Fory, ForyField class MyClass: ref_field: ForyField(SomeType, nullable=True, ref=True) required_field: ForyField(str, nullable=False)   Languages with non-nullable types by default:  Language\tNull Representation\tReference Tracking SupportRust\tOption::None\tVia Rc&lt;T&gt;, Arc&lt;T&gt;, Weak&lt;T&gt; C++\tstd::nullopt, nullptr\tVia std::shared_ptr&lt;T&gt;, weak_ptr&lt;T&gt; Go\tnil interface/pointer\tVia pointer/interface types  Important: For languages like Rust that don't have implicit reference semantics, reference tracking must use explicit smart pointers (Rc, Arc).  ","version":"0.14","tagName":"h3"},{"title":"Type Meta‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#type-meta","content":" For every type to be serialized, it have a type id to indicate its type.  basic types: the type idenum: Type.ENUM + registered idType.NAMED_ENUM + registered namespace+typename list: Type.Listset: Type.SETmap: Type.MAPext: Type.EXT + registered idType.NAMED_EXT + registered namespace+typename struct: Type.STRUCT + struct metaType.NAMED_STRUCT + struct meta  Every type must be registered with an ID or name first. The registration can be used for security check and type identification.  Struct is a special type, depending whether schema compatibility is enabled, Fory will write struct meta differently.  ","version":"0.14","tagName":"h2"},{"title":"Struct Schema consistent‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#struct-schema-consistent","content":" If schema consistent mode is enabled globally when creating fory, type meta will be written as a fory unsigned varint of type_id. Schema evolution related meta will be ignored.If schema evolution mode is enabled globally when creating fory, and current class is configured to use schema consistent mode like struct vs table in flatbuffers: Type meta will be add to captured_type_defs: captured_type_defs[type def stub] = map size ahead when registering type.Get index of the meta in captured_type_defs, write that index as | unsigned varint: index |.  ","version":"0.14","tagName":"h3"},{"title":"Struct Schema evolution‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#struct-schema-evolution","content":" If schema evolution mode is enabled globally when creating fory, and enabled for current type, type meta will be written using one of the following mode. Which mode to use is configured when creating fory.  Normal mode(meta share not enabled): If type meta hasn't been written before, add type defto captured_type_defs: captured_type_defs[type def] = map size.Get index of the meta in captured_type_defs, write that index as | unsigned varint: index |.After finished the serialization of the object graph, fory will start to write captured_type_defs: Firstly, set current to meta start offset of fory header Then write captured_type_defs one by one: buffer.write_var_uint32(len(writting_type_defs) - len(schema_consistent_type_def_stubs)) for type_meta in writting_type_defs: if not type_meta.is_stub(): type_meta.write_type_def(buffer) writing_type_defs = copy(schema_consistent_type_def_stubs) Meta share mode: the writing steps are same as the normal mode, but captured_type_defs will be shared across multiple serializations of different objects. For example, suppose we have a batch to serialize: captured_type_defs = {} stream = ... # add `Type1` to `captured_type_defs` and write `Type1` fory.serialize(stream, [Type1()]) # add `Type2` to `captured_type_defs` and write `Type2`, `Type1` is written before. fory.serialize(stream, [Type1(), Type2()]) # `Type1` and `Type2` are written before, no need to write meta. fory.serialize(stream, [Type1(), Type2()]) Streaming mode(streaming mode doesn't support meta share): If type meta hasn't been written before, the data will be written as: | unsigned varint: 0b11111111 | type def | If type meta has been written before, the data will be written as: | unsigned varint: written index &lt;&lt; 1 | written index is the id in captured_type_defs. With this mode, meta start offset can be omitted.  The normal mode and meta share mode will forbid streaming writing since it needs to look back for update the start offset after the whole object graph writing and meta collecting is finished. Only in this way we can ensure deserialization failure in meta share mode doesn't lost shared meta.  Type Def‚Äã  Here we mainly describe the meta layout for schema evolution mode:  | 8 bytes header | variable bytes | variable bytes | +----------------------+--------------------+-------------------+ | global binary header | meta header | fields meta |   For languages which support inheritance, if parent class and subclass has fields with same name, using field in subclass.  Global binary header‚Äã  50 bits hash + 1bit compress flag + write fields meta + 12 bits meta size. Right is the lower bits.  lower 12 bits are used to encode meta size. If meta size &gt;= 0b1111_1111_1111, then writemeta_ size - 0b1111_1111_1111 next.13rd bit is used to indicate whether to write fields meta. When this class is schema-consistent or use registered serializer, fields meta will be skipped. Class Meta will be used for share namespace + type name only.14rd bit is used to indicate whether meta is compressed.Other 50 bits is used to store the unique hash of flags + all layers class meta.  Meta header‚Äã  Meta header is a 8 bits number value.  Lowest 5 digits 0b00000~0b11110 are used to record num fields. 0b11111 is preserved to indicate that Fory need to read more bytes for length using Fory unsigned int encoding. Note that num_fields is the number of compatible fields. Users can use tag id to mark some fields as compatible fields in schema consistent context. In such cases, schema consistent fields will be serialized first, then compatible fields will be serialized next. At deserialization, Fory will use fields info of those fields which aren't annotated by tag id for deserializing schema consistent fields, then use fields info in meta for deserializing compatible fields.The 6th bit: 0 for registered by id, 1 for registered by name.Remaining 2 bits are reserved for future extension.  Fields meta‚Äã  Format:  | field info: variable bytes | variable bytes | ... | +---------------------------------+-----------------+-----+ | header + type info + field name | next field info | ... |   Field Header‚Äã  Field Header is 8 bits, annotation can be used to provide more specific info. If annotation not exists, fory will infer those info automatically.  The format for field header is:  2 bits field name encoding + 4 bits size + nullability flag + ref tracking flag   Detailed spec:  2 bits field name encoding: encoding: UTF8/ALL_TO_LOWER_SPECIAL/LOWER_UPPER_DIGIT_SPECIAL/TAG_IDIf tag id is used, field name will be written by an unsigned varint tag id, and 2 bits encoding will be 11. size of field name: The 4 bits size: 0~14 will be used to indicate length 1~15, the value 15 indicates to read more bytes, the encoding will encode size - 15 as a varint next.If encoding is TAG_ID, then num_bytes of field name will be used to store tag id. ref tracking: when set to 1, ref tracking will be enabled for this field.nullability: when set to 1, this field can be null.  Field Type Info‚Äã  Field type info is written as unsigned int8. Detailed id spec is:  For struct registered by id, it will be Type.STRUCT.For struct registered by name, it will be Type.NAMED_STRUCT.For enum registered by id, it will be Type.ENUM.For enum registered by name, it will be Type.NAMED_ENUM.For ext type registered by id, it will be Type.EXT.For ext type registered by name, it will be Type.NAMED_EXT.For list/set type, it will be written as Type.LIST/SET, then write element type recursively.For 1D primitive array type, it will be written as Type.XXX_ARRAY.For multi-dimensional primitive array type with same size on each dim, it will be written as Type.TENSOR.For other array type, it will be written as Type.LIST, then write element type recursively.For map type, it will be written as Type.MAP, then write key and value type recursively.For other types supported by fory directly, it will be fory type id for that type.For other types not determined at compile time, write Type.UNKNOWN instead. For such types, actual type will be written when serializing such field values.  Polymorphism spec:  struct/named_struct/ext/named_ext are taken as polymorphic, the meta for those types are written separately instead of inlining here to reduce meta space cost if object of this type is serialized in current object graph multiple times, and the field value may be null too.enum is taken as morphic, if deserialization doesn't have this field, or the type is not enum, enum value will be skipped.list/map/set are taken as morphic, when serializing values of those type, the concrete types won't be written again.Other types that fory supported are taken as morphic too.  List/Set/Map nested type spec:  list: | list type id | nested type id &lt;&lt; 2 + nullability flag + ref tracking flag | ... multi-layer type info |set: | set type id | nested type id &lt;&lt; 2 + nullability flag + ref tracking flag | ... multi-layer type info |map: | set type id | key type info | value type info | Key type format: | nested type id &lt;&lt; 2 + nullability flag + ref tracking flag | ... multi-layer type info |Value type format: | nested type id &lt;&lt; 2 + nullability flag + ref tracking flag | ... multi-layer type info |  Field Name‚Äã  If tag id is set, tag id will be used instead. Otherwise meta string of field name will be written instead.  Field order‚Äã  Field order are left as implementation details, which is not exposed to specification, the deserialization need to resort fields based on Fory fields sort algorithms. In this way, fory can compute statistics for field names or types and using a more compact encoding.  ","version":"0.14","tagName":"h3"},{"title":"Extended Type Meta with Inheritance support‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#extended-type-meta-with-inheritance-support","content":" If one want to support inheritance for struct, one can implement following spec.  ","version":"0.14","tagName":"h2"},{"title":"Schema consistent‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#schema-consistent","content":" Fields are serialized from parent type to leaf type. Fields are sorted using fory struct fields sort algorithms.  ","version":"0.14","tagName":"h3"},{"title":"Schema Evolution‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#schema-evolution","content":" Meta layout for schema evolution mode:  | 8 bytes header | variable bytes | variable bytes | variable bytes | variable bytes | +----------------------+----------------+----------------+--------------------+--------------------+ | global binary header | meta header | fields meta | parent meta header | parent fields meta |   Meta header‚Äã  Meta header is a 64 bits number value encoded in little endian order.  Lowest 4 digits 0b0000~0b1110 are used to record num classes. 0b1111 is preserved to indicate that Fory need to read more bytes for length using Fory unsigned int encoding. If current type doesn't has parent type, or parent type doesn't have fields to serialize, or we're in a context which serialize fields of current type only, num classes will be 1.The 5th bit is used to indicate whether this type needs schema evolution.Other 56 bits are used to store the unique hash of flags + all layers type meta.  Single layer type meta‚Äã  | unsigned varint | var uint | field info: variable bytes | variable bytes | ... | +-----------------+----------+-------------------------------+-----------------+-----+ | num_fields | type id | header + type id + field name | next field info | ... |   Other layers type meta‚Äã  Same encoding algorithm as the previous layer.  ","version":"0.14","tagName":"h3"},{"title":"Meta String‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#meta-string","content":" Meta string is a compressed encoding for metadata strings such as field names, type names, and namespaces. This compression significantly reduces the size of type metadata in serialized data.  ","version":"0.14","tagName":"h2"},{"title":"Encoding Type IDs‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#encoding-type-ids","content":" ID\tName\tBits/Char\tCharacter Set0\tUTF8\t8\tAny UTF-8 character 1\tLOWER_SPECIAL\t5\ta-z . _ $ | 2\tLOWER_UPPER_DIGIT_SPECIAL\t6\ta-z A-Z 0-9 . _ 3\tFIRST_TO_LOWER_SPECIAL\t5\tFirst char uppercase, rest a-z . _ 4\tALL_TO_LOWER_SPECIAL\t5\ta-z A-Z . _ (uppercase escaped)  ","version":"0.14","tagName":"h3"},{"title":"Character Mapping Tables‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#character-mapping-tables","content":" LOWER_SPECIAL (5 bits per character)‚Äã  Character\tCode (binary)\tCode (decimal)a-z\t00000-11001\t0-25 .\t11010\t26 _\t11011\t27 $\t11100\t28 |\t11101\t29  Note: The | character is used as an escape sequence in ALL_TO_LOWER_SPECIAL encoding.  LOWER_UPPER_DIGIT_SPECIAL (6 bits per character)‚Äã  Character\tCode (binary)\tCode (decimal)a-z\t000000-011001\t0-25 A-Z\t011010-110011\t26-51 0-9\t110100-111101\t52-61 .\t111110\t62 _\t111111\t63  ","version":"0.14","tagName":"h3"},{"title":"Encoding Algorithms‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#encoding-algorithms","content":" LOWER_SPECIAL Encoding‚Äã  For strings containing only a-z, ., _, $, |:  function encode_lower_special(str): bits = [] for char in str: bits.append(lookup_lower_special[char]) // 5 bits each // Pad to byte boundary total_bits = len(str) * 5 padding_bits = (8 - (total_bits % 8)) % 8 // First bit indicates if last char should be stripped (due to padding) strip_last = (padding_bits &gt;= 5) if strip_last: prepend bit 1 else: prepend bit 0 return pack_bits_to_bytes(bits)   FIRST_TO_LOWER_SPECIAL Encoding‚Äã  For strings like MyFieldName where only the first character is uppercase:  function encode_first_to_lower_special(str): // Convert first char to lowercase modified = str[0].lower() + str[1:] // Then use LOWER_SPECIAL encoding return encode_lower_special(modified)   ALL_TO_LOWER_SPECIAL Encoding‚Äã  For strings with multiple uppercase characters like MyTypeName:  function encode_all_to_lower_special(str): result = &quot;&quot; for char in str: if char.is_upper(): result += &quot;|&quot; + char.lower() // Escape uppercase with | else: result += char return encode_lower_special(result)   Example: MyType ‚Üí |my|type ‚Üí encoded with LOWER_SPECIAL  ","version":"0.14","tagName":"h3"},{"title":"Encoding Selection Algorithm‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#encoding-selection-algorithm","content":" function choose_encoding(str): if all chars in str are in [a-z . _ $ |]: return LOWER_SPECIAL if first char is uppercase AND rest are in [a-z . _]: return FIRST_TO_LOWER_SPECIAL if all chars are in [a-z A-Z . _]: lower_special_size = encode_all_to_lower_special(str).size luds_size = encode_lower_upper_digit_special(str).size if lower_special_size &lt;= luds_size: return ALL_TO_LOWER_SPECIAL else: return LOWER_UPPER_DIGIT_SPECIAL if all chars are in [a-z A-Z 0-9 . _]: return LOWER_UPPER_DIGIT_SPECIAL return UTF8   ","version":"0.14","tagName":"h3"},{"title":"Meta String Header Format‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#meta-string-header-format","content":" Meta strings are written with a header that includes the encoding type:  | 3 bits encoding | 5+ bits length | encoded bytes |   Or for larger strings:  | varuint: (length &lt;&lt; 3) | encoding | encoded bytes |   ","version":"0.14","tagName":"h3"},{"title":"Special Character Sets by Context‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#special-character-sets-by-context","content":" Different contexts use different special characters:  Context\tSpecial Chars\tNotesField Name\t. _ $ |\t$ for inner classes, | for escape Namespace\t. _\tPackage/module separators Type Name\t$ _\t$ for inner classes in Java  ","version":"0.14","tagName":"h3"},{"title":"Deduplication‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#deduplication","content":" Meta strings are deduplicated within a serialization session:  First occurrence: | (length &lt;&lt; 1) | [hash if large] | encoding | bytes | Reference: | ((id + 1) &lt;&lt; 1) | 1 |   Bit 0 of the header indicates: 0 = new string, 1 = reference to previousLarge strings (&gt; 16 bytes) include 64-bit hash for content-based deduplicationSmall strings use exact byte comparison  ","version":"0.14","tagName":"h3"},{"title":"Value Format‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#value-format","content":" ","version":"0.14","tagName":"h2"},{"title":"Basic types‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#basic-types","content":" bool‚Äã  size: 1 byteformat: 0 for false, 1 for true  int8‚Äã  size: 1 byteformat: write as pure byte.  int16‚Äã  size: 2 bytebyte order: raw bytes of little endian order  unsigned int32‚Äã  size: 4 bytebyte order: raw bytes of little endian order  unsigned varint32‚Äã  size: 1~5 bytesFormat: The most significant bit (MSB) in every byte indicates whether to have the next byte. If the continuation bit is set (i.e. b &amp; 0x80 == 0x80), then the next byte should be read until a byte with unset continuation bit.  Encoding Algorithm:  function write_varuint32(value): while value &gt;= 0x80: buffer.write_byte((value &amp; 0x7F) | 0x80) // 7 bits of data + continuation bit value = value &gt;&gt; 7 buffer.write_byte(value) // final byte without continuation bit   Decoding Algorithm:  function read_varuint32(): result = 0 shift = 0 while true: byte = buffer.read_byte() result = result | ((byte &amp; 0x7F) &lt;&lt; shift) if (byte &amp; 0x80) == 0: break shift = shift + 7 return result   Byte sizes by value range:  Value Range\tBytes0 ~ 127\t1 128 ~ 16383\t2 16384 ~ 2097151\t3 2097152 ~ 268435455\t4 268435456 ~ 4294967295\t5  signed int32‚Äã  size: 4 bytesbyte order: raw bytes of little endian order  signed varint32‚Äã  size: 1~5 bytesFormat: First convert the number into positive unsigned int using ZigZag encoding, then encode as unsigned varint.  ZigZag Encoding:  // Encode: convert signed to unsigned zigzag_value = (value &lt;&lt; 1) ^ (value &gt;&gt; 31) // Decode: convert unsigned back to signed original = (zigzag_value &gt;&gt; 1) ^ (-(zigzag_value &amp; 1)) // Or equivalently: original = (zigzag_value &gt;&gt; 1) ^ (~(zigzag_value &amp; 1) + 1)   ZigZag encoding maps signed integers to unsigned integers so that small absolute values (positive or negative) have small encoded values:  Original\tZigZag Encoded0\t0 -1\t1 1\t2 -2\t3 2\t4 ...\t...  unsigned int64‚Äã  size: 8 bytesbyte order: raw bytes of little endian order  unsigned varint64‚Äã  size: 1~9 bytes  Fory supports two encoding schemes for 64-bit integers:  Fory SLI (Small Long as Int) Encoding:  Optimized for values that fit in 31 bits (common case for IDs, timestamps, etc.):  if value in [0, 2147483647]: // fits in 31 bits write 4 bytes: ((int32) value) &lt;&lt; 1 // bit 0 is 0, indicating 4-byte encoding else: write 1 byte: 0x01 // bit 0 is 1, indicating 9-byte encoding write 8 bytes: value as little-endian int64   Reading:  first_int32 = read_int32_le() if (first_int32 &amp; 1) == 0: return first_int32 &gt;&gt; 1 // 4-byte encoding else: return read_int64_le() // read remaining 8 bytes   Fory PVL (Progressive Variable-Length) Encoding:  Standard varint encoding extended to 64 bits:  function write_varuint64(value): while value &gt;= 0x80: buffer.write_byte((value &amp; 0x7F) | 0x80) value = value &gt;&gt; 7 buffer.write_byte(value)   Value Range\tBytes0 ~ 127\t1 128 ~ 16383\t2 ...\t... 2^56 ~ 2^63-1\t9  VarUint36Small‚Äã  A specialized encoding used for string headers that combines size (up to 36 bits) with encoding flags:  // Write: encodes (size &lt;&lt; 2) | encoding_flags function write_varuint36_small(value): if value &lt; 0x80: buffer.write_byte(value) else: // Standard varint encoding for values &gt;= 128 write_varuint64(value)   This encoding is optimized for the common case where string length fits in 7 bits (strings &lt; 32 characters).  signed int64‚Äã  size: 8 bytesbyte order: raw bytes of little endian order  signed varint64‚Äã  size: 1~9 bytes  Fory SLI (Small Long as Int) Encoding for signed:  Optimized for small signed values:  if value in [-1073741824, 1073741823]: // fits in 31 bits signed write 4 bytes: ((int32) value) &lt;&lt; 1 // bit 0 is 0 else: write 1 byte: 0x01 // bit 0 is 1 write 8 bytes: value as little-endian int64   Fory PVL (Progressive Variable-Length) Encoding for signed:  Uses ZigZag encoding first, then varint:  // Encode zigzag_value = (value &lt;&lt; 1) ^ (value &gt;&gt; 63) write_varuint64(zigzag_value) // Decode zigzag_value = read_varuint64() value = (zigzag_value &gt;&gt; 1) ^ (-(zigzag_value &amp; 1))   float32‚Äã  size: 4 byteformat: encode the specified floating-point value according to the IEEE 754 floating-point &quot;single format&quot; bit layout, preserving Not-a-Number (NaN) values, then write as binary by little endian order.  float64‚Äã  size: 8 byteformat: encode the specified floating-point value according to the IEEE 754 floating-point &quot;double format&quot; bit layout, preserving Not-a-Number (NaN) values. then write as binary by little endian order.  ","version":"0.14","tagName":"h3"},{"title":"string‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#string","content":" Format:  | varuint36_small: (size &lt;&lt; 2) | encoding | binary data |   String Header‚Äã  The header is encoded using varuint36_small format, which combines the byte length and encoding type:  header = (byte_length &lt;&lt; 2) | encoding_type   Encoding Type\tValue\tDescriptionLATIN1\t0\tISO-8859-1 single-byte encoding UTF16\t1\tUTF-16 encoding (2 bytes per code unit) UTF8\t2\tUTF-8 variable-length encoding Reserved\t3\tReserved for future use  Encoding Algorithm‚Äã  Writing:  function write_string(str): bytes = encode_to_bytes(str, chosen_encoding) header = (bytes.length &lt;&lt; 2) | encoding_type buffer.write_varuint36_small(header) buffer.write_bytes(bytes)   Reading:  function read_string(): header = buffer.read_varuint36_small() encoding = header &amp; 0x03 byte_length = header &gt;&gt; 2 bytes = buffer.read_bytes(byte_length) return decode_bytes(bytes, encoding)   Encoding Selection by Language‚Äã  Writing:  Language\tEncoding StrategyJava (JDK8)\tDetect at runtime: LATIN1 if all chars &lt; 256, else UTF16 Java (JDK9+)\tUse String's internal coder: LATIN1 or UTF16 Python\tCan write LATIN1, UTF16, or UTF8 based on string content C++\tUTF8 (std::string) or UTF16 (std::u16string) Rust\tUTF8 (String) Go\tUTF8 (string) JavaScript\tUTF8  Reading: All languages support decoding all three encodings (LATIN1, UTF16, UTF8).  Recommendation: Select encoding based on maximum performance - use the encoding that matches the language's native string representation to avoid conversion overhead.  Empty String‚Äã  Empty strings are encoded with header 0 (length 0, any encoding) followed by no data bytes.  ","version":"0.14","tagName":"h3"},{"title":"duration‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#duration","content":" Duration is an absolute length of time, independent of any calendar/timezone, as a count of seconds and nanoseconds.  Format:  | signed varint64: seconds | signed int32: nanoseconds |   seconds: Number of seconds in the duration, encoded as a signed varint64. Can be positive or negative.nanoseconds: Nanosecond adjustment to the duration, encoded as a signed int32. Value range is [0, 999,999,999] for positive durations, and [-999,999,999, 0] for negative durations.  Notes:  The duration is stored as two separate fields to maintain precision and avoid overflow issues.Seconds are encoded using varint64 for compact representation of common duration values.Nanoseconds are stored as a fixed int32 since the range is limited.The sign of the duration is determined by the seconds field. When seconds is 0, the sign is determined by nanoseconds.  ","version":"0.14","tagName":"h3"},{"title":"collection/list‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#collectionlist","content":" Format:  | varuint32: length | 1 byte elements header | [optional type info] | elements data |   Elements Header‚Äã  The elements header is a single byte that encodes metadata about the collection elements to optimize serialization:  | bit 7-4 (reserved) | bit 3 | bit 2 | bit 1 | bit 0 | +--------------------+-------------+------------------+----------+-----------+ | reserved | is_same_type| is_decl_elem_type| has_null | track_ref |   Bit\tName\tValue\tMeaning when SET (1)\tMeaning when UNSET (0)0\ttrack_ref\t0x01\tTrack references for elements\tDon't track element references 1\thas_null\t0x02\tCollection may contain null elements\tNo null elements (skip null checks) 2\tis_decl_elem_type\t0x04\tElements are the declared generic type\tElement types differ from declared type 3\tis_same_type\t0x08\tAll elements have the same runtime type\tElements have different runtime types  Common header values:  Header\tHex\tMeaning0x0C\t12\tDeclared type + same type, non-null, no ref tracking (optimal) 0x0D\t13\tDeclared type + same type, non-null, with ref tracking 0x0E\t14\tDeclared type + same type, may have nulls, no ref tracking 0x08\t8\tSame type but not declared type (type info written once) 0x00\t0\tDifferent types, non-null, no ref tracking (type per element)  Type Info After Header‚Äã  When is_decl_elem_type (bit 2) is NOT set, the element type info is written once after the header if is_same_type (bit 3) is set:  | header (0x08) | type_id (varuint32) | elements... |   When both is_decl_elem_type and is_same_type are NOT set, type info is written per element.  Element Serialization Based on Header‚Äã  The header determines how each element is serialized:  elements data‚Äã  Based on the elements header, the serialization of elements data may skip ref flag/null flag/element type info.  fory = ... buffer = ... elems = ... if element_type_is_same: if not is_declared_type: fory.write_type(buffer, elem_type) elem_serializer = get_serializer(...) if track_ref: for elem in elems: if not ref_resolver.write_ref_or_null(buffer, elem): elem_serializer.write(buffer, elem) elif has_null: for elem in elems: if elem is None: buffer.write_byte(null_flag) else: buffer.write_byte(not_null_flag) elem_serializer.write(buffer, elem) else: for elem in elems: elem_serializer.write(buffer, elem) else: if track_ref: for elem in elems: fory.write_ref(buffer, elem) elif has_null: for elem in elems: fory.write_nullable(buffer, elem) else: for elem in elems: fory.write_value(buffer, elem)   CollectionSerializer#writeElementscan be taken as an example.  ","version":"0.14","tagName":"h3"},{"title":"array‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#array","content":" primitive array‚Äã  Primitive array are taken as a binary buffer, serialization will just write the length of array size as an unsigned int, then copy the whole buffer into the stream.  Such serialization won't compress the array. If users want to compress primitive array, users need to register custom serializers for such types or mark it as list type.  Tensor‚Äã  Tensor is a special primitive multi-dimensional array which all dimensions have same size and type. The serialization format is:  | num_dims(unsigned varint) | shape[0](unsigned varint) | shape[...] | shape[N] | element type | data |   The data is continuous to reduce copy and may zero-copy in some cases.  object array‚Äã  Object array is serialized using the list format. Object component type will be taken as list element generic type.  ","version":"0.14","tagName":"h3"},{"title":"map‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#map","content":" Map uses a chunk-based format to handle heterogeneous key-value pairs efficiently:  | varuint32: total_size | chunk_1 | chunk_2 | ... | chunk_n |   Map Chunk Format‚Äã  Each chunk contains up to 255 key-value pairs with the same metadata characteristics:  | 1 byte | 1 byte | variable bytes | +--------------+----------------+------------------------------+ | KV header | chunk size N | N key-value pairs (N*2 obj) |   KV Header Bits‚Äã  The KV header is a single byte encoding metadata for both keys and values:  | bit 7-6 | bit 5 | bit 4 | bit 3 | bit 2 | bit 1 | bit 0 | +------------+---------------+--------------+---------------+---------------+--------------+---------------+ | reserved | val_decl_type | val_has_null | val_track_ref | key_decl_type | key_has_null | key_track_ref |   Bit\tName\tValue\tMeaning when SET (1)0\tkey_track_ref\t0x01\tTrack references for keys 1\tkey_has_null\t0x02\tKeys may be null (rare, usually invalid) 2\tkey_decl_type\t0x04\tKey is the declared generic type 3\tval_track_ref\t0x08\tTrack references for values 4\tval_has_null\t0x10\tValues may be null 5\tval_decl_type\t0x20\tValue is the declared generic type  Common KV header values:  Header\tHex\tMeaning0x24\t36\tKey + value are declared types, non-null, no ref tracking (optimal) 0x2C\t44\tKey + value declared types, value tracks refs 0x34\t52\tKey + value declared types, value may be null 0x00\t0\tKey + value not declared types, non-null, no ref tracking  Chunk Size‚Äã  Maximum chunk size: 255 pairs (fits in 1 byte)When key or value is null, that entry is serialized as a separate chunk with implicit size 1 (chunk size byte is skipped)Reader tracks accumulated count against total map size to know when to stop reading chunks  Why Chunk-Based Format?‚Äã  Map iteration is expensive. Computing a single header for all pairs would require two passes. The chunk-based approach allows:  Optimistic prediction: Use first key-value pair to predict headerAdaptive chunking: Start new chunk if prediction fails for a pairEfficient reading: Most maps fit in single chunk (&lt; 255 pairs)Memory efficiency: Minimal overhead for common homogeneous maps  Why serialize chunk by chunk?‚Äã  When fory will use first key-value pair to predict header optimistically, it can't know how many pairs have same meta(tracking kef ref, key has null and so on). If we don't write chunk by chunk with max chunk size, we must write at least X bytes to take up a place for later to update the number which has same elements, X is the num_bytes for encoding varint encoding of map size.  And most map size are smaller than 255, if all pairs have same data, the chunk will be 1. This is common in golang/rust, which object are not reference by default.  Also, if only one or two keys have different meta, we can make it into a different chunk, so that most pairs can share meta.  The implementation can accumulate read count with map size to decide whether to read more chunks.  ","version":"0.14","tagName":"h3"},{"title":"enum‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#enum","content":" Enums are serialized as an unsigned var int. If the order of enum values change, the deserialized enum value may not be the value users expect. In such cases, users must register enum serializer by make it write enum value as an enumerated string with unique hash disabled.  ","version":"0.14","tagName":"h3"},{"title":"decimal‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#decimal","content":" Not supported for now.  ","version":"0.14","tagName":"h3"},{"title":"struct‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#struct","content":" Struct means object of class/pojo/struct/bean/record type. Struct will be serialized by writing its fields data in fory order.  Depending on schema compatibility, structs will have different formats.  field order‚Äã  Field will be ordered as following, every group of fields will have its own order:  primitive fields: larger size type first, smaller later, variable size type last.when same size, sort by type idwhen same size and type id, sort by snake case field nametypes: bool/int8/int16/int32/varint32/int64/varint64/sliint64/float16/float32/float64 nullable primitive fields: same order as primitive fieldsother internal type fields: sort by type id then snake case field namelist fields: sort by snake case field nameset fields: sort by snake case field namemap fields: sort by snake case field nameother fields: sort by snake case field name  If two fields have same type, then sort by snake_case styled field name.  schema consistent‚Äã  Object will be written as:  | 4 byte | variable bytes | +---------------+------------------+ | type hash | field values |   Type hash is used to check the type schema consistency across languages. Type hash will be the first 32 bits of 56 bits value of the type meta.  Object fields will be serialized one by one using following format:  not null primitive field value: | var bytes | +----------------+ | value data | +----------------+ nullable primitive field value: | one byte | var bytes | +-----------+---------------+ | null flag | field value | +-----------+---------------+ other interal types supported by fory | var bytes | var objects | +-----------+-------------+ | null flag | value data | +-----------+-------------+ list field type: | one byte | var objects | +-----------+-------------+ | ref meta | value data | set field type: | one byte | var objects | +-----------+-------------+ | ref meta | value data | map field type: | one byte | var objects | +-----------+-------------+ | ref meta | value data | +-----------+-------------+-------------+ other types such as enum/struct/ext | one byte | var bytes | var objects | +-----------+------------+------------+ | ref flag | type meta | value data | +-----------+------------+------------+   Type hash algorithm:  Sort fields by fields sort algorithmStart with string &quot;&quot;Iterate every field, append string by: snow_case(field_name),. For camelcase name, convert it to snow_case first.$type_id,, for other fields, use type id TypeId::UNKNOWN instead.$nullable;, 1 if nullable, 0 otherwise. Then convert string to utf8 bytesCompute murmurhash3_x64_128, and use first 32 bits  Schema evolution‚Äã  Schema evolution have similar format as schema consistent mode for object except:  For the object type, schema consistent mode will write type by id only, but schema evolution mode will write type consisting of field names, types and other meta too, see Type meta.Type meta of final custom type needs to be written too, because peers may not have this type defined.  ","version":"0.14","tagName":"h3"},{"title":"Type‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#type","content":" Type will be serialized using type meta format.  ","version":"0.14","tagName":"h3"},{"title":"Implementation guidelines‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#implementation-guidelines","content":" ","version":"0.14","tagName":"h2"},{"title":"How to reduce memory read/write code‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#how-to-reduce-memory-readwrite-code","content":" Try to merge multiple bytes into an int/long write before writing to reduce memory IO and bound check cost.Read multiple bytes as an int/long, then split into multiple bytes to reduce memory IO and bound check cost.Try to use one varint/long to write flags and length together to save one byte cost and reduce memory io.Condition branches are less expensive compared to memory IO cost unless there are too many branches.  ","version":"0.14","tagName":"h3"},{"title":"Fast deserialization for static languages without runtime codegen support‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#fast-deserialization-for-static-languages-without-runtime-codegen-support","content":" For type evolution, the serializer will encode the type meta into the serialized data. The deserializer will compare this meta with class meta in the current process, and use the diff to determine how to deserialize the data.  For java/javascript/python, we can use the diff to generate serializer code at runtime and load it as class/function for deserialization. In this way, the type evolution will be as fast as type consist mode.  For C++/Rust, we can't generate the serializer code at runtime. So we need to generate the code at compile-time using meta programming. But at that time, we don't know the type schema in other processes, so we can't generate the serializer code for such inconsistent types. We may need to generate the code which has a loop and compare field name one by one to decide whether to deserialize and assign the field or skip the field value.  One fast way is that we can optimize the string comparison into jump instructions:  Assume the current type has n fields, and the peer type has n1 fields.Generate an auto growing field id from 0 for every sorted field in the current type at the compile time.Compare the received type meta with current type, generate same id if the field name is same, otherwise generate an auto growing id starting from n, cache this meta at runtime.Iterate the fields of received type meta, use a switch to compare the field id to deserialize data and assign/skip field value. Continuous field id will be optimized into jump in switch block, so it will very fast.  Here is an example, suppose process A has a class Foo with version 1 defined as Foo1, process B has a class Foowith version 2 defined as Foo2:  // class Foo with version 1 class Foo1 { int32_t v1; // id 0 std::string v2; // id 1 }; // class Foo with version 2 class Foo2 { // id 0, but will have id 2 in process A bool v0; // id 1, but will have id 0 in process A int32_t v1; // id 2, but will have id 3 in process A int64_t long_value; // id 3, but will have id 1 in process A std::string v2; // id 4, but will have id 4 in process A std::vector&lt;std::string&gt; list; };   When process A received serialized Foo2 from process B, here is how it deserialize the data:  Foo1 foo1 = ...; const std::vector&lt;fory::FieldInfo&gt; &amp;field_infos = type_meta.field_infos; for (const auto &amp;field_info : field_infos) { switch (field_info.field_id) { case 0: foo1.v1 = buffer.read_varint32(); break; case 1: foo1.v2 = fory.read_string(); break; default: fory.skip_data(field_info); } }   ","version":"0.14","tagName":"h3"},{"title":"Implementation Checklist for New Languages‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#implementation-checklist-for-new-languages","content":" This section provides a step-by-step guide for implementing Fory xlang serialization in a new language.  ","version":"0.14","tagName":"h2"},{"title":"Phase 1: Core Infrastructure‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#phase-1-core-infrastructure","content":" Buffer Implementation Create a byte buffer with read/write cursor tracking Implement little-endian byte order for all multi-byte writes Implement write_int8, write_int16, write_int32, write_int64 Implement write_float32, write_float64 Implement read_* counterparts for all write methods Implement buffer growth strategy (e.g., doubling) Varint Encoding Implement write_varuint32 / read_varuint32 Implement write_varint32 / read_varint32 (with ZigZag) Implement write_varuint64 / read_varuint64 Implement write_varint64 / read_varint64 (with ZigZag) Implement write_varuint36_small / read_varuint36_small (for strings) Optionally implement SLI encoding for int64 Header Handling Write magic number 0x62d4 Write/read bitmap flags (null, endian, xlang, oob) Write/read language ID Handle meta start offset placeholder (for schema evolution)  ","version":"0.14","tagName":"h3"},{"title":"Phase 2: Basic Type Serializers‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#phase-2-basic-type-serializers","content":" Primitive Types bool (1 byte: 0 or 1) int8, int16, int32, int64 (little endian) float32, float64 (IEEE 754, little endian) String Serialization Implement string header: (byte_length &lt;&lt; 2) | encoding Support UTF-8 encoding (required for xlang) Optionally support LATIN1 and UTF-16 Temporal Types Duration (seconds + nanoseconds) Timestamp (nanoseconds since epoch) LocalDate (days since epoch) Reference Tracking Implement write-side object tracking (object ‚Üí ref_id map) Implement read-side object tracking (ref_id ‚Üí object list) Handle all four reference flags: NULL(-3), REF(-2), NOT_NULL(-1), REF_VALUE(0) Support disabling reference tracking per-type or globally  ","version":"0.14","tagName":"h3"},{"title":"Phase 3: Collection Types‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#phase-3-collection-types","content":" List/Array Serialization Write length as varuint32 Write elements header byte Handle homogeneous vs heterogeneous elements Handle null elements Map Serialization Write total size as varuint32 Implement chunk-based format (max 255 pairs per chunk) Write KV header byte per chunk Handle key and value type variations Set Serialization Same format as List (reuse implementation)  ","version":"0.14","tagName":"h3"},{"title":"Phase 4: Meta String Encoding‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#phase-4-meta-string-encoding","content":" Meta strings are required for enum and struct serialization (encoding field names, type names, namespaces).  Meta String Compression Implement LOWER_SPECIAL encoding (5 bits/char) Implement LOWER_UPPER_DIGIT_SPECIAL encoding (6 bits/char) Implement FIRST_TO_LOWER_SPECIAL encoding Implement ALL_TO_LOWER_SPECIAL encoding Implement encoding selection algorithm Implement meta string deduplication  ","version":"0.14","tagName":"h3"},{"title":"Phase 5: Enum Serialization‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#phase-5-enum-serialization","content":" Enum Serialization Write ordinal as varuint32 Support named enum (namespace + type name)  ","version":"0.14","tagName":"h3"},{"title":"Phase 6: Struct Serialization‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#phase-6-struct-serialization","content":" Type Registration Support registration by numeric ID Support registration by namespace + type name Maintain type ‚Üí serializer mapping Generate type IDs: (user_id &lt;&lt; 8) | internal_type_id Field Ordering Implement Fory field ordering algorithm Sort primitives by size (larger first), then type ID, then name Handle nullable vs non-nullable fields Convert field names to snake_case for sorting Schema Consistent Mode Compute type hash (MurmurHash3 of field info string) Write 4-byte type hash before fields Serialize fields in Fory order Schema Evolution Mode (Optional) Implement type meta writing Support field addition/removal Handle unknown fields (skip during read)  ","version":"0.14","tagName":"h3"},{"title":"Phase 7: Other types‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#phase-7-other-types","content":" Binary/Array Types Primitive arrays (direct buffer copy) Tensor (multi-dimensional arrays)  ","version":"0.14","tagName":"h3"},{"title":"Testing Strategy‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#testing-strategy","content":" Cross-Language Compatibility Tests Serialize in new language, deserialize in Java/Python Serialize in Java/Python, deserialize in new language Test all primitive types Test strings with various encodings Test collections (empty, single, multiple elements) Test maps with various key/value types Test nested structs Test circular references (if supported)  ","version":"0.14","tagName":"h3"},{"title":"Language-Specific Implementation Notes‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#language-specific-implementation-notes","content":" ","version":"0.14","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#java","content":" Uses runtime code generation (JIT) for maximum performanceSupports all reference tracking modesUses internal String coder for encoding selectionThread-safe via ThreadSafeFory wrapper  ","version":"0.14","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#python","content":" Two modes: Pure Python (debugging) and Cython (performance)Uses id(obj) for reference trackingLatin1/UTF-16/UTF-8 encoding for all strings in xlang modedataclass support via code generation  ","version":"0.14","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#c","content":" Compile-time reflection via macros (FORY_STRUCT, FORY_FIELD_INFO)Template meta programming for type dispatch and serializer selectionUses std::shared_ptr for reference trackingCompile-time field orderingNo runtime code generation  ","version":"0.14","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#rust","content":" Derive macros for automatic serialization (#[derive(ForyObject)])Uses Rc&lt;T&gt; / Arc&lt;T&gt; for reference trackingThread-local context caching for performanceCompile-time field ordering  ","version":"0.14","tagName":"h3"},{"title":"Go‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#go","content":" Reflection-based and codegen-based modesStruct tags for field annotationsInterface types for polymorphism  ","version":"0.14","tagName":"h3"},{"title":"Common Pitfalls‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/0.14/specification/xlang_serialization_spec#common-pitfalls","content":" Byte Order: Always use little-endian for multi-byte valuesVarint Sign Extension: Ensure proper handling of signed vs unsigned varintsReference ID Ordering: IDs must be assigned in serialization orderField Order Consistency: Must match exactly across languages (schema consistent mode only; in evolution mode, deserialization follows serialization field order from type meta)String Encoding: Use best encoding for current languageNull Handling: Different languages represent null differentlyEmpty Collections: Still write length (0) and header byteType Hash Calculation: Must use exact same algorithm across languages ","version":"0.14","tagName":"h2"},{"title":"Java Benchmarks","type":0,"sectionRef":"#","url":"/docs/next/benchmarks/java/","content":"","keywords":"","version":"dev"},{"title":"System Environment‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/next/benchmarks/java/#system-environment","content":" Operation SystemÔºö4.9.151-015.x86_64CPUÔºöIntel(R) Xeon(R) Platinum 8163 CPU @ 2.50GHzByte OrderÔºöLittle EndianL1d cacheÔºö 32KL1i cacheÔºö32KL2 cacheÔºö 1024KL3 cacheÔºö 33792K  ","version":"dev","tagName":"h2"},{"title":"JMH params‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/next/benchmarks/java/#jmh-params","content":" Don't skip warm up, otherwise the results aren't accurate.   -f 1 -wi 3 -i 3 -t 1 -w 2s -r 2s -rf cs   ","version":"dev","tagName":"h2"},{"title":"Benchmark Data‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/next/benchmarks/java/#benchmark-data","content":" ","version":"dev","tagName":"h2"},{"title":"Struct‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/next/benchmarks/java/#struct","content":" Struct is a class with 100 primitive fields:  public class Struct { public int f1; public long f2; public float f3; public double f4; // ... public double f99; }   ","version":"dev","tagName":"h3"},{"title":"Struct2‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/next/benchmarks/java/#struct2","content":" Struct2 is a class with 100 boxed fields:  public class Struct { public Integer f1; public Long f2; public Float f3; public Double f4; // ... public Double f99; }   ","version":"dev","tagName":"h3"},{"title":"MediaContent‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/next/benchmarks/java/#mediacontent","content":" MEDIA_CONTENT is a class from jvm-serializers.  ","version":"dev","tagName":"h3"},{"title":"Sample‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/next/benchmarks/java/#sample","content":" SAMPLE is a class from kryo benchmark  ","version":"dev","tagName":"h3"},{"title":"Benchmark Plots‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/next/benchmarks/java/#benchmark-plots","content":" ","version":"dev","tagName":"h2"},{"title":"Serialize to heap buffer‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/next/benchmarks/java/#serialize-to-heap-buffer","content":" Serialize data java byte array.  Java schema consistent serialization‚Äã  The deserialization peer must have same class definition with the serialization peer. No class forward/backward compatibility are supported in this mode.    Java schema compatible serialization‚Äã  The deserialization peer can have different class definition with the serialization peer. Class forward/backward compatibility are supported in this mode.    Java schema consistent deserialization‚Äã  The deserialization peer must have same class definition with the serialization peer. No class forward/backward compatibility are supported in this mode.    Java schema compatible deserialization‚Äã  The deserialization peer can have different class definition with the serialization peer. Class forward/backward compatibility are supported in this mode.    ","version":"dev","tagName":"h3"},{"title":"Off-heap serialization‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/next/benchmarks/java/#off-heap-serialization","content":" Serialize data off-heap memory.  Java schema consistent serialization‚Äã  The deserialization peer must have same class definition with the serialization peer. No class forward/backward compatibility are supported in this mode.    Java schema compatible serialization‚Äã  The deserialization peer can have different class definition with the serialization peer. Class forward/backward compatibility are supported in this mode.    Java schema consistent deserialization‚Äã  The deserialization peer must have same class definition with the serialization peer. No class forward/backward compatibility are supported in this mode.    Java schema compatible deserialization‚Äã  The deserialization peer can have different class definition with the serialization peer. Class forward/backward compatibility are supported in this mode.    ","version":"dev","tagName":"h3"},{"title":"Zero-copy serialization‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/next/benchmarks/java/#zero-copy-serialization","content":" Note that zero-copy serialization just avoid the copy in serialization, if you send data to other machine, there may be copies.  But if you serialize data between processes on same node and use shared-memory, if the data are in off-heap before serialization, then other processes can read this buffer without any copies.  Java zero-copy serialize to heap buffer‚Äã    Java zero-copy serialize to direct buffer‚Äã    ","version":"dev","tagName":"h3"},{"title":"Benchmark Data‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/next/benchmarks/java/#benchmark-data-1","content":" ","version":"dev","tagName":"h2"},{"title":"Java Serialization‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/next/benchmarks/java/#java-serialization","content":" Benchmark\tobjectType\tbufferType\treferences\tFory\tForyMetaShared\tKryo\tFst\tHession\tJdk\tProtostuffserialize\tSTRUCT\tarray\tFalse\t7501415.567260 558194.100861\t882178.995727\t258233.998931\t155908.244240\t330975.350403 serialize\tSTRUCT\tarray\tTrue\t6264439.154428 557542.628765\t757753.756691\t260845.209485\t151258.539369 serialize\tSTRUCT\tdirectBuffer\tFalse\t9834223.243204 1078046.011115\t807847.663261\t266481.009225\t154875.908438\t340262.650047 serialize\tSTRUCT\tdirectBuffer\tTrue\t7551780.823133 853350.408656\t762088.935404\t261762.594966\t156404.686214 serialize\tSTRUCT2\tarray\tFalse\t3586126.623874 325172.969175\t371762.982661\t56056.080075\t36846.049162\t322563.440433 serialize\tSTRUCT2\tarray\tTrue\t3306474.506382 259863.332448\t380638.700267\t60038.879790\t38183.705811 serialize\tSTRUCT2\tdirectBuffer\tFalse\t2643155.135327 355688.882786\t365317.705376\t55924.319442\t37444.967981\t325093.716261 serialize\tSTRUCT2\tdirectBuffer\tTrue\t2391110.083108 338960.426033\t370851.880711\t56674.065604\t35798.679246 serialize\tMEDIA_CONTENT\tarray\tFalse\t3031642.924542 730792.521676\t751892.023189\t367782.358049\t137989.198821\t780618.761219 serialize\tMEDIA_CONTENT\tarray\tTrue\t2250384.600246 445251.084327\t583859.907758\t329427.470680\t140260.668888 serialize\tMEDIA_CONTENT\tdirectBuffer\tFalse\t2479862.129632 608972.517580\t728001.080250\t372477.138150\t138567.623369\t805941.345157 serialize\tMEDIA_CONTENT\tdirectBuffer\tTrue\t1938527.588331 359875.473951\t595679.580108\t353376.085025\t140158.673910 serialize\tSAMPLE\tarray\tFalse\t3570966.469087 1105365.931217\t915907.574306\t220386.502846\t118374.836631\t663272.710783 serialize\tSAMPLE\tarray\tTrue\t1767693.835090 734215.482291\t731869.156376\t192414.014211\t119858.140625 serialize\tSAMPLE\tdirectBuffer\tFalse\t3684487.760591 1376560.302168\t902302.261168\t220981.308085\t118273.584257\t693641.589806 serialize\tSAMPLE\tdirectBuffer\tTrue\t1826456.709478 932887.968348\t723614.066770\t211949.960255\t108263.040839 serialize_compatible\tSTRUCT\tarray\tFalse\t3530406.108869\t9204444.777172\t145964.199559 258650.663523 serialize_compatible\tSTRUCT\tarray\tTrue\t3293059.098127\t7064625.291374\t136180.832879 263564.913879 serialize_compatible\tSTRUCT\tdirectBuffer\tFalse\t2653169.568374\t11650229.648715\t106695.800225 249221.452137 serialize_compatible\tSTRUCT\tdirectBuffer\tTrue\t2393817.762938\t8702412.752357\t106458.212005 263623.143601 serialize_compatible\tSTRUCT2\tarray\tFalse\t2773368.997680\t2575824.143864\t125807.748004 58509.125342 serialize_compatible\tSTRUCT2\tarray\tTrue\t2564174.550276\t3543082.528217\t114983.546343 55552.977735 serialize_compatible\tSTRUCT2\tdirectBuffer\tFalse\t1912402.937879\t2714748.572248\t92130.672361 58908.567439 serialize_compatible\tSTRUCT2\tdirectBuffer\tTrue\t1848338.968058\t1866073.031851\t88989.724768 55524.373547 serialize_compatible\tMEDIA_CONTENT\tarray\tFalse\t1679272.036223\t2992288.235281\t188911.259146 377195.903772 serialize_compatible\tMEDIA_CONTENT\tarray\tTrue\t1406736.538716\t2058738.716953\t145782.916427 351657.879556 serialize_compatible\tMEDIA_CONTENT\tdirectBuffer\tFalse\t1710680.937387\t2291443.556971\t185363.714829 371729.727192 serialize_compatible\tMEDIA_CONTENT\tdirectBuffer\tTrue\t1149999.473994\t1804349.244125\t142836.961878 343834.954942 serialize_compatible\tSAMPLE\tarray\tFalse\t3604596.465625\t4409055.687063\t378907.663184 234454.975158 serialize_compatible\tSAMPLE\tarray\tTrue\t1619648.337293\t1840705.439334\t320815.567701 206174.173039 serialize_compatible\tSAMPLE\tdirectBuffer\tFalse\t3484533.218305\t5043538.364886\t296102.615094 194761.224263 serialize_compatible\tSAMPLE\tdirectBuffer\tTrue\t1730822.630648\t1859289.705838\t276757.392449 212840.483308 deserialize\tSTRUCT\tarray\tFalse\t4595230.434552 607750.343557\t357887.235311\t84709.108821\t29603.066599\t517381.168594 deserialize\tSTRUCT\tarray\tTrue\t4634753.596131 552802.227807\t353480.554035\t91050.370224\t29727.744196 deserialize\tSTRUCT\tdirectBuffer\tFalse\t5012002.859236 910534.169114\t352441.597147\t91151.633583\t28717.004518\t538922.947147 deserialize\tSTRUCT\tdirectBuffer\tTrue\t4864329.316938 914404.107564\t334574.303484\t91037.205901\t29549.998286 deserialize\tSTRUCT2\tarray\tFalse\t1126298.359550 275984.042401\t280131.091068\t69758.767783\t14888.805111\t416212.973861 deserialize\tSTRUCT2\tarray\tTrue\t1046649.083082 222710.554833\t260649.308016\t68616.029248\t14034.100664 deserialize\tSTRUCT2\tdirectBuffer\tFalse\t1117586.457565 319247.256793\t262519.858810\t66866.108653\t14652.043788\t425523.315814 deserialize\tSTRUCT2\tdirectBuffer\tTrue\t1018277.848128 249105.828416\t234973.637096\t65338.345185\t14425.886048 deserialize\tMEDIA_CONTENT\tarray\tFalse\t2054066.903469 577631.234369\t363455.785182\t118156.072284\t38536.250402\t951662.019963 deserialize\tMEDIA_CONTENT\tarray\tTrue\t1507767.206603 365530.417232\t304371.728638\t120016.594171\t38957.191090 deserialize\tMEDIA_CONTENT\tdirectBuffer\tFalse\t1502746.028159 389473.174523\t311691.658687\t111067.942626\t40512.632076\t964664.641598 deserialize\tMEDIA_CONTENT\tdirectBuffer\tTrue\t1290593.975753 306995.220799\t251820.171513\t121820.821260\t37030.594632 deserialize\tSAMPLE\tarray\tFalse\t2069988.624415 979173.981159\t473409.796491\t119471.518388\t29309.573998\t619338.385412 deserialize\tSAMPLE\tarray\tTrue\t1797942.442313 716438.884369\t428315.502365\t121106.002978\t27466.003923 deserialize\tSAMPLE\tdirectBuffer\tFalse\t2229791.078395 983538.936801\t441027.550809\t117806.916589\t28128.457935\t624804.978534 deserialize\tSAMPLE\tdirectBuffer\tTrue\t1958815.397807 762889.302732\t420523.770904\t121940.783597\t28221.014735 deserialize_compatible\tSTRUCT\tarray\tFalse\t2110335.039275\t4978833.206806\t78771.635309 88617.486795 deserialize_compatible\tSTRUCT\tarray\tTrue\t2135681.982674\t4807963.882520\t72805.937649 90206.654212 deserialize_compatible\tSTRUCT\tdirectBuffer\tFalse\t1596464.248141\t5149070.657830\t58574.904225 89580.561575 deserialize_compatible\tSTRUCT\tdirectBuffer\tTrue\t1684681.074242\t5137500.621288\t60685.320299 84407.472531 deserialize_compatible\tSTRUCT2\tarray\tFalse\t849507.176263\t1201998.142474\t60602.285743 63703.763814 deserialize_compatible\tSTRUCT2\tarray\tTrue\t815120.319155\t1058423.614156\t62729.908347 69521.573119 deserialize_compatible\tSTRUCT2\tdirectBuffer\tFalse\t784036.589363\t1131212.586953\t54637.329134 69342.030965 deserialize_compatible\tSTRUCT2\tdirectBuffer\tTrue\t782679.662083\t1089162.408165\t51761.569591 68542.055543 deserialize_compatible\tMEDIA_CONTENT\tarray\tFalse\t1441671.706320\t2279742.810882\t180882.860363 121619.090797 deserialize_compatible\tMEDIA_CONTENT\tarray\tTrue\t1121136.039627\t1623938.202345\t154311.211540 119994.104050 deserialize_compatible\tMEDIA_CONTENT\tdirectBuffer\tFalse\t1256034.732514\t1718098.363961\t134485.160300 107594.474890 deserialize_compatible\tMEDIA_CONTENT\tdirectBuffer\tTrue\t1054942.751816\t1333345.536684\t119311.787329 116531.023438 deserialize_compatible\tSAMPLE\tarray\tFalse\t2296046.895861\t2485564.396196\t255086.928308 121898.105768 deserialize_compatible\tSAMPLE\tarray\tTrue\t1834139.395757\t2002938.794909\t238811.995510 121297.485903 deserialize_compatible\tSAMPLE\tdirectBuffer\tFalse\t2308111.633661\t2289261.533644\t201993.787890 124044.417439 deserialize_compatible\tSAMPLE\tdirectBuffer\tTrue\t1820490.585648\t1927548.827586\t174534.710870 120276.449497   ","version":"dev","tagName":"h3"},{"title":"Java Zero-copy‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/next/benchmarks/java/#java-zero-copy","content":" Benchmark\tarray_size\tbufferType\tdataType\tFory\tKryo\tFstserialize\t200\tarray\tBUFFER\t5123572.914045\t1985187.977633\t2400193.220466 serialize\t200\tarray\tPRIMITIVE_ARRAY\t8297232.942927\t147342.606262\t313986.053417 serialize\t200\tdirectBuffer\tBUFFER\t5400346.890126\t1739454.519770\t2282550.111756 serialize\t200\tdirectBuffer\tPRIMITIVE_ARRAY\t8335248.350301\t972683.763633\t294132.218623 serialize\t1000\tarray\tBUFFER\t4979590.929127\t1616159.671230\t1805557.477810 serialize\t1000\tarray\tPRIMITIVE_ARRAY\t8772856.921028\t31395.721514\t67209.107012 serialize\t1000\tdirectBuffer\tBUFFER\t5376191.775007\t1377272.568510\t1644789.427010 serialize\t1000\tdirectBuffer\tPRIMITIVE_ARRAY\t8207563.785251\t209183.090868\t66108.014322 serialize\t5000\tarray\tBUFFER\t5018916.322770\t711287.533377\t811029.402136 serialize\t5000\tarray\tPRIMITIVE_ARRAY\t8027439.580226\t6248.006967\t14997.400124 serialize\t5000\tdirectBuffer\tBUFFER\t5330897.682960\t707092.956534\t477148.540850 serialize\t5000\tdirectBuffer\tPRIMITIVE_ARRAY\t7695981.988316\t43565.678616\t15000.378818 deserialize\t200\tarray\tBUFFER\t3302149.383135\t1296284.787720\t657754.887247 deserialize\t200\tarray\tPRIMITIVE_ARRAY\t986136.067809\t146675.360652\t219333.990504 deserialize\t200\tdirectBuffer\tBUFFER\t3113115.471758\t1004844.498712\t598421.278941 deserialize\t200\tdirectBuffer\tPRIMITIVE_ARRAY\t991807.969328\t518713.299422\t179604.045774 deserialize\t1000\tarray\tBUFFER\t2831942.848999\t721266.541130\t422147.154601 deserialize\t1000\tarray\tPRIMITIVE_ARRAY\t205671.992736\t30409.835023\t53100.903684 deserialize\t1000\tdirectBuffer\tBUFFER\t3397690.327371\t592972.713203\t298929.116572 deserialize\t1000\tdirectBuffer\tPRIMITIVE_ARRAY\t202275.242341\t112132.004609\t38572.001768 deserialize\t5000\tarray\tBUFFER\t3296658.120035\t147251.846111\t136934.604328 deserialize\t5000\tarray\tPRIMITIVE_ARRAY\t40312.590172\t6122.351228\t10672.872798 deserialize\t5000\tdirectBuffer\tBUFFER\t3284441.570594\t148614.476829\t77950.612503 deserialize\t5000\tdirectBuffer\tPRIMITIVE_ARRAY\t40413.743717\t21826.040410\t8561.694533 ","version":"dev","tagName":"h3"},{"title":"Usage","type":0,"sectionRef":"#","url":"/docs/0.14/start/usage","content":"","keywords":"","version":"0.14"},{"title":"Native Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.14/start/usage#native-serialization","content":" Always use native mode when working with a single language. Native mode delivers optimal performance by avoiding the type metadata overhead required for cross-language compatibility.  Xlang mode introduces additional metadata encoding costs and restricts serialization to types that are common across all supported languages. Language-specific types will be rejected during serialization in xlang-mode.  ","version":"0.14","tagName":"h2"},{"title":"Java Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.14/start/usage#java-serialization","content":" When you don't need cross-language support, use Java mode for optimal performance.  import org.apache.fory.*; import org.apache.fory.config.*; public class Example { public static class Person { String name; int age; } public static void main(String[] args) { // Create Fory instance - should be reused across serializations BaseFory fory = Fory.builder() .withLanguage(Language.JAVA) .requireClassRegistration(true) // replace `build` with `buildThreadSafeFory` for Thread-Safe Usage .build(); // Register your classes (required when class registration is enabled) fory.register(Person.class); // Serialize Person person = new Person(); person.name = &quot;chaokunyang&quot;; person.age = 28; byte[] bytes = fory.serialize(person); Person result = (Person) fory.deserialize(bytes); System.out.println(result.name + &quot; &quot; + result.age); // Output: chaokunyang 28 } }   For detailed Java usage including compatibility modes, compression, and advanced features, see Java Serialization Guide.  ","version":"0.14","tagName":"h3"},{"title":"Python Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.14/start/usage#python-serialization","content":" Python native mode provides a high-performance drop-in replacement for pickle/cloudpickle with better speed and compatibility.  from dataclasses import dataclass import pyfory @dataclass class Person: name: str age: pyfory.int32 # Create Fory instance - should be reused across serializations fory = pyfory.Fory() # Register your classes (required when class registration is enabled) fory.register_type(Person) person = Person(name=&quot;chaokunyang&quot;, age=28) data = fory.serialize(person) result = fory.deserialize(data) print(result.name, result.age) # Output: chaokunyang 28   For detailed Python usage including type hints, compatibility modes, and advanced features, see Python Guide.  ","version":"0.14","tagName":"h3"},{"title":"Scala Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.14/start/usage#scala-serialization","content":" Scala native mode provides optimized serialization for Scala-specific types including case classes, collections, and Option types.  import org.apache.fory.Fory import org.apache.fory.config.Language import org.apache.fory.serializer.scala.ScalaSerializers case class Person(name: String, age: Int) object Example { def main(args: Array[String]): Unit = { // Create Fory instance - should be reused across serializations val fory = Fory.builder() .withLanguage(Language.JAVA) .requireClassRegistration(true) .build() // Register Scala serializers for Scala-specific types ScalaSerializers.registerSerializers(fory) // Register your case classes fory.register(classOf[Person]) val bytes = fory.serialize(Person(&quot;chaokunyang&quot;, 28)) val result = fory.deserialize(bytes).asInstanceOf[Person] println(s&quot;${result.name} ${result.age}&quot;) // Output: chaokunyang 28 } }   For detailed Scala usage including collection serialization and integration patterns, see Scala Guide.  ","version":"0.14","tagName":"h3"},{"title":"Kotlin Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.14/start/usage#kotlin-serialization","content":" Kotlin native mode provides optimized serialization for Kotlin-specific types including data classes, nullable types, and Kotlin collections.  import org.apache.fory.Fory import org.apache.fory.config.Language import org.apache.fory.serializer.kotlin.KotlinSerializers data class Person(val name: String, val age: Int) fun main() { // Create Fory instance - should be reused across serializations val fory = Fory.builder() .withLanguage(Language.JAVA) .requireClassRegistration(true) .build() // Register Kotlin serializers for Kotlin-specific types KotlinSerializers.registerSerializers(fory) // Register your data classes fory.register(Person::class.java) val bytes = fory.serialize(Person(&quot;chaokunyang&quot;, 28)) val result = fory.deserialize(bytes) as Person println(&quot;${result.name} ${result.age}&quot;) // Output: chaokunyang 28 }   For detailed Kotlin usage including null safety and default value support, see kotlin/README.md.  ","version":"0.14","tagName":"h3"},{"title":"Cross-Language Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.14/start/usage#cross-language-serialization","content":" Only use xlang mode when you need cross-language data exchange. Xlang mode adds type metadata overhead for cross-language compatibility and only supports types that can be mapped across all languages. For single-language use cases, always prefer native mode for better performance.  The following examples demonstrate serializing a Person object across Java and Rust. For other languages (Python, Go, JavaScript, etc.), simply set the language mode to XLANG and follow the same pattern.  ","version":"0.14","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.14/start/usage#java","content":" import org.apache.fory.*; import org.apache.fory.config.*; public class XlangExample { public record Person(String name, int age) {} public static void main(String[] args) { // Create Fory instance with XLANG mode Fory fory = Fory.builder() .withLanguage(Language.XLANG) .build(); // Register with cross-language type id/name fory.register(Person.class, 1); // fory.register(Person.class, &quot;example.Person&quot;); Person person = new Person(&quot;chaokunyang&quot;, 28); byte[] bytes = fory.serialize(person); // bytes can be deserialized by Rust, Python, Go, or other languages Person result = (Person) fory.deserialize(bytes); System.out.println(result.name + &quot; &quot; + result.age); // Output: chaokunyang 28 } }   ","version":"0.14","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.14/start/usage#rust","content":" use fory::{Fory, ForyObject}; #[derive(ForyObject, Debug)] struct Person { name: String, age: i32, } fn main() -&gt; Result&lt;(), Error&gt; { let mut fory = Fory::default(); fory.register::&lt;Person&gt;(1)?; // fory.register_by_name::&lt;Person&gt;(&quot;example.Person&quot;)?; let person = Person { name: &quot;chaokunyang&quot;.to_string(), age: 28, }; let bytes = fory.serialize(&amp;person); // bytes can be deserialized by Java, Python, Go, or other languages let result: Person = fory.deserialize(&amp;bytes)?; println!(&quot;{} {}&quot;, result.name, result.age); // Output: chaokunyang 28 }   ","version":"0.14","tagName":"h3"},{"title":"Golang‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.14/start/usage#golang","content":" type Person struct { name: string age: i32 } fory := fory.NewFory(true) fory.Register(Person{}, 1) person := Person{&quot;chaokunyang&quot;, 28} bytes, err := fory.Marshal(person) var p Person err = fory.Unmarshal(bytes, &amp;p)   ","version":"0.14","tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.14/start/usage#javascript","content":" import Fory, { Type } from &quot;@apache-fory/fory&quot;; /** * @apache-fory/hps use v8's fast-calls-api that can be called directly by jit, ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from &quot;@apache-fory/hps&quot;; // Now we describe data structures using JSON, but in the future, we will use more ways. const description = Type.object(&quot;example.Person&quot;, { name: Type.string(), age: Type.int32(), }); const fory = new Fory({ hps }); const { serialize, deserialize } = fory.registerSerializer(description); const input = serialize({ name: &quot;chaokunyang&quot;, age: 28 }); const result = deserialize(input); console.log(result);   ","version":"0.14","tagName":"h3"},{"title":"Key Points‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.14/start/usage#key-points","content":" Use Language.XLANG mode in all languagesRegister types with consistent IDs or names across all languages: By ID (fory.register(Person.class, 1)): Faster serialization, more compact encoding, but requires coordination to avoid ID conflictsBy name (fory.register(Person.class, &quot;example.Person&quot;)): More flexible, less prone to conflicts, easier to manage across teams, but slightly larger encoding Type IDs/names must match across all languages for successful deserializationOnly use types that have cross-language mappings (see Type Mapping)  For examples with circular references, shared references, and polymorphism across languages, see:  Cross-Language Serialization GuideJava Serialization Guide - Cross LanguagePython Guide - Cross Language  ","version":"0.14","tagName":"h3"},{"title":"Row Format Encoding‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.14/start/usage#row-format-encoding","content":" Row format provides zero-copy random access to serialized data, making it ideal for analytics workloads and data processing pipelines.  ","version":"0.14","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.14/start/usage#java-1","content":" import org.apache.fory.format.*; import java.util.*; import java.util.stream.*; public class Bar { String f1; List&lt;Long&gt; f2; } public class Foo { int f1; List&lt;Integer&gt; f2; Map&lt;String, Integer&gt; f3; List&lt;Bar&gt; f4; } RowEncoder&lt;Foo&gt; encoder = Encoders.bean(Foo.class); Foo foo = new Foo(); foo.f1 = 10; foo.f2 = IntStream.range(0, 1000000).boxed().collect(Collectors.toList()); foo.f3 = IntStream.range(0, 1000000).boxed().collect(Collectors.toMap(i -&gt; &quot;k&quot;+i, i -&gt; i)); List&lt;Bar&gt; bars = new ArrayList&lt;&gt;(1000000); for (int i = 0; i &lt; 1000000; i++) { Bar bar = new Bar(); bar.f1 = &quot;s&quot; + i; bar.f2 = LongStream.range(0, 10).boxed().collect(Collectors.toList()); bars.add(bar); } foo.f4 = bars; // Serialize to row format (can be zero-copy read by Python) BinaryRow binaryRow = encoder.toRow(foo); // Deserialize entire object Foo newFoo = encoder.fromRow(binaryRow); // Zero-copy access to nested fields without full deserialization BinaryArray binaryArray2 = binaryRow.getArray(1); // Access f2 field BinaryArray binaryArray4 = binaryRow.getArray(3); // Access f4 field BinaryRow barStruct = binaryArray4.getStruct(10); // Access 11th Bar element long value = barStruct.getArray(1).getInt64(5); // Access nested value // Partial deserialization RowEncoder&lt;Bar&gt; barEncoder = Encoders.bean(Bar.class); Bar newBar = barEncoder.fromRow(barStruct); Bar newBar2 = barEncoder.fromRow(binaryArray4.getStruct(20));   ","version":"0.14","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Usage","url":"/docs/0.14/start/usage#python","content":" from dataclasses import dataclass from typing import List, Dict import pyarrow as pa import pyfory @dataclass class Bar: f1: str f2: List[pa.int64] @dataclass class Foo: f1: pa.int32 f2: List[pa.int32] f3: Dict[str, pa.int32] f4: List[Bar] encoder = pyfory.encoder(Foo) foo = Foo( f1=10, f2=list(range(1000_000)), f3={f&quot;k{i}&quot;: i for i in range(1000_000)}, f4=[Bar(f1=f&quot;s{i}&quot;, f2=list(range(10))) for i in range(1000_000)] ) # Serialize to row format binary: bytes = encoder.to_row(foo).to_bytes() # Zero-copy random access without full deserialization foo_row = pyfory.RowData(encoder.schema, binary) print(foo_row.f2[100000]) # Access element directly print(foo_row.f4[100000].f1) # Access nested field print(foo_row.f4[200000].f2[5]) # Access deeply nested field   For more details on row format, see Java Row Format Guide or Python Row Format Guide. ","version":"0.14","tagName":"h3"},{"title":"Community","type":0,"sectionRef":"#","url":"/docs/next/community/","content":"","keywords":"","version":"dev"},{"title":"Mailing list‚Äã","type":1,"pageTitle":"Community","url":"/docs/next/community/#mailing-list","content":" Name\tDesc\tSubscribe\tUnsubscribe\tPost\tArchivedev@fory.apache.org\tDevelopment related discussions\tSubscribe\tUnsubscribe\tPost\tArchive commits@fory.apache.org\tAll commits to our repositories\tSubscribe\tUnsubscribe\tRead only list\tArchive  Please make sure subscribe to any list before attempting to post.  If you are not subscribed to the mailing list, your message will either be rejected or you won't receive the response.  ","version":"dev","tagName":"h2"},{"title":"How to subscribe to a mailing list‚Äã","type":1,"pageTitle":"Community","url":"/docs/next/community/#how-to-subscribe-to-a-mailing-list","content":" To post messages, subscribe first by:  Sending an email to listname-subscribe@fory.apache.org with listname replaced accordingly.Replying to the confirmation email you'll receive, keeping the subject line intact.You'll then get a welcome email, and the subscription succeeds.  When discussing code snippets in emails, ensure:  You do not link to files in external services, as such files can change, get deleted or the link might break and thus make an archived email thread useless.You paste text instead of screenshots of text.You keep formatting when pasting code in order to keep the code readable.There are enough import statements to avoid ambiguities.  ","version":"dev","tagName":"h3"},{"title":"Slack‚Äã","type":1,"pageTitle":"Community","url":"/docs/next/community/#slack","content":" You can join the Apache Fory‚Ñ¢ community on Slack.  There are a couple of community rules:  Be respectful and nice.All important decisions and conclusions must be reflected back to the mailing lists. &quot;If it didn't happen on a mailing list, it didn't happen.&quot; - The Apache Mottos.Use Slack threads to keep parallel conversations from overwhelming a channel.Please do not direct message people for troubleshooting, issue assigning and PR review. These should be picked-up voluntarily.  ","version":"dev","tagName":"h2"},{"title":"Issue tracker‚Äã","type":1,"pageTitle":"Community","url":"/docs/next/community/#issue-tracker","content":" We use GitHub Issues to track all issues:  code related issues: https://github.com/apache/fory/issueswebsite related issues: https://github.com/apache/fory-site/issues  You need to have a GitHub account in order to create issues. If you don't have a GitHub account, you can post an email to dev@fory.apache.org.  ","version":"dev","tagName":"h2"},{"title":"Bug reports‚Äã","type":1,"pageTitle":"Community","url":"/docs/next/community/#bug-reports","content":" To report a bug:  Verify that the bug does in fact exist.Search the issue tracker to verify there is no existing issue reporting the bug you've found.Create a bug report on issue tracker.If possible, dive into the source code of fory, and submit a patch for the bug you reported, this helps ensure the bug will be fixed quickly.  ","version":"dev","tagName":"h3"},{"title":"Reporting a Vulnerability‚Äã","type":1,"pageTitle":"Community","url":"/docs/next/community/#reporting-a-vulnerability","content":" Apache Fory‚Ñ¢ is a project of the Apache Software Foundation and follows the ASF vulnerability handling process.  To report a new vulnerability you have discovered please follow the ASF vulnerability reporting process, which explains how to send us details privately.  ","version":"dev","tagName":"h3"},{"title":"Enhancement‚Äã","type":1,"pageTitle":"Community","url":"/docs/next/community/#enhancement","content":" Enhancements or new feature proposals are also welcome. The more concrete and rationale the proposal is, the greater the chance it will be incorporated into future releases.  ","version":"dev","tagName":"h3"},{"title":"Source code‚Äã","type":1,"pageTitle":"Community","url":"/docs/next/community/#source-code","content":" fory core repository: https://github.com/apache/foryfory website repository: https://github.com/apache/fory-site ","version":"dev","tagName":"h2"},{"title":"How to join Apache Fory‚Ñ¢","type":0,"sectionRef":"#","url":"/docs/next/community/how_to_join_community","content":"","keywords":"","version":"dev"},{"title":"Fory Contribution Guide‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/next/community/how_to_join_community#fory-contribution-guide","content":" The Fory team usually conducts development and issue maintenance on GitHub. Please open the GitHub website, click the Sign up button in the upper right corner, register your own account, and take the first step of your open source journey.  In the Fory repository, we have a guide for all open source contributors, introducing contents such as version management and branch management. Please take a few minutes to read and understand it.  ","version":"dev","tagName":"h2"},{"title":"Your First Pull Request‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/next/community/how_to_join_community#your-first-pull-request","content":" ","version":"dev","tagName":"h2"},{"title":"Step 0: Install Git‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/next/community/how_to_join_community#step-0-install-git","content":" Git is a version control system used to track and manage code changes in software development projects. It helps developers record and manage the history of the code, facilitating team collaboration, code version control, code merging, and other operations. With Git, you can track each version of each file and easily switch and compare between different versions. Git also provides branch management functionality, allowing multiple concurrent development tasks to be carried out simultaneously.  Visit the official Git website: [https://git-scm.com/] (https://git-scm.com/)Download the latest version of the Git installer.Run the downloaded installer and follow the prompts of the installation wizard to install.After the installation is complete, you can use the git version command in the command line to confirm the successful installation.  ","version":"dev","tagName":"h3"},{"title":"Step 1: Fork the Project‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/next/community/how_to_join_community#step-1-fork-the-project","content":" First, you need to fork this project. Enter the Fory project page, and click the Fork button in the upper right corner.In your GitHub account, the project xxxx (your GitHub username)/fory will appear.On your local computer, use the following commands to obtain a fory folder:  // ssh git clone git@github.com:xxxx (your GitHub username)/fory.git // https git clone https://github.com/xxxx (your GitHub username)/fory.git   ","version":"dev","tagName":"h3"},{"title":"Step 2: Obtain the Project Code‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/next/community/how_to_join_community#step-2-obtain-the-project-code","content":" Enter the fory folder and add the remote address of fory:  git remote add upstream https://github.com/apache/fory.git   ","version":"dev","tagName":"h3"},{"title":"Step 3: Create a Branch‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/next/community/how_to_join_community#step-3-create-a-branch","content":" Alright, now you can start contributing our code. The default branch of Fory is the main branch. Whether it is for function development, bug fixes, or documentation writing, please create a new branch and then merge it to the main branch. Use the following code to create a branch:  // Create a function development branch git checkout -b feat/xxxx // Create a problem-fixing development branch git checkout -b fix/xxxx // Create a documentation, demo branch git checkout -b docs/add-java-demo   Suppose we have created the documentation modification branch docs/add-java-demo and we have added some code and submitted it to the code repository.  git add .git commit -a -m &quot;docs: add java demo and related docs&quot;  ","version":"dev","tagName":"h3"},{"title":"Step 4: Merge the Modifications‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/next/community/how_to_join_community#step-4-merge-the-modifications","content":" Switch back to your development branch:  git checkout docs/add-java-demo   Submit the updated code to your branch:  git push origin docs/add-java-demo   ","version":"dev","tagName":"h3"},{"title":"Step 5: Submit a Pull Request‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/next/community/how_to_join_community#step-5-submit-a-pull-request","content":" You can click the Compare &amp; pull request button on your GitHub code repository page. Or create it through the contribute button.  Fill in what type of modification this is.Fill in the associated issue.If there are complex changes, please explain the background and solution.  After filling in the relevant information, click Create pull request to submit.  ","version":"dev","tagName":"h3"},{"title":"Easily Step into the Fory Open Source Contribution Journey‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/next/community/how_to_join_community#easily-step-into-the-fory-open-source-contribution-journey","content":" &quot;good first issue&quot; is a common label in the open source community, and the purpose of this label is to help new contributors find entry-level issues that are suitable for them.  The entry-level issues of Fory can be viewed through the issue list.  If you currently have the time and willingness to participate in community contributions, you can take a look at good first issue in the issues and select one that interests you and is suitable for you to claim.  ","version":"dev","tagName":"h2"},{"title":"Embrace the Apache Fory‚Ñ¢ Community‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/next/community/how_to_join_community#embrace-the-apache-fory-community","content":" While you contribute code to Fory, we encourage you to participate in other things that make the community more prosperous, such as:  Offer suggestions for the project's development, functional planning, etc.Create articles, videos, and hold lectures to promote Fory.Write promotion plans and execute them together with the team. ","version":"dev","tagName":"h2"},{"title":"How to verify","type":0,"sectionRef":"#","url":"/docs/next/community/how_to_verify","content":"","keywords":"","version":"dev"},{"title":"Download the candidate version‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/next/community/how_to_verify#download-the-candidate-version","content":" #If there is svn locally, you can clone to the local svn co https://dist.apache.org/repos/dist/dev/fory/${release_version}-${rc_version}/ # You can download the material file directly wget https://dist.apache.org/repos/dist/dev/fory/${release_version}-${rc_version}/xxx.xxx   ","version":"dev","tagName":"h2"},{"title":"Verify checksums and signatures‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/next/community/how_to_verify#verify-checksums-and-signatures","content":" First you need to install gpg:  apt-get install gnupg # or yum install gnupg # or brew install gnupg   Then import the Fory release manager's public key:  curl https://downloads.apache.org/fory/KEYS &gt; KEYS # Download KEYS gpg --import KEYS # Import KEYS to local # Then, trust the public key: gpg --edit-key &lt;KEY-used-in-this-version&gt; # Edit the key(mentioned in vote email) # It will enter the interactive mode, use the following command to trust the key: gpg (GnuPG) 2.0.22; Copyright (C) 2013 Free Software Foundation, Inc. This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. pub 4096R/5E580BA4 created: 2024-03-27 expires: never usage: SC trust: unknown validity: unknown sub 4096R/A31EF728 created: 2024-03-27 expires: never usage: E [ unknown] (1). chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; gpg&gt; trust pub 4096R/5E580BA4 created: 2024-03-27 expires: never usage: SC trust: unknown validity: unknown sub 4096R/A31EF728 created: 2024-03-27 expires: never usage: E [ unknown] (1). chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; Please decide how far you trust this user to correctly verify other users' keys (by looking at passports, checking fingerprints from different sources, etc.) 1 = I don't know or won't say 2 = I do NOT trust 3 = I trust marginally 4 = I trust fully 5 = I trust ultimately m = back to the main menu Your decision? 5 Do you really want to set this key to ultimate trust? (y/N) y pub 4096R/5E580BA4 created: 2024-03-27 expires: never usage: SC trust: ultimate validity: unknown sub 4096R/A31EF728 created: 2024-03-27 expires: never usage: E [ unknown] (1). chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; Please note that the shown key validity is not necessarily correct unless you restart the program.   Next verify signature:  for i in *.tar.gz; do echo $i; gpg --verify $i.asc $i; done   If something like the following appears, it means the signature is correct:  apache-fory-0.12.0-src.tar.gz gpg: Signature made Wed 17 Apr 2024 11:49:45 PM CST using RSA key ID 5E580BA4 gpg: checking the trustdb gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model gpg: depth: 0 valid: 1 signed: 0 trust: 0-, 0q, 0n, 0m, 0f, 1u gpg: Good signature from &quot;chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt;&quot;   Then verify checksum:  for i in *.tar.gz; do echo $i; sha512sum --check $i.sha512*; done   It should output something like:  apache-fory-0.12.0-src.tar.gz apache-fory-0.12.0-src.tar.gz: OK   A quick way to verify above is:  curl -s https://raw.githubusercontent.com/apache/fory/main/ci/release.py | python3 - verify -v 0.5.0   ","version":"dev","tagName":"h2"},{"title":"Check the file content of the source package‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/next/community/how_to_verify#check-the-file-content-of-the-source-package","content":" Unzip apache-fory-${release_version}-${rc_version}-src.tar.gz and check the follows:  LICENSE and NOTICE files are correct for the repository.All files have ASF license headers if necessary.Building is OK.  ","version":"dev","tagName":"h2"},{"title":"Check the Maven artifacts of fory-java‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/next/community/how_to_verify#check-the-maven-artifacts-of-fory-java","content":" Download the artifacts from https://repository.apache.org/content/repositories/orgapachefory-${maven_artifact_number}/.  You can check the follows:  Checksum of JARs match the bundled checksum file.Signature of JARs match the bundled signature file.JARs is reproducible locally. This means you can build the JARs on your machine and verify the checksum is the same with the bundled one. ","version":"dev","tagName":"h2"},{"title":"Overview","type":0,"sectionRef":"#","url":"/docs/next/compiler/","content":"","keywords":"","version":"dev"},{"title":"Example Schema‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/compiler/#example-schema","content":" Fory IDL provides a simple, intuitive syntax for defining cross-language data structures:  package example; enum Status { PENDING = 0; ACTIVE = 1; COMPLETED = 2; } message User { string name = 1; int32 age = 2; optional string email = 3; list&lt;string&gt; tags = 4; } message Item { string sku = 1; int32 quantity = 2; } message Order { ref User customer = 1; list&lt;Item&gt; items = 2; Status status = 3; map&lt;string, int32&gt; metadata = 4; } message Dog [id=104] { string name = 1; int32 bark_volume = 2; } message Cat [id=105] { string name = 1; int32 lives = 2; } union Animal [id=106] { Dog dog = 1; Cat cat = 2; }   ","version":"dev","tagName":"h2"},{"title":"Why Fory IDL?‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/compiler/#why-fory-idl","content":" ","version":"dev","tagName":"h2"},{"title":"Schema-First Development‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/compiler/#schema-first-development","content":" Define your data model once in Fory IDL and generate consistent, type-safe code across all languages. This ensures:  Type Safety: Catch type errors at compile time, not runtimeConsistency: All languages use the same field names, types, and structuresDocumentation: Schema serves as living documentationEvolution: Managed schema changes across all implementations  ","version":"dev","tagName":"h3"},{"title":"Fory-Native Features‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/compiler/#fory-native-features","content":" Unlike generic IDLs, Fory IDL is designed specifically for Fory serialization:  Reference Tracking: First-class support for shared and circular references via refNullable Fields: Explicit optional modifier for nullable typesType Registration: Built-in support for both numeric IDs and namespace-based registrationNative Code Generation: Generates idiomatic code with Fory annotations/macros  ","version":"dev","tagName":"h3"},{"title":"Low Integration Overhead‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/compiler/#low-integration-overhead","content":" Generated code uses native language constructs:  Java: Plain POJOs with @ForyField annotationsPython: Dataclasses with type hintsGo: Structs with struct tagsRust: Structs with #[derive(ForyObject)]C++: Structs with FORY_STRUCT macrosC#: Classes with [ForyObject] and registration helpers  ","version":"dev","tagName":"h3"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/compiler/#quick-start","content":" ","version":"dev","tagName":"h2"},{"title":"1. Install the Compiler‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/compiler/#1-install-the-compiler","content":" pip install fory-compiler   Or install from source:  cd compiler pip install -e .   ","version":"dev","tagName":"h3"},{"title":"2. Write Your Schema‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/compiler/#2-write-your-schema","content":" Create example.fdl:  package example; message Person { string name = 1; int32 age = 2; optional string email = 3; }   ","version":"dev","tagName":"h3"},{"title":"3. Generate Code‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/compiler/#3-generate-code","content":" # Generate for all languages foryc example.fdl --output ./generated # Generate for specific languages foryc example.fdl --lang java,python,csharp --output ./generated   ","version":"dev","tagName":"h3"},{"title":"4. Use Generated Code‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/compiler/#4-use-generated-code","content":" Java:  Person person = new Person(); person.setName(&quot;Alice&quot;); person.setAge(30); byte[] data = person.toBytes();   Python:  import pyfory from example import Person person = Person(name=&quot;Alice&quot;, age=30) data = bytes(person) # or `person.to_bytes()`   ","version":"dev","tagName":"h3"},{"title":"Documentation‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/compiler/#documentation","content":" Document\tDescriptionFory IDL Syntax\tComplete language syntax and grammar Type System\tPrimitive types, collections, and type rules Compiler Guide\tCLI options and build integration Generated Code\tOutput format for each target language Protocol Buffers IDL Support\tComparison with protobuf and migration guide FlatBuffers IDL Support\tFlatBuffers mapping rules and codegen differences  ","version":"dev","tagName":"h2"},{"title":"Key Concepts‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/compiler/#key-concepts","content":" ","version":"dev","tagName":"h2"},{"title":"Field Modifiers‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/compiler/#field-modifiers","content":" optional: Field can be null/Noneref: Enable reference tracking for shared/circular referenceslist: Field is a list/array (alias: repeated)  message Example { optional string nullable = 1; ref Node parent = 2; list&lt;int32&gt; numbers = 3; }   ","version":"dev","tagName":"h3"},{"title":"Cross-Language Compatibility‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/compiler/#cross-language-compatibility","content":" Fory IDL types map to native types in each language:  Fory IDL Type\tJava\tPython\tGo\tRust\tC++\tC#int32\tint\tpyfory.int32\tint32\ti32\tint32_t\tint string\tString\tstr\tstring\tString\tstd::string\tstring bool\tboolean\tbool\tbool\tbool\tbool\tbool  See Type System for complete mappings.  ","version":"dev","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/compiler/#best-practices","content":" Use meaningful package names: Group related types togetherAssign type IDs for performance: Numeric IDs are faster than name-based registrationReserve ID ranges: Leave gaps for future additions (e.g., 100-199 for users, 200-299 for orders)Use optional explicitly: Make nullability clear in the schemaUse ref for shared objects: Enable reference tracking when objects are shared  ","version":"dev","tagName":"h2"},{"title":"Examples‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/compiler/#examples","content":" See the examples directory for complete working examples. ","version":"dev","tagName":"h2"},{"title":"FlatBuffers IDL Support","type":0,"sectionRef":"#","url":"/docs/next/compiler/flatbuffers_idl","content":"","keywords":"","version":"dev"},{"title":"What This Page Covers‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/next/compiler/flatbuffers_idl#what-this-page-covers","content":" When to use FlatBuffers input with ForyExact FlatBuffers to Fory mapping behaviorSupported Fory-specific attributes in .fbsMigration notes and generated-code differences  ","version":"dev","tagName":"h2"},{"title":"Why Use Apache Fory‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/next/compiler/flatbuffers_idl#why-use-apache-fory","content":" Idiomatic generated code: Fory generates language-idiomatic classes/structs that can be used directly as domain objects.Java performance: In Java object-serialization workloads, Fory is faster than FlatBuffers in Fory benchmarks.Other languages: serialization performance is generally in a similar range.Deserialization in practice: FlatBuffers does not perform native-object deserialization and is faster by default, but if your application needs native objects, it requires conversion and that conversion step can dominate read cost. In those cases, Fory deserialization is often faster end-to-end.Easier APIs: Fory uses direct native objects, so you do not need to reverse-build tables or manually manage offsets.Better graph modeling: Shared and circular references are first-class features in Fory.  ","version":"dev","tagName":"h2"},{"title":"Quick Decision Guide‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/next/compiler/flatbuffers_idl#quick-decision-guide","content":" Situation\tRecommended PathYou already have .fbs schemas and want Fory runtime/codegen\tUse FlatBuffers input You are starting new schema work and want full Fory syntax control\tUse native Fory IDL You need FlatBuffers wire compatibility at runtime\tKeep FlatBuffers stack You need Fory object-graph semantics (ref, weak refs, etc.)\tUse Fory  ","version":"dev","tagName":"h2"},{"title":"FlatBuffers to Fory Mapping‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/next/compiler/flatbuffers_idl#flatbuffers-to-fory-mapping","content":" ","version":"dev","tagName":"h2"},{"title":"Schema-Level Rules‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/next/compiler/flatbuffers_idl#schema-level-rules","content":" namespace maps to Fory package namespace.include entries map to Fory imports.table is translated as evolving=true.struct is translated as evolving=false.root_type is parsed but ignored by Fory runtime/codegen.file_identifier and file_extension are parsed but not used by Fory codegen.  ","version":"dev","tagName":"h3"},{"title":"Field Numbering‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/next/compiler/flatbuffers_idl#field-numbering","content":" FlatBuffers fields do not have explicit field IDs. Fory assigns field numbers by source declaration order, starting at 1.  ","version":"dev","tagName":"h3"},{"title":"Scalar Type Mapping‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/next/compiler/flatbuffers_idl#scalar-type-mapping","content":" FlatBuffers\tFory Typebyte\tint8 ubyte\tuint8 short\tint16 ushort\tuint16 int\tint32 uint\tuint32 long\tint64 ulong\tuint64 float\tfloat32 double\tfloat64 bool\tbool string\tstring  Vectors ([T]) map to Fory lists.  ","version":"dev","tagName":"h3"},{"title":"Unions‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/next/compiler/flatbuffers_idl#unions","content":" FlatBuffers unions map to Fory unions.  Case IDs are assigned by declaration order, starting at 1.Case names are derived from type names using snake_case field naming.  FlatBuffers  union Payload { Note, Metric } table Container { payload: Payload; }   Fory shape after translation  union Payload { Note note = 1; Metric metric = 2; } message Container { Payload payload = 1; }   ","version":"dev","tagName":"h3"},{"title":"Defaults and Metadata‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/next/compiler/flatbuffers_idl#defaults-and-metadata","content":" FlatBuffers default values are parsed but not applied as Fory runtime defaults.Non-Fory metadata attributes are preserved as generic options in IR and may be consumed by downstream tooling.  ","version":"dev","tagName":"h3"},{"title":"Fory-Specific Attributes in FlatBuffers‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/next/compiler/flatbuffers_idl#fory-specific-attributes-in-flatbuffers","content":" FlatBuffers metadata attributes use key:value. For Fory-specific options, usefory_ (or fory.) prefix in .fbs; the prefix is removed during parsing.  ","version":"dev","tagName":"h2"},{"title":"Supported Field Attributes‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/next/compiler/flatbuffers_idl#supported-field-attributes","content":" FlatBuffers Attribute\tEffect in Foryfory_ref:true\tEnable reference tracking for the field fory_nullable:true\tMark field optional/nullable fory_weak_ref:true\tEnable weak reference semantics and implies ref fory_thread_safe_pointer:false\tFor ref fields, select non-thread-safe pointer flavor  Semantics:  fory_weak_ref:true implies ref.fory_thread_safe_pointer only takes effect when the field is ref-tracked.For list fields, fory_ref:true applies to list elements.  Example:  table Node { parent: Node (fory_weak_ref: true); children: [Node] (fory_ref: true); cached: Node (fory_ref: true, fory_thread_safe_pointer: false); }   ","version":"dev","tagName":"h3"},{"title":"Generated Code Differences‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/next/compiler/flatbuffers_idl#generated-code-differences","content":" Using .fbs as input to Fory still produces normal Fory-generated code, not FlatBuffers ByteBuffer-style APIs.  Java: POJOs/records with Fory metadataPython: dataclasses plus registration helpersGo/Rust/C++: native structs and Fory metadata  The serialization format is Fory binary protocol, not FlatBuffers wire format.  ","version":"dev","tagName":"h2"},{"title":"Usage‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/next/compiler/flatbuffers_idl#usage","content":" Compile a FlatBuffers schema directly:  foryc schema.fbs --lang java,python --output ./generated   Inspect translated schema syntax for debugging:  foryc schema.fbs --emit-fdl --emit-fdl-path ./translated   ","version":"dev","tagName":"h2"},{"title":"Migration Notes‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/next/compiler/flatbuffers_idl#migration-notes","content":" Keep existing namespace values stable to keep type registration stable.Review fields that relied on FlatBuffers default literals and set explicit defaults in application code if needed.Add fory_ref/fory_weak_ref where object-graph semantics are required.Validate generated model behavior with roundtrip tests before replacing existing serialization paths.  ","version":"dev","tagName":"h2"},{"title":"Summary‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/next/compiler/flatbuffers_idl#summary","content":" FlatBuffers input lets you reuse existing .fbs schemas while moving to Fory's runtime and code generation model. This is useful for incremental migration, while preserving schema investment and adopting Fory-native object APIs. ","version":"dev","tagName":"h2"},{"title":"How to release","type":0,"sectionRef":"#","url":"/docs/next/community/how_to_release","content":"","keywords":"","version":"dev"},{"title":"Introduction‚Äã","type":1,"pageTitle":"How to release","url":"/docs/next/community/how_to_release#introduction","content":" Source Release is the most important part which Apache values.  Please pay more attention to license and signing issues. Publishing software is a serious thing and has legal consequences.  ","version":"dev","tagName":"h2"},{"title":"First-time as a release manager‚Äã","type":1,"pageTitle":"How to release","url":"/docs/next/community/how_to_release#first-time-as-a-release-manager","content":" ","version":"dev","tagName":"h2"},{"title":"Environmental requirements‚Äã","type":1,"pageTitle":"How to release","url":"/docs/next/community/how_to_release#environmental-requirements","content":" This release process is operated in the Ubuntu OS, and the following tools are required:  JDK 1.8Apache Maven 3.xPython 3.8GnuPG 2.xGitSVN (apache uses svn to host project releases)Pay attention to setting environment variables: if you configure gpg keys under a different directory, please export GNUPGHOME=$(xxx)  ","version":"dev","tagName":"h3"},{"title":"Prepare GPG Key‚Äã","type":1,"pageTitle":"How to release","url":"/docs/next/community/how_to_release#prepare-gpg-key","content":" If you are the first to become a release manager, you need to prepare a gpg key.  Following is a quick setup, you can refer to Apache openpgp doc for further details.  Install GPG‚Äã  sudo apt install gnupg2   Generate GPG Key‚Äã  Please use your apache name and email for generate key  $ gpg --full-gen-key gpg (GnuPG) 2.2.20; Copyright (C) 2020 Free Software Foundation, Inc. This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. Please select what kind of key you want: (1) RSA and RSA (default) (2) DSA and Elgamal (3) DSA (sign only) (4) RSA (sign only) (14) Existing key from card Your selection? 1 # input 1 RSA keys may be between 1024 and 4096 bits long. What keysize do you want? (2048) 4096 # input 4096 Requested keysize is 4096 bits Please specify how long the key should be valid. 0 = key does not expire &lt;n&gt; = key expires in n days &lt;n&gt;w = key expires in n weeks &lt;n&gt;m = key expires in n months &lt;n&gt;y = key expires in n years Key is valid for? (0) 0 # input 0 Key does not expire at all Is this correct? (y/N) y # input y GnuPG needs to construct a user ID to identify your key. Real name: Chaokun Yang # input your name Email address: chaokunyang@apache.org # input your email Comment: CODE SIGNING KEY # input some annotations, optional You selected this USER-ID: &quot;Chaokun &lt;chaokunyang@apache.org&gt;&quot; Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? O # input O We need to generate a lot of random bytes. It is a good idea to perform some other action (type on the keyboard, move the mouse, utilize the disks) during the prime generation; this gives the random number generator a better chance to gain enough entropy. We need to generate a lot of random bytes. It is a good idea to perform some other action (type on the keyboard, move the mouse, utilize the disks) during the prime generation; this gives the random number generator a better chance to gain enough entropy. # Input the security key ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ Please enter this passphrase ‚îÇ ‚îÇ ‚îÇ ‚îÇ Passphrase: _______________________________ ‚îÇ ‚îÇ ‚îÇ ‚îÇ &lt;OK&gt; &lt;Cancel&gt; ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò # key generation will be done after your inputting the key with the following output gpg: key E49B00F626B marked as ultimately trusted gpg: revocation certificate stored as '/Users/chaokunyang/.gnupg/openpgp-revocs.d/1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4.rev' public and secret key created and signed. pub rsa4096 2022-07-12 [SC] 1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4 uid [ultimate] Chaokun &lt;chaokunyang@apache.org&gt; sub rsa4096 2022-07-12 [E]   Upload your public key to public GPG keyserver‚Äã  Firstly, list your key:  gpg --list-keys   The output is like:  -------------------------------------------------- pub rsa4096 2024-03-27 [SC] 1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4 uid [ultimate] chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; sub rsa4096 2024-03-27 [E]   Then, send your key id to key server:  gpg --keyserver keys.openpgp.org --send-key &lt;key-id&gt; # e.g., 1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4   Among them, keys.openpgp.org is a randomly selected keyserver, you can use keyserver.ubuntu.com or any other full-featured keyserver.  Check whether the key is created successfully‚Äã  Uploading takes about one minute; after that, you can check by email at the corresponding keyserver.  Uploading keys to the keyserver is mainly for joining a Web of Trust.  Add your GPG public key to the project KEYS file‚Äã  The svn repository of the release branch is: https://dist.apache.org/repos/dist/release/fory  Please add the public key to KEYS in the release branch:  svn co --depth=files https://dist.apache.org/repos/dist/release/fory fory-dist cd fory-dist (gpg --list-sigs YOUR_NAME@apache.org &amp;&amp; gpg --export --armor YOUR_NAME@apache.org) &gt;&gt; KEYS # Append your key to the KEYS file svn add . # It is not needed if the KEYS document exists before. svn ci -m &quot;add gpg key for YOUR_NAME&quot; # Later on, if you are asked to enter a username and password, just use your apache username and password.   Upload the GPG public key to your GitHub account‚Äã  Enter https://github.com/settings/keys to add your GPG key.Please remember to bind the email address used in the GPG key to your GitHub account (https://github.com/settings/emails) if you find &quot;unverified&quot; after adding it.  ","version":"dev","tagName":"h3"},{"title":"Further reading‚Äã","type":1,"pageTitle":"How to release","url":"/docs/next/community/how_to_release#further-reading","content":" It's recommended but not mandatory to read following documents before making a release to know more details about apache release:  Release policy: https://www.apache.org/legal/release-policy.htmlTLP release: https://infra.apache.org/release-distributionRelease sign: https://infra.apache.org/release-signing.htmlRelease publish: https://infra.apache.org/release-publishing.htmlRelease download pages: https://infra.apache.org/release-download-pages.htmlPublishing maven artifacts: https://infra.apache.org/publishing-maven-artifacts.html  ","version":"dev","tagName":"h3"},{"title":"Start discussion about the release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/next/community/how_to_release#start-discussion-about-the-release","content":" Start a discussion about the next release via sending email to: dev@fory.apache.org:  Title:  [DISCUSS] Release Apache Fory ${release_version}   Content:  Hello, Apache Fory Community, This is a call for a discussion to release Apache Fory version ${release_version}. The change lists about this release: https://github.com/apache/fory/compare/v0.12.0...v0.12.1-rc1 Please leave your comments here about this release plan. We will bump the version in repo and start the release process after the discussion. Thanks, ${name}   ","version":"dev","tagName":"h2"},{"title":"Preparing for release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/next/community/how_to_release#preparing-for-release","content":" If the discussion goes positive, you will need to prepare the release artifiacts.  ","version":"dev","tagName":"h2"},{"title":"Github branch and tag‚Äã","type":1,"pageTitle":"How to release","url":"/docs/next/community/how_to_release#github-branch-and-tag","content":" Create a new branch named releases-0.12.0Bump version to $version by executing command python ci/release.py bump_version -l all -version $versionMake a git commit and push the branch to git@github.com:apache/fory.gitCreate a new tag by git tag v0.12.0-rc1, then push it to git@github.com:apache/fory.git  ","version":"dev","tagName":"h3"},{"title":"Build and upload artifacts to SVN dist/dev repo‚Äã","type":1,"pageTitle":"How to release","url":"/docs/next/community/how_to_release#build-and-upload-artifacts-to-svn-distdev-repo","content":" First you need to build source release artifacts by python ci/release.py build -v $version.  Then you need to upload it to svn dist repo. The dist repo of the dev branch is: https://dist.apache.org/repos/dist/dev/fory  # As this step will copy all the versions, it will take some time. If the network is broken, please use svn cleanup to delete the lock before re-execute it. svn co https://dist.apache.org/repos/dist/dev/fory fory-dist-dev   Then, upload the artifacts:  cd fory-dist-dev # create a directory named by version mkdir ${release_version}-${rc_version} # copy source code and signature package to the versioned directory cp ${repo_dir}/dist/* ${release_version}-${rc_version} # check svn status svn status # add to svn svn add ${release_version}-${rc_version} # check svn status svn status # commit to SVN remote server svn commit -m &quot;Prepare for fory ${release_version}-${rc_version}&quot;   Visit https://dist.apache.org/repos/dist/dev/fory/ to check the artifacts are uploaded correctly.  ","version":"dev","tagName":"h3"},{"title":"What to do if something goes wrong‚Äã","type":1,"pageTitle":"How to release","url":"/docs/next/community/how_to_release#what-to-do-if-something-goes-wrong","content":" If some files are unexpected, you need to remove by svn delete and repeat the above upload process.  ","version":"dev","tagName":"h3"},{"title":"Voting‚Äã","type":1,"pageTitle":"How to release","url":"/docs/next/community/how_to_release#voting","content":" ","version":"dev","tagName":"h2"},{"title":"check version‚Äã","type":1,"pageTitle":"How to release","url":"/docs/next/community/how_to_release#check-version","content":" Fory requires votes from the Fory Community.  release_version: the version for fory, like 0.12.0.release_candidate_version: the version for voting, like 0.12.0-rc1.maven_artifact_number: the number for Maven staging artifacts, like 1001. Specifically, the maven_artifact_number can be found by searching &quot;fory&quot; on https://repository.apache.org/#stagingRepositories.  ","version":"dev","tagName":"h3"},{"title":"Build the source code of fory and release it to nexus‚Äã","type":1,"pageTitle":"How to release","url":"/docs/next/community/how_to_release#build-the-source-code-of-fory-and-release-it-to-nexus","content":" Configure Apache Account Passwords‚Äã  Before publishing Fory to Nexus, you need to securely configure your Apache account credentials. This step is critical as passwords must be encrypted.  First, open your Maven global settings file settings.xml, typically located at ~/.m2/settings.xml. Add or modify the following section:   &lt;servers&gt; &lt;server&gt; &lt;id&gt;apache.snapshots.https&lt;/id&gt; &lt;username&gt;your-apache-username&lt;/username&gt; &lt;password&gt;{your-encrypted-password}&lt;/password&gt; &lt;/server&gt; &lt;server&gt; &lt;id&gt;apache.releases.https&lt;/id&gt; &lt;username&gt;your-apache-username&lt;/username&gt; &lt;password&gt;{your-encrypted-password}&lt;/password&gt; &lt;/server&gt; &lt;/servers&gt;   Important Notes:  Replace your-apache-username with your Apache LDAP usernamePasswords must be encrypted using Maven's password encryption toolEncrypted passwords should be enclosed in curly braces {}  Refer to the official documentation for detailed encryption instructions: Publishing Maven Artifacts  Steps to encrypt your password:  Generate a master password (if you haven't already): mvn --encrypt-master-password your-master-password Save the output to ~/.m2/settings-security.xml: &lt;settingsSecurity&gt; &lt;master&gt;{your-encrypted-master-password}&lt;/master&gt; &lt;/settingsSecurity&gt; Encrypt your Apache account password: mvn --encrypt-password your-apache-password Place the encrypted output into the password field in settings.xml  Build and Publish Java Module‚Äã   # Navigate to the Java module directory cd java # Execute Maven build and deploy to Nexus # -T10: Use 10 threads for parallel build, improving speed # clean: Clean the project # deploy: Deploy to remote repository # -Papache-release: Activate apache-release profile # -DskipTests: Skip tests # -Dgpg.skip=false: Enable GPG signing (required for release verification) mvn -T10 clean deploy -Papache-release -DskipTests -Dgpg.skip=false   Build and Publish Kotlin Module‚Äã   # Return to project root and navigate to Kotlin module cd ../kotlin # Execute the same Maven command as Java module # Configuration parameters are identical to Java module mvn -T10 clean deploy -Papache-release -DskipTests -Dgpg.skip=false   Build and Publish Scala Module‚Äã   # Return to project root and navigate to Scala module cd ../scala # Build and sign JARs for all Scala versions # +publishSigned: Execute publishSigned for all configured Scala versions echo &quot;Starting to build Scala JARs...&quot; sbt +publishSigned # Prepare for upload to Sonatype (Nexus) # sonatypePrepare: Prepare for Maven Central Repository release echo &quot;Starting upload preparation...&quot; sbt sonatypePrepare # Upload packaged JARs to Sonatype # sonatypeBundleUpload: Upload prepared bundles echo &quot;Starting JAR upload...&quot; sbt sonatypeBundleUpload echo &quot;Scala JAR deployment succeeded!&quot;   Lock the Release in Nexus‚Äã  After completing the publication of all modules, perform the following steps in Nexus:  Log in to the Apache Nexus repository management interfaceNavigate to the &quot;Snapshots&quot; or &quot;Releases&quot; repository (depending on your release type)Locate the latest Fory project versionExecute the &quot;Close&quot; operation to validate all uploaded artifactsAfter successful validation, execute the &quot;Release&quot; operation to finalize the deployment  These steps ensure all published artifacts are verified and correctly deployed to the public repository.  ","version":"dev","tagName":"h3"},{"title":"build a Pre-release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/next/community/how_to_release#build-a-pre-release","content":" You need to build a Pre-release before voting, such as:https://github.com/apache/fory/releases/tag/v0.12.0-rc1  ","version":"dev","tagName":"h3"},{"title":"Fory Community Vote‚Äã","type":1,"pageTitle":"How to release","url":"/docs/next/community/how_to_release#fory-community-vote","content":" you need send a email to Fory Community: dev@fory.apache.org:  Title:  [VOTE] Release Apache Fory v${release_version}-${rc_version}   Content:  Hello, Apache Fory Community: This is a call for vote to release Apache Fory version release-${release_version}-${rc_version}. Apache Fory - A blazingly fast multi-language serialization framework powered by JIT and zero-copy. The discussion thread: https://lists.apache.org/thread/xxr3od301g6v3ndj14zqc05byp9qvclh The change lists about this release: https://github.com/apache/fory/compare/v0.12.0...v0.12.1-rc1 The release candidates: https://dist.apache.org/repos/dist/dev/fory/0.5.0-rc3/ The maven staging for this release: https://repository.apache.org/content/repositories/orgapachefory-1003 Git tag for the release: https://github.com/apache/fory/releases/tag/v0.12.0-rc1 Git commit for the release: https://github.com/apache/fory/commit/fae06330edd049bb960536e978a45b97bca66faf The artifacts signed with PGP key [5E580BA4], corresponding to [chaokunyang@apache.org], that can be found in keys file: https://downloads.apache.org/fory/KEYS The vote will be open for at least 72 hours until the necessary number of votes are reached. Please vote accordingly: [ ] +1 approve [ ] +0 no opinion [ ] -1 disapprove with the reason To learn more about Fory, please see https://fory.apache.org/ *Valid check is a requirement for a vote. *Checklist for reference: [ ] Download Fory is valid. [ ] Checksums and PGP signatures are valid. [ ] Source code distributions have correct names matching the current release. [ ] LICENSE and NOTICE files are correct. [ ] All files have license headers if necessary. [ ] No compiled archives bundled in source archive. [ ] Can compile from source. How to Build and Test, please refer to: https://github.com/apache/fory/blob/main/docs/guide/DEVELOPMENT.md Thanks, ${name}   After at least 3 +1 binding vote (from Fory Podling PMC member and committers) and no veto, first, reply to the above voting thread to notify that the voting has ended.  Hi all, The vote for Release Apache Fory v${release_version}-${rc_version} is closed now. Thanks to everyone for helping checking and voting for the release. I will close the vote later in another thread. Best, ${name}   Immediately afterward, launch a new voting thread to claim the voting results.  Title:  [RESULT][VOTE] Release Apache Fory v${release_version}-${rc_version}   Content:  Hello, Apache Fory Community, The vote to release Apache Fory v${release_version}-${rc_version} has passed. The vote PASSED with 3 binding +1 and 0 -1 vote: Binding votes: - xxx - yyy - zzz Vote thread: ${vote_thread_url} Thanks, ${name}   ","version":"dev","tagName":"h3"},{"title":"What if vote fail‚Äã","type":1,"pageTitle":"How to release","url":"/docs/next/community/how_to_release#what-if-vote-fail","content":" If the vote failed, click &quot;Drop&quot; to drop the staging Maven artifacts.  Address the raised issues, then bump rc_version and file a new vote again.  ","version":"dev","tagName":"h3"},{"title":"Official Release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/next/community/how_to_release#official-release","content":" ","version":"dev","tagName":"h2"},{"title":"Publish artifacts to SVN Release Directory‚Äã","type":1,"pageTitle":"How to release","url":"/docs/next/community/how_to_release#publish-artifacts-to-svn-release-directory","content":" release_version: the release version for fory, like 0.5.0release_candidate_version: the version for voting, like 0.5.0-rc1  svn mv https://dist.apache.org/repos/dist/dev/fory/${release_version}-${rc_version} https://dist.apache.org/repos/dist/release/fory/${release_version} -m &quot;Release fory ${release_version}&quot;   In the repository at https://dist.apache.org/repos/dist/dev/fory/, if any outdated release_candidate_version are left behind when releasing the release_version, please clear them to keep the dev repository tidy.  When https://archive.apache.org/dist/fory/0.12.0/${release_version} is accessible (confirming that the release_version has been successfully released and archived), we may clean up the previous release version in the release repository, leaving only the current version.  ","version":"dev","tagName":"h3"},{"title":"Update Fory&Fory-Site content‚Äã","type":1,"pageTitle":"How to release","url":"/docs/next/community/how_to_release#update-foryfory-site-content","content":" Submit a PR to https://github.com/apache/fory-site to update Fory-site. Reference implementation: #283and #285.  Update Fory-Site‚Äã  In general, the following two key areas need to be modified:  Write a new announcement, for example: Add a new markdown file under the blog folder:  The Apache Fory team is pleased to announce the [?] release. This is a major release that includes [? PR](https://github.com/apache/fory/compare/v[?]...v[?]) from ? distinct contributors. See the [Install](https://fory.apache.org/docs/start/install) Page to learn how to get the libraries for your platform.   Replace versions by upgrading old versions to new ones. For example, in install section, it is necessary to update the documentation for both the development branch and the latest release branch::  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-core&lt;/artifactId&gt; &lt;version&gt;0.11.2&lt;/version&gt; &lt;/dependency&gt;   Update Fory‚Äã  Submit a PR to https://github.com/apache/fury to update README, like #2207.  ","version":"dev","tagName":"h3"},{"title":"Github officially released‚Äã","type":1,"pageTitle":"How to release","url":"/docs/next/community/how_to_release#github-officially-released","content":" You need to officially release this version in the Fory project Reference implementation: https://github.com/apache/fory/releases/tag/v0.12.0  ","version":"dev","tagName":"h3"},{"title":"Release Maven artifacts‚Äã","type":1,"pageTitle":"How to release","url":"/docs/next/community/how_to_release#release-maven-artifacts","content":" maven_artifact_number: the number for Maven staging artifacts, like 1001.Open https://repository.apache.org/#stagingRepositories.Find the artifact orgapachefory-${maven_artifact_number}, click &quot;Release&quot;.  ","version":"dev","tagName":"h3"},{"title":"Send the announcement‚Äã","type":1,"pageTitle":"How to release","url":"/docs/next/community/how_to_release#send-the-announcement","content":" Send the release announcement to dev@fory.apache.org and CC announce@apache.org.  Title:  [ANNOUNCE] Apache Fory ${release_version} released   Content:  Hi all, The Apache Fory community is pleased to announce that Apache Fory {release_version} has been released! Apache Fory - A blazingly fast multi-language serialization framework powered by JIT and zero-copy. The release notes are available here: https://github.com/apache/fory/releases/tag/v${release_version} For the complete list of changes: https://github.com/apache/fory/compare/v0.12.0...v${release_version} Apache Fory website: https://fory.apache.org/ Download Links: https://fory.apache.org/download Fory Resources: - Fory github repo: https://github.com/apache/fory - Issue: https://github.com/apache/fory/issues - Mailing list: dev@fory.apache.org We are looking to grow our community and welcome new contributors. If you are interested in contributing to Fory, please contact us on the mailing list or on GitHub. We will be happy to help you get started. ------------------ Best Regards, ${your_name}   Remember to use plain text instead of rich text format, or you may be rejected when CC announce@apache.org  After completing the above steps, the Fory release process comes to an end. ","version":"dev","tagName":"h3"},{"title":"Compiler Guide","type":0,"sectionRef":"#","url":"/docs/next/compiler/compiler_guide","content":"","keywords":"","version":"dev"},{"title":"Installation‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#installation","content":" ","version":"dev","tagName":"h2"},{"title":"From Source‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#from-source","content":" cd compiler pip install -e .   ","version":"dev","tagName":"h3"},{"title":"Verify Installation‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#verify-installation","content":" foryc --help   ","version":"dev","tagName":"h3"},{"title":"Command Line Interface‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#command-line-interface","content":" ","version":"dev","tagName":"h2"},{"title":"Basic Usage‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#basic-usage","content":" foryc [OPTIONS] FILES...   foryc --scan-generated [OPTIONS]   ","version":"dev","tagName":"h3"},{"title":"Options‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#options","content":" Compile options:  Option\tDescription\tDefault--lang\tComma-separated target languages\tall --output, -o\tOutput directory\t./generated --package\tOverride package name from Fory IDL file\t(from file) -I, --proto_path, --import_path\tAdd directory to import search path (can be repeated)\t(none) --java_out=DST_DIR\tGenerate Java code in DST_DIR\t(none) --python_out=DST_DIR\tGenerate Python code in DST_DIR\t(none) --cpp_out=DST_DIR\tGenerate C++ code in DST_DIR\t(none) --go_out=DST_DIR\tGenerate Go code in DST_DIR\t(none) --rust_out=DST_DIR\tGenerate Rust code in DST_DIR\t(none) --csharp_out=DST_DIR\tGenerate C# code in DST_DIR\t(none) --go_nested_type_style\tGo nested type naming: camelcase or underscore\tunderscore --emit-fdl\tEmit translated FDL (for non-FDL inputs)\tfalse --emit-fdl-path\tWrite translated FDL to this path (file or directory)\t(stdout)  Scan options (with --scan-generated):  Option\tDescription\tDefault--root\tRoot directory to scan\t. --relative\tPrint paths relative to root\tfalse --delete\tDelete matched generated files\tfalse --dry-run\tScan/print only, do not delete\tfalse  ","version":"dev","tagName":"h3"},{"title":"Scan Generated Files‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#scan-generated-files","content":" Use --scan-generated to find files produced by foryc. The scanner walks the tree recursively, skips build/, target/, and hidden directories, and prints each generated file as it is found.  # Scan current directory foryc --scan-generated # Scan a specific root foryc --scan-generated --root ./src # Print paths relative to the scan root foryc --scan-generated --root ./src --relative # Delete scanned generated files foryc --scan-generated --root ./src --delete # Dry-run (scan and print only) foryc --scan-generated --root ./src --dry-run   ","version":"dev","tagName":"h3"},{"title":"Examples‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#examples","content":" Compile for all languages:  foryc schema.fdl   Compile for specific languages:  foryc schema.fdl --lang java,python,csharp   Specify output directory:  foryc schema.fdl --output ./src/generated   Override package name:  foryc schema.fdl --package com.myapp.models   Compile multiple files:  foryc user.fdl order.fdl product.fdl --output ./generated   Use import search paths:  # Add a single import path foryc src/main.fdl -I libs/common # Add multiple import paths (repeated option) foryc src/main.fdl -I libs/common -I libs/types # Add multiple import paths (comma-separated) foryc src/main.fdl -I libs/common,libs/types,third_party/ # Using --proto_path (protoc-compatible alias) foryc src/main.fdl --proto_path=libs/common # Mix all styles foryc src/main.fdl -I libs/common,libs/types --proto_path third_party/   Language-specific output directories (protoc-style):  # Generate only Java code to a specific directory foryc schema.fdl --java_out=./src/main/java # Generate multiple languages to different directories foryc schema.fdl --java_out=./java/gen --python_out=./python/src --go_out=./go/gen --csharp_out=./csharp/gen # Combine with import paths foryc schema.fdl --java_out=./gen/java -I proto/ -I common/   When using --{lang}_out options:  Only the specified languages are generated (not all languages)The compiler writes under the specified directory (language-specific generators may still create package/module subdirectories)This is compatible with protoc-style workflows  Inspect translated Fory IDL from proto/fbs input:  # Print translated Fory IDL to stdout foryc schema.proto --emit-fdl # Write translated Fory IDL to a directory foryc schema.fbs --emit-fdl --emit-fdl-path ./translated   ","version":"dev","tagName":"h3"},{"title":"Import Path Resolution‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#import-path-resolution","content":" When compiling Fory IDL files with imports, the compiler searches for imported files in this order:  Relative to the importing file (default) - The directory containing the file with the import statement is always searched first, automatically. No -I flag needed for same-directory imports.Each -I path in order - Additional search paths specified on the command line  Same-directory imports work automatically:  // main.fdl import &quot;common.fdl&quot;; // Found if common.fdl is in the same directory   # No -I needed for same-directory imports foryc main.fdl   Example project structure:  project/ ‚îú‚îÄ‚îÄ src/ ‚îÇ ‚îî‚îÄ‚îÄ main.fdl # import &quot;common.fdl&quot;; ‚îî‚îÄ‚îÄ libs/ ‚îî‚îÄ‚îÄ common.fdl   Without -I (fails):  $ foryc src/main.fdl Import error: Import not found: common.fdl Searched in: /project/src   With -I (succeeds):  $ foryc src/main.fdl -I libs/ Compiling src/main.fdl... Resolved 1 import(s)   ","version":"dev","tagName":"h2"},{"title":"Supported Languages‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#supported-languages","content":" Language\tFlag\tOutput Extension\tDescriptionJava\tjava\t.java\tPOJOs with Fory annotations Python\tpython\t.py\tDataclasses with type hints Go\tgo\t.go\tStructs with struct tags Rust\trust\t.rs\tStructs with derive macros C++\tcpp\t.h\tStructs with FORY macros C#\tcsharp\t.cs\tClasses with Fory attributes  ","version":"dev","tagName":"h2"},{"title":"Output Structure‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#output-structure","content":" ","version":"dev","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#java","content":" generated/ ‚îî‚îÄ‚îÄ java/ ‚îî‚îÄ‚îÄ com/ ‚îî‚îÄ‚îÄ example/ ‚îú‚îÄ‚îÄ User.java ‚îú‚îÄ‚îÄ Order.java ‚îú‚îÄ‚îÄ Status.java ‚îî‚îÄ‚îÄ ExampleForyRegistration.java   One file per type (enum or message)Package structure matches Fory IDL packageRegistration helper class generated  ","version":"dev","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#python","content":" generated/ ‚îî‚îÄ‚îÄ python/ ‚îî‚îÄ‚îÄ example.py   Single module with all typesModule name derived from packageRegistration function included  ","version":"dev","tagName":"h3"},{"title":"Go‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#go","content":" generated/ ‚îî‚îÄ‚îÄ go/ ‚îî‚îÄ‚îÄ example/ ‚îî‚îÄ‚îÄ example.go   Single file with all typesDirectory and package name are derived from go_package or the Fory IDL packageRegistration function included  ","version":"dev","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#rust","content":" generated/ ‚îî‚îÄ‚îÄ rust/ ‚îî‚îÄ‚îÄ example.rs   Single module with all typesModule name derived from packageRegistration function included  ","version":"dev","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#c","content":" generated/ ‚îî‚îÄ‚îÄ cpp/ ‚îî‚îÄ‚îÄ example.h   Single header fileNamespace matches package (dots to ::)Header guards and forward declarations  ","version":"dev","tagName":"h3"},{"title":"C#‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#c-1","content":" generated/ ‚îî‚îÄ‚îÄ csharp/ ‚îî‚îÄ‚îÄ example/ ‚îî‚îÄ‚îÄ example.cs   Single .cs file per schemaNamespace uses csharp_namespace (if set) or Fory IDL packageIncludes registration helper and ToBytes/FromBytes methodsImported schemas are registered transitively (for example root.idl importingaddressbook.fdl and tree.fdl)  ","version":"dev","tagName":"h3"},{"title":"C# IDL Matrix Verification‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#c-idl-matrix-verification","content":" Run the end-to-end C# IDL matrix (FDL/IDL/Proto/FBS generation plus roundtrip tests):  cd integration_tests/idl_tests ./run_csharp_tests.sh   This runner executes schema-consistent and compatible roundtrips across:  addressbook, auto_id, complex_pb primitivescollection and union/list variantsoptional_typesany_example (.fdl) and any_example (.proto)tree and graph reference-tracking casesmonster.fbs and complex_fbs.fbsroot.idl cross-package import coverageevolving schema compatibility cases  The script also sets DATA_FILE* variables so file-based roundtrip paths are exercised.  ","version":"dev","tagName":"h3"},{"title":"Build Integration‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#build-integration","content":" ","version":"dev","tagName":"h2"},{"title":"Maven (Java)‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#maven-java","content":" Add to your pom.xml:  &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt; &lt;artifactId&gt;exec-maven-plugin&lt;/artifactId&gt; &lt;version&gt;3.1.0&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;generate-fory-types&lt;/id&gt; &lt;phase&gt;generate-sources&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;exec&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;executable&gt;foryc&lt;/executable&gt; &lt;arguments&gt; &lt;argument&gt;${project.basedir}/src/main/fdl/schema.fdl&lt;/argument&gt; &lt;argument&gt;--java_out&lt;/argument&gt; &lt;argument&gt;${project.build.directory}/generated-sources/fory&lt;/argument&gt; &lt;/arguments&gt; &lt;/configuration&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;   Add generated sources:  &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt; &lt;artifactId&gt;build-helper-maven-plugin&lt;/artifactId&gt; &lt;version&gt;3.4.0&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;phase&gt;generate-sources&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;add-source&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;sources&gt; &lt;source&gt;${project.build.directory}/generated-sources/fory&lt;/source&gt; &lt;/sources&gt; &lt;/configuration&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;   ","version":"dev","tagName":"h3"},{"title":"Gradle (Java/Kotlin)‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#gradle-javakotlin","content":" Add to build.gradle:  task generateForyTypes(type: Exec) { commandLine 'foryc', &quot;${projectDir}/src/main/fdl/schema.fdl&quot;, '--java_out', &quot;${buildDir}/generated/sources/fory&quot; } compileJava.dependsOn generateForyTypes sourceSets { main { java { srcDir &quot;${buildDir}/generated/sources/fory&quot; } } }   ","version":"dev","tagName":"h3"},{"title":"Python (setuptools)‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#python-setuptools","content":" Add to setup.py or pyproject.toml:  # setup.py from setuptools import setup from setuptools.command.build_py import build_py import subprocess class BuildWithForyIdl(build_py): def run(self): subprocess.run([ 'foryc', 'schema.fdl', '--python_out', 'src/generated' ], check=True) super().run() setup( cmdclass={'build_py': BuildWithForyIdl}, # ... )   ","version":"dev","tagName":"h3"},{"title":"Go (go generate)‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#go-go-generate","content":" Add to your Go file:  //go:generate foryc ../schema.fdl --lang go --output . package models   Run:  go generate ./...   ","version":"dev","tagName":"h3"},{"title":"Rust (build.rs)‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#rust-buildrs","content":" Add to build.rs:  use std::process::Command; fn main() { println!(&quot;cargo:rerun-if-changed=schema.fdl&quot;); let status = Command::new(&quot;foryc&quot;) .args(&amp;[&quot;schema.fdl&quot;, &quot;--rust_out&quot;, &quot;src/generated&quot;]) .status() .expect(&quot;Failed to run foryc&quot;); if !status.success() { panic!(&quot;Fory IDL compilation failed&quot;); } }   ","version":"dev","tagName":"h3"},{"title":"CMake (C++)‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#cmake-c","content":" Add to CMakeLists.txt:  find_program(FORY_COMPILER foryc) add_custom_command( OUTPUT ${CMAKE_CURRENT_SOURCE_DIR}/generated/example.h COMMAND ${FORY_COMPILER} ${CMAKE_CURRENT_SOURCE_DIR}/schema.fdl --cpp_out ${CMAKE_CURRENT_SOURCE_DIR}/generated DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/schema.fdl COMMENT &quot;Generating Fory IDL types&quot; ) add_custom_target(generate_fory_idl DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/generated/example.h) add_library(mylib ...) add_dependencies(mylib generate_fory_idl) target_include_directories(mylib PRIVATE ${CMAKE_CURRENT_SOURCE_DIR}/generated)   ","version":"dev","tagName":"h3"},{"title":"Bazel‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#bazel","content":" Create a rule in BUILD:  genrule( name = &quot;generate_fdl&quot;, srcs = [&quot;schema.fdl&quot;], outs = [&quot;generated/example.h&quot;], cmd = &quot;$(location //:fory_compiler) $(SRCS) --cpp_out $(RULEDIR)/generated&quot;, tools = [&quot;//:fory_compiler&quot;], ) cc_library( name = &quot;models&quot;, hdrs = [&quot;:generate_fdl&quot;], # ... )   ","version":"dev","tagName":"h3"},{"title":"Error Handling‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#error-handling","content":" ","version":"dev","tagName":"h2"},{"title":"Syntax Errors‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#syntax-errors","content":" Error: Line 5, Column 12: Expected ';' after field declaration   Fix: Check the indicated line for missing semicolons or syntax issues.  ","version":"dev","tagName":"h3"},{"title":"Duplicate Type Names‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#duplicate-type-names","content":" Error: Duplicate type name: User   Fix: Ensure each enum and message has a unique name within the file.  ","version":"dev","tagName":"h3"},{"title":"Duplicate Type IDs‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#duplicate-type-ids","content":" Error: Duplicate type ID 100: User and Order   Fix: Assign unique type IDs to each type.  ","version":"dev","tagName":"h3"},{"title":"Unknown Type References‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#unknown-type-references","content":" Error: Unknown type 'Address' in Customer.address   Fix: Define the referenced type before using it, or check for typos.  ","version":"dev","tagName":"h3"},{"title":"Duplicate Field Numbers‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#duplicate-field-numbers","content":" Error: Duplicate field number 1 in User: name and id   Fix: Assign unique field numbers within each message.  ","version":"dev","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#best-practices","content":" ","version":"dev","tagName":"h2"},{"title":"Project Structure‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#project-structure","content":" project/ ‚îú‚îÄ‚îÄ fdl/ ‚îÇ ‚îú‚îÄ‚îÄ common.fdl # Shared types ‚îÇ ‚îú‚îÄ‚îÄ user.fdl # User domain ‚îÇ ‚îî‚îÄ‚îÄ order.fdl # Order domain ‚îú‚îÄ‚îÄ src/ ‚îÇ ‚îî‚îÄ‚îÄ generated/ # Generated code (git-ignored) ‚îî‚îÄ‚îÄ build.gradle   ","version":"dev","tagName":"h3"},{"title":"Version Control‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#version-control","content":" Track: Fory IDL schema filesIgnore: Generated code (can be regenerated)  Add to .gitignore:  # Generated Fory IDL code src/generated/ generated/   ","version":"dev","tagName":"h3"},{"title":"CI/CD Integration‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#cicd-integration","content":" Always regenerate during builds:  # GitHub Actions example steps: - name: Install Fory IDL Compiler run: pip install ./compiler - name: Generate Types run: foryc fdl/*.fdl --output src/generated - name: Build run: ./gradlew build   ","version":"dev","tagName":"h3"},{"title":"Schema Evolution‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#schema-evolution","content":" When modifying schemas:  Never reuse field numbers - Mark as reserved insteadNever change type IDs - They're part of the binary formatAdd new fields - Use new field numbersUse optional - For backward compatibility  message User [id=100] { string id = 1; string name = 2; // Field 3 was removed, don't reuse optional string email = 4; // New field }   ","version":"dev","tagName":"h3"},{"title":"Troubleshooting‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#troubleshooting","content":" ","version":"dev","tagName":"h2"},{"title":"Command Not Found‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#command-not-found","content":" foryc: command not found   Solution: Ensure the compiler is installed and in your PATH:  pip install -e ./compiler # Or add to PATH export PATH=$PATH:~/.local/bin   ","version":"dev","tagName":"h3"},{"title":"Permission Denied‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#permission-denied","content":" Permission denied: ./generated   Solution: Ensure write permissions on the output directory:  chmod -R u+w ./generated   ","version":"dev","tagName":"h3"},{"title":"Import Errors in Generated Code‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/next/compiler/compiler_guide#import-errors-in-generated-code","content":" Java: Ensure Fory dependency is in your project:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-core&lt;/artifactId&gt; &lt;version&gt;${fory.version}&lt;/version&gt; &lt;/dependency&gt;   Python: Ensure pyfory is installed:  pip install pyfory   Go: Ensure fory module is available:  go get github.com/apache/fory/go/fory   Rust: Ensure fory crate is in Cargo.toml:  [dependencies] fory = &quot;x.y.z&quot;   C++: Ensure Fory headers are in include path. ","version":"dev","tagName":"h3"},{"title":"Protobuf IDL Support","type":0,"sectionRef":"#","url":"/docs/next/compiler/protobuf_idl_support","content":"","keywords":"","version":"dev"},{"title":"What This Page Covers‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/next/compiler/protobuf_idl_support#what-this-page-covers","content":" Choosing protobuf vs Fory for your use caseSyntax and semantic differences that matter during migrationSupported Fory extension options in protobuf filesPractical migration patterns from protobuf to Fory  ","version":"dev","tagName":"h2"},{"title":"Quick Decision Guide‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/next/compiler/protobuf_idl_support#quick-decision-guide","content":" Situation\tRecommended FormatYou are building gRPC APIs and rely on protobuf tooling\tProtocol Buffers You need maximum object-graph performance and ref tracking\tFory You need circular/shared references in serialized data\tFory You need strong unknown-field behavior for wire compatibility\tProtocol Buffers You need native structs/classes instead of protobuf wrappers\tFory  ","version":"dev","tagName":"h2"},{"title":"Protobuf vs Fory at a Glance‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/next/compiler/protobuf_idl_support#protobuf-vs-fory-at-a-glance","content":" Aspect\tProtocol Buffers\tForyPrimary purpose\tRPC/message contracts\tHigh-performance object serialization Encoding model\tTag-length-value\tFory binary protocol Reference tracking\tNot built-in\tFirst-class (ref) Circular refs\tNot supported\tSupported Unknown fields\tPreserved\tNot preserved Generated types\tProtobuf-specific model types\tNative language constructs gRPC ecosystem\tNative\tIn progress (active development)  Fory gRPC support is under active development. For production gRPC workflows today, protobuf remains the mature/default choice.  ","version":"dev","tagName":"h2"},{"title":"Why Use Apache Fory‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/next/compiler/protobuf_idl_support#why-use-apache-fory","content":" Idiomatic generated code: Fory IDL generates language-idiomatic classes and structs that can be used directly as domain objects.Faster serialization: In Fory benchmarks, Fory can be around 10x faster than protobuf for object serialization workloads.Better graph modeling: Shared and circular references are first-class features instead of application-level ID-link workarounds.  See benchmark details under Performance References.  ","version":"dev","tagName":"h2"},{"title":"Syntax and Semantic Mapping‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/next/compiler/protobuf_idl_support#syntax-and-semantic-mapping","content":" ","version":"dev","tagName":"h2"},{"title":"Package and File Options‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/next/compiler/protobuf_idl_support#package-and-file-options","content":" Protocol Buffers  syntax = &quot;proto3&quot;; package example.models; option java_package = &quot;com.example.models&quot;; option go_package = &quot;example.com/models&quot;;   Fory  package example.models;   Fory uses one package namespace for cross-language registration. Language-specific package placement is still configurable in code generation.  ","version":"dev","tagName":"h3"},{"title":"Message and Enum Definitions‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/next/compiler/protobuf_idl_support#message-and-enum-definitions","content":" Protocol Buffers  message User { string id = 1; string name = 2; optional string email = 3; int32 age = 4; repeated string tags = 5; map&lt;string, string&gt; metadata = 6; } enum Status { STATUS_UNSPECIFIED = 0; STATUS_ACTIVE = 1; }   Fory  message User [id=101] { string id = 1; string name = 2; optional string email = 3; int32 age = 4; list&lt;string&gt; tags = 5; map&lt;string, string&gt; metadata = 6; } enum Status [id=102] { UNKNOWN = 0; ACTIVE = 1; }   Key differences:  Fory can assign stable type IDs directly ([id=...]).Fory uses list&lt;T&gt; (with repeated T as alias).Enum naming conventions are language-driven instead of protobuf prefix style.  ","version":"dev","tagName":"h3"},{"title":"oneof to union‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/next/compiler/protobuf_idl_support#oneof-to-union","content":" Protobuf oneof is translated to a nested Fory union plus an optional field referencing that union.  Protocol Buffers  message Event { oneof payload { string text = 1; int32 number = 2; } }   Fory-style shape after translation  message Event { union payload { string text = 1; int32 number = 2; } optional payload payload = 1; }   Notes:  Union case IDs are derived from the original oneof field numbers.The synthetic union field uses the smallest oneof case number.  ","version":"dev","tagName":"h3"},{"title":"Imports and Well-Known Types‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/next/compiler/protobuf_idl_support#imports-and-well-known-types","content":" Protobuf imports are supported. Common well-known types map directly:  google.protobuf.Timestamp -&gt; timestampgoogle.protobuf.Duration -&gt; durationgoogle.protobuf.Any -&gt; any  ","version":"dev","tagName":"h3"},{"title":"Type Mapping Highlights‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/next/compiler/protobuf_idl_support#type-mapping-highlights","content":" Protobuf Type\tFory Mappingbool\tbool int32, uint32\tvariable-length 32-bit integer kinds sint32\tzigzag 32-bit integer int64, uint64\tvariable-length 64-bit integer kinds sint64\tzigzag 64-bit integer fixed32, fixed64\tfixed-width unsigned integer kinds sfixed32, sfixed64\tfixed-width signed integer kinds float, double\tfloat32, float64 string, bytes\tstring, bytes repeated T\tlist&lt;T&gt; map&lt;K, V&gt;\tmap&lt;K, V&gt; optional T\toptional T oneof\tunion + optional union reference field int64 [(fory).type = &quot;tagged_int64&quot;]\ttagged_int64 encoding uint64 [(fory).type = &quot;tagged_uint64&quot;]\ttagged_uint64 encoding  ","version":"dev","tagName":"h2"},{"title":"Fory Extension Options (Protobuf)‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/next/compiler/protobuf_idl_support#fory-extension-options-protobuf","content":" Fory-specific options in .proto use the (fory). prefix.  option (fory).enable_auto_type_id = true; message TreeNode { TreeNode parent = 1 [(fory).weak_ref = true]; repeated TreeNode children = 2 [(fory).ref = true]; }   ","version":"dev","tagName":"h2"},{"title":"File-Level Options‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/next/compiler/protobuf_idl_support#file-level-options","content":" Option\tType\tDescription(fory).use_record_for_java_message\tbool\tGenerate Java records for all messages in this file (fory).polymorphism\tbool\tEnable polymorphic serialization metadata by default (fory).enable_auto_type_id\tbool\tAuto-generate type IDs when omitted (compiler default is true) (fory).evolving\tbool\tDefault schema-evolution behavior for messages (fory).go_nested_type_style\tstring\tGo nested naming style: underscore (default) or camelcase  ","version":"dev","tagName":"h3"},{"title":"Message and Enum Options‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/next/compiler/protobuf_idl_support#message-and-enum-options","content":" Option\tApplies To\tType\tDescription(fory).id\tmessage, enum\tint\tExplicit type ID for registration (fory).alias\tmessage, enum\tstring\tAlternate name used for auto-ID hashing (fory).evolving\tmessage\tbool\tOverride file-level evolution setting (fory).use_record_for_java\tmessage\tbool\tGenerate Java record for this message (fory).deprecated\tmessage, enum\tbool\tMark type as deprecated (fory).namespace\tmessage\tstring\tOverride default package-based namespace  ","version":"dev","tagName":"h3"},{"title":"Field-Level Options‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/next/compiler/protobuf_idl_support#field-level-options","content":" Option\tType\tDescription(fory).ref\tbool\tEnable reference tracking for this field (fory).nullable\tbool\tTreat field as nullable (optional) (fory).weak_ref\tbool\tGenerate weak pointer semantics (C++/Rust codegen) (fory).thread_safe_pointer\tbool\tRust pointer flavor for ref fields (Arc vs Rc) (fory).deprecated\tbool\tMark field as deprecated (fory).type\tstring\tPrimitive override, currently tagged_int64/tagged_uint64  Reference option behavior:  weak_ref = true implies ref tracking.For repeated fields, (fory).ref = true applies to list elements.For map&lt;K, V&gt; fields, (fory).ref = true applies to map values.weak_ref and thread_safe_pointer are codegen hints for C++/Rust.  ","version":"dev","tagName":"h3"},{"title":"Option Examples by Shape‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/next/compiler/protobuf_idl_support#option-examples-by-shape","content":" message Graph { Node root = 1 [(fory).ref = true, (fory).thread_safe_pointer = false]; repeated Node nodes = 2 [(fory).ref = true]; map&lt;string, Node&gt; cache = 3 [(fory).ref = true]; Node parent = 4 [(fory).weak_ref = true]; }   ","version":"dev","tagName":"h3"},{"title":"Reference Tracking vs Protobuf IDs‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/next/compiler/protobuf_idl_support#reference-tracking-vs-protobuf-ids","content":" Protobuf itself does not preserve shared/cyclic object graphs. With Fory protobuf extensions, you can opt into graph semantics.  Without Fory ref options (protobuf-style IDs):  message TreeNode { string id = 1; string parent_id = 2; repeated string child_ids = 3; }   With Fory ref options (object graph):  message TreeNode { TreeNode parent = 1 [(fory).weak_ref = true]; repeated TreeNode children = 2 [(fory).ref = true]; }   ","version":"dev","tagName":"h2"},{"title":"Migration Guide: Protobuf to Fory‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/next/compiler/protobuf_idl_support#migration-guide-protobuf-to-fory","content":" ","version":"dev","tagName":"h2"},{"title":"Step 1: Translate Schema Syntax‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/next/compiler/protobuf_idl_support#step-1-translate-schema-syntax","content":" Keep package names stable.Replace repeated T with list&lt;T&gt; (or keep repeated alias).Add explicit [id=...] where you need stable numeric registration.  ","version":"dev","tagName":"h3"},{"title":"Step 2: Convert oneof and Special Types‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/next/compiler/protobuf_idl_support#step-2-convert-oneof-and-special-types","content":" oneof -&gt; union + optional union field.Map protobuf well-known types to Fory primitives (timestamp, duration, any).  ","version":"dev","tagName":"h3"},{"title":"Step 3: Replace Protobuf Workarounds with ref‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/next/compiler/protobuf_idl_support#step-3-replace-protobuf-workarounds-with-ref","content":" Where protobuf used manual ID links for object graphs, switch to Fory refmodifiers (and optional ref(weak=true) where needed).  ","version":"dev","tagName":"h3"},{"title":"Step 4: Update Build/Codegen‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/next/compiler/protobuf_idl_support#step-4-update-buildcodegen","content":" Replace protobuf generation steps with the Fory compiler invocation for target languages.  ","version":"dev","tagName":"h3"},{"title":"Step 5: Run Compatibility Checks‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/next/compiler/protobuf_idl_support#step-5-run-compatibility-checks","content":" For staged migrations, keep both formats in parallel and verify payload-level parity with integration tests.  ","version":"dev","tagName":"h3"},{"title":"Coexistence Strategy‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/next/compiler/protobuf_idl_support#coexistence-strategy","content":" You can run protobuf and Fory in parallel during migration:  public byte[] serialize(Object obj, Format format) { if (format == Format.PROTOBUF) { return ((MessageLite) obj).toByteArray(); } return fory.serialize(obj); }   Use translators at service boundaries while internal object-graph heavy paths migrate first.  ","version":"dev","tagName":"h2"},{"title":"Performance References‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/next/compiler/protobuf_idl_support#performance-references","content":" Benchmarks: https://fory.apache.org/docs/introduction/benchmarkBenchmark code: https://github.com/apache/fory/tree/main/benchmarks  ","version":"dev","tagName":"h2"},{"title":"Summary‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/next/compiler/protobuf_idl_support#summary","content":" Use protobuf when your primary concern is API contracts and gRPC ecosystem integration. Use Fory when object-graph performance, native models, and reference semantics are the primary concern. ","version":"dev","tagName":"h2"},{"title":"Development","type":0,"sectionRef":"#","url":"/docs/next/docs/guide/development","content":"","keywords":"","version":"dev"},{"title":"How to build Apache Fory‚Ñ¢‚Äã","type":1,"pageTitle":"Development","url":"/docs/next/docs/guide/development#how-to-build-apache-fory","content":" Clone the source tree from https://github.com/apache/fory.  ","version":"dev","tagName":"h2"},{"title":"Build Apache Fory‚Ñ¢ Java‚Äã","type":1,"pageTitle":"Development","url":"/docs/next/docs/guide/development#build-apache-fory-java","content":" cd java mvn -T16 package   Environment Requirements‚Äã  JDK 17+Maven 3.6.3+  ","version":"dev","tagName":"h3"},{"title":"Build Apache Fory‚Ñ¢ Python‚Äã","type":1,"pageTitle":"Development","url":"/docs/next/docs/guide/development#build-apache-fory-python","content":" cd python pip install -v -e . # Optional: build Cython extension (replace X.Y with your Python version) bazel build //:cp_fory_so --@rules_python//python/config_settings:python_version=X.Y   Environment Requirements‚Äã  CPython 3.8+Bazel 8+ (required when building Cython extensions)  ","version":"dev","tagName":"h3"},{"title":"Build Apache Fory‚Ñ¢ C++‚Äã","type":1,"pageTitle":"Development","url":"/docs/next/docs/guide/development#build-apache-fory-c","content":" cd cpp bazel build //cpp/...   Environment Requirements‚Äã  C++17 compilerBazel 8+  ","version":"dev","tagName":"h3"},{"title":"Build Apache Fory‚Ñ¢ Go‚Äã","type":1,"pageTitle":"Development","url":"/docs/next/docs/guide/development#build-apache-fory-go","content":" cd go/fory go test -v ./...   Run Go xlang tests from Java test module:  cd java mvn -T16 install -DskipTests cd fory-core FORY_GO_JAVA_CI=1 ENABLE_FORY_DEBUG_OUTPUT=1 mvn test -Dtest=org.apache.fory.xlang.GoXlangTest   Environment Requirements‚Äã  Go 1.24+  ","version":"dev","tagName":"h3"},{"title":"Build Apache Fory‚Ñ¢ Rust‚Äã","type":1,"pageTitle":"Development","url":"/docs/next/docs/guide/development#build-apache-fory-rust","content":" cd rust cargo build cargo test --features tests # Debug a specific test RUST_BACKTRACE=1 FORY_PANIC_ON_ERROR=1 ENABLE_FORY_DEBUG_OUTPUT=1 \\ cargo test --test mod $dir$::$test_file::$test_method -- --nocapture   Environment Requirements‚Äã  Rust toolchain via rustupcargo-expand (optional, for macro expansion debugging)  ","version":"dev","tagName":"h3"},{"title":"Build Apache Fory‚Ñ¢ JavaScript‚Äã","type":1,"pageTitle":"Development","url":"/docs/next/docs/guide/development#build-apache-fory-javascript","content":" cd javascript npm install npm run build node ./node_modules/.bin/jest --ci --reporters=default --reporters=jest-junit   Environment Requirements‚Äã  Node.js (LTS)npm  ","version":"dev","tagName":"h3"},{"title":"Lint Markdown Docs‚Äã","type":1,"pageTitle":"Development","url":"/docs/next/docs/guide/development#lint-markdown-docs","content":" cd docs npx prettier --write &quot;**/*.md&quot;   Environment Requirements‚Äã  Node.js (LTS)npm  ","version":"dev","tagName":"h3"},{"title":"Contributing‚Äã","type":1,"pageTitle":"Development","url":"/docs/next/docs/guide/development#contributing","content":" For contribution details, see How to contribute to Apache Fory‚Ñ¢. ","version":"dev","tagName":"h2"},{"title":"C++ Serialization Guide","type":0,"sectionRef":"#","url":"/docs/next/guide/cpp/","content":"","keywords":"","version":"dev"},{"title":"Why Apache Fory‚Ñ¢ C++?‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/next/guide/cpp/#why-apache-fory-c","content":" üî• Blazingly Fast: Fast serialization and optimized binary protocolsüåç Cross-Language: Seamlessly serialize/deserialize data across Java, Python, C++, Go, JavaScript, and RustüéØ Type-Safe: Compile-time type checking with macro-based struct registrationüîÑ Reference Tracking: Automatic tracking of shared and circular referencesüì¶ Schema Evolution: Compatible mode for independent schema changes‚ö° Two Formats: Object graph serialization and zero-copy row-based formatüßµ Thread Safety: Both single-threaded (fastest) and thread-safe variants  ","version":"dev","tagName":"h2"},{"title":"Installation‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/next/guide/cpp/#installation","content":" The C++ implementation supports both CMake and Bazel build systems.  ","version":"dev","tagName":"h2"},{"title":"Prerequisites‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/next/guide/cpp/#prerequisites","content":" CMake 3.16+ (for CMake build) or Bazel 8+ (for Bazel build)C++17 compatible compiler (GCC 7+, Clang 5+, MSVC 2017+)  ","version":"dev","tagName":"h3"},{"title":"Using CMake (Recommended)‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/next/guide/cpp/#using-cmake-recommended","content":" The easiest way to use Fory is with CMake's FetchContent module:  cmake_minimum_required(VERSION 3.16) project(my_project LANGUAGES CXX) set(CMAKE_CXX_STANDARD 17) set(CMAKE_CXX_STANDARD_REQUIRED ON) if(MSVC) add_compile_options(/Zc:preprocessor) endif() include(FetchContent) FetchContent_Declare( fory GIT_REPOSITORY https://github.com/apache/fory.git GIT_TAG v0.15.0 SOURCE_SUBDIR cpp ) FetchContent_MakeAvailable(fory) add_executable(my_app main.cc) target_link_libraries(my_app PRIVATE fory::serialization)   Then build and run:  mkdir build &amp;&amp; cd build cmake .. -DCMAKE_BUILD_TYPE=Release cmake --build . --parallel ./my_app   ","version":"dev","tagName":"h3"},{"title":"Using Bazel‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/next/guide/cpp/#using-bazel","content":" Create a MODULE.bazel file in your project root:  module( name = &quot;my_project&quot;, version = &quot;1.0.0&quot;, ) bazel_dep(name = &quot;rules_cc&quot;, version = &quot;0.1.1&quot;) bazel_dep(name = &quot;fory&quot;, version = &quot;0.15.0&quot;) git_override( module_name = &quot;fory&quot;, remote = &quot;https://github.com/apache/fory.git&quot;, commit = &quot;v0.15.0&quot;, # Or use a specific commit hash for reproducibility )   Create a BUILD file for your application:  cc_binary( name = &quot;my_app&quot;, srcs = [&quot;main.cc&quot;], deps = [&quot;@fory//cpp/fory/serialization:fory_serialization&quot;], )   Then build and run:  bazel build //:my_app bazel run //:my_app   For local development, you can use local_path_override instead:  bazel_dep(name = &quot;fory&quot;, version = &quot;0.15.0&quot;) local_path_override( module_name = &quot;fory&quot;, path = &quot;/path/to/fory&quot;, )   ","version":"dev","tagName":"h3"},{"title":"Examples‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/next/guide/cpp/#examples","content":" See the examples/cpp directory for complete working examples:  hello_world - Object graph serializationhello_row - Row format encoding  ","version":"dev","tagName":"h3"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/next/guide/cpp/#quick-start","content":" ","version":"dev","tagName":"h2"},{"title":"Basic Example‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/next/guide/cpp/#basic-example","content":" #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; // Define a struct class Person { std::string name; int32_t age; std::vector&lt;std::string&gt; hobbies; bool operator==(const Person &amp;other) const { return name == other.name &amp;&amp; age == other.age &amp;&amp; hobbies == other.hobbies; } public: // Register the struct with Fory (FORY_STRUCT must be in public scope). FORY_STRUCT(Person, name, age, hobbies); }; int main() { // Create a Fory instance auto fory = Fory::builder() .xlang(true) // Enable cross-language mode .track_ref(false) // Disable reference tracking for simple types .build(); // Register the type with a unique ID fory.register_struct&lt;Person&gt;(1); // Create an object Person person{&quot;Alice&quot;, 30, {&quot;reading&quot;, &quot;coding&quot;}}; // Serialize auto result = fory.serialize(person); if (!result.ok()) { // Handle error return 1; } std::vector&lt;uint8_t&gt; bytes = std::move(result).value(); // Deserialize auto deser_result = fory.deserialize&lt;Person&gt;(bytes); if (!deser_result.ok()) { // Handle error return 1; } Person decoded = std::move(deser_result).value(); assert(person == decoded); return 0; }   ","version":"dev","tagName":"h3"},{"title":"Inherited Fields‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/next/guide/cpp/#inherited-fields","content":" To include base-class fields in a derived type, list FORY_BASE(Base) insideFORY_STRUCT. The base must define its own FORY_STRUCT so its fields can be referenced.  struct Base { int32_t id; FORY_STRUCT(Base, id); }; struct Derived : Base { std::string name; FORY_STRUCT(Derived, FORY_BASE(Base), name); };   ","version":"dev","tagName":"h3"},{"title":"Thread Safety‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/next/guide/cpp/#thread-safety","content":" Apache Fory‚Ñ¢ C++ provides two variants for different threading needs:  ","version":"dev","tagName":"h2"},{"title":"Single-Threaded (Fastest)‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/next/guide/cpp/#single-threaded-fastest","content":" // Single-threaded Fory - fastest, NOT thread-safe auto fory = Fory::builder() .xlang(true) .build();   ","version":"dev","tagName":"h3"},{"title":"Thread-Safe‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/next/guide/cpp/#thread-safe","content":" // Thread-safe Fory - uses context pools auto fory = Fory::builder() .xlang(true) .build_thread_safe(); // Can be used from multiple threads safely std::thread t1([&amp;]() { auto result = fory.serialize(obj1); }); std::thread t2([&amp;]() { auto result = fory.serialize(obj2); });   Tip: Perform type registrations before spawning threads so every worker sees the same metadata.  ","version":"dev","tagName":"h3"},{"title":"Use Cases‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/next/guide/cpp/#use-cases","content":" ","version":"dev","tagName":"h2"},{"title":"Object Serialization‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/next/guide/cpp/#object-serialization","content":" Complex data structures with nested objects and referencesCross-language communication in microservicesGeneral-purpose serialization with full type safetySchema evolution with compatible mode  ","version":"dev","tagName":"h3"},{"title":"Row-Based Serialization‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/next/guide/cpp/#row-based-serialization","content":" High-throughput data processingAnalytics workloads requiring fast field accessMemory-constrained environmentsZero-copy scenarios  ","version":"dev","tagName":"h3"},{"title":"Next Steps‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/next/guide/cpp/#next-steps","content":" Configuration - Builder options and modesBasic Serialization - Object graph serializationSchema Evolution - Compatible mode and schema changesType Registration - Registering typesField Configuration - Field-level metadata (nullable, ref tracking)Supported Types - All supported typesCross-Language - XLANG modeRow Format - Zero-copy row-based format ","version":"dev","tagName":"h2"},{"title":"GraalVM Guide","type":0,"sectionRef":"#","url":"/docs/next/docs/guide/serialization","content":"","keywords":"","version":"dev"},{"title":"GraalVM Native Image‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/docs/guide/serialization#graalvm-native-image","content":" GraalVM native image compiles Java code into native executables ahead-of-time, resulting in faster startup and lower memory usage. However, native images don't support runtime JIT compilation or reflection without explicit configuration.  Apache Fory‚Ñ¢ works excellently with GraalVM native image by using codegen instead of reflection. All serializer code is generated at build time, eliminating the need for reflection configuration files in most cases.  ","version":"dev","tagName":"h2"},{"title":"How It Works‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/docs/guide/serialization#how-it-works","content":" Fory generates serialization code at GraalVM build time when you:  Create Fory as a static fieldRegister all classes in a static initializerCall fory.ensureSerializersCompiled() to compile serializersConfigure the class to initialize at build time via native-image.properties  The main benefit: You don't need to configure reflection json or serialization json for most serializable classes.  Note: Fory's asyncCompilationEnabled option is automatically disabled for GraalVM native image since runtime JIT is not supported.  ","version":"dev","tagName":"h2"},{"title":"Basic Usage‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/docs/guide/serialization#basic-usage","content":" ","version":"dev","tagName":"h2"},{"title":"Step 1: Create Fory and Register Classes‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/docs/guide/serialization#step-1-create-fory-and-register-classes","content":" import org.apache.fory.Fory; public class Example { // Must be static field static Fory fory; static { fory = Fory.builder().build(); fory.register(MyClass.class); fory.register(AnotherClass.class); // Compile all serializers at build time fory.ensureSerializersCompiled(); } public static void main(String[] args) { byte[] bytes = fory.serialize(new MyClass()); MyClass obj = (MyClass) fory.deserialize(bytes); } }   ","version":"dev","tagName":"h3"},{"title":"Step 2: Configure Build-Time Initialization‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/docs/guide/serialization#step-2-configure-build-time-initialization","content":" Create resources/META-INF/native-image/your-group/your-artifact/native-image.properties:  Args = --initialize-at-build-time=com.example.Example   ","version":"dev","tagName":"h3"},{"title":"ForyGraalVMFeature (Optional)‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/docs/guide/serialization#forygraalvmfeature-optional","content":" For most types with public constructors, the basic setup above is sufficient. However, some advanced cases require reflection registration:  Private constructors (classes without accessible no-arg constructor)Private inner classes/recordsDynamic proxy serialization  The fory-graalvm-feature module automatically handles these cases, eliminating the need for manual reflect-config.json configuration.  ","version":"dev","tagName":"h2"},{"title":"Adding the Dependency‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/docs/guide/serialization#adding-the-dependency","content":" &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-graalvm-feature&lt;/artifactId&gt; &lt;version&gt;${fory.version}&lt;/version&gt; &lt;/dependency&gt;   ","version":"dev","tagName":"h3"},{"title":"Enabling the Feature‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/docs/guide/serialization#enabling-the-feature","content":" Add to your native-image.properties:  Args = --initialize-at-build-time=com.example.Example \\ --features=org.apache.fory.graalvm.feature.ForyGraalVMFeature   ","version":"dev","tagName":"h3"},{"title":"What ForyGraalVMFeature Handles‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/docs/guide/serialization#what-forygraalvmfeature-handles","content":" Scenario\tWithout Feature\tWith FeaturePublic classes with no-arg ctor\t‚úÖ Works\t‚úÖ Works Private constructors\t‚ùå Needs reflect-config.json\t‚úÖ Auto-registered Private inner records\t‚ùå Needs reflect-config.json\t‚úÖ Auto-registered Dynamic proxies\t‚ùå Needs manual config\t‚úÖ Auto-registered  ","version":"dev","tagName":"h3"},{"title":"Example with Private Record‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/docs/guide/serialization#example-with-private-record","content":" public class Example { // Private inner record - requires ForyGraalVMFeature private record PrivateRecord(int id, String name) {} static Fory fory; static { fory = Fory.builder().build(); fory.register(PrivateRecord.class); fory.ensureSerializersCompiled(); } }   ","version":"dev","tagName":"h3"},{"title":"Example with Dynamic Proxy‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/docs/guide/serialization#example-with-dynamic-proxy","content":" import org.apache.fory.util.GraalvmSupport; public class ProxyExample { public interface MyService { String execute(); } static Fory fory; static { fory = Fory.builder().build(); // Register proxy interface for serialization GraalvmSupport.registerProxySupport(MyService.class); fory.ensureSerializersCompiled(); } }   ","version":"dev","tagName":"h3"},{"title":"Thread-Safe Fory‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/docs/guide/serialization#thread-safe-fory","content":" For multi-threaded applications, use ThreadLocalFory:  import org.apache.fory.Fory; import org.apache.fory.ThreadLocalFory; import org.apache.fory.ThreadSafeFory; public class ThreadSafeExample { public record Foo(int f1, String f2, List&lt;String&gt; f3) {} static ThreadSafeFory fory; static { fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().build(); f.register(Foo.class); f.ensureSerializersCompiled(); return f; }); } public static void main(String[] args) { Foo foo = new Foo(10, &quot;abc&quot;, List.of(&quot;str1&quot;, &quot;str2&quot;)); byte[] bytes = fory.serialize(foo); Foo result = (Foo) fory.deserialize(bytes); } }   ","version":"dev","tagName":"h2"},{"title":"Troubleshooting‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/docs/guide/serialization#troubleshooting","content":" ","version":"dev","tagName":"h2"},{"title":"\"Type is instantiated reflectively but was never registered\"‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/docs/guide/serialization#type-is-instantiated-reflectively-but-was-never-registered","content":" If you see this error:  Type com.example.MyClass is instantiated reflectively but was never registered   Solution: Register the class with Fory (don't add to reflect-config.json):  fory.register(MyClass.class); fory.ensureSerializersCompiled();   If the class has a private constructor, either:  Add fory-graalvm-feature dependency, orCreate a reflect-config.json for that specific class  ","version":"dev","tagName":"h3"},{"title":"Framework Integration‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/docs/guide/serialization#framework-integration","content":" For framework developers integrating Fory:  Provide a configuration file for users to list serializable classesLoad those classes and call fory.register(Class&lt;?&gt;) for eachCall fory.ensureSerializersCompiled() after all registrationsConfigure your integration class for build-time initialization  ","version":"dev","tagName":"h2"},{"title":"Benchmark‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/docs/guide/serialization#benchmark","content":" Performance comparison between Fory and GraalVM JDK Serialization:  Type\tCompression\tSpeed\tSizeStruct\tOff\t46x faster\t43% Struct\tOn\t24x faster\t31% Pojo\tOff\t12x faster\t56% Pojo\tOn\t12x faster\t48%  See Benchmark.java for benchmark code.  ","version":"dev","tagName":"h2"},{"title":"Struct Benchmark‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/docs/guide/serialization#struct-benchmark","content":" Class Fields‚Äã  public class Struct implements Serializable { public int f1; public long f2; public float f3; public double f4; public int f5; public long f6; public float f7; public double f8; public int f9; public long f10; public float f11; public double f12; }   Benchmark Results‚Äã  No compression:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Struct Compress number: false Fory size: 76.0 JDK size: 178.0 Fory serialization took mills: 49 JDK serialization took mills: 2254 Compare speed: Fory is 45.70x speed of JDK Compare size: Fory is 0.43x size of JDK   Compress number:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Struct Compress number: true Fory size: 55.0 JDK size: 178.0 Fory serialization took mills: 130 JDK serialization took mills: 3161 Compare speed: Fory is 24.16x speed of JDK Compare size: Fory is 0.31x size of JDK   ","version":"dev","tagName":"h3"},{"title":"Pojo Benchmark‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/docs/guide/serialization#pojo-benchmark","content":" Class Fields‚Äã  public class Foo implements Serializable { int f1; String f2; List&lt;String&gt; f3; Map&lt;String, Long&gt; f4; }   Benchmark Results‚Äã  No compression:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Foo Compress number: false Fory size: 541.0 JDK size: 964.0 Fory serialization took mills: 1663 JDK serialization took mills: 16266 Compare speed: Fory is 12.19x speed of JDK Compare size: Fory is 0.56x size of JDK   Compress number:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Foo Compress number: true Fory size: 459.0 JDK size: 964.0 Fory serialization took mills: 1289 JDK serialization took mills: 15069 Compare speed: Fory is 12.11x speed of JDK Compare size: Fory is 0.48x size of JDK  ","version":"dev","tagName":"h3"},{"title":"Configuration","type":0,"sectionRef":"#","url":"/docs/next/guide/cpp/configuration","content":"","keywords":"","version":"dev"},{"title":"Serialization Modes‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/cpp/configuration#serialization-modes","content":" Apache Fory‚Ñ¢ supports two serialization modes:  ","version":"dev","tagName":"h2"},{"title":"SchemaConsistent Mode (Default)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/cpp/configuration#schemaconsistent-mode-default","content":" Type declarations must match exactly between peers:  auto fory = Fory::builder().build(); // SchemaConsistent by default   ","version":"dev","tagName":"h3"},{"title":"Compatible Mode‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/cpp/configuration#compatible-mode","content":" Allows independent schema evolution:  auto fory = Fory::builder().compatible(true).build();   ","version":"dev","tagName":"h3"},{"title":"Builder Pattern‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/cpp/configuration#builder-pattern","content":" Use ForyBuilder to construct Fory instances with custom configuration:  #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; // Default configuration auto fory = Fory::builder().build(); // Compatible mode for schema evolution auto fory = Fory::builder() .compatible(true) .build(); // Cross-language mode auto fory = Fory::builder() .xlang(true) .build(); // Full configuration auto fory = Fory::builder() .compatible(true) .xlang(true) .track_ref(true) .max_dyn_depth(10) .check_struct_version(true) .build();   ","version":"dev","tagName":"h2"},{"title":"Configuration Options‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/cpp/configuration#configuration-options","content":" ","version":"dev","tagName":"h2"},{"title":"xlang(bool)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/cpp/configuration#xlangbool","content":" Enable/disable cross-language (xlang) serialization mode.  auto fory = Fory::builder() .xlang(true) // Enable cross-language compatibility .build();   When enabled, includes metadata for cross-language compatibility with Java, Python, Go, Rust, and JavaScript.  Default: true  ","version":"dev","tagName":"h3"},{"title":"compatible(bool)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/cpp/configuration#compatiblebool","content":" Enable/disable compatible mode for schema evolution.  auto fory = Fory::builder() .compatible(true) // Enable schema evolution .build();   When enabled, supports reading data serialized with different schema versions.  Default: false  ","version":"dev","tagName":"h3"},{"title":"track_ref(bool)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/cpp/configuration#track_refbool","content":" Enable/disable reference tracking for shared and circular references.  auto fory = Fory::builder() .track_ref(true) // Enable reference tracking .build();   When enabled, avoids duplicating shared objects and handles cycles.  Default: true  ","version":"dev","tagName":"h3"},{"title":"max_dyn_depth(uint32_t)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/cpp/configuration#max_dyn_depthuint32_t","content":" Set maximum allowed nesting depth for dynamically-typed objects.  auto fory = Fory::builder() .max_dyn_depth(10) // Allow up to 10 levels .build();   This limits the maximum depth for nested polymorphic object serialization (e.g., shared_ptr&lt;Base&gt;, unique_ptr&lt;Base&gt;). This prevents stack overflow from deeply nested structures in dynamic serialization scenarios.  Default: 5  When to adjust:  Increase: For legitimate deeply nested data structuresDecrease: For stricter security requirements or shallow data structures  ","version":"dev","tagName":"h3"},{"title":"check_struct_version(bool)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/cpp/configuration#check_struct_versionbool","content":" Enable/disable struct version checking.  auto fory = Fory::builder() .check_struct_version(true) // Enable version checking .build();   When enabled, validates type hashes to detect schema mismatches.  Default: false  ","version":"dev","tagName":"h3"},{"title":"Thread-Safe vs Single-Threaded‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/cpp/configuration#thread-safe-vs-single-threaded","content":" ","version":"dev","tagName":"h2"},{"title":"Single-Threaded (Fastest)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/cpp/configuration#single-threaded-fastest","content":" auto fory = Fory::builder() .xlang(true) .build(); // Returns Fory   Single-threaded Fory is the fastest option, but NOT thread-safe. Use one instance per thread.  ","version":"dev","tagName":"h3"},{"title":"Thread-Safe‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/cpp/configuration#thread-safe","content":" auto fory = Fory::builder() .xlang(true) .build_thread_safe(); // Returns ThreadSafeFory   ThreadSafeFory uses a pool of Fory instances to provide thread-safe serialization. Slightly slower due to pool overhead, but safe to use from multiple threads concurrently.  ","version":"dev","tagName":"h3"},{"title":"Configuration Summary‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/cpp/configuration#configuration-summary","content":" Option\tDescription\tDefaultxlang(bool)\tEnable cross-language mode\ttrue compatible(bool)\tEnable schema evolution\tfalse track_ref(bool)\tEnable reference tracking\ttrue max_dyn_depth(uint32_t)\tMaximum nesting depth for dynamic types\t5 check_struct_version(bool)\tEnable struct version checking\tfalse  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/cpp/configuration#related-topics","content":" Basic Serialization - Using configured ForyCross-Language - XLANG mode detailsType Registration - Registering types ","version":"dev","tagName":"h2"},{"title":"Generated Code","type":0,"sectionRef":"#","url":"/docs/next/compiler/generated_code","content":"","keywords":"","version":"dev"},{"title":"Reference Schemas‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#reference-schemas","content":" The examples below use two real schemas:  addressbook.fdl (explicit type IDs)auto_id.fdl (no explicit type IDs)  ","version":"dev","tagName":"h2"},{"title":"addressbook.fdl (excerpt)‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#addressbookfdl-excerpt","content":" package addressbook; option go_package = &quot;github.com/myorg/myrepo/gen/addressbook;addressbook&quot;; message Person [id=100] { string name = 1; int32 id = 2; enum PhoneType [id=101] { PHONE_TYPE_MOBILE = 0; PHONE_TYPE_HOME = 1; PHONE_TYPE_WORK = 2; } message PhoneNumber [id=102] { string number = 1; PhoneType phone_type = 2; } list&lt;PhoneNumber&gt; phones = 7; Animal pet = 8; } message Dog [id=104] { string name = 1; int32 bark_volume = 2; } message Cat [id=105] { string name = 1; int32 lives = 2; } union Animal [id=106] { Dog dog = 1; Cat cat = 2; } message AddressBook [id=103] { list&lt;Person&gt; people = 1; map&lt;string, Person&gt; people_by_name = 2; }   ","version":"dev","tagName":"h3"},{"title":"auto_id.fdl (excerpt)‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#auto_idfdl-excerpt","content":" package auto_id; enum Status { UNKNOWN = 0; OK = 1; } message Envelope { string id = 1; message Payload { int32 value = 1; } union Detail { Payload payload = 1; string note = 2; } Payload payload = 2; Detail detail = 3; Status status = 4; } union Wrapper { Envelope envelope = 1; string raw = 2; }   ","version":"dev","tagName":"h3"},{"title":"Java‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#java","content":" ","version":"dev","tagName":"h2"},{"title":"Output Layout‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#output-layout","content":" For package addressbook, Java output is generated under:  &lt;java_out&gt;/addressbook/Type files: AddressBook.java, Person.java, Dog.java, Cat.java, Animal.javaRegistration helper: AddressbookForyRegistration.java  ","version":"dev","tagName":"h3"},{"title":"Type Generation‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#type-generation","content":" Messages generate Java classes with @ForyField, default constructors, getters/setters, and byte helpers:  public class Person { public static enum PhoneType { MOBILE, HOME, WORK; } public static class PhoneNumber { @ForyField(id = 1) private String number; @ForyField(id = 2) private PhoneType phoneType; public byte[] toBytes() { ... } public static PhoneNumber fromBytes(byte[] bytes) { ... } } @ForyField(id = 1) private String name; @ForyField(id = 8) private Animal pet; public byte[] toBytes() { ... } public static Person fromBytes(byte[] bytes) { ... } }   Unions generate classes extending org.apache.fory.type.union.Union:  public final class Animal extends Union { public enum AnimalCase { DOG(1), CAT(2); public final int id; AnimalCase(int id) { this.id = id; } } public static Animal ofDog(Dog v) { ... } public AnimalCase getAnimalCase() { ... } public int getAnimalCaseId() { ... } public boolean hasDog() { ... } public Dog getDog() { ... } public void setDog(Dog v) { ... } }   ","version":"dev","tagName":"h3"},{"title":"Registration‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#registration","content":" Generated registration helper:  public static void register(Fory fory) { org.apache.fory.resolver.TypeResolver resolver = fory.getTypeResolver(); resolver.registerUnion(Animal.class, 106L, new org.apache.fory.serializer.UnionSerializer(fory, Animal.class)); resolver.register(Person.class, 100L); resolver.register(Person.PhoneType.class, 101L); resolver.register(Person.PhoneNumber.class, 102L); resolver.register(Dog.class, 104L); resolver.register(Cat.class, 105L); resolver.register(AddressBook.class, 103L); }   For schemas without explicit [id=...], generated registration uses computed numeric IDs (for example from auto_id.fdl):  resolver.register(Status.class, 1124725126L); resolver.registerUnion(Wrapper.class, 1471345060L, new org.apache.fory.serializer.UnionSerializer(fory, Wrapper.class)); resolver.register(Envelope.class, 3022445236L); resolver.registerUnion(Envelope.Detail.class, 1609214087L, new org.apache.fory.serializer.UnionSerializer(fory, Envelope.Detail.class)); resolver.register(Envelope.Payload.class, 2862577837L);   If option enable_auto_type_id = false; is set, registration uses namespace and type name:  resolver.register(Config.class, &quot;myapp.models&quot;, &quot;Config&quot;); resolver.registerUnion( Holder.class, &quot;myapp.models&quot;, &quot;Holder&quot;, new org.apache.fory.serializer.UnionSerializer(fory, Holder.class));   ","version":"dev","tagName":"h3"},{"title":"Usage‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#usage","content":" Person person = new Person(); person.setName(&quot;Alice&quot;); person.setPet(Animal.ofDog(new Dog())); byte[] data = person.toBytes(); Person restored = Person.fromBytes(data);   ","version":"dev","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#python","content":" ","version":"dev","tagName":"h2"},{"title":"Output Layout‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#output-layout-1","content":" Python output is one module per schema file, for example:  &lt;python_out&gt;/addressbook.py  ","version":"dev","tagName":"h3"},{"title":"Type Generation‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#type-generation-1","content":" Unions generate a case enum plus a Union subclass with typed helpers:  class AnimalCase(Enum): DOG = 1 CAT = 2 class Animal(Union): @classmethod def dog(cls, v: Dog) -&gt; &quot;Animal&quot;: ... def case(self) -&gt; AnimalCase: ... def case_id(self) -&gt; int: ... def is_dog(self) -&gt; bool: ... def dog_value(self) -&gt; Dog: ... def set_dog(self, v: Dog) -&gt; None: ...   Messages generate @pyfory.dataclass types, and nested types stay nested:  @pyfory.dataclass class Person: class PhoneType(IntEnum): MOBILE = 0 HOME = 1 WORK = 2 @pyfory.dataclass class PhoneNumber: number: str = pyfory.field(id=1, default=&quot;&quot;) phone_type: Person.PhoneType = pyfory.field(id=2, default=None) name: str = pyfory.field(id=1, default=&quot;&quot;) phones: List[Person.PhoneNumber] = pyfory.field(id=7, default_factory=list) pet: Animal = pyfory.field(id=8, default=None) def to_bytes(self) -&gt; bytes: ... @classmethod def from_bytes(cls, data: bytes) -&gt; &quot;Person&quot;: ...   ","version":"dev","tagName":"h3"},{"title":"Registration‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#registration-1","content":" Generated registration function:  def register_addressbook_types(fory: pyfory.Fory): fory.register_union(Animal, type_id=106, serializer=AnimalSerializer(fory)) fory.register_type(Person, type_id=100) fory.register_type(Person.PhoneType, type_id=101) fory.register_type(Person.PhoneNumber, type_id=102) fory.register_type(Dog, type_id=104) fory.register_type(Cat, type_id=105) fory.register_type(AddressBook, type_id=103)   For schemas without explicit [id=...], generated registration uses computed numeric IDs:  fory.register_type(Status, type_id=1124725126) fory.register_union(Wrapper, type_id=1471345060, serializer=WrapperSerializer(fory)) fory.register_type(Envelope, type_id=3022445236) fory.register_union(Envelope.Detail, type_id=1609214087, serializer=Envelope.DetailSerializer(fory)) fory.register_type(Envelope.Payload, type_id=2862577837)   If option enable_auto_type_id = false; is set:  fory.register_type(Config, namespace=&quot;myapp.models&quot;, typename=&quot;Config&quot;) fory.register_union( Holder, namespace=&quot;myapp.models&quot;, typename=&quot;Holder&quot;, serializer=HolderSerializer(fory), )   ","version":"dev","tagName":"h3"},{"title":"Usage‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#usage-1","content":" person = Person(name=&quot;Alice&quot;, pet=Animal.dog(Dog(name=&quot;Rex&quot;, bark_volume=10))) data = person.to_bytes() restored = Person.from_bytes(data)   ","version":"dev","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#rust","content":" ","version":"dev","tagName":"h2"},{"title":"Output Layout‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#output-layout-2","content":" Rust output is one module file per schema, for example:  &lt;rust_out&gt;/addressbook.rs  ","version":"dev","tagName":"h3"},{"title":"Type Generation‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#type-generation-2","content":" Unions map to Rust enums with #[fory(id = ...)] case attributes:  #[derive(ForyObject, Debug, Clone, PartialEq)] pub enum Animal { #[fory(id = 1)] Dog(Dog), #[fory(id = 2)] Cat(Cat), }   Nested types generate nested modules:  pub mod person { #[derive(ForyObject, Debug, Clone, PartialEq, Default)] #[repr(i32)] pub enum PhoneType { #[default] Mobile = 0, Home = 1, Work = 2, } #[derive(ForyObject, Debug, Clone, PartialEq, Default)] pub struct PhoneNumber { #[fory(id = 1)] pub number: String, #[fory(id = 2)] pub phone_type: PhoneType, } }   Messages derive ForyObject and include to_bytes/from_bytes helpers:  #[derive(ForyObject, Debug, Clone, PartialEq, Default)] pub struct Person { #[fory(id = 1)] pub name: String, #[fory(id = 7)] pub phones: Vec&lt;person::PhoneNumber&gt;, #[fory(id = 8, type_id = &quot;union&quot;)] pub pet: Animal, }   ","version":"dev","tagName":"h3"},{"title":"Registration‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#registration-2","content":" Generated registration function:  pub fn register_types(fory: &amp;mut Fory) -&gt; Result&lt;(), fory::Error&gt; { fory.register_union::&lt;Animal&gt;(106)?; fory.register::&lt;person::PhoneType&gt;(101)?; fory.register::&lt;person::PhoneNumber&gt;(102)?; fory.register::&lt;Person&gt;(100)?; fory.register::&lt;Dog&gt;(104)?; fory.register::&lt;Cat&gt;(105)?; fory.register::&lt;AddressBook&gt;(103)?; Ok(()) }   For schemas without explicit [id=...], generated registration uses computed numeric IDs:  fory.register::&lt;Status&gt;(1124725126)?; fory.register_union::&lt;Wrapper&gt;(1471345060)?; fory.register::&lt;Envelope&gt;(3022445236)?; fory.register_union::&lt;envelope::Detail&gt;(1609214087)?; fory.register::&lt;envelope::Payload&gt;(2862577837)?;   If option enable_auto_type_id = false; is set:  fory.register_by_namespace::&lt;Config&gt;(&quot;myapp.models&quot;, &quot;Config&quot;)?; fory.register_union_by_namespace::&lt;Holder&gt;(&quot;myapp.models&quot;, &quot;Holder&quot;)?;   ","version":"dev","tagName":"h3"},{"title":"Usage‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#usage-2","content":" let person = Person { name: &quot;Alice&quot;.into(), pet: Animal::Dog(Dog::default()), ..Default::default() }; let bytes = person.to_bytes()?; let restored = Person::from_bytes(&amp;bytes)?;   ","version":"dev","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#c","content":" ","version":"dev","tagName":"h2"},{"title":"Output Layout‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#output-layout-3","content":" C++ output is one header per schema file, for example:  &lt;cpp_out&gt;/addressbook.h  ","version":"dev","tagName":"h3"},{"title":"Type Generation‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#type-generation-3","content":" Messages generate final classes with typed accessors and byte helpers:  class Person final { public: class PhoneNumber final { public: const std::string&amp; number() const; std::string* mutable_number(); template &lt;class Arg, class... Args&gt; void set_number(Arg&amp;&amp; arg, Args&amp;&amp;... args); fory::Result&lt;std::vector&lt;uint8_t&gt;, fory::Error&gt; to_bytes() const; static fory::Result&lt;PhoneNumber, fory::Error&gt; from_bytes(const std::vector&lt;uint8_t&gt;&amp; data); }; const std::string&amp; name() const; std::string* mutable_name(); template &lt;class Arg, class... Args&gt; void set_name(Arg&amp;&amp; arg, Args&amp;&amp;... args); const Animal&amp; pet() const; Animal* mutable_pet(); };   Optional message fields generate has_xxx, mutable_xxx, and clear_xxx APIs:  class Envelope final { public: bool has_payload() const { return payload_ != nullptr; } const Envelope::Payload&amp; payload() const { return *payload_; } Envelope::Payload* mutable_payload() { if (!payload_) { payload_ = std::make_unique&lt;Envelope::Payload&gt;(); } return payload_.get(); } void clear_payload() { payload_.reset(); } private: std::unique_ptr&lt;Envelope::Payload&gt; payload_; };   Unions generate std::variant wrappers:  class Animal final { public: enum class AnimalCase : uint32_t { DOG = 1, CAT = 2, }; static Animal dog(Dog v); static Animal cat(Cat v); AnimalCase animal_case() const noexcept; uint32_t animal_case_id() const noexcept; bool is_dog() const noexcept; const Dog* as_dog() const noexcept; Dog* as_dog() noexcept; const Dog&amp; dog() const; Dog&amp; dog(); template &lt;class Visitor&gt; decltype(auto) visit(Visitor&amp;&amp; vis) const; private: std::variant&lt;Dog, Cat&gt; value_; };   Generated headers also include FORY_UNION, FORY_FIELD_CONFIG, FORY_ENUM, and FORY_STRUCT macros for serialization metadata.  ","version":"dev","tagName":"h3"},{"title":"Registration‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#registration-3","content":" Generated registration function:  inline void register_types(fory::serialization::BaseFory&amp; fory) { fory.register_union&lt;Animal&gt;(106); fory.register_enum&lt;Person::PhoneType&gt;(101); fory.register_struct&lt;Person::PhoneNumber&gt;(102); fory.register_struct&lt;Person&gt;(100); fory.register_struct&lt;Dog&gt;(104); fory.register_struct&lt;Cat&gt;(105); fory.register_struct&lt;AddressBook&gt;(103); }   For schemas without explicit [id=...], generated registration uses computed numeric IDs:  fory.register_enum&lt;Status&gt;(1124725126); fory.register_union&lt;Wrapper&gt;(1471345060); fory.register_struct&lt;Envelope&gt;(3022445236); fory.register_union&lt;Envelope::Detail&gt;(1609214087); fory.register_struct&lt;Envelope::Payload&gt;(2862577837);   If option enable_auto_type_id = false; is set:  fory.register_struct&lt;Config&gt;(&quot;myapp.models&quot;, &quot;Config&quot;); fory.register_union&lt;Holder&gt;(&quot;myapp.models&quot;, &quot;Holder&quot;);   ","version":"dev","tagName":"h3"},{"title":"Usage‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#usage-3","content":" addressbook::Person person; person.set_name(&quot;Alice&quot;); *person.mutable_pet() = addressbook::Animal::dog(addressbook::Dog{}); auto bytes = person.to_bytes(); auto restored = addressbook::Person::from_bytes(bytes.value());   ","version":"dev","tagName":"h3"},{"title":"Go‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#go","content":" ","version":"dev","tagName":"h2"},{"title":"Output Layout‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#output-layout-4","content":" Go output path depends on schema options and --go_out.  For addressbook.fdl, go_package is configured and generated output follows the configured import path/package (for example under your --go_out root).  Without go_package, output uses the requested --go_out directory and package-derived file naming.  ","version":"dev","tagName":"h3"},{"title":"Type Generation‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#type-generation-4","content":" Nested types use underscore naming by default (Person_PhoneType, Person_PhoneNumber):  type Person_PhoneType int32 const ( Person_PhoneTypeMobile Person_PhoneType = 0 Person_PhoneTypeHome Person_PhoneType = 1 Person_PhoneTypeWork Person_PhoneType = 2 ) type Person_PhoneNumber struct { Number string `fory:&quot;id=1&quot;` PhoneType Person_PhoneType `fory:&quot;id=2&quot;` }   Messages generate structs with fory tags and byte helpers:  type Person struct { Name string `fory:&quot;id=1&quot;` Id int32 `fory:&quot;id=2,compress=true&quot;` Phones []Person_PhoneNumber `fory:&quot;id=7&quot;` Pet Animal `fory:&quot;id=8&quot;` } func (m *Person) ToBytes() ([]byte, error) { ... } func (m *Person) FromBytes(data []byte) error { ... }   Unions generate typed case structs with constructors/accessors/visitor APIs:  type AnimalCase uint32 type Animal struct { case_ AnimalCase value any } func DogAnimal(v *Dog) Animal { ... } func CatAnimal(v *Cat) Animal { ... } func (u Animal) Case() AnimalCase { ... } func (u Animal) AsDog() (*Dog, bool) { ... } func (u Animal) Visit(visitor AnimalVisitor) error { ... }   ","version":"dev","tagName":"h3"},{"title":"Registration‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#registration-4","content":" Generated registration function:  func RegisterTypes(f *fory.Fory) error { if err := f.RegisterUnion(Animal{}, 106, fory.NewUnionSerializer(...)); err != nil { return err } if err := f.RegisterEnum(Person_PhoneType(0), 101); err != nil { return err } if err := f.RegisterStruct(Person_PhoneNumber{}, 102); err != nil { return err } if err := f.RegisterStruct(Person{}, 100); err != nil { return err } return nil }   For schemas without explicit [id=...], generated registration uses computed numeric IDs:  if err := f.RegisterEnum(Status(0), 1124725126); err != nil { ... } if err := f.RegisterUnion(Wrapper{}, 1471345060, fory.NewUnionSerializer(...)); err != nil { ... } if err := f.RegisterStruct(Envelope{}, 3022445236); err != nil { ... } if err := f.RegisterUnion(Envelope_Detail{}, 1609214087, fory.NewUnionSerializer(...)); err != nil { ... } if err := f.RegisterStruct(Envelope_Payload{}, 2862577837); err != nil { ... }   If option enable_auto_type_id = false; is set:  if err := f.RegisterNamedStruct(Config{}, &quot;myapp.models.Config&quot;); err != nil { ... } if err := f.RegisterNamedUnion(Holder{}, &quot;myapp.models.Holder&quot;, fory.NewUnionSerializer(...)); err != nil { ... }   go_nested_type_style controls nested type naming:  option go_nested_type_style = &quot;camelcase&quot;;   ","version":"dev","tagName":"h3"},{"title":"Usage‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#usage-4","content":" person := &amp;Person{ Name: &quot;Alice&quot;, Pet: DogAnimal(&amp;Dog{Name: &quot;Rex&quot;}), } data, err := person.ToBytes() if err != nil { panic(err) } var restored Person if err := restored.FromBytes(data); err != nil { panic(err) }   ","version":"dev","tagName":"h3"},{"title":"C#‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#c-1","content":" ","version":"dev","tagName":"h2"},{"title":"Output Layout‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#output-layout-5","content":" C# output is one .cs file per schema, for example:  &lt;csharp_out&gt;/addressbook/addressbook.cs  ","version":"dev","tagName":"h3"},{"title":"Type Generation‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#type-generation-5","content":" Messages generate [ForyObject] classes with C# properties and byte helpers:  [ForyObject] public sealed partial class Person { public string Name { get; set; } = string.Empty; public int Id { get; set; } public List&lt;Person.PhoneNumber&gt; Phones { get; set; } = new(); public Animal Pet { get; set; } = null!; public byte[] ToBytes() { ... } public static Person FromBytes(byte[] data) { ... } }   Unions generate Union subclasses with typed case helpers:  public sealed class Animal : Union { public static Animal Dog(Dog value) { ... } public static Animal Cat(Cat value) { ... } public bool IsDog =&gt; ...; public Dog DogValue() { ... } }   ","version":"dev","tagName":"h3"},{"title":"Registration‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#registration-5","content":" Each schema generates a registration helper:  public static class AddressbookForyRegistration { public static void Register(Fory fory) { fory.Register&lt;addressbook.Animal&gt;((uint)106); fory.Register&lt;addressbook.Person&gt;((uint)100); // ... } }   When explicit type IDs are not provided, generated registration uses computed numeric IDs (same behavior as other targets).  ","version":"dev","tagName":"h3"},{"title":"Cross-Language Notes‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#cross-language-notes","content":" ","version":"dev","tagName":"h2"},{"title":"Type ID Behavior‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#type-id-behavior","content":" Explicit [id=...] values are used directly in generated registration.When type IDs are omitted, generated code uses computed numeric IDs (see auto_id.* outputs).If option enable_auto_type_id = false; is set, generated registration uses namespace/type-name APIs instead of numeric IDs.  ","version":"dev","tagName":"h3"},{"title":"Nested Type Shape‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#nested-type-shape","content":" Language\tNested type formJava\tPerson.PhoneNumber Python\tPerson.PhoneNumber Rust\tperson::PhoneNumber C++\tPerson::PhoneNumber Go\tPerson_PhoneNumber (default) C#\tPerson.PhoneNumber  ","version":"dev","tagName":"h3"},{"title":"Byte Helper Naming‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/next/compiler/generated_code#byte-helper-naming","content":" Language\tHelpersJava\ttoBytes / fromBytes Python\tto_bytes / from_bytes Rust\tto_bytes / from_bytes C++\tto_bytes / from_bytes Go\tToBytes / FromBytes C#\tToBytes / FromBytes ","version":"dev","tagName":"h3"},{"title":"Basic Serialization","type":0,"sectionRef":"#","url":"/docs/next/guide/cpp/basic_serialization","content":"","keywords":"","version":"dev"},{"title":"Object Graph Serialization‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/cpp/basic_serialization#object-graph-serialization","content":" Apache Fory‚Ñ¢ provides automatic serialization of complex object graphs, preserving the structure and relationships between objects. The FORY_STRUCT macro generates efficient serialization code at compile time, eliminating runtime overhead.  Key capabilities:  Nested struct serialization with arbitrary depthCollection types (vector, set, map)Optional fields with std::optional&lt;T&gt;Smart pointers (std::shared_ptr, std::unique_ptr)Automatic handling of primitive types and stringsEfficient binary encoding with variable-length integers  #include &quot;fory/serialization/fory.h&quot; #include &lt;vector&gt; #include &lt;map&gt; using namespace fory::serialization; // Define structs struct Address { std::string street; std::string city; std::string country; bool operator==(const Address &amp;other) const { return street == other.street &amp;&amp; city == other.city &amp;&amp; country == other.country; } }; FORY_STRUCT(Address, street, city, country); struct Person { std::string name; int32_t age; Address address; std::vector&lt;std::string&gt; hobbies; std::map&lt;std::string, std::string&gt; metadata; bool operator==(const Person &amp;other) const { return name == other.name &amp;&amp; age == other.age &amp;&amp; address == other.address &amp;&amp; hobbies == other.hobbies &amp;&amp; metadata == other.metadata; } }; FORY_STRUCT(Person, name, age, address, hobbies, metadata); int main() { auto fory = Fory::builder().xlang(true).build(); fory.register_struct&lt;Address&gt;(100); fory.register_struct&lt;Person&gt;(200); Person person{ &quot;John Doe&quot;, 30, {&quot;123 Main St&quot;, &quot;New York&quot;, &quot;USA&quot;}, {&quot;reading&quot;, &quot;coding&quot;}, {{&quot;role&quot;, &quot;developer&quot;}} }; auto result = fory.serialize(person); auto decoded = fory.deserialize&lt;Person&gt;(result.value()); assert(person == decoded.value()); }   ","version":"dev","tagName":"h2"},{"title":"Serialization APIs‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/cpp/basic_serialization#serialization-apis","content":" ","version":"dev","tagName":"h2"},{"title":"Serialize to New Vector‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/cpp/basic_serialization#serialize-to-new-vector","content":" auto fory = Fory::builder().xlang(true).build(); fory.register_struct&lt;MyStruct&gt;(1); MyStruct obj{/* ... */}; // Serialize - returns Result&lt;std::vector&lt;uint8_t&gt;, Error&gt; auto result = fory.serialize(obj); if (result.ok()) { std::vector&lt;uint8_t&gt; bytes = std::move(result).value(); // Use bytes... } else { // Handle error std::cerr &lt;&lt; result.error().to_string() &lt;&lt; std::endl; }   ","version":"dev","tagName":"h3"},{"title":"Serialize to Existing Buffer‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/cpp/basic_serialization#serialize-to-existing-buffer","content":" // Serialize to existing Buffer (fastest path) Buffer buffer; auto result = fory.serialize_to(buffer, obj); if (result.ok()) { size_t bytes_written = result.value(); // buffer now contains serialized data } // Serialize to existing vector (zero-copy) std::vector&lt;uint8_t&gt; output; auto result = fory.serialize_to(output, obj); if (result.ok()) { size_t bytes_written = result.value(); // output now contains serialized data }   ","version":"dev","tagName":"h3"},{"title":"Deserialize from Byte Array‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/cpp/basic_serialization#deserialize-from-byte-array","content":" // Deserialize from raw pointer auto result = fory.deserialize&lt;MyStruct&gt;(data_ptr, data_size); if (result.ok()) { MyStruct obj = std::move(result).value(); } // Deserialize from vector std::vector&lt;uint8_t&gt; data = /* ... */; auto result = fory.deserialize&lt;MyStruct&gt;(data); // Deserialize from Buffer (updates reader_index) Buffer buffer(data); auto result = fory.deserialize&lt;MyStruct&gt;(buffer);   ","version":"dev","tagName":"h3"},{"title":"Error Handling‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/cpp/basic_serialization#error-handling","content":" Fory uses a Result&lt;T, Error&gt; type for error handling:  auto result = fory.serialize(obj); // Check if operation succeeded if (result.ok()) { auto value = std::move(result).value(); // Use value... } else { Error error = result.error(); std::cerr &lt;&lt; &quot;Error: &quot; &lt;&lt; error.to_string() &lt;&lt; std::endl; } // Or use FORY_TRY macro for early return FORY_TRY(bytes, fory.serialize(obj)); // Use bytes directly...   Common error types:  Error::type_mismatch - Type ID mismatch during deserializationError::invalid_data - Invalid or corrupted dataError::buffer_out_of_bound - Buffer overflow/underflowError::type_error - Type registration error  ","version":"dev","tagName":"h2"},{"title":"The FORY_STRUCT Macro‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/cpp/basic_serialization#the-fory_struct-macro","content":" The FORY_STRUCT macro registers a class for serialization (struct works the same way):  class MyStruct { public: int32_t x; std::string y; std::vector&lt;int32_t&gt; z; FORY_STRUCT(MyStruct, x, y, z); };   Private fields are supported when the macro is placed in a public: section:  class PrivateUser { public: PrivateUser(int32_t id, std::string name) : id_(id), name_(std::move(name)) {} bool operator==(const PrivateUser &amp;other) const { return id_ == other.id_ &amp;&amp; name_ == other.name_; } private: int32_t id_ = 0; std::string name_; public: FORY_STRUCT(PrivateUser, id_, name_); };   The macro:  Generates compile-time field metadataEnables member or ADL (Argument-Dependent Lookup) discovery for serializationCreates efficient serialization code via template specialization  Requirements:  Must be declared inside the class definition (struct works the same way) or at namespace scopeMust be placed after all field declarations (when used inside the class)When used inside a class, the macro must be placed in a public: sectionAll listed fields must be serializable typesField order in the macro is not important  ","version":"dev","tagName":"h2"},{"title":"External / Third-Party Types‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/cpp/basic_serialization#external--third-party-types","content":" When you cannot modify a third-party type, use FORY_STRUCT at namespace scope. This only works with public fields.  namespace thirdparty { struct Foo { int32_t id; std::string name; }; FORY_STRUCT(Foo, id, name); } // namespace thirdparty   Limitations:  Must be declared at namespace scope in the same namespace as the typeOnly public fields are supported  ","version":"dev","tagName":"h2"},{"title":"Inherited Fields‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/cpp/basic_serialization#inherited-fields","content":" To include base-class fields in a derived type, use FORY_BASE(Base) insideFORY_STRUCT. The base must define its own FORY_STRUCT so its fields can be referenced.  struct Base { int32_t a; FORY_STRUCT(Base, a); }; struct Derived : Base { int32_t b; FORY_STRUCT(Derived, FORY_BASE(Base), b); };   Notes:  Base fields are serialized before derived fields.Only fields visible from the derived type are supported.  ","version":"dev","tagName":"h2"},{"title":"Nested Structs‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/cpp/basic_serialization#nested-structs","content":" Nested structs are fully supported:  struct Inner { int32_t value; FORY_STRUCT(Inner, value); }; struct Outer { Inner inner; std::string label; FORY_STRUCT(Outer, inner, label); }; // Both must be registered fory.register_struct&lt;Inner&gt;(1); fory.register_struct&lt;Outer&gt;(2);   ","version":"dev","tagName":"h2"},{"title":"Performance Tips‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/cpp/basic_serialization#performance-tips","content":" Buffer Reuse: Use serialize_to(buffer, obj) with pre-allocated buffersPre-registration: Register all types before serialization startsSingle-Threaded: Use build() instead of build_thread_safe() when possibleDisable Tracking: Use track_ref(false) when references aren't neededCompact Encoding: Variable-length encoding for space efficiency  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/cpp/basic_serialization#related-topics","content":" Configuration - Builder optionsType Registration - Registering typesSupported Types - All supported types ","version":"dev","tagName":"h2"},{"title":"Schema IDL","type":0,"sectionRef":"#","url":"/docs/next/compiler/syntax","content":"","keywords":"","version":"dev"},{"title":"File Structure‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#file-structure","content":" An Fory IDL file typically consists of:  Optional package declarationOptional file-level optionsOptional import statementsType definitions (enums, messages, and unions)  // Optional package declaration package com.example.models; // Optional file-level options option java_package = &quot;com.example.models&quot;; // Import statements import &quot;common/types.fdl&quot;; // Type definitions enum Color [id=100] { ... } message User [id=101] { ... } message Order [id=102] { ... } union Event [id=103] { ... }   ","version":"dev","tagName":"h2"},{"title":"Comments‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#comments","content":" Fory IDL supports both single-line and block comments:  // This is a single-line comment /* * This is a block comment * that spans multiple lines */ message Example { string name = 1; // Inline comment }   ","version":"dev","tagName":"h2"},{"title":"Package Declaration‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#package-declaration","content":" The package declaration defines the namespace for all types in the file.  package com.example.models;   You can optionally specify a package alias used for auto-generated type IDs:  package com.example.models alias models_v1;   Rules:  Optional but recommendedMust appear before any type definitionsOnly one package declaration per fileUsed for namespace-based type registrationPackage alias is used for auto-ID hashing  Language Mapping:  Language\tPackage UsageJava\tJava package Python\tModule name (dots to underscores) Go\tPackage name (last component) Rust\tModule name (dots to underscores) C++\tNamespace (dots to ::) C#\tNamespace  ","version":"dev","tagName":"h2"},{"title":"File-Level Options‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#file-level-options","content":" Options can be specified at file level to control language-specific code generation.  ","version":"dev","tagName":"h2"},{"title":"Syntax‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#syntax","content":" option option_name = value;   ","version":"dev","tagName":"h3"},{"title":"Java Package Option‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#java-package-option","content":" Override the Java package for generated code:  package payment; option java_package = &quot;com.mycorp.payment.v1&quot;; message Payment { string id = 1; }   Effect:  Generated Java files will be in com/mycorp/payment/v1/ directoryJava package declaration will be package com.mycorp.payment.v1;Type registration still uses the Fory IDL package (payment) for cross-language compatibility  ","version":"dev","tagName":"h3"},{"title":"Go Package Option‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#go-package-option","content":" Specify the Go import path and package name:  package payment; option go_package = &quot;github.com/mycorp/apis/gen/payment/v1;paymentv1&quot;; message Payment { string id = 1; }   Format: &quot;import/path;package_name&quot; or just &quot;import/path&quot; (last segment used as package name)  Effect:  Generated Go files will have package paymentv1The import path can be used in other Go codeType registration still uses the Fory IDL package (payment) for cross-language compatibility  ","version":"dev","tagName":"h3"},{"title":"C# Namespace Option‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#c-namespace-option","content":" Override the C# namespace for generated code:  package payment; option csharp_namespace = &quot;MyCorp.Payment.V1&quot;; message Payment { string id = 1; }   Effect:  Generated C# files use namespace MyCorp.Payment.V1;Output path follows namespace segments (MyCorp/Payment/V1/ under --csharp_out)Type registration still uses the Fory IDL package (payment) for cross-language compatibility  ","version":"dev","tagName":"h3"},{"title":"Java Outer Classname Option‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#java-outer-classname-option","content":" Generate all types as inner classes of a single outer wrapper class:  package payment; option java_outer_classname = &quot;DescriptorProtos&quot;; enum Status { UNKNOWN = 0; ACTIVE = 1; } message Payment { string id = 1; Status status = 2; }   Effect:  Generates a single file DescriptorProtos.java instead of separate filesAll enums and messages become public static inner classesThe outer class is public final with a private constructorUseful for grouping related types together  Generated structure:  public final class DescriptorProtos { private DescriptorProtos() {} public static enum Status { UNKNOWN, ACTIVE; } public static class Payment { private String id; private Status status; // ... } }   Combined with java_package:  package payment; option java_package = &quot;com.example.proto&quot;; option java_outer_classname = &quot;PaymentProtos&quot;; message Payment { string id = 1; }   This generates com/example/proto/PaymentProtos.java with all types as inner classes.  ","version":"dev","tagName":"h3"},{"title":"Java Multiple Files Option‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#java-multiple-files-option","content":" Control whether types are generated in separate files or as inner classes:  package payment; option java_outer_classname = &quot;PaymentProtos&quot;; option java_multiple_files = true; message Payment { string id = 1; } message Receipt { string id = 1; }   Behavior:  java_outer_classname\tjava_multiple_files\tResultNot set\tAny\tSeparate files (one per type) Set\tfalse (default)\tSingle file with all types as inner classes Set\ttrue\tSeparate files (overrides outer class)  Effect of java_multiple_files = true:  Each top-level enum and message gets its own .java fileOverrides java_outer_classname behaviorUseful when you want separate files but still specify an outer class name for other purposes  Example without java_multiple_files (default):  option java_outer_classname = &quot;PaymentProtos&quot;; // Generates: PaymentProtos.java containing Payment and Receipt as inner classes   Example with java_multiple_files = true:  option java_outer_classname = &quot;PaymentProtos&quot;; option java_multiple_files = true; // Generates: Payment.java, Receipt.java (separate files)   ","version":"dev","tagName":"h3"},{"title":"Multiple Options‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#multiple-options","content":" Multiple options can be specified:  package payment; option java_package = &quot;com.mycorp.payment.v1&quot;; option go_package = &quot;github.com/mycorp/apis/gen/payment/v1;paymentv1&quot;; option deprecated = true; message Payment { string id = 1; }   ","version":"dev","tagName":"h3"},{"title":"Protobuf Extension Syntax‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#protobuf-extension-syntax","content":" In .fdl files, use native Fory IDL syntax only (for example, [id=100], ref,optional, nullable=true).  Protobuf extension syntax with (fory). is for .proto files and the protobuf frontend only.  For protobuf extension options, seeProtocol Buffers IDL Support.  ","version":"dev","tagName":"h3"},{"title":"Option Priority‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#option-priority","content":" For language-specific packages/namespaces:  Command-line package override (highest priority)Language-specific option (java_package, go_package, csharp_namespace)Fory IDL package declaration (fallback)  Example:  package myapp.models; option java_package = &quot;com.example.generated&quot;;   Scenario\tJava Package UsedNo override\tcom.example.generated CLI: --package=override\toverride No java_package option\tmyapp.models (fallback)  ","version":"dev","tagName":"h3"},{"title":"Cross-Language Type Registration‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#cross-language-type-registration","content":" Language-specific options only affect where code is generated, not the type namespace used for serialization. This ensures cross-language compatibility:  package myapp.models; option java_package = &quot;com.mycorp.generated&quot;; option go_package = &quot;github.com/mycorp/gen;genmodels&quot;; message User { string name = 1; }   All languages will register User with namespace myapp.models, enabling:  Java serialized data ‚Üí Go deserializationGo serialized data ‚Üí Java deserializationAny language combination works seamlessly  ","version":"dev","tagName":"h3"},{"title":"Import Statement‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#import-statement","content":" Import statements allow you to use types defined in other Fory IDL files.  ","version":"dev","tagName":"h2"},{"title":"Basic Syntax‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#basic-syntax","content":" import &quot;path/to/file.fdl&quot;;   ","version":"dev","tagName":"h3"},{"title":"Multiple Imports‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#multiple-imports","content":" import &quot;common/types.fdl&quot;; import &quot;common/enums.fdl&quot;; import &quot;models/address.fdl&quot;;   ","version":"dev","tagName":"h3"},{"title":"Path Resolution‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#path-resolution","content":" Import paths are resolved relative to the importing file:  project/ ‚îú‚îÄ‚îÄ common/ ‚îÇ ‚îî‚îÄ‚îÄ types.fdl ‚îú‚îÄ‚îÄ models/ ‚îÇ ‚îú‚îÄ‚îÄ user.fdl # import &quot;../common/types.fdl&quot; ‚îÇ ‚îî‚îÄ‚îÄ order.fdl # import &quot;../common/types.fdl&quot; ‚îî‚îÄ‚îÄ main.fdl # import &quot;common/types.fdl&quot;   Rules:  Import paths are quoted strings (double or single quotes)Paths are resolved relative to the importing file's directoryImported types become available as if defined in the current fileCircular imports are detected and reported as errorsTransitive imports work (if A imports B and B imports C, A has access to C's types)  ","version":"dev","tagName":"h3"},{"title":"Complete Example‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#complete-example","content":" common/types.fdl:  package common; enum Status [id=100] { PENDING = 0; ACTIVE = 1; COMPLETED = 2; } message Address [id=101] { string street = 1; string city = 2; string country = 3; }   models/user.fdl:  package models; import &quot;../common/types.fdl&quot;; message User [id=200] { string id = 1; string name = 2; Address home_address = 3; // Uses imported type Status status = 4; // Uses imported enum }   ","version":"dev","tagName":"h3"},{"title":"Unsupported Import Syntax‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#unsupported-import-syntax","content":" The following protobuf import modifiers are not supported:  // NOT SUPPORTED - will produce an error import public &quot;other.fdl&quot;; import weak &quot;other.fdl&quot;;   import public: Fory IDL uses a simpler import model. All imported types are available to the importing file only. Re-exporting is not supported. Import each file directly where needed.  import weak: Fory IDL requires all imports to be present at compile time. Optional dependencies are not supported.  ","version":"dev","tagName":"h3"},{"title":"Import Errors‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#import-errors","content":" The compiler reports errors for:  File not found: The imported file doesn't existCircular import: A imports B which imports A (directly or indirectly)Parse errors: Syntax errors in imported filesUnsupported syntax: import public or import weak  ","version":"dev","tagName":"h3"},{"title":"Enum Definition‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#enum-definition","content":" Enums define a set of named integer constants.  ","version":"dev","tagName":"h2"},{"title":"Basic Syntax‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#basic-syntax-1","content":" enum Status { PENDING = 0; ACTIVE = 1; COMPLETED = 2; }   ","version":"dev","tagName":"h3"},{"title":"With Explicit Type ID‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#with-explicit-type-id","content":" enum Status [id=100] { PENDING = 0; ACTIVE = 1; COMPLETED = 2; }   ","version":"dev","tagName":"h3"},{"title":"Reserved Values‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#reserved-values","content":" Reserve field numbers or names to prevent reuse:  enum Status { reserved 2, 15, 9 to 11, 40 to max; // Reserved numbers reserved &quot;OLD_STATUS&quot;, &quot;DEPRECATED&quot;; // Reserved names PENDING = 0; ACTIVE = 1; COMPLETED = 3; }   ","version":"dev","tagName":"h3"},{"title":"Enum Type Options‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#enum-type-options","content":" Enum-level options are declared inline in [] after the enum name:  enum Status [deprecated=true] { PENDING = 0; ACTIVE = 1; }   FDL does not support option ...; statements inside enum bodies.  Unsupported:  allow_alias is not supported. Each enum value must have a unique integer.  ","version":"dev","tagName":"h3"},{"title":"Language Mapping‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#language-mapping","content":" Language\tImplementationJava\tenum Status { UNKNOWN, ACTIVE, ... } Python\tclass Status(IntEnum): UNKNOWN = 0 Go\ttype Status int32 with constants Rust\t#[repr(i32)] enum Status { Unknown } C++\tenum class Status : int32_t { ... }  ","version":"dev","tagName":"h3"},{"title":"Enum Prefix Stripping‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#enum-prefix-stripping","content":" When enum values use a protobuf-style prefix (enum name in UPPER_SNAKE_CASE), the compiler automatically strips the prefix for languages with scoped enums:  // Input with prefix enum DeviceTier { DEVICE_TIER_UNKNOWN = 0; DEVICE_TIER_TIER1 = 1; DEVICE_TIER_TIER2 = 2; }   Generated code:  Language\tOutput\tStyleJava\tUNKNOWN, TIER1, TIER2\tScoped enum Rust\tUnknown, Tier1, Tier2\tScoped enum C++\tUNKNOWN, TIER1, TIER2\tScoped enum Python\tUNKNOWN, TIER1, TIER2\tScoped IntEnum Go\tDeviceTierUnknown, DeviceTierTier1, ...\tUnscoped const  Note: The prefix is only stripped if the remainder is a valid identifier. For example, DEVICE_TIER_1 is kept unchanged because 1 is not a valid identifier name.  Grammar:  enum_def := 'enum' IDENTIFIER [type_options] '{' enum_body '}' type_options := '[' type_option (',' type_option)* ']' type_option := IDENTIFIER '=' option_value enum_body := (reserved_stmt | enum_value)* reserved_stmt := 'reserved' reserved_items ';' enum_value := IDENTIFIER '=' INTEGER ';'   Rules:  Enum names must be unique within the fileEnum values must have explicit integer assignmentsValue integers must be unique within the enum (no aliases)Type ID ([id=100]) is optional for enums but recommended for cross-language use  Example with All Features:  // HTTP status code categories enum HttpCategory [id=200] { reserved 10 to 20; // Reserved for future use reserved &quot;UNKNOWN&quot;; // Reserved name INFORMATIONAL = 1; SUCCESS = 2; REDIRECTION = 3; CLIENT_ERROR = 4; SERVER_ERROR = 5; }   ","version":"dev","tagName":"h3"},{"title":"Message Definition‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#message-definition","content":" Messages define structured data types with typed fields.  ","version":"dev","tagName":"h2"},{"title":"Basic Syntax‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#basic-syntax-2","content":" message Person { string name = 1; int32 age = 2; }   ","version":"dev","tagName":"h3"},{"title":"With Explicit Type ID‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#with-explicit-type-id-1","content":" message Person [id=101] { string name = 1; int32 age = 2; }   ","version":"dev","tagName":"h3"},{"title":"Without Explicit Type ID‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#without-explicit-type-id","content":" message Person { // Auto-generated when enable_auto_type_id = true string name = 1; int32 age = 2; }   ","version":"dev","tagName":"h3"},{"title":"Language Mapping‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#language-mapping-1","content":" Language\tImplementationJava\tPOJO class with getters/setters Python\t@dataclass class Go\tStruct with exported fields Rust\tStruct with #[derive(ForyObject)] C++\tStruct with FORY_STRUCT macro  Type IDs control cross-language registration for messages, unions, and enums. SeeType IDs for auto-generation, aliases, and collision handling.  ","version":"dev","tagName":"h3"},{"title":"Reserved Fields‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#reserved-fields","content":" Reserve field numbers or names to prevent reuse after removing fields:  message User { reserved 2, 15, 9 to 11; // Reserved field numbers reserved &quot;old_field&quot;, &quot;temp&quot;; // Reserved field names string id = 1; string name = 3; }   ","version":"dev","tagName":"h3"},{"title":"Message Type Options‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#message-type-options","content":" Message-level options are declared inline in [] after the message name:  message User [deprecated=true] { string id = 1; string name = 2; }   FDL does not support option ...; statements inside message or enum bodies.  Grammar:  message_def := 'message' IDENTIFIER [type_options] '{' message_body '}' type_options := '[' type_option (',' type_option)* ']' type_option := IDENTIFIER '=' option_value message_body := (reserved_stmt | nested_type | field_def)* nested_type := enum_def | message_def | union_def   Rules:  Type IDs follow the rules in Type IDs.  ","version":"dev","tagName":"h3"},{"title":"Nested Types‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#nested-types","content":" Messages can contain nested message, enum, and union definitions. This is useful for defining types that are closely related to their parent message.  ","version":"dev","tagName":"h2"},{"title":"Nested Messages‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#nested-messages","content":" message SearchResponse { message Result { string url = 1; string title = 2; list&lt;string&gt; snippets = 3; } list&lt;Result&gt; results = 1; }   ","version":"dev","tagName":"h3"},{"title":"Nested Enums‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#nested-enums","content":" message Container { enum Status { STATUS_UNKNOWN = 0; STATUS_ACTIVE = 1; STATUS_INACTIVE = 2; } Status status = 1; }   ","version":"dev","tagName":"h3"},{"title":"Qualified Type Names‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#qualified-type-names","content":" Nested types can be referenced from other messages using qualified names (Parent.Child):  message SearchResponse { message Result { string url = 1; string title = 2; } } message SearchResultCache { // Reference nested type with qualified name SearchResponse.Result cached_result = 1; list&lt;SearchResponse.Result&gt; all_results = 2; }   ","version":"dev","tagName":"h3"},{"title":"Deeply Nested Types‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#deeply-nested-types","content":" Nesting can be multiple levels deep:  message Outer { message Middle { message Inner { string value = 1; } Inner inner = 1; } Middle middle = 1; } message OtherMessage { // Reference deeply nested type Outer.Middle.Inner deep_ref = 1; }   ","version":"dev","tagName":"h3"},{"title":"Language-Specific Generation‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#language-specific-generation","content":" Language\tNested Type GenerationJava\tStatic inner classes (SearchResponse.Result) Python\tNested classes within dataclass Go\tFlat structs with underscore (SearchResponse_Result, configurable to camelcase) Rust\tNested modules (search_response::Result) C++\tNested classes (SearchResponse::Result)  Note: Go defaults to underscore-separated nested names; set option go_nested_type_style = &quot;camelcase&quot;; to use concatenated names. Rust emits nested modules for nested types.  ","version":"dev","tagName":"h3"},{"title":"Nested Type Rules‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#nested-type-rules","content":" Nested type names must be unique within their parent messageNested types can have their own type IDsNumeric type IDs must be globally unique (including nested types); see Type IDsfor auto-generation and collision handlingWithin a message, you can reference nested types by simple nameFrom outside, use the qualified name (Parent.Child)  ","version":"dev","tagName":"h3"},{"title":"Union Definition‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#union-definition","content":" Unions define a value that can hold exactly one of several case types.  ","version":"dev","tagName":"h2"},{"title":"Basic Syntax‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#basic-syntax-3","content":" union Animal [id=106] { Dog dog = 1; Cat cat = 2; }   ","version":"dev","tagName":"h3"},{"title":"Using a Union in a Message‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#using-a-union-in-a-message","content":" message Person [id=100] { Animal pet = 1; optional Animal favorite_pet = 2; }   ","version":"dev","tagName":"h3"},{"title":"Rules‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#rules","content":" Case IDs must be unique within the unionCases cannot be optional or refUnion cases do not support field optionsCase types can be primitives, enums, messages, or other named typesUnion type IDs follow the rules in Type IDs.  Grammar:  union_def := 'union' IDENTIFIER [type_options] '{' union_field* '}' union_field := field_type IDENTIFIER '=' INTEGER ';'   ","version":"dev","tagName":"h3"},{"title":"Field Definition‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#field-definition","content":" Fields define the properties of a message.  ","version":"dev","tagName":"h2"},{"title":"Basic Syntax‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#basic-syntax-4","content":" field_type field_name = field_number;   ","version":"dev","tagName":"h3"},{"title":"With Modifiers‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#with-modifiers","content":" optional list&lt;string&gt; tags = 1; // Nullable list list&lt;optional string&gt; tags = 2; // Elements may be null ref list&lt;Node&gt; nodes = 3; // Collection tracked as a reference list&lt;ref Node&gt; nodes = 4; // Elements tracked as references   Grammar:  field_def := [modifiers] field_type IDENTIFIER '=' INTEGER ';' modifiers := { 'optional' | 'ref' } field_type := primitive_type | named_type | list_type | map_type list_type := 'list' '&lt;' { 'optional' | 'ref' } field_type '&gt;'   Modifiers apply to the field/collection. Use list&lt;...&gt; to describe element modifiers. repeated is accepted as an alias for list.  ","version":"dev","tagName":"h3"},{"title":"Field Modifiers‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#field-modifiers","content":" optional‚Äã  Marks the field as nullable:  message User { string name = 1; // Required, non-null optional string email = 2; // Nullable }   Generated Code:  Language\tNon-optional\tOptionalJava\tString name\tString email with @ForyField(nullable=true) Python\tname: str\tname: Optional[str] Go\tName string\tName *string Rust\tname: String\tname: Option&lt;String&gt; C++\tstd::string name\tstd::optional&lt;std::string&gt; name  Default Values:  Type\tDefault ValueNon-optional types\tLanguage default Optional types\tnull/None/nil  ref‚Äã  Enables reference tracking for shared/circular references:  message Node { string value = 1; ref Node parent = 2; // Can point to shared object list&lt;ref Node&gt; children = 3; }   Use Cases:  Shared objects (same object referenced multiple times)Circular references (object graphs with cycles)Tree structures with parent pointers  Generated Code:  Language\tWithout ref\tWith refJava\tNode parent\tNode parent with @ForyField(ref=true) Python\tparent: Node\tparent: Node = pyfory.field(ref=True) Go\tParent Node\tParent *Node with fory:&quot;ref&quot; Rust\tparent: Node\tparent: Arc&lt;Node&gt; C++\tNode parent\tstd::shared_ptr&lt;Node&gt; parent  Rust uses Arc by default; use ref(thread_safe=false) or ref(weak=true)to customize pointer types. For protobuf option syntax, seeProtocol Buffers IDL Support.  list‚Äã  Marks the field as a list/array:  message Document { list&lt;string&gt; tags = 1; list&lt;User&gt; authors = 2; }   Generated Code:  Language\tTypeJava\tList&lt;String&gt; Python\tList[str] Go\t[]string Rust\tVec&lt;String&gt; C++\tstd::vector&lt;std::string&gt;  ","version":"dev","tagName":"h3"},{"title":"Combining Modifiers‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#combining-modifiers","content":" Modifiers can be combined:  message Example { optional list&lt;string&gt; tags = 1; // Nullable list list&lt;optional string&gt; aliases = 2; // Elements may be null ref list&lt;Node&gt; nodes = 3; // Collection tracked as a reference list&lt;ref Node&gt; children = 4; // Elements tracked as references optional ref User owner = 5; // Nullable tracked reference }   Modifiers before list apply to the field/collection. Modifiers after listapply to elements. repeated is accepted as an alias for list.  List modifier mapping:  Fory IDL\tJava\tPython\tGo\tRust\tC++optional list&lt;string&gt;\tList&lt;String&gt; + @ForyField(nullable = true)\tOptional[List[str]]\t[]string + nullable\tOption&lt;Vec&lt;String&gt;&gt;\tstd::optional&lt;std::vector&lt;std::string&gt;&gt; list&lt;optional string&gt;\tList&lt;String&gt; (nullable elements)\tList[Optional[str]]\t[]*string\tVec&lt;Option&lt;String&gt;&gt;\tstd::vector&lt;std::optional&lt;std::string&gt;&gt; ref list&lt;User&gt;\tList&lt;User&gt; + @ForyField(ref = true)\tList[User] + pyfory.field(ref=True)\t[]User + ref\tArc&lt;Vec&lt;User&gt;&gt;\tstd::shared_ptr&lt;std::vector&lt;User&gt;&gt; list&lt;ref User&gt;\tList&lt;User&gt;\tList[User]\t[]*User + ref=false\tVec&lt;Arc&lt;User&gt;&gt;\tstd::vector&lt;std::shared_ptr&lt;User&gt;&gt;  Use ref(thread_safe=false) in Fory IDL (or [(fory).thread_safe_pointer = false] in protobuf) to generate Rc instead of Arc in Rust.  ","version":"dev","tagName":"h3"},{"title":"Field Numbers‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#field-numbers","content":" Each field must have a unique positive integer identifier:  message Example { string first = 1; string second = 2; string third = 3; }   Rules and best practices:  Numbers must be unique within a message.Numbers must be positive integers.Gaps are allowed and are useful when fields are removed.Prefer sequential numbering from 1.Never reuse a removed field number for a different field.  ","version":"dev","tagName":"h2"},{"title":"Type System‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#type-system","content":" Fory IDL provides a cross-language type system for primitives, named types, and collections. Field modifiers (optional, list, ref) control nullability, collection behavior, and reference tracking (seeField Modifiers).  ","version":"dev","tagName":"h2"},{"title":"Primitive Types‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#primitive-types","content":" Type\tDescription\tSizebool\tBoolean value\t1 byte int8\tSigned 8-bit integer\t1 byte int16\tSigned 16-bit integer\t2 bytes int32\tSigned 32-bit integer (varint encoding)\t4 bytes int64\tSigned 64-bit integer (varint encoding)\t8 bytes uint8\tUnsigned 8-bit integer\t1 byte uint16\tUnsigned 16-bit integer\t2 bytes uint32\tUnsigned 32-bit integer (varint encoding)\t4 bytes uint64\tUnsigned 64-bit integer (varint encoding)\t8 bytes fixed_int32\tSigned 32-bit integer (fixed encoding)\t4 bytes fixed_int64\tSigned 64-bit integer (fixed encoding)\t8 bytes fixed_uint32\tUnsigned 32-bit integer (fixed encoding)\t4 bytes fixed_uint64\tUnsigned 64-bit integer (fixed encoding)\t8 bytes tagged_int64\tSigned 64-bit integer (tagged encoding)\t8 bytes tagged_uint64\tUnsigned 64-bit integer (tagged encoding)\t8 bytes float32\t32-bit floating point\t4 bytes float64\t64-bit floating point\t8 bytes string\tUTF-8 string\tVariable bytes\tBinary data\tVariable date\tCalendar date\tVariable timestamp\tDate and time with timezone\tVariable duration\tDuration\tVariable decimal\tDecimal value\tVariable any\tDynamic value (runtime type)\tVariable  Boolean‚Äã  Language\tType\tNotesJava\tboolean / Boolean\tPrimitive or boxed Python\tbool Go\tbool Rust\tbool C++\tbool\t  Integer Types‚Äã  Fory IDL provides fixed-width signed integers (varint encoding for 32/64-bit by default):  Fory IDL Type\tSize\tRangeint8\t8-bit\t-128 to 127 int16\t16-bit\t-32,768 to 32,767 int32\t32-bit\t-2^31 to 2^31 - 1 int64\t64-bit\t-2^63 to 2^63 - 1  Language Mapping (Signed):  Fory IDL\tJava\tPython\tGo\tRust\tC++int8\tbyte\tpyfory.int8\tint8\ti8\tint8_t int16\tshort\tpyfory.int16\tint16\ti16\tint16_t int32\tint\tpyfory.int32\tint32\ti32\tint32_t int64\tlong\tpyfory.int64\tint64\ti64\tint64_t  Fory IDL provides fixed-width unsigned integers (varint encoding for 32/64-bit by default):  Fory IDL\tSize\tRangeuint8\t8-bit\t0 to 255 uint16\t16-bit\t0 to 65,535 uint32\t32-bit\t0 to 2^32 - 1 uint64\t64-bit\t0 to 2^64 - 1  Language Mapping (Unsigned):  Fory IDL\tJava\tPython\tGo\tRust\tC++uint8\tshort\tpyfory.uint8\tuint8\tu8\tuint8_t uint16\tint\tpyfory.uint16\tuint16\tu16\tuint16_t uint32\tlong\tpyfory.uint32\tuint32\tu32\tuint32_t uint64\tlong\tpyfory.uint64\tuint64\tu64\tuint64_t  Integer Encoding Variants‚Äã  For 32/64-bit integers, Fory IDL uses varint encoding by default. Use explicit types when you need fixed-width or tagged encoding:  Fory IDL Type\tEncoding\tNotesfixed_int32\tfixed\tSigned 32-bit fixed_int64\tfixed\tSigned 64-bit fixed_uint32\tfixed\tUnsigned 32-bit fixed_uint64\tfixed\tUnsigned 64-bit tagged_int64\ttagged\tSigned 64-bit (hybrid) tagged_uint64\ttagged\tUnsigned 64-bit (hybrid)  Floating-Point Types‚Äã  Fory IDL Type\tSize\tPrecisionfloat32\t32-bit\t~7 digits float64\t64-bit\t~15-16 digits  Language Mapping:  Fory IDL\tJava\tPython\tGo\tRust\tC++float32\tfloat\tpyfory.float32\tfloat32\tf32\tfloat float64\tdouble\tpyfory.float64\tfloat64\tf64\tdouble  String Type‚Äã  Language\tType\tNotesJava\tString\tImmutable Python\tstr Go\tstring\tImmutable Rust\tString\tOwned, heap-allocated C++\tstd::string\t  Bytes Type‚Äã  Language\tType\tNotesJava\tbyte[] Python\tbytes\tImmutable Go\t[]byte Rust\tVec&lt;u8&gt; C++\tstd::vector&lt;uint8_t&gt;\t  Temporal Types‚Äã  Date‚Äã  Language\tType\tNotesJava\tjava.time.LocalDate Python\tdatetime.date Go\ttime.Time\tTime portion ignored Rust\tchrono::NaiveDate\tRequires chrono crate C++\tfory::serialization::Date\t  Timestamp‚Äã  Language\tType\tNotesJava\tjava.time.Instant\tUTC-based Python\tdatetime.datetime Go\ttime.Time Rust\tchrono::NaiveDateTime\tRequires chrono crate C++\tfory::serialization::Timestamp\t  Any‚Äã  Language\tType\tNotesJava\tObject\tRuntime type written Python\tAny\tRuntime type written Go\tany\tRuntime type written Rust\tBox&lt;dyn Any&gt;\tRuntime type written C++\tstd::any\tRuntime type written  Example:  enum EventType [id=120] { CREATED = 0; DELETED = 1; } message UserCreated [id=121] { string user_id = 1; } message Envelope [id=122] { EventType type = 1; any payload = 2; }   Generated Code (Envelope.payload):  Language\tGenerated Field TypeJava\tObject payload Python\tpayload: Any Go\tPayload any Rust\tpayload: Box&lt;dyn Any&gt; C++\tstd::any payload  Notes:  any always writes a null flag (same as nullable) because values may be empty.Allowed runtime values are limited to bool, string, enum, message, and union. Other primitives (numeric, bytes, date/time) and list/map are not supported; wrap them in a message or use explicit fields instead.ref is not allowed on any fields (including list/map values). Wrap any in a message if you need reference tracking.The runtime type must be registered in the target language schema/IDL registration; unknown types fail to deserialize.  ","version":"dev","tagName":"h3"},{"title":"Named Types‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#named-types","content":" Reference other messages, enums, or unions by name:  enum Status { ... } message User { ... } message Order { User customer = 1; // Reference to User message Status status = 2; // Reference to Status enum }   ","version":"dev","tagName":"h3"},{"title":"Collection Types‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#collection-types","content":" List (list)‚Äã  Use the list&lt;...&gt; type for list fields. repeated is accepted as an alias. See Field Modifiers for modifier combinations and language mapping.  Nested collection types are not supported. Use a message wrapper if you needlist&lt;list&lt;...&gt;&gt;, list&lt;map&lt;...&gt;&gt;, or map&lt;..., list&lt;...&gt;&gt;.  Map‚Äã  Maps with typed keys and values:  message Config { map&lt;string, string&gt; properties = 1; map&lt;string, int32&gt; counts = 2; map&lt;int32, User&gt; users = 3; }   Language Mapping:  Fory IDL\tJava\tPython\tGo\tRust\tC++map&lt;string, int32&gt;\tMap&lt;String, Integer&gt;\tDict[str, int]\tmap[string]int32\tHashMap&lt;String, i32&gt;\tstd::map&lt;std::string, int32_t&gt; map&lt;string, User&gt;\tMap&lt;String, User&gt;\tDict[str, User]\tmap[string]User\tHashMap&lt;String, User&gt;\tstd::map&lt;std::string, User&gt;  Key Type Restrictions:  string (most common)Integer types (int8, int16, int32, int64)bool  Avoid using messages or complex types as keys.  ","version":"dev","tagName":"h3"},{"title":"Type Compatibility Matrix‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#type-compatibility-matrix","content":" This matrix shows which type conversions are safe across languages:  From -&gt; To\tbool\tint8\tint16\tint32\tint64\tfloat32\tfloat64\tstringbool\tY\tY\tY\tY\tY\t-\t-\t- int8\t-\tY\tY\tY\tY\tY\tY\t- int16\t-\t-\tY\tY\tY\tY\tY\t- int32\t-\t-\t-\tY\tY\t-\tY\t- int64\t-\t-\t-\t-\tY\t-\t-\t- float32\t-\t-\t-\t-\t-\tY\tY\t- float64\t-\t-\t-\t-\t-\t-\tY\t- string\t-\t-\t-\t-\t-\t-\t-\tY  Y = Safe conversion, - = Not recommended  ","version":"dev","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#best-practices","content":" Use int32 as the default for most integers; use int64 for large values.Use string for text data (UTF-8) and bytes for binary data.Use optional only when the field may legitimately be absent.Use ref only when needed for shared or circular references.Prefer list for ordered sequences and map for key-value lookups.  ","version":"dev","tagName":"h3"},{"title":"Type IDs‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#type-ids","content":" Type IDs enable efficient cross-language serialization and are used for messages, unions, and enums. When enable_auto_type_id = true (default) andid is omitted, the compiler auto-generates one usingMurmurHash3(utf8(package.type_name)) (32-bit) and annotates it in generated code. When enable_auto_type_id = false, types without explicit IDs are registered by namespace and name instead. Collisions are detected at compile-time across the current file and all imports; when a collision occurs, the compiler raises an error and asks for an explicit id or an alias.  enum Color [id=100] { ... } message User [id=101] { ... } union Event [id=102] { ... }   Enum type IDs remain optional; if omitted they are auto-generated using the same hash when enable_auto_type_id = true.  ","version":"dev","tagName":"h2"},{"title":"With Explicit Type ID‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#with-explicit-type-id-2","content":" message User [id=101] { ... } message User [id=101, deprecated=true] { ... } // Multiple options   ","version":"dev","tagName":"h3"},{"title":"Without Explicit Type ID‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#without-explicit-type-id-1","content":" message Config { ... } // Auto-generated when enable_auto_type_id = true   You can set [alias=&quot;...&quot;] to change the hash source without renaming the type.  ","version":"dev","tagName":"h3"},{"title":"Practical Notes‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#practical-notes","content":" If a type omits id and enable_auto_type_id = true, Fory generates an ID with MurmurHash3(utf8(package.type_name)) (32-bit).Package alias and type alias change the hash input and can be used to resolve hash collisions without renaming public types.Manual IDs in the small varint range (0-127) are compact on the wire; auto IDs are typically larger and usually consume 4-5 bytes.  ","version":"dev","tagName":"h3"},{"title":"ID Assignment Strategy‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#id-assignment-strategy","content":" // Enums: 100-199 enum Status [id=100] { ... } enum Priority [id=101] { ... } // User domain: 200-299 message User [id=200] { ... } message UserProfile [id=201] { ... } // Order domain: 300-399 message Order [id=300] { ... } message OrderItem [id=301] { ... }   ","version":"dev","tagName":"h3"},{"title":"Complete Example‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#complete-example-1","content":" // E-commerce domain model package com.shop.models; // Enums with type IDs enum OrderStatus [id=100] { PENDING = 0; CONFIRMED = 1; SHIPPED = 2; DELIVERED = 3; CANCELLED = 4; } enum PaymentMethod [id=101] { CREDIT_CARD = 0; DEBIT_CARD = 1; PAYPAL = 2; BANK_TRANSFER = 3; } // Messages with type IDs message Address [id=200] { string street = 1; string city = 2; string state = 3; string country = 4; string postal_code = 5; } message Customer [id=201] { string id = 1; string name = 2; optional string email = 3; optional string phone = 4; optional Address billing_address = 5; optional Address shipping_address = 6; } message Product [id=202] { string sku = 1; string name = 2; string description = 3; float64 price = 4; int32 stock = 5; list&lt;string&gt; categories = 6; map&lt;string, string&gt; attributes = 7; } message OrderItem [id=203] { ref Product product = 1; // Track reference to avoid duplication int32 quantity = 2; float64 unit_price = 3; } message Order [id=204] { string id = 1; ref Customer customer = 2; list&lt;OrderItem&gt; items = 3; OrderStatus status = 4; PaymentMethod payment_method = 5; float64 total = 6; optional string notes = 7; timestamp created_at = 8; optional timestamp shipped_at = 9; } // Config without explicit type ID (auto-generated when enable_auto_type_id = true) message ShopConfig { string store_name = 1; string currency = 2; float64 tax_rate = 3; list&lt;string&gt; supported_countries = 4; }   For protobuf-specific extension options and (fory). syntax, seeProtocol Buffers IDL Support.  ","version":"dev","tagName":"h2"},{"title":"Grammar Summary‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/next/compiler/syntax#grammar-summary","content":" file := [package_decl] file_option* import_decl* type_def* package_decl := 'package' package_name ['alias' package_name] ';' package_name := IDENTIFIER ('.' IDENTIFIER)* file_option := 'option' option_name '=' option_value ';' option_name := IDENTIFIER import_decl := 'import' STRING ';' type_def := enum_def | message_def | union_def enum_def := 'enum' IDENTIFIER [type_options] '{' enum_body '}' enum_body := (reserved_stmt | enum_value)* enum_value := IDENTIFIER '=' INTEGER ';' message_def := 'message' IDENTIFIER [type_options] '{' message_body '}' message_body := (reserved_stmt | nested_type | field_def)* nested_type := enum_def | message_def | union_def field_def := [modifiers] field_type IDENTIFIER '=' INTEGER [field_options] ';' union_def := 'union' IDENTIFIER [type_options] '{' union_field* '}' union_field := ['repeated'] field_type IDENTIFIER '=' INTEGER [field_options] ';' option_value := 'true' | 'false' | IDENTIFIER | INTEGER | STRING reserved_stmt := 'reserved' reserved_items ';' reserved_items := reserved_item (',' reserved_item)* reserved_item := INTEGER | INTEGER 'to' INTEGER | INTEGER 'to' 'max' | STRING modifiers := { 'optional' | 'ref' | 'repeated' } field_type := primitive_type | named_type | list_type | map_type primitive_type := 'bool' | 'int8' | 'int16' | 'int32' | 'int64' | 'uint8' | 'uint16' | 'uint32' | 'uint64' | 'fixed_int32' | 'fixed_int64' | 'fixed_uint32' | 'fixed_uint64' | 'tagged_int64' | 'tagged_uint64' | 'float32' | 'float64' | 'string' | 'bytes' | 'date' | 'timestamp' | 'duration' | 'decimal' | 'any' named_type := qualified_name qualified_name := IDENTIFIER ('.' IDENTIFIER)* // e.g., Parent.Child list_type := 'list' '&lt;' { 'optional' | 'ref' } field_type '&gt;' map_type := 'map' '&lt;' field_type ',' field_type '&gt;' type_options := '[' type_option (',' type_option)* ']' type_option := IDENTIFIER '=' option_value // e.g., id=100, deprecated=true field_options := '[' field_option (',' field_option)* ']' field_option := IDENTIFIER '=' option_value // e.g., deprecated=true, ref=true STRING := '&quot;' [^&quot;\\n]* '&quot;' | &quot;'&quot; [^'\\n]* &quot;'&quot; IDENTIFIER := [a-zA-Z_][a-zA-Z0-9_]* INTEGER := '-'? [0-9]+  ","version":"dev","tagName":"h2"},{"title":"Cross-Language Serialization","type":0,"sectionRef":"#","url":"/docs/next/guide/cpp/cross_language","content":"","keywords":"","version":"dev"},{"title":"Overview‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/cpp/cross_language#overview","content":" Apache Fory‚Ñ¢ enables seamless data exchange between C++, Java, Python, Go, Rust, and JavaScript. The xlang (cross-language) mode ensures binary compatibility across all supported languages.  ","version":"dev","tagName":"h2"},{"title":"Enabling Cross-Language Mode‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/cpp/cross_language#enabling-cross-language-mode","content":" #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; auto fory = Fory::builder() .xlang(true) // Enable cross-language mode .build();   ","version":"dev","tagName":"h2"},{"title":"Cross-Language Example‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/cpp/cross_language#cross-language-example","content":" ","version":"dev","tagName":"h2"},{"title":"C++ Producer‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/cpp/cross_language#c-producer","content":" #include &quot;fory/serialization/fory.h&quot; #include &lt;fstream&gt; using namespace fory::serialization; struct Message { std::string topic; int64_t timestamp; std::map&lt;std::string, std::string&gt; headers; std::vector&lt;uint8_t&gt; payload; bool operator==(const Message &amp;other) const { return topic == other.topic &amp;&amp; timestamp == other.timestamp &amp;&amp; headers == other.headers &amp;&amp; payload == other.payload; } }; FORY_STRUCT(Message, topic, timestamp, headers, payload); int main() { auto fory = Fory::builder().xlang(true).build(); fory.register_struct&lt;Message&gt;(100); Message msg{ &quot;events.user&quot;, 1699999999000, {{&quot;content-type&quot;, &quot;application/json&quot;}}, {'h', 'e', 'l', 'l', 'o'} }; auto result = fory.serialize(msg); if (result.ok()) { auto bytes = std::move(result).value(); // write to file, send over network, etc. std::ofstream file(&quot;message.bin&quot;, std::ios::binary); file.write(reinterpret_cast&lt;const char*&gt;(bytes.data()), bytes.size()); } return 0; }   ","version":"dev","tagName":"h3"},{"title":"Java Consumer‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/cpp/cross_language#java-consumer","content":" import org.apache.fory.Fory; import org.apache.fory.config.Language; public class Message { public String topic; public long timestamp; public Map&lt;String, String&gt; headers; public byte[] payload; } public class Consumer { public static void main(String[] args) throws Exception { Fory fory = Fory.builder() .withLanguage(Language.XLANG) .build(); fory.register(Message.class, 100); // Same ID as C++ byte[] bytes = Files.readAllBytes(Path.of(&quot;message.bin&quot;)); Message msg = (Message) fory.deserialize(bytes); System.out.println(&quot;Topic: &quot; + msg.topic); System.out.println(&quot;Timestamp: &quot; + msg.timestamp); } }   ","version":"dev","tagName":"h3"},{"title":"Python Consumer‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/cpp/cross_language#python-consumer","content":" import pyfory class Message: topic: str timestamp: int headers: dict[str, str] payload: bytes fory = pyfory.Fory(xlang=True) fory.register(Message, type_id=100) # Same ID as C++ with open(&quot;message.bin&quot;, &quot;rb&quot;) as f: data = f.read() msg = fory.deserialize(data) print(f&quot;Topic: {msg.topic}&quot;) print(f&quot;Timestamp: {msg.timestamp}&quot;)   ","version":"dev","tagName":"h3"},{"title":"Type Mapping‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/cpp/cross_language#type-mapping","content":" ","version":"dev","tagName":"h2"},{"title":"Primitive Types‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/cpp/cross_language#primitive-types","content":" C++ Type\tJava Type\tPython Type\tGo Type\tRust Typebool\tboolean\tbool\tbool\tbool int8_t\tbyte\tint\tint8\ti8 int16_t\tshort\tint\tint16\ti16 int32_t\tint\tint\tint32\ti32 int64_t\tlong\tint\tint64\ti64 float\tfloat\tfloat\tfloat32\tf32 double\tdouble\tfloat\tfloat64\tf64  ","version":"dev","tagName":"h3"},{"title":"String Types‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/cpp/cross_language#string-types","content":" C++ Type\tJava Type\tPython Type\tGo Type\tRust Typestd::string\tString\tstr\tstring\tString  ","version":"dev","tagName":"h3"},{"title":"Collection Types‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/cpp/cross_language#collection-types","content":" C++ Type\tJava Type\tPython Type\tGo Typestd::vector&lt;T&gt;\tList&lt;T&gt;\tlist\t[]T std::set&lt;T&gt;\tSet&lt;T&gt;\tset\tmap[T]struct{} std::map&lt;K,V&gt;\tMap&lt;K,V&gt;\tdict\tmap[K]V  ","version":"dev","tagName":"h3"},{"title":"Temporal Types‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/cpp/cross_language#temporal-types","content":" C++ Type\tJava Type\tPython Type\tGo TypeTimestamp\tInstant\tdatetime\ttime.Time Duration\tDuration\ttimedelta\ttime.Duration Date\tLocalDate\tdatetime.date\ttime.Time  ","version":"dev","tagName":"h3"},{"title":"Field Order Requirements‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/cpp/cross_language#field-order-requirements","content":" Critical: Fields are sorted by snake_case field name. The converted names must match across languages.  ","version":"dev","tagName":"h2"},{"title":"C++‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/cpp/cross_language#c","content":" struct Person { std::string name; // Field 0 int32_t age; // Field 1 std::string email; // Field 2 }; FORY_STRUCT(Person, name, age, email); // Order matters!   ","version":"dev","tagName":"h3"},{"title":"Java‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/cpp/cross_language#java","content":" public class Person { public String name; // Field 0 public int age; // Field 1 public String email; // Field 2 }   ","version":"dev","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/cpp/cross_language#python","content":" class Person: name: str # Field 0 age: int # Field 1 email: str # Field 2   ","version":"dev","tagName":"h3"},{"title":"Type ID Consistency‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/cpp/cross_language#type-id-consistency","content":" All languages must use the same type IDs:  // C++ fory.register_struct&lt;Person&gt;(100); fory.register_struct&lt;Address&gt;(101); fory.register_struct&lt;Order&gt;(102);   // Java fory.register(Person.class, 100); fory.register(Address.class, 101); fory.register(Order.class, 102);   # Python fory.register(Person, type_id=100) fory.register(Address, type_id=101) fory.register(Order, type_id=102)   ","version":"dev","tagName":"h2"},{"title":"Compatible Mode‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/cpp/cross_language#compatible-mode","content":" For schema evolution across language boundaries:  // C++ with compatible mode auto fory = Fory::builder() .xlang(true) .compatible(true) // Enable schema evolution .build();   Compatible mode allows:  Adding new fields (with defaults)Removing unused fieldsReordering fields  ","version":"dev","tagName":"h2"},{"title":"Troubleshooting‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/cpp/cross_language#troubleshooting","content":" ","version":"dev","tagName":"h2"},{"title":"Type Mismatch Errors‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/cpp/cross_language#type-mismatch-errors","content":" Error: Type mismatch: expected 100, got 101   Solution: Ensure type IDs match across all languages.  ","version":"dev","tagName":"h3"},{"title":"Encoding Errors‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/cpp/cross_language#encoding-errors","content":" Error: Invalid UTF-8 sequence   Solution: Ensure strings are valid UTF-8 in all languages.  ","version":"dev","tagName":"h3"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/cpp/cross_language#related-topics","content":" Configuration - Builder optionsType Registration - Registering typesSupported Types - Type compatibility ","version":"dev","tagName":"h2"},{"title":"Custom Serializers","type":0,"sectionRef":"#","url":"/docs/next/guide/cpp/custom_serializers","content":"","keywords":"","version":"dev"},{"title":"When to Use Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/cpp/custom_serializers#when-to-use-custom-serializers","content":" External types from third-party librariesTypes with special serialization requirementsLegacy data format compatibilityPerformance-critical custom encodingCross-language interoperability with custom protocols  ","version":"dev","tagName":"h2"},{"title":"Implementing the Serializer Template‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/cpp/custom_serializers#implementing-the-serializer-template","content":" To create a custom serializer, specialize the Serializer template for your type within the fory::serialization namespace:  #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; // Define your custom type struct MyExt { int32_t id; bool operator==(const MyExt &amp;other) const { return id == other.id; } }; namespace fory { namespace serialization { template &lt;&gt; struct Serializer&lt;MyExt&gt; { // Declare as extension type for custom serialization static constexpr TypeId type_id = TypeId::EXT; // Main write method - handles null checking and type info static void write(const MyExt &amp;value, WriteContext &amp;ctx, RefMode ref_mode, bool write_type, bool has_generics = false) { (void)has_generics; write_not_null_ref_flag(ctx, ref_mode); if (write_type) { auto result = ctx.write_any_type_info( static_cast&lt;uint32_t&gt;(TypeId::UNKNOWN), std::type_index(typeid(MyExt))); if (!result.ok()) { ctx.set_error(std::move(result).error()); return; } } write_data(value, ctx); } // write only the data (no type info) static void write_data(const MyExt &amp;value, WriteContext &amp;ctx) { Serializer&lt;int32_t&gt;::write_data(value.id, ctx); } // write data with generics support static void write_data_generic(const MyExt &amp;value, WriteContext &amp;ctx, bool has_generics) { (void)has_generics; write_data(value, ctx); } // Main read method - handles null checking and type info static MyExt read(ReadContext &amp;ctx, RefMode ref_mode, bool read_type) { bool has_value = read_null_only_flag(ctx, ref_mode); if (ctx.has_error() || !has_value) { return MyExt{}; } if (read_type) { const TypeInfo *type_info = ctx.read_any_type_info(ctx.error()); if (ctx.has_error()) { return MyExt{}; } if (!type_info) { ctx.set_error(Error::type_error(&quot;TypeInfo for MyExt not found&quot;)); return MyExt{}; } } return read_data(ctx); } // Read only the data (no type info) static MyExt read_data(ReadContext &amp;ctx) { MyExt value; value.id = Serializer&lt;int32_t&gt;::read_data(ctx); return value; } // Read data with generics support static MyExt read_data_generic(ReadContext &amp;ctx, bool has_generics) { (void)has_generics; return read_data(ctx); } // Read with pre-resolved type info static MyExt read_with_type_info(ReadContext &amp;ctx, RefMode ref_mode, const TypeInfo &amp;type_info) { (void)type_info; return read(ctx, ref_mode, false); } }; } // namespace serialization } // namespace fory   ","version":"dev","tagName":"h2"},{"title":"Required Methods‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/cpp/custom_serializers#required-methods","content":" A custom serializer must implement these static methods:  Method\tPurposewrite\tMain serialization entry point with type info write_data\tSerialize data only (no type info) write_data_generic\tSerialize data with generics support read\tMain deserialization entry point with type info read_data\tDeserialize data only (no type info) read_data_generic\tDeserialize data with generics support read_with_type_info\tDeserialize with pre-resolved TypeInfo  The type_id constant should be set to TypeId::EXT for custom extension types.  ","version":"dev","tagName":"h2"},{"title":"Registering Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/cpp/custom_serializers#registering-custom-serializers","content":" Register your custom serializer with Fory before use:  auto fory = Fory::builder().xlang(true).build(); // Register with numeric type ID (must match across languages) auto result = fory.register_extension_type&lt;MyExt&gt;(103); if (!result.ok()) { std::cerr &lt;&lt; &quot;Failed to register: &quot; &lt;&lt; result.error().to_string() &lt;&lt; std::endl; } // Or register with type name for named type systems fory.register_extension_type&lt;MyExt&gt;(&quot;my_ext&quot;); // Or with namespace and type name fory.register_extension_type&lt;MyExt&gt;(&quot;com.example&quot;, &quot;MyExt&quot;);   ","version":"dev","tagName":"h2"},{"title":"Complete Example‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/cpp/custom_serializers#complete-example","content":" #include &quot;fory/serialization/fory.h&quot; #include &lt;iostream&gt; using namespace fory::serialization; struct CustomType { int32_t value; std::string name; bool operator==(const CustomType &amp;other) const { return value == other.value &amp;&amp; name == other.name; } }; namespace fory { namespace serialization { template &lt;&gt; struct Serializer&lt;CustomType&gt; { static constexpr TypeId type_id = TypeId::EXT; static void write(const CustomType &amp;value, WriteContext &amp;ctx, RefMode ref_mode, bool write_type, bool has_generics = false) { (void)has_generics; write_not_null_ref_flag(ctx, ref_mode); if (write_type) { auto result = ctx.write_any_type_info( static_cast&lt;uint32_t&gt;(TypeId::UNKNOWN), std::type_index(typeid(CustomType))); if (!result.ok()) { ctx.set_error(std::move(result).error()); return; } } write_data(value, ctx); } static void write_data(const CustomType &amp;value, WriteContext &amp;ctx) { // write value as varint for compact encoding Serializer&lt;int32_t&gt;::write_data(value.value, ctx); // Delegate string serialization to built-in serializer Serializer&lt;std::string&gt;::write_data(value.name, ctx); } static void write_data_generic(const CustomType &amp;value, WriteContext &amp;ctx, bool has_generics) { (void)has_generics; write_data(value, ctx); } static CustomType read(ReadContext &amp;ctx, RefMode ref_mode, bool read_type) { bool has_value = read_null_only_flag(ctx, ref_mode); if (ctx.has_error() || !has_value) { return CustomType{}; } if (read_type) { const TypeInfo *type_info = ctx.read_any_type_info(ctx.error()); if (ctx.has_error()) { return CustomType{}; } if (!type_info) { ctx.set_error(Error::type_error(&quot;TypeInfo for CustomType not found&quot;)); return CustomType{}; } } return read_data(ctx); } static CustomType read_data(ReadContext &amp;ctx) { CustomType value; value.value = Serializer&lt;int32_t&gt;::read_data(ctx); value.name = Serializer&lt;std::string&gt;::read_data(ctx); return value; } static CustomType read_data_generic(ReadContext &amp;ctx, bool has_generics) { (void)has_generics; return read_data(ctx); } static CustomType read_with_type_info(ReadContext &amp;ctx, RefMode ref_mode, const TypeInfo &amp;type_info) { (void)type_info; return read(ctx, ref_mode, false); } }; } // namespace serialization } // namespace fory int main() { auto fory = Fory::builder().xlang(true).build(); fory.register_extension_type&lt;CustomType&gt;(100); CustomType original{42, &quot;test&quot;}; auto serialized = fory.serialize(original); if (!serialized.ok()) { std::cerr &lt;&lt; &quot;Serialization failed&quot; &lt;&lt; std::endl; return 1; } auto deserialized = fory.deserialize&lt;CustomType&gt;(serialized.value()); if (!deserialized.ok()) { std::cerr &lt;&lt; &quot;Deserialization failed&quot; &lt;&lt; std::endl; return 1; } assert(original == deserialized.value()); std::cout &lt;&lt; &quot;Custom serializer works!&quot; &lt;&lt; std::endl; return 0; }   ","version":"dev","tagName":"h2"},{"title":"WriteContext Methods‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/cpp/custom_serializers#writecontext-methods","content":" The WriteContext provides methods for writing data:  // Primitive types ctx.write_uint8(value); ctx.write_int8(value); ctx.write_uint16(value); // Variable-length integers (compact encoding) ctx.write_var_uint32(value); // Unsigned varint ctx.write_varint32(value); // Signed zigzag varint ctx.write_var_uint64(value); // Unsigned varint ctx.write_varint64(value); // Signed zigzag varint // Tagged integers (for mixed-size encoding) ctx.write_tagged_uint64(value); ctx.write_tagged_int64(value); // Raw bytes ctx.write_bytes(data_ptr, length); // Access underlying buffer for advanced operations ctx.buffer().write_int32(value); ctx.buffer().write_float(value); ctx.buffer().write_double(value);   ","version":"dev","tagName":"h2"},{"title":"ReadContext Methods‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/cpp/custom_serializers#readcontext-methods","content":" The ReadContext provides methods for reading data:  // Primitive types (use error reference pattern) uint8_t u8 = ctx.read_uint8(ctx.error()); int8_t i8 = ctx.read_int8(ctx.error()); // Variable-length integers uint32_t u32 = ctx.read_var_uint32(ctx.error()); int32_t i32 = ctx.read_varint32(ctx.error()); uint64_t u64 = ctx.read_var_uint64(ctx.error()); int64_t i64 = ctx.read_varint64(ctx.error()); // Check for errors after read operations if (ctx.has_error()) { return MyType{}; // Return default on error } // Access underlying buffer for advanced operations int32_t value = ctx.buffer().read_int32(ctx.error()); float f = ctx.buffer().read_float(ctx.error()); double d = ctx.buffer().read_double(ctx.error());   ","version":"dev","tagName":"h2"},{"title":"Delegating to Built-in Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/cpp/custom_serializers#delegating-to-built-in-serializers","content":" Reuse existing serializers for nested types:  static void write_data(const MyType &amp;value, WriteContext &amp;ctx) { // Delegate to built-in serializers Serializer&lt;int32_t&gt;::write_data(value.int_field, ctx); Serializer&lt;std::string&gt;::write_data(value.string_field, ctx); Serializer&lt;std::vector&lt;int32_t&gt;&gt;::write_data(value.vec_field, ctx); } static MyType read_data(ReadContext &amp;ctx) { MyType value; value.int_field = Serializer&lt;int32_t&gt;::read_data(ctx); value.string_field = Serializer&lt;std::string&gt;::read_data(ctx); value.vec_field = Serializer&lt;std::vector&lt;int32_t&gt;&gt;::read_data(ctx); return value; }   ","version":"dev","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/cpp/custom_serializers#best-practices","content":" Use variable-length encoding for integers that may be smallCheck errors after read operations using ctx.has_error()Return default values on error to maintain consistent behaviorDelegate to built-in serializers for standard typesMatch type IDs across languages for cross-language compatibilityUse (void)param to suppress unused parameter warnings  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/cpp/custom_serializers#related-topics","content":" Type Registration - Registering serializersBasic Serialization - Using FORY_STRUCT macroSchema Evolution - Compatible modeCross-Language - Cross-language serialization ","version":"dev","tagName":"h2"},{"title":"Field Configuration","type":0,"sectionRef":"#","url":"/docs/next/guide/cpp/field_configuration","content":"","keywords":"","version":"dev"},{"title":"Overview‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#overview","content":" Apache Fory‚Ñ¢ provides three ways to configure field-level metadata at compile time:  fory::field&lt;&gt; template - Inline metadata in struct definition with wrapper typesFORY_FIELD_TAGS macro - Non-invasive metadata for basic field configurationFORY_FIELD_CONFIG macro - Advanced configuration with builder pattern and encoding control  These enable:  Tag IDs: Assign compact numeric IDs for schema evolutionNullability: Mark pointer fields as nullableReference Tracking: Enable reference tracking for shared pointersEncoding Control: Specify wire format for integers (varint, fixed, tagged)Dynamic Dispatch: Control polymorphic type info for smart pointers  Comparison:  Feature\tfory::field&lt;&gt;\tFORY_FIELD_TAGS\tFORY_FIELD_CONFIGStruct modification\tRequired (wrap types)\tNone\tNone Encoding control\tNo\tNo\tYes (varint/fixed/tagged) Builder pattern\tNo\tNo\tYes Dynamic control\tYes\tNo\tYes Compile-time verify\tYes\tLimited\tYes (member pointers) Cross-lang compat\tLimited\tLimited\tFull Recommended for\tSimple structs\tThird-party types\tComplex/xlang structs  ","version":"dev","tagName":"h2"},{"title":"The fory::field Template‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#the-foryfield-template","content":" template &lt;typename T, int16_t Id, typename... Options&gt; class field;   ","version":"dev","tagName":"h2"},{"title":"Template Parameters‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#template-parameters","content":" Parameter\tDescriptionT\tThe underlying field type Id\tField tag ID (int16_t) for compact serialization Options\tOptional tags: fory::nullable, fory::ref  ","version":"dev","tagName":"h3"},{"title":"Basic Usage‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#basic-usage","content":" #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; struct Person { fory::field&lt;std::string, 0&gt; name; fory::field&lt;int32_t, 1&gt; age; fory::field&lt;std::optional&lt;std::string&gt;, 2&gt; nickname; }; FORY_STRUCT(Person, name, age, nickname);   The fory::field&lt;&gt; wrapper is transparent - you can use it like the underlying type:  Person person; person.name = &quot;Alice&quot;; // Direct assignment person.age = 30; std::string n = person.name; // Implicit conversion int a = person.age.get(); // Explicit get()   ","version":"dev","tagName":"h3"},{"title":"Tag Types‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#tag-types","content":" ","version":"dev","tagName":"h2"},{"title":"fory::nullable‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#forynullable","content":" Marks a smart pointer field as nullable (can be nullptr):  struct Node { fory::field&lt;std::string, 0&gt; name; fory::field&lt;std::shared_ptr&lt;Node&gt;, 1, fory::nullable&gt; next; // Can be nullptr }; FORY_STRUCT(Node, name, next);   Valid for: std::shared_ptr&lt;T&gt;, fory::serialization::SharedWeak&lt;T&gt;, std::unique_ptr&lt;T&gt;  Note: For nullable primitives or strings, use std::optional&lt;T&gt; instead:  // Correct: use std::optional for nullable primitives fory::field&lt;std::optional&lt;int32_t&gt;, 0&gt; optional_value; // Wrong: nullable is not allowed for primitives // fory::field&lt;int32_t, 0, fory::nullable&gt; value; // Compile error!   ","version":"dev","tagName":"h3"},{"title":"fory::not_null‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#forynot_null","content":" Explicitly marks a pointer field as non-nullable. This is the default for smart pointers, but can be used for documentation:  fory::field&lt;std::shared_ptr&lt;Data&gt;, 0, fory::not_null&gt; data; // Must not be nullptr   Valid for: std::shared_ptr&lt;T&gt;, fory::serialization::SharedWeak&lt;T&gt;, std::unique_ptr&lt;T&gt;  ","version":"dev","tagName":"h3"},{"title":"fory::ref‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#foryref","content":" Enables reference tracking for shared pointer fields. When multiple fields reference the same object, it will be serialized once and shared:  struct Graph { fory::field&lt;std::string, 0&gt; name; fory::field&lt;std::shared_ptr&lt;Graph&gt;, 1, fory::ref&gt; left; // Ref tracked fory::field&lt;std::shared_ptr&lt;Graph&gt;, 2, fory::ref&gt; right; // Ref tracked }; FORY_STRUCT(Graph, name, left, right);   Valid for: std::shared_ptr&lt;T&gt;, fory::serialization::SharedWeak&lt;T&gt; (requires shared ownership)  ","version":"dev","tagName":"h3"},{"title":"fory::dynamic<V>‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#forydynamicv","content":" Controls whether type info is written for polymorphic smart pointer fields:  fory::dynamic&lt;true&gt;: Force type info to be written (enable runtime subtype support)fory::dynamic&lt;false&gt;: skip type info (use declared type directly, no dynamic dispatch)  By default, Fory auto-detects polymorphism via std::is_polymorphic&lt;T&gt;. Use this tag to override:  // Base class with virtual methods (detected as polymorphic by default) struct Animal { virtual ~Animal() = default; virtual std::string speak() const = 0; }; struct Zoo { // Auto: type info written because Animal has virtual methods fory::field&lt;std::shared_ptr&lt;Animal&gt;, 0, fory::nullable&gt; animal; // Force non-dynamic: skip type info even though Animal has virtual methods // Use when you know the runtime type will always be exactly as declared fory::field&lt;std::shared_ptr&lt;Animal&gt;, 1, fory::nullable, fory::dynamic&lt;false&gt;&gt; fixed_animal; }; FORY_STRUCT(Zoo, animal, fixed_animal);   Valid for: std::shared_ptr&lt;T&gt;, std::unique_ptr&lt;T&gt;  ","version":"dev","tagName":"h3"},{"title":"Combining Tags‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#combining-tags","content":" Multiple tags can be combined for shared pointers and SharedWeak:  // Nullable + ref tracking fory::field&lt;std::shared_ptr&lt;Node&gt;, 0, fory::nullable, fory::ref&gt; link;   ","version":"dev","tagName":"h3"},{"title":"Type Rules‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#type-rules","content":" Type\tAllowed Options\tNullabilityPrimitives, strings\tNone\tUse std::optional&lt;T&gt; if nullable std::optional&lt;T&gt;\tNone\tInherently nullable std::shared_ptr&lt;T&gt;\tnullable, ref, dynamic&lt;V&gt;\tNon-null by default fory::serialization::SharedWeak&lt;T&gt;\tnullable, ref, dynamic&lt;V&gt;\tNon-null by default std::unique_ptr&lt;T&gt;\tnullable, dynamic&lt;V&gt;\tNon-null by default  ","version":"dev","tagName":"h2"},{"title":"Complete Example‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#complete-example","content":" #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; // Define a struct with various field configurations struct Document { // Required fields (non-nullable) fory::field&lt;std::string, 0&gt; title; fory::field&lt;int32_t, 1&gt; version; // Optional primitive using std::optional fory::field&lt;std::optional&lt;std::string&gt;, 2&gt; description; // Nullable pointer fory::field&lt;std::unique_ptr&lt;std::string&gt;, 3, fory::nullable&gt; metadata; // Reference-tracked shared pointer fory::field&lt;std::shared_ptr&lt;Document&gt;, 4, fory::ref&gt; parent; // Nullable + reference-tracked fory::field&lt;std::shared_ptr&lt;Document&gt;, 5, fory::nullable, fory::ref&gt; related; }; FORY_STRUCT(Document, title, version, description, metadata, parent, related); int main() { auto fory = Fory::builder().xlang(true).build(); fory.register_struct&lt;Document&gt;(100); Document doc; doc.title = &quot;My Document&quot;; doc.version = 1; doc.description = &quot;A sample document&quot;; doc.metadata = nullptr; // Allowed because nullable doc.parent = std::make_shared&lt;Document&gt;(); doc.parent-&gt;title = &quot;Parent Doc&quot;; doc.related = nullptr; // Allowed because nullable auto bytes = fory.serialize(doc).value(); auto decoded = fory.deserialize&lt;Document&gt;(bytes).value(); }   ","version":"dev","tagName":"h2"},{"title":"Compile-Time Validation‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#compile-time-validation","content":" Invalid configurations are caught at compile time:  // Error: nullable and not_null are mutually exclusive fory::field&lt;std::shared_ptr&lt;int&gt;, 0, fory::nullable, fory::not_null&gt; bad1; // Error: nullable only valid for smart pointers fory::field&lt;int32_t, 0, fory::nullable&gt; bad2; // Error: ref only valid for shared_ptr fory::field&lt;std::unique_ptr&lt;int&gt;, 0, fory::ref&gt; bad3; // Error: options not allowed for std::optional (inherently nullable) fory::field&lt;std::optional&lt;int&gt;, 0, fory::nullable&gt; bad4;   ","version":"dev","tagName":"h2"},{"title":"Backwards Compatibility‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#backwards-compatibility","content":" Existing structs without fory::field&lt;&gt; wrappers continue to work:  // Old style - still works struct LegacyPerson { std::string name; int32_t age; }; FORY_STRUCT(LegacyPerson, name, age); // New style with field metadata struct ModernPerson { fory::field&lt;std::string, 0&gt; name; fory::field&lt;int32_t, 1&gt; age; }; FORY_STRUCT(ModernPerson, name, age);   ","version":"dev","tagName":"h2"},{"title":"FORY_FIELD_TAGS Macro‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#fory_field_tags-macro","content":" The FORY_FIELD_TAGS macro provides a non-invasive way to add field metadata without modifying struct definitions. This is useful for:  Third-party types: Add metadata to types you don't ownClean structs: Keep struct definitions as pure C++Isolated dependencies: Confine Fory headers to serialization config files  ","version":"dev","tagName":"h2"},{"title":"Usage‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#usage","content":" // user_types.h - NO fory headers needed! struct Document { std::string title; int32_t version; std::optional&lt;std::string&gt; description; std::shared_ptr&lt;User&gt; author; std::shared_ptr&lt;User&gt; reviewer; std::shared_ptr&lt;Document&gt; parent; std::unique_ptr&lt;Data&gt; data; }; // serialization_config.cpp - fory config isolated here #include &quot;fory/serialization/fory.h&quot; #include &quot;user_types.h&quot; FORY_STRUCT(Document, title, version, description, author, reviewer, parent, data) FORY_FIELD_TAGS(Document, (title, 0), // string: non-nullable (version, 1), // int: non-nullable (description, 2), // optional: inherently nullable (author, 3), // shared_ptr: non-nullable (default) (reviewer, 4, nullable), // shared_ptr: nullable (parent, 5, ref), // shared_ptr: non-nullable, with ref tracking (data, 6, nullable) // unique_ptr: nullable )   ","version":"dev","tagName":"h3"},{"title":"FORY_FIELD_TAGS Options‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#fory_field_tags-options","content":" Field Type\tValid CombinationsPrimitives, strings\t(field, id) only std::optional&lt;T&gt;\t(field, id) only std::shared_ptr&lt;T&gt;\t(field, id), (field, id, nullable), (field, id, ref), (field, id, nullable, ref) std::unique_ptr&lt;T&gt;\t(field, id), (field, id, nullable)  ","version":"dev","tagName":"h3"},{"title":"FORY_FIELD_CONFIG Macro‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#fory_field_config-macro","content":" The FORY_FIELD_CONFIG macro is the most powerful and flexible way to configure field-level serialization. It provides:  Builder pattern API: Fluent, chainable configuration with F(id).option1().option2()Encoding control: Specify how unsigned integers are encoded (varint, fixed, tagged)Compile-time verification: Field names are verified against member pointersCross-language compatibility: Configure encoding to match other languages (Java, Rust, etc.)  ","version":"dev","tagName":"h2"},{"title":"Basic Syntax‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#basic-syntax","content":" FORY_FIELD_CONFIG(StructType, (field1, fory::F(0)), // Simple: just ID (field2, fory::F(1).nullable()), // With nullable (field3, fory::F(2).varint()), // With encoding (field4, fory::F(3).nullable().ref()), // Multiple options (field5, 4) // Backward compatible: integer ID );   ","version":"dev","tagName":"h3"},{"title":"The F() Builder‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#the-f-builder","content":" The fory::F(id) factory creates a FieldMeta object that supports method chaining:  fory::F(0) // Create with field ID 0 .nullable() // Mark as nullable .ref() // Enable reference tracking .varint() // Use variable-length encoding .fixed() // Use fixed-size encoding .tagged() // Use tagged encoding .dynamic(false) // skip type info (no dynamic dispatch) .dynamic(true) // Force type info (enable dynamic dispatch) .compress(false) // Disable compression   Tip: To use F() without the fory:: prefix, add a using declaration:  using fory::F; FORY_FIELD_CONFIG(MyStruct, (field1, F(0).varint()), // No prefix needed (field2, F(1).nullable()) );   ","version":"dev","tagName":"h3"},{"title":"Encoding Options for Unsigned Integers‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#encoding-options-for-unsigned-integers","content":" For uint32_t and uint64_t fields, you can specify the wire encoding:  Method\tType ID\tDescription\tUse Case.varint()\tVAR_UINT32/64\tVariable-length encoding (1-5 or 1-10 bytes)\tValues typically small .fixed()\tUINT32/64\tFixed-size encoding (always 4 or 8 bytes)\tValues uniformly distributed .tagged()\tTAGGED_UINT64\tTagged hybrid encoding with size hint (uint64)\tMixed small and large values (uint64)  Note: uint8_t and uint16_t always use fixed encoding (UINT8, UINT16).  ","version":"dev","tagName":"h3"},{"title":"Complete Example‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#complete-example-1","content":" #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; // Define struct with unsigned integer fields struct MetricsData { // Counters - often small values, use varint for space efficiency uint32_t request_count; uint64_t bytes_sent; // IDs - uniformly distributed, use fixed for consistent performance uint32_t user_id; uint64_t session_id; // Timestamps - use tagged encoding for mixed value ranges uint64_t created_at; // Nullable fields std::optional&lt;uint32_t&gt; error_count; std::optional&lt;uint64_t&gt; last_access_time; }; FORY_STRUCT(MetricsData, request_count, bytes_sent, user_id, session_id, created_at, error_count, last_access_time); // Configure field encoding FORY_FIELD_CONFIG(MetricsData, // Small counters - varint saves space (request_count, fory::F(0).varint()), (bytes_sent, fory::F(1).varint()), // IDs - fixed for consistent performance (user_id, fory::F(2).fixed()), (session_id, fory::F(3).fixed()), // Timestamp - tagged encoding (created_at, fory::F(4).tagged()), // Nullable fields (error_count, fory::F(5).nullable().varint()), (last_access_time, fory::F(6).nullable().tagged()) ); int main() { auto fory = Fory::builder().xlang(true).build(); fory.register_struct&lt;MetricsData&gt;(100); MetricsData data{ .request_count = 42, .bytes_sent = 1024, .user_id = 12345678, .session_id = 9876543210, .created_at = 1704067200000000000ULL, // 2024-01-01 in nanoseconds .error_count = 3, .last_access_time = std::nullopt }; auto bytes = fory.serialize(data).value(); auto decoded = fory.deserialize&lt;MetricsData&gt;(bytes).value(); }   ","version":"dev","tagName":"h3"},{"title":"Cross-Language Compatibility‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#cross-language-compatibility","content":" When serializing data to be read by other languages, use FORY_FIELD_CONFIG to match their encoding expectations:  Java Compatibility:  // Java uses these type IDs for unsigned integers: // - Byte (u8): UINT8 (fixed) // - Short (u16): UINT16 (fixed) // - Integer (u32): VAR_UINT32 (varint) or UINT32 (fixed) // - Long (u64): VAR_UINT64 (varint), UINT64 (fixed), or TAGGED_UINT64 struct JavaCompatible { uint8_t byte_field; // Maps to Java Byte uint16_t short_field; // Maps to Java Short uint32_t int_var_field; // Maps to Java Integer with varint uint32_t int_fixed_field; // Maps to Java Integer with fixed uint64_t long_var_field; // Maps to Java Long with varint uint64_t long_tagged; // Maps to Java Long with tagged }; FORY_STRUCT(JavaCompatible, byte_field, short_field, int_var_field, int_fixed_field, long_var_field, long_tagged); FORY_FIELD_CONFIG(JavaCompatible, (byte_field, fory::F(0)), // UINT8 (auto) (short_field, fory::F(1)), // UINT16 (auto) (int_var_field, fory::F(2).varint()), // VAR_UINT32 (int_fixed_field, fory::F(3).fixed()), // UINT32 (long_var_field, fory::F(4).varint()), // VAR_UINT64 (long_tagged, fory::F(5).tagged()) // TAGGED_UINT64 );   ","version":"dev","tagName":"h3"},{"title":"Schema Evolution with FORY_FIELD_CONFIG‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#schema-evolution-with-fory_field_config","content":" In compatible mode, fields can have different nullability between sender and receiver:  // Version 1: All fields non-nullable struct DataV1 { uint32_t id; uint64_t timestamp; }; FORY_STRUCT(DataV1, id, timestamp); FORY_FIELD_CONFIG(DataV1, (id, fory::F(0).varint()), (timestamp, fory::F(1).tagged()) ); // Version 2: Added nullable fields struct DataV2 { uint32_t id; uint64_t timestamp; std::optional&lt;uint32_t&gt; version; // New nullable field }; FORY_STRUCT(DataV2, id, timestamp, version); FORY_FIELD_CONFIG(DataV2, (id, fory::F(0).varint()), (timestamp, fory::F(1).tagged()), (version, fory::F(2).nullable().varint()) // New field with nullable );   ","version":"dev","tagName":"h3"},{"title":"FORY_FIELD_CONFIG Options Reference‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#fory_field_config-options-reference","content":" Method\tDescription\tValid For.nullable()\tMark field as nullable\tSmart pointers, primitives .ref()\tEnable reference tracking\tstd::shared_ptr, fory::serialization::SharedWeak .dynamic(true)\tForce type info to be written (dynamic dispatch)\tSmart pointers .dynamic(false)\tskip type info (use declared type directly)\tSmart pointers .varint()\tUse variable-length encoding\tuint32_t, uint64_t .fixed()\tUse fixed-size encoding\tuint32_t, uint64_t .tagged()\tUse tagged hybrid encoding\tuint64_t only .compress(v)\tEnable/disable field compression\tAll types  ","version":"dev","tagName":"h3"},{"title":"Default Values‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#default-values","content":" Nullable: Only std::optional&lt;T&gt; is nullable by default; all other types (including std::shared_ptr) are non-nullableRef tracking: Enabled by default for std::shared_ptr&lt;T&gt; and fory::serialization::SharedWeak&lt;T&gt;, disabled for other types unless configured  You need to configure fields when:  A field can be null (use std::optional&lt;T&gt; or mark with nullable())A field needs reference tracking for shared/circular objects (use ref())Integer types need specific encoding for cross-language compatibilityYou want to reduce metadata size (use field IDs)  // Xlang mode: explicit configuration required struct User { std::string name; // Non-nullable by default std::optional&lt;std::string&gt; email; // Nullable (std::optional) std::shared_ptr&lt;User&gt; friend_ptr; // Ref tracking by default }; FORY_STRUCT(User, name, email, friend_ptr); FORY_FIELD_CONFIG(User, (name, fory::F(0)), (email, fory::F(1)), // nullable implicit for optional (friend_ptr, fory::F(2).nullable().ref()) // explicit nullable + ref );   ","version":"dev","tagName":"h2"},{"title":"Default Values Summary‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#default-values-summary","content":" Type\tDefault Nullable\tDefault Ref TrackingPrimitives, string\tfalse\tfalse std::optional&lt;T&gt;\ttrue\tfalse std::shared_ptr&lt;T&gt;\tfalse\ttrue fory::serialization::SharedWeak&lt;T&gt;\tfalse\ttrue std::unique_ptr&lt;T&gt;\tfalse\tfalse  ","version":"dev","tagName":"h3"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/cpp/field_configuration#related-topics","content":" Type Registration - Registering types with FORY_STRUCTSchema Evolution - Using tag IDs for schema evolutionConfiguration - Enabling reference tracking globallyCross-Language - Interoperability with Java, Rust, Python ","version":"dev","tagName":"h2"},{"title":"Row Format","type":0,"sectionRef":"#","url":"/docs/next/guide/cpp/row_format","content":"","keywords":"","version":"dev"},{"title":"Overview‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#overview","content":" Apache Fory‚Ñ¢ Row Format is a binary format optimized for:  Random Access: Read any field without deserializing the entire objectZero-copy: Direct memory access without data copyingCache-Friendly: Contiguous memory layout for CPU cache efficiencyColumnar Conversion: Easy conversion to Apache Arrow formatPartial Serialization: Serialize only needed fields  ","version":"dev","tagName":"h2"},{"title":"When to Use Row Format‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#when-to-use-row-format","content":" Use Case\tRow Format\tObject GraphAnalytics/OLAP\t‚úÖ\t‚ùå Random field access\t‚úÖ\t‚ùå Full object serialization\t‚ùå\t‚úÖ Complex object graphs\t‚ùå\t‚úÖ Reference tracking\t‚ùå\t‚úÖ Cross-language (simple types)\t‚úÖ\t‚úÖ  ","version":"dev","tagName":"h2"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#quick-start","content":" #include &quot;fory/encoder/row_encoder.h&quot; #include &quot;fory/row/writer.h&quot; using namespace fory::row; using namespace fory::row::encoder; struct Person { int32_t id; std::string name; float score; FORY_STRUCT(Person, id, name, score); }; int main() { // Create encoder RowEncoder&lt;Person&gt; encoder; // encode a person Person person{1, &quot;Alice&quot;, 95.5f}; encoder.encode(person); // get the encoded row auto row = encoder.get_writer().to_row(); // Random access to fields int32_t id = row-&gt;get_int32(0); std::string name = row-&gt;get_string(1); float score = row-&gt;get_float(2); assert(id == 1); assert(name == &quot;Alice&quot;); assert(score == 95.5f); return 0; }   ","version":"dev","tagName":"h2"},{"title":"Row Encoder‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#row-encoder","content":" ","version":"dev","tagName":"h2"},{"title":"Basic Usage‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#basic-usage","content":" The RowEncoder&lt;T&gt; template class provides type-safe encoding:  #include &quot;fory/encoder/row_encoder.h&quot; struct Point { double x; double y; FORY_STRUCT(Point, x, y); }; // Create encoder RowEncoder&lt;Point&gt; encoder; // Access schema (for inspection) const Schema&amp; schema = encoder.get_schema(); std::cout &lt;&lt; &quot;Fields: &quot; &lt;&lt; schema.field_names().size() &lt;&lt; std::endl; // encode value Point p{1.0, 2.0}; encoder.encode(p); // get result as Row auto row = encoder.get_writer().to_row();   ","version":"dev","tagName":"h3"},{"title":"Nested Structs‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#nested-structs","content":" struct Address { std::string city; std::string country; FORY_STRUCT(Address, city, country); }; struct Person { std::string name; Address address; FORY_STRUCT(Person, name, address); }; // encode nested struct RowEncoder&lt;Person&gt; encoder; Person person{&quot;Alice&quot;, {&quot;New York&quot;, &quot;USA&quot;}}; encoder.encode(person); auto row = encoder.get_writer().to_row(); std::string name = row-&gt;get_string(0); // Access nested struct auto address_row = row-&gt;get_struct(1); std::string city = address_row-&gt;get_string(0); std::string country = address_row-&gt;get_string(1);   ","version":"dev","tagName":"h3"},{"title":"Arrays / Lists‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#arrays--lists","content":" struct Record { std::vector&lt;int32_t&gt; values; std::string label; FORY_STRUCT(Record, values, label); }; RowEncoder&lt;Record&gt; encoder; Record record{{1, 2, 3, 4, 5}, &quot;test&quot;}; encoder.encode(record); auto row = encoder.get_writer().to_row(); auto array = row-&gt;get_array(0); int count = array-&gt;num_elements(); for (int i = 0; i &lt; count; i++) { int32_t value = array-&gt;get_int32(i); }   ","version":"dev","tagName":"h3"},{"title":"Encoding Arrays Directly‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#encoding-arrays-directly","content":" // encode a vector directly (not inside a struct) std::vector&lt;Person&gt; people{ {&quot;Alice&quot;, {&quot;NYC&quot;, &quot;USA&quot;}}, {&quot;Bob&quot;, {&quot;London&quot;, &quot;UK&quot;}} }; RowEncoder&lt;decltype(people)&gt; encoder; encoder.encode(people); // get array data auto array = encoder.get_writer().copy_to_array_data(); auto first_person = array-&gt;get_struct(0); std::string first_name = first_person-&gt;get_string(0);   ","version":"dev","tagName":"h3"},{"title":"Row Data Access‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#row-data-access","content":" ","version":"dev","tagName":"h2"},{"title":"Row Class‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#row-class","content":" The Row class provides random access to struct fields:  class Row { public: // Null check bool is_null_at(int i) const; // Primitive getters bool get_boolean(int i) const; int8_t get_int8(int i) const; int16_t get_int16(int i) const; int32_t get_int32(int i) const; int64_t get_int64(int i) const; float get_float(int i) const; double get_double(int i) const; // String/binary getter std::string get_string(int i) const; std::vector&lt;uint8_t&gt; get_binary(int i) const; // Nested types std::shared_ptr&lt;Row&gt; get_struct(int i) const; std::shared_ptr&lt;ArrayData&gt; get_array(int i) const; std::shared_ptr&lt;MapData&gt; get_map(int i) const; // Metadata int num_fields() const; SchemaPtr schema() const; // Debug std::string to_string() const; };   ","version":"dev","tagName":"h3"},{"title":"ArrayData Class‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#arraydata-class","content":" The ArrayData class provides access to list/array elements:  class ArrayData { public: // Null check bool is_null_at(int i) const; // Element count int num_elements() const; // Primitive getters (same as Row) int32_t get_int32(int i) const; // ... other primitives // String getter std::string get_string(int i) const; // Nested types std::shared_ptr&lt;Row&gt; get_struct(int i) const; std::shared_ptr&lt;ArrayData&gt; get_array(int i) const; std::shared_ptr&lt;MapData&gt; get_map(int i) const; // Type info ListTypePtr type() const; };   ","version":"dev","tagName":"h3"},{"title":"MapData Class‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#mapdata-class","content":" The MapData class provides access to map key-value pairs:  class MapData { public: // Element count int num_elements(); // Access keys and values as arrays std::shared_ptr&lt;ArrayData&gt; keys_array(); std::shared_ptr&lt;ArrayData&gt; values_array(); // Type info MapTypePtr type(); };   ","version":"dev","tagName":"h3"},{"title":"Schema and Types‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#schema-and-types","content":" ","version":"dev","tagName":"h2"},{"title":"Schema Definition‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#schema-definition","content":" Schemas define the structure of row data:  #include &quot;fory/row/schema.h&quot; using namespace fory::row; // Create schema programmatically auto person_schema = schema({ field(&quot;id&quot;, int32()), field(&quot;name&quot;, utf8()), field(&quot;score&quot;, float32()), field(&quot;active&quot;, boolean()) }); // Access schema info for (const auto&amp; f : person_schema-&gt;fields()) { std::cout &lt;&lt; f-&gt;name() &lt;&lt; &quot;: &quot; &lt;&lt; f-&gt;type()-&gt;name() &lt;&lt; std::endl; }   ","version":"dev","tagName":"h3"},{"title":"Type System‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#type-system","content":" Available types for row format:  // Primitive types DataTypePtr boolean(); // bool DataTypePtr int8(); // int8_t DataTypePtr int16(); // int16_t DataTypePtr int32(); // int32_t DataTypePtr int64(); // int64_t DataTypePtr float32(); // float DataTypePtr float64(); // double // String and binary DataTypePtr utf8(); // std::string DataTypePtr binary(); // std::vector&lt;uint8_t&gt; // Complex types DataTypePtr list(DataTypePtr element_type); DataTypePtr map(DataTypePtr key_type, DataTypePtr value_type); DataTypePtr struct_(std::vector&lt;FieldPtr&gt; fields);   ","version":"dev","tagName":"h3"},{"title":"Type Inference‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#type-inference","content":" The RowEncodeTrait template automatically infers types:  // Type inference for primitives RowEncodeTrait&lt;int32_t&gt;::Type(); // Returns int32() RowEncodeTrait&lt;float&gt;::Type(); // Returns float32() RowEncodeTrait&lt;std::string&gt;::Type(); // Returns utf8() // Type inference for collections RowEncodeTrait&lt;std::vector&lt;int32_t&gt;&gt;::Type(); // Returns list(int32()) // Type inference for maps RowEncodeTrait&lt;std::map&lt;std::string, int32_t&gt;&gt;::Type(); // Returns map(utf8(), int32()) // Type inference for structs (requires FORY_STRUCT) RowEncodeTrait&lt;Person&gt;::Type(); // Returns struct_({...}) RowEncodeTrait&lt;Person&gt;::Schema(); // Returns schema({...})   ","version":"dev","tagName":"h3"},{"title":"Row Writer‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#row-writer","content":" ","version":"dev","tagName":"h2"},{"title":"RowWriter‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#rowwriter","content":" For manual row construction:  #include &quot;fory/row/writer.h&quot; // Create schema auto my_schema = schema({ field(&quot;x&quot;, int32()), field(&quot;y&quot;, float64()), field(&quot;name&quot;, utf8()) }); // Create writer RowWriter writer(my_schema); writer.reset(); // write fields writer.write(0, 42); // x = 42 writer.write(1, 3.14); // y = 3.14 writer.write_string(2, &quot;test&quot;); // name = &quot;test&quot; // get result auto row = writer.to_row();   ","version":"dev","tagName":"h3"},{"title":"ArrayWriter‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#arraywriter","content":" For manual array construction:  // Create array type auto array_type = list(int32()); // Create writer ArrayWriter writer(array_type); writer.reset(5); // 5 elements // write elements for (int i = 0; i &lt; 5; i++) { writer.write(i, i * 10); } // get result auto array = writer.copy_to_array_data();   ","version":"dev","tagName":"h3"},{"title":"Null Values‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#null-values","content":" // Set null at specific index writer.set_null_at(2); // Field 2 is null // Check null when reading if (!row-&gt;is_null_at(2)) { std::string value = row-&gt;get_string(2); }   ","version":"dev","tagName":"h3"},{"title":"Memory Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#memory-layout","content":" ","version":"dev","tagName":"h2"},{"title":"Row Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#row-layout","content":" +------------------+--------------------+--------------------+ | Null Bitmap | Fixed-Size Data | Variable-Size Data | +------------------+--------------------+--------------------+ | ceil(n/8) B | 8 * n bytes | variable | +------------------+--------------------+--------------------+   Null Bitmap: One bit per field, indicates null valuesFixed-Size Data: 8 bytes per field (primitives stored directly, offset+size for variable)Variable-Size Data: Strings, arrays, nested structs  ","version":"dev","tagName":"h3"},{"title":"Array Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#array-layout","content":" +------------+------------------+--------------------+--------------------+ | Num Elems | Null Bitmap | Fixed-Size Data | Variable-Size Data | +------------+------------------+--------------------+--------------------+ | 8 bytes | ceil(n/8) bytes | elem_size * n | variable | +------------+------------------+--------------------+--------------------+   ","version":"dev","tagName":"h3"},{"title":"Map Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#map-layout","content":" +------------------+------------------+ | Keys Array | Values Array | +------------------+------------------+   ","version":"dev","tagName":"h3"},{"title":"Performance Tips‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#performance-tips","content":" ","version":"dev","tagName":"h2"},{"title":"1. Reuse Encoders‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#1-reuse-encoders","content":" RowEncoder&lt;Person&gt; encoder; // encode multiple records for (const auto&amp; person : people) { encoder.encode(person); auto row = encoder.get_writer().to_row(); // Process row... }   ","version":"dev","tagName":"h3"},{"title":"2. Pre-allocate Buffer‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#2-pre-allocate-buffer","content":" // get buffer reference for pre-allocation auto&amp; buffer = encoder.get_writer().buffer(); buffer-&gt;reserve(expected_size);   ","version":"dev","tagName":"h3"},{"title":"3. Batch Processing‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#3-batch-processing","content":" // Process in batches for better cache utilization std::vector&lt;Person&gt; batch; batch.reserve(BATCH_SIZE); while (has_more()) { batch.clear(); fill_batch(batch); for (const auto&amp; person : batch) { encoder.encode(person); process(encoder.get_writer().to_row()); } }   ","version":"dev","tagName":"h3"},{"title":"4. Zero-copy Reading‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#4-zero-copy-reading","content":" // Point to existing buffer (zero-copy) Row row(schema); row.point_to(buffer, offset, size); // Access fields directly from buffer int32_t id = row.get_int32(0);   ","version":"dev","tagName":"h3"},{"title":"Supported Types Summary‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#supported-types-summary","content":" C++ Type\tRow Type\tFixed Sizebool\tboolean()\t1 byte int8_t\tint8()\t1 byte int16_t\tint16()\t2 bytes int32_t\tint32()\t4 bytes int64_t\tint64()\t8 bytes float\tfloat32()\t4 bytes double\tfloat64()\t8 bytes std::string\tutf8()\tVariable std::vector&lt;T&gt;\tlist(T)\tVariable std::map&lt;K,V&gt;\tmap(K,V)\tVariable std::optional&lt;T&gt;\tInner type\tNullable Struct (FORY_STRUCT)\tstruct_({...})\tVariable  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/cpp/row_format#related-topics","content":" Basic Serialization - Object graph serializationConfiguration - Builder optionsSupported Types - All supported types ","version":"dev","tagName":"h2"},{"title":"Schema Evolution","type":0,"sectionRef":"#","url":"/docs/next/guide/cpp/schema_evolution","content":"","keywords":"","version":"dev"},{"title":"Compatible Mode‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/cpp/schema_evolution#compatible-mode","content":" Enable schema evolution with compatible(true):  #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; // Version 1: Original schema struct PersonV1 { std::string name; int32_t age; }; FORY_STRUCT(PersonV1, name, age); // Version 2: Added email field struct PersonV2 { std::string name; int32_t age; std::string email; // NEW FIELD }; FORY_STRUCT(PersonV2, name, age, email); int main() { // Create separate Fory instances for each schema version auto fory_v1 = Fory::builder() .compatible(true) // Enable schema evolution .xlang(true) .build(); auto fory_v2 = Fory::builder() .compatible(true) .xlang(true) .build(); // Register with the SAME type ID for schema evolution constexpr uint32_t PERSON_TYPE_ID = 100; fory_v1.register_struct&lt;PersonV1&gt;(PERSON_TYPE_ID); fory_v2.register_struct&lt;PersonV2&gt;(PERSON_TYPE_ID); // Serialize with V1 PersonV1 v1{&quot;Alice&quot;, 30}; auto bytes = fory_v1.serialize(v1).value(); // Deserialize as V2 - email gets default value (empty string) auto v2 = fory_v2.deserialize&lt;PersonV2&gt;(bytes).value(); assert(v2.name == &quot;Alice&quot;); assert(v2.age == 30); assert(v2.email == &quot;&quot;); // Default value for missing field return 0; }   ","version":"dev","tagName":"h2"},{"title":"Disable Evolution for Stable Structs‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/cpp/schema_evolution#disable-evolution-for-stable-structs","content":" If a struct schema is stable and will not change, you can disable evolution for that struct to avoid compatible metadata overhead. Use FORY_STRUCT_EVOLVING after FORY_STRUCT:  struct StableMessage { int32_t id; }; FORY_STRUCT(StableMessage, id); FORY_STRUCT_EVOLVING(StableMessage, false);   ","version":"dev","tagName":"h3"},{"title":"Schema Evolution Features‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/cpp/schema_evolution#schema-evolution-features","content":" Compatible mode supports the following schema changes:  Change Type\tSupport\tBehaviorAdd new fields\t‚úÖ\tMissing fields use default values Remove fields\t‚úÖ\tExtra fields are skipped Reorder fields\t‚úÖ\tFields matched by name, not position Change nullability\t‚úÖ\tT ‚Üî std::optional&lt;T&gt; Change field types\t‚ùå\tTypes must be compatible Rename fields\t‚ùå\tField names must match (case-sensitive)  ","version":"dev","tagName":"h2"},{"title":"Adding Fields (Backward Compatibility)‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/cpp/schema_evolution#adding-fields-backward-compatibility","content":" When deserializing old data with a new schema that has additional fields:  // Old schema (V1) struct ProductV1 { std::string name; double price; }; FORY_STRUCT(ProductV1, name, price); // New schema (V2) with additional fields struct ProductV2 { std::string name; double price; std::vector&lt;std::string&gt; tags; // NEW std::map&lt;std::string, std::string&gt; attributes; // NEW }; FORY_STRUCT(ProductV2, name, price, tags, attributes); // Serialize V1 ProductV1 v1{&quot;Laptop&quot;, 999.99}; auto bytes = fory_v1.serialize(v1).value(); // Deserialize as V2 auto v2 = fory_v2.deserialize&lt;ProductV2&gt;(bytes).value(); assert(v2.name == &quot;Laptop&quot;); assert(v2.price == 999.99); assert(v2.tags.empty()); // Default: empty vector assert(v2.attributes.empty()); // Default: empty map   ","version":"dev","tagName":"h2"},{"title":"Removing Fields (Forward Compatibility)‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/cpp/schema_evolution#removing-fields-forward-compatibility","content":" When deserializing new data with an old schema that has fewer fields:  // Full schema struct UserFull { int64_t id; std::string username; std::string email; std::string password_hash; int32_t login_count; }; FORY_STRUCT(UserFull, id, username, email, password_hash, login_count); // Minimal schema (removed 3 fields) struct UserMinimal { int64_t id; std::string username; }; FORY_STRUCT(UserMinimal, id, username); // Serialize full version UserFull full{12345, &quot;johndoe&quot;, &quot;john@example.com&quot;, &quot;hash123&quot;, 42}; auto bytes = fory_full.serialize(full).value(); // Deserialize as minimal - extra fields are skipped auto minimal = fory_minimal.deserialize&lt;UserMinimal&gt;(bytes).value(); assert(minimal.id == 12345); assert(minimal.username == &quot;johndoe&quot;); // email, password_hash, login_count are skipped   ","version":"dev","tagName":"h2"},{"title":"Field Reordering‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/cpp/schema_evolution#field-reordering","content":" In compatible mode, fields are matched by name, not by position:  // Original field order struct ConfigOriginal { std::string host; int32_t port; bool enable_ssl; std::string protocol; }; FORY_STRUCT(ConfigOriginal, host, port, enable_ssl, protocol); // Reordered fields struct ConfigReordered { bool enable_ssl; // Moved to first std::string protocol; // Moved to second std::string host; // Moved to third int32_t port; // Moved to last }; FORY_STRUCT(ConfigReordered, enable_ssl, protocol, host, port); // Serialize with original order ConfigOriginal orig{&quot;localhost&quot;, 8080, true, &quot;https&quot;}; auto bytes = fory_orig.serialize(orig).value(); // Deserialize with different field order - works correctly auto reordered = fory_reord.deserialize&lt;ConfigReordered&gt;(bytes).value(); assert(reordered.host == &quot;localhost&quot;); assert(reordered.port == 8080); assert(reordered.enable_ssl == true); assert(reordered.protocol == &quot;https&quot;);   ","version":"dev","tagName":"h2"},{"title":"Nested Struct Evolution‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/cpp/schema_evolution#nested-struct-evolution","content":" Schema evolution works recursively for nested structs:  // V1 Address struct AddressV1 { std::string street; std::string city; }; FORY_STRUCT(AddressV1, street, city); // V2 Address with new fields struct AddressV2 { std::string street; std::string city; std::string country; // NEW std::string zipcode; // NEW }; FORY_STRUCT(AddressV2, street, city, country, zipcode); // V1 Employee with V1 Address struct EmployeeV1 { std::string name; AddressV1 home_address; }; FORY_STRUCT(EmployeeV1, name, home_address); // V2 Employee with V2 Address and new field struct EmployeeV2 { std::string name; AddressV2 home_address; // Nested struct evolved std::string employee_id; // NEW }; FORY_STRUCT(EmployeeV2, name, home_address, employee_id); // Register types with same IDs constexpr uint32_t ADDRESS_TYPE_ID = 100; constexpr uint32_t EMPLOYEE_TYPE_ID = 101; fory_v1.register_struct&lt;AddressV1&gt;(ADDRESS_TYPE_ID); fory_v1.register_struct&lt;EmployeeV1&gt;(EMPLOYEE_TYPE_ID); fory_v2.register_struct&lt;AddressV2&gt;(ADDRESS_TYPE_ID); fory_v2.register_struct&lt;EmployeeV2&gt;(EMPLOYEE_TYPE_ID); // Serialize V1 EmployeeV1 emp_v1{&quot;Jane Doe&quot;, {&quot;123 Main St&quot;, &quot;NYC&quot;}}; auto bytes = fory_v1.serialize(emp_v1).value(); // Deserialize as V2 auto emp_v2 = fory_v2.deserialize&lt;EmployeeV2&gt;(bytes).value(); assert(emp_v2.name == &quot;Jane Doe&quot;); assert(emp_v2.home_address.street == &quot;123 Main St&quot;); assert(emp_v2.home_address.city == &quot;NYC&quot;); assert(emp_v2.home_address.country == &quot;&quot;); // Default assert(emp_v2.home_address.zipcode == &quot;&quot;); // Default assert(emp_v2.employee_id == &quot;&quot;); // Default   ","version":"dev","tagName":"h2"},{"title":"Bidirectional Evolution‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/cpp/schema_evolution#bidirectional-evolution","content":" Schema evolution works in both directions:  // V2 -&gt; V1 (downgrade) PersonV2 v2{&quot;Charlie&quot;, 35, &quot;charlie@example.com&quot;}; auto bytes = fory_v2.serialize(v2).value(); auto v1 = fory_v1.deserialize&lt;PersonV1&gt;(bytes).value(); assert(v1.name == &quot;Charlie&quot;); assert(v1.age == 35); // email field is discarded during deserialization   ","version":"dev","tagName":"h2"},{"title":"Default Values‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/cpp/schema_evolution#default-values","content":" When fields are missing, C++ default initialization is used:  Type\tDefault Valueint8_t, int16_t...\t0 float, double\t0.0 bool\tfalse std::string\t&quot;&quot; std::vector&lt;T&gt;\tEmpty vector std::map&lt;K,V&gt;\tEmpty map std::set&lt;T&gt;\tEmpty set std::optional&lt;T&gt;\tstd::nullopt Struct types\tDefault-constructed  ","version":"dev","tagName":"h2"},{"title":"Schema Consistent Mode (Default)‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/cpp/schema_evolution#schema-consistent-mode-default","content":" Without compatible mode, schemas must match exactly:  // Strict mode (default) auto fory = Fory::builder() .compatible(false) // Default: schema must match .xlang(true) .build(); // Serialization/deserialization requires identical schemas // Schema mismatches may cause errors or undefined behavior   Use SchemaConsistent mode when:  Schemas are guaranteed to match (same binary version)Maximum performance is required (less metadata overhead)You control both serialization and deserialization  Use Compatible mode when:  Schemas may evolve independentlyCross-version compatibility is requiredDifferent services may have different schema versions  ","version":"dev","tagName":"h2"},{"title":"Type ID Requirements‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/cpp/schema_evolution#type-id-requirements","content":" For schema evolution to work:  Same Type ID: Different versions of the same struct must use the same type IDConsistent IDs: Type IDs must be consistent across all Fory instancesRegister All Versions: Each Fory instance registers its own struct version  constexpr uint32_t PERSON_TYPE_ID = 100; // Instance 1 uses PersonV1 fory_v1.register_struct&lt;PersonV1&gt;(PERSON_TYPE_ID); // Instance 2 uses PersonV2 fory_v2.register_struct&lt;PersonV2&gt;(PERSON_TYPE_ID); // Same type ID enables schema evolution   ","version":"dev","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/cpp/schema_evolution#best-practices","content":" ","version":"dev","tagName":"h2"},{"title":"1. Plan for Evolution‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/cpp/schema_evolution#1-plan-for-evolution","content":" Design schemas with future changes in mind:  // Good: Use optional for fields that might be removed struct Config { std::string host; int32_t port; std::optional&lt;std::string&gt; deprecated_field; // Can be removed later };   ","version":"dev","tagName":"h3"},{"title":"2. Use Meaningful Default Values‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/cpp/schema_evolution#2-use-meaningful-default-values","content":" Consider what default values make sense for new fields:  struct Settings { int32_t timeout_ms; // Default: 0 (might want a sensible default) bool enabled; // Default: false std::string mode; // Default: &quot;&quot; (might want &quot;default&quot;) };   ","version":"dev","tagName":"h3"},{"title":"3. Document Schema Versions‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/cpp/schema_evolution#3-document-schema-versions","content":" Track schema changes for debugging:  // V1: Initial schema (2024-01-01) // V2: Added email field (2024-02-01) // V3: Added phone, address fields (2024-03-01)   ","version":"dev","tagName":"h3"},{"title":"4. Test Evolution Paths‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/cpp/schema_evolution#4-test-evolution-paths","content":" Test both upgrade and downgrade scenarios:  // Test V1 -&gt; V2 // Test V2 -&gt; V1 // Test V1 -&gt; V3 // Test V3 -&gt; V1   ","version":"dev","tagName":"h3"},{"title":"Cross-Language Schema Evolution‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/cpp/schema_evolution#cross-language-schema-evolution","content":" Schema evolution works across languages when using xlang mode:  // C++ with compatible mode auto fory = Fory::builder() .compatible(true) .xlang(true) .build();   // Java with compatible mode Fory fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .withLanguage(Language.XLANG) .build();   Both instances can exchange data even with different schema versions.  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/cpp/schema_evolution#related-topics","content":" Configuration - Enabling compatible modeType Registration - Type ID managementCross-Language - Cross-language considerations ","version":"dev","tagName":"h2"},{"title":"Supported Types","type":0,"sectionRef":"#","url":"/docs/next/guide/cpp/supported_types","content":"","keywords":"","version":"dev"},{"title":"Primitive Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/cpp/supported_types#primitive-types","content":" All C++ primitive types are supported with efficient binary encoding:  Type\tSize\tFory TypeId\tNotesbool\t1 byte\tBOOL\tTrue/false int8_t\t1 byte\tINT8\tSigned byte uint8_t\t1 byte\tINT8\tUnsigned byte int16_t\t2 byte\tINT16\tSigned short uint16_t\t2 byte\tINT16\tUnsigned short int32_t\t4 byte\tINT32\tSigned integer uint32_t\t4 byte\tINT32\tUnsigned integer int64_t\t8 byte\tINT64\tSigned long uint64_t\t8 byte\tINT64\tUnsigned long float\t4 byte\tFLOAT32\tIEEE 754 single double\t8 byte\tFLOAT64\tIEEE 754 double char\t1 byte\tINT8\tCharacter (as signed) char16_t\t2 byte\tINT16\t16-bits characters char32_t\t4 byte\tINT32\t32-bits characters  int32_t value = 42; auto bytes = fory.serialize(value).value(); auto decoded = fory.deserialize&lt;int32_t&gt;(bytes).value(); assert(value == decoded);   ","version":"dev","tagName":"h2"},{"title":"String Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/cpp/supported_types#string-types","content":" Type\tFory TypeId\tNotesstd::string\tSTRING\tUTF-8 encoded std::string_view\tSTRING\tZero-copy view (read) std::u16string\tSTRING\tUTF-16 (converted) binary\tBINARY\tRaw bytes without length  std::string text = &quot;Hello, World!&quot;; auto bytes = fory.serialize(text).value(); auto decoded = fory.deserialize&lt;std::string&gt;(bytes).value(); assert(text == decoded);   ","version":"dev","tagName":"h2"},{"title":"Collection Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/cpp/supported_types#collection-types","content":" ","version":"dev","tagName":"h2"},{"title":"Vector / List‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/cpp/supported_types#vector--list","content":" std::vector&lt;T&gt; for any serializable element type:  std::vector&lt;int32_t&gt; numbers{1, 2, 3, 4, 5}; auto bytes = fory.serialize(numbers).value(); auto decoded = fory.deserialize&lt;std::vector&lt;int32_t&gt;&gt;(bytes).value(); // Nested vectors std::vector&lt;std::vector&lt;std::string&gt;&gt; nested{ {&quot;a&quot;, &quot;b&quot;}, {&quot;c&quot;, &quot;d&quot;, &quot;e&quot;} };   ","version":"dev","tagName":"h3"},{"title":"Set‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/cpp/supported_types#set","content":" std::set&lt;T&gt; and std::unordered_set&lt;T&gt;:  std::set&lt;std::string&gt; tags{&quot;cpp&quot;, &quot;serialization&quot;, &quot;fory&quot;}; auto bytes = fory.serialize(tags).value(); auto decoded = fory.deserialize&lt;std::set&lt;std::string&gt;&gt;(bytes).value(); std::unordered_set&lt;int32_t&gt; ids{1, 2, 3};   ","version":"dev","tagName":"h3"},{"title":"Map‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/cpp/supported_types#map","content":" std::map&lt;K, V&gt; and std::unordered_map&lt;K, V&gt;:  std::map&lt;std::string, int32_t&gt; scores{ {&quot;Alice&quot;, 100}, {&quot;Bob&quot;, 95} }; auto bytes = fory.serialize(scores).value(); auto decoded = fory.deserialize&lt;std::map&lt;std::string, int32_t&gt;&gt;(bytes).value(); // Unordered map std::unordered_map&lt;int32_t, std::string&gt; lookup{ {1, &quot;one&quot;}, {2, &quot;two&quot;} };   ","version":"dev","tagName":"h3"},{"title":"Smart Pointers‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/cpp/supported_types#smart-pointers","content":" ","version":"dev","tagName":"h2"},{"title":"std::optional‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/cpp/supported_types#stdoptional","content":" Nullable wrapper for any type:  std::optional&lt;int32_t&gt; maybe_value = 42; std::optional&lt;int32_t&gt; empty_value = std::nullopt; auto bytes = fory.serialize(maybe_value).value(); auto decoded = fory.deserialize&lt;std::optional&lt;int32_t&gt;&gt;(bytes).value(); assert(decoded.has_value() &amp;&amp; *decoded == 42);   ","version":"dev","tagName":"h3"},{"title":"std::shared_ptr‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/cpp/supported_types#stdshared_ptr","content":" Shared ownership with reference tracking:  auto shared = std::make_shared&lt;Person&gt;(&quot;Alice&quot;, 30); auto bytes = fory.serialize(shared).value(); auto decoded = fory.deserialize&lt;std::shared_ptr&lt;Person&gt;&gt;(bytes).value();   With reference tracking enabled (default, track_ref(true)):  Shared objects are serialized onceReferences to the same object are preservedCircular references are handled automatically  ","version":"dev","tagName":"h3"},{"title":"std::unique_ptr‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/cpp/supported_types#stdunique_ptr","content":" Exclusive ownership:  auto unique = std::make_unique&lt;Person&gt;(&quot;Bob&quot;, 25); auto bytes = fory.serialize(unique).value(); auto decoded = fory.deserialize&lt;std::unique_ptr&lt;Person&gt;&gt;(bytes).value();   ","version":"dev","tagName":"h3"},{"title":"Variant Type‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/cpp/supported_types#variant-type","content":" std::variant&lt;Ts...&gt; for type-safe unions:  using MyVariant = std::variant&lt;int32_t, std::string, double&gt;; MyVariant v1 = 42; MyVariant v2 = std::string(&quot;hello&quot;); MyVariant v3 = 3.14; auto bytes = fory.serialize(v1).value(); auto decoded = fory.deserialize&lt;MyVariant&gt;(bytes).value(); assert(std::get&lt;int32_t&gt;(decoded) == 42);   ","version":"dev","tagName":"h2"},{"title":"std::monostate‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/cpp/supported_types#stdmonostate","content":" Empty variant alternative:  using OptionalInt = std::variant&lt;std::monostate, int32_t&gt;; OptionalInt empty = std::monostate{}; OptionalInt value = 42;   ","version":"dev","tagName":"h3"},{"title":"Temporal Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/cpp/supported_types#temporal-types","content":" ","version":"dev","tagName":"h2"},{"title":"Duration‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/cpp/supported_types#duration","content":" std::chrono::nanoseconds:  using Duration = std::chrono::nanoseconds; Duration d = std::chrono::seconds(30); auto bytes = fory.serialize(d).value(); auto decoded = fory.deserialize&lt;Duration&gt;(bytes).value();   ","version":"dev","tagName":"h3"},{"title":"Timestamp‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/cpp/supported_types#timestamp","content":" Point in time since Unix epoch:  using Timestamp = std::chrono::time_point&lt;std::chrono::system_clock, std::chrono::nanoseconds&gt;; Timestamp now = std::chrono::system_clock::now(); auto bytes = fory.serialize(now).value(); auto decoded = fory.deserialize&lt;Timestamp&gt;(bytes).value();   ","version":"dev","tagName":"h3"},{"title":"Date‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/cpp/supported_types#date","content":" Days since Unix epoch:  Date date{18628}; // Days since 1970-01-01 auto bytes = fory.serialize(date).value(); auto decoded = fory.deserialize&lt;Date&gt;(bytes).value();   ","version":"dev","tagName":"h3"},{"title":"User-Defined Structs‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/cpp/supported_types#user-defined-structs","content":" Any struct can be made serializable with FORY_STRUCT:  struct Point { double x; double y; double z; }; FORY_STRUCT(Point, x, y, z); struct Line { Point start; Point end; std::string label; }; FORY_STRUCT(Line, start, end, label);   ","version":"dev","tagName":"h2"},{"title":"Enum Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/cpp/supported_types#enum-types","content":" Both scoped and unscoped enums are supported with FORY_ENUM:  // Scoped enum (C++11 enum class) enum class Color { RED = 0, GREEN = 1, BLUE = 2 }; // Unscoped enum with incontinuous values enum Priority : int32_t { LOW = -10, NORMAL = 0, HIGH = 10 }; FORY_ENUM(Priority, LOW, NORMAL, HIGH); // FORY_ENUM must be defined at namespace scope. // Usage Color c = Color::GREEN; auto bytes = fory.serialize(c).value(); auto decoded = fory.deserialize&lt;Color&gt;(bytes).value();   ","version":"dev","tagName":"h2"},{"title":"Unsupported Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/cpp/supported_types#unsupported-types","content":" Currently not supported:  Raw pointers (T*) - use smart pointers insteadstd::tuple&lt;Ts...&gt; - use structs insteadstd::array&lt;T, N&gt; - use std::vector&lt;T&gt; insteadFunction pointersReferences (T&amp;, const T&amp;) - by value only  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/cpp/supported_types#related-topics","content":" Basic Serialization - Using these typesType Registration - Registering typesCross-Language - Cross-language compatibility ","version":"dev","tagName":"h2"},{"title":"Polymorphic Serialization","type":0,"sectionRef":"#","url":"/docs/next/guide/cpp/polymorphism","content":"","keywords":"","version":"dev"},{"title":"Supported Polymorphic Types‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/next/guide/cpp/polymorphism#supported-polymorphic-types","content":" std::shared_ptr&lt;Base&gt; - Shared ownership with polymorphic dispatchstd::unique_ptr&lt;Base&gt; - Exclusive ownership with polymorphic dispatchCollections: std::vector&lt;std::shared_ptr&lt;Base&gt;&gt;, std::map&lt;K, std::unique_ptr&lt;Base&gt;&gt;Optional: std::optional&lt;std::shared_ptr&lt;Base&gt;&gt;  ","version":"dev","tagName":"h2"},{"title":"Basic Polymorphic Serialization‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/next/guide/cpp/polymorphism#basic-polymorphic-serialization","content":" #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; // Define base class with virtual methods struct Animal { virtual ~Animal() = default; virtual std::string speak() const = 0; int32_t age = 0; }; FORY_STRUCT(Animal, age); // Define derived classes struct Dog : Animal { std::string speak() const override { return &quot;Woof!&quot;; } std::string breed; }; FORY_STRUCT(Dog, age, breed); struct Cat : Animal { std::string speak() const override { return &quot;Meow!&quot;; } std::string color; }; FORY_STRUCT(Cat, age, color); // Struct with polymorphic field struct Zoo { std::shared_ptr&lt;Animal&gt; star_animal; }; FORY_STRUCT(Zoo, star_animal); int main() { auto fory = Fory::builder().track_ref(true).build(); // Register all types with unique type IDs fory.register_struct&lt;Zoo&gt;(100); fory.register_struct&lt;Dog&gt;(101); fory.register_struct&lt;Cat&gt;(102); // Create object with polymorphic field Zoo zoo; zoo.star_animal = std::make_shared&lt;Dog&gt;(); zoo.star_animal-&gt;age = 3; static_cast&lt;Dog*&gt;(zoo.star_animal.get())-&gt;breed = &quot;Labrador&quot;; // Serialize auto bytes_result = fory.serialize(zoo); assert(bytes_result.ok()); // Deserialize - runtime type is preserved auto decoded_result = fory.deserialize&lt;Zoo&gt;(bytes_result.value()); assert(decoded_result.ok()); auto decoded = std::move(decoded_result).value(); assert(decoded.star_animal-&gt;speak() == &quot;Woof!&quot;); assert(decoded.star_animal-&gt;age == 3); auto* dog_ptr = dynamic_cast&lt;Dog*&gt;(decoded.star_animal.get()); assert(dog_ptr != nullptr); assert(dog_ptr-&gt;breed == &quot;Labrador&quot;); }   ","version":"dev","tagName":"h2"},{"title":"Type Registration for Polymorphism‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/next/guide/cpp/polymorphism#type-registration-for-polymorphism","content":" For polymorphic serialization, register derived types with unique type IDs:  // Register with numeric type ID fory.register_struct&lt;Derived1&gt;(100); fory.register_struct&lt;Derived2&gt;(101);   Why type ID registration?  Compact binary representationFast type lookup and dispatchConsistent with non-polymorphic type registration  ","version":"dev","tagName":"h2"},{"title":"Automatic Polymorphism Detection‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/next/guide/cpp/polymorphism#automatic-polymorphism-detection","content":" Fory automatically detects polymorphic types using std::is_polymorphic&lt;T&gt;:  struct Base { virtual ~Base() = default; // Virtual destructor makes it polymorphic int32_t value = 0; }; struct NonPolymorphic { int32_t value = 0; // No virtual methods }; // Polymorphic field - type info written automatically struct Container1 { std::shared_ptr&lt;Base&gt; ptr; // Auto-detected as polymorphic }; // Non-polymorphic field - no type info written struct Container2 { std::shared_ptr&lt;NonPolymorphic&gt; ptr; // Not polymorphic };   ","version":"dev","tagName":"h2"},{"title":"Controlling Dynamic Dispatch‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/next/guide/cpp/polymorphism#controlling-dynamic-dispatch","content":" Use fory::dynamic&lt;V&gt; to override automatic polymorphism detection:  struct Animal { virtual ~Animal() = default; virtual std::string speak() const = 0; }; struct Pet { // Auto-detected: type info written (Animal has virtual methods) std::shared_ptr&lt;Animal&gt; animal1; // Force dynamic: type info written explicitly fory::field&lt;std::shared_ptr&lt;Animal&gt;, 0, fory::dynamic&lt;true&gt;&gt; animal2; // Force non-dynamic: skip type info (faster but no runtime subtyping) fory::field&lt;std::shared_ptr&lt;Animal&gt;, 1, fory::dynamic&lt;false&gt;&gt; animal3; }; FORY_STRUCT(Pet, animal1, animal2, animal3);   When to use fory::dynamic&lt;false&gt;:  You know the runtime type will always match the declared typePerformance is critical and you don't need subtype supportWorking with monomorphic data despite having a polymorphic base class  ","version":"dev","tagName":"h2"},{"title":"Field Configuration Without Wrapper Types‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/next/guide/cpp/polymorphism#field-configuration-without-wrapper-types","content":" Use FORY_FIELD_CONFIG to configure fields without fory::field&lt;&gt; wrapper:  struct Zoo { std::shared_ptr&lt;Animal&gt; star; // Auto-detected as polymorphic std::shared_ptr&lt;Animal&gt; backup; // Nullable polymorphic field std::shared_ptr&lt;Animal&gt; mascot; // Non-dynamic (no subtype dispatch) }; FORY_STRUCT(Zoo, star, backup, mascot); // Configure fields with tag IDs and options FORY_FIELD_CONFIG(Zoo, (star, fory::F(0)), // Tag ID 0, default options (backup, fory::F(1).nullable()), // Tag ID 1, allow nullptr (mascot, fory::F(2).dynamic(false)) // Tag ID 2, disable polymorphism );   See Field Configuration for complete details on fory::nullable, fory::ref, and other field-level options  ","version":"dev","tagName":"h3"},{"title":"std::unique_ptr Polymorphism‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/next/guide/cpp/polymorphism#stdunique_ptr-polymorphism","content":" std::unique_ptr works the same way as std::shared_ptr for polymorphic types:  struct Container { std::unique_ptr&lt;Animal&gt; pet; }; FORY_STRUCT(Container, pet); auto fory = Fory::builder().track_ref(true).build(); fory.register_struct&lt;Container&gt;(200); fory.register_struct&lt;Dog&gt;(201); Container container; container.pet = std::make_unique&lt;Dog&gt;(); static_cast&lt;Dog*&gt;(container.pet.get())-&gt;breed = &quot;Beagle&quot;; auto bytes = fory.serialize(container).value(); auto decoded = fory.deserialize&lt;Container&gt;(bytes).value(); // Runtime type preserved auto* dog = dynamic_cast&lt;Dog*&gt;(decoded.pet.get()); assert(dog != nullptr); assert(dog-&gt;breed == &quot;Beagle&quot;);   ","version":"dev","tagName":"h2"},{"title":"Collections of Polymorphic Objects‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/next/guide/cpp/polymorphism#collections-of-polymorphic-objects","content":" #include &lt;vector&gt; #include &lt;map&gt; struct AnimalShelter { std::vector&lt;std::shared_ptr&lt;Animal&gt;&gt; animals; std::map&lt;std::string, std::unique_ptr&lt;Animal&gt;&gt; registry; }; FORY_STRUCT(AnimalShelter, animals, registry); auto fory = Fory::builder().track_ref(true).build(); fory.register_struct&lt;AnimalShelter&gt;(100); fory.register_struct&lt;Dog&gt;(101); fory.register_struct&lt;Cat&gt;(102); AnimalShelter shelter; shelter.animals.push_back(std::make_shared&lt;Dog&gt;()); shelter.animals.push_back(std::make_shared&lt;Cat&gt;()); shelter.registry[&quot;pet1&quot;] = std::make_unique&lt;Dog&gt;(); auto bytes = fory.serialize(shelter).value(); auto decoded = fory.deserialize&lt;AnimalShelter&gt;(bytes).value(); // All runtime types preserved assert(dynamic_cast&lt;Dog*&gt;(decoded.animals[0].get()) != nullptr); assert(dynamic_cast&lt;Cat*&gt;(decoded.animals[1].get()) != nullptr); assert(dynamic_cast&lt;Dog*&gt;(decoded.registry[&quot;pet1&quot;].get()) != nullptr);   ","version":"dev","tagName":"h2"},{"title":"Reference Tracking‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/next/guide/cpp/polymorphism#reference-tracking","content":" Reference tracking for std::shared_ptr works the same with polymorphic types. See Supported Types for details and examples.  ","version":"dev","tagName":"h2"},{"title":"Nested Polymorphism Depth Limit‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/next/guide/cpp/polymorphism#nested-polymorphism-depth-limit","content":" To prevent stack overflow from deeply nested polymorphic structures, Fory limits the maximum dynamic nesting depth:  struct Container { virtual ~Container() = default; int32_t value = 0; std::shared_ptr&lt;Container&gt; nested; }; FORY_STRUCT(Container, value, nested); // Default max_dyn_depth is 5 auto fory1 = Fory::builder().build(); assert(fory1.config().max_dyn_depth == 5); // Increase limit for deeper nesting auto fory2 = Fory::builder().max_dyn_depth(10).build(); fory2.register_struct&lt;Container&gt;(1); // Create deeply nested structure auto level3 = std::make_shared&lt;Container&gt;(); level3-&gt;value = 3; auto level2 = std::make_shared&lt;Container&gt;(); level2-&gt;value = 2; level2-&gt;nested = level3; auto level1 = std::make_shared&lt;Container&gt;(); level1-&gt;value = 1; level1-&gt;nested = level2; // Serialization succeeds auto bytes = fory2.serialize(level1).value(); // Deserialization succeeds with sufficient depth auto decoded = fory2.deserialize&lt;std::shared_ptr&lt;Container&gt;&gt;(bytes).value();   Depth exceeded error:  auto fory_shallow = Fory::builder().max_dyn_depth(2).build(); fory_shallow.register_struct&lt;Container&gt;(1); // 3 levels exceeds max_dyn_depth=2 auto result = fory_shallow.deserialize&lt;std::shared_ptr&lt;Container&gt;&gt;(bytes); assert(!result.ok()); // Fails with depth exceeded error   When to adjust:  Increase max_dyn_depth: For legitimate deeply nested polymorphic data structuresDecrease max_dyn_depth: For stricter security requirements or shallow data structures  ","version":"dev","tagName":"h2"},{"title":"Nullability for Polymorphic Fields‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/next/guide/cpp/polymorphism#nullability-for-polymorphic-fields","content":" By default, std::shared_ptr&lt;T&gt; and std::unique_ptr&lt;T&gt; fields are treated as non-nullable in the schema. To allow nullptr, wrap the field withfory::field&lt;&gt; (or FORY_FIELD_TAGS) and opt in with fory::nullable.  struct Pet { // Non-nullable (default) std::shared_ptr&lt;Animal&gt; primary; // Nullable via explicit field metadata fory::field&lt;std::shared_ptr&lt;Animal&gt;, 0, fory::nullable&gt; optional; }; FORY_STRUCT(Pet, primary, optional);   See Field Configuration for more details.  ","version":"dev","tagName":"h2"},{"title":"Combining Polymorphism with Other Features‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/next/guide/cpp/polymorphism#combining-polymorphism-with-other-features","content":" ","version":"dev","tagName":"h2"},{"title":"Polymorphism + Reference Tracking‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/next/guide/cpp/polymorphism#polymorphism--reference-tracking","content":" struct GraphNode { virtual ~GraphNode() = default; int32_t id = 0; std::vector&lt;std::shared_ptr&lt;GraphNode&gt;&gt; neighbors; }; FORY_STRUCT(GraphNode, id, neighbors); struct WeightedNode : GraphNode { double weight = 0.0; }; FORY_STRUCT(WeightedNode, id, neighbors, weight); // Enable ref tracking to handle shared references and cycles auto fory = Fory::builder().track_ref(true).build(); fory.register_struct&lt;GraphNode&gt;(100); fory.register_struct&lt;WeightedNode&gt;(101); // Create cyclic graph auto node1 = std::make_shared&lt;WeightedNode&gt;(); node1-&gt;id = 1; auto node2 = std::make_shared&lt;WeightedNode&gt;(); node2-&gt;id = 2; node1-&gt;neighbors.push_back(node2); node2-&gt;neighbors.push_back(node1); // Cycle auto bytes = fory.serialize(node1).value(); auto decoded = fory.deserialize&lt;std::shared_ptr&lt;GraphNode&gt;&gt;(bytes).value(); // Cycle handled correctly   ","version":"dev","tagName":"h3"},{"title":"Polymorphism + Schema Evolution‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/next/guide/cpp/polymorphism#polymorphism--schema-evolution","content":" Use compatible mode for schema evolution with polymorphic types:  auto fory = Fory::builder() .compatible(true) // Enable schema evolution .track_ref(true) .build();   ","version":"dev","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/next/guide/cpp/polymorphism#best-practices","content":" Use type ID registration for polymorphic types: fory.register_struct&lt;DerivedType&gt;(100); Enable reference tracking for polymorphic types: auto fory = Fory::builder().track_ref(true).build(); Virtual destructors required: Ensure base classes have virtual destructors: struct Base { virtual ~Base() = default; // Required for polymorphism }; Register all concrete types before serialization/deserialization: fory.register_struct&lt;Derived1&gt;(100); fory.register_struct&lt;Derived2&gt;(101); Use dynamic_cast to downcast after deserialization: auto* derived = dynamic_cast&lt;DerivedType*&gt;(base_ptr.get()); if (derived) { // Use derived-specific members } Adjust max_dyn_depth based on your data structure depth: auto fory = Fory::builder().max_dyn_depth(10).build(); Use fory::nullable for optional polymorphic fields: fory::field&lt;std::shared_ptr&lt;Base&gt;, 0, fory::nullable&gt; optional_ptr;   ","version":"dev","tagName":"h2"},{"title":"Error Handling‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/next/guide/cpp/polymorphism#error-handling","content":" auto bytes_result = fory.serialize(obj); if (!bytes_result.ok()) { std::cerr &lt;&lt; &quot;Serialization failed: &quot; &lt;&lt; bytes_result.error().to_string() &lt;&lt; std::endl; return; } auto decoded_result = fory.deserialize&lt;MyType&gt;(bytes_result.value()); if (!decoded_result.ok()) { std::cerr &lt;&lt; &quot;Deserialization failed: &quot; &lt;&lt; decoded_result.error().to_string() &lt;&lt; std::endl; return; }   Common errors:  Type not registered: Register all concrete types with unique IDs before useDepth exceeded: Increase max_dyn_depth for deeply nested structuresType ID conflict: Ensure each type has a unique type ID across all registered types  ","version":"dev","tagName":"h2"},{"title":"Performance Considerations‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/next/guide/cpp/polymorphism#performance-considerations","content":" Polymorphic serialization overhead:  Type metadata written for each polymorphic object (~16-32 bytes)Dynamic type resolution during deserializationVirtual function calls for runtime dispatch  Optimization tips:  Use fory::dynamic&lt;false&gt; when runtime type matches declared type: fory::field&lt;std::shared_ptr&lt;Base&gt;, 0, fory::dynamic&lt;false&gt;&gt; fixed_type; Minimize nesting depth to reduce metadata overhead Batch polymorphic objects in collections rather than individual fields Consider non-polymorphic alternatives when polymorphism isn't needed: std::variant&lt;Dog, Cat&gt; animal; // Type-safe union instead of polymorphism   ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/next/guide/cpp/polymorphism#related-topics","content":" Type Registration - Registering types for serializationField Configuration - Field-level metadata and optionsSupported Types - Smart pointers and collectionsConfiguration - max_dyn_depth and other settingsBasic Serialization - Core serialization concepts ","version":"dev","tagName":"h2"},{"title":"C# Serialization Guide","type":0,"sectionRef":"#","url":"/docs/next/guide/csharp/","content":"","keywords":"","version":"dev"},{"title":"Why Fory C#?‚Äã","type":1,"pageTitle":"C# Serialization Guide","url":"/docs/next/guide/csharp/#why-fory-c","content":" High performance binary serialization for .NET 8+Cross-language compatibility with Fory implementations in Java, Python, C++, Go, Rust, and JavaScriptSource-generator-based serializers for [ForyObject] typesOptional reference tracking for shared and circular object graphsCompatible mode for schema evolutionThread-safe runtime (ThreadSafeFory) for multi-threaded services  ","version":"dev","tagName":"h2"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"C# Serialization Guide","url":"/docs/next/guide/csharp/#quick-start","content":" ","version":"dev","tagName":"h2"},{"title":"Requirements‚Äã","type":1,"pageTitle":"C# Serialization Guide","url":"/docs/next/guide/csharp/#requirements","content":" .NET SDK 8.0+C# language version 12+  ","version":"dev","tagName":"h3"},{"title":"Basic Example‚Äã","type":1,"pageTitle":"C# Serialization Guide","url":"/docs/next/guide/csharp/#basic-example","content":" using Apache.Fory; [ForyObject] public sealed class User { public long Id { get; set; } public string Name { get; set; } = string.Empty; public string? Email { get; set; } } Fory fory = Fory.Builder().Build(); fory.Register&lt;User&gt;(1); User user = new() { Id = 1, Name = &quot;Alice&quot;, Email = &quot;alice@example.com&quot;, }; byte[] payload = fory.Serialize(user); User decoded = fory.Deserialize&lt;User&gt;(payload);   ","version":"dev","tagName":"h3"},{"title":"Core API Surface‚Äã","type":1,"pageTitle":"C# Serialization Guide","url":"/docs/next/guide/csharp/#core-api-surface","content":" Serialize&lt;T&gt;(in T value) / Deserialize&lt;T&gt;(...)SerializeObject(object? value) / DeserializeObject(...) for dynamic payloadsRegister&lt;T&gt;(uint typeId) and namespace/name registration APIsRegister&lt;T, TSerializer&gt;(...) for custom serializers  ","version":"dev","tagName":"h2"},{"title":"Documentation‚Äã","type":1,"pageTitle":"C# Serialization Guide","url":"/docs/next/guide/csharp/#documentation","content":" Topic\tDescriptionConfiguration\tBuilder options and runtime modes Basic Serialization\tTyped and dynamic serialization APIs Type Registration\tRegistering user types and custom serializers Custom Serializers\tImplementing Serializer&lt;T&gt; Field Configuration\t[Field] attribute and integer encoding options References\tShared/circular reference handling Schema Evolution\tCompatible mode behavior Cross-Language\tInteroperability guidance Supported Types\tBuilt-in and generated type support Thread Safety\tFory vs ThreadSafeFory usage Troubleshooting\tCommon errors and debugging steps  ","version":"dev","tagName":"h2"},{"title":"Related Resources‚Äã","type":1,"pageTitle":"C# Serialization Guide","url":"/docs/next/guide/csharp/#related-resources","content":" Cross-language serialization specificationCross-language guideC# source directory ","version":"dev","tagName":"h2"},{"title":"Type Registration","type":0,"sectionRef":"#","url":"/docs/next/guide/cpp/type_registration","content":"","keywords":"","version":"dev"},{"title":"Overview‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/cpp/type_registration#overview","content":" Apache Fory‚Ñ¢ requires explicit type registration for struct types. This design enables:  Cross-Language Compatibility: Registered type IDs are used across language boundariesType Safety: Detects type mismatches at deserialization timePolymorphic Serialization: Enables serialization of polymorphic objects via smart pointers  ","version":"dev","tagName":"h2"},{"title":"Registering Structs‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/cpp/type_registration#registering-structs","content":" Use register_struct&lt;T&gt;(type_id) to register a struct type:  #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; struct Person { std::string name; int32_t age; }; FORY_STRUCT(Person, name, age); int main() { auto fory = Fory::builder().xlang(true).build(); // Register with a unique type ID fory.register_struct&lt;Person&gt;(100); Person person{&quot;Alice&quot;, 30}; auto bytes = fory.serialize(person).value(); auto decoded = fory.deserialize&lt;Person&gt;(bytes).value(); }   ","version":"dev","tagName":"h2"},{"title":"Type ID Guidelines‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/cpp/type_registration#type-id-guidelines","content":" Type IDs must be:  Unique: Each type must have a unique ID within a Fory instanceConsistent: Same ID must be used across all languages and versions  User-registered type IDs are in a separate namespace from built-in type IDs, so you can start from 0:  // User type IDs can start from 0 fory.register_struct&lt;Address&gt;(0); fory.register_struct&lt;Person&gt;(1); fory.register_struct&lt;Order&gt;(2);   ","version":"dev","tagName":"h2"},{"title":"Registering Enums‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/cpp/type_registration#registering-enums","content":" Use register_enum&lt;T&gt;(type_id) to register an enum type. For simple enums with continuous values starting from 0, no macro is needed:  // Simple continuous enum - no FORY_ENUM needed enum class Color { RED, GREEN, BLUE }; // Values: 0, 1, 2 // Register with register_enum fory.register_enum&lt;Color&gt;(0);   For enums with non-continuous values, use the FORY_ENUM macro to map values to ordinals:  // Non-continuous enum values - FORY_ENUM required enum class Priority { LOW = 10, MEDIUM = 50, HIGH = 100 }; FORY_ENUM(Priority, LOW, MEDIUM, HIGH); // FORY_ENUM must be defined at namespace scope. // Global namespace enum (prefix with ::) enum LegacyStatus { UNKNOWN = -1, OK = 0, ERROR = 1 }; FORY_ENUM(::LegacyStatus, UNKNOWN, OK, ERROR); // Register after FORY_ENUM fory.register_enum&lt;Priority&gt;(1); fory.register_enum&lt;LegacyStatus&gt;(2);   When to use FORY_ENUM:  Enum values don't start from 0Enum values are not continuous (e.g., 10, 50, 100)You need name-to-value mapping at compile time  ","version":"dev","tagName":"h2"},{"title":"Thread-Safe Registration‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/cpp/type_registration#thread-safe-registration","content":" For ThreadSafeFory, register types before spawning threads:  auto fory = Fory::builder().xlang(true).build_thread_safe(); // Register all types first fory.register_struct&lt;TypeA&gt;(100); fory.register_struct&lt;TypeB&gt;(101); // Now safe to use from multiple threads std::thread t1([&amp;]() { auto result = fory.serialize(obj_a); }); std::thread t2([&amp;]() { auto result = fory.serialize(obj_b); });   ","version":"dev","tagName":"h2"},{"title":"Cross-Language Registration‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/cpp/type_registration#cross-language-registration","content":" For cross-language compatibility, ensure:  Same Type ID: Use identical IDs in all languagesCompatible Types: Use equivalent types across languages  ","version":"dev","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/cpp/type_registration#java","content":" Fory fory = Fory.builder().withXlang(true).build(); fory.register(Person.class, 100); fory.register(Address.class, 101);   ","version":"dev","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/cpp/type_registration#python","content":" import pyfory fory = pyfory.Fory(xlang=True) fory.register(Person, type_id=100) fory.register(Address, type_id=101)   ","version":"dev","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/cpp/type_registration#c","content":" auto fory = Fory::builder().xlang(true).build(); fory.register_struct&lt;Person&gt;(100); fory.register_struct&lt;Address&gt;(101);   ","version":"dev","tagName":"h3"},{"title":"Built-in Type IDs‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/cpp/type_registration#built-in-type-ids","content":" Built-in types have pre-assigned type IDs and don't need registration:  Type ID\tType0\tNONE 1\tBOOL 2\tINT8 3\tINT16 4\tINT32 5\tVAR_INT32 6\tINT64 7\tVAR_INT64 8\tSLI_INT64 9\tFLOAT16 10\tFLOAT32 11\tFLOAT64 12\tSTRING 13\tLIST 14\tMAP 15\tSET 16\tTIMESTAMP 17\tDURATION 18\tDATE 19\tDECIMAL 20\tBINARY 21\tARRAY 22\tBOOL_ARRAY 23-28\tINT_ARRAY variants 29-31\tFLOAT_ARRAY variants 32\tSTRUCT 33\tCOMPATIBLE_STRUCT 34\tNAMED_STRUCT 35\tNAMEDCOMPATIBLE... 36\tEXT 37\tNAMED_EXT 63\tUNKNOWN  ","version":"dev","tagName":"h2"},{"title":"Error Handling‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/cpp/type_registration#error-handling","content":" Registration errors are checked at serialization/deserialization time:  // Attempting to serialize unregistered type auto result = fory.serialize(unregistered_obj); if (!result.ok()) { // Error: &quot;Type not registered: ...&quot; std::cerr &lt;&lt; result.error().to_string() &lt;&lt; std::endl; } // Type ID mismatch during deserialization auto result = fory.deserialize&lt;WrongType&gt;(bytes); if (!result.ok()) { // Error: &quot;Type mismatch: expected X, got Y&quot; std::cerr &lt;&lt; result.error().to_string() &lt;&lt; std::endl; }   ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/cpp/type_registration#related-topics","content":" Basic Serialization - Using registered typesCross-Language - Cross-language considerationsSupported Types - All supported types ","version":"dev","tagName":"h2"},{"title":"Basic Serialization","type":0,"sectionRef":"#","url":"/docs/next/guide/csharp/basic_serialization","content":"","keywords":"","version":"dev"},{"title":"Object Graph Serialization‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/csharp/basic_serialization#object-graph-serialization","content":" Use [ForyObject] on your classes/structs and register them before use.  using Apache.Fory; [ForyObject] public sealed class Address { public string Street { get; set; } = string.Empty; public int Zip { get; set; } } [ForyObject] public sealed class Person { public long Id { get; set; } public string Name { get; set; } = string.Empty; public string? Nickname { get; set; } public List&lt;int&gt; Scores { get; set; } = []; public List&lt;Address&gt; Addresses { get; set; } = []; } Fory fory = Fory.Builder().Build(); fory.Register&lt;Address&gt;(100); fory.Register&lt;Person&gt;(101); Person person = new() { Id = 42, Name = &quot;Alice&quot;, Nickname = null, Scores = [10, 20, 30], Addresses = [new Address { Street = &quot;Main&quot;, Zip = 94107 }], }; byte[] payload = fory.Serialize(person); Person decoded = fory.Deserialize&lt;Person&gt;(payload);   ","version":"dev","tagName":"h2"},{"title":"Typed API‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/csharp/basic_serialization#typed-api","content":" ","version":"dev","tagName":"h2"},{"title":"Serialize / Deserialize with byte arrays‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/csharp/basic_serialization#serialize--deserialize-with-byte-arrays","content":" byte[] payload = fory.Serialize(value); MyType decoded = fory.Deserialize&lt;MyType&gt;(payload);   ","version":"dev","tagName":"h3"},{"title":"Deserialize from ReadOnlySpan<byte>‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/csharp/basic_serialization#deserialize-from-readonlyspanbyte","content":" ReadOnlySpan&lt;byte&gt; span = payload; MyType decoded = fory.Deserialize&lt;MyType&gt;(span);   ","version":"dev","tagName":"h3"},{"title":"Stream-style frame consumption‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/csharp/basic_serialization#stream-style-frame-consumption","content":" using System.Buffers; ReadOnlySequence&lt;byte&gt; sequence = GetFramedSequence(); MyType first = fory.Deserialize&lt;MyType&gt;(ref sequence); MyType second = fory.Deserialize&lt;MyType&gt;(ref sequence);   ","version":"dev","tagName":"h3"},{"title":"Dynamic Object API‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/csharp/basic_serialization#dynamic-object-api","content":" Use object APIs when the compile-time type is unknown or heterogeneous.  Dictionary&lt;object, object?&gt; value = new() { [&quot;k1&quot;] = 7, [2] = &quot;v2&quot;, [true] = null, }; byte[] payload = fory.SerializeObject(value); object? decoded = fory.DeserializeObject(payload);   ","version":"dev","tagName":"h2"},{"title":"Buffer Writer API‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/csharp/basic_serialization#buffer-writer-api","content":" Serialize directly into IBufferWriter&lt;byte&gt; targets.  using System.Buffers; ArrayBufferWriter&lt;byte&gt; writer = new(); fory.Serialize(writer, value); ArrayBufferWriter&lt;byte&gt; dynamicWriter = new(); fory.SerializeObject(dynamicWriter, value);   ","version":"dev","tagName":"h2"},{"title":"Notes‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/csharp/basic_serialization#notes","content":" Reuse the same Fory or ThreadSafeFory instance for better performance.Primitive types and collections do not require user registration.User [ForyObject] and custom serializer types should be registered explicitly.  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/csharp/basic_serialization#related-topics","content":" Type RegistrationSupported TypesReferences ","version":"dev","tagName":"h2"},{"title":"Configuration","type":0,"sectionRef":"#","url":"/docs/next/guide/csharp/configuration","content":"","keywords":"","version":"dev"},{"title":"Build a Runtime‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/csharp/configuration#build-a-runtime","content":" using Apache.Fory; Fory fory = Fory.Builder().Build(); ThreadSafeFory threadSafe = Fory.Builder().BuildThreadSafe();   ","version":"dev","tagName":"h2"},{"title":"Default Configuration‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/csharp/configuration#default-configuration","content":" Fory.Builder().Build() uses:  Option\tDefault\tDescriptionXlang\ttrue\tCross-language protocol mode TrackRef\tfalse\tReference tracking disabled Compatible\tfalse\tSchema-consistent mode (no evolution metadata) CheckStructVersion\tfalse\tStruct schema hash checks disabled MaxDepth\t20\tMax dynamic nesting depth  ","version":"dev","tagName":"h2"},{"title":"Builder Options‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/csharp/configuration#builder-options","content":" ","version":"dev","tagName":"h2"},{"title":"Xlang(bool enabled = true)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/csharp/configuration#xlangbool-enabled--true","content":" Controls cross-language mode.  Fory fory = Fory.Builder() .Xlang(true) .Build();   ","version":"dev","tagName":"h3"},{"title":"TrackRef(bool enabled = false)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/csharp/configuration#trackrefbool-enabled--false","content":" Enables reference tracking for shared/circular object graphs.  Fory fory = Fory.Builder() .TrackRef(true) .Build();   ","version":"dev","tagName":"h3"},{"title":"Compatible(bool enabled = false)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/csharp/configuration#compatiblebool-enabled--false","content":" Enables schema evolution mode.  Fory fory = Fory.Builder() .Compatible(true) .Build();   ","version":"dev","tagName":"h3"},{"title":"CheckStructVersion(bool enabled = false)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/csharp/configuration#checkstructversionbool-enabled--false","content":" Enables strict schema hash validation for generated struct serializers.  Fory fory = Fory.Builder() .CheckStructVersion(true) .Build();   ","version":"dev","tagName":"h3"},{"title":"MaxDepth(int value)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/csharp/configuration#maxdepthint-value","content":" Sets max nesting depth for dynamic object graphs.  Fory fory = Fory.Builder() .MaxDepth(32) .Build();   value must be greater than 0.  ","version":"dev","tagName":"h3"},{"title":"Common Configurations‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/csharp/configuration#common-configurations","content":" ","version":"dev","tagName":"h2"},{"title":"Fast schema-consistent service‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/csharp/configuration#fast-schema-consistent-service","content":" Fory fory = Fory.Builder() .TrackRef(false) .Compatible(false) .Build();   ","version":"dev","tagName":"h3"},{"title":"Compatible cross-language service‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/csharp/configuration#compatible-cross-language-service","content":" Fory fory = Fory.Builder() .Xlang(true) .Compatible(true) .TrackRef(true) .Build();   ","version":"dev","tagName":"h3"},{"title":"Thread-safe service instance‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/csharp/configuration#thread-safe-service-instance","content":" ThreadSafeFory fory = Fory.Builder() .Compatible(true) .TrackRef(true) .BuildThreadSafe();   ","version":"dev","tagName":"h3"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/csharp/configuration#related-topics","content":" Basic SerializationSchema EvolutionThread Safety ","version":"dev","tagName":"h2"},{"title":"Cross-Language Serialization","type":0,"sectionRef":"#","url":"/docs/next/guide/csharp/cross_language","content":"","keywords":"","version":"dev"},{"title":"Enable Cross-Language Mode‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/csharp/cross_language#enable-cross-language-mode","content":" C# defaults to Xlang(true), but it is good practice to configure it explicitly in interoperability code.  Fory fory = Fory.Builder() .Xlang(true) .Compatible(true) .Build();   ","version":"dev","tagName":"h2"},{"title":"Register with Stable IDs‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/csharp/cross_language#register-with-stable-ids","content":" [ForyObject] public sealed class Person { public string Name { get; set; } = string.Empty; public int Age { get; set; } } Fory fory = Fory.Builder() .Xlang(true) .Compatible(true) .Build(); fory.Register&lt;Person&gt;(100);   Use the same ID mapping on all languages.  ","version":"dev","tagName":"h2"},{"title":"Register by Namespace/Type Name‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/csharp/cross_language#register-by-namespacetype-name","content":" fory.Register&lt;Person&gt;(&quot;com.example&quot;, &quot;Person&quot;);   ","version":"dev","tagName":"h2"},{"title":"Cross-Language Example‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/csharp/cross_language#cross-language-example","content":" ","version":"dev","tagName":"h2"},{"title":"C# (Serializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/csharp/cross_language#c-serializer","content":" Person person = new() { Name = &quot;Alice&quot;, Age = 30 }; byte[] payload = fory.Serialize(person);   ","version":"dev","tagName":"h3"},{"title":"Java (Deserializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/csharp/cross_language#java-deserializer","content":" Fory fory = Fory.builder() .withLanguage(Language.XLANG) .withRefTracking(true) .build(); fory.register(Person.class, 100); Person value = (Person) fory.deserialize(payloadFromCSharp);   ","version":"dev","tagName":"h3"},{"title":"Python (Deserializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/csharp/cross_language#python-deserializer","content":" import pyfory fory = pyfory.Fory(xlang=True, ref=True) fory.register_type(Person, type_id=100) value = fory.deserialize(payload_from_csharp)   ","version":"dev","tagName":"h3"},{"title":"Type Mapping Reference‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/csharp/cross_language#type-mapping-reference","content":" See xlang guide for complete mapping.  ","version":"dev","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/csharp/cross_language#best-practices","content":" Keep type IDs stable and documented.Enable Compatible(true) for rolling upgrades.Register all user types on both read/write peers.Validate integration with real payload round trips.  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/csharp/cross_language#related-topics","content":" Type RegistrationSchema EvolutionSupported Types ","version":"dev","tagName":"h2"},{"title":"Custom Serializers","type":0,"sectionRef":"#","url":"/docs/next/guide/csharp/custom_serializers","content":"","keywords":"","version":"dev"},{"title":"Implement Serializer<T>‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/csharp/custom_serializers#implement-serializert","content":" using Apache.Fory; public sealed class Point { public int X { get; set; } public int Y { get; set; } } public sealed class PointSerializer : Serializer&lt;Point&gt; { public override Point DefaultValue =&gt; new(); public override void WriteData(WriteContext context, in Point value, bool hasGenerics) { context.Writer.WriteVarInt32(value.X); context.Writer.WriteVarInt32(value.Y); } public override Point ReadData(ReadContext context) { return new Point { X = context.Reader.ReadVarInt32(), Y = context.Reader.ReadVarInt32(), }; } }   ","version":"dev","tagName":"h2"},{"title":"Register the Serializer‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/csharp/custom_serializers#register-the-serializer","content":" Fory fory = Fory.Builder().Build(); fory.Register&lt;Point, PointSerializer&gt;(200); Point value = new() { X = 10, Y = 20 }; byte[] payload = fory.Serialize(value); Point decoded = fory.Deserialize&lt;Point&gt;(payload);   ","version":"dev","tagName":"h2"},{"title":"Serializer Behavior Notes‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/csharp/custom_serializers#serializer-behavior-notes","content":" WriteData / ReadData only handle payload content.Ref flags and type info are handled by base Serializer&lt;T&gt;.Write / Read unless overridden.DefaultValue is used for null/default fallback paths.  ","version":"dev","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/csharp/custom_serializers#best-practices","content":" Keep serializers deterministic and symmetric.Use varint/fixed/tagged encoding intentionally for integer-heavy payloads.Register custom serializers on all reader/writer peers.Prefer generated [ForyObject] serializers for normal domain models.  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/csharp/custom_serializers#related-topics","content":" Type RegistrationField ConfigurationTroubleshooting ","version":"dev","tagName":"h2"},{"title":"Field Configuration","type":0,"sectionRef":"#","url":"/docs/next/guide/csharp/field_configuration","content":"","keywords":"","version":"dev"},{"title":"[ForyObject] and [Field]‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/csharp/field_configuration#foryobject-and-field","content":" Use [ForyObject] to enable source-generated serializers. Use [Field] to override integer encoding for a specific field.  using Apache.Fory; [ForyObject] public sealed class Metrics { // Fixed-width 32-bit encoding [Field(Encoding = FieldEncoding.Fixed)] public uint Count { get; set; } // Tagged 64-bit encoding [Field(Encoding = FieldEncoding.Tagged)] public ulong TraceId { get; set; } // Default (varint) encoding public long LatencyMicros { get; set; } }   ","version":"dev","tagName":"h2"},{"title":"Available Encodings‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/csharp/field_configuration#available-encodings","content":" Encoding\tMeaningFieldEncoding.Varint\tVariable-length integer encoding (default) FieldEncoding.Fixed\tFixed-width integer encoding FieldEncoding.Tagged\tTagged integer encoding (long / ulong only)  ","version":"dev","tagName":"h2"},{"title":"Supported Field Types for Encoding Override‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/csharp/field_configuration#supported-field-types-for-encoding-override","content":" [Field(Encoding = ...)] currently applies to:  intuintlongulong  Nullable value variants (for example long?) are also handled by generated serializers.  ","version":"dev","tagName":"h2"},{"title":"Nullability and Reference Tracking‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/csharp/field_configuration#nullability-and-reference-tracking","content":" Field nullability comes from C# type nullability (string?, nullable value types, etc.).Reference tracking is controlled at runtime by ForyBuilder.TrackRef(...).  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/csharp/field_configuration#related-topics","content":" ConfigurationSchema EvolutionSupported Types ","version":"dev","tagName":"h2"},{"title":"References","type":0,"sectionRef":"#","url":"/docs/next/guide/csharp/references","content":"","keywords":"","version":"dev"},{"title":"Enable Reference Tracking‚Äã","type":1,"pageTitle":"References","url":"/docs/next/guide/csharp/references#enable-reference-tracking","content":" Fory fory = Fory.Builder() .TrackRef(true) .Build();   When enabled:  Shared object identity is preserved.Circular object graphs can be serialized/deserialized safely.  ","version":"dev","tagName":"h2"},{"title":"Circular Reference Example‚Äã","type":1,"pageTitle":"References","url":"/docs/next/guide/csharp/references#circular-reference-example","content":" using Apache.Fory; [ForyObject] public sealed class Node { public int Value { get; set; } public Node? Next { get; set; } } Fory fory = Fory.Builder() .TrackRef(true) .Build(); fory.Register&lt;Node&gt;(200); Node node = new() { Value = 7 }; node.Next = node; byte[] payload = fory.Serialize(node); Node decoded = fory.Deserialize&lt;Node&gt;(payload); // The cycle is preserved. System.Diagnostics.Debug.Assert(object.ReferenceEquals(decoded, decoded.Next));   ","version":"dev","tagName":"h2"},{"title":"When to Use TrackRef(false)‚Äã","type":1,"pageTitle":"References","url":"/docs/next/guide/csharp/references#when-to-use-trackreffalse","content":" TrackRef(false) can be faster for tree-like, acyclic data where reference identity does not matter.  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"References","url":"/docs/next/guide/csharp/references#related-topics","content":" ConfigurationBasic SerializationThread Safety ","version":"dev","tagName":"h2"},{"title":"Supported Types","type":0,"sectionRef":"#","url":"/docs/next/guide/csharp/supported_types","content":"","keywords":"","version":"dev"},{"title":"Primitive Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/csharp/supported_types#primitive-types","content":" C# Type\tNotesbool\tSupported sbyte, short, int, long\tSupported byte, ushort, uint, ulong\tSupported float, double\tSupported string\tSupported byte[]\tSupported Nullable primitives (for example int?)\tSupported  ","version":"dev","tagName":"h2"},{"title":"Arrays‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/csharp/supported_types#arrays","content":" Primitive numeric arrays (bool[], int[], ulong[], etc.)byte[]General arrays (T[]) through collection serializers  ","version":"dev","tagName":"h2"},{"title":"Collections‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/csharp/supported_types#collections","content":" ","version":"dev","tagName":"h2"},{"title":"List-like‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/csharp/supported_types#list-like","content":" List&lt;T&gt;LinkedList&lt;T&gt;Queue&lt;T&gt;Stack&lt;T&gt;  ","version":"dev","tagName":"h3"},{"title":"Set-like‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/csharp/supported_types#set-like","content":" HashSet&lt;T&gt;SortedSet&lt;T&gt;ImmutableHashSet&lt;T&gt;  ","version":"dev","tagName":"h3"},{"title":"Map-like‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/csharp/supported_types#map-like","content":" Dictionary&lt;TKey, TValue&gt;SortedDictionary&lt;TKey, TValue&gt;SortedList&lt;TKey, TValue&gt;ConcurrentDictionary&lt;TKey, TValue&gt;NullableKeyDictionary&lt;TKey, TValue&gt;  ","version":"dev","tagName":"h3"},{"title":"Time Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/csharp/supported_types#time-types","content":" C# Type\tWire TypeDateOnly\tDate DateTime\tTimestamp DateTimeOffset\tTimestamp TimeSpan\tDuration  ","version":"dev","tagName":"h2"},{"title":"User Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/csharp/supported_types#user-types","content":" [ForyObject] classes/structs/enums via source-generated serializersCustom serializer types registered through Register&lt;T, TSerializer&gt;(...)Union / Union2&lt;...&gt; typed union support  ","version":"dev","tagName":"h2"},{"title":"Dynamic Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/csharp/supported_types#dynamic-types","content":" Dynamic object APIs (SerializeObject / DeserializeObject) support:  Primitive/object valuesDynamic lists/sets/mapsNested dynamic structures  ","version":"dev","tagName":"h2"},{"title":"Notes‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/csharp/supported_types#notes","content":" User-defined types should be registered explicitly.For cross-language usage, follow the xlang guide.  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/csharp/supported_types#related-topics","content":" Basic SerializationType RegistrationCross-Language ","version":"dev","tagName":"h2"},{"title":"Thread Safety","type":0,"sectionRef":"#","url":"/docs/next/guide/csharp/thread_safety","content":"","keywords":"","version":"dev"},{"title":"Fory (Single-Threaded Runtime)‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/csharp/thread_safety#fory-single-threaded-runtime","content":" Fory is optimized for single-threaded reuse and must not be used concurrently by multiple threads.  Fory fory = Fory.Builder().Build();   Use one Fory instance per thread when managing thread affinity explicitly.  ","version":"dev","tagName":"h2"},{"title":"ThreadSafeFory (Concurrent Wrapper)‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/csharp/thread_safety#threadsafefory-concurrent-wrapper","content":" ThreadSafeFory wraps one Fory instance per thread and exposes thread-safe APIs.  using Apache.Fory; using ThreadSafeFory fory = Fory.Builder() .Compatible(true) .TrackRef(true) .BuildThreadSafe(); fory.Register&lt;MyType&gt;(100); Parallel.For(0, 64, i =&gt; { byte[] payload = fory.Serialize(i); int decoded = fory.Deserialize&lt;int&gt;(payload); });   ","version":"dev","tagName":"h2"},{"title":"Registration Behavior‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/csharp/thread_safety#registration-behavior","content":" ThreadSafeFory.Register(...) stores registrations centrally.Existing per-thread runtimes are updated.New threads receive all previous registrations automatically.  ","version":"dev","tagName":"h2"},{"title":"Disposal‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/csharp/thread_safety#disposal","content":" ThreadSafeFory implements IDisposable and should be disposed when no longer needed.  using ThreadSafeFory fory = Fory.Builder().BuildThreadSafe();   ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/csharp/thread_safety#related-topics","content":" ConfigurationType RegistrationReferences ","version":"dev","tagName":"h2"},{"title":"Schema Evolution","type":0,"sectionRef":"#","url":"/docs/next/guide/csharp/schema_evolution","content":"","keywords":"","version":"dev"},{"title":"Compatible Mode‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/csharp/schema_evolution#compatible-mode","content":" Fory fory = Fory.Builder() .Compatible(true) .Build();   Compatible mode writes type metadata that allows readers and writers with different struct definitions to interoperate.  ","version":"dev","tagName":"h2"},{"title":"Example: Add a Field‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/csharp/schema_evolution#example-add-a-field","content":" using Apache.Fory; [ForyObject] public sealed class OneStringField { public string? F1 { get; set; } } [ForyObject] public sealed class TwoStringField { public string F1 { get; set; } = string.Empty; public string F2 { get; set; } = string.Empty; } Fory fory1 = Fory.Builder().Compatible(true).Build(); fory1.Register&lt;OneStringField&gt;(200); Fory fory2 = Fory.Builder().Compatible(true).Build(); fory2.Register&lt;TwoStringField&gt;(200); byte[] payload = fory1.Serialize(new OneStringField { F1 = &quot;hello&quot; }); TwoStringField evolved = fory2.Deserialize&lt;TwoStringField&gt;(payload); // F2 falls back to default value on reader side. System.Diagnostics.Debug.Assert(evolved.F1 == &quot;hello&quot;); System.Diagnostics.Debug.Assert(evolved.F2 == string.Empty);   ","version":"dev","tagName":"h2"},{"title":"Schema-Consistent Mode with Version Check‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/csharp/schema_evolution#schema-consistent-mode-with-version-check","content":" If you want strict schema identity checks instead of evolution behavior:  Fory strict = Fory.Builder() .Compatible(false) .CheckStructVersion(true) .Build();   This mode throws on schema hash mismatches.  ","version":"dev","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/csharp/schema_evolution#best-practices","content":" Use Compatible(true) for independently deployed services.Keep stable type IDs across versions.Add new fields with safe defaults.Use CheckStructVersion(true) when strict matching is required.  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/csharp/schema_evolution#related-topics","content":" ConfigurationType RegistrationTroubleshooting ","version":"dev","tagName":"h2"},{"title":"Troubleshooting","type":0,"sectionRef":"#","url":"/docs/next/guide/csharp/troubleshooting","content":"","keywords":"","version":"dev"},{"title":"TypeNotRegisteredException‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/csharp/troubleshooting#typenotregisteredexception","content":" Symptom: Type not registered: ...  Cause: A user type was serialized/deserialized without registration.  Fix:  Fory fory = Fory.Builder().Build(); fory.Register&lt;MyType&gt;(100);   Ensure the same type-ID/name mapping exists on both write and read sides.  ","version":"dev","tagName":"h2"},{"title":"InvalidDataException: xlang bitmap mismatch‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/csharp/troubleshooting#invaliddataexception-xlang-bitmap-mismatch","content":" Cause: Writer/reader disagree on Xlang mode.  Fix: Use the same Xlang(...) value on both peers.  Fory writer = Fory.Builder().Xlang(true).Build(); Fory reader = Fory.Builder().Xlang(true).Build();   ","version":"dev","tagName":"h2"},{"title":"Schema Version Mismatch in Strict Mode‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/csharp/troubleshooting#schema-version-mismatch-in-strict-mode","content":" Symptom: InvalidDataException while deserializing generated struct types.  Cause: Compatible(false) with CheckStructVersion(true) enforces exact schema hashes.  Fix options:  Enable Compatible(true) for schema evolution.Keep writer/reader model definitions in sync.  ","version":"dev","tagName":"h2"},{"title":"Circular Reference Failures‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/csharp/troubleshooting#circular-reference-failures","content":" Symptom: Stack overflow-like recursion or graph reconstruction issues.  Cause: Cyclic graphs with TrackRef(false).  Fix:  Fory fory = Fory.Builder().TrackRef(true).Build();   ","version":"dev","tagName":"h2"},{"title":"Concurrency Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/csharp/troubleshooting#concurrency-issues","content":" Cause: Sharing a single Fory instance across threads.  Fix: Use BuildThreadSafe().  ","version":"dev","tagName":"h2"},{"title":"Validation Commands‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/csharp/troubleshooting#validation-commands","content":" Run C# tests from repo root:  cd csharp dotnet test Fory.sln -c Release   ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/csharp/troubleshooting#related-topics","content":" ConfigurationSchema EvolutionThread Safety ","version":"dev","tagName":"h2"},{"title":"Development","type":0,"sectionRef":"#","url":"/docs/next/guide/development","content":"","keywords":"","version":"dev"},{"title":"How to build Apache Fory‚Ñ¢‚Äã","type":1,"pageTitle":"Development","url":"/docs/next/guide/development#how-to-build-apache-fory","content":" Clone the source tree from https://github.com/apache/fory.  ","version":"dev","tagName":"h2"},{"title":"Build Apache Fory‚Ñ¢ Java‚Äã","type":1,"pageTitle":"Development","url":"/docs/next/guide/development#build-apache-fory-java","content":" cd java mvn -T16 package   Environment Requirements‚Äã  JDK 17+Maven 3.6.3+  ","version":"dev","tagName":"h3"},{"title":"Build Apache Fory‚Ñ¢ Python‚Äã","type":1,"pageTitle":"Development","url":"/docs/next/guide/development#build-apache-fory-python","content":" cd python pip install -v -e . # Optional: build Cython extension (replace X.Y with your Python version) bazel build //:cp_fory_so --@rules_python//python/config_settings:python_version=X.Y   Environment Requirements‚Äã  CPython 3.8+Bazel 8+ (required when building Cython extensions)  ","version":"dev","tagName":"h3"},{"title":"Build Apache Fory‚Ñ¢ C++‚Äã","type":1,"pageTitle":"Development","url":"/docs/next/guide/development#build-apache-fory-c","content":" cd cpp bazel build //cpp/...   Environment Requirements‚Äã  C++17 compilerBazel 8+  ","version":"dev","tagName":"h3"},{"title":"Build Apache Fory‚Ñ¢ Go‚Äã","type":1,"pageTitle":"Development","url":"/docs/next/guide/development#build-apache-fory-go","content":" cd go/fory go test -v ./...   Run Go xlang tests from Java test module:  cd java mvn -T16 install -DskipTests cd fory-core FORY_GO_JAVA_CI=1 ENABLE_FORY_DEBUG_OUTPUT=1 mvn test -Dtest=org.apache.fory.xlang.GoXlangTest   Environment Requirements‚Äã  Go 1.24+  ","version":"dev","tagName":"h3"},{"title":"Build Apache Fory‚Ñ¢ Rust‚Äã","type":1,"pageTitle":"Development","url":"/docs/next/guide/development#build-apache-fory-rust","content":" cd rust cargo build cargo test --features tests # Debug a specific test RUST_BACKTRACE=1 FORY_PANIC_ON_ERROR=1 ENABLE_FORY_DEBUG_OUTPUT=1 \\ cargo test --test mod $dir$::$test_file::$test_method -- --nocapture   Environment Requirements‚Äã  Rust toolchain via rustupcargo-expand (optional, for macro expansion debugging)  ","version":"dev","tagName":"h3"},{"title":"Build Apache Fory‚Ñ¢ JavaScript‚Äã","type":1,"pageTitle":"Development","url":"/docs/next/guide/development#build-apache-fory-javascript","content":" cd javascript npm install npm run build node ./node_modules/.bin/jest --ci --reporters=default --reporters=jest-junit   Environment Requirements‚Äã  Node.js (LTS)npm  ","version":"dev","tagName":"h3"},{"title":"Lint Markdown Docs‚Äã","type":1,"pageTitle":"Development","url":"/docs/next/guide/development#lint-markdown-docs","content":" cd docs npx prettier --write &quot;**/*.md&quot;   Environment Requirements‚Äã  Node.js (LTS)npm  ","version":"dev","tagName":"h3"},{"title":"Contributing‚Äã","type":1,"pageTitle":"Development","url":"/docs/next/guide/development#contributing","content":" For contribution details, see How to contribute to Apache Fory‚Ñ¢. ","version":"dev","tagName":"h2"},{"title":"Type Registration","type":0,"sectionRef":"#","url":"/docs/next/guide/csharp/type_registration","content":"","keywords":"","version":"dev"},{"title":"Register by Numeric Type ID‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/csharp/type_registration#register-by-numeric-type-id","content":" Use explicit IDs for compact and stable cross-service mapping.  Fory fory = Fory.Builder().Build(); fory.Register&lt;User&gt;(100); fory.Register&lt;Order&gt;(101);   ","version":"dev","tagName":"h2"},{"title":"Register by Type Name‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/csharp/type_registration#register-by-type-name","content":" Use namespace + type name registration when you prefer symbolic mappings.  Fory fory = Fory.Builder().Build(); fory.Register&lt;User&gt;(&quot;com.example&quot;, &quot;User&quot;);   You can also use the short overload:  fory.Register&lt;User&gt;(&quot;User&quot;);   ","version":"dev","tagName":"h2"},{"title":"Register a Custom Serializer‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/csharp/type_registration#register-a-custom-serializer","content":" Fory fory = Fory.Builder().Build(); fory.Register&lt;MyType, MyTypeSerializer&gt;(200);   Namespace-based custom serializer registration is also supported:  fory.Register&lt;MyType, MyTypeSerializer&gt;(&quot;com.example&quot;, &quot;MyType&quot;);   ","version":"dev","tagName":"h2"},{"title":"Thread-Safe Registration‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/csharp/type_registration#thread-safe-registration","content":" ThreadSafeFory exposes the same registration APIs. Registrations are propagated to all per-thread runtimes.  using ThreadSafeFory fory = Fory.Builder().BuildThreadSafe(); fory.Register&lt;User&gt;(100); fory.Register&lt;Order&gt;(101);   ","version":"dev","tagName":"h2"},{"title":"Registration Rules‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/csharp/type_registration#registration-rules","content":" Register user-defined types on both writer and reader sides.Keep ID/name mappings consistent across services and languages.Register before high-volume serialization workloads to avoid runtime misses.  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/csharp/type_registration#related-topics","content":" Basic SerializationCustom SerializersCross-Language ","version":"dev","tagName":"h2"},{"title":"Go Serialization Guide","type":0,"sectionRef":"#","url":"/docs/next/guide/go/","content":"","keywords":"","version":"dev"},{"title":"Why Fory Go?‚Äã","type":1,"pageTitle":"Go Serialization Guide","url":"/docs/next/guide/go/#why-fory-go","content":" High Performance: Fast serialization and optimized binary protocolsCross-Language: Seamless data exchange with Java, Python, C++, Rust, and JavaScriptAutomatic Serialization: No IDL definitions or schema compilation requiredReference Tracking: Built-in support for circular references and shared objectsType Safety: Strong typing with compile-time verification (optional codegen)Schema Evolution: Compatible mode for forward/backward compatibilityThread-Safe Option: Pool-based thread-safe wrapper for concurrent use  ","version":"dev","tagName":"h2"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Go Serialization Guide","url":"/docs/next/guide/go/#quick-start","content":" ","version":"dev","tagName":"h2"},{"title":"Installation‚Äã","type":1,"pageTitle":"Go Serialization Guide","url":"/docs/next/guide/go/#installation","content":" Requirements: Go 1.24 or later  go get github.com/apache/fory/go/fory   ","version":"dev","tagName":"h3"},{"title":"Basic Usage‚Äã","type":1,"pageTitle":"Go Serialization Guide","url":"/docs/next/guide/go/#basic-usage","content":" package main import ( &quot;fmt&quot; &quot;github.com/apache/fory/go/fory&quot; ) type User struct { ID int64 Name string Age int32 } func main() { // Create a Fory instance f := fory.New() // Register struct with a type ID if err := f.RegisterStruct(User{}, 1); err != nil { panic(err) } // Serialize user := &amp;User{ID: 1, Name: &quot;Alice&quot;, Age: 30} data, err := f.Serialize(user) if err != nil { panic(err) } // Deserialize var result User if err := f.Deserialize(data, &amp;result); err != nil { panic(err) } fmt.Printf(&quot;Deserialized: %+v\\n&quot;, result) // Output: Deserialized: {ID:1 Name:Alice Age:30} }   ","version":"dev","tagName":"h3"},{"title":"Architecture‚Äã","type":1,"pageTitle":"Go Serialization Guide","url":"/docs/next/guide/go/#architecture","content":" Fory Go provides two serialization paths:  ","version":"dev","tagName":"h2"},{"title":"Reflection-Based (Default)‚Äã","type":1,"pageTitle":"Go Serialization Guide","url":"/docs/next/guide/go/#reflection-based-default","content":" The default path uses Go's reflection to inspect types at runtime. This works out-of-the-box with any struct. Although this mode uses reflection, it is highly optimized with type caching, inlined hot paths, delivering excellent performance for most use cases:  f := fory.New() data, _ := f.Serialize(myStruct)   ","version":"dev","tagName":"h3"},{"title":"Code Generation (Experimental)‚Äã","type":1,"pageTitle":"Go Serialization Guide","url":"/docs/next/guide/go/#code-generation-experimental","content":" For performance-critical paths, Fory provides optional ahead-of-time code generation that eliminates reflection overhead. See the Code Generation guide for details.  ","version":"dev","tagName":"h3"},{"title":"Configuration‚Äã","type":1,"pageTitle":"Go Serialization Guide","url":"/docs/next/guide/go/#configuration","content":" Fory Go uses a functional options pattern for configuration:  f := fory.New( fory.WithTrackRef(true), // Enable reference tracking fory.WithCompatible(true), // Enable schema evolution fory.WithMaxDepth(20), // Set max nesting depth )   See Configuration for all available options.  ","version":"dev","tagName":"h2"},{"title":"Supported Types‚Äã","type":1,"pageTitle":"Go Serialization Guide","url":"/docs/next/guide/go/#supported-types","content":" Fory Go supports a wide range of types:  Primitives: bool, int8-int64, uint8-uint64, float32, float64, stringCollections: slices, maps, setsTime: time.Time, time.DurationPointers: pointer types with automatic nil handlingStructs: any struct with exported fields  See Supported Types for the complete type mapping.  ","version":"dev","tagName":"h2"},{"title":"Cross-Language Serialization‚Äã","type":1,"pageTitle":"Go Serialization Guide","url":"/docs/next/guide/go/#cross-language-serialization","content":" Fory Go is fully compatible with other Fory implementations. Data serialized in Go can be deserialized in Java, Python, C++, Rust, or JavaScript:  // Go serialization f := fory.New() f.RegisterStruct(User{}, 1) data, _ := f.Serialize(&amp;User{ID: 1, Name: &quot;Alice&quot;}) // 'data' can be deserialized by Java, Python, etc.   See Cross-Language Serialization for type mapping and compatibility details.  ","version":"dev","tagName":"h2"},{"title":"Documentation‚Äã","type":1,"pageTitle":"Go Serialization Guide","url":"/docs/next/guide/go/#documentation","content":" Topic\tDescriptionConfiguration\tOptions and settings Basic Serialization\tCore APIs and usage patterns Type Registration\tRegistering types for serialization Supported Types\tComplete type support reference References\tCircular references and shared objects Struct Tags\tField-level configuration Schema Evolution\tForward/backward compatibility Cross-Language\tMulti-language serialization Code Generation\tExperimental AOT code generation Thread Safety\tConcurrent usage patterns Troubleshooting\tCommon issues and solutions  ","version":"dev","tagName":"h2"},{"title":"Related Resources‚Äã","type":1,"pageTitle":"Go Serialization Guide","url":"/docs/next/guide/go/#related-resources","content":" Xlang Serialization SpecificationCross-Language Type MappingGitHub Repository ","version":"dev","tagName":"h2"},{"title":"Code Generation","type":0,"sectionRef":"#","url":"/docs/next/guide/go/codegen","content":"","keywords":"","version":"dev"},{"title":"Why Code Generation?‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#why-code-generation","content":" Aspect\tReflection-Based\tCode GenerationSetup\tZero configuration\tRequires go generate Performance\tGood\tBetter (no reflection) Type Safety\tRuntime\tCompile-time Maintenance\tAutomatic\tRequires regeneration  Use code generation when:  Maximum performance is requiredCompile-time type safety is importantHot paths are performance-critical  Use reflection when:  Simple setup is preferredTypes change frequentlyDynamic typing is neededCode generation complexity is undesirable  ","version":"dev","tagName":"h2"},{"title":"Installation‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#installation","content":" Install the fory generator binary:  go install github.com/apache/fory/go/fory/cmd/fory@latest GO111MODULE=on go get -u github.com/apache/fory/go/fory/cmd/fory   Ensure $GOBIN or $GOPATH/bin is in your PATH.  ","version":"dev","tagName":"h2"},{"title":"Basic Usage‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#basic-usage","content":" ","version":"dev","tagName":"h2"},{"title":"Step 1: Annotate Structs‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#step-1-annotate-structs","content":" Add the //fory:generate comment above structs:  package models //fory:generate type User struct { ID int64 `json:&quot;id&quot;` Name string `json:&quot;name&quot;` } //fory:generate type Order struct { ID int64 Customer string Total float64 }   ","version":"dev","tagName":"h3"},{"title":"Step 2: Add Go Generate Directive‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#step-2-add-go-generate-directive","content":" Add a go:generate directive (once per file or package):  //go:generate fory -file models.go   Or for the entire package:  //go:generate fory -pkg .   ","version":"dev","tagName":"h3"},{"title":"Step 3: Run Code Generation‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#step-3-run-code-generation","content":" go generate ./...   This creates models_fory_gen.go with generated serializers.  ","version":"dev","tagName":"h3"},{"title":"Generated Code Structure‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#generated-code-structure","content":" The generator creates:  ","version":"dev","tagName":"h2"},{"title":"Type Snapshot‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#type-snapshot","content":" A compile-time check to detect struct changes:  // Snapshot of User's underlying type at generation time type _User_expected struct { ID int64 Name string } // Compile-time check: fails if User no longer matches var _ = func(x User) { _ = _User_expected(x) }   ","version":"dev","tagName":"h3"},{"title":"Serializer Implementation‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#serializer-implementation","content":" Strongly-typed serialization methods:  type User_ForyGenSerializer struct{} func NewSerializerFor_User() fory.Serializer { return &amp;User_ForyGenSerializer{} } func (User_ForyGenSerializer) WriteTyped(ctx *fory.WriteContext, v *User) error { buf := ctx.Buffer() buf.WriteInt64(v.ID) ctx.WriteString(v.Name) return nil } func (User_ForyGenSerializer) ReadTyped(ctx *fory.ReadContext, v *User) error { err := ctx.Err() buf := ctx.Buffer() v.ID = buf.ReadInt64(err) v.Name = ctx.ReadString() if ctx.HasError() { return ctx.TakeError() } return nil }   ","version":"dev","tagName":"h3"},{"title":"Auto-Registration‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#auto-registration","content":" Serializers are registered in init():  func init() { fory.RegisterSerializerFactory((*User)(nil), NewSerializerFor_User) }   ","version":"dev","tagName":"h3"},{"title":"Command-Line Options‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#command-line-options","content":" ","version":"dev","tagName":"h2"},{"title":"File-Based Generation‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#file-based-generation","content":" Generate for a specific file:  fory -file models.go   ","version":"dev","tagName":"h3"},{"title":"Package-Based Generation‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#package-based-generation","content":" Generate for a package:  fory -pkg ./models   ","version":"dev","tagName":"h3"},{"title":"Explicit Types (Legacy)‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#explicit-types-legacy","content":" Specify types explicitly:  fory -pkg ./models -type &quot;User,Order&quot;   ","version":"dev","tagName":"h3"},{"title":"Force Regeneration‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#force-regeneration","content":" Force regeneration even if up-to-date:  fory --force -file models.go   ","version":"dev","tagName":"h3"},{"title":"When to Regenerate‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#when-to-regenerate","content":" Regenerate when any of these change:  Field additions, removals, or renamesField type changesStruct tag changesNew structs with //fory:generate  ","version":"dev","tagName":"h2"},{"title":"Automatic Detection‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#automatic-detection","content":" Fory includes a compile-time guard:  // If struct changed, this fails to compile var _ = func(x User) { _ = _User_expected(x) }   If you forget to regenerate, the build fails with a clear message.  ","version":"dev","tagName":"h3"},{"title":"Auto-Retry‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#auto-retry","content":" When invoked via go generate, the generator detects stale code and retries:  Detects compile error from guardRemoves stale generated fileRegenerates fresh code  ","version":"dev","tagName":"h3"},{"title":"Supported Types‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#supported-types","content":" Code generation supports:  All primitive types (bool, int*, uint*, float*, string)Slices of primitives and structsMaps with supported key/value typesNested structs (must also be generated)Pointers to structs  ","version":"dev","tagName":"h2"},{"title":"Nested Structs‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#nested-structs","content":" All nested structs must also have //fory:generate:  //fory:generate type Address struct { City string Country string } //fory:generate type Person struct { Name string Address Address // Address must also be generated }   ","version":"dev","tagName":"h3"},{"title":"CI/CD Integration‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#cicd-integration","content":" ","version":"dev","tagName":"h2"},{"title":"Check In Generated Code‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#check-in-generated-code","content":" Recommended for libraries:  go generate ./... git add *_fory_gen.go git commit -m &quot;Regenerate Fory serializers&quot;   Pros: Consumers can build without generator; reproducible buildsCons: Larger diffs; must remember to regenerate  ","version":"dev","tagName":"h3"},{"title":"Generate in Pipeline‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#generate-in-pipeline","content":" Recommended for applications:  steps: - run: go install github.com/apache/fory/go/fory/cmd/fory@latest - run: go generate ./... - run: go build ./...   ","version":"dev","tagName":"h3"},{"title":"Usage with Generated Code‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#usage-with-generated-code","content":" Generated code integrates transparently:  f := fory.New() // Fory automatically uses generated serializer if available user := &amp;User{ID: 1, Name: &quot;Alice&quot;} data, _ := f.Serialize(user) var result User f.Deserialize(data, &amp;result)   No code changes needed - registration happens in init().  ","version":"dev","tagName":"h2"},{"title":"Mixing Generated and Non-Generated‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#mixing-generated-and-non-generated","content":" You can mix approaches:  //fory:generate type HotPathStruct struct { // Performance-critical, use codegen } type ColdPathStruct struct { // Not annotated, uses reflection }   ","version":"dev","tagName":"h2"},{"title":"Limitations‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#limitations","content":" ","version":"dev","tagName":"h2"},{"title":"Experimental Status‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#experimental-status","content":" API may changeNot all edge cases testedMay have undiscovered bugs  ","version":"dev","tagName":"h3"},{"title":"Not Supported‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#not-supported","content":" Interface fields (dynamic types)Recursive types without pointersPrivate (unexported) fieldsCustom serializers  ","version":"dev","tagName":"h3"},{"title":"Reflection Fallback‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#reflection-fallback","content":" If codegen fails, Fory falls back to reflection:  // If User_ForyGenSerializer not found, uses reflection f.Serialize(&amp;User{})   ","version":"dev","tagName":"h3"},{"title":"Troubleshooting‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#troubleshooting","content":" ","version":"dev","tagName":"h2"},{"title":"\"fory: command not found\"‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#fory-command-not-found","content":" Ensure the binary is in PATH:  export PATH=$PATH:$(go env GOPATH)/bin   ","version":"dev","tagName":"h3"},{"title":"Compile Error After Struct Change‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#compile-error-after-struct-change","content":" Regenerate:  go generate ./...   Or force:  fory --force -file yourfile.go   ","version":"dev","tagName":"h3"},{"title":"Generated Code Out of Sync‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#generated-code-out-of-sync","content":" The compile-time guard catches this:  cannot use x (variable of type User) as type _User_expected in argument   Run go generate to fix.  ","version":"dev","tagName":"h3"},{"title":"Example Project Structure‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#example-project-structure","content":" myproject/ ‚îú‚îÄ‚îÄ models/ ‚îÇ ‚îú‚îÄ‚îÄ models.go # Struct definitions ‚îÇ ‚îú‚îÄ‚îÄ models_fory_gen.go # Generated code ‚îÇ ‚îî‚îÄ‚îÄ generate.go # go:generate directive ‚îú‚îÄ‚îÄ main.go ‚îî‚îÄ‚îÄ go.mod   models/generate.go:  package models //go:generate fory -pkg .   models/models.go:  package models //fory:generate type User struct { ID int64 Name string }   ","version":"dev","tagName":"h2"},{"title":"FAQ‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#faq","content":" ","version":"dev","tagName":"h2"},{"title":"Is codegen required?‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#is-codegen-required","content":" No. Reflection-based serialization works without code generation.  ","version":"dev","tagName":"h3"},{"title":"Does generated code work across Go versions?‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#does-generated-code-work-across-go-versions","content":" Yes. Generated code is plain Go with no version-specific features.  ","version":"dev","tagName":"h3"},{"title":"Can I mix generated and non-generated types?‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#can-i-mix-generated-and-non-generated-types","content":" Yes. Fory automatically uses generated serializers when available.  ","version":"dev","tagName":"h3"},{"title":"How do I update generated code?‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#how-do-i-update-generated-code","content":" Run go generate ./... after struct changes.  ","version":"dev","tagName":"h3"},{"title":"Should I commit generated files?‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#should-i-commit-generated-files","content":" For libraries: yes. For applications: either works.  ","version":"dev","tagName":"h3"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/next/guide/go/codegen#related-topics","content":" Basic SerializationConfigurationTroubleshooting ","version":"dev","tagName":"h2"},{"title":"Configuration","type":0,"sectionRef":"#","url":"/docs/next/guide/go/configuration","content":"","keywords":"","version":"dev"},{"title":"Creating a Fory Instance‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/go/configuration#creating-a-fory-instance","content":" ","version":"dev","tagName":"h2"},{"title":"Default Configuration‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/go/configuration#default-configuration","content":" import &quot;github.com/apache/fory/go/fory&quot; f := fory.New()   Default settings:  Option\tDefault\tDescriptionTrackRef\tfalse\tReference tracking disabled MaxDepth\t20\tMaximum nesting depth IsXlang\tfalse\tCross-language mode disabled Compatible\tfalse\tSchema evolution mode disabled  ","version":"dev","tagName":"h3"},{"title":"With Options‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/go/configuration#with-options","content":" f := fory.New( fory.WithTrackRef(true), fory.WithCompatible(true), fory.WithMaxDepth(10), )   ","version":"dev","tagName":"h3"},{"title":"Configuration Options‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/go/configuration#configuration-options","content":" ","version":"dev","tagName":"h2"},{"title":"WithTrackRef‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/go/configuration#withtrackref","content":" Enable reference tracking to handle circular references and shared objects:  f := fory.New(fory.WithTrackRef(true))   When enabled:  Objects appearing multiple times are serialized onceCircular references are handled correctlyPer-field fory:&quot;ref&quot; tags take effectAdds overhead for tracking object identity  When disabled (default):  Each object occurrence is serialized independentlyCircular references cause stack overflow or max depth errorPer-field fory:&quot;ref&quot; tags are ignoredBetter performance for simple data structures  Use reference tracking when:  Data contains circular referencesSame object is referenced multiple timesSerializing graph structures (trees with parent pointers, linked lists with cycles)  See References for details.  ","version":"dev","tagName":"h3"},{"title":"WithCompatible‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/go/configuration#withcompatible","content":" Enable compatible mode for schema evolution:  f := fory.New(fory.WithCompatible(true))   When enabled:  Type metadata is written to serialized dataSupports adding/removing fields between versionsField names or ids are used for matching (order-independent)Larger serialized output due to metadata  When disabled (default):  Compact serialization without field metadataFaster serialization and smaller outputFields matched by sorted orderRequires consistent struct definitions across all services  See Schema Evolution for details.  ","version":"dev","tagName":"h3"},{"title":"WithMaxDepth‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/go/configuration#withmaxdepth","content":" Set the maximum nesting depth to prevent stack overflow:  f := fory.New(fory.WithMaxDepth(30))   Default: 20Protects against deeply nested, recursive structures or malicious dataSerialization fails with error when exceeded  ","version":"dev","tagName":"h3"},{"title":"WithXlang‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/go/configuration#withxlang","content":" Enable cross-language serialization mode:  f := fory.New(fory.WithXlang(true))   When enabled:  Uses cross-language type systemCompatible with Java, Python, C++, Rust, JavaScriptType IDs follow xlang specification  When disabled (default):  Go-native serialization modeSupport more Go-native typesNot compatible with other language implementations  ","version":"dev","tagName":"h3"},{"title":"Thread Safety‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/go/configuration#thread-safety","content":" The default Fory instance is NOT thread-safe. For concurrent use, use the thread-safe wrapper:  import &quot;github.com/apache/fory/go/fory/threadsafe&quot; // Create thread-safe Fory with same options f := threadsafe.New( fory.WithTrackRef(true), fory.WithCompatible(true), ) // Safe for concurrent use from multiple goroutines go func() { data, _ := f.Serialize(value1) // data is already copied, safe to use after return }() go func() { data, _ := f.Serialize(value2) }()   The thread-safe wrapper:  Uses sync.Pool internally for efficient instance reuseAutomatically copies serialized data before returningAccepts the same configuration options as fory.New()  ","version":"dev","tagName":"h2"},{"title":"Global Thread-Safe Instance‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/go/configuration#global-thread-safe-instance","content":" For convenience, the threadsafe package provides global functions:  import &quot;github.com/apache/fory/go/fory/threadsafe&quot; // Uses a global thread-safe instance with default configuration data, err := threadsafe.Marshal(&amp;myValue) err = threadsafe.Unmarshal(data, &amp;result)   See Thread Safety for details.  ","version":"dev","tagName":"h3"},{"title":"Buffer Management‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/go/configuration#buffer-management","content":" ","version":"dev","tagName":"h2"},{"title":"Zero-Copy Behavior‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/go/configuration#zero-copy-behavior","content":" The default Fory instance reuses its internal buffer:  f := fory.New() data1, _ := f.Serialize(value1) // WARNING: data1 becomes invalid after next Serialize call! data2, _ := f.Serialize(value2) // data1 now points to invalid memory // To keep the data, copy it: safeCopy := make([]byte, len(data1)) copy(safeCopy, data1)   The thread-safe wrapper automatically copies data, so this is not a concern:  f := threadsafe.New() data1, _ := f.Serialize(value1) data2, _ := f.Serialize(value2) // Both data1 and data2 are valid   ","version":"dev","tagName":"h3"},{"title":"Manual Buffer Control‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/go/configuration#manual-buffer-control","content":" For high-throughput scenarios, you can manage buffers manually:  f := fory.New() buf := fory.NewByteBuffer(nil) // Serialize to existing buffer err := f.SerializeTo(buf, value) // Get serialized data data := buf.GetByteSlice(0, buf.WriterIndex()) // Process data... // Reset for next use buf.Reset()   ","version":"dev","tagName":"h3"},{"title":"Configuration Examples‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/go/configuration#configuration-examples","content":" ","version":"dev","tagName":"h2"},{"title":"Simple Data (Default)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/go/configuration#simple-data-default","content":" For simple structs without circular references:  f := fory.New() type Config struct { Host string Port int32 } f.RegisterStruct(Config{}, 1) data, _ := f.Serialize(&amp;Config{Host: &quot;localhost&quot;, Port: 8080})   ","version":"dev","tagName":"h3"},{"title":"Graph Structures‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/go/configuration#graph-structures","content":" For data with circular references:  f := fory.New(fory.WithTrackRef(true)) type Node struct { Value int32 Next *Node `fory:&quot;ref&quot;` } f.RegisterStruct(Node{}, 1) n1 := &amp;Node{Value: 1} n2 := &amp;Node{Value: 2} n1.Next = n2 n2.Next = n1 // Circular reference data, _ := f.Serialize(n1)   ","version":"dev","tagName":"h3"},{"title":"Schema Evolution‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/go/configuration#schema-evolution","content":" For data that may evolve over time:  // V1: original struct type UserV1 struct { ID int64 Name string } // V2: added Email field type UserV2 struct { ID int64 Name string Email string // New field } // Serialize with V1 f1 := fory.New(fory.WithCompatible(true)) f1.RegisterStruct(UserV1{}, 1) data, _ := f1.Serialize(&amp;UserV1{ID: 1, Name: &quot;Alice&quot;}) // Deserialize into V2 - Email will have zero value f2 := fory.New(fory.WithCompatible(true)) f2.RegisterStruct(UserV2{}, 1) var user UserV2 f2.Deserialize(data, &amp;user)   ","version":"dev","tagName":"h3"},{"title":"High-Performance Concurrent‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/go/configuration#high-performance-concurrent","content":" For concurrent high-throughput scenarios:  type Request struct { ID int64 Payload string } f := threadsafe.New( fory.WithMaxDepth(30), ) f.RegisterStruct(Request{}, 1) // Process requests concurrently for req := range requests { go func(r Request) { data, _ := f.Serialize(&amp;r) sendResponse(data) }(req) }   ","version":"dev","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/go/configuration#best-practices","content":" Reuse Fory instances: Creating a Fory instance involves initialization overhead. Create once and reuse. Use thread-safe wrapper for concurrency: Never share a non-thread-safe Fory instance across goroutines. Enable reference tracking only when needed: It adds overhead for tracking object identity. Copy serialized data if keeping it: With the default Fory, the returned byte slice is invalidated on the next operation. Set appropriate max depth: Increase for deeply nested structures, but be aware of memory usage. Use compatible mode for evolving schemas: Enable when struct definitions may change between service versions.  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/go/configuration#related-topics","content":" Basic SerializationReferencesSchema EvolutionThread Safety ","version":"dev","tagName":"h2"},{"title":"Cross-Language Serialization","type":0,"sectionRef":"#","url":"/docs/next/guide/go/cross_language","content":"","keywords":"","version":"dev"},{"title":"Enabling Cross-Language Mode‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/go/cross_language#enabling-cross-language-mode","content":" Cross-language (xlang) mode must be explicitly enabled:  f := fory.New(fory.WithXlang(true))   ","version":"dev","tagName":"h2"},{"title":"Type Registration for Cross-Language‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/go/cross_language#type-registration-for-cross-language","content":" Use consistent type IDs across all languages:  ","version":"dev","tagName":"h2"},{"title":"Go‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/go/cross_language#go","content":" type User struct { ID int64 Name string } f := fory.New(fory.WithXlang(true)) f.RegisterStruct(User{}, 1) data, _ := f.Serialize(&amp;User{ID: 1, Name: &quot;Alice&quot;})   ","version":"dev","tagName":"h3"},{"title":"Java‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/go/cross_language#java","content":" public class User { public long id; public String name; } Fory fory = Fory.builder().withXlang(true).build(); fory.register(User.class, 1); User user = fory.deserialize(data, User.class);   ","version":"dev","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/go/cross_language#python","content":" from dataclasses import dataclass import pyfory @dataclass class User: id: pyfory.Int64Type name: str fory = pyfory.Fory(xlang=True) fory.register(User, type_id=1) user = fory.deserialize(data)   ","version":"dev","tagName":"h3"},{"title":"Type Mapping‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/go/cross_language#type-mapping","content":" See Type Mapping Specification for detailed type mappings across all languages.  ","version":"dev","tagName":"h2"},{"title":"Field Ordering‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/go/cross_language#field-ordering","content":" Cross-language serialization requires consistent field ordering. Fory sorts fields by their snake_case names alphabetically.  Go field names are converted to snake_case for sorting:  type Example struct { UserID int64 // -&gt; user_id FirstName string // -&gt; first_name Age int32 // -&gt; age } // Sorted order: age, first_name, user_id   Ensure other languages use matching field names that produce the same snake_case ordering, or use field IDs for explicit control:  type Example struct { UserID int64 `fory:&quot;id=0&quot;` FirstName string `fory:&quot;id=1&quot;` Age int32 `fory:&quot;id=2&quot;` }   ","version":"dev","tagName":"h2"},{"title":"Examples‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/go/cross_language#examples","content":" ","version":"dev","tagName":"h2"},{"title":"Go to Java‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/go/cross_language#go-to-java","content":" Go (Serializer):  type Order struct { ID int64 Customer string Total float64 Items []string } f := fory.New(fory.WithXlang(true)) f.RegisterStruct(Order{}, 1) order := &amp;Order{ ID: 12345, Customer: &quot;Alice&quot;, Total: 99.99, Items: []string{&quot;Widget&quot;, &quot;Gadget&quot;}, } data, _ := f.Serialize(order) // Send 'data' to Java service   Java (Deserializer):  public class Order { public long id; public String customer; public double total; public List&lt;String&gt; items; } Fory fory = Fory.builder().withXlang(true).build(); fory.register(Order.class, 1); Order order = fory.deserialize(data, Order.class);   ","version":"dev","tagName":"h3"},{"title":"Python to Go‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/go/cross_language#python-to-go","content":" Python (Serializer):  from dataclasses import dataclass import pyfory @dataclass class Message: id: pyfory.Int64Type content: str timestamp: pyfory.Int64Type fory = pyfory.Fory(xlang=True) fory.register(Message, type_id=1) msg = Message(id=1, content=&quot;Hello from Python&quot;, timestamp=1234567890) data = fory.serialize(msg)   Go (Deserializer):  type Message struct { ID int64 Content string Timestamp int64 } f := fory.New(fory.WithXlang(true)) f.RegisterStruct(Message{}, 1) var msg Message f.Deserialize(data, &amp;msg) fmt.Println(msg.Content) // &quot;Hello from Python&quot;   ","version":"dev","tagName":"h3"},{"title":"Nested Structures‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/go/cross_language#nested-structures","content":" Cross-language nested structures require all types to be registered:  Go:  type Address struct { Street string City string Country string } type Company struct { Name string Address Address } f := fory.New(fory.WithXlang(true)) f.RegisterStruct(Address{}, 1) f.RegisterStruct(Company{}, 2)   Java:  public class Address { public String street; public String city; public String country; } public class Company { public String name; public Address address; } fory.register(Address.class, 1); fory.register(Company.class, 2);   ","version":"dev","tagName":"h3"},{"title":"Common Issues‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/go/cross_language#common-issues","content":" ","version":"dev","tagName":"h2"},{"title":"Field Name Mismatch‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/go/cross_language#field-name-mismatch","content":" Go uses PascalCase, other languages may use camelCase or snake_case. Fields are matched by their snake_case conversion:  // Go type User struct { FirstName string // -&gt; first_name } // Java - field name converted to snake_case must match public class User { public String firstName; // -&gt; first_name (matches) }   ","version":"dev","tagName":"h3"},{"title":"Type Interpretation‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/go/cross_language#type-interpretation","content":" Go unsigned types map to Java signed types with the same bit pattern:  var value uint64 = 18446744073709551615 // Max uint64   Java's long holds the same bits but interprets as -1. Use Long.toUnsignedString() in Java if unsigned interpretation is needed.  ","version":"dev","tagName":"h3"},{"title":"Nil vs Null‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/go/cross_language#nil-vs-null","content":" Go nil slices/maps serialize differently based on configuration:  var slice []string = nil // In xlang mode: serializes based on nullable configuration   Ensure other languages handle null appropriately.  ","version":"dev","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/go/cross_language#best-practices","content":" Use consistent type IDs: Same numeric ID for the same type across all languagesRegister all types: Including nested struct typesMatch field ordering: Use same snake_case names or explicit field IDsTest cross-language: Run integration tests early and oftenHandle type differences: Be aware of signed/unsigned interpretation differences  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/go/cross_language#related-topics","content":" Type RegistrationSupported TypesSchema EvolutionXlang Serialization SpecificationType Mapping Specification ","version":"dev","tagName":"h2"},{"title":"Basic Serialization","type":0,"sectionRef":"#","url":"/docs/next/guide/go/basic_serialization","content":"","keywords":"","version":"dev"},{"title":"Creating a Fory Instance‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/go/basic_serialization#creating-a-fory-instance","content":" Create a Fory instance and register your types before serialization:  import &quot;github.com/apache/fory/go/fory&quot; f := fory.New() // Register struct with a type ID f.RegisterStruct(User{}, 1) f.RegisterStruct(Order{}, 2) // Or register with a name (more flexible, less prone to ID conflicts, but higher serialization cost) f.RegisterNamedStruct(User{}, &quot;example.User&quot;) // Register enum types f.RegisterEnum(Color(0), 3)   Important: The Fory instance should be reused across serialization calls. Creating a new instance involves allocating internal buffers, type caches, and resolvers, which is expensive. The default Fory instance is not thread-safe; for concurrent usage, use the thread-safe wrapper (see Thread Safety).  See Type Registration for more details.  ","version":"dev","tagName":"h2"},{"title":"Core API‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/go/basic_serialization#core-api","content":" ","version":"dev","tagName":"h2"},{"title":"Serialize and Deserialize‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/go/basic_serialization#serialize-and-deserialize","content":" The primary API for serialization:  // Serialize any value data, err := f.Serialize(value) if err != nil { // Handle error } // Deserialize into target var result MyType err = f.Deserialize(data, &amp;result) if err != nil { // Handle error }   ","version":"dev","tagName":"h3"},{"title":"Marshal and Unmarshal‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/go/basic_serialization#marshal-and-unmarshal","content":" Aliases for Serialize and Deserialize (familiar to Go developers):  data, err := f.Marshal(value) err = f.Unmarshal(data, &amp;result)   ","version":"dev","tagName":"h3"},{"title":"Serializing Primitives‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/go/basic_serialization#serializing-primitives","content":" // Integers data, _ := f.Serialize(int64(42)) var i int64 f.Deserialize(data, &amp;i) // i = 42 // Floats data, _ = f.Serialize(float64(3.14)) var fl float64 f.Deserialize(data, &amp;fl) // fl = 3.14 // Strings data, _ = f.Serialize(&quot;hello&quot;) var s string f.Deserialize(data, &amp;s) // s = &quot;hello&quot; // Booleans data, _ = f.Serialize(true) var b bool f.Deserialize(data, &amp;b) // b = true   ","version":"dev","tagName":"h2"},{"title":"Serializing Collections‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/go/basic_serialization#serializing-collections","content":" ","version":"dev","tagName":"h2"},{"title":"Slices‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/go/basic_serialization#slices","content":" // String slice strs := []string{&quot;a&quot;, &quot;b&quot;, &quot;c&quot;} data, _ := f.Serialize(strs) var result []string f.Deserialize(data, &amp;result) // result = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;] // Integer slice nums := []int64{1, 2, 3} data, _ = f.Serialize(nums) var intResult []int64 f.Deserialize(data, &amp;intResult) // intResult = [1, 2, 3]   ","version":"dev","tagName":"h3"},{"title":"Maps‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/go/basic_serialization#maps","content":" // String to string map m := map[string]string{&quot;key&quot;: &quot;value&quot;} data, _ := f.Serialize(m) var result map[string]string f.Deserialize(data, &amp;result) // result = {&quot;key&quot;: &quot;value&quot;} // String to int map m2 := map[string]int64{&quot;count&quot;: 42} data, _ = f.Serialize(m2) var result2 map[string]int64 f.Deserialize(data, &amp;result2) // result2 = {&quot;count&quot;: 42}   ","version":"dev","tagName":"h3"},{"title":"Serializing Structs‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/go/basic_serialization#serializing-structs","content":" ","version":"dev","tagName":"h2"},{"title":"Basic Struct Serialization‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/go/basic_serialization#basic-struct-serialization","content":" Only exported fields (starting with uppercase) are serialized:  type User struct { ID int64 // Serialized Name string // Serialized password string // NOT serialized (unexported) } f.RegisterStruct(User{}, 1) user := &amp;User{ID: 1, Name: &quot;Alice&quot;, password: &quot;secret&quot;} data, _ := f.Serialize(user) var result User f.Deserialize(data, &amp;result) // result.ID = 1, result.Name = &quot;Alice&quot;, result.password = &quot;&quot;   ","version":"dev","tagName":"h3"},{"title":"Nested Structs‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/go/basic_serialization#nested-structs","content":" type Address struct { City string Country string } type Person struct { Name string Address Address } f.RegisterStruct(Address{}, 1) f.RegisterStruct(Person{}, 2) person := &amp;Person{ Name: &quot;Alice&quot;, Address: Address{City: &quot;NYC&quot;, Country: &quot;USA&quot;}, } data, _ := f.Serialize(person) var result Person f.Deserialize(data, &amp;result) // result.Address.City = &quot;NYC&quot;   ","version":"dev","tagName":"h3"},{"title":"Pointer Fields‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/go/basic_serialization#pointer-fields","content":" type Node struct { Value int32 Child *Node } // Use WithTrackRef for pointer fields f := fory.New(fory.WithTrackRef(true)) f.RegisterStruct(Node{}, 1) root := &amp;Node{ Value: 1, Child: &amp;Node{Value: 2, Child: nil}, } data, _ := f.Serialize(root) var result Node f.Deserialize(data, &amp;result) // result.Child.Value = 2   ","version":"dev","tagName":"h3"},{"title":"Streaming API‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/go/basic_serialization#streaming-api","content":" For scenarios where you want to control the buffer:  ","version":"dev","tagName":"h2"},{"title":"SerializeTo‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/go/basic_serialization#serializeto","content":" Serialize to an existing buffer:  buf := fory.NewByteBuffer(nil) // Serialize multiple values to same buffer f.SerializeTo(buf, value1) f.SerializeTo(buf, value2) // Get all serialized data data := buf.GetByteSlice(0, buf.WriterIndex())   ","version":"dev","tagName":"h3"},{"title":"DeserializeFrom‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/go/basic_serialization#deserializefrom","content":" Deserialize from an existing buffer:  buf := fory.NewByteBuffer(data) var result1, result2 MyType f.DeserializeFrom(buf, &amp;result1) f.DeserializeFrom(buf, &amp;result2)   ","version":"dev","tagName":"h3"},{"title":"Generic API (Type-Safe)‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/go/basic_serialization#generic-api-type-safe","content":" Fory Go provides generic functions for type-safe serialization:  import &quot;github.com/apache/fory/go/fory&quot; type User struct { ID int64 Name string } // Type-safe serialization user := &amp;User{ID: 1, Name: &quot;Alice&quot;} data, err := fory.Serialize(f, user) // Type-safe deserialization var result User err = fory.Deserialize(f, data, &amp;result)   The generic API:  Infers type at compile timeProvides better type safetyMay offer performance benefits  ","version":"dev","tagName":"h2"},{"title":"Error Handling‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/go/basic_serialization#error-handling","content":" Always check errors from serialization operations:  data, err := f.Serialize(value) if err != nil { switch e := err.(type) { case fory.Error: fmt.Printf(&quot;Fory error: %s (kind: %d)\\n&quot;, e.Error(), e.Kind()) default: fmt.Printf(&quot;Unknown error: %v\\n&quot;, err) } return } err = f.Deserialize(data, &amp;result) if err != nil { // Handle deserialization error }   Common error kinds:  ErrKindBufferOutOfBound: Read/write beyond buffer boundsErrKindTypeMismatch: Type ID mismatch during deserializationErrKindUnknownType: Unknown type encounteredErrKindMaxDepthExceeded: Recursion depth limit exceededErrKindHashMismatch: Struct hash mismatch (schema changed)  See Troubleshooting for error resolution.  ","version":"dev","tagName":"h2"},{"title":"Nil Handling‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/go/basic_serialization#nil-handling","content":" ","version":"dev","tagName":"h2"},{"title":"Nil Pointers‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/go/basic_serialization#nil-pointers","content":" var ptr *User = nil data, _ := f.Serialize(ptr) var result *User f.Deserialize(data, &amp;result) // result = nil   ","version":"dev","tagName":"h3"},{"title":"Empty Collections‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/go/basic_serialization#empty-collections","content":" // Nil slice var slice []string = nil data, _ := f.Serialize(slice) var result []string f.Deserialize(data, &amp;result) // result = nil // Empty slice (different from nil) empty := []string{} data, _ = f.Serialize(empty) f.Deserialize(data, &amp;result) // result = [] (empty, not nil)   ","version":"dev","tagName":"h3"},{"title":"Complete Example‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/go/basic_serialization#complete-example","content":" package main import ( &quot;fmt&quot; &quot;github.com/apache/fory/go/fory&quot; ) type Order struct { ID int64 Customer string Items []Item Total float64 } type Item struct { Name string Quantity int32 Price float64 } func main() { f := fory.New() f.RegisterStruct(Order{}, 1) f.RegisterStruct(Item{}, 2) order := &amp;Order{ ID: 12345, Customer: &quot;Alice&quot;, Items: []Item{ {Name: &quot;Widget&quot;, Quantity: 2, Price: 9.99}, {Name: &quot;Gadget&quot;, Quantity: 1, Price: 24.99}, }, Total: 44.97, } // Serialize data, err := f.Serialize(order) if err != nil { panic(err) } fmt.Printf(&quot;Serialized %d bytes\\n&quot;, len(data)) // Deserialize var result Order if err := f.Deserialize(data, &amp;result); err != nil { panic(err) } fmt.Printf(&quot;Order ID: %d\\n&quot;, result.ID) fmt.Printf(&quot;Customer: %s\\n&quot;, result.Customer) fmt.Printf(&quot;Items: %d\\n&quot;, len(result.Items)) fmt.Printf(&quot;Total: %.2f\\n&quot;, result.Total) }   ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/go/basic_serialization#related-topics","content":" ConfigurationType RegistrationSupported TypesReferences ","version":"dev","tagName":"h2"},{"title":"References","type":0,"sectionRef":"#","url":"/docs/next/guide/go/references","content":"","keywords":"","version":"dev"},{"title":"Enabling Reference Tracking‚Äã","type":1,"pageTitle":"References","url":"/docs/next/guide/go/references#enabling-reference-tracking","content":" Reference tracking is disabled by default. Enable it when creating a Fory instance:  f := fory.New(fory.WithTrackRef(true))   Important: Global reference tracking must be enabled for any reference tracking to occur. When WithTrackRef(false) (the default), all per-field reference tags are ignored.  ","version":"dev","tagName":"h2"},{"title":"How Reference Tracking Works‚Äã","type":1,"pageTitle":"References","url":"/docs/next/guide/go/references#how-reference-tracking-works","content":" ","version":"dev","tagName":"h2"},{"title":"Without Reference Tracking (Default)‚Äã","type":1,"pageTitle":"References","url":"/docs/next/guide/go/references#without-reference-tracking-default","content":" When disabled, each object is serialized independently:  f := fory.New() // TrackRef disabled by default shared := &amp;Data{Value: 42} container := &amp;Container{A: shared, B: shared} data, _ := f.Serialize(container) // 'shared' is serialized TWICE (no deduplication)   ","version":"dev","tagName":"h3"},{"title":"With Reference Tracking‚Äã","type":1,"pageTitle":"References","url":"/docs/next/guide/go/references#with-reference-tracking","content":" When enabled, objects are tracked by identity:  f := fory.New(fory.WithTrackRef(true)) shared := &amp;Data{Value: 42} container := &amp;Container{A: shared, B: shared} data, _ := f.Serialize(container) // 'shared' is serialized ONCE, second occurrence is a reference   ","version":"dev","tagName":"h3"},{"title":"Reference Flags‚Äã","type":1,"pageTitle":"References","url":"/docs/next/guide/go/references#reference-flags","content":" Fory uses flags to indicate reference states during serialization:  Flag\tValue\tMeaningNullFlag\t-3\tNil/null value RefFlag\t-2\tReference to previously serialized object NotNullValueFlag\t-1\tNon-null value (data follows) RefValueFlag\t0\tReference value flag  ","version":"dev","tagName":"h2"},{"title":"Referenceable Types‚Äã","type":1,"pageTitle":"References","url":"/docs/next/guide/go/references#referenceable-types","content":" Only certain types support reference tracking. In xlang mode, the following types can track references:  Type\tReference Tracked\tNotes*struct (pointer to struct)\tYes\tEnable with fory:&quot;ref&quot; tag any (interface)\tYes\tAutomatically tracked []T (slices)\tYes\tEnable with fory:&quot;ref&quot; tag map[K]V\tYes\tEnable with fory:&quot;ref&quot; tag *int, *string, etc.\tNo\tPointer to primitives excluded Primitives\tNo\tValue types time.Time, time.Duration\tNo\tValue types Arrays ([N]T)\tNo\tValue types  ","version":"dev","tagName":"h2"},{"title":"Per-Field Reference Control‚Äã","type":1,"pageTitle":"References","url":"/docs/next/guide/go/references#per-field-reference-control","content":" By default, reference tracking is disabled for individual fields even when global WithTrackRef(true) is set. You can enable reference tracking for specific fields using the ref struct tag:  type Container struct { // Enable ref tracking for this field SharedData *Data `fory:&quot;ref&quot;` // Explicitly disable ref tracking (same as default) SimpleData *Data `fory:&quot;ref=false&quot;` }   Important notes:  Per-field tags only take effect when global WithTrackRef(true) is setWhen global WithTrackRef(false) (default), all field ref tags are ignoredApplies to slices, maps, and pointer to struct fieldsPointer to primitive types (e.g., *int, *string) cannot use this tagDefault is ref=false (no reference tracking per field)  See Struct Tags for more details.  ","version":"dev","tagName":"h2"},{"title":"Circular References‚Äã","type":1,"pageTitle":"References","url":"/docs/next/guide/go/references#circular-references","content":" Reference tracking is required for circular data structures:  ","version":"dev","tagName":"h2"},{"title":"Circular Linked List‚Äã","type":1,"pageTitle":"References","url":"/docs/next/guide/go/references#circular-linked-list","content":" type Node struct { Value int32 Next *Node `fory:&quot;ref&quot;` } f := fory.New(fory.WithTrackRef(true)) f.RegisterStruct(Node{}, 1) // Create circular list n1 := &amp;Node{Value: 1} n2 := &amp;Node{Value: 2} n3 := &amp;Node{Value: 3} n1.Next = n2 n2.Next = n3 n3.Next = n1 // Circular reference back to n1 data, _ := f.Serialize(n1) var result Node f.Deserialize(data, &amp;result) // Circular structure is preserved // result.Next.Next.Next == &amp;result   ","version":"dev","tagName":"h3"},{"title":"Parent-Child Tree‚Äã","type":1,"pageTitle":"References","url":"/docs/next/guide/go/references#parent-child-tree","content":" type TreeNode struct { Value string Parent *TreeNode `fory:&quot;ref&quot;` Children []*TreeNode `fory:&quot;ref&quot;` } f := fory.New(fory.WithTrackRef(true)) f.RegisterStruct(TreeNode{}, 1) root := &amp;TreeNode{Value: &quot;root&quot;} child1 := &amp;TreeNode{Value: &quot;child1&quot;, Parent: root} child2 := &amp;TreeNode{Value: &quot;child2&quot;, Parent: root} root.Children = []*TreeNode{child1, child2} data, _ := f.Serialize(root) var result TreeNode f.Deserialize(data, &amp;result) // result.Children[0].Parent == &amp;result   ","version":"dev","tagName":"h3"},{"title":"Graph Structures‚Äã","type":1,"pageTitle":"References","url":"/docs/next/guide/go/references#graph-structures","content":" type GraphNode struct { ID int32 Neighbors []*GraphNode `fory:&quot;ref&quot;` } f := fory.New(fory.WithTrackRef(true)) f.RegisterStruct(GraphNode{}, 1) // Create a graph a := &amp;GraphNode{ID: 1} b := &amp;GraphNode{ID: 2} c := &amp;GraphNode{ID: 3} // Bidirectional connections a.Neighbors = []*GraphNode{b, c} b.Neighbors = []*GraphNode{a, c} c.Neighbors = []*GraphNode{a, b} data, _ := f.Serialize(a) var result GraphNode f.Deserialize(data, &amp;result)   ","version":"dev","tagName":"h3"},{"title":"Shared Object Deduplication‚Äã","type":1,"pageTitle":"References","url":"/docs/next/guide/go/references#shared-object-deduplication","content":" Reference tracking also deduplicates shared objects:  type Config struct { Setting string } type Application struct { MainConfig *Config `fory:&quot;ref&quot;` BackupConfig *Config `fory:&quot;ref&quot;` FallbackConfig *Config `fory:&quot;ref&quot;` } f := fory.New(fory.WithTrackRef(true)) f.RegisterStruct(Config{}, 1) f.RegisterStruct(Application{}, 2) // Shared configuration config := &amp;Config{Setting: &quot;value&quot;} // Multiple references to same object app := &amp;Application{ MainConfig: config, BackupConfig: config, FallbackConfig: config, } data, _ := f.Serialize(app) // 'config' serialized once, others are references var result Application f.Deserialize(data, &amp;result) // result.MainConfig == result.BackupConfig == result.FallbackConfig   ","version":"dev","tagName":"h2"},{"title":"Performance Considerations‚Äã","type":1,"pageTitle":"References","url":"/docs/next/guide/go/references#performance-considerations","content":" ","version":"dev","tagName":"h2"},{"title":"Overhead‚Äã","type":1,"pageTitle":"References","url":"/docs/next/guide/go/references#overhead","content":" Reference tracking adds overhead:  Memory for tracking seen objects (hash map)Hash lookups during serializationAdditional bytes for reference flags and IDs  ","version":"dev","tagName":"h3"},{"title":"When to Enable‚Äã","type":1,"pageTitle":"References","url":"/docs/next/guide/go/references#when-to-enable","content":" Enable reference tracking when:  Data has circular referencesSame object referenced multiple timesSerializing graph structuresObject identity must be preserved  Disable reference tracking when:  Data is tree-structured (no cycles)Each object appears only onceMaximum performance is requiredObject identity doesn't matter  ","version":"dev","tagName":"h3"},{"title":"Memory Usage‚Äã","type":1,"pageTitle":"References","url":"/docs/next/guide/go/references#memory-usage","content":" Reference tracking maintains a map of serializing objects:  // Internal reference tracking structure type RefResolver struct { writtenObjects map[refKey]int32 // pointer -&gt; reference ID readObjects []reflect.Value // reference ID -&gt; object }   For large object graphs, this may increase memory usage.  ","version":"dev","tagName":"h3"},{"title":"Error Handling‚Äã","type":1,"pageTitle":"References","url":"/docs/next/guide/go/references#error-handling","content":" ","version":"dev","tagName":"h2"},{"title":"Without Reference Tracking‚Äã","type":1,"pageTitle":"References","url":"/docs/next/guide/go/references#without-reference-tracking","content":" Circular references without tracking cause stack overflow or max depth errors:  f := fory.New() // No reference tracking n1 := &amp;Node{Value: 1} n1.Next = n1 // Self-reference data, err := f.Serialize(n1) // Error: max depth exceeded (or stack overflow)   ","version":"dev","tagName":"h3"},{"title":"Invalid Reference ID‚Äã","type":1,"pageTitle":"References","url":"/docs/next/guide/go/references#invalid-reference-id","content":" During deserialization, an invalid reference ID produces an error:  // Error type: ErrKindInvalidRefId   This occurs when serialized data contains a reference to an object that wasn't previously serialized.  ","version":"dev","tagName":"h3"},{"title":"Complete Example‚Äã","type":1,"pageTitle":"References","url":"/docs/next/guide/go/references#complete-example","content":" package main import ( &quot;fmt&quot; &quot;github.com/apache/fory/go/fory&quot; ) type Person struct { Name string Friends []*Person `fory:&quot;ref&quot;` BestFriend *Person `fory:&quot;ref&quot;` } func main() { f := fory.New(fory.WithTrackRef(true)) f.RegisterStruct(Person{}, 1) // Create people with mutual friendships alice := &amp;Person{Name: &quot;Alice&quot;} bob := &amp;Person{Name: &quot;Bob&quot;} charlie := &amp;Person{Name: &quot;Charlie&quot;} alice.Friends = []*Person{bob, charlie} alice.BestFriend = bob bob.Friends = []*Person{alice, charlie} bob.BestFriend = alice // Mutual best friends charlie.Friends = []*Person{alice, bob} // Serialize data, err := f.Serialize(alice) if err != nil { panic(err) } fmt.Printf(&quot;Serialized %d bytes\\n&quot;, len(data)) // Deserialize var result Person if err := f.Deserialize(data, &amp;result); err != nil { panic(err) } // Verify circular references preserved fmt.Printf(&quot;Alice's best friend: %s\\n&quot;, result.BestFriend.Name) fmt.Printf(&quot;Bob's best friend: %s\\n&quot;, result.BestFriend.BestFriend.Name) // Output: Alice (circular reference preserved) }   ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"References","url":"/docs/next/guide/go/references#related-topics","content":" ConfigurationStruct TagsCross-Language Serialization ","version":"dev","tagName":"h2"},{"title":"Schema Evolution","type":0,"sectionRef":"#","url":"/docs/next/guide/go/schema_evolution","content":"","keywords":"","version":"dev"},{"title":"Enabling Compatible Mode‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/go/schema_evolution#enabling-compatible-mode","content":" Enable compatible mode when creating a Fory instance:  f := fory.New(fory.WithCompatible(true))   ","version":"dev","tagName":"h2"},{"title":"How It Works‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/go/schema_evolution#how-it-works","content":" ","version":"dev","tagName":"h2"},{"title":"Without Compatible Mode (Default)‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/go/schema_evolution#without-compatible-mode-default","content":" Compact serialization without metadataStruct hash is checked during deserializationAny schema change causes ErrKindHashMismatch  ","version":"dev","tagName":"h3"},{"title":"With Compatible Mode‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/go/schema_evolution#with-compatible-mode","content":" Type metadata is written to serialized dataSupports adding, removing, and reordering fieldsEnables forward and backward compatibility  ","version":"dev","tagName":"h3"},{"title":"Disable Evolution for Stable Structs‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/go/schema_evolution#disable-evolution-for-stable-structs","content":" If a struct schema is stable and will not change, you can disable evolution for that struct to avoid compatible metadata overhead. Implement the ForyEvolving interface and return false:  type StableMessage struct { ID int64 } func (StableMessage) ForyEvolving() bool { return false }   ","version":"dev","tagName":"h3"},{"title":"Supported Schema Changes‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/go/schema_evolution#supported-schema-changes","content":" ","version":"dev","tagName":"h2"},{"title":"Adding Fields‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/go/schema_evolution#adding-fields","content":" New fields can be added; they receive zero values when deserializing old data:  // Version 1 type UserV1 struct { ID int64 Name string } // Version 2 (added Email) type UserV2 struct { ID int64 Name string Email string // New field } f := fory.New(fory.WithCompatible(true)) f.RegisterStruct(UserV1{}, 1) // Serialize with V1 userV1 := &amp;UserV1{ID: 1, Name: &quot;Alice&quot;} data, _ := f.Serialize(userV1) // Deserialize with V2 f2 := fory.New(fory.WithCompatible(true)) f2.RegisterStruct(UserV2{}, 1) var userV2 UserV2 f2.Deserialize(data, &amp;userV2) // userV2.Email = &quot;&quot; (zero value)   ","version":"dev","tagName":"h3"},{"title":"Removing Fields‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/go/schema_evolution#removing-fields","content":" Removed fields are skipped during deserialization:  // Version 1 type ConfigV1 struct { Host string Port int32 Timeout int64 Debug bool // Will be removed } // Version 2 (removed Debug) type ConfigV2 struct { Host string Port int32 Timeout int64 // Debug field removed } f := fory.New(fory.WithCompatible(true)) f.RegisterStruct(ConfigV1{}, 1) // Serialize with V1 config := &amp;ConfigV1{Host: &quot;localhost&quot;, Port: 8080, Timeout: 30, Debug: true} data, _ := f.Serialize(config) // Deserialize with V2 f2 := fory.New(fory.WithCompatible(true)) f2.RegisterStruct(ConfigV2{}, 1) var configV2 ConfigV2 f2.Deserialize(data, &amp;configV2) // Debug field data is skipped   ","version":"dev","tagName":"h3"},{"title":"Reordering Fields‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/go/schema_evolution#reordering-fields","content":" Field order can change between versions:  // Version 1 type PersonV1 struct { FirstName string LastName string Age int32 } // Version 2 (reordered) type PersonV2 struct { Age int32 // Moved up LastName string FirstName string // Moved down }   Compatible mode handles this automatically by matching fields by name.  ","version":"dev","tagName":"h3"},{"title":"Incompatible Changes‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/go/schema_evolution#incompatible-changes","content":" Some changes are NOT supported, even in compatible mode:  ","version":"dev","tagName":"h2"},{"title":"Type Changes‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/go/schema_evolution#type-changes","content":" // NOT SUPPORTED type V1 struct { Value int32 // int32 } type V2 struct { Value string // Changed to string - INCOMPATIBLE }   ","version":"dev","tagName":"h3"},{"title":"Renaming Fields‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/go/schema_evolution#renaming-fields","content":" // NOT SUPPORTED (treated as remove + add) type V1 struct { UserName string } type V2 struct { Username string // Different name - NOT a rename }   This is treated as removing UserName and adding Username, resulting in data loss.  ","version":"dev","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/go/schema_evolution#best-practices","content":" ","version":"dev","tagName":"h2"},{"title":"1. Use Compatible Mode for Persistent Data‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/go/schema_evolution#1-use-compatible-mode-for-persistent-data","content":" // For data stored in databases, files, or caches f := fory.New(fory.WithCompatible(true))   ","version":"dev","tagName":"h3"},{"title":"2. Provide Default Values‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/go/schema_evolution#2-provide-default-values","content":" type ConfigV2 struct { Host string Port int32 Timeout int64 Retries int32 // New field } func NewConfigV2() *ConfigV2 { return &amp;ConfigV2{ Retries: 3, // Default value } } // After deserialize, apply defaults if config.Retries == 0 { config.Retries = 3 }   ","version":"dev","tagName":"h3"},{"title":"Cross-Language Schema Evolution‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/go/schema_evolution#cross-language-schema-evolution","content":" Schema evolution works across languages:  ","version":"dev","tagName":"h2"},{"title":"Go (Producer)‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/go/schema_evolution#go-producer","content":" type MessageV1 struct { ID int64 Content string } f := fory.New(fory.WithCompatible(true)) f.RegisterStruct(MessageV1{}, 1) data, _ := f.Serialize(&amp;MessageV1{ID: 1, Content: &quot;Hello&quot;})   ","version":"dev","tagName":"h3"},{"title":"Java (Consumer with newer schema)‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/go/schema_evolution#java-consumer-with-newer-schema","content":" public class Message { long id; String content; String author; // New field in Java } Fory fory = Fory.builder() .withXlang(true) .withCompatibleMode(true) .build(); fory.register(Message.class, 1); Message msg = fory.deserialize(data, Message.class); // msg.author will be null   ","version":"dev","tagName":"h3"},{"title":"Performance Considerations‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/go/schema_evolution#performance-considerations","content":" Compatible mode mainly affects serialized size:  Aspect\tSchema Consistent\tCompatible ModeSerialized Size\tSmaller\tLarger (includes metadata, especially without field IDs) Speed\tFast\tSimilar (metadata is just memcpy) Schema Flexibility\tNone\tFull  Note: Using field IDs (fory:&quot;id=N&quot;) reduces metadata size in compatible mode.  Recommendation: Use compatible mode for:  Persistent storageCross-service communicationLong-lived caches  Use schema consistent mode for:  In-memory operationsSame-version communicationMinimum serialized size  ","version":"dev","tagName":"h2"},{"title":"Error Handling‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/go/schema_evolution#error-handling","content":" ","version":"dev","tagName":"h2"},{"title":"Hash Mismatch (Schema Consistent Mode)‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/go/schema_evolution#hash-mismatch-schema-consistent-mode","content":" f := fory.New() // Compatible mode disabled // Schema changed without compatible mode err := f.Deserialize(oldData, &amp;newStruct) // Error: ErrKindHashMismatch   ","version":"dev","tagName":"h3"},{"title":"Unknown Fields‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/go/schema_evolution#unknown-fields","content":" In compatible mode, unknown fields are skipped silently. To detect them:  // Currently, Fory skips unknown fields automatically // No explicit API for detecting unknown fields   ","version":"dev","tagName":"h3"},{"title":"Complete Example‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/go/schema_evolution#complete-example","content":" package main import ( &quot;fmt&quot; &quot;github.com/apache/fory/go/fory&quot; ) // V1: Initial schema type ProductV1 struct { ID int64 Name string Price float64 } // V2: Added fields type ProductV2 struct { ID int64 Name string Price float64 Description string // New InStock bool // New } func main() { // Serialize with V1 f1 := fory.New(fory.WithCompatible(true)) f1.RegisterStruct(ProductV1{}, 1) product := &amp;ProductV1{ID: 1, Name: &quot;Widget&quot;, Price: 9.99} data, _ := f1.Serialize(product) fmt.Printf(&quot;V1 serialized: %d bytes\\n&quot;, len(data)) // Deserialize with V2 f2 := fory.New(fory.WithCompatible(true)) f2.RegisterStruct(ProductV2{}, 1) var productV2 ProductV2 if err := f2.Deserialize(data, &amp;productV2); err != nil { panic(err) } fmt.Printf(&quot;ID: %d\\n&quot;, productV2.ID) fmt.Printf(&quot;Name: %s\\n&quot;, productV2.Name) fmt.Printf(&quot;Price: %.2f\\n&quot;, productV2.Price) fmt.Printf(&quot;Description: %q (zero value)\\n&quot;, productV2.Description) fmt.Printf(&quot;InStock: %v (zero value)\\n&quot;, productV2.InStock) }   ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/go/schema_evolution#related-topics","content":" ConfigurationCross-Language SerializationTroubleshooting ","version":"dev","tagName":"h2"},{"title":"Custom Serializers","type":0,"sectionRef":"#","url":"/docs/next/guide/go/custom_serializers","content":"","keywords":"","version":"dev"},{"title":"When to Use Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/go/custom_serializers#when-to-use-custom-serializers","content":" Special encoding: Types that need a specific binary formatThird-party types: Types from external libraries that Fory doesn't handle automaticallyOptimization: When you can serialize more efficiently than the default reflection-based approachCross-language compatibility: When you need precise control over the binary format for interoperability  ","version":"dev","tagName":"h2"},{"title":"ExtensionSerializer Interface‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/go/custom_serializers#extensionserializer-interface","content":" Custom serializers implement the ExtensionSerializer interface:  type ExtensionSerializer interface { // WriteData serializes the value to the buffer. // Only write the data - Fory handles type info and references. // Use ctx.Buffer() to access the ByteBuffer. // Use ctx.SetError() to report errors. WriteData(ctx *WriteContext, value reflect.Value) // ReadData deserializes the value from the buffer into the provided value. // Only read the data - Fory handles type info and references. // Use ctx.Buffer() to access the ByteBuffer. // Use ctx.SetError() to report errors. ReadData(ctx *ReadContext, value reflect.Value) }   ","version":"dev","tagName":"h2"},{"title":"Basic Example‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/go/custom_serializers#basic-example","content":" Here's a simple custom serializer for a type with an integer field:  import ( &quot;reflect&quot; &quot;github.com/apache/fory/go/fory&quot; ) type MyExt struct { Id int32 } type MyExtSerializer struct{} func (s *MyExtSerializer) WriteData(ctx *fory.WriteContext, value reflect.Value) { myExt := value.Interface().(MyExt) ctx.Buffer().WriteVarint32(myExt.Id) } func (s *MyExtSerializer) ReadData(ctx *fory.ReadContext, value reflect.Value) { id := ctx.Buffer().ReadVarint32(ctx.Err()) value.Set(reflect.ValueOf(MyExt{Id: id})) } // Register the custom serializer f := fory.New() err := f.RegisterExtension(MyExt{}, 100, &amp;MyExtSerializer{})   ","version":"dev","tagName":"h2"},{"title":"Context Methods‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/go/custom_serializers#context-methods","content":" The WriteContext and ReadContext provide access to serialization resources:  Method\tDescriptionBuffer()\tReturns the *ByteBuffer for reading/writing Err()\tReturns *Error for deferred error checking SetError(err)\tSets an error on the context HasError()\tReturns true if an error has been set TypeResolver()\tReturns the type resolver for nested types RefResolver()\tReturns the reference resolver for ref support  ","version":"dev","tagName":"h2"},{"title":"ByteBuffer Methods‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/go/custom_serializers#bytebuffer-methods","content":" The ByteBuffer provides methods for reading and writing primitive types:  ","version":"dev","tagName":"h2"},{"title":"Writing Methods‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/go/custom_serializers#writing-methods","content":" Method\tDescriptionWriteBool(v bool)\tWrite a boolean WriteInt8(v int8)\tWrite a signed 8-bit integer WriteInt16(v int16)\tWrite a signed 16-bit integer WriteInt32(v int32)\tWrite a signed 32-bit integer WriteInt64(v int64)\tWrite a signed 64-bit integer WriteFloat32(v float32)\tWrite a 32-bit float WriteFloat64(v float64)\tWrite a 64-bit float WriteVarint32(v int32)\tWrite a variable-length signed 32-bit integer WriteVarint64(v int64)\tWrite a variable-length signed 64-bit integer WriteBinary(data []byte)\tWrite raw bytes  ","version":"dev","tagName":"h3"},{"title":"Reading Methods‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/go/custom_serializers#reading-methods","content":" All read methods take an *Error parameter for deferred error checking:  Method\tDescriptionReadBool(err *Error) bool\tRead a boolean ReadInt8(err *Error) int8\tRead a signed 8-bit integer ReadInt16(err *Error) int16\tRead a signed 16-bit integer ReadInt32(err *Error) int32\tRead a signed 32-bit integer ReadInt64(err *Error) int64\tRead a signed 64-bit integer ReadFloat32(err *Error) float32\tRead a 32-bit float ReadFloat64(err *Error) float64\tRead a 64-bit float ReadVarint32(err *Error) int32\tRead a variable-length signed 32-bit integer ReadVarint64(err *Error) int64\tRead a variable-length signed 64-bit integer ReadBinary(length int, err *Error) []byte\tRead raw bytes of specified length  ","version":"dev","tagName":"h3"},{"title":"Complex Type Example‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/go/custom_serializers#complex-type-example","content":" A custom serializer for a type with multiple fields:  type Point3D struct { X, Y, Z float64 Label string } type Point3DSerializer struct{} func (s *Point3DSerializer) WriteData(ctx *fory.WriteContext, value reflect.Value) { p := value.Interface().(Point3D) buf := ctx.Buffer() buf.WriteFloat64(p.X) buf.WriteFloat64(p.Y) buf.WriteFloat64(p.Z) // Write string as length + bytes labelBytes := []byte(p.Label) buf.WriteVarint32(int32(len(labelBytes))) buf.WriteBinary(labelBytes) } func (s *Point3DSerializer) ReadData(ctx *fory.ReadContext, value reflect.Value) { buf := ctx.Buffer() err := ctx.Err() x := buf.ReadFloat64(err) y := buf.ReadFloat64(err) z := buf.ReadFloat64(err) labelLen := buf.ReadVarint32(err) labelBytes := buf.ReadBinary(int(labelLen), err) value.Set(reflect.ValueOf(Point3D{ X: x, Y: y, Z: z, Label: string(labelBytes), })) } f := fory.New() f.RegisterExtension(Point3D{}, 101, &amp;Point3DSerializer{})   ","version":"dev","tagName":"h2"},{"title":"Handling Pointers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/go/custom_serializers#handling-pointers","content":" When your type contains pointers, handle nil values explicitly:  type OptionalValue struct { Value *int64 } type OptionalValueSerializer struct{} func (s *OptionalValueSerializer) WriteData(ctx *fory.WriteContext, value reflect.Value) { ov := value.Interface().(OptionalValue) buf := ctx.Buffer() if ov.Value == nil { buf.WriteBool(false) // nil flag } else { buf.WriteBool(true) // not nil buf.WriteInt64(*ov.Value) } } func (s *OptionalValueSerializer) ReadData(ctx *fory.ReadContext, value reflect.Value) { buf := ctx.Buffer() err := ctx.Err() hasValue := buf.ReadBool(err) if !hasValue { value.Set(reflect.ValueOf(OptionalValue{Value: nil})) return } v := buf.ReadInt64(err) value.Set(reflect.ValueOf(OptionalValue{Value: &amp;v})) }   ","version":"dev","tagName":"h2"},{"title":"Error Handling‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/go/custom_serializers#error-handling","content":" Use ctx.SetError() to report errors:  func (s *MySerializer) ReadData(ctx *fory.ReadContext, value reflect.Value) { buf := ctx.Buffer() version := buf.ReadInt8(ctx.Err()) if ctx.HasError() { return } if version != 1 { ctx.SetError(fory.DeserializationErrorf(&quot;unsupported version: %d&quot;, version)) return } // Continue reading... value.Set(reflect.ValueOf(result)) }   ","version":"dev","tagName":"h2"},{"title":"Registration Options‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/go/custom_serializers#registration-options","content":" ","version":"dev","tagName":"h2"},{"title":"Register by ID‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/go/custom_serializers#register-by-id","content":" More compact serialization, requires ID coordination across languages:  f.RegisterExtension(MyType{}, 100, &amp;MySerializer{})   ","version":"dev","tagName":"h3"},{"title":"Register by Name‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/go/custom_serializers#register-by-name","content":" More flexible but more serialization cost, type name included in serialized data:  f.RegisterNamedExtension(MyType{}, &quot;myapp.MyType&quot;, &amp;MySerializer{})   ","version":"dev","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/go/custom_serializers#best-practices","content":" Keep it simple: Only serialize what you needUse variable-length integers: WriteVarint32/WriteVarint64 for integers that are often smallHandle nil explicitly: Check for nil pointers and slicesVersion your format: Consider adding a version byte for future compatibilityTest round-trips: Always verify that Read(Write(value)) == valueMatch read/write order: Read fields in exactly the same order you write themCheck errors: Use ctx.HasError() after reading to handle errors gracefullyDeploy before use: Always deploy the registered serializer to all services before sending data serialized with it. If a service receives data for an unregistered serializer, deserialization will fail  ","version":"dev","tagName":"h2"},{"title":"Testing Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/go/custom_serializers#testing-custom-serializers","content":" func TestMySerializer(t *testing.T) { f := fory.New() f.RegisterExtension(MyType{}, 100, &amp;MySerializer{}) original := MyType{Field: &quot;test&quot;} // Serialize data, err := f.Serialize(original) require.NoError(t, err) // Deserialize var result MyType err = f.Deserialize(data, &amp;result) require.NoError(t, err) assert.Equal(t, original, result) }   ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/go/custom_serializers#related-topics","content":" Type RegistrationSupported TypesCross-Language Serialization ","version":"dev","tagName":"h2"},{"title":"Field Configuration","type":0,"sectionRef":"#","url":"/docs/next/guide/go/struct_tags","content":"","keywords":"","version":"dev"},{"title":"Tag Syntax‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/go/struct_tags#tag-syntax","content":" The general syntax for Fory struct tags:  type MyStruct struct { Field Type `fory:&quot;option1,option2=value&quot;` }   Multiple options are separated by commas (,).  ","version":"dev","tagName":"h2"},{"title":"Available Tags‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/go/struct_tags#available-tags","content":" ","version":"dev","tagName":"h2"},{"title":"Field ID‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/go/struct_tags#field-id","content":" Use id=N to assign a numeric ID to a field for compact encoding:  type User struct { ID int64 `fory:&quot;id=0&quot;` Name string `fory:&quot;id=1&quot;` Age int32 `fory:&quot;id=2&quot;` }   Benefits:  Smaller serialized size (numeric IDs vs field names)Faster serialization/deserializationRequired for optimal cross-language compatibility  Notes:  IDs must be unique within a structIDs must be &gt;= 0If not specified, field name is used (larger payload)  ","version":"dev","tagName":"h3"},{"title":"Ignoring Fields‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/go/struct_tags#ignoring-fields","content":" Use - to exclude a field from serialization:  type User struct { ID int64 Name string Password string `fory:&quot;-&quot;` // Not serialized }   The Password field will not be included in serialized output and will remain at its zero value after deserialization.  ","version":"dev","tagName":"h3"},{"title":"Nullable‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/go/struct_tags#nullable","content":" Use nullable to control whether null flags are written for pointer fields:  type Record struct { // Write null flag for this field (allows nil values) OptionalData *Data `fory:&quot;nullable&quot;` // Skip null flag (field must not be nil) RequiredData *Data `fory:&quot;nullable=false&quot;` }   Notes:  Only applies to pointer, slice, and map fieldsWhen nullable=false, serializing a nil value will cause an errorDefault is false (no null flag written)  ","version":"dev","tagName":"h3"},{"title":"Reference Tracking‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/go/struct_tags#reference-tracking","content":" Control per-field reference tracking for slices, maps, or pointer to struct fields:  type Container struct { // Enable reference tracking for this field SharedData *Data `fory:&quot;ref&quot;` // Disable reference tracking for this field SimpleData *Data `fory:&quot;ref=false&quot;` }   Notes:  Applies to slices, maps, and pointer to struct fieldsPointer to primitive types (e.g., *int, *string) cannot use this tagDefault is ref=false (no reference tracking)When global WithTrackRef(false) is set, field ref tags are ignoredWhen global WithTrackRef(true) is set, use ref=false to disable for specific fields  Use cases:  Enable for fields that may be circular or sharedDisable for fields that are always unique (optimization)  ","version":"dev","tagName":"h3"},{"title":"Encoding‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/go/struct_tags#encoding","content":" Use encoding to control how numeric fields are encoded:  type Metrics struct { // Variable-length encoding (default, smaller for small values) Count int64 `fory:&quot;encoding=varint&quot;` // Fixed-length encoding (consistent size) Timestamp int64 `fory:&quot;encoding=fixed&quot;` // Tagged encoding (includes type tag) Value int64 `fory:&quot;encoding=tagged&quot;` }   Supported encodings:  Type\tOptions\tDefaultint32\tvarint, fixed\tvarint uint32\tvarint, fixed\tvarint int64\tvarint, fixed, tagged\tvarint uint64\tvarint, fixed, tagged\tvarint  When to use:  varint: Best for values that are often small (default)fixed: Best for values that use full range (e.g., timestamps, hashes)tagged: When type information needs to be preserved  Shorthand for int32/uint32:  Use compress as a convenience tag for int32/uint32 fields:  type Data struct { SmallValue int32 `fory:&quot;compress&quot;` // Same as encoding=varint (default) FixedValue uint32 `fory:&quot;compress=false&quot;` // Same as encoding=fixed }   ","version":"dev","tagName":"h3"},{"title":"Combining Tags‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/go/struct_tags#combining-tags","content":" Multiple tags can be combined using comma separator:  type Document struct { ID int64 `fory:&quot;id=0,encoding=fixed&quot;` Content string `fory:&quot;id=1&quot;` Author *User `fory:&quot;id=2,ref&quot;` }   ","version":"dev","tagName":"h2"},{"title":"Integration with Other Tags‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/go/struct_tags#integration-with-other-tags","content":" Fory tags coexist with other struct tags:  type User struct { ID int64 `json:&quot;id&quot; fory:&quot;id=0&quot;` Name string `json:&quot;name,omitempty&quot; fory:&quot;id=1&quot;` Password string `json:&quot;-&quot; fory:&quot;-&quot;` }   Each tag namespace is independent.  ","version":"dev","tagName":"h2"},{"title":"Field Visibility‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/go/struct_tags#field-visibility","content":" Only exported fields (starting with uppercase) are considered:  type User struct { ID int64 // Serialized Name string // Serialized password string // NOT serialized (unexported, no tag needed) }   Unexported fields are always ignored, regardless of tags.  ","version":"dev","tagName":"h2"},{"title":"Field Ordering‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/go/struct_tags#field-ordering","content":" Fields are serialized in a consistent order based on:  Field name (alphabetically in snake_case)Field type  This ensures cross-language compatibility where field order matters.  ","version":"dev","tagName":"h2"},{"title":"Struct Hash‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/go/struct_tags#struct-hash","content":" Fory computes a hash of struct fields for version checking:  Hash includes field names and typesHash is written to serialized dataMismatch triggers ErrKindHashMismatch  Struct field changes affect the hash:  // These produce different hashes type V1 struct { UserID int64 } type V2 struct { UserId int64 // Different field name = different hash }   ","version":"dev","tagName":"h2"},{"title":"Examples‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/go/struct_tags#examples","content":" ","version":"dev","tagName":"h2"},{"title":"API Response Struct‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/go/struct_tags#api-response-struct","content":" type APIResponse struct { Status int32 `json:&quot;status&quot; fory:&quot;id=0&quot;` Message string `json:&quot;message&quot; fory:&quot;id=1&quot;` Data any `json:&quot;data&quot; fory:&quot;id=2&quot;` Internal string `json:&quot;-&quot; fory:&quot;-&quot;` // Ignored in both JSON and Fory }   ","version":"dev","tagName":"h3"},{"title":"Caching with Shared References‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/go/struct_tags#caching-with-shared-references","content":" type CacheEntry struct { Key string Value *CachedData `fory:&quot;ref&quot;` // May be shared Metadata *Metadata `fory:&quot;ref=false&quot;` // Always unique ExpiresAt int64 }   ","version":"dev","tagName":"h3"},{"title":"Document with Circular References‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/go/struct_tags#document-with-circular-references","content":" type Document struct { ID int64 Title string Parent *Document `fory:&quot;ref&quot;` // May reference self or siblings Children []*Document `fory:&quot;ref&quot;` }   ","version":"dev","tagName":"h3"},{"title":"Tag Parsing Errors‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/go/struct_tags#tag-parsing-errors","content":" Invalid tags produce errors during registration:  type BadStruct struct { Field int `fory:&quot;invalid=option=format&quot;` } f := fory.New() err := f.RegisterStruct(BadStruct{}, 1) // Error: ErrKindInvalidTag   ","version":"dev","tagName":"h2"},{"title":"Native Mode vs Xlang Mode‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/go/struct_tags#native-mode-vs-xlang-mode","content":" Field configuration behaves differently depending on the serialization mode:  Native Mode:  Nullable: Pointer, slice, map, and interface types are nullable by defaultRef tracking: Disabled by default (ref tag not set)  Xlang Mode:  Nullable: Only pointer types are nullable by default (slices and maps are NOT nullable)Ref tracking: Disabled by default (ref tag not set)  You need to configure fields when:  A field can be nil (use pointer types like *string, *int32)A field needs reference tracking for shared/circular objects (use fory:&quot;ref&quot;)You want to reduce metadata size (use field IDs with fory:&quot;id=N&quot;)  // Xlang mode: explicit configuration required type User struct { ID int64 `fory:&quot;id=0&quot;` Name string `fory:&quot;id=1&quot;` Email *string `fory:&quot;id=2&quot;` // Pointer type for nullable Friend *User `fory:&quot;id=3,ref&quot;` // Must declare ref for shared objects }   ","version":"dev","tagName":"h2"},{"title":"Default Values Summary‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/go/struct_tags#default-values-summary","content":" Option\tDefault\tHow to Enablenullable\tfalse\tUse pointer types (*T) ref\tfalse\tAdd fory:&quot;ref&quot; tag id\t-1\tAdd fory:&quot;id=N&quot; tag  ","version":"dev","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/go/struct_tags#best-practices","content":" Use - for sensitive data: Passwords, tokens, internal stateEnable ref tracking for shared objects: When the same pointer appears multiple timesDisable ref tracking for simple fields: Optimization when you know the field is uniqueKeep names consistent: Cross-language names should matchDocument tag usage: Especially for non-obvious configurations  ","version":"dev","tagName":"h2"},{"title":"Common Patterns‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/go/struct_tags#common-patterns","content":" ","version":"dev","tagName":"h2"},{"title":"Ignoring Computed Fields‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/go/struct_tags#ignoring-computed-fields","content":" type Rectangle struct { Width float64 Height float64 Area float64 `fory:&quot;-&quot;` // Computed, don't serialize } func (r *Rectangle) ComputeArea() { r.Area = r.Width * r.Height }   ","version":"dev","tagName":"h3"},{"title":"Circular Structure with Parent‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/go/struct_tags#circular-structure-with-parent","content":" type TreeNode struct { Value string Parent *TreeNode `fory:&quot;ref&quot;` // Circular back-reference Children []*TreeNode `fory:&quot;ref&quot;` }   ","version":"dev","tagName":"h3"},{"title":"Mixed Serialization Needs‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/go/struct_tags#mixed-serialization-needs","content":" type Session struct { ID string UserID int64 Token string `fory:&quot;-&quot;` // Security: don't serialize User *User `fory:&quot;ref&quot;` // May be shared across sessions CreatedAt int64 }   ","version":"dev","tagName":"h3"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/go/struct_tags#related-topics","content":" ReferencesBasic SerializationSchema Evolution ","version":"dev","tagName":"h2"},{"title":"Supported Types","type":0,"sectionRef":"#","url":"/docs/next/guide/go/supported_types","content":"","keywords":"","version":"dev"},{"title":"Primitive Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/go/supported_types#primitive-types","content":" Go Type\tFory TypeId\tEncoding\tNotesbool\tBOOL (1)\t1 byte int8\tINT8 (2)\t1 byte, signed int16\tINT16 (3)\t2 bytes, signed\tLittle-endian int32\tINT32 (4)\tVarint\tVariable-length encoding int64\tINT64 (6)\tVarint\tVariable-length encoding int\tINT32/INT64\tVarint\tPlatform-dependent (32 or 64 bit) uint8 / byte\tUINT8 (9)\t1 byte, unsigned uint16\tUINT16 (10)\t2 bytes, unsigned\tLittle-endian uint32\tUINT32 (11)\tVaruint\tVariable-length encoding uint64\tUINT64 (13)\tVaruint\tVariable-length encoding float32\tFLOAT32 (17)\t4 bytes\tIEEE 754 float64\tFLOAT64 (18)\t8 bytes\tIEEE 754 string\tSTRING (19)\tLength-prefixed UTF-8\t  ","version":"dev","tagName":"h2"},{"title":"Integer Encoding‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/go/supported_types#integer-encoding","content":" Fory uses variable-length integer encoding (varint) for better compression:  Small values use fewer bytesNegative values use ZigZag encodingPlatform int maps to int32 on 32-bit, int64 on 64-bit systems  f := fory.New() // All integer types supported var i8 int8 = 127 var i16 int16 = 32767 var i32 int32 = 2147483647 var i64 int64 = 9223372036854775807 data, _ := f.Serialize(i64) // Uses varint encoding   ","version":"dev","tagName":"h3"},{"title":"Collection Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/go/supported_types#collection-types","content":" ","version":"dev","tagName":"h2"},{"title":"Slices‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/go/supported_types#slices","content":" Go Type\tFory TypeId\tNotes[]bool\tBOOL_ARRAY\tOptimized encoding []int8\tINT8_ARRAY\tOptimized encoding []int16\tINT16_ARRAY\tOptimized encoding []int32\tINT32_ARRAY\tOptimized encoding []int64\tINT64_ARRAY\tOptimized encoding []float32\tFLOAT32_ARRAY\tOptimized encoding []float64\tFLOAT64_ARRAY\tOptimized encoding []string\tLIST\tGeneric list encoding []T (any)\tLIST (20)\tAny serializable type []I (any/any)\tLIST\tAny interface type  f := fory.New() // Primitive slices (optimized) ints := []int32{1, 2, 3, 4, 5} data, _ := f.Serialize(ints) // String slices strs := []string{&quot;a&quot;, &quot;b&quot;, &quot;c&quot;} data, _ = f.Serialize(strs) // Struct slices users := []User{{ID: 1}, {ID: 2}} data, _ = f.Serialize(users) // Dynamic slices dynamic := []any{1, &quot;hello&quot;, true} data, _ = f.Serialize(dynamic)   ","version":"dev","tagName":"h3"},{"title":"Maps‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/go/supported_types#maps","content":" Go Type\tFory TypeId\tNotesmap[string]string\tMAP (22)\tOptimized map[string]int64\tMAP\tOptimized map[string]int32\tMAP\tOptimized map[string]int\tMAP\tOptimized map[string]float64\tMAP\tOptimized map[string]bool\tMAP\tOptimized map[int32]int32\tMAP\tOptimized map[int64]int64\tMAP\tOptimized map[int]int\tMAP\tOptimized map[string]any\tMAP\tDynamic values map[any]any\tMAP\tDynamic keys and values  f := fory.New() // String key maps m1 := map[string]string{&quot;key&quot;: &quot;value&quot;} m2 := map[string]int64{&quot;count&quot;: 42} // Integer key maps m3 := map[int32]int32{1: 100, 2: 200} // Dynamic maps m4 := map[string]any{ &quot;name&quot;: &quot;Alice&quot;, &quot;age&quot;: int64(30), }   ","version":"dev","tagName":"h3"},{"title":"Sets‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/go/supported_types#sets","content":" Fory provides a generic Set[T] type (uses map[T]struct{} for zero memory overhead):  // Create a set of strings s := fory.NewSet[string]() s.Add(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;) // Check membership if s.Contains(&quot;a&quot;) { fmt.Println(&quot;found&quot;) } // Serialize data, _ := f.Serialize(s)   ","version":"dev","tagName":"h3"},{"title":"Time Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/go/supported_types#time-types","content":" Go Type\tFory TypeId\tNotestime.Time\tTIMESTAMP (34)\tNanosecond precision time.Duration\tDURATION (33)\tNanosecond precision  import &quot;time&quot; f := fory.New() // Timestamp t := time.Now() data, _ := f.Serialize(t) // Duration d := 5 * time.Second data, _ = f.Serialize(d)   ","version":"dev","tagName":"h2"},{"title":"Struct Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/go/supported_types#struct-types","content":" Category\tFory TypeId\tNotesStruct\tSTRUCT (25)\tRegistered by ID, no evolution Compatible Struct\tCOMPATIBLE_STRUCT (26)\tWith schema evolution Named Struct\tNAMED_STRUCT (27)\tRegistered by name, no evolution Named Compatible Struct\tNAMED_COMPATIBLE_STRUCT (28)\tNamed with schema evolution  ","version":"dev","tagName":"h2"},{"title":"Struct Requirements‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/go/supported_types#struct-requirements","content":" Exported fields only: Fields starting with uppercase are serializedSupported field types: All types listed in this documentRegistration: Structs should be registered for cross-language use  type User struct { ID int64 // Serialized Name string // Serialized Age int32 // Serialized password string // NOT serialized (unexported) } f := fory.New() f.RegisterStruct(User{}, 1) user := &amp;User{ID: 1, Name: &quot;Alice&quot;, Age: 30, password: &quot;secret&quot;} data, _ := f.Serialize(user)   ","version":"dev","tagName":"h3"},{"title":"Nested Structs‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/go/supported_types#nested-structs","content":" type Address struct { Street string City string Country string } type Company struct { Name string Address Address Founded int32 } f := fory.New() f.RegisterStruct(Address{}, 1) f.RegisterStruct(Company{}, 2)   ","version":"dev","tagName":"h3"},{"title":"Pointer Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/go/supported_types#pointer-types","content":" Go Type\tBehavior*T\tNil-able, reference tracked (if enabled) **T\tNested pointers supported  f := fory.New(fory.WithTrackRef(true)) type Node struct { Value int32 Left *Node Right *Node } f.RegisterStruct(Node{}, 1) root := &amp;Node{ Value: 1, Left: &amp;Node{Value: 2}, Right: &amp;Node{Value: 3}, } data, _ := f.Serialize(root)   ","version":"dev","tagName":"h2"},{"title":"Nil Handling‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/go/supported_types#nil-handling","content":" var ptr *User = nil data, _ := f.Serialize(ptr) var result *User f.Deserialize(data, &amp;result) // result == nil   ","version":"dev","tagName":"h3"},{"title":"Interface Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/go/supported_types#interface-types","content":" Go Type\tFory TypeId\tNotesany\tUNION (31)\tPolymorphic values  f := fory.New() // Serialize any var value any = &quot;hello&quot; data, _ := f.Serialize(value) var result any f.Deserialize(data, &amp;result) // result = &quot;hello&quot; (string)   For struct interfaces, register all possible concrete types:  type Shape interface { Area() float64 } type Circle struct { Radius float64 } func (c Circle) Area() float64 { return 3.14159 * c.Radius * c.Radius } f := fory.New() f.RegisterStruct(Circle{}, 1) var shape Shape = Circle{Radius: 5.0} data, _ := f.Serialize(shape)   ","version":"dev","tagName":"h2"},{"title":"Binary Data‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/go/supported_types#binary-data","content":" Go Type\tFory TypeId\tNotes[]byte\tBINARY (37)\tVariable-length bytes  f := fory.New() data := []byte{0x01, 0x02, 0x03, 0x04} serialized, _ := f.Serialize(data) var result []byte f.Deserialize(serialized, &amp;result)   ","version":"dev","tagName":"h2"},{"title":"Enum Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/go/supported_types#enum-types","content":" Go uses integer types for enums:  type Status int32 const ( StatusPending Status = 0 StatusActive Status = 1 StatusComplete Status = 2 ) f := fory.New() f.RegisterEnum(Status(0), 1) status := StatusActive data, _ := f.Serialize(status)   ","version":"dev","tagName":"h2"},{"title":"Cross-Language Type Mapping‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/go/supported_types#cross-language-type-mapping","content":" Go Type\tJava\tPython\tC++\tRustbool\tboolean\tbool\tbool\tbool int8\tbyte\tint\tint8_t\ti8 int16\tshort\tint\tint16_t\ti16 int32\tint\tint\tint32_t\ti32 int64\tlong\tint\tint64_t\ti64 float32\tfloat\tfloat\tfloat\tf32 float64\tdouble\tfloat\tdouble\tf64 string\tString\tstr\tstd::string\tString []T\tList&lt;T&gt;\tlist\tstd::vector&lt;T&gt;\tVec&lt;T&gt; map[K]V\tMap&lt;K,V&gt;\tdict\tstd::unordered_map\tHashMap&lt;K,V&gt; time.Time\tInstant\tdatetime\t-\t- time.Duration\tDuration\ttimedelta\t-\t-  See Cross-Language Serialization for detailed mapping.  ","version":"dev","tagName":"h2"},{"title":"Unsupported Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/go/supported_types#unsupported-types","content":" The following Go types are not supported:  Channels (chan T)Functions (func())Complex numbers (complex64, complex128)Unsafe pointers (unsafe.Pointer)  Attempting to serialize these types will result in an error.  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/next/guide/go/supported_types#related-topics","content":" Type RegistrationCross-Language SerializationReferences ","version":"dev","tagName":"h2"},{"title":"Thread Safety","type":0,"sectionRef":"#","url":"/docs/next/guide/go/thread_safety","content":"","keywords":"","version":"dev"},{"title":"Default Fory Instance‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/go/thread_safety#default-fory-instance","content":" The default Fory instance is not thread-safe:  f := fory.New() // NOT SAFE: Concurrent access from multiple goroutines go func() { f.Serialize(value1) // Race condition! }() go func() { f.Serialize(value2) // Race condition! }()   ","version":"dev","tagName":"h2"},{"title":"Why Not Thread-Safe?‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/go/thread_safety#why-not-thread-safe","content":" For performance, Fory reuses internal state:  Buffer is cleared and reused between callsReference resolvers are resetContext objects are recycled  This avoids allocations but requires exclusive access.  ","version":"dev","tagName":"h3"},{"title":"Thread-Safe Wrapper‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/go/thread_safety#thread-safe-wrapper","content":" For concurrent use, use the threadsafe package:  import &quot;github.com/apache/fory/go/fory/threadsafe&quot; // Create thread-safe Fory f := threadsafe.New() // Safe for concurrent use go func() { data, _ := f.Serialize(value1) }() go func() { data, _ := f.Serialize(value2) }()   ","version":"dev","tagName":"h2"},{"title":"How It Works‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/go/thread_safety#how-it-works","content":" The thread-safe wrapper uses sync.Pool:  Acquire: Gets a Fory instance from the poolUse: Performs serialization/deserializationCopy: Copies result data (buffer will be reused)Release: Returns instance to pool  // Simplified implementation func (f *Fory) Serialize(v any) ([]byte, error) { fory := f.pool.Get().(*fory.Fory) defer f.pool.Put(fory) data, err := fory.Serialize(v) if err != nil { return nil, err } // Copy because underlying buffer will be reused result := make([]byte, len(data)) copy(result, data) return result, nil }   ","version":"dev","tagName":"h3"},{"title":"API‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/go/thread_safety#api","content":" // Create thread-safe instance f := threadsafe.New() // Instance methods data, err := f.Serialize(value) err = f.Deserialize(data, &amp;target) // Generic functions data, err := threadsafe.Serialize(f, &amp;value) err = threadsafe.Deserialize(f, data, &amp;target) // Global convenience functions data, err := threadsafe.Marshal(&amp;value) err = threadsafe.Unmarshal(data, &amp;target)   ","version":"dev","tagName":"h3"},{"title":"Type Registration‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/go/thread_safety#type-registration","content":" Type registration should be done before concurrent use:  f := threadsafe.New() // Register types BEFORE concurrent access f.RegisterStruct(User{}, 1) f.RegisterStruct(Order{}, 2) // Now safe to use concurrently go func() { f.Serialize(&amp;User{ID: 1}) }()   ","version":"dev","tagName":"h2"},{"title":"Thread-Safe Registration‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/go/thread_safety#thread-safe-registration","content":" The thread-safe wrapper handles registration safely:  // Safe: Registration is synchronized f := threadsafe.New() f.RegisterStruct(User{}, 1) // Thread-safe   However, for best performance, register all types at startup before concurrent use.  ","version":"dev","tagName":"h3"},{"title":"Zero-Copy Considerations‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/go/thread_safety#zero-copy-considerations","content":" ","version":"dev","tagName":"h2"},{"title":"Non-Thread-Safe Instance‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/go/thread_safety#non-thread-safe-instance","content":" With the default Fory, returned byte slices are views into the internal buffer:  f := fory.New() data1, _ := f.Serialize(value1) // data1 is valid data2, _ := f.Serialize(value2) // data1 is NOW INVALID (buffer was reused)   ","version":"dev","tagName":"h3"},{"title":"Thread-Safe Instance‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/go/thread_safety#thread-safe-instance","content":" The thread-safe wrapper copies data automatically:  f := threadsafe.New() data1, _ := f.Serialize(value1) data2, _ := f.Serialize(value2) // Both data1 and data2 are valid (independent copies)   This is safer but has allocation overhead.  ","version":"dev","tagName":"h3"},{"title":"Performance Comparison‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/go/thread_safety#performance-comparison","content":" Scenario\tNon-Thread-Safe\tThread-SafeSingle goroutine\tFastest\tSlower (pool overhead) Multiple goroutines\tUnsafe\tSafe, good scaling Memory allocations\tMinimal\tPer-call copy Buffer reuse\tYes\tPer-pool-instance  ","version":"dev","tagName":"h2"},{"title":"Benchmarking‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/go/thread_safety#benchmarking","content":" func BenchmarkNonThreadSafe(b *testing.B) { f := fory.New() f.RegisterStruct(User{}, 1) user := &amp;User{ID: 1, Name: &quot;Alice&quot;} for i := 0; i &lt; b.N; i++ { data, _ := f.Serialize(user) _ = data } } func BenchmarkThreadSafe(b *testing.B) { f := threadsafe.New() f.RegisterStruct(User{}, 1) user := &amp;User{ID: 1, Name: &quot;Alice&quot;} for i := 0; i &lt; b.N; i++ { data, _ := f.Serialize(user) _ = data } }   ","version":"dev","tagName":"h3"},{"title":"Patterns‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/go/thread_safety#patterns","content":" ","version":"dev","tagName":"h2"},{"title":"Per-Goroutine Instance‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/go/thread_safety#per-goroutine-instance","content":" For maximum performance with known goroutine count:  func worker(id int) { // Each worker has its own Fory instance f := fory.New() f.RegisterStruct(User{}, 1) for task := range tasks { data, _ := f.Serialize(task) process(data) } } // Start workers for i := 0; i &lt; numWorkers; i++ { go worker(i) }   ","version":"dev","tagName":"h3"},{"title":"Shared Thread-Safe Instance‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/go/thread_safety#shared-thread-safe-instance","content":" For dynamic goroutine count or simplicity:  // Single shared instance var f = threadsafe.New() func init() { f.RegisterStruct(User{}, 1) } func handleRequest(user *User) []byte { // Safe from any goroutine data, _ := f.Serialize(user) return data }   ","version":"dev","tagName":"h3"},{"title":"HTTP Handler Example‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/go/thread_safety#http-handler-example","content":" var fory = threadsafe.New() func init() { fory.RegisterStruct(Response{}, 1) } func handler(w http.ResponseWriter, r *http.Request) { response := &amp;Response{ Status: &quot;ok&quot;, Data: getData(), } // Safe: threadsafe.Fory handles concurrency data, err := fory.Serialize(response) if err != nil { http.Error(w, err.Error(), 500) return } w.Header().Set(&quot;Content-Type&quot;, &quot;application/octet-stream&quot;) w.Write(data) }   ","version":"dev","tagName":"h3"},{"title":"Common Mistakes‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/go/thread_safety#common-mistakes","content":" ","version":"dev","tagName":"h2"},{"title":"Sharing Non-Thread-Safe Instance‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/go/thread_safety#sharing-non-thread-safe-instance","content":" // WRONG: Race condition var f = fory.New() func handler1() { f.Serialize(value1) // Race! } func handler2() { f.Serialize(value2) // Race! }   Fix: Use threadsafe.New() or per-goroutine instances.  ","version":"dev","tagName":"h3"},{"title":"Keeping Reference to Buffer‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/go/thread_safety#keeping-reference-to-buffer","content":" // WRONG: Buffer invalidated on next call f := fory.New() data, _ := f.Serialize(value1) savedData := data // Just copies the slice header! f.Serialize(value2) // Invalidates data and savedData   Fix: Clone the data or use thread-safe wrapper.  // Correct: Clone the data data, _ := f.Serialize(value1) savedData := make([]byte, len(data)) copy(savedData, data) // Or use thread-safe (auto-copies) f := threadsafe.New() data, _ := f.Serialize(value1) // Already copied   ","version":"dev","tagName":"h3"},{"title":"Registering Types Concurrently‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/go/thread_safety#registering-types-concurrently","content":" // RISKY: Concurrent registration go func() { f.RegisterStruct(TypeA{}, 1) }() go func() { f.Serialize(value) // May not see TypeA }()   Fix: Register all types before concurrent use.  ","version":"dev","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/go/thread_safety#best-practices","content":" Register types at startup: Before any concurrent operationsClone data if keeping references: With non-thread-safe instanceUse per-worker instances for hot paths: Eliminates pool contentionProfile before optimizing: Thread-safe overhead may be negligible  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/next/guide/go/thread_safety#related-topics","content":" ConfigurationBasic SerializationTroubleshooting ","version":"dev","tagName":"h2"},{"title":"Type Registration","type":0,"sectionRef":"#","url":"/docs/next/guide/go/type_registration","content":"","keywords":"","version":"dev"},{"title":"Why Register Types?‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/go/type_registration#why-register-types","content":" Type Identification: Fory needs to identify the actual type during deserializationPolymorphism: When deserializing interface types, Fory must know which concrete type to createCross-Language Compatibility: Other languages need to recognize and deserialize your types  ","version":"dev","tagName":"h2"},{"title":"Struct Registration‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/go/type_registration#struct-registration","content":" ","version":"dev","tagName":"h2"},{"title":"Register by ID‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/go/type_registration#register-by-id","content":" Register a struct with a numeric type ID for compact serialization:  type User struct { ID int64 Name string } f := fory.New() err := f.RegisterStruct(User{}, 1) if err != nil { panic(err) }   ID Guidelines:  IDs must be unique within your applicationIDs must be consistent across all languages for cross-language serializationUse the same ID for the same type in serializer and deserializer  ","version":"dev","tagName":"h3"},{"title":"Register by Name‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/go/type_registration#register-by-name","content":" Register a struct with a type name string. This is more flexible but has higher serialization cost:  f := fory.New() err := f.RegisterNamedStruct(User{}, &quot;example.User&quot;) if err != nil { panic(err) }   Name Guidelines:  Use fully-qualified names following namespace.TypeName conventionNames must be unique and consistent across all languagesNames are case-sensitive  ","version":"dev","tagName":"h3"},{"title":"Enum Registration‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/go/type_registration#enum-registration","content":" Go doesn't have native enums, but you can register integer types as enums:  ","version":"dev","tagName":"h2"},{"title":"Register by ID‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/go/type_registration#register-by-id-1","content":" type Status int32 const ( StatusPending Status = 0 StatusActive Status = 1 StatusComplete Status = 2 ) f := fory.New() err := f.RegisterEnum(Status(0), 1)   ","version":"dev","tagName":"h3"},{"title":"Register by Name‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/go/type_registration#register-by-name-1","content":" err := f.RegisterNamedEnum(Status(0), &quot;example.Status&quot;)   ","version":"dev","tagName":"h3"},{"title":"Extension Types‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/go/type_registration#extension-types","content":" For types requiring custom serialization logic, register as extension types with a custom serializer:  f := fory.New() // Register by ID err := f.RegisterExtension(CustomType{}, 1, &amp;CustomSerializer{}) // Or register by name err = f.RegisterNamedExtension(CustomType{}, &quot;example.Custom&quot;, &amp;CustomSerializer{})   See Custom Serializers for details on implementing the ExtensionSerializer interface.  ","version":"dev","tagName":"h2"},{"title":"Registration Scope‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/go/type_registration#registration-scope","content":" Type registration is per-Fory-instance:  f1 := fory.New() f2 := fory.New() // Types registered on f1 are NOT available on f2 f1.RegisterStruct(User{}, 1) // f2 cannot deserialize User unless also registered f2.RegisterStruct(User{}, 1)   ","version":"dev","tagName":"h2"},{"title":"Registration Timing‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/go/type_registration#registration-timing","content":" Register types after creating a Fory instance and before any serialize/deserialize calls:  f := fory.New() // Register before use f.RegisterStruct(User{}, 1) f.RegisterStruct(Order{}, 2) // Now serialize/deserialize data, _ := f.Serialize(&amp;User{ID: 1, Name: &quot;Alice&quot;})   ","version":"dev","tagName":"h2"},{"title":"Nested Type Registration‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/go/type_registration#nested-type-registration","content":" Register all struct types in the object graph, including nested types:  type Address struct { City string Country string } type Person struct { Name string Address Address } f := fory.New() // Register ALL struct types used in the object graph f.RegisterStruct(Address{}, 1) f.RegisterStruct(Person{}, 2)   ","version":"dev","tagName":"h2"},{"title":"Cross-Language Registration‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/go/type_registration#cross-language-registration","content":" For cross-language serialization, types must be registered consistently across all languages.  ","version":"dev","tagName":"h2"},{"title":"Using IDs‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/go/type_registration#using-ids","content":" All languages use the same numeric ID:  Go:  f.RegisterStruct(User{}, 1)   Java:  fory.register(User.class, 1);   Python:  fory.register(User, type_id=1)   ","version":"dev","tagName":"h3"},{"title":"Using Names‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/go/type_registration#using-names","content":" All languages use the same type name:  Go:  f.RegisterNamedStruct(User{}, &quot;example.User&quot;)   Java:  fory.register(User.class, &quot;example.User&quot;);   Python:  fory.register(User, typename=&quot;example.User&quot;)   Rust:  use fory::{Fory, ForyObject}; #[derive(ForyObject)] struct User { id: i64, name: String, } let mut fory = Fory::default(); fory.register_by_name::&lt;User&gt;(&quot;example.User&quot;)?;   ","version":"dev","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/go/type_registration#best-practices","content":" Register early: Register all types at application startup before any serializationBe consistent: Use the same ID or name across all languages and all instancesRegister all types: Include nested struct types, not just top-level typesPrefer IDs for performance: Numeric IDs have lower serialization overhead than namesUse names for flexibility: Names are easier to manage and less prone to conflicts  ","version":"dev","tagName":"h2"},{"title":"Common Errors‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/go/type_registration#common-errors","content":" ","version":"dev","tagName":"h2"},{"title":"Unregistered Type‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/go/type_registration#unregistered-type","content":" error: unknown type encountered   Solution: Register the type before serialization/deserialization.  ","version":"dev","tagName":"h3"},{"title":"ID/Name Mismatch‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/go/type_registration#idname-mismatch","content":" Data serialized with one ID or name cannot be deserialized if registered with a different ID or name.  Solution: Use consistent IDs or names across serializer and deserializer.  ","version":"dev","tagName":"h3"},{"title":"Duplicate Registration‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/go/type_registration#duplicate-registration","content":" Two types registered with the same ID will conflict.  Solution: Ensure unique IDs for each type.  ","version":"dev","tagName":"h3"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/go/type_registration#related-topics","content":" Basic SerializationCross-Language SerializationSupported TypesTroubleshooting ","version":"dev","tagName":"h2"},{"title":"Troubleshooting","type":0,"sectionRef":"#","url":"/docs/next/guide/go/troubleshooting","content":"","keywords":"","version":"dev"},{"title":"Error Types‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#error-types","content":" Fory Go uses typed errors with specific error kinds:  type Error struct { kind ErrorKind message string // Additional context fields } func (e Error) Kind() ErrorKind { return e.kind } func (e Error) Error() string { return e.message }   ","version":"dev","tagName":"h2"},{"title":"Error Kinds‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#error-kinds","content":" Kind\tValue\tDescriptionErrKindOK\t0\tNo error ErrKindBufferOutOfBound\t1\tRead/write beyond buffer bounds ErrKindTypeMismatch\t2\tType ID mismatch ErrKindUnknownType\t3\tUnknown type encountered ErrKindSerializationFailed\t4\tGeneral serialization failure ErrKindDeserializationFailed\t5\tGeneral deserialization failure ErrKindMaxDepthExceeded\t6\tRecursion depth limit exceeded ErrKindNilPointer\t7\tUnexpected nil pointer ErrKindInvalidRefId\t8\tInvalid reference ID ErrKindHashMismatch\t9\tStruct hash mismatch ErrKindInvalidTag\t10\tInvalid fory struct tag  ","version":"dev","tagName":"h3"},{"title":"Common Errors and Solutions‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#common-errors-and-solutions","content":" ","version":"dev","tagName":"h2"},{"title":"ErrKindUnknownType‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#errkindunknowntype","content":" Error: unknown type encountered  Cause: Type not registered before serialization/deserialization.  Solution:  f := fory.New() // Register type before use f.RegisterStruct(User{}, 1) // Now serialization works data, _ := f.Serialize(&amp;User{ID: 1})   ","version":"dev","tagName":"h3"},{"title":"ErrKindTypeMismatch‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#errkindtypemismatch","content":" Error: type mismatch: expected X, got Y  Cause: Serialized data has different type than expected.  Solutions:  Use correct target type:  // Wrong: Deserializing User into Order var order Order f.Deserialize(userData, &amp;order) // Error! // Correct var user User f.Deserialize(userData, &amp;user)   Ensure consistent registration:  // Serializer f1 := fory.New() f1.RegisterStruct(User{}, 1) // Deserializer - must use same ID f2 := fory.New() f2.RegisterStruct(User{}, 1) // Same ID!   ","version":"dev","tagName":"h3"},{"title":"ErrKindHashMismatch‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#errkindhashmismatch","content":" Error: hash X is not consistent with Y for type Z  Cause: Struct definition changed between serialization and deserialization.  Solutions:  Enable compatible mode:  f := fory.New(fory.WithCompatible(true))   Ensure struct definitions match:  // Both serializer and deserializer must have same struct type User struct { ID int64 Name string }   Regenerate codegen (if using):  go generate ./...   ","version":"dev","tagName":"h3"},{"title":"ErrKindMaxDepthExceeded‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#errkindmaxdepthexceeded","content":" Error: max depth exceeded  Cause: Data nesting exceeds maximum depth limit.  Possible causes:  Deeply nested data structures exceeding the default limit (20)Unintended circular references without reference tracking enabledMalicious data: Attackers may craft deeply nested payloads to cause resource exhaustion  Solutions:  Increase max depth (default is 20):  f := fory.New(fory.WithMaxDepth(50))   Enable reference tracking (for circular data):  f := fory.New(fory.WithTrackRef(true))   Check for unintended circular references in your data. Validate untrusted data: When deserializing data from untrusted sources, do not blindly increase max depth. Consider validating input size and structure before deserialization.  ","version":"dev","tagName":"h3"},{"title":"ErrKindBufferOutOfBound‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#errkindbufferoutofbound","content":" Error: buffer out of bound: offset=X, need=Y, size=Z  Cause: Reading beyond available data.  Solutions:  Ensure complete data transfer:  // Wrong: Truncated data data := fullData[:100] f.Deserialize(data, &amp;target) // Error if data was larger // Correct: Use full data f.Deserialize(fullData, &amp;target)   Check for data corruption: Verify data integrity during transmission.  ","version":"dev","tagName":"h3"},{"title":"ErrKindInvalidRefId‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#errkindinvalidrefid","content":" Error: invalid reference ID  Cause: Reference to non-existent or unknown object in serialized data.  Solutions:  Ensure reference tracking consistency:  // Serializer and deserializer must have same setting f1 := fory.New(fory.WithTrackRef(true)) f2 := fory.New(fory.WithTrackRef(true)) // Must match!   Check for data corruption.  ","version":"dev","tagName":"h3"},{"title":"ErrKindInvalidTag‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#errkindinvalidtag","content":" Error: invalid fory struct tag  Cause: Invalid struct tag configuration.  Common causes:  Invalid tag ID: ID must be &gt;= -1  // Wrong: negative ID (other than -1) type Bad struct { Field int `fory:&quot;id=-5&quot;` } // Correct type Good struct { Field int `fory:&quot;id=0&quot;` }   Duplicate tag IDs: Each field must have a unique ID within the struct  // Wrong: duplicate IDs type Bad struct { Field1 int `fory:&quot;id=0&quot;` Field2 int `fory:&quot;id=0&quot;` // Duplicate! } // Correct type Good struct { Field1 int `fory:&quot;id=0&quot;` Field2 int `fory:&quot;id=1&quot;` }   ","version":"dev","tagName":"h3"},{"title":"Cross-Language Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#cross-language-issues","content":" ","version":"dev","tagName":"h2"},{"title":"Field Order Mismatch‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#field-order-mismatch","content":" Symptom: Data deserializes but fields have wrong values.  Cause: Different field ordering between languages. In non-compatible mode, fields are sorted by their snake_case names. CamelCase field names (e.g., FirstName) are converted to snake_case (e.g., first_name) for sorting.  Solutions:  Ensure converted snake_case names are consistent: Field names across languages must produce the same snake_case ordering:  type User struct { FirstName string // Go: FirstName -&gt; first_name LastName string // Go: LastName -&gt; last_name // Sorted alphabetically by snake_case: first_name, last_name }   Use field IDs for consistent ordering: Field IDs (non-negative integers) act as aliases for field names, used for both sorting and field matching during deserialization:  type User struct { FirstName string `fory:&quot;id=0&quot;` LastName string `fory:&quot;id=1&quot;` }   Ensure the same field IDs are used across all languages for corresponding fields.  ","version":"dev","tagName":"h3"},{"title":"Name Registration Mismatch‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#name-registration-mismatch","content":" Symptom: unknown type in other languages.  Solution: Use identical names:  // Go f.RegisterNamedStruct(User{}, &quot;example.User&quot;) // Java - must match exactly fory.register(User.class, &quot;example.User&quot;); // Python fory.register(User, typename=&quot;example.User&quot;)   ","version":"dev","tagName":"h3"},{"title":"Performance Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#performance-issues","content":" ","version":"dev","tagName":"h2"},{"title":"Slow Serialization‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#slow-serialization","content":" Possible causes:  Large object graphs: Reduce data size or serialize incrementally. Excessive reference tracking: Disable if not needed:  f := fory.New(fory.WithTrackRef(false))   Deep nesting: Flatten data structures where possible.  ","version":"dev","tagName":"h3"},{"title":"High Memory Usage‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#high-memory-usage","content":" Possible causes:  Large serialized data: Process in chunks. Reference tracking overhead: Disable if not needed. Buffer not released: Reuse buffers:  buf := fory.NewByteBuffer(nil) f.SerializeTo(buf, value) // Process data buf.Reset() // Reuse for next serialization   ","version":"dev","tagName":"h3"},{"title":"Thread Contention‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#thread-contention","content":" Symptom: Slowdown under concurrent load.  Solutions:  Use per-goroutine instances for hot paths:  func worker() { f := fory.New() // Each worker has own instance for task := range tasks { f.Serialize(task) } }   Profile pool usage with thread-safe wrapper.  ","version":"dev","tagName":"h3"},{"title":"Debugging Techniques‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#debugging-techniques","content":" ","version":"dev","tagName":"h2"},{"title":"Enable Debug Output‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#enable-debug-output","content":" Set environment variable:  ENABLE_FORY_DEBUG_OUTPUT=1 go test ./...   ","version":"dev","tagName":"h3"},{"title":"Inspect Serialized Data‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#inspect-serialized-data","content":" data, _ := f.Serialize(value) fmt.Printf(&quot;Serialized %d bytes\\n&quot;, len(data)) fmt.Printf(&quot;Header: %x\\n&quot;, data[:4]) // Magic + flags   ","version":"dev","tagName":"h3"},{"title":"Check Type Registration‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#check-type-registration","content":" // Verify type is registered f := fory.New() err := f.RegisterStruct(User{}, 1) if err != nil { fmt.Printf(&quot;Registration failed: %v\\n&quot;, err) }   ","version":"dev","tagName":"h3"},{"title":"Compare Struct Hashes‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#compare-struct-hashes","content":" If getting hash mismatch, compare struct definitions:  // Print struct info for debugging t := reflect.TypeOf(User{}) for i := 0; i &lt; t.NumField(); i++ { f := t.Field(i) fmt.Printf(&quot;Field: %s, Type: %s\\n&quot;, f.Name, f.Type) }   ","version":"dev","tagName":"h3"},{"title":"Testing Tips‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#testing-tips","content":" ","version":"dev","tagName":"h2"},{"title":"Test Round-Trip‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#test-round-trip","content":" func TestRoundTrip(t *testing.T) { f := fory.New() f.RegisterStruct(User{}, 1) original := &amp;User{ID: 1, Name: &quot;Alice&quot;} data, err := f.Serialize(original) require.NoError(t, err) var result User err = f.Deserialize(data, &amp;result) require.NoError(t, err) assert.Equal(t, original.ID, result.ID) assert.Equal(t, original.Name, result.Name) }   ","version":"dev","tagName":"h3"},{"title":"Test Cross-Language‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#test-cross-language","content":" cd java/fory-core FORY_GO_JAVA_CI=1 mvn test -Dtest=org.apache.fory.xlang.GoXlangTest   ","version":"dev","tagName":"h3"},{"title":"Test Schema Evolution‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#test-schema-evolution","content":" func TestSchemaEvolution(t *testing.T) { f1 := fory.New(fory.WithCompatible(true)) f1.RegisterStruct(UserV1{}, 1) data, _ := f1.Serialize(&amp;UserV1{ID: 1, Name: &quot;Alice&quot;}) f2 := fory.New(fory.WithCompatible(true)) f2.RegisterStruct(UserV2{}, 1) var result UserV2 err := f2.Deserialize(data, &amp;result) require.NoError(t, err) }   ","version":"dev","tagName":"h3"},{"title":"Getting Help‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#getting-help","content":" If you encounter issues not covered here:  Check GitHub Issues: github.com/apache/fory/issuesEnable debug output: ENABLE_FORY_DEBUG_OUTPUT=1Create minimal reproduction: Isolate the problemReport the issue: Include Go version, Fory version, and minimal code  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/go/troubleshooting#related-topics","content":" ConfigurationCross-Language SerializationSchema EvolutionThread Safety ","version":"dev","tagName":"h2"},{"title":"Basic Serialization","type":0,"sectionRef":"#","url":"/docs/next/guide/java/basic_serialization","content":"","keywords":"","version":"dev"},{"title":"Creating Fory Instances‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/java/basic_serialization#creating-fory-instances","content":" ","version":"dev","tagName":"h2"},{"title":"Single-Thread Fory‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/java/basic_serialization#single-thread-fory","content":" For single-threaded applications:  Fory fory = Fory.builder() .withLanguage(Language.JAVA) // enable reference tracking for shared/circular reference. // Disable it will have better performance if no duplicate reference. .withRefTracking(false) .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT) // enable type forward/backward compatibility // disable it for small size and better performance. // .withCompatibleMode(CompatibleMode.COMPATIBLE) // enable async multi-threaded compilation. .withAsyncCompilation(true) .build(); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes));   ","version":"dev","tagName":"h3"},{"title":"Thread-Safe Fory‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/java/basic_serialization#thread-safe-fory","content":" For multi-threaded applications:  ThreadSafeFory fory = Fory.builder() .withLanguage(Language.JAVA) // enable reference tracking for shared/circular reference. // Disable it will have better performance if no duplicate reference. .withRefTracking(false) // compress int for smaller size // .withIntCompressed(true) // compress long for smaller size // .withLongCompressed(true) .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT) // enable type forward/backward compatibility // disable it for small size and better performance. // .withCompatibleMode(CompatibleMode.COMPATIBLE) // enable async multi-threaded compilation. .withAsyncCompilation(true) .buildThreadSafeFory(); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes));   ","version":"dev","tagName":"h3"},{"title":"Object Deep Copy‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/java/basic_serialization#object-deep-copy","content":" Fory provides efficient deep copy functionality:  ","version":"dev","tagName":"h2"},{"title":"With Reference Tracking‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/java/basic_serialization#with-reference-tracking","content":" Fory fory = Fory.builder().withRefCopy(true).build(); SomeClass a = xxx; SomeClass copied = fory.copy(a);   ","version":"dev","tagName":"h3"},{"title":"Without Reference Tracking (Better Performance)‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/java/basic_serialization#without-reference-tracking-better-performance","content":" When disabled, deep copy will ignore circular and shared references. Same reference of an object graph will be copied into different objects in one Fory#copy:  Fory fory = Fory.builder().withRefCopy(false).build(); SomeClass a = xxx; SomeClass copied = fory.copy(a);   ","version":"dev","tagName":"h3"},{"title":"Serialization APIs‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/java/basic_serialization#serialization-apis","content":" ","version":"dev","tagName":"h2"},{"title":"Basic Serialize/Deserialize‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/java/basic_serialization#basic-serializedeserialize","content":" // Serialize object to byte array byte[] bytes = fory.serialize(object); // Deserialize byte array to object Object obj = fory.deserialize(bytes);   ","version":"dev","tagName":"h3"},{"title":"Serialize/Deserialize with Type‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/java/basic_serialization#serializedeserialize-with-type","content":" // Serialize with explicit type byte[] bytes = fory.serializeJavaObject(object); // Deserialize with expected type MyClass obj = fory.deserializeJavaObject(bytes, MyClass.class);   ","version":"dev","tagName":"h3"},{"title":"Serialize/Deserialize with Type Info‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/java/basic_serialization#serializedeserialize-with-type-info","content":" // Serialize with type information byte[] bytes = fory.serializeJavaObjectAndClass(object); // Deserialize with embedded type info Object obj = fory.deserializeJavaObjectAndClass(bytes);   ","version":"dev","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/java/basic_serialization#best-practices","content":" Reuse Fory instances: Creating Fory is expensive, always reuse instancesUse appropriate thread safety: Choose between single-thread and thread-safe based on your needsRegister classes: Register frequently used classes for better performanceConfigure reference tracking: Disable if you don't have circular/shared references  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/java/basic_serialization#related-topics","content":" Configuration Options - All ForyBuilder optionsType Registration - Class registrationTroubleshooting - Common API usage issues ","version":"dev","tagName":"h2"},{"title":"Java Serialization Guide","type":0,"sectionRef":"#","url":"/docs/next/guide/java/","content":"","keywords":"","version":"dev"},{"title":"Features‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/next/guide/java/#features","content":" ","version":"dev","tagName":"h2"},{"title":"High Performance‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/next/guide/java/#high-performance","content":" JIT Code Generation: Highly-extensible JIT framework generates serializer code at runtime using async multi-threaded compilation, delivering 20-170x speedup through: Inlining variables to reduce memory accessInlining method calls to eliminate virtual dispatch overheadMinimizing conditional branchingEliminating hash lookups Zero-Copy: Direct memory access without intermediate buffer copies; row format supports random access and partial serializationVariable-Length Encoding: Optimized compression for integers, longsMeta Sharing: Cached class metadata reduces redundant type informationSIMD Acceleration: Java Vector API support for array operations (Java 16+)  ","version":"dev","tagName":"h3"},{"title":"Drop-in Replacement‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/next/guide/java/#drop-in-replacement","content":" 100% JDK Serialization Compatible: Supports writeObject/readObject/writeReplace/readResolve/readObjectNoData/ExternalizableJava 8-24 Support: Works across all modern Java versions including Java 17+ recordsGraalVM Native Image: AOT compilation support without reflection configuration  ","version":"dev","tagName":"h3"},{"title":"Advanced Features‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/next/guide/java/#advanced-features","content":" Reference Tracking: Automatic handling of shared and circular referencesSchema Evolution: Forward/backward compatibility for class schema changesPolymorphism: Full support for inheritance hierarchies and interfacesDeep Copy: Efficient deep cloning of complex object graphs with reference preservationSecurity: Class registration and configurable deserialization policies  ","version":"dev","tagName":"h3"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/next/guide/java/#quick-start","content":" Note that Fory creation is not cheap, the Fory instances should be reused between serializations instead of creating it every time. You should keep Fory as a static global variable, or instance variable of some singleton object or limited objects.  ","version":"dev","tagName":"h2"},{"title":"Single-Thread Usage‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/next/guide/java/#single-thread-usage","content":" import java.util.List; import java.util.Arrays; import org.apache.fory.*; import org.apache.fory.config.*; public class Example { public static void main(String[] args) { SomeClass object = new SomeClass(); // Note that Fory instances should be reused between // multiple serializations of different objects. Fory fory = Fory.builder().withLanguage(Language.JAVA) .requireClassRegistration(true) .build(); // Registering types can reduce class name serialization overhead, but not mandatory. // If class registration enabled, all custom types must be registered. // Registration order must be consistent if id is not specified fory.register(SomeClass.class); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes)); } }   ","version":"dev","tagName":"h3"},{"title":"Multi-Thread Usage‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/next/guide/java/#multi-thread-usage","content":" import java.util.List; import java.util.Arrays; import org.apache.fory.*; import org.apache.fory.config.*; public class Example { public static void main(String[] args) { SomeClass object = new SomeClass(); // Note that Fory instances should be reused between // multiple serializations of different objects. ThreadSafeFory fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().withLanguage(Language.JAVA) .withClassLoader(classLoader).build(); f.register(SomeClass.class, 1); return f; }); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes)); } }   ","version":"dev","tagName":"h3"},{"title":"Fory Instance Reuse Pattern‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/next/guide/java/#fory-instance-reuse-pattern","content":" import java.util.List; import java.util.Arrays; import org.apache.fory.*; import org.apache.fory.config.*; public class Example { // reuse fory. private static final ThreadSafeFory fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().withLanguage(Language.JAVA) .withClassLoader(classLoader).build(); f.register(SomeClass.class, 1); return f; }); public static void main(String[] args) { SomeClass object = new SomeClass(); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes)); } }   ","version":"dev","tagName":"h3"},{"title":"Thread Safety‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/next/guide/java/#thread-safety","content":" Fory provides multiple options for thread-safe serialization:  ","version":"dev","tagName":"h2"},{"title":"ThreadLocalFory‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/next/guide/java/#threadlocalfory","content":" Uses thread-local storage to maintain separate Fory instances per thread:  ThreadSafeFory fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().withLanguage(Language.JAVA) .withClassLoader(classLoader).build(); f.register(SomeClass.class, 1); return f; }); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes));   ","version":"dev","tagName":"h3"},{"title":"ThreadSafeForyPool‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/next/guide/java/#threadsafeforypool","content":" For virtual threads or environments where thread-local storage is not appropriate, use buildThreadSafeForyPool:  ThreadSafeFory fory = Fory.builder() .withLanguage(Language.JAVA) .withRefTracking(false) .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT) .withAsyncCompilation(true) .buildThreadSafeForyPool(minPoolSize, maxPoolSize);   Note that calling buildThreadSafeFory() on ForyBuilder will create an instance of ThreadLocalFory. This may not be appropriate in environments where virtual threads are used, as each thread will create its own Fory instance, a relatively expensive operation. An alternative for virtual threads is to use buildThreadSafeForyPool.  ","version":"dev","tagName":"h3"},{"title":"Builder Methods‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/next/guide/java/#builder-methods","content":" // Single-thread Fory Fory fory = Fory.builder() .withLanguage(Language.JAVA) .withRefTracking(false) .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT) .withAsyncCompilation(true) .build(); // Thread-safe Fory (ThreadLocalFory) ThreadSafeFory fory = Fory.builder() .withLanguage(Language.JAVA) .withRefTracking(false) .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT) .withAsyncCompilation(true) .buildThreadSafeFory();   ","version":"dev","tagName":"h3"},{"title":"Next Steps‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/next/guide/java/#next-steps","content":" Configuration Options - Learn about ForyBuilder optionsBasic Serialization - Detailed serialization patternsType Registration - Class registration and securityCustom Serializers - Implement custom serializersCross-Language Serialization - Serialize data for other languages ","version":"dev","tagName":"h2"},{"title":"Advanced Features","type":0,"sectionRef":"#","url":"/docs/next/guide/java/advanced_features","content":"","keywords":"","version":"dev"},{"title":"Zero-Copy Serialization‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/next/guide/java/advanced_features#zero-copy-serialization","content":" Fory supports zero-copy serialization for efficient handling of large binary data:  import org.apache.fory.*; import org.apache.fory.config.*; import org.apache.fory.serializer.BufferObject; import org.apache.fory.memory.MemoryBuffer; import java.util.*; import java.util.stream.Collectors; public class ZeroCopyExample { // Note that fory instance should be reused instead of creation every time. static Fory fory = Fory.builder() .withLanguage(Language.JAVA) .build(); public static void main(String[] args) { List&lt;Object&gt; list = Arrays.asList(&quot;str&quot;, new byte[1000], new int[100], new double[100]); Collection&lt;BufferObject&gt; bufferObjects = new ArrayList&lt;&gt;(); byte[] bytes = fory.serialize(list, e -&gt; !bufferObjects.add(e)); List&lt;MemoryBuffer&gt; buffers = bufferObjects.stream() .map(BufferObject::toBuffer).collect(Collectors.toList()); System.out.println(fory.deserialize(bytes, buffers)); } }   ","version":"dev","tagName":"h2"},{"title":"Object Deep Copy‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/next/guide/java/advanced_features#object-deep-copy","content":" Fory provides efficient deep copy functionality:  ","version":"dev","tagName":"h2"},{"title":"With Reference Tracking‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/next/guide/java/advanced_features#with-reference-tracking","content":" Fory fory = Fory.builder().withRefCopy(true).build(); SomeClass a = xxx; SomeClass copied = fory.copy(a);   ","version":"dev","tagName":"h3"},{"title":"Without Reference Tracking (Better Performance)‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/next/guide/java/advanced_features#without-reference-tracking-better-performance","content":" When disabled, deep copy will ignore circular and shared references. Same reference of an object graph will be copied into different objects in one Fory#copy:  Fory fory = Fory.builder().withRefCopy(false).build(); SomeClass a = xxx; SomeClass copied = fory.copy(a);   ","version":"dev","tagName":"h3"},{"title":"Memory Allocation Customization‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/next/guide/java/advanced_features#memory-allocation-customization","content":" Fory provides a MemoryAllocator interface that allows you to customize how memory buffers are allocated and grown during serialization operations. This can be useful for performance optimization, memory pooling, or debugging memory usage.  ","version":"dev","tagName":"h2"},{"title":"MemoryAllocator Interface‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/next/guide/java/advanced_features#memoryallocator-interface","content":" The MemoryAllocator interface defines two key methods:  public interface MemoryAllocator { /** * Allocates a new MemoryBuffer with the specified initial capacity. */ MemoryBuffer allocate(int initialCapacity); /** * Grows an existing buffer to accommodate the new capacity. * The implementation must grow the buffer in-place by modifying * the existing buffer instance. */ MemoryBuffer grow(MemoryBuffer buffer, int newCapacity); }   ","version":"dev","tagName":"h3"},{"title":"Using Custom Memory Allocators‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/next/guide/java/advanced_features#using-custom-memory-allocators","content":" You can set a global memory allocator that will be used by all MemoryBuffer instances:  // Create a custom allocator MemoryAllocator customAllocator = new MemoryAllocator() { @Override public MemoryBuffer allocate(int initialCapacity) { // Add extra capacity for debugging or pooling return MemoryBuffer.fromByteArray(new byte[initialCapacity + 100]); } @Override public MemoryBuffer grow(MemoryBuffer buffer, int newCapacity) { if (newCapacity &lt;= buffer.size()) { return buffer; } // Custom growth strategy - add 100% extra capacity int newSize = (int) (newCapacity * 2); byte[] data = new byte[newSize]; buffer.copyToUnsafe(0, data, Platform.BYTE_ARRAY_OFFSET, buffer.size()); buffer.initHeapBuffer(data, 0, data.length); return buffer; } }; // Set the custom allocator globally MemoryBuffer.setGlobalAllocator(customAllocator); // All subsequent MemoryBuffer allocations will use your custom allocator Fory fory = Fory.builder().withLanguage(Language.JAVA).build(); byte[] bytes = fory.serialize(someObject); // Uses custom allocator   ","version":"dev","tagName":"h3"},{"title":"Default Memory Allocator Behavior‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/next/guide/java/advanced_features#default-memory-allocator-behavior","content":" The default allocator uses the following growth strategy:  For buffers smaller than BUFFER_GROW_STEP_THRESHOLD (100MB): multiply capacity by 2For larger buffers: multiply capacity by 1.5 (capped at Integer.MAX_VALUE - 8)  This provides a balance between avoiding frequent reallocations and preventing excessive memory usage.  ","version":"dev","tagName":"h3"},{"title":"Use Cases‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/next/guide/java/advanced_features#use-cases","content":" Custom memory allocators are useful for:  Memory Pooling: Reuse allocated buffers to reduce GC pressurePerformance Tuning: Use different growth strategies based on your workloadDebugging: Add logging or tracking to monitor memory usageOff-heap Memory: Integrate with off-heap memory management systems  ","version":"dev","tagName":"h3"},{"title":"Logging‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/next/guide/java/advanced_features#logging","content":" ","version":"dev","tagName":"h2"},{"title":"ForyLogger‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/next/guide/java/advanced_features#forylogger","content":" By default, Fory uses a custom logger ForyLogger for internal needs. It builds resulting logged data into a single string and sends it directly to System.out. The result line layout is similar to (in Log4j notation):  %d{yyyy-MM-dd hh:mm:ss} %p %C:%L [%t] - %m%n   The layout can't be changed.  Example output:  2025-11-07 08:49:59 INFO CompileUnit:55 [main] - Generate code for org.apache.fory.builder.SerializedLambdaForyCodec_0 took 35 ms. 2025-11-07 08:50:00 INFO JaninoUtils:121 [main] - Compile [SerializedLambdaForyCodec_0] take 144 ms   ","version":"dev","tagName":"h3"},{"title":"Slf4jLogger‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/next/guide/java/advanced_features#slf4jlogger","content":" If a more sophisticated logger is required, configure Fory to use Slf4j via LoggerFactory.useSlf4jLogging(). For example, enabling Slf4j before creating Fory:  public static final ThreadSafeFory FORY; static { LoggerFactory.useSlf4jLogging(true); FORY = Fory.builder() .buildThreadSafeFory(); }   Note: Enabling Slf4j via useSlf4jLogging will be ignored when the application runs in a GraalVM native image.  ","version":"dev","tagName":"h3"},{"title":"Suppress Fory Logs‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/next/guide/java/advanced_features#suppress-fory-logs","content":" Both ForyLogger and Slf4jLogger allow controlling log output level or suppressing logs entirely. Configure logger level via LoggerFactory.setLogLevel():  static { // to log only WARN and higher LoggerFactory.setLogLevel(LogLevel.WARN_LEVEL); // to disable logging entirely LoggerFactory.disableLogging(); }   Note: Selected logging level is applied before Slf4j implementation's logger level. So if you set WARN_LEVEL (as in the example above) then you will not see INFO messages from Fory even if INFO is enabled in Logback.  ","version":"dev","tagName":"h3"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/next/guide/java/advanced_features#related-topics","content":" Compression - Data compression optionsConfiguration Options - All ForyBuilder optionsCross-Language Serialization - XLANG mode ","version":"dev","tagName":"h2"},{"title":"Compression","type":0,"sectionRef":"#","url":"/docs/next/guide/java/compression","content":"","keywords":"","version":"dev"},{"title":"Integer Compression‚Äã","type":1,"pageTitle":"Compression","url":"/docs/next/guide/java/compression#integer-compression","content":" ForyBuilder#withIntCompressed/ForyBuilder#withLongCompressed can be used to compress int/long for smaller size. Normally compressing int is enough.  Both compression options are enabled by default. If the serialized size is not important (for example, you use FlatBuffers for serialization before, which doesn't compress anything), then you should disable compression. If your data are all numbers, the compression may bring 80% performance regression.  ","version":"dev","tagName":"h2"},{"title":"Int Compression‚Äã","type":1,"pageTitle":"Compression","url":"/docs/next/guide/java/compression#int-compression","content":" For int compression, Fory uses 1~5 bytes for encoding. The first bit in every byte indicates whether there is a next byte. If the first bit is set, then the next byte will be read until the first bit of the next byte is unset.  ","version":"dev","tagName":"h3"},{"title":"Long Compression‚Äã","type":1,"pageTitle":"Compression","url":"/docs/next/guide/java/compression#long-compression","content":" For long compression, Fory supports two encodings:  SLI (Small Long as Int) Encoding (Default)‚Äã  If long is in [-1073741824, 1073741823], encode as 4 bytes int: | little-endian: ((int) value) &lt;&lt; 1 |Otherwise write as 9 bytes: | 0b1 | little-endian 8bytes long |  PVL (Progressive Variable-length Long) Encoding‚Äã  First bit in every byte indicates whether there is a next byte. If first bit is set, then next byte will be read until first bit of next byte is unset.Negative numbers will be converted to positive numbers by (v &lt;&lt; 1) ^ (v &gt;&gt; 63) to reduce cost of small negative numbers.  If a number is of long type but can't be represented by smaller bytes mostly, the compression won't get good enough results‚Äînot worthy compared to performance cost. Maybe you should try to disable long compression if you find it didn't bring much space savings.  ","version":"dev","tagName":"h3"},{"title":"Array Compression‚Äã","type":1,"pageTitle":"Compression","url":"/docs/next/guide/java/compression#array-compression","content":" Fory supports SIMD-accelerated compression for primitive arrays (int[] and long[]) when array values can fit in smaller data types. This feature is available on Java 16+ and uses the Vector API for optimal performance.  ","version":"dev","tagName":"h2"},{"title":"How Array Compression Works‚Äã","type":1,"pageTitle":"Compression","url":"/docs/next/guide/java/compression#how-array-compression-works","content":" Array compression analyzes arrays to determine if values can be stored using fewer bytes:  int[] ‚Üí byte[]: When all values are in range [-128, 127] (75% size reduction)int[] ‚Üí short[]: When all values are in range [-32768, 32767] (50% size reduction)long[] ‚Üí int[]: When all values fit in integer range (50% size reduction)  ","version":"dev","tagName":"h3"},{"title":"Configuration and Registration‚Äã","type":1,"pageTitle":"Compression","url":"/docs/next/guide/java/compression#configuration-and-registration","content":" To enable array compression, you must explicitly register the serializers:  Fory fory = Fory.builder() .withLanguage(Language.JAVA) // Enable int array compression .withIntArrayCompressed(true) // Enable long array compression .withLongArrayCompressed(true) .build(); // You must explicitly register compressed array serializers CompressedArraySerializers.registerSerializers(fory);   Note: The fory-simd module must be included in your dependencies for compressed array serializers to be available.  ","version":"dev","tagName":"h3"},{"title":"Maven Dependency‚Äã","type":1,"pageTitle":"Compression","url":"/docs/next/guide/java/compression#maven-dependency","content":" &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-simd&lt;/artifactId&gt; &lt;version&gt;0.15.0&lt;/version&gt; &lt;/dependency&gt;   ","version":"dev","tagName":"h3"},{"title":"String Compression‚Äã","type":1,"pageTitle":"Compression","url":"/docs/next/guide/java/compression#string-compression","content":" String compression can be enabled via ForyBuilder#withStringCompressed(true). This is disabled by default.  ","version":"dev","tagName":"h2"},{"title":"Configuration Summary‚Äã","type":1,"pageTitle":"Compression","url":"/docs/next/guide/java/compression#configuration-summary","content":" Option\tDescription\tDefaultcompressInt\tEnable int compression\ttrue compressLong\tEnable long compression\ttrue compressIntArray\tEnable SIMD int array compression (Java 16+)\tfalse compressLongArray\tEnable SIMD long array compression (Java 16+)\tfalse compressString\tEnable string compression\tfalse  ","version":"dev","tagName":"h2"},{"title":"Performance Considerations‚Äã","type":1,"pageTitle":"Compression","url":"/docs/next/guide/java/compression#performance-considerations","content":" Disable compression for numeric-heavy data: If your data is mostly numbers, compression overhead may not be worth itArray compression requires Java 16+: Uses Vector API for SIMD accelerationLong compression may not help large values: If most longs can't fit in smaller representations, disable itString compression has overhead: Only enable if strings are highly compressible  ","version":"dev","tagName":"h2"},{"title":"Example Configuration‚Äã","type":1,"pageTitle":"Compression","url":"/docs/next/guide/java/compression#example-configuration","content":" // For mostly numeric data - disable compression Fory fory = Fory.builder() .withLanguage(Language.JAVA) .withIntCompressed(false) .withLongCompressed(false) .build(); // For mixed data with arrays - enable array compression Fory fory = Fory.builder() .withLanguage(Language.JAVA) .withIntCompressed(true) .withLongCompressed(true) .withIntArrayCompressed(true) .withLongArrayCompressed(true) .build(); CompressedArraySerializers.registerSerializers(fory);   ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Compression","url":"/docs/next/guide/java/compression#related-topics","content":" Configuration Options - All ForyBuilder optionsAdvanced Features - Memory management ","version":"dev","tagName":"h2"},{"title":"Configuration Options","type":0,"sectionRef":"#","url":"/docs/next/guide/java/configuration","content":"","keywords":"","version":"dev"},{"title":"ForyBuilder Options‚Äã","type":1,"pageTitle":"Configuration Options","url":"/docs/next/guide/java/configuration#forybuilder-options","content":" Option Name\tDescription\tDefault ValuetimeRefIgnored\tWhether to ignore reference tracking of all time types registered in TimeSerializers and subclasses of those types when ref tracking is enabled. If ignored, ref tracking of every time type can be enabled by invoking Fory#registerSerializer(Class, Serializer). For example, fory.registerSerializer(Date.class, new DateSerializer(fory, true)). Note that enabling ref tracking should happen before serializer codegen of any types which contain time fields. Otherwise, those fields will still skip ref tracking.\ttrue compressInt\tEnables or disables int compression for smaller size.\ttrue compressLong\tEnables or disables long compression for smaller size.\ttrue compressIntArray\tEnables or disables SIMD-accelerated compression for int arrays when values can fit in smaller data types. Requires Java 16+.\tfalse compressLongArray\tEnables or disables SIMD-accelerated compression for long arrays when values can fit in smaller data types. Requires Java 16+.\tfalse compressString\tEnables or disables string compression for smaller size.\tfalse classLoader\tThe classloader should not be updated; Fory caches class metadata. Use LoaderBinding or ThreadSafeFory for classloader updates.\tThread.currentThread().getContextClassLoader() compatibleMode\tType forward/backward compatibility config. Also Related to checkClassVersion config. SCHEMA_CONSISTENT: Class schema must be consistent between serialization peer and deserialization peer. COMPATIBLE: Class schema can be different between serialization peer and deserialization peer. They can add/delete fields independently. See more.\tCompatibleMode.SCHEMA_CONSISTENT checkClassVersion\tDetermines whether to check the consistency of the class schema. If enabled, Fory checks, writes, and checks consistency using the classVersionHash. It will be automatically disabled when CompatibleMode#COMPATIBLE is enabled. Disabling is not recommended unless you can ensure the class won't evolve.\tfalse checkJdkClassSerializable\tEnables or disables checking of Serializable interface for classes under java.*. If a class under java.* is not Serializable, Fory will throw an UnsupportedOperationException.\ttrue registerGuavaTypes\tWhether to pre-register Guava types such as RegularImmutableMap/RegularImmutableList. These types are not public API, but seem pretty stable.\ttrue requireClassRegistration\tDisabling may allow unknown classes to be deserialized, potentially causing security risks.\ttrue maxDepth\tSet max depth for deserialization, when depth exceeds, an exception will be thrown. This can be used to refuse deserialization DDOS attack.\t50 suppressClassRegistrationWarnings\tWhether to suppress class registration warnings. The warnings can be used for security audit, but may be annoying, this suppression will be enabled by default.\ttrue metaShareEnabled\tEnables or disables meta share mode.\ttrue if CompatibleMode.COMPATIBLE is set, otherwise false. scopedMetaShareEnabled\tScoped meta share focuses on a single serialization process. Metadata created or identified during this process is exclusive to it and is not shared with by other serializations.\ttrue if CompatibleMode.COMPATIBLE is set, otherwise false. metaCompressor\tSet a compressor for meta compression. Note that the passed MetaCompressor should be thread-safe. By default, a Deflater based compressor DeflaterMetaCompressor will be used. Users can pass other compressor such as zstd for better compression rate.\tDeflaterMetaCompressor deserializeUnknownClass\tEnables or disables deserialization/skipping of data for non-existent or unknown classes.\ttrue if CompatibleMode.COMPATIBLE is set, otherwise false. codeGenEnabled\tDisabling may result in faster initial serialization but slower subsequent serializations.\ttrue asyncCompilationEnabled\tIf enabled, serialization uses interpreter mode first and switches to JIT serialization after async serializer JIT for a class is finished.\tfalse scalaOptimizationEnabled\tEnables or disables Scala-specific serialization optimization.\tfalse copyRef\tWhen disabled, the copy performance will be better. But fory deep copy will ignore circular and shared reference. Same reference of an object graph will be copied into different objects in one Fory#copy.\tfalse serializeEnumByName\tWhen Enabled, fory serialize enum by name instead of ordinal.\tfalse  ","version":"dev","tagName":"h2"},{"title":"Example Configuration‚Äã","type":1,"pageTitle":"Configuration Options","url":"/docs/next/guide/java/configuration#example-configuration","content":" Fory fory = Fory.builder() .withLanguage(Language.JAVA) // enable reference tracking for shared/circular reference. // Disable it will have better performance if no duplicate reference. .withRefTracking(false) // compress int for smaller size .withIntCompressed(true) // compress long for smaller size .withLongCompressed(true) .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT) // enable type forward/backward compatibility // disable it for small size and better performance. // .withCompatibleMode(CompatibleMode.COMPATIBLE) // enable async multi-threaded compilation. .withAsyncCompilation(true) .build();   ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Configuration Options","url":"/docs/next/guide/java/configuration#related-topics","content":" Schema Evolution - Compatible mode and meta sharingCompression - Int, long, and array compression detailsType Registration - Class registration options ","version":"dev","tagName":"h2"},{"title":"Cross-Language Serialization","type":0,"sectionRef":"#","url":"/docs/next/guide/java/cross_language","content":"","keywords":"","version":"dev"},{"title":"Enable Cross-Language Mode‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/java/cross_language#enable-cross-language-mode","content":" To serialize data for consumption by other languages, use Language.XLANG mode:  import org.apache.fory.*; import org.apache.fory.config.*; // Create Fory instance with XLANG mode Fory fory = Fory.builder() .withLanguage(Language.XLANG) .withRefTracking(true) // Enable reference tracking for complex graphs .build();   ","version":"dev","tagName":"h2"},{"title":"Register Types for Cross-Language Compatibility‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/java/cross_language#register-types-for-cross-language-compatibility","content":" Types must be registered with consistent IDs or names across all languages. Fory supports two registration methods:  ","version":"dev","tagName":"h2"},{"title":"Register by ID (Recommended for Performance)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/java/cross_language#register-by-id-recommended-for-performance","content":" public record Person(String name, int age) {} // Register with numeric ID - faster and more compact fory.register(Person.class, 1); Person person = new Person(&quot;Alice&quot;, 30); byte[] bytes = fory.serialize(person); // bytes can be deserialized by Python, Rust, Go, etc.   Benefits: Faster serialization, smaller binary sizeTrade-offs: Requires coordination to avoid ID conflicts across teams/services  ","version":"dev","tagName":"h3"},{"title":"Register by Name (Recommended for Flexibility)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/java/cross_language#register-by-name-recommended-for-flexibility","content":" public record Person(String name, int age) {} // Register with string name - more flexible fory.register(Person.class, &quot;example.Person&quot;); Person person = new Person(&quot;Alice&quot;, 30); byte[] bytes = fory.serialize(person); // bytes can be deserialized by Python, Rust, Go, etc.   Benefits: Less prone to conflicts, easier management across teams, no coordination neededTrade-offs: Slightly larger binary size due to string encoding  ","version":"dev","tagName":"h3"},{"title":"Cross-Language Example: Java ‚Üî Python‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/java/cross_language#cross-language-example-java--python","content":" ","version":"dev","tagName":"h2"},{"title":"Java (Serializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/java/cross_language#java-serializer","content":" import org.apache.fory.*; import org.apache.fory.config.*; public record Person(String name, int age) {} public class Example { public static void main(String[] args) { Fory fory = Fory.builder() .withLanguage(Language.XLANG) .withRefTracking(true) .build(); // Register with consistent name fory.register(Person.class, &quot;example.Person&quot;); Person person = new Person(&quot;Bob&quot;, 25); byte[] bytes = fory.serialize(person); // Send bytes to Python service via network/file/queue } }   ","version":"dev","tagName":"h3"},{"title":"Python (Deserializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/java/cross_language#python-deserializer","content":" import pyfory from dataclasses import dataclass @dataclass class Person: name: str age: pyfory.int32 # Create Fory in xlang mode fory = pyfory.Fory(xlang=True, ref=True) # Register with the SAME name as Java fory.register_type(Person, typename=&quot;example.Person&quot;) # Deserialize bytes from Java person = fory.deserialize(bytes_from_java) print(f&quot;{person.name}, {person.age}&quot;) # Output: Bob, 25   ","version":"dev","tagName":"h3"},{"title":"Handling Circular and Shared References‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/java/cross_language#handling-circular-and-shared-references","content":" Cross-language mode supports circular and shared references when reference tracking is enabled:  public class Node { public String value; public Node next; public Node parent; } Fory fory = Fory.builder() .withLanguage(Language.XLANG) .withRefTracking(true) // Required for circular references .build(); fory.register(Node.class, &quot;example.Node&quot;); // Create circular reference Node node1 = new Node(); node1.value = &quot;A&quot;; Node node2 = new Node(); node2.value = &quot;B&quot;; node1.next = node2; node2.parent = node1; // Circular reference byte[] bytes = fory.serialize(node1); // Python/Rust/Go can correctly deserialize this with circular references preserved   ","version":"dev","tagName":"h2"},{"title":"Type Mapping Considerations‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/java/cross_language#type-mapping-considerations","content":" Not all Java types have equivalents in other languages. When using xlang mode:  Use primitive types (int, long, double, String) for maximum compatibilityUse standard collections (List, Map, Set) instead of language-specific onesAvoid Java-specific types like Optional, BigDecimal (unless the target language supports them)See Type Mapping Guide for complete compatibility matrix  ","version":"dev","tagName":"h2"},{"title":"Compatible Types‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/java/cross_language#compatible-types","content":" public record UserData( String name, // ‚úÖ Compatible int age, // ‚úÖ Compatible List&lt;String&gt; tags, // ‚úÖ Compatible Map&lt;String, Integer&gt; scores // ‚úÖ Compatible ) {}   ","version":"dev","tagName":"h3"},{"title":"Problematic Types‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/java/cross_language#problematic-types","content":" public record UserData( Optional&lt;String&gt; name, // ‚ùå Not cross-language compatible BigDecimal balance, // ‚ùå Limited support EnumSet&lt;Status&gt; statuses // ‚ùå Java-specific collection ) {}   ","version":"dev","tagName":"h3"},{"title":"Performance Considerations‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/java/cross_language#performance-considerations","content":" Cross-language mode has additional overhead compared to Java-only mode:  Type metadata encoding: Adds extra bytes per typeType resolution: Requires name/ID lookup during deserialization  For best performance:  Use ID-based registration when possible (smaller encoding)Disable reference tracking if you don't need circular references (withRefTracking(false))Use Java mode (Language.JAVA) when only Java serialization is needed  ","version":"dev","tagName":"h2"},{"title":"Cross-Language Best Practices‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/java/cross_language#cross-language-best-practices","content":" Consistent Registration: Ensure all services register types with identical IDs/namesVersion Compatibility: Use compatible mode for schema evolution across services  ","version":"dev","tagName":"h2"},{"title":"Troubleshooting Cross-Language Serialization‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/java/cross_language#troubleshooting-cross-language-serialization","content":" ","version":"dev","tagName":"h2"},{"title":"\"Type not registered\" errors‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/java/cross_language#type-not-registered-errors","content":" Verify type is registered with same ID/name on both sidesCheck if type name has typos or case differences  ","version":"dev","tagName":"h3"},{"title":"\"Type mismatch\" errors‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/java/cross_language#type-mismatch-errors","content":" Ensure field types are compatible across languagesReview Type Mapping Guide  ","version":"dev","tagName":"h3"},{"title":"Data corruption or unexpected values‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/java/cross_language#data-corruption-or-unexpected-values","content":" Verify both sides use Language.XLANG modeEnsure both sides have compatible Fory versions  ","version":"dev","tagName":"h3"},{"title":"See Also‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/java/cross_language#see-also","content":" Cross-Language Serialization SpecificationType Mapping ReferencePython Cross-Language GuideRust Cross-Language Guide  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/java/cross_language#related-topics","content":" Schema Evolution - Compatible modeType Registration - Registration methodsRow Format - Cross-language row format ","version":"dev","tagName":"h2"},{"title":"Migration Guide","type":0,"sectionRef":"#","url":"/docs/next/guide/java/migration","content":"","keywords":"","version":"dev"},{"title":"JDK Serialization Migration‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/next/guide/java/migration#jdk-serialization-migration","content":" If you use JDK serialization before and can't upgrade your client and server at the same time (which is common for online applications), Fory provides a utility method org.apache.fory.serializer.JavaSerializer.serializedByJDK to check whether the binary was generated by JDK serialization.  You can use the following pattern to make existing serialization protocol-aware, then upgrade serialization to Fory in an async rolling-up way:  if (JavaSerializer.serializedByJDK(bytes)) { ObjectInputStream objectInputStream = xxx; return objectInputStream.readObject(); } else { return fory.deserialize(bytes); }   This allows you to:  Deploy new code that can read both JDK and Fory serialized dataGradually migrate serialization to ForyEventually remove JDK serialization support  ","version":"dev","tagName":"h2"},{"title":"Upgrade Fory‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/next/guide/java/migration#upgrade-fory","content":" ","version":"dev","tagName":"h2"},{"title":"Minor Version Upgrades‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/next/guide/java/migration#minor-version-upgrades","content":" Currently, binary compatibility is ensured for minor versions only. For example, if you are using Fory v0.2.0, binary compatibility will be provided if you upgrade to Fory v0.2.1.  If you upgrade by minor version, or you won't have data serialized by older Fory, you can upgrade Fory directly without any special handling.  ","version":"dev","tagName":"h3"},{"title":"Major Version Upgrades‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/next/guide/java/migration#major-version-upgrades","content":" If you upgrade to Fory v0.4.1 from v0.2.x, no binary compatibility is ensured.  Most of the time there is no need to upgrade Fory to a newer major version‚Äîthe current version is fast and compact enough, and we provide some minor fixes for recent older versions.  ","version":"dev","tagName":"h3"},{"title":"Versioning Serialized Data‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/next/guide/java/migration#versioning-serialized-data","content":" If you do want to upgrade Fory for better performance and smaller size, you need to write the Fory version as a header to serialized data using code like the following to keep binary compatibility:  Serialization with Version Header‚Äã  MemoryBuffer buffer = xxx; buffer.writeVarInt32(2); // Write Fory version fory.serialize(buffer, obj);   Deserialization with Version Header‚Äã  MemoryBuffer buffer = xxx; int foryVersion = buffer.readVarInt32(); Fory fory = getFory(foryVersion); fory.deserialize(buffer);   getFory is a method to load the corresponding Fory version. You can shade and relocate different versions of Fory to different packages, and load Fory by version.  ","version":"dev","tagName":"h3"},{"title":"Shading Example‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/next/guide/java/migration#shading-example","content":" &lt;!-- Maven Shade Plugin configuration for multiple Fory versions --&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;shade-fory-v1&lt;/id&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;shade&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;relocations&gt; &lt;relocation&gt; &lt;pattern&gt;org.apache.fory&lt;/pattern&gt; &lt;shadedPattern&gt;com.myapp.fory.v1&lt;/shadedPattern&gt; &lt;/relocation&gt; &lt;/relocations&gt; &lt;/configuration&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt;   ","version":"dev","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/next/guide/java/migration#best-practices","content":" Test thoroughly before upgrading: Ensure compatibility with existing serialized dataUse version headers for long-term storage: If data persists across Fory versionsMaintain backward compatibility: Keep old Fory versions available for reading legacy dataMonitor after upgrade: Watch for deserialization errors in production  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/next/guide/java/migration#related-topics","content":" Configuration Options - ForyBuilder optionsSchema Evolution - Handling class changesTroubleshooting - Common migration issues ","version":"dev","tagName":"h2"},{"title":"Row Format","type":0,"sectionRef":"#","url":"/docs/next/guide/java/row_format","content":"","keywords":"","version":"dev"},{"title":"Overview‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/java/row_format#overview","content":" Row format is a cache-friendly binary random access format that supports:  Zero-copy access: Read fields directly from binary without allocating objectsPartial deserialization: Access only the fields you needSkipping serialization: Skip serialization of fields you don't needCross-language compatibility: Works across Python, Java, C++, and other languagesColumn format conversion: Can convert to Apache Arrow columnar format automatically  ","version":"dev","tagName":"h2"},{"title":"Basic Usage‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/java/row_format#basic-usage","content":" public class Bar { String f1; List&lt;Long&gt; f2; } public class Foo { int f1; List&lt;Integer&gt; f2; Map&lt;String, Integer&gt; f3; List&lt;Bar&gt; f4; } RowEncoder&lt;Foo&gt; encoder = Encoders.bean(Foo.class); // Create large dataset Foo foo = new Foo(); foo.f1 = 10; foo.f2 = IntStream.range(0, 1_000_000).boxed().collect(Collectors.toList()); foo.f3 = IntStream.range(0, 1_000_000).boxed().collect(Collectors.toMap(i -&gt; &quot;k&quot; + i, i -&gt; i)); List&lt;Bar&gt; bars = new ArrayList&lt;&gt;(1_000_000); for (int i = 0; i &lt; 1_000_000; i++) { Bar bar = new Bar(); bar.f1 = &quot;s&quot; + i; bar.f2 = LongStream.range(0, 10).boxed().collect(Collectors.toList()); bars.add(bar); } foo.f4 = bars; // Encode to row format (cross-language compatible with Python/C++) BinaryRow binaryRow = encoder.toRow(foo); // Zero-copy random access without full deserialization BinaryArray f2Array = binaryRow.getArray(1); // Access f2 list BinaryArray f4Array = binaryRow.getArray(3); // Access f4 list BinaryRow bar10 = f4Array.getStruct(10); // Access 11th Bar long value = bar10.getArray(1).getInt64(5); // Access 6th element of bar.f2 // Partial deserialization - only deserialize what you need RowEncoder&lt;Bar&gt; barEncoder = Encoders.bean(Bar.class); Bar bar1 = barEncoder.fromRow(f4Array.getStruct(10)); // Deserialize 11th Bar only Bar bar2 = barEncoder.fromRow(f4Array.getStruct(20)); // Deserialize 21st Bar only // Full deserialization when needed Foo newFoo = encoder.fromRow(binaryRow);   ","version":"dev","tagName":"h2"},{"title":"Key Benefits‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/java/row_format#key-benefits","content":" Feature\tDescriptionZero-Copy Access\tRead nested fields without deserializing entire object Memory Efficiency\tMemory-map large datasets directly from disk Cross-Language\tBinary format compatible between Java, Python, C++ Partial Deserialization\tDeserialize only specific elements you need High Performance\tSkip unnecessary data parsing for analytics workloads  ","version":"dev","tagName":"h2"},{"title":"When to Use Row Format‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/java/row_format#when-to-use-row-format","content":" Row format is ideal for:  Analytics workloads: When you only need to access specific fieldsLarge datasets: When full deserialization is too expensiveMemory-mapped files: Working with data larger than RAMData pipelines: Processing data without full object reconstructionCross-language data sharing: When data needs to be accessed from multiple languages  ","version":"dev","tagName":"h2"},{"title":"Cross-Language Compatibility‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/java/row_format#cross-language-compatibility","content":" Row format works seamlessly across languages. The same binary data can be accessed from:  ","version":"dev","tagName":"h2"},{"title":"Python‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/java/row_format#python","content":" import pyfory import pyarrow as pa from dataclasses import dataclass from typing import List, Dict @dataclass class Bar: f1: str f2: List[pa.int64] @dataclass class Foo: f1: pa.int32 f2: List[pa.int32] f3: Dict[str, pa.int32] f4: List[Bar] encoder = pyfory.encoder(Foo) binary: bytes = encoder.to_row(foo).to_bytes() # Zero-copy access foo_row = pyfory.RowData(encoder.schema, binary) print(foo_row.f2[100000]) print(foo_row.f4[100000].f1)   ","version":"dev","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/java/row_format#c","content":" #include &quot;fory/encoder/row_encoder.h&quot; #include &quot;fory/row/writer.h&quot; struct Bar { std::string f1; std::vector&lt;int64_t&gt; f2; FORY_STRUCT(Bar, f1, f2); }; struct Foo { int32_t f1; std::vector&lt;int32_t&gt; f2; std::map&lt;std::string, int32_t&gt; f3; std::vector&lt;Bar&gt; f4; FORY_STRUCT(Foo, f1, f2, f3, f4); }; fory::encoder::RowEncoder&lt;Foo&gt; encoder; encoder.Encode(foo); auto row = encoder.GetWriter().ToRow(); // Zero-copy random access auto f2_array = row-&gt;GetArray(1); auto f4_array = row-&gt;GetArray(3); auto bar10 = f4_array-&gt;GetStruct(10); int64_t value = bar10-&gt;GetArray(1)-&gt;GetInt64(5); std::string str = bar10-&gt;GetString(0);   ","version":"dev","tagName":"h3"},{"title":"Performance Comparison‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/java/row_format#performance-comparison","content":" Operation\tObject Format\tRow FormatFull deserialization\tAllocates all objects\tZero allocation Single field access\tFull deserialization required\tDirect offset read Memory usage\tFull object graph in memory\tOnly accessed fields Suitable for\tSmall objects, full access\tLarge objects, selective access  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/java/row_format#related-topics","content":" Cross-Language Serialization - XLANG modeAdvanced Features - Zero-copy serializationRow Format Specification - Protocol details ","version":"dev","tagName":"h2"},{"title":"Schema Evolution","type":0,"sectionRef":"#","url":"/docs/next/guide/java/schema_evolution","content":"","keywords":"","version":"dev"},{"title":"Handling Class Schema Evolution‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/java/schema_evolution#handling-class-schema-evolution","content":" In many systems, the schema of a class used for serialization may change over time. For instance, fields within a class may be added or removed. When serialization and deserialization processes use different versions of jars, the schema of the class being deserialized may differ from the one used during serialization.  ","version":"dev","tagName":"h2"},{"title":"Default Mode: SCHEMA_CONSISTENT‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/java/schema_evolution#default-mode-schema_consistent","content":" By default, Fory serializes objects using the CompatibleMode.SCHEMA_CONSISTENT mode. This mode assumes that the deserialization process uses the same class schema as the serialization process, minimizing payload overhead. However, if there is a schema inconsistency, deserialization will fail.  ","version":"dev","tagName":"h3"},{"title":"Compatible Mode‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/java/schema_evolution#compatible-mode","content":" If the schema is expected to change, to make deserialization succeed (i.e., schema forward/backward compatibility), users must configure Fory to use CompatibleMode.COMPATIBLE. This can be done using the ForyBuilder#withCompatibleMode(CompatibleMode.COMPATIBLE) method.  In this compatible mode, deserialization can handle schema changes such as missing or extra fields, allowing it to succeed even when the serialization and deserialization processes have different class schemas.  Fory fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .build(); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes));   This compatible mode involves serializing class metadata into the serialized output. Despite Fory's use of sophisticated compression techniques to minimize overhead, there is still some additional space cost associated with class metadata.  ","version":"dev","tagName":"h3"},{"title":"Disable Evolution for Stable Classes‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/java/schema_evolution#disable-evolution-for-stable-classes","content":" If a class schema is stable and will not change, you can opt out of schema evolution on a per-class basis to avoid compatible metadata overhead. Annotate the class with @ForyObject(evolving = false) to force STRUCT/NAMED_STRUCT type IDs even when Compatible mode is enabled.  import org.apache.fory.annotation.ForyObject; @ForyObject(evolving = false) public class StableMessage { public int id; public String name; }   ","version":"dev","tagName":"h3"},{"title":"Meta Sharing‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/java/schema_evolution#meta-sharing","content":" To further reduce metadata costs, Fory introduces a class metadata sharing mechanism, which allows the metadata to be sent to the deserialization process only once.  Fory supports sharing type metadata (class name, field name, final field type information, etc.) between multiple serializations in a context (ex. TCP connection). This information will be sent to the peer during the first serialization in the context. Based on this metadata, the peer can rebuild the same deserializer, which avoids transmitting metadata for subsequent serializations and reduces network traffic pressure while supporting type forward/backward compatibility automatically.  ","version":"dev","tagName":"h2"},{"title":"Using Meta Sharing‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/java/schema_evolution#using-meta-sharing","content":" // Fory.builder() // .withLanguage(Language.JAVA) // .withRefTracking(false) // // share meta across serialization. // .withMetaShare(true) // Not thread-safe fory. MetaContext context = xxx; fory.getSerializationContext().setMetaContext(context); byte[] bytes = fory.serialize(o); // Not thread-safe fory. MetaContext context = xxx; fory.getSerializationContext().setMetaContext(context); fory.deserialize(bytes);   ","version":"dev","tagName":"h3"},{"title":"Thread-Safe Meta Sharing‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/java/schema_evolution#thread-safe-meta-sharing","content":" // Thread-safe fory fory.setClassLoader(beanA.getClass().getClassLoader()); byte[] serialized = fory.execute( f -&gt; { f.getSerializationContext().setMetaContext(context); return f.serialize(beanA); } ); // Thread-safe fory fory.setClassLoader(beanA.getClass().getClassLoader()); Object newObj = fory.execute( f -&gt; { f.getSerializationContext().setMetaContext(context); return f.deserialize(serialized); } );   Note: MetaContext is not thread-safe and cannot be reused across instances of Fory or multiple threads. In cases of multi-threading, a separate MetaContext must be created for each Fory instance.  For more details, please refer to the Meta Sharing specification.  ","version":"dev","tagName":"h3"},{"title":"Deserialize Unknown Classes‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/java/schema_evolution#deserialize-unknown-classes","content":" Fory supports deserializing non-existent or unknown classes. This feature can be enabled by ForyBuilder#deserializeUnknownClass(true).  When enabled and metadata sharing is enabled, Fory will store the deserialized data of this type in a lazy subclass of Map. By using the lazy map implemented by Fory, the rebalance cost of filling map during deserialization can be avoided, which further improves performance.  If this data is sent to another process and the class exists in this process, the data will be deserialized into the object of this type without losing any information.  If metadata sharing is not enabled, the new class data will be skipped and a UnknownSkipClass stub object will be returned.  ","version":"dev","tagName":"h2"},{"title":"Copy/Map Object from One Type to Another‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/java/schema_evolution#copymap-object-from-one-type-to-another","content":" Fory supports mapping objects from one type to another type.  Notes:  This mapping will execute a deep copy. All mapped fields are serialized into binary and deserialized from that binary to map into another type.All struct types must be registered with the same ID, otherwise Fory cannot map to the correct struct type. Be careful when you use Fory#register(Class), because Fory will allocate an auto-grown ID which might be inconsistent if you register classes with different order between Fory instances.  public class StructMappingExample { static class Struct1 { int f1; String f2; public Struct1(int f1, String f2) { this.f1 = f1; this.f2 = f2; } } static class Struct2 { int f1; String f2; double f3; } static ThreadSafeFory fory1 = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE).buildThreadSafeFory(); static ThreadSafeFory fory2 = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE).buildThreadSafeFory(); static { fory1.register(Struct1.class); fory2.register(Struct2.class); } public static void main(String[] args) { Struct1 struct1 = new Struct1(10, &quot;abc&quot;); Struct2 struct2 = (Struct2) fory2.deserialize(fory1.serialize(struct1)); Assert.assertEquals(struct2.f1, struct1.f1); Assert.assertEquals(struct2.f2, struct1.f2); struct1 = (Struct1) fory1.deserialize(fory2.serialize(struct2)); Assert.assertEquals(struct1.f1, struct2.f1); Assert.assertEquals(struct1.f2, struct2.f2); } }   ","version":"dev","tagName":"h2"},{"title":"Deserialize POJO into Another Type‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/java/schema_evolution#deserialize-pojo-into-another-type","content":" Fory allows you to serialize one POJO and deserialize it into a different POJO. The different POJO means schema inconsistency. Users must configure Fory with CompatibleMode set to org.apache.fory.config.CompatibleMode.COMPATIBLE.  public class DeserializeIntoType { static class Struct1 { int f1; String f2; public Struct1(int f1, String f2) { this.f1 = f1; this.f2 = f2; } } static class Struct2 { int f1; String f2; double f3; } static ThreadSafeFory fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE).buildThreadSafeFory(); public static void main(String[] args) { Struct1 struct1 = new Struct1(10, &quot;abc&quot;); byte[] data = fory.serializeJavaObject(struct1); Struct2 struct2 = (Struct2) fory.deserializeJavaObject(bytes, Struct2.class); } }   ","version":"dev","tagName":"h2"},{"title":"Configuration Options‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/java/schema_evolution#configuration-options","content":" Option\tDescription\tDefaultcompatibleMode\tSCHEMA_CONSISTENT or COMPATIBLE\tSCHEMA_CONSISTENT checkClassVersion\tCheck class schema consistency\tfalse metaShareEnabled\tEnable meta sharing\ttrue if Compatible mode scopedMetaShareEnabled\tScoped meta share per serialization\ttrue if Compatible mode deserializeUnknownClass\tHandle non-existent or unknown classes\ttrue if Compatible mode metaCompressor\tCompressor for meta compression\tDeflaterMetaCompressor  ","version":"dev","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/java/schema_evolution#best-practices","content":" Use COMPATIBLE mode for evolving schemas: When classes may change between versionsEnable meta sharing for network communication: Reduces bandwidth for repeated serializationsUse consistent type IDs for struct mapping: Ensure same registration order or explicit IDsConsider space overhead: Compatible mode adds metadata, balance with your requirements  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/java/schema_evolution#related-topics","content":" Configuration Options - All ForyBuilder optionsCross-Language Serialization - XLANG modeTroubleshooting - Common schema issues ","version":"dev","tagName":"h2"},{"title":"Troubleshooting","type":0,"sectionRef":"#","url":"/docs/next/guide/java/troubleshooting","content":"","keywords":"","version":"dev"},{"title":"Class Inconsistency and Class Version Check‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/java/troubleshooting#class-inconsistency-and-class-version-check","content":" If you create Fory without setting CompatibleMode to org.apache.fory.config.CompatibleMode.COMPATIBLE, and you get a strange serialization error, it may be caused by class inconsistency between the serialization peer and deserialization peer.  In such cases, you can invoke ForyBuilder#withClassVersionCheck to create Fory to validate it. If deserialization throws org.apache.fory.exception.ClassNotCompatibleException, it shows classes are inconsistent, and you should create Fory with ForyBuilder#withCompatibleMode(CompatibleMode.COMPATIBLE).  // Enable class version check to diagnose issues Fory fory = Fory.builder() .withLanguage(Language.JAVA) .withClassVersionCheck(true) .build(); // If ClassNotCompatibleException is thrown, use compatible mode Fory fory = Fory.builder() .withLanguage(Language.JAVA) .withCompatibleMode(CompatibleMode.COMPATIBLE) .build();   Note: CompatibleMode.COMPATIBLE has more performance and space cost. Do not set it by default if your classes are always consistent between serialization and deserialization.  ","version":"dev","tagName":"h2"},{"title":"Using Wrong API for Deserialization‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/java/troubleshooting#using-wrong-api-for-deserialization","content":" Make sure you use the matching API pairs:  Serialization API\tDeserialization APIFory#serialize\tFory#deserialize Fory#serializeJavaObject\tFory#deserializeJavaObject Fory#serializeJavaObjectAndClass\tFory#deserializeJavaObjectAndClass  Wrong usage examples:  // ‚ùå Wrong: serialize with serialize, deserialize with deserializeJavaObject byte[] bytes = fory.serialize(object); Object result = fory.deserializeJavaObject(bytes, MyClass.class); // Wrong! // ‚ùå Wrong: serialize with serializeJavaObject, deserialize with deserialize byte[] bytes = fory.serializeJavaObject(object); Object result = fory.deserialize(bytes); // Wrong!   Correct usage:  // ‚úÖ Correct: matching API pairs byte[] bytes = fory.serialize(object); Object result = fory.deserialize(bytes); byte[] bytes = fory.serializeJavaObject(object); MyClass result = fory.deserializeJavaObject(bytes, MyClass.class); byte[] bytes = fory.serializeJavaObjectAndClass(object); Object result = fory.deserializeJavaObjectAndClass(bytes);   ","version":"dev","tagName":"h2"},{"title":"Deserialize POJO into Another Type‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/java/troubleshooting#deserialize-pojo-into-another-type","content":" If you want to serialize one POJO and deserialize it into a different POJO type, you must use CompatibleMode.COMPATIBLE:  public class DeserializeIntoType { static class Struct1 { int f1; String f2; public Struct1(int f1, String f2) { this.f1 = f1; this.f2 = f2; } } static class Struct2 { int f1; String f2; double f3; } static ThreadSafeFory fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE).buildThreadSafeFory(); public static void main(String[] args) { Struct1 struct1 = new Struct1(10, &quot;abc&quot;); byte[] data = fory.serializeJavaObject(struct1); Struct2 struct2 = (Struct2) fory.deserializeJavaObject(data, Struct2.class); } }   ","version":"dev","tagName":"h2"},{"title":"Common Error Messages‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/java/troubleshooting#common-error-messages","content":" ","version":"dev","tagName":"h2"},{"title":"\"Class not registered\"‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/java/troubleshooting#class-not-registered","content":" Cause: Class registration is required but the class wasn't registered.  Solution: Register the class before serialization:  fory.register(MyClass.class); // or with explicit ID fory.register(MyClass.class, 100);   ","version":"dev","tagName":"h3"},{"title":"\"ClassNotCompatibleException\"‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/java/troubleshooting#classnotcompatibleexception","content":" Cause: Class schema differs between serialization and deserialization.  Solution: Use compatible mode:  Fory fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .build();   ","version":"dev","tagName":"h3"},{"title":"\"Max depth exceeded\"‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/java/troubleshooting#max-depth-exceeded","content":" Cause: Object graph is too deep, possibly indicating a circular reference attack.  Solution: Increase max depth if legitimate, or check for malicious data:  Fory fory = Fory.builder() .withMaxDepth(100) // Increase from default 50 .build();   ","version":"dev","tagName":"h3"},{"title":"\"Serializer not found\"‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/java/troubleshooting#serializer-not-found","content":" Cause: No serializer registered for the type.  Solution: Register a custom serializer:  fory.registerSerializer(MyClass.class, new MyClassSerializer(fory));   ","version":"dev","tagName":"h3"},{"title":"Performance Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/java/troubleshooting#performance-issues","content":" ","version":"dev","tagName":"h2"},{"title":"Slow Initial Serialization‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/java/troubleshooting#slow-initial-serialization","content":" Cause: JIT compilation happening on first serialization.  Solution: Enable async compilation:  Fory fory = Fory.builder() .withAsyncCompilation(true) .build();   ","version":"dev","tagName":"h3"},{"title":"High Memory Usage‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/java/troubleshooting#high-memory-usage","content":" Cause: Large object graphs or reference tracking overhead.  Solutions:  Disable reference tracking if not needed: .withRefTracking(false)Use custom memory allocator for poolingConsider row format for large datasets  ","version":"dev","tagName":"h3"},{"title":"Large Serialized Size‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/java/troubleshooting#large-serialized-size","content":" Cause: Metadata overhead or uncompressed data.  Solutions:  Enable compression: .withIntCompressed(true), .withLongCompressed(true)Use compatible mode only when neededRegister classes to avoid class name serialization  ","version":"dev","tagName":"h3"},{"title":"Debugging Tips‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/java/troubleshooting#debugging-tips","content":" Enable class version check to diagnose schema issuesCheck API pairing - ensure serialize/deserialize APIs matchVerify registration order - must be consistent across peersEnable logging to see internal operations:  LoggerFactory.setLogLevel(LogLevel.DEBUG_LEVEL);   ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/java/troubleshooting#related-topics","content":" Configuration Options - All ForyBuilder optionsSchema Evolution - Compatible mode detailsType Registration - Registration best practicesMigration Guide - Upgrading Fory versions ","version":"dev","tagName":"h2"},{"title":"Field Configuration","type":0,"sectionRef":"#","url":"/docs/next/guide/java/field_configuration","content":"","keywords":"","version":"dev"},{"title":"Overview‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/java/field_configuration#overview","content":" Apache Fory‚Ñ¢ provides field-level configuration through annotations:  @ForyField: Configure field metadata (id, nullable, ref, dynamic)@Ignore: Exclude fields from serializationInteger type annotations: Control integer encoding (varint, fixed, tagged, unsigned)  This enables:  Tag IDs: Assign compact numeric IDs to reduce struct field meta size overhead for compatible modeNullability: Control whether fields can be nullReference Tracking: Enable reference tracking for shared objectsField Skipping: Exclude fields from serializationEncoding Control: Specify how integers are encodedPolymorphism Control: Control type info writing for struct fields  ","version":"dev","tagName":"h2"},{"title":"Basic Syntax‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/java/field_configuration#basic-syntax","content":" Use annotations on fields:  import org.apache.fory.annotation.ForyField; public class Person { @ForyField(id = 0) private String name; @ForyField(id = 1) private int age; @ForyField(id = 2, nullable = true) private String nickname; }   ","version":"dev","tagName":"h2"},{"title":"The @ForyField Annotation‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/java/field_configuration#the-foryfield-annotation","content":" Use @ForyField to configure field-level metadata:  public class User { @ForyField(id = 0) private long id; @ForyField(id = 1) private String name; @ForyField(id = 2, nullable = true) private String email; @ForyField(id = 3, ref = true) private List&lt;User&gt; friends; @ForyField(id = 4, dynamic = ForyField.Dynamic.TRUE) private Object data; }   ","version":"dev","tagName":"h2"},{"title":"Parameters‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/java/field_configuration#parameters","content":" Parameter\tType\tDefault\tDescriptionid\tint\t-1\tField tag ID (-1 = use field name) nullable\tboolean\tfalse\tWhether the field can be null ref\tboolean\tfalse\tEnable reference tracking dynamic\tDynamic\tAUTO\tControl polymorphism for struct fields  ","version":"dev","tagName":"h3"},{"title":"Field ID (id)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/java/field_configuration#field-id-id","content":" Assigns a numeric ID to a field to minimize struct field meta size overhead for compatible mode:  public class User { @ForyField(id = 0) private long id; @ForyField(id = 1) private String name; @ForyField(id = 2) private int age; }   Benefits:  Smaller serialized size (numeric IDs vs field names in metadata)Reduced struct field meta overheadAllows renaming fields without breaking binary compatibility  Recommendation: It is recommended to configure field IDs for compatible mode since it reduces serialization cost.  Notes:  IDs must be unique within a classIDs must be &gt;= 0 (use -1 to use field name encoding, which is the default)If not specified, field name is used in metadata (larger overhead)  Without field IDs (field names used in metadata):  public class User { private long id; private String name; }   ","version":"dev","tagName":"h2"},{"title":"Nullable Fields (nullable)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/java/field_configuration#nullable-fields-nullable","content":" Use nullable = true for fields that can be null:  public class Record { // Nullable string field @ForyField(id = 0, nullable = true) private String optionalName; // Nullable Integer field (boxed type) @ForyField(id = 1, nullable = true) private Integer optionalCount; // Non-nullable field (default) @ForyField(id = 2) private String requiredName; }   Notes:  Default is nullable = false (non-nullable)When nullable = false, Fory skips writing the null flag (saves 1 byte)Boxed types (Integer, Long, etc.) that can be null should use nullable = true  ","version":"dev","tagName":"h2"},{"title":"Reference Tracking (ref)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/java/field_configuration#reference-tracking-ref","content":" Enable reference tracking for fields that may be shared or circular:  public class RefOuter { // Both fields may point to the same inner object @ForyField(id = 0, ref = true, nullable = true) private RefInner inner1; @ForyField(id = 1, ref = true, nullable = true) private RefInner inner2; } public class CircularRef { @ForyField(id = 0) private String name; // Self-referencing field for circular references @ForyField(id = 1, ref = true, nullable = true) private CircularRef selfRef; }   Use Cases:  Enable for fields that may be circular or sharedWhen the same object is referenced from multiple fields  Notes:  Default is ref = false (no reference tracking)When ref = false, avoids IdentityMap overhead and skips ref tracking flagReference tracking only takes effect when global ref tracking is enabled  ","version":"dev","tagName":"h2"},{"title":"Dynamic (Polymorphism Control)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/java/field_configuration#dynamic-polymorphism-control","content":" Controls polymorphism behavior for struct fields in cross-language serialization:  public class Container { // AUTO: Interface/abstract types are dynamic, concrete types are not @ForyField(id = 0, dynamic = ForyField.Dynamic.AUTO) private Animal animal; // Interface - type info written // FALSE: No type info written, uses declared type's serializer @ForyField(id = 1, dynamic = ForyField.Dynamic.FALSE) private Dog dog; // Concrete - no type info // TRUE: Type info written to support runtime subtypes @ForyField(id = 2, dynamic = ForyField.Dynamic.TRUE) private Object data; // Force polymorphic }   Options:  Value\tDescriptionAUTO\tAuto-detect: interface/abstract are dynamic, concrete types are not FALSE\tNo type info written, uses declared type's serializer directly TRUE\tType info written to support subtypes at runtime  ","version":"dev","tagName":"h2"},{"title":"Skipping Fields‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/java/field_configuration#skipping-fields","content":" ","version":"dev","tagName":"h2"},{"title":"Using @Ignore‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/java/field_configuration#using-ignore","content":" Exclude fields from serialization:  import org.apache.fory.annotation.Ignore; public class User { @ForyField(id = 0) private long id; @ForyField(id = 1) private String name; @Ignore private String password; // Not serialized @Ignore private Object internalState; // Not serialized }   ","version":"dev","tagName":"h3"},{"title":"Using transient‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/java/field_configuration#using-transient","content":" Java's transient keyword also excludes fields:  public class User { @ForyField(id = 0) private long id; private transient String password; // Not serialized private transient Object cache; // Not serialized }   ","version":"dev","tagName":"h3"},{"title":"Integer Type Annotations‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/java/field_configuration#integer-type-annotations","content":" Fory provides annotations to control integer encoding for cross-language compatibility.  ","version":"dev","tagName":"h2"},{"title":"Signed 32-bit Integer (@Int32Type)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/java/field_configuration#signed-32-bit-integer-int32type","content":" import org.apache.fory.annotation.Int32Type; public class MyStruct { // Variable-length encoding (default) - compact for small values @Int32Type(compress = true) private int compactId; // Fixed 4-byte encoding - consistent size @Int32Type(compress = false) private int fixedId; }   ","version":"dev","tagName":"h3"},{"title":"Signed 64-bit Integer (@Int64Type)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/java/field_configuration#signed-64-bit-integer-int64type","content":" import org.apache.fory.annotation.Int64Type; import org.apache.fory.config.LongEncoding; public class MyStruct { // Variable-length encoding (default) @Int64Type(encoding = LongEncoding.VARINT) private long compactId; // Fixed 8-byte encoding @Int64Type(encoding = LongEncoding.FIXED) private long fixedTimestamp; // Tagged encoding (4 bytes for small values, 9 bytes otherwise) @Int64Type(encoding = LongEncoding.TAGGED) private long taggedValue; }   ","version":"dev","tagName":"h3"},{"title":"Unsigned Integers‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/java/field_configuration#unsigned-integers","content":" import org.apache.fory.annotation.Uint8Type; import org.apache.fory.annotation.Uint16Type; import org.apache.fory.annotation.Uint32Type; import org.apache.fory.annotation.Uint64Type; import org.apache.fory.config.LongEncoding; public class UnsignedStruct { // Unsigned 8-bit [0, 255] @Uint8Type private short flags; // Unsigned 16-bit [0, 65535] @Uint16Type private int port; // Unsigned 32-bit with varint encoding (default) @Uint32Type(compress = true) private long compactCount; // Unsigned 32-bit with fixed encoding @Uint32Type(compress = false) private long fixedCount; // Unsigned 64-bit with various encodings @Uint64Type(encoding = LongEncoding.VARINT) private long varintU64; @Uint64Type(encoding = LongEncoding.FIXED) private long fixedU64; @Uint64Type(encoding = LongEncoding.TAGGED) private long taggedU64; }   ","version":"dev","tagName":"h3"},{"title":"Encoding Summary‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/java/field_configuration#encoding-summary","content":" Annotation\tType ID\tEncoding\tSize@Int32Type(compress = true)\t5\tvarint\t1-5 bytes @Int32Type(compress = false)\t4\tfixed\t4 bytes @Int64Type(encoding = VARINT)\t7\tvarint\t1-10 bytes @Int64Type(encoding = FIXED)\t6\tfixed\t8 bytes @Int64Type(encoding = TAGGED)\t8\ttagged\t4 or 9 bytes @Uint8Type\t9\tfixed\t1 byte @Uint16Type\t10\tfixed\t2 bytes @Uint32Type(compress = true)\t12\tvarint\t1-5 bytes @Uint32Type(compress = false)\t11\tfixed\t4 bytes @Uint64Type(encoding = VARINT)\t14\tvarint\t1-10 bytes @Uint64Type(encoding = FIXED)\t13\tfixed\t8 bytes @Uint64Type(encoding = TAGGED)\t15\ttagged\t4 or 9 bytes  When to Use:  varint: Best for values that are often small (default)fixed: Best for values that use full range (e.g., timestamps, hashes)tagged: Good balance between size and performanceUnsigned types: For cross-language compatibility with Rust, Go, C++  ","version":"dev","tagName":"h3"},{"title":"Complete Example‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/java/field_configuration#complete-example","content":" import org.apache.fory.Fory; import org.apache.fory.annotation.ForyField; import org.apache.fory.annotation.Ignore; import org.apache.fory.annotation.Int64Type; import org.apache.fory.annotation.Uint64Type; import org.apache.fory.config.LongEncoding; import java.util.List; import java.util.Map; import java.util.Set; public class Document { // Fields with tag IDs (recommended for compatible mode) @ForyField(id = 0) private String title; @ForyField(id = 1) private int version; // Nullable field @ForyField(id = 2, nullable = true) private String description; // Collection fields @ForyField(id = 3) private List&lt;String&gt; tags; @ForyField(id = 4) private Map&lt;String, String&gt; metadata; @ForyField(id = 5) private Set&lt;String&gt; categories; // Integer with different encodings @ForyField(id = 6) @Uint64Type(encoding = LongEncoding.VARINT) private long viewCount; // varint encoding @ForyField(id = 7) @Uint64Type(encoding = LongEncoding.FIXED) private long fileSize; // fixed encoding @ForyField(id = 8) @Uint64Type(encoding = LongEncoding.TAGGED) private long checksum; // tagged encoding // Reference-tracked field for shared/circular references @ForyField(id = 9, ref = true, nullable = true) private Document parent; // Ignored field (not serialized) private transient Object cache; // Getters and setters... } // Usage public class Main { public static void main(String[] args) { Fory fory = Fory.builder() .withXlang(true) .withCompatible(true) .withRefTracking(true) .build(); fory.register(Document.class, 100); Document doc = new Document(); doc.setTitle(&quot;My Document&quot;); doc.setVersion(1); doc.setDescription(&quot;A sample document&quot;); // Serialize byte[] data = fory.serialize(doc); // Deserialize Document decoded = (Document) fory.deserialize(data); } }   ","version":"dev","tagName":"h2"},{"title":"Cross-Language Compatibility‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/java/field_configuration#cross-language-compatibility","content":" When serializing data to be read by other languages (Python, Rust, C++, Go), use field IDs and matching type annotations:  public class CrossLangData { // Use field IDs for cross-language compatibility @ForyField(id = 0) @Int32Type(compress = true) private int intVar; @ForyField(id = 1) @Uint64Type(encoding = LongEncoding.FIXED) private long longFixed; @ForyField(id = 2) @Uint64Type(encoding = LongEncoding.TAGGED) private long longTagged; @ForyField(id = 3, nullable = true) private String optionalValue; }   ","version":"dev","tagName":"h2"},{"title":"Schema Evolution‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/java/field_configuration#schema-evolution","content":" Compatible mode supports schema evolution. It is recommended to configure field IDs to reduce serialization cost:  // Version 1 public class DataV1 { @ForyField(id = 0) private long id; @ForyField(id = 1) private String name; } // Version 2: Added new field public class DataV2 { @ForyField(id = 0) private long id; @ForyField(id = 1) private String name; @ForyField(id = 2, nullable = true) private String email; // New field }   Data serialized with V1 can be deserialized with V2 (new field will be null).  Alternatively, field IDs can be omitted (field names will be used in metadata with larger overhead):  public class Data { private long id; private String name; }   ","version":"dev","tagName":"h2"},{"title":"Native Mode vs Xlang Mode‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/java/field_configuration#native-mode-vs-xlang-mode","content":" Field configuration behaves differently depending on the serialization mode:  ","version":"dev","tagName":"h2"},{"title":"Native Mode (Java-only)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/java/field_configuration#native-mode-java-only","content":" Native mode has relaxed default values for maximum compatibility:  Nullable: Reference types are nullable by defaultRef tracking: Enabled by default for object references (except String, boxed types, and time types)Polymorphism: All non-final classes support polymorphism by default  In native mode, you typically don't need to configure field annotations unless you want to:  Reduce serialized size by using field IDsOptimize performance by disabling unnecessary ref trackingControl integer encoding for specific fields  // Native mode: works without any annotations public class User { private long id; private String name; private List&lt;String&gt; tags; // Nullable and ref-tracked by default }   ","version":"dev","tagName":"h3"},{"title":"Xlang Mode (Cross-language)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/java/field_configuration#xlang-mode-cross-language","content":" Xlang mode has stricter default values due to type system differences between languages:  Nullable: Fields are non-nullable by default (nullable = false)Ref tracking: Disabled by default (ref = false)Polymorphism: Concrete types are non-polymorphic by default  In xlang mode, you need to configure fields when:  A field can be null (use nullable = true)A field needs reference tracking for shared/circular objects (use ref = true)Integer types need specific encoding for cross-language compatibilityYou want to reduce metadata size (use field IDs)  // Xlang mode: explicit configuration required for nullable/ref fields public class User { @ForyField(id = 0) private long id; @ForyField(id = 1) private String name; @ForyField(id = 2, nullable = true) // Must declare nullable private String email; @ForyField(id = 3, ref = true, nullable = true) // Must declare ref for shared objects private User friend; }   ","version":"dev","tagName":"h3"},{"title":"Default Values Summary‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/java/field_configuration#default-values-summary","content":" Option\tNative Mode Default\tXlang Mode Defaultnullable\ttrue (reference types)\tfalse ref\ttrue\tfalse dynamic\ttrue (non-final)\tAUTO (concrete types are final)  ","version":"dev","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/java/field_configuration#best-practices","content":" Configure field IDs: Recommended for compatible mode to reduce serialization costUse nullable = true for nullable fields: Required for fields that can be nullEnable ref tracking for shared objects: Use ref = true when objects are shared or circularUse @Ignore or transient for sensitive data: Passwords, tokens, internal stateChoose appropriate encoding: varint for small values, fixed for full-range valuesKeep IDs stable: Once assigned, don't change field IDsConfigure unsigned types for cross-language compatibility: When interoperating with unsigned numbers in Rust, Go, C++  ","version":"dev","tagName":"h2"},{"title":"Annotations Reference‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/java/field_configuration#annotations-reference","content":" Annotation\tDescription@ForyField(id = N)\tField tag ID to reduce metadata size @ForyField(nullable = true)\tMark field as nullable @ForyField(ref = true)\tEnable reference tracking @ForyField(dynamic = ...)\tControl polymorphism for struct fields @Ignore\tExclude field from serialization @Int32Type(compress = ...)\t32-bit signed integer encoding @Int64Type(encoding = ...)\t64-bit signed integer encoding @Uint8Type\tUnsigned 8-bit integer @Uint16Type\tUnsigned 16-bit integer @Uint32Type(compress = ...)\tUnsigned 32-bit integer encoding @Uint64Type(encoding = ...)\tUnsigned 64-bit integer encoding  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/java/field_configuration#related-topics","content":" Basic Serialization - Getting started with Fory serializationSchema Evolution - Compatible mode and schema evolutionCross-Language - Interoperability with Python, Rust, C++, Go ","version":"dev","tagName":"h2"},{"title":"Type Registration & Security","type":0,"sectionRef":"#","url":"/docs/next/guide/java/type_registration","content":"","keywords":"","version":"dev"},{"title":"Class Registration‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/next/guide/java/type_registration#class-registration","content":" ForyBuilder#requireClassRegistration can be used to disable class registration. This will allow deserializing objects of unknown types, which is more flexible but may be insecure if the classes contain malicious code.  Do not disable class registration unless you can ensure your environment is secure. Malicious code in init/equals/hashCode can be executed when deserializing unknown/untrusted types when this option is disabled.  Class registration can not only reduce security risks, but also avoid classname serialization cost.  ","version":"dev","tagName":"h2"},{"title":"Register by ID‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/next/guide/java/type_registration#register-by-id","content":" You can register class with API Fory#register:  Fory fory = xxx; fory.register(SomeClass.class); fory.register(SomeClass1.class, 1);   Note that class registration order is important. Serialization and deserialization peers should have the same registration order.  Internal type IDs 0-32 are reserved for built-in xlang types. Java native built-ins start atTypes.NONE + 1, and user IDs are encoded as (user_id &lt;&lt; 8) | internal_type_id.  ","version":"dev","tagName":"h3"},{"title":"Register by Name‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/next/guide/java/type_registration#register-by-name","content":" Register class by ID will have better performance and smaller space overhead. But in some cases, management for a bunch of type IDs is complex. In such cases, registering class by name using API register(Class&lt;?&gt; cls, String namespace, String typeName) is recommended:  fory.register(Foo.class, &quot;demo&quot;, &quot;Foo&quot;);   If there are no duplicate names for types, namespace can be left as empty to reduce serialized size.  Do not use this API to register class since it will increase serialized size a lot compared to registering class by ID.  ","version":"dev","tagName":"h3"},{"title":"Security Configuration‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/next/guide/java/type_registration#security-configuration","content":" ","version":"dev","tagName":"h2"},{"title":"Class Checker‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/next/guide/java/type_registration#class-checker","content":" If you invoke ForyBuilder#requireClassRegistration(false) to disable class registration check, you can set org.apache.fory.resolver.ClassChecker by ClassResolver#setClassChecker to control which classes are allowed for serialization.  For example, you can allow classes started with org.example.*:  Fory fory = xxx; fory.getClassResolver().setClassChecker( (classResolver, className) -&gt; className.startsWith(&quot;org.example.&quot;));   ","version":"dev","tagName":"h3"},{"title":"AllowListChecker‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/next/guide/java/type_registration#allowlistchecker","content":" Fory provides a org.apache.fory.resolver.AllowListChecker which is an allowed/disallowed list based checker to simplify the customization of class check mechanism:  AllowListChecker checker = new AllowListChecker(AllowListChecker.CheckLevel.STRICT); ThreadSafeFory fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().requireClassRegistration(true).withClassLoader(classLoader).build(); f.getClassResolver().setClassChecker(checker); checker.addListener(f.getClassResolver()); return f; }); checker.allowClass(&quot;org.example.*&quot;);   You can use this checker or implement a more sophisticated checker by yourself.  ","version":"dev","tagName":"h3"},{"title":"Limit Max Deserialization Depth‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/next/guide/java/type_registration#limit-max-deserialization-depth","content":" Fory provides ForyBuilder#withMaxDepth to limit max deserialization depth. The default max depth is 50.  If max depth is reached, Fory will throw ForyException. This can be used to prevent malicious data from causing stack overflow or other issues.  Fory fory = Fory.builder() .withLanguage(Language.JAVA) .withMaxDepth(100) // Set custom max depth .build();   ","version":"dev","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/next/guide/java/type_registration#best-practices","content":" Always enable class registration in production: Use requireClassRegistration(true)Use ID-based registration for performance: Numeric IDs are faster than string namesMaintain consistent registration order: Same order on both serialization and deserialization sidesSet appropriate max depth: Prevent stack overflow attacksUse AllowListChecker for fine-grained control: When you need flexible class filtering  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/next/guide/java/type_registration#related-topics","content":" Configuration Options - ForyBuilder security optionsCustom Serializers - Register custom serializersTroubleshooting - Common registration issues ","version":"dev","tagName":"h2"},{"title":"Kotlin Serialization Guide","type":0,"sectionRef":"#","url":"/docs/next/guide/kotlin/","content":"","keywords":"","version":"dev"},{"title":"Features‚Äã","type":1,"pageTitle":"Kotlin Serialization Guide","url":"/docs/next/guide/kotlin/#features","content":" Fory Kotlin inherits all features from Fory Java, plus Kotlin-specific optimizations:  High Performance: JIT code generation, zero-copy, 20-170x faster than traditional serializationKotlin Type Support: Optimized serializers for data classes, unsigned types, ranges, and stdlib typesDefault Value Support: Automatic handling of Kotlin data class default parameters during schema evolutionSchema Evolution: Forward/backward compatibility for class schema changes  See Java Features for complete feature list.  ","version":"dev","tagName":"h2"},{"title":"Installation‚Äã","type":1,"pageTitle":"Kotlin Serialization Guide","url":"/docs/next/guide/kotlin/#installation","content":" ","version":"dev","tagName":"h2"},{"title":"Maven‚Äã","type":1,"pageTitle":"Kotlin Serialization Guide","url":"/docs/next/guide/kotlin/#maven","content":" &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-kotlin&lt;/artifactId&gt; &lt;version&gt;0.15.0&lt;/version&gt; &lt;/dependency&gt;   ","version":"dev","tagName":"h3"},{"title":"Gradle‚Äã","type":1,"pageTitle":"Kotlin Serialization Guide","url":"/docs/next/guide/kotlin/#gradle","content":" implementation(&quot;org.apache.fory:fory-kotlin:0.15.0&quot;)   ","version":"dev","tagName":"h3"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Kotlin Serialization Guide","url":"/docs/next/guide/kotlin/#quick-start","content":" import org.apache.fory.Fory import org.apache.fory.ThreadSafeFory import org.apache.fory.serializer.kotlin.KotlinSerializers data class Person(val name: String, val id: Long, val github: String) data class Point(val x: Int, val y: Int, val z: Int) fun main() { // Create Fory instance (should be reused) val fory: ThreadSafeFory = Fory.builder() .requireClassRegistration(true) .buildThreadSafeFory() // Register Kotlin serializers KotlinSerializers.registerSerializers(fory) // Register your classes fory.register(Person::class.java) fory.register(Point::class.java) val p = Person(&quot;Shawn Yang&quot;, 1, &quot;https://github.com/chaokunyang&quot;) println(fory.deserialize(fory.serialize(p))) println(fory.deserialize(fory.serialize(Point(1, 2, 3)))) }   ","version":"dev","tagName":"h2"},{"title":"Built on Fory Java‚Äã","type":1,"pageTitle":"Kotlin Serialization Guide","url":"/docs/next/guide/kotlin/#built-on-fory-java","content":" Fory Kotlin is built on top of Fory Java. Most configuration options, features, and concepts from Fory Java apply directly to Kotlin. Refer to the Java documentation for:  Configuration Options - All ForyBuilder optionsBasic Serialization - Serialization patterns and APIsType Registration - Class registration and securitySchema Evolution - Forward/backward compatibilityCustom Serializers - Implement custom serializersCompression - Int, long, and string compressionTroubleshooting - Common issues and solutions  ","version":"dev","tagName":"h2"},{"title":"Kotlin-Specific Documentation‚Äã","type":1,"pageTitle":"Kotlin Serialization Guide","url":"/docs/next/guide/kotlin/#kotlin-specific-documentation","content":" Fory Creation - Kotlin-specific Fory setup requirementsType Serialization - Serializing Kotlin typesDefault Values - Kotlin data class default values support ","version":"dev","tagName":"h2"},{"title":"Custom Serializers","type":0,"sectionRef":"#","url":"/docs/next/guide/java/custom_serializers","content":"","keywords":"","version":"dev"},{"title":"Basic Custom Serializer‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/java/custom_serializers#basic-custom-serializer","content":" In some cases, you may want to implement a serializer for your type, especially for classes that customize serialization using JDK writeObject/writeReplace/readObject/readResolve, which is very inefficient.  For example, if you don't want the following Foo#writeObject to be invoked, you can implement a custom serializer:  class Foo { public long f1; private void writeObject(ObjectOutputStream s) throws IOException { System.out.println(f1); s.defaultWriteObject(); } } class FooSerializer extends Serializer&lt;Foo&gt; { public FooSerializer(Fory fory) { super(fory, Foo.class); } @Override public void write(MemoryBuffer buffer, Foo value) { buffer.writeInt64(value.f1); } @Override public Foo read(MemoryBuffer buffer) { Foo foo = new Foo(); foo.f1 = buffer.readInt64(); return foo; } }   ","version":"dev","tagName":"h2"},{"title":"Register the Serializer‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/java/custom_serializers#register-the-serializer","content":" Fory fory = getFory(); fory.registerSerializer(Foo.class, new FooSerializer(fory));   Besides registering serializers, you can also implement java.io.Externalizable for a class to customize serialization logic. Such types will be serialized by Fory's ExternalizableSerializer.  ","version":"dev","tagName":"h3"},{"title":"Collection Serializer‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/java/custom_serializers#collection-serializer","content":" When implementing a serializer for a custom Collection type, you must extend CollectionSerializer or CollectionLikeSerializer. The key difference is that CollectionLikeSerializer can serialize a class which has a collection-like structure but is not a Java Collection subtype.  ","version":"dev","tagName":"h2"},{"title":"supportCodegenHook Parameter‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/java/custom_serializers#supportcodegenhook-parameter","content":" This special parameter controls serialization behavior:  When true:  Enables optimized access to collection elements and JIT compilation for better performanceDirect serialization invocation and inline for collection items without dynamic serializer dispatch costBetter performance for standard collection typesRecommended for most collections  When false:  Uses interface-based element access and dynamic serializer dispatch for elements (higher cost)More flexible for custom collection typesRequired when collection has special serialization needsHandles complex collection implementations  ","version":"dev","tagName":"h3"},{"title":"Collection Serializer with JIT Support‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/java/custom_serializers#collection-serializer-with-jit-support","content":" When implementing a Collection serializer with JIT support, leverage Fory's existing binary format and collection serialization infrastructure:  public class CustomCollectionSerializer&lt;T extends Collection&gt; extends CollectionSerializer&lt;T&gt; { public CustomCollectionSerializer(Fory fory, Class&lt;T&gt; cls) { // supportCodegenHook controls whether to use JIT compilation super(fory, cls, true); } @Override public Collection onCollectionWrite(MemoryBuffer buffer, T value) { // Write collection size buffer.writeVarUint32Small7(value.size()); // Write any additional collection metadata return value; } @Override public Collection newCollection(MemoryBuffer buffer) { // Create new collection instance Collection collection = super.newCollection(buffer); // Read and set collection size int numElements = getAndClearNumElements(); setNumElements(numElements); return collection; } }   Note: Invoke setNumElements when implementing newCollection to let Fory know how many elements to deserialize.  ","version":"dev","tagName":"h3"},{"title":"Custom Collection Serializer without JIT‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/java/custom_serializers#custom-collection-serializer-without-jit","content":" For collections that use primitive arrays or have special requirements, implement a serializer with JIT disabled:  class IntList extends AbstractCollection&lt;Integer&gt; { private final int[] elements; private final int size; public IntList(int size) { this.elements = new int[size]; this.size = size; } public IntList(int[] elements, int size) { this.elements = elements; this.size = size; } @Override public Iterator&lt;Integer&gt; iterator() { return new Iterator&lt;Integer&gt;() { private int index = 0; @Override public boolean hasNext() { return index &lt; size; } @Override public Integer next() { if (!hasNext()) { throw new NoSuchElementException(); } return elements[index++]; } }; } @Override public int size() { return size; } public int get(int index) { if (index &gt;= size) { throw new IndexOutOfBoundsException(); } return elements[index]; } public void set(int index, int value) { if (index &gt;= size) { throw new IndexOutOfBoundsException(); } elements[index] = value; } public int[] getElements() { return elements; } } class IntListSerializer extends CollectionLikeSerializer&lt;IntList&gt; { public IntListSerializer(Fory fory) { // Disable JIT since we're handling serialization directly super(fory, IntList.class, false); } @Override public void write(MemoryBuffer buffer, IntList value) { // Write size buffer.writeVarUint32Small7(value.size()); // Write elements directly as primitive ints int[] elements = value.getElements(); for (int i = 0; i &lt; value.size(); i++) { buffer.writeVarInt32(elements[i]); } } @Override public IntList read(MemoryBuffer buffer) { // Read size int size = buffer.readVarUint32Small7(); // Create array and read elements int[] elements = new int[size]; for (int i = 0; i &lt; size; i++) { elements[i] = buffer.readVarInt32(); } return new IntList(elements, size); } // These methods are not used when JIT is disabled @Override public Collection onCollectionWrite(MemoryBuffer buffer, IntList value) { throw new UnsupportedOperationException(); } @Override public Collection newCollection(MemoryBuffer buffer) { throw new UnsupportedOperationException(); } @Override public IntList onCollectionRead(Collection collection) { throw new UnsupportedOperationException(); } }   When to use this approach:  Working with primitive typesNeed maximum performanceWant to minimize memory overheadHave special serialization requirements  ","version":"dev","tagName":"h3"},{"title":"Collection-like Type Serializer‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/java/custom_serializers#collection-like-type-serializer","content":" For types that behave like collections but aren't standard Java Collections:  class CustomCollectionLike { private final Object[] elements; private final int size; public CustomCollectionLike(int size) { this.elements = new Object[size]; this.size = 0; } public CustomCollectionLike(Object[] elements, int size) { this.elements = elements; this.size = size; } public Object get(int index) { if (index &gt;= size) { throw new IndexOutOfBoundsException(); } return elements[index]; } public int size() { return size; } public Object[] getElements() { return elements; } } class CollectionView extends AbstractCollection&lt;Object&gt; { private final Object[] elements; private final int size; private int writeIndex; public CollectionView(CustomCollectionLike collection) { this.elements = collection.getElements(); this.size = collection.size(); } public CollectionView(int size) { this.size = size; this.elements = new Object[size]; } @Override public Iterator&lt;Object&gt; iterator() { return new Iterator&lt;Object&gt;() { private int index = 0; @Override public boolean hasNext() { return index &lt; size; } @Override public Object next() { if (!hasNext()) { throw new NoSuchElementException(); } return elements[index++]; } }; } @Override public boolean add(Object element) { if (writeIndex &gt;= size) { throw new IllegalStateException(&quot;Collection is full&quot;); } elements[writeIndex++] = element; return true; } @Override public int size() { return size; } public Object[] getElements() { return elements; } } class CustomCollectionSerializer extends CollectionLikeSerializer&lt;CustomCollectionLike&gt; { public CustomCollectionSerializer(Fory fory) { super(fory, CustomCollectionLike.class, true); } @Override public Collection onCollectionWrite(MemoryBuffer buffer, CustomCollectionLike value) { buffer.writeVarUint32Small7(value.size()); return new CollectionView(value); } @Override public Collection newCollection(MemoryBuffer buffer) { int numElements = buffer.readVarUint32Small7(); setNumElements(numElements); return new CollectionView(numElements); } @Override public CustomCollectionLike onCollectionRead(Collection collection) { CollectionView view = (CollectionView) collection; return new CustomCollectionLike(view.getElements(), view.size()); } }   ","version":"dev","tagName":"h3"},{"title":"Map Serializer‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/java/custom_serializers#map-serializer","content":" When implementing a serializer for a custom Map type, extend MapSerializer or MapLikeSerializer. The key difference is that MapLikeSerializer can serialize a class which has a map-like structure but is not a Java Map subtype.  ","version":"dev","tagName":"h2"},{"title":"Map Serializer with JIT Support‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/java/custom_serializers#map-serializer-with-jit-support","content":" public class CustomMapSerializer&lt;T extends Map&gt; extends MapSerializer&lt;T&gt; { public CustomMapSerializer(Fory fory, Class&lt;T&gt; cls) { // supportCodegenHook is a critical parameter that determines serialization behavior super(fory, cls, true); } @Override public Map onMapWrite(MemoryBuffer buffer, T value) { // Write map size buffer.writeVarUint32Small7(value.size()); // Write any additional map metadata here return value; } @Override public Map newMap(MemoryBuffer buffer) { // Read map size int numElements = buffer.readVarUint32Small7(); setNumElements(numElements); // Create and return new map instance T map = (T) new HashMap(numElements); fory.getRefResolver().reference(map); return map; } }   Note: Invoke setNumElements when implementing newMap to let Fory know how many elements to deserialize.  ","version":"dev","tagName":"h3"},{"title":"Custom Map Serializer without JIT‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/java/custom_serializers#custom-map-serializer-without-jit","content":" For complete control over the serialization process:  class FixedValueMap extends AbstractMap&lt;String, Integer&gt; { private final Set&lt;String&gt; keys; private final int fixedValue; public FixedValueMap(Set&lt;String&gt; keys, int fixedValue) { this.keys = keys; this.fixedValue = fixedValue; } @Override public Set&lt;Entry&lt;String, Integer&gt;&gt; entrySet() { Set&lt;Entry&lt;String, Integer&gt;&gt; entries = new HashSet&lt;&gt;(); for (String key : keys) { entries.add(new SimpleEntry&lt;&gt;(key, fixedValue)); } return entries; } @Override public Integer get(Object key) { return keys.contains(key) ? fixedValue : null; } public Set&lt;String&gt; getKeys() { return keys; } public int getFixedValue() { return fixedValue; } } class FixedValueMapSerializer extends MapLikeSerializer&lt;FixedValueMap&gt; { public FixedValueMapSerializer(Fory fory) { // Disable codegen since we're handling serialization directly super(fory, FixedValueMap.class, false); } @Override public void write(MemoryBuffer buffer, FixedValueMap value) { // Write the fixed value buffer.writeInt32(value.getFixedValue()); // Write the number of keys buffer.writeVarUint32Small7(value.getKeys().size()); // Write each key for (String key : value.getKeys()) { buffer.writeString(key); } } @Override public FixedValueMap read(MemoryBuffer buffer) { // Read the fixed value int fixedValue = buffer.readInt32(); // Read the number of keys int size = buffer.readVarUint32Small7(); Set&lt;String&gt; keys = new HashSet&lt;&gt;(size); for (int i = 0; i &lt; size; i++) { keys.add(buffer.readString()); } return new FixedValueMap(keys, fixedValue); } // These methods are not used when supportCodegenHook is false @Override public Map onMapWrite(MemoryBuffer buffer, FixedValueMap value) { throw new UnsupportedOperationException(); } @Override public FixedValueMap onMapRead(Map map) { throw new UnsupportedOperationException(); } @Override public FixedValueMap onMapCopy(Map map) { throw new UnsupportedOperationException(); } }   ","version":"dev","tagName":"h3"},{"title":"Map-like Type Serializer‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/java/custom_serializers#map-like-type-serializer","content":" For types that behave like maps but aren't standard Java Maps:  class CustomMapLike { private final Object[] keyArray; private final Object[] valueArray; private final int size; public CustomMapLike(int initialCapacity) { this.keyArray = new Object[initialCapacity]; this.valueArray = new Object[initialCapacity]; this.size = 0; } public CustomMapLike(Object[] keyArray, Object[] valueArray, int size) { this.keyArray = keyArray; this.valueArray = valueArray; this.size = size; } public Integer get(String key) { for (int i = 0; i &lt; size; i++) { if (key.equals(keyArray[i])) { return (Integer) valueArray[i]; } } return null; } public int size() { return size; } public Object[] getKeyArray() { return keyArray; } public Object[] getValueArray() { return valueArray; } } class MapView extends AbstractMap&lt;Object, Object&gt; { private final Object[] keyArray; private final Object[] valueArray; private final int size; private int writeIndex; public MapView(CustomMapLike mapLike) { this.size = mapLike.size(); this.keyArray = mapLike.getKeyArray(); this.valueArray = mapLike.getValueArray(); } public MapView(int size) { this.size = size; this.keyArray = new Object[size]; this.valueArray = new Object[size]; } @Override public Set&lt;Entry&lt;Object, Object&gt;&gt; entrySet() { return new AbstractSet&lt;Entry&lt;Object, Object&gt;&gt;() { @Override public Iterator&lt;Entry&lt;Object, Object&gt;&gt; iterator() { return new Iterator&lt;Entry&lt;Object, Object&gt;&gt;() { private int index = 0; @Override public boolean hasNext() { return index &lt; size; } @Override public Entry&lt;Object, Object&gt; next() { if (!hasNext()) { throw new NoSuchElementException(); } final int currentIndex = index++; return new SimpleEntry&lt;&gt;( keyArray[currentIndex], valueArray[currentIndex] ); } }; } @Override public int size() { return size; } }; } @Override public Object put(Object key, Object value) { if (writeIndex &gt;= size) { throw new IllegalStateException(&quot;Map is full&quot;); } keyArray[writeIndex] = key; valueArray[writeIndex] = value; writeIndex++; return null; } public Object[] getKeyArray() { return keyArray; } public Object[] getValueArray() { return valueArray; } public int size() { return size; } } class CustomMapLikeSerializer extends MapLikeSerializer&lt;CustomMapLike&gt; { public CustomMapLikeSerializer(Fory fory) { super(fory, CustomMapLike.class, true); } @Override public Map onMapWrite(MemoryBuffer buffer, CustomMapLike value) { buffer.writeVarUint32Small7(value.size()); return new MapView(value); } @Override public Map newMap(MemoryBuffer buffer) { int numElements = buffer.readVarUint32Small7(); setNumElements(numElements); return new MapView(numElements); } @Override public CustomMapLike onMapRead(Map map) { MapView view = (MapView) map; return new CustomMapLike(view.getKeyArray(), view.getValueArray(), view.size()); } @Override public CustomMapLike onMapCopy(Map map) { MapView view = (MapView) map; return new CustomMapLike(view.getKeyArray(), view.getValueArray(), view.size()); } }   ","version":"dev","tagName":"h3"},{"title":"Registering Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/java/custom_serializers#registering-custom-serializers","content":" Fory fory = Fory.builder() .withLanguage(Language.JAVA) .build(); // Register map serializer fory.registerSerializer(CustomMap.class, new CustomMapSerializer&lt;&gt;(fory, CustomMap.class)); // Register collection serializer fory.registerSerializer(CustomCollection.class, new CustomCollectionSerializer&lt;&gt;(fory, CustomCollection.class));   ","version":"dev","tagName":"h2"},{"title":"Key Points‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/java/custom_serializers#key-points","content":" When implementing custom map or collection serializers:  Always extend the appropriate base class (MapSerializer/MapLikeSerializer for maps, CollectionSerializer/CollectionLikeSerializer for collections)Consider the impact of supportCodegenHook on performance and functionalityProperly handle reference tracking if neededImplement proper size management using setNumElements and getAndClearNumElements when supportCodegenHook is true  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/java/custom_serializers#related-topics","content":" Type Registration - Register serializersSchema Evolution - Compatible mode considerationsConfiguration Options - Serialization options ","version":"dev","tagName":"h2"},{"title":"Default Values","type":0,"sectionRef":"#","url":"/docs/next/guide/kotlin/default_values","content":"","keywords":"","version":"dev"},{"title":"Overview‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/next/guide/kotlin/default_values#overview","content":" When a Kotlin data class has parameters with default values, Fory can:  Detect default values using Kotlin reflectionApply default values during deserialization when fields are missing from serialized dataSupport schema evolution by allowing new fields with defaults to be added without breaking existing serialized data  ","version":"dev","tagName":"h2"},{"title":"Usage‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/next/guide/kotlin/default_values#usage","content":" This feature is automatically enabled when:  Compatible mode is enabled (withCompatibleMode(CompatibleMode.COMPATIBLE))Kotlin serializers are registered (KotlinSerializers.registerSerializers(fory))A field is missing from the serialized data but exists in the target class with a default value  ","version":"dev","tagName":"h2"},{"title":"Example‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/next/guide/kotlin/default_values#example","content":" import org.apache.fory.Fory import org.apache.fory.config.CompatibleMode import org.apache.fory.serializer.kotlin.KotlinSerializers // Original data class data class User(val name: String, val age: Int) // Evolved data class with new field and default value data class UserV2(val name: String, val age: Int, val email: String = &quot;default@example.com&quot;) fun main() { val fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .build() KotlinSerializers.registerSerializers(fory) fory.register(User::class.java) fory.register(UserV2::class.java) // Serialize with old schema val oldUser = User(&quot;John&quot;, 30) val serialized = fory.serialize(oldUser) // Deserialize with new schema - missing field gets default value val newUser = fory.deserialize(serialized) as UserV2 println(newUser) // UserV2(name=John, age=30, email=default@example.com) }   ","version":"dev","tagName":"h2"},{"title":"Supported Default Value Types‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/next/guide/kotlin/default_values#supported-default-value-types","content":" The following types are supported for default values:  Primitive types: Int, Long, Double, Float, Boolean, Byte, Short, CharUnsigned types: UInt, ULong, UByte, UShortString: StringCollections: List, Set, Map (with default instances)Custom objects: Any object that can be instantiated via reflection  ","version":"dev","tagName":"h2"},{"title":"Complex Default Values‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/next/guide/kotlin/default_values#complex-default-values","content":" Default values can be complex expressions:  data class ConfigV1(val name: String) data class ConfigV2( val name: String, val settings: Map&lt;String, String&gt; = mapOf(&quot;default&quot; to &quot;value&quot;), val tags: List&lt;String&gt; = listOf(&quot;default&quot;), val enabled: Boolean = true, val retryCount: Int = 3 ) val fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .build() KotlinSerializers.registerSerializers(fory) val original = ConfigV1(&quot;myConfig&quot;) val serialized = fory.serialize(original) val deserialized = fory.deserialize(serialized) as ConfigV2 // deserialized.name == &quot;myConfig&quot; // deserialized.settings == mapOf(&quot;default&quot; to &quot;value&quot;) // deserialized.tags == listOf(&quot;default&quot;) // deserialized.enabled == true // deserialized.retryCount == 3   ","version":"dev","tagName":"h2"},{"title":"Nullable Fields with Defaults‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/next/guide/kotlin/default_values#nullable-fields-with-defaults","content":" Nullable fields with default values are also supported:  data class PersonV1(val name: String) data class PersonV2( val name: String, val nickname: String? = null, val age: Int? = null ) val original = PersonV1(&quot;John&quot;) val serialized = fory.serialize(original) val deserialized = fory.deserialize(serialized) as PersonV2 // deserialized.name == &quot;John&quot; // deserialized.nickname == null (default) // deserialized.age == null (default)   ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/next/guide/kotlin/default_values#related-topics","content":" Schema Evolution - Forward/backward compatibility in JavaFory Creation - Setting up Fory with compatible mode ","version":"dev","tagName":"h2"},{"title":"Fory Creation","type":0,"sectionRef":"#","url":"/docs/next/guide/kotlin/fory_creation","content":"","keywords":"","version":"dev"},{"title":"Basic Setup‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/next/guide/kotlin/fory_creation#basic-setup","content":" When using Fory for Kotlin serialization, register Kotlin serializers via KotlinSerializers.registerSerializers(fory):  import org.apache.fory.Fory import org.apache.fory.serializer.kotlin.KotlinSerializers val fory = Fory.builder() .requireClassRegistration(true) .build() // Register Kotlin serializers KotlinSerializers.registerSerializers(fory)   ","version":"dev","tagName":"h2"},{"title":"Thread Safety‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/next/guide/kotlin/fory_creation#thread-safety","content":" Fory instance creation is not cheap. Instances should be shared between multiple serializations.  ","version":"dev","tagName":"h2"},{"title":"Single-Thread Usage‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/next/guide/kotlin/fory_creation#single-thread-usage","content":" import org.apache.fory.Fory import org.apache.fory.serializer.kotlin.KotlinSerializers object ForyHolder { val fory: Fory = Fory.builder() .requireClassRegistration(true) .build().also { KotlinSerializers.registerSerializers(it) } }   ","version":"dev","tagName":"h3"},{"title":"Multi-Thread Usage‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/next/guide/kotlin/fory_creation#multi-thread-usage","content":" For multi-threaded applications, use ThreadSafeFory:  import org.apache.fory.Fory import org.apache.fory.ThreadSafeFory import org.apache.fory.ThreadLocalFory import org.apache.fory.serializer.kotlin.KotlinSerializers object ForyHolder { val fory: ThreadSafeFory = ThreadLocalFory { classLoader -&gt; Fory.builder() .withClassLoader(classLoader) .requireClassRegistration(true) .build().also { KotlinSerializers.registerSerializers(it) } } }   ","version":"dev","tagName":"h3"},{"title":"Using Builder Methods‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/next/guide/kotlin/fory_creation#using-builder-methods","content":" // Thread-safe Fory val fory: ThreadSafeFory = Fory.builder() .requireClassRegistration(true) .buildThreadSafeFory() KotlinSerializers.registerSerializers(fory)   ","version":"dev","tagName":"h3"},{"title":"Configuration Options‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/next/guide/kotlin/fory_creation#configuration-options","content":" All configuration options from Fory Java are available. See Java Configuration Options for the complete list.  Common options for Kotlin:  import org.apache.fory.Fory import org.apache.fory.config.CompatibleMode import org.apache.fory.serializer.kotlin.KotlinSerializers val fory = Fory.builder() // Enable reference tracking for circular references .withRefTracking(true) // Enable schema evolution support .withCompatibleMode(CompatibleMode.COMPATIBLE) // Enable async compilation for better startup performance .withAsyncCompilation(true) // Compression options .withIntCompressed(true) .withLongCompressed(true) .build() KotlinSerializers.registerSerializers(fory)  ","version":"dev","tagName":"h2"},{"title":"Type Serialization","type":0,"sectionRef":"#","url":"/docs/next/guide/kotlin/type_serialization","content":"","keywords":"","version":"dev"},{"title":"Setup‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/kotlin/type_serialization#setup","content":" All examples assume the following setup:  import org.apache.fory.Fory import org.apache.fory.serializer.kotlin.KotlinSerializers val fory = Fory.builder() .requireClassRegistration(false) .build() KotlinSerializers.registerSerializers(fory)   ","version":"dev","tagName":"h2"},{"title":"Data Class‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/kotlin/type_serialization#data-class","content":" data class Person(val name: String, val age: Int, val id: Long) fory.register(Person::class.java) val p = Person(&quot;John&quot;, 30, 1L) println(fory.deserialize(fory.serialize(p)))   ","version":"dev","tagName":"h2"},{"title":"Unsigned Primitives‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/kotlin/type_serialization#unsigned-primitives","content":" Kotlin unsigned types are fully supported:  val uByte: UByte = 255u val uShort: UShort = 65535u val uInt: UInt = 4294967295u val uLong: ULong = 18446744073709551615u println(fory.deserialize(fory.serialize(uByte))) println(fory.deserialize(fory.serialize(uShort))) println(fory.deserialize(fory.serialize(uInt))) println(fory.deserialize(fory.serialize(uLong)))   ","version":"dev","tagName":"h2"},{"title":"Unsigned Arrays‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/kotlin/type_serialization#unsigned-arrays","content":" val uByteArray = ubyteArrayOf(1u, 2u, 255u) val uShortArray = ushortArrayOf(1u, 2u, 65535u) val uIntArray = uintArrayOf(1u, 2u, 4294967295u) val uLongArray = ulongArrayOf(1u, 2u, 18446744073709551615u) println(fory.deserialize(fory.serialize(uByteArray)).contentToString()) println(fory.deserialize(fory.serialize(uShortArray)).contentToString()) println(fory.deserialize(fory.serialize(uIntArray)).contentToString()) println(fory.deserialize(fory.serialize(uLongArray)).contentToString())   ","version":"dev","tagName":"h2"},{"title":"Stdlib Types‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/kotlin/type_serialization#stdlib-types","content":" ","version":"dev","tagName":"h2"},{"title":"Pair and Triple‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/kotlin/type_serialization#pair-and-triple","content":" val pair = Pair(&quot;key&quot;, 42) val triple = Triple(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;) println(fory.deserialize(fory.serialize(pair))) println(fory.deserialize(fory.serialize(triple)))   ","version":"dev","tagName":"h3"},{"title":"Result‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/kotlin/type_serialization#result","content":" val success: Result&lt;Int&gt; = Result.success(42) val failure: Result&lt;Int&gt; = Result.failure(Exception(&quot;error&quot;)) println(fory.deserialize(fory.serialize(success))) println(fory.deserialize(fory.serialize(failure)))   ","version":"dev","tagName":"h3"},{"title":"Ranges and Progressions‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/kotlin/type_serialization#ranges-and-progressions","content":" val intRange = 1..10 val longRange = 1L..100L val charRange = 'a'..'z' println(fory.deserialize(fory.serialize(intRange))) println(fory.deserialize(fory.serialize(longRange))) println(fory.deserialize(fory.serialize(charRange))) // Progressions val intProgression = 1..10 step 2 val longProgression = 1L..100L step 10 println(fory.deserialize(fory.serialize(intProgression))) println(fory.deserialize(fory.serialize(longProgression)))   ","version":"dev","tagName":"h2"},{"title":"Collections‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/kotlin/type_serialization#collections","content":" ","version":"dev","tagName":"h2"},{"title":"ArrayDeque‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/kotlin/type_serialization#arraydeque","content":" val deque = ArrayDeque&lt;String&gt;() deque.addFirst(&quot;first&quot;) deque.addLast(&quot;last&quot;) println(fory.deserialize(fory.serialize(deque)))   ","version":"dev","tagName":"h3"},{"title":"Empty Collections‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/kotlin/type_serialization#empty-collections","content":" val emptyList = emptyList&lt;String&gt;() val emptySet = emptySet&lt;Int&gt;() val emptyMap = emptyMap&lt;String, Int&gt;() println(fory.deserialize(fory.serialize(emptyList))) println(fory.deserialize(fory.serialize(emptySet))) println(fory.deserialize(fory.serialize(emptyMap)))   ","version":"dev","tagName":"h3"},{"title":"Duration‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/kotlin/type_serialization#duration","content":" import kotlin.time.Duration import kotlin.time.Duration.Companion.hours import kotlin.time.Duration.Companion.minutes val duration: Duration = 2.hours + 30.minutes println(fory.deserialize(fory.serialize(duration)))   ","version":"dev","tagName":"h2"},{"title":"Regex‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/kotlin/type_serialization#regex","content":" val regex = Regex(&quot;[a-zA-Z]+&quot;) println(fory.deserialize(fory.serialize(regex)))   ","version":"dev","tagName":"h2"},{"title":"UUID (Kotlin 2.0+)‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/kotlin/type_serialization#uuid-kotlin-20","content":" import kotlin.uuid.Uuid val uuid = Uuid.random() println(fory.deserialize(fory.serialize(uuid)))   ","version":"dev","tagName":"h2"},{"title":"Types Working Out of the Box‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/kotlin/type_serialization#types-working-out-of-the-box","content":" The following types work with the default Fory Java implementation without needing KotlinSerializers:  Primitives: Byte, Boolean, Int, Short, Long, Char, Float, DoubleString: StringCollections: ArrayList, HashMap, HashSet, LinkedHashSet, LinkedHashMapArrays: Array, BooleanArray, ByteArray, CharArray, DoubleArray, FloatArray, IntArray, LongArray, ShortArray  However, it's recommended to always call KotlinSerializers.registerSerializers(fory) to ensure all Kotlin types are properly supported. ","version":"dev","tagName":"h2"},{"title":"Python Serialization Guide","type":0,"sectionRef":"#","url":"/docs/next/guide/python/","content":"","keywords":"","version":"dev"},{"title":"Key Features‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/next/guide/python/#key-features","content":" ","version":"dev","tagName":"h2"},{"title":"Flexible Serialization Modes‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/next/guide/python/#flexible-serialization-modes","content":" Python native Mode: Full Python compatibility, drop-in replacement for pickle/cloudpickleCross-Language Mode: Optimized for multi-language data exchangeRow Format: Zero-copy row format for analytics workloads  ","version":"dev","tagName":"h3"},{"title":"Versatile Serialization Features‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/next/guide/python/#versatile-serialization-features","content":" Shared/circular reference support for complex object graphs in both Python-native and cross-language modesPolymorphism support for customized types with automatic type dispatchingSchema evolution support for backward/forward compatibility when using dataclasses in cross-language modeOut-of-band buffer support for zero-copy serialization of large data structures like NumPy arrays and Pandas DataFrames, compatible with pickle protocol 5  ","version":"dev","tagName":"h3"},{"title":"Blazing Fast Performance‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/next/guide/python/#blazing-fast-performance","content":" Extremely fast performance compared to other serialization frameworksRuntime code generation and Cython-accelerated core implementation for optimal performance  ","version":"dev","tagName":"h3"},{"title":"Compact Data Size‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/next/guide/python/#compact-data-size","content":" Compact object graph protocol with minimal space overhead‚Äîup to 3√ó size reduction compared to pickle/cloudpickleMeta packing and sharing to minimize type forward/backward compatibility space overhead  ","version":"dev","tagName":"h3"},{"title":"Security & Safety‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/next/guide/python/#security--safety","content":" Strict mode prevents deserialization of untrusted types by type registration and checks.Reference tracking for handling circular references safely  ","version":"dev","tagName":"h3"},{"title":"Installation‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/next/guide/python/#installation","content":" ","version":"dev","tagName":"h2"},{"title":"Basic Installation‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/next/guide/python/#basic-installation","content":" pip install pyfory   ","version":"dev","tagName":"h3"},{"title":"Optional Dependencies‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/next/guide/python/#optional-dependencies","content":" # Install with row format support (requires Apache Arrow) pip install pyfory[format] # Install from source for development git clone https://github.com/apache/fory.git cd fory/python pip install -e &quot;.[dev,format]&quot;   ","version":"dev","tagName":"h3"},{"title":"Requirements‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/next/guide/python/#requirements","content":" Python: 3.8 or higherOS: Linux, macOS, Windows  ","version":"dev","tagName":"h3"},{"title":"Thread Safety‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/next/guide/python/#thread-safety","content":" pyfory provides ThreadSafeFory for thread-safe serialization using a pooled wrapper:  import pyfory import threading from dataclasses import dataclass @dataclass class Person: name: str age: int # Create thread-safe Fory instance fory = pyfory.ThreadSafeFory(xlang=False, ref=True) fory.register(Person) # Use in multiple threads safely def serialize_in_thread(thread_id): person = Person(name=f&quot;User{thread_id}&quot;, age=25 + thread_id) data = fory.serialize(person) result = fory.deserialize(data) print(f&quot;Thread {thread_id}: {result}&quot;) threads = [threading.Thread(target=serialize_in_thread, args=(i,)) for i in range(10)] for t in threads: t.start() for t in threads: t.join()   Key Features:  Instance Pool: Maintains a pool of Fory instances protected by a lock for thread safetyShared Configuration: All registrations must be done upfront and are applied to all instancesSame API: Drop-in replacement for Fory class with identical methodsRegistration Safety: Prevents registration after first use to ensure consistency  When to Use:  Multi-threaded Applications: Web servers, concurrent workers, parallel processingShared Fory Instances: When multiple threads need to serialize/deserialize dataThread Pools: Applications using thread pools or concurrent.futures  ","version":"dev","tagName":"h2"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/next/guide/python/#quick-start","content":" import pyfory from dataclasses import dataclass @dataclass class Person: name: str age: int # Create Fory instance fory = pyfory.Fory(xlang=False, ref=True) fory.register(Person) person = Person(&quot;Alice&quot;, 30) data = fory.serialize(person) result = fory.deserialize(data) print(result) # Person(name='Alice', age=30)   ","version":"dev","tagName":"h2"},{"title":"Next Steps‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/next/guide/python/#next-steps","content":" Configuration - Fory parameters and modesBasic Serialization - Basic usage patternsPython Native Mode - Functions, lambdas, classesCross-Language - XLANG modeRow Format - Zero-copy row formatSecurity - Security best practices  ","version":"dev","tagName":"h2"},{"title":"Links‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/next/guide/python/#links","content":" Documentation: https://fory.apache.org/docs/latest/python_guide/GitHub: https://github.com/apache/foryPyPI: https://pypi.org/project/pyfory/Issues: https://github.com/apache/fory/issuesSlack: https://join.slack.com/t/fory-project/shared_invite/zt-36g0qouzm-kcQSvV_dtfbtBKHRwT5gsw ","version":"dev","tagName":"h2"},{"title":"Configuration","type":0,"sectionRef":"#","url":"/docs/next/guide/python/configuration","content":"","keywords":"","version":"dev"},{"title":"Fory Class‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/python/configuration#fory-class","content":" The main serialization interface:  class Fory: def __init__( self, xlang: bool = False, ref: bool = False, strict: bool = True, compatible: bool = False, max_depth: int = 50, policy: DeserializationPolicy = None, field_nullable: bool = False, meta_compressor=None, )   ","version":"dev","tagName":"h2"},{"title":"ThreadSafeFory Class‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/python/configuration#threadsafefory-class","content":" Thread-safe serialization interface using a pooled wrapper:  class ThreadSafeFory: def __init__( self, fory_factory=None, **kwargs )   ","version":"dev","tagName":"h2"},{"title":"Parameters‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/python/configuration#parameters","content":" Parameter\tType\tDefault\tDescriptionxlang\tbool\tFalse\tEnable cross-language serialization. When False, enables Python-native mode supporting all Python objects. When True, enables cross-language mode compatible with Java, Go, Rust, etc. ref\tbool\tFalse\tEnable reference tracking for shared/circular references. Disable for better performance if your data has no shared references. strict\tbool\tTrue\tRequire type registration for security. Highly recommended for production. Only disable in trusted environments. compatible\tbool\tFalse\tEnable schema evolution in cross-language mode, allowing fields to be added/removed while maintaining compatibility. max_depth\tint\t50\tMaximum deserialization depth for security, preventing stack overflow attacks. policy\tDeserializationPolicy | None\tNone\tDeserialization policy used for security checks. Strongly recommended when strict=False. field_nullable\tbool\tFalse\tTreat dataclass fields as nullable by default (regardless of xlang). meta_compressor\tAny\tNone\tOptional metadata compressor used for compatible-mode metadata encoding. fory_factory\tCallable | None\tNone\tThreadSafeFory factory hook. When set, ThreadSafeFory creates instances via this callback; otherwise it forwards **kwargs to Fory construction.  ","version":"dev","tagName":"h2"},{"title":"Key Methods‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/python/configuration#key-methods","content":" # Serialization (serialize/deserialize are identical to dumps/loads) data: bytes = fory.serialize(obj) obj = fory.deserialize(data) # Alternative API (aliases) data: bytes = fory.dumps(obj) obj = fory.loads(data) # Type registration by id (for Python mode) fory.register(MyClass, type_id=123) fory.register(MyClass, type_id=123, serializer=custom_serializer) # Type registration by name (for cross-language mode) fory.register(MyClass, typename=&quot;my.package.MyClass&quot;) fory.register(MyClass, typename=&quot;my.package.MyClass&quot;, serializer=custom_serializer)   ","version":"dev","tagName":"h2"},{"title":"Language Modes Comparison‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/python/configuration#language-modes-comparison","content":" Feature\tPython Mode (xlang=False)\tCross-Language Mode (xlang=True)Use Case\tPure Python applications\tMulti-language systems Compatibility\tPython only\tJava, Go, Rust, C++, JavaScript, etc. Supported Types\tAll Python types\tCross-language compatible types only Functions/Lambdas\t‚úì Supported\t‚úó Not allowed Local Classes\t‚úì Supported\t‚úó Not allowed Dynamic Classes\t‚úì Supported\t‚úó Not allowed Schema Evolution\t‚úì Supported (with compatible=True)\t‚úì Supported (with compatible=True) Performance\tExtremely fast\tVery fast Data Size\tCompact\tCompact with type metadata  ","version":"dev","tagName":"h2"},{"title":"Python Mode (xlang=False)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/python/configuration#python-mode-xlangfalse","content":" Python mode supports all Python types including functions, classes, and closures:  import pyfory # Full Python compatibility mode fory = pyfory.Fory(xlang=False, ref=True, strict=False) # Supports ALL Python objects: data = fory.dumps({ 'function': lambda x: x * 2, # Functions and lambdas 'class': type('Dynamic', (), {}), # Dynamic classes 'method': str.upper, # Methods 'nested': {'circular_ref': None} # Circular references (when ref=True) }) # Drop-in replacement for pickle/cloudpickle import pickle obj = [1, 2, {&quot;nested&quot;: [3, 4]}] assert fory.loads(fory.dumps(obj)) == pickle.loads(pickle.dumps(obj))   ","version":"dev","tagName":"h2"},{"title":"Cross-Language Mode (xlang=True)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/python/configuration#cross-language-mode-xlangtrue","content":" Cross-language mode restricts types to those compatible across all Fory implementations:  import pyfory # Cross-language compatibility mode f = pyfory.Fory(xlang=True, ref=True) # Only supports cross-language compatible types f.register(MyDataClass, typename=&quot;com.example.MyDataClass&quot;) # Data can be read by Java, Go, Rust, etc. data = f.serialize(MyDataClass(field1=&quot;value&quot;, field2=42))   ","version":"dev","tagName":"h2"},{"title":"Example Configurations‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/python/configuration#example-configurations","content":" ","version":"dev","tagName":"h2"},{"title":"Production Configuration‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/python/configuration#production-configuration","content":" import pyfory # Recommended settings for production fory = pyfory.Fory( xlang=False, # Use True if you need cross-language support ref=False, # Enable if you have shared/circular references strict=True, # CRITICAL: Always True in production compatible=False, # Enable only if you need schema evolution max_depth=20 # Adjust based on your data structure depth ) # Register all types upfront fory.register(UserModel, type_id=100) fory.register(OrderModel, type_id=101) fory.register(ProductModel, type_id=102)   ","version":"dev","tagName":"h3"},{"title":"Development Configuration‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/python/configuration#development-configuration","content":" import pyfory # Development settings (more permissive) fory = pyfory.Fory( xlang=False, ref=True, strict=False, # Allow any type for development max_depth=1000 # Higher limit for development )   ","version":"dev","tagName":"h3"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/python/configuration#related-topics","content":" Basic Serialization - Using configured ForyType Registration - Registration patternsSecurity - Security best practices ","version":"dev","tagName":"h2"},{"title":"Basic Serialization","type":0,"sectionRef":"#","url":"/docs/next/guide/python/basic_serialization","content":"","keywords":"","version":"dev"},{"title":"Basic Object Serialization‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/python/basic_serialization#basic-object-serialization","content":" Serialize and deserialize Python objects with a simple API:  import pyfory # Create Fory instance fory = pyfory.Fory(xlang=True) # Serialize any Python object data = fory.dumps({&quot;name&quot;: &quot;Alice&quot;, &quot;age&quot;: 30, &quot;scores&quot;: [95, 87, 92]}) # Deserialize back to Python object obj = fory.loads(data) print(obj) # {'name': 'Alice', 'age': 30, 'scores': [95, 87, 92]}   Note: dumps()/loads() are aliases for serialize()/deserialize(). Both APIs are identical, use whichever feels more intuitive.  ","version":"dev","tagName":"h2"},{"title":"Custom Class Serialization‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/python/basic_serialization#custom-class-serialization","content":" Fory automatically handles dataclasses and custom types:  import pyfory from dataclasses import dataclass from typing import List, Dict @dataclass class Person: name: str age: int scores: List[int] metadata: Dict[str, str] # Python mode - supports all Python types including dataclasses fory = pyfory.Fory(xlang=False, ref=True) fory.register(Person) person = Person(&quot;Bob&quot;, 25, [88, 92, 85], {&quot;team&quot;: &quot;engineering&quot;}) data = fory.serialize(person) result = fory.deserialize(data) print(result) # Person(name='Bob', age=25, ...)   ","version":"dev","tagName":"h2"},{"title":"Reference Tracking & Circular References‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/python/basic_serialization#reference-tracking--circular-references","content":" Handle shared references and circular dependencies safely:  import pyfory f = pyfory.Fory(ref=True) # Enable reference tracking # Handle circular references safely class Node: def __init__(self, value): self.value = value self.children = [] self.parent = None root = Node(&quot;root&quot;) child = Node(&quot;child&quot;) child.parent = root # Circular reference root.children.append(child) # Serializes without infinite recursion data = f.serialize(root) result = f.deserialize(data) assert result.children[0].parent is result # Reference preserved   ","version":"dev","tagName":"h2"},{"title":"API Reference‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/python/basic_serialization#api-reference","content":" ","version":"dev","tagName":"h2"},{"title":"Serialization Methods‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/python/basic_serialization#serialization-methods","content":" # Serialize to bytes data: bytes = fory.serialize(obj) data: bytes = fory.dumps(obj) # Alias # Deserialize from bytes obj = fory.deserialize(data) obj = fory.loads(data) # Alias   ","version":"dev","tagName":"h3"},{"title":"With Out-of-Band Buffers‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/python/basic_serialization#with-out-of-band-buffers","content":" # Serialize with buffer callback buffer_objects = [] data = fory.serialize(obj, buffer_callback=buffer_objects.append) # Deserialize with buffers buffers = [obj.getbuffer() for obj in buffer_objects] obj = fory.deserialize(data, buffers=buffers)   ","version":"dev","tagName":"h3"},{"title":"Performance Tips‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/python/basic_serialization#performance-tips","content":" Disable ref=True if not needed: Reference tracking has overheadUse type_id instead of typename: Integer IDs are faster than string namesReuse Fory instances: Create once, use many timesEnable Cython: Make sure ENABLE_FORY_CYTHON_SERIALIZATION=1  # Good: Reuse instance fory = pyfory.Fory() for obj in objects: data = fory.dumps(obj) # Bad: Create new instance each time for obj in objects: fory = pyfory.Fory() # Wasteful! data = fory.dumps(obj)   ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/python/basic_serialization#related-topics","content":" Configuration - Fory parametersType Registration - Registration patternsPython Native Mode - Functions and lambdas ","version":"dev","tagName":"h2"},{"title":"Cross-Language Serialization","type":0,"sectionRef":"#","url":"/docs/next/guide/python/cross_language","content":"","keywords":"","version":"dev"},{"title":"Enable Cross-Language Mode‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/python/cross_language#enable-cross-language-mode","content":" To use xlang mode, create Fory with xlang=True:  import pyfory fory = pyfory.Fory(xlang=True, ref=False, strict=True)   ","version":"dev","tagName":"h2"},{"title":"Cross-Language Example‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/python/cross_language#cross-language-example","content":" ","version":"dev","tagName":"h2"},{"title":"Python (Serializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/python/cross_language#python-serializer","content":" import pyfory from dataclasses import dataclass # Cross-language mode for interoperability f = pyfory.Fory(xlang=True, ref=True) # Register type for cross-language compatibility @dataclass class Person: name: str age: pyfory.int32 f.register(Person, typename=&quot;example.Person&quot;) person = Person(&quot;Charlie&quot;, 35) binary_data = f.serialize(person) # binary_data can now be sent to Java, Go, etc.   ","version":"dev","tagName":"h3"},{"title":"Java (Deserializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/python/cross_language#java-deserializer","content":" import org.apache.fory.*; public class Person { public String name; public int age; } Fory fory = Fory.builder() .withLanguage(Language.XLANG) .withRefTracking(true) .build(); fory.register(Person.class, &quot;example.Person&quot;); Person person = (Person) fory.deserialize(binaryData);   ","version":"dev","tagName":"h3"},{"title":"Rust (Deserializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/python/cross_language#rust-deserializer","content":" use fory::Fory; use fory::ForyObject; #[derive(ForyObject)] struct Person { name: String, age: i32, } let mut fory = Fory::default() .compatible(true) .xlang(true); fory.register_by_namespace::&lt;Person&gt;(&quot;example&quot;, &quot;Person&quot;); let person: Person = fory.deserialize(&amp;binary_data)?;   ","version":"dev","tagName":"h3"},{"title":"Type Annotations for Cross-Language‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/python/cross_language#type-annotations-for-cross-language","content":" Use pyfory type annotations for explicit cross-language type mapping:  from dataclasses import dataclass import pyfory @dataclass class TypedData: int_value: pyfory.int32 # 32-bit integer long_value: pyfory.int64 # 64-bit integer float_value: pyfory.float32 # 32-bit float double_value: pyfory.float64 # 64-bit float   ","version":"dev","tagName":"h2"},{"title":"Type Mapping‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/python/cross_language#type-mapping","content":" Python\tJava\tRust\tGostr\tString\tString\tstring int\tlong\ti64\tint64 pyfory.int32\tint\ti32\tint32 pyfory.int64\tlong\ti64\tint64 float\tdouble\tf64\tfloat64 pyfory.float32\tfloat\tf32\tfloat32 list\tList\tVec\t[]T dict\tMap\tHashMap\tmap[K]V  ","version":"dev","tagName":"h2"},{"title":"Differences from Python Native Mode‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/python/cross_language#differences-from-python-native-mode","content":" The binary protocol and API are similar to pyfory's python-native mode, but Python-native mode can serialize any Python object‚Äîincluding global functions, local functions, lambdas, local classes, and types with customized serialization using __getstate__/__reduce__/__reduce_ex__, which are not allowed in xlang mode.  ","version":"dev","tagName":"h2"},{"title":"See Also‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/python/cross_language#see-also","content":" Cross-Language Serialization SpecificationType Mapping ReferenceJava Cross-Language GuideRust Cross-Language Guide  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/python/cross_language#related-topics","content":" Configuration - XLANG mode settingsSchema Evolution - Compatible modeType Registration - Registration patterns ","version":"dev","tagName":"h2"},{"title":"Custom Serializers","type":0,"sectionRef":"#","url":"/docs/next/guide/python/custom_serializers","content":"","keywords":"","version":"dev"},{"title":"Implementing Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/python/custom_serializers#implementing-custom-serializers","content":" Implement write/read once for both Python and cross-language modes:  import pyfory from pyfory.serializer import Serializer from dataclasses import dataclass @dataclass class Foo: f1: int f2: str class FooSerializer(Serializer): def __init__(self, fory, cls): super().__init__(fory, cls) def write(self, buffer, obj: Foo): # Custom serialization logic buffer.write_varint32(obj.f1) buffer.write_string(obj.f2) def read(self, buffer): # Custom deserialization logic f1 = buffer.read_varint32() f2 = buffer.read_string() return Foo(f1, f2) f = pyfory.Fory() f.register(Foo, type_id=100, serializer=FooSerializer(f, Foo)) # Now Foo uses your custom serializer data = f.dumps(Foo(42, &quot;hello&quot;)) result = f.loads(data) print(result) # Foo(f1=42, f2='hello')   ","version":"dev","tagName":"h2"},{"title":"Buffer API‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/python/custom_serializers#buffer-api","content":" ","version":"dev","tagName":"h2"},{"title":"Write Methods‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/python/custom_serializers#write-methods","content":" # Integers buffer.write_int8(value) buffer.write_int16(value) buffer.write_int32(value) buffer.write_int64(value) # Variable-length integers buffer.write_varint32(value) buffer.write_varint64(value) # Floating point buffer.write_float32(value) buffer.write_float64(value) # Strings and bytes buffer.write_string(value) buffer.write_bytes(value) # Boolean buffer.write_bool(value)   ","version":"dev","tagName":"h3"},{"title":"Read Methods‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/python/custom_serializers#read-methods","content":" # Integers value = buffer.read_int8() value = buffer.read_int16() value = buffer.read_int32() value = buffer.read_int64() # Variable-length integers value = buffer.read_varint32() value = buffer.read_varint64() # Floating point value = buffer.read_float32() value = buffer.read_float64() # Strings and bytes value = buffer.read_string() value = buffer.read_bytes(length) # Boolean value = buffer.read_bool()   ","version":"dev","tagName":"h3"},{"title":"When to Use Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/python/custom_serializers#when-to-use-custom-serializers","content":" External types from other packagesTypes with special serialization requirementsLegacy data format compatibilityPerformance-critical custom encodingTypes that don't work well with automatic serialization  ","version":"dev","tagName":"h2"},{"title":"Registering Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/python/custom_serializers#registering-custom-serializers","content":" fory = pyfory.Fory() # Register with type_id fory.register(MyClass, type_id=100, serializer=MySerializer(fory, MyClass)) # Register with typename (for xlang) fory.register(MyClass, typename=&quot;com.example.MyClass&quot;, serializer=MySerializer(fory, MyClass))   ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/python/custom_serializers#related-topics","content":" Type Registration - Registration patternsConfiguration - Fory parametersCross-Language - type registration and schema rules for xlang ","version":"dev","tagName":"h2"},{"title":"Migration Guide","type":0,"sectionRef":"#","url":"/docs/next/guide/python/migration","content":"","keywords":"","version":"dev"},{"title":"From Pickle‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/next/guide/python/migration#from-pickle","content":" Replace pickle with Fory for better performance while keeping the same API:  # Before (pickle) import pickle data = pickle.dumps(obj) result = pickle.loads(data) # After (Fory - drop-in replacement with better performance) import pyfory f = pyfory.Fory(xlang=False, ref=True, strict=False) data = f.dumps(obj) # Faster and more compact result = f.loads(data) # Faster deserialization # Benefits: # - 2-10x faster serialization # - 2-5x faster deserialization # - Up to 3x smaller data size # - Same API, better performance   ","version":"dev","tagName":"h2"},{"title":"From JSON‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/next/guide/python/migration#from-json","content":" Unlike JSON, Fory supports arbitrary Python types including functions:  # Before (JSON - limited types) import json data = json.dumps({&quot;name&quot;: &quot;Alice&quot;, &quot;age&quot;: 30}) result = json.loads(data) # After (Fory - all Python types) import pyfory f = pyfory.Fory() data = f.dumps({&quot;name&quot;: &quot;Alice&quot;, &quot;age&quot;: 30, &quot;func&quot;: lambda x: x}) result = f.loads(data)   ","version":"dev","tagName":"h2"},{"title":"Key Differences‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/next/guide/python/migration#key-differences","content":" Feature\tpickle\tJSON\tpyforyPerformance\tModerate\tSlow\tFast Data Size\tLarge\tLarge\tCompact Type Support\tAll Python\tLimited\tAll Python Cross-Language\tNo\tYes\tYes (xlang mode) Security\tLow\tHigh\tConfigurable  ","version":"dev","tagName":"h2"},{"title":"Migration Tips‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/next/guide/python/migration#migration-tips","content":" Start with strict=False to ensure compatibilityAdd type registration for performance and securityTest thoroughly before deployingMonitor performance improvements  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/next/guide/python/migration#related-topics","content":" Configuration - Fory parametersPython Native Mode - Pickle replacement featuresSecurity - Security best practices ","version":"dev","tagName":"h2"},{"title":"NumPy & Pandas","type":0,"sectionRef":"#","url":"/docs/next/guide/python/numpy_integration","content":"","keywords":"","version":"dev"},{"title":"NumPy Array Serialization‚Äã","type":1,"pageTitle":"NumPy & Pandas","url":"/docs/next/guide/python/numpy_integration#numpy-array-serialization","content":" Large arrays use zero-copy when possible:  import pyfory import numpy as np f = pyfory.Fory() # Numpy arrays are supported natively arrays = { 'matrix': np.random.rand(1000, 1000), 'vector': np.arange(10000), 'bool_mask': np.random.choice([True, False], size=5000) } data = f.serialize(arrays) result = f.deserialize(data) # Zero-copy for compatible array types assert np.array_equal(arrays['matrix'], result['matrix'])   ","version":"dev","tagName":"h2"},{"title":"Pandas DataFrames‚Äã","type":1,"pageTitle":"NumPy & Pandas","url":"/docs/next/guide/python/numpy_integration#pandas-dataframes","content":" Fory can serialize Pandas DataFrames efficiently:  import pyfory import pandas as pd import numpy as np f = pyfory.Fory(xlang=False, ref=False, strict=False) df = pd.DataFrame({ 'a': np.arange(1000, dtype=np.float64), 'b': np.arange(1000, dtype=np.int64), 'c': ['text'] * 1000 }) data = f.serialize(df) result = f.deserialize(data) assert df.equals(result)   ","version":"dev","tagName":"h2"},{"title":"Zero-Copy with Out-of-Band Buffers‚Äã","type":1,"pageTitle":"NumPy & Pandas","url":"/docs/next/guide/python/numpy_integration#zero-copy-with-out-of-band-buffers","content":" For maximum performance with large arrays, use out-of-band serialization:  import pyfory import numpy as np f = pyfory.Fory(xlang=False, ref=False, strict=False) # Large array array = np.random.rand(10000, 1000) # Out-of-band for zero-copy buffer_objects = [] data = f.serialize(array, buffer_callback=buffer_objects.append) buffers = [obj.getbuffer() for obj in buffer_objects] result = f.deserialize(data, buffers=buffers) assert np.array_equal(array, result)   ","version":"dev","tagName":"h2"},{"title":"Supported Array Types‚Äã","type":1,"pageTitle":"NumPy & Pandas","url":"/docs/next/guide/python/numpy_integration#supported-array-types","content":" np.ndarray (all dtypes)np.matrixStructured arraysRecord arrays  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"NumPy & Pandas","url":"/docs/next/guide/python/numpy_integration#related-topics","content":" Out-of-Band Serialization - Zero-copy buffersBasic Serialization - Standard usage ","version":"dev","tagName":"h2"},{"title":"Python Native Mode","type":0,"sectionRef":"#","url":"/docs/next/guide/python/native_mode","content":"","keywords":"","version":"dev"},{"title":"Overview‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/next/guide/python/native_mode#overview","content":" The binary protocol and API are similar to Fory's xlang mode, but Python-native mode can serialize any Python object‚Äîincluding global functions, local functions, lambdas, local classes and types with customized serialization using __getstate__/__reduce__/__reduce_ex__, which are not allowed in xlang mode.  To use Python-native mode, create Fory with xlang=False:  import pyfory fory = pyfory.Fory(xlang=False, ref=False, strict=True)   ","version":"dev","tagName":"h2"},{"title":"Drop-in Replacement for Pickle/Cloudpickle‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/next/guide/python/native_mode#drop-in-replacement-for-picklecloudpickle","content":" pyfory can serialize any Python object with the following configuration:  For circular references: Set ref=True to enable reference trackingFor functions/classes: Set strict=False to allow deserialization of dynamic types  ‚ö†Ô∏è Security Warning: When strict=False, Fory will deserialize arbitrary types, which can pose security risks if data comes from untrusted sources. Only use strict=False in controlled environments where you trust the data source completely.  ","version":"dev","tagName":"h2"},{"title":"Common Usage‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/next/guide/python/native_mode#common-usage","content":" import pyfory # Create Fory instance fory = pyfory.Fory(xlang=False, ref=True, strict=False) # serialize common Python objects data = fory.dumps({&quot;name&quot;: &quot;Alice&quot;, &quot;age&quot;: 30, &quot;scores&quot;: [95, 87, 92]}) print(fory.loads(data)) # serialize custom objects from dataclasses import dataclass @dataclass class Person: name: str age: int person = Person(&quot;Bob&quot;, 25) data = fory.dumps(person) print(fory.loads(data)) # Person(name='Bob', age=25)   ","version":"dev","tagName":"h3"},{"title":"Serialize Global Functions‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/next/guide/python/native_mode#serialize-global-functions","content":" Capture and serialize functions defined at module level. Fory deserialize and return same function object:  import pyfory fory = pyfory.Fory(xlang=False, ref=True, strict=False) def my_global_function(x): return 10 * x data = fory.dumps(my_global_function) print(fory.loads(data)(10)) # 100   ","version":"dev","tagName":"h2"},{"title":"Serialize Local Functions/Lambdas‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/next/guide/python/native_mode#serialize-local-functionslambdas","content":" Serialize functions with closures and lambda expressions. Fory captures the closure variables automatically:  import pyfory fory = pyfory.Fory(xlang=False, ref=True, strict=False) # Local functions with closures def my_function(): local_var = 10 def local_func(x): return x * local_var return local_func data = fory.dumps(my_function()) print(fory.loads(data)(10)) # 100 # Lambdas data = fory.dumps(lambda x: 10 * x) print(fory.loads(data)(10)) # 100   ","version":"dev","tagName":"h2"},{"title":"Serialize Global Classes/Methods‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/next/guide/python/native_mode#serialize-global-classesmethods","content":" Serialize class objects, instance methods, class methods, and static methods:  from dataclasses import dataclass import pyfory fory = pyfory.Fory(xlang=False, ref=True, strict=False) @dataclass class Person: name: str age: int def f(self, x): return self.age * x @classmethod def g(cls, x): return 10 * x @staticmethod def h(x): return 10 * x # Serialize global class print(fory.loads(fory.dumps(Person))(&quot;Bob&quot;, 25)) # Person(name='Bob', age=25) # Serialize instance method print(fory.loads(fory.dumps(Person(&quot;Bob&quot;, 20).f))(10)) # 200 # Serialize class method print(fory.loads(fory.dumps(Person.g))(10)) # 100 # Serialize static method print(fory.loads(fory.dumps(Person.h))(10)) # 100   ","version":"dev","tagName":"h2"},{"title":"Serialize Local Classes/Methods‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/next/guide/python/native_mode#serialize-local-classesmethods","content":" Serialize classes defined inside functions along with their methods:  from dataclasses import dataclass import pyfory fory = pyfory.Fory(xlang=False, ref=True, strict=False) def create_local_class(): class LocalClass: def f(self, x): return 10 * x @classmethod def g(cls, x): return 10 * x @staticmethod def h(x): return 10 * x return LocalClass # Serialize local class data = fory.dumps(create_local_class()) print(fory.loads(data)().f(10)) # 100 # Serialize local class instance method data = fory.dumps(create_local_class()().f) print(fory.loads(data)(10)) # 100 # Serialize local class method data = fory.dumps(create_local_class().g) print(fory.loads(data)(10)) # 100 # Serialize local class static method data = fory.dumps(create_local_class().h) print(fory.loads(data)(10)) # 100   ","version":"dev","tagName":"h2"},{"title":"Performance Comparison‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/next/guide/python/native_mode#performance-comparison","content":" import pyfory import pickle import timeit fory = pyfory.Fory(xlang=False, ref=True, strict=False) obj = {f&quot;key{i}&quot;: f&quot;value{i}&quot; for i in range(10000)} print(f&quot;Fory: {timeit.timeit(lambda: fory.dumps(obj), number=1000):.3f}s&quot;) print(f&quot;Pickle: {timeit.timeit(lambda: pickle.dumps(obj), number=1000):.3f}s&quot;)   ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/next/guide/python/native_mode#related-topics","content":" Configuration - Python mode configurationOut-of-Band Serialization - Zero-copy buffersSecurity - DeserializationPolicy ","version":"dev","tagName":"h2"},{"title":"Out-of-Band Serialization","type":0,"sectionRef":"#","url":"/docs/next/guide/python/out_of_band","content":"","keywords":"","version":"dev"},{"title":"Overview‚Äã","type":1,"pageTitle":"Out-of-Band Serialization","url":"/docs/next/guide/python/out_of_band#overview","content":" Out-of-band serialization separates metadata from the actual data buffers, allowing for:  Zero-copy transfers when sending data over networks or IPC using memoryviewImproved performance for large datasetsPickle5 compatibility using pickle.PickleBufferFlexible stream support - write to any writable object (files, BytesIO, sockets, etc.)  ","version":"dev","tagName":"h2"},{"title":"Basic Out-of-Band Serialization‚Äã","type":1,"pageTitle":"Out-of-Band Serialization","url":"/docs/next/guide/python/out_of_band#basic-out-of-band-serialization","content":" import pyfory import numpy as np fory = pyfory.Fory(xlang=False, ref=False, strict=False) # Large numpy array array = np.arange(10000, dtype=np.float64) # Serialize with out-of-band buffers buffer_objects = [] serialized_data = fory.serialize(array, buffer_callback=buffer_objects.append) # Convert buffer objects to memoryview for zero-copy transmission # For contiguous buffers (bytes, numpy arrays), this is zero-copy # For non-contiguous data, a copy may be created to ensure contiguity buffers = [obj.getbuffer() for obj in buffer_objects] # Deserialize with out-of-band buffers (accepts memoryview, bytes, or Buffer) deserialized_array = fory.deserialize(serialized_data, buffers=buffers) assert np.array_equal(array, deserialized_array)   ","version":"dev","tagName":"h2"},{"title":"Out-of-Band with Pandas DataFrames‚Äã","type":1,"pageTitle":"Out-of-Band Serialization","url":"/docs/next/guide/python/out_of_band#out-of-band-with-pandas-dataframes","content":" import pyfory import pandas as pd import numpy as np fory = pyfory.Fory(xlang=False, ref=False, strict=False) # Create a DataFrame with numeric columns df = pd.DataFrame({ 'a': np.arange(1000, dtype=np.float64), 'b': np.arange(1000, dtype=np.int64), 'c': ['text'] * 1000 }) # Serialize with out-of-band buffers buffer_objects = [] serialized_data = fory.serialize(df, buffer_callback=buffer_objects.append) buffers = [obj.getbuffer() for obj in buffer_objects] # Deserialize deserialized_df = fory.deserialize(serialized_data, buffers=buffers) assert df.equals(deserialized_df)   ","version":"dev","tagName":"h2"},{"title":"Selective Out-of-Band Serialization‚Äã","type":1,"pageTitle":"Out-of-Band Serialization","url":"/docs/next/guide/python/out_of_band#selective-out-of-band-serialization","content":" Control which buffers go out-of-band by providing a callback that returns True to keep data in-band or False to send it out-of-band:  import pyfory import numpy as np fory = pyfory.Fory(xlang=False, ref=True, strict=False) arr1 = np.arange(1000, dtype=np.float64) arr2 = np.arange(2000, dtype=np.float64) data = [arr1, arr2] buffer_objects = [] counter = 0 def selective_callback(buffer_object): global counter counter += 1 # Only send even-numbered buffers out-of-band if counter % 2 == 0: buffer_objects.append(buffer_object) return False # Out-of-band return True # In-band serialized = fory.serialize(data, buffer_callback=selective_callback) buffers = [obj.getbuffer() for obj in buffer_objects] deserialized = fory.deserialize(serialized, buffers=buffers)   ","version":"dev","tagName":"h2"},{"title":"Pickle5 Compatibility‚Äã","type":1,"pageTitle":"Out-of-Band Serialization","url":"/docs/next/guide/python/out_of_band#pickle5-compatibility","content":" Fory's out-of-band serialization is fully compatible with pickle protocol 5:  import pyfory import pickle fory = pyfory.Fory(xlang=False, ref=False, strict=False) # PickleBuffer objects are automatically supported data = b&quot;Large binary data&quot; pickle_buffer = pickle.PickleBuffer(data) # Serialize with buffer callback for out-of-band handling buffer_objects = [] serialized = fory.serialize(pickle_buffer, buffer_callback=buffer_objects.append) buffers = [obj.getbuffer() for obj in buffer_objects] # Deserialize with buffers deserialized = fory.deserialize(serialized, buffers=buffers) assert bytes(deserialized.raw()) == data   ","version":"dev","tagName":"h2"},{"title":"Writing Buffers to Different Streams‚Äã","type":1,"pageTitle":"Out-of-Band Serialization","url":"/docs/next/guide/python/out_of_band#writing-buffers-to-different-streams","content":" The BufferObject.write_to() method accepts any writable stream object:  import pyfory import numpy as np import io fory = pyfory.Fory(xlang=False, ref=False, strict=False) array = np.arange(1000, dtype=np.float64) # Collect out-of-band buffers buffer_objects = [] serialized = fory.serialize(array, buffer_callback=buffer_objects.append) # Write to different stream types for buffer_obj in buffer_objects: # Write to BytesIO (in-memory stream) bytes_stream = io.BytesIO() buffer_obj.write_to(bytes_stream) # Write to file with open('/tmp/buffer_data.bin', 'wb') as f: buffer_obj.write_to(f) # Get zero-copy memoryview (for contiguous buffers) mv = buffer_obj.getbuffer() assert isinstance(mv, memoryview)   Note: For contiguous memory buffers (like bytes, numpy arrays), getbuffer() returns a zero-copy memoryview. For non-contiguous data, a copy may be created to ensure contiguity.  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Out-of-Band Serialization","url":"/docs/next/guide/python/out_of_band#related-topics","content":" NumPy Integration - NumPy array serializationBasic Serialization - Standard serializationConfiguration - Fory parameters ","version":"dev","tagName":"h2"},{"title":"Row Format","type":0,"sectionRef":"#","url":"/docs/next/guide/python/row_format","content":"","keywords":"","version":"dev"},{"title":"Overview‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/python/row_format#overview","content":" Row format drastically reduces overhead when working with large objects where only partial data access is needed. It also supports memory-mapped files for ultra-low memory footprint.  Key Benefits:  Feature\tDescriptionZero-Copy Access\tRead nested fields without deserializing entire object Memory Efficiency\tMemory-map large datasets directly from disk Cross-Language\tBinary format compatible between Python, Java, C++ Partial Deserialization\tDeserialize only specific elements you need High Performance\tSkip unnecessary data parsing for analytics workloads  ","version":"dev","tagName":"h2"},{"title":"Basic Usage‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/python/row_format#basic-usage","content":" import pyfory import pyarrow as pa from dataclasses import dataclass from typing import List, Dict @dataclass class Bar: f1: str f2: List[pa.int64] @dataclass class Foo: f1: pa.int32 f2: List[pa.int32] f3: Dict[str, pa.int32] f4: List[Bar] # Create encoder for row format encoder = pyfory.encoder(Foo) # Create large dataset foo = Foo( f1=10, f2=list(range(1_000_000)), f3={f&quot;k{i}&quot;: i for i in range(1_000_000)}, f4=[Bar(f1=f&quot;s{i}&quot;, f2=list(range(10))) for i in range(1_000_000)] ) # Encode to row format binary: bytes = encoder.to_row(foo).to_bytes() # Zero-copy access - no full deserialization needed! foo_row = pyfory.RowData(encoder.schema, binary) print(foo_row.f2[100000]) # Access 100,000th element directly print(foo_row.f4[100000].f1) # Access nested field directly print(foo_row.f4[200000].f2[5]) # Access deeply nested field directly   ","version":"dev","tagName":"h2"},{"title":"Cross-Language Compatibility‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/python/row_format#cross-language-compatibility","content":" Row format works seamlessly across languages. The same binary data can be accessed from Java and C++.  ","version":"dev","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/python/row_format#java","content":" public class Bar { String f1; List&lt;Long&gt; f2; } public class Foo { int f1; List&lt;Integer&gt; f2; Map&lt;String, Integer&gt; f3; List&lt;Bar&gt; f4; } RowEncoder&lt;Foo&gt; encoder = Encoders.bean(Foo.class); // Encode to row format (cross-language compatible with Python) BinaryRow binaryRow = encoder.toRow(foo); // Zero-copy random access without full deserialization BinaryArray f2Array = binaryRow.getArray(1); // Access f2 list BinaryArray f4Array = binaryRow.getArray(3); // Access f4 list BinaryRow bar10 = f4Array.getStruct(10); // Access 11th Bar long value = bar10.getArray(1).getInt64(5); // Access 6th element of bar.f2 // Partial deserialization - only deserialize what you need RowEncoder&lt;Bar&gt; barEncoder = Encoders.bean(Bar.class); Bar bar1 = barEncoder.fromRow(f4Array.getStruct(10)); // Deserialize 11th Bar only Bar bar2 = barEncoder.fromRow(f4Array.getStruct(20)); // Deserialize 21st Bar only   ","version":"dev","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/python/row_format#c","content":" #include &quot;fory/encoder/row_encoder.h&quot; #include &quot;fory/row/writer.h&quot; struct Bar { std::string f1; std::vector&lt;int64_t&gt; f2; FORY_STRUCT(Bar, f1, f2); }; struct Foo { int32_t f1; std::vector&lt;int32_t&gt; f2; std::map&lt;std::string, int32_t&gt; f3; std::vector&lt;Bar&gt; f4; FORY_STRUCT(Foo, f1, f2, f3, f4); }; fory::encoder::RowEncoder&lt;Foo&gt; encoder; encoder.Encode(foo); auto row = encoder.GetWriter().ToRow(); // Zero-copy random access without full deserialization auto f2_array = row-&gt;GetArray(1); // Access f2 list auto f4_array = row-&gt;GetArray(3); // Access f4 list auto bar10 = f4_array-&gt;GetStruct(10); // Access 11th Bar int64_t value = bar10-&gt;GetArray(1)-&gt;GetInt64(5); // Access 6th element of bar.f2 std::string str = bar10-&gt;GetString(0); // Access bar.f1   ","version":"dev","tagName":"h3"},{"title":"Installation‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/python/row_format#installation","content":" Row format requires Apache Arrow:  pip install pyfory[format]   ","version":"dev","tagName":"h2"},{"title":"When to Use Row Format‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/python/row_format#when-to-use-row-format","content":" Analytics workloads: When you only need to access specific fieldsLarge datasets: When full deserialization is too expensiveMemory-mapped files: Working with data larger than RAMData pipelines: Processing data without full object reconstructionCross-language data sharing: When data needs to be accessed from multiple languages  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/python/row_format#related-topics","content":" Cross-Language Serialization - XLANG modeBasic Serialization - Object serializationRow Format Specification - Protocol details ","version":"dev","tagName":"h2"},{"title":"Schema Evolution","type":0,"sectionRef":"#","url":"/docs/next/guide/python/schema_evolution","content":"","keywords":"","version":"dev"},{"title":"Enable Compatible Mode‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/python/schema_evolution#enable-compatible-mode","content":" import pyfory f = pyfory.Fory(xlang=True, compatible=True)   ","version":"dev","tagName":"h2"},{"title":"Disable Evolution for Stable Classes‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/python/schema_evolution#disable-evolution-for-stable-classes","content":" If a dataclass schema is stable and will not change, you can disable evolution for that class to avoid compatible metadata overhead. Use pyfory.dataclass with evolving=False:  import pyfory @pyfory.dataclass(evolving=False) class StableMessage: id: int name: str   pyfory.dataclass also supports slots=True:  @pyfory.dataclass(slots=True) class SlotMessage: id: int   ","version":"dev","tagName":"h2"},{"title":"Schema Evolution Example‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/python/schema_evolution#schema-evolution-example","content":" import pyfory from dataclasses import dataclass # Version 1: Original class @dataclass class User: name: str age: int f = pyfory.Fory(xlang=True, compatible=True) f.register(User, typename=&quot;User&quot;) data = f.dumps(User(&quot;Alice&quot;, 30)) # Version 2: Add new field (backward compatible) @dataclass class User: name: str age: int email: str = &quot;unknown@example.com&quot; # New field with default # Can still deserialize old data user = f.loads(data) print(user.email) # &quot;unknown@example.com&quot;   ","version":"dev","tagName":"h2"},{"title":"Supported Changes‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/python/schema_evolution#supported-changes","content":" Add new fields: With default valuesRemove fields: Old data with extra fields will be skippedReorder fields: Fields are matched by name, not position  ","version":"dev","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/python/schema_evolution#best-practices","content":" Always provide default values for new fieldsUse typename for cross-language compatibilityTest schema changes before deployingDocument schema versions for your team  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/python/schema_evolution#related-topics","content":" Configuration - Compatible mode settingsCross-Language - Schema evolution across languagesType Registration - Registration patterns ","version":"dev","tagName":"h2"},{"title":"Field Configuration","type":0,"sectionRef":"#","url":"/docs/next/guide/python/field_configuration","content":"","keywords":"","version":"dev"},{"title":"Overview‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/python/field_configuration#overview","content":" Apache Fory‚Ñ¢ provides field-level configuration through:  pyfory.field(): Configure field metadata (id, nullable, ref, ignore, dynamic)Type annotations: Control integer encoding (varint, fixed, tagged)Optional[T]: Mark fields as nullable  This enables:  Tag IDs: Assign compact numeric IDs to reduce struct field meta size overheadNullability: Control whether fields can be nullReference Tracking: Enable reference tracking for shared objectsField Skipping: Exclude fields from serializationEncoding Control: Specify how integers are encoded (varint, fixed, tagged)Polymorphism: Control whether type info is written for struct fields  ","version":"dev","tagName":"h2"},{"title":"Basic Syntax‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/python/field_configuration#basic-syntax","content":" Use @dataclass decorator with type annotations and pyfory.field():  from dataclasses import dataclass from typing import Optional import pyfory @dataclass class Person: name: str = pyfory.field(id=0) age: pyfory.int32 = pyfory.field(id=1, default=0) nickname: Optional[str] = pyfory.field(id=2, nullable=True, default=None)   ","version":"dev","tagName":"h2"},{"title":"The pyfory.field() Function‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/python/field_configuration#the-pyforyfield-function","content":" Use pyfory.field() to configure field-level metadata:  @dataclass class User: id: pyfory.int64 = pyfory.field(id=0, default=0) name: str = pyfory.field(id=1, default=&quot;&quot;) email: Optional[str] = pyfory.field(id=2, nullable=True, default=None) friends: List[&quot;User&quot;] = pyfory.field(id=3, ref=True, default_factory=list) _cache: dict = pyfory.field(ignore=True, default_factory=dict)   ","version":"dev","tagName":"h2"},{"title":"Parameters‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/python/field_configuration#parameters","content":" Parameter\tType\tDefault\tDescriptionid\tint\t-1\tField tag ID (-1 = use field name) nullable\tbool\tFalse\tWhether the field can be null ref\tbool\tFalse\tEnable reference tracking ignore\tbool\tFalse\tExclude field from serialization dynamic\tbool\tNone\tControl whether type info is written default\tAny\tMISSING\tDefault value for the field default_factory\tCallable\tMISSING\tFactory function for default value  ","version":"dev","tagName":"h3"},{"title":"Field ID (id)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/python/field_configuration#field-id-id","content":" Assigns a numeric ID to a field to minimize struct field meta size overhead:  @dataclass class User: id: pyfory.int64 = pyfory.field(id=0, default=0) name: str = pyfory.field(id=1, default=&quot;&quot;) age: pyfory.int32 = pyfory.field(id=2, default=0)   Benefits:  Smaller serialized size (numeric IDs vs field names in metadata)Reduced struct field meta overheadAllows renaming fields without breaking binary compatibility  Recommendation: It is recommended to configure field IDs for compatible mode since it reduces serialization cost.  Notes:  IDs must be unique within a classIDs must be &gt;= 0 (use -1 to use field name encoding, which is the default)If not specified, field name is used in metadata (larger overhead)  Without field IDs (field names used in metadata):  @dataclass class User: id: pyfory.int64 = 0 name: str = &quot;&quot;   ","version":"dev","tagName":"h2"},{"title":"Nullable Fields (nullable)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/python/field_configuration#nullable-fields-nullable","content":" Use nullable=True for fields that can be None:  from typing import Optional @dataclass class Record: # Nullable string field optional_name: Optional[str] = pyfory.field(id=0, nullable=True, default=None) # Nullable integer field optional_count: Optional[pyfory.int32] = pyfory.field(id=1, nullable=True, default=None)   Notes:  Optional[T] fields must have nullable=TrueNon-optional fields default to nullable=False  ","version":"dev","tagName":"h2"},{"title":"Reference Tracking (ref)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/python/field_configuration#reference-tracking-ref","content":" Enable reference tracking for fields that may be shared or circular:  @dataclass class RefOuter: # Both fields may point to the same inner object inner1: Optional[RefInner] = pyfory.field(id=0, ref=True, nullable=True, default=None) inner2: Optional[RefInner] = pyfory.field(id=1, ref=True, nullable=True, default=None) @dataclass class CircularRef: name: str = pyfory.field(id=0, default=&quot;&quot;) # Self-referencing field for circular references self_ref: Optional[&quot;CircularRef&quot;] = pyfory.field(id=1, ref=True, nullable=True, default=None)   Use Cases:  Enable for fields that may be circular or sharedWhen the same object is referenced from multiple fields  Notes:  Reference tracking only takes effect when Fory(ref=True) is set globallyField-level ref=True AND global ref=True must both be enabled  ","version":"dev","tagName":"h2"},{"title":"Skipping Fields (ignore)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/python/field_configuration#skipping-fields-ignore","content":" Exclude fields from serialization:  @dataclass class User: id: pyfory.int64 = pyfory.field(id=0, default=0) name: str = pyfory.field(id=1, default=&quot;&quot;) # Not serialized _cache: dict = pyfory.field(ignore=True, default_factory=dict) _internal_state: str = pyfory.field(ignore=True, default=&quot;&quot;)   ","version":"dev","tagName":"h2"},{"title":"Dynamic Fields (dynamic)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/python/field_configuration#dynamic-fields-dynamic","content":" Control whether type information is written for struct fields. This is essential for polymorphism support:  from abc import ABC, abstractmethod class Shape(ABC): @abstractmethod def area(self) -&gt; float: pass @dataclass class Circle(Shape): radius: float = 0.0 def area(self) -&gt; float: return 3.14159 * self.radius * self.radius @dataclass class Container: # Abstract class: dynamic is always True (type info written) shape: Shape = pyfory.field(id=0) # Force type info for concrete type (support runtime subtypes) circle: Circle = pyfory.field(id=1, dynamic=True) # Skip type info for concrete type (use declared type directly) fixed_circle: Circle = pyfory.field(id=2, dynamic=False)   Default Behavior:  Mode\tAbstract Class\tConcrete Object Types\tNumeric/str/time TypesNative mode\tTrue\tTrue\tFalse Xlang mode\tTrue\tFalse\tFalse  Notes:  Abstract classes: dynamic is always True (type info must be written)Native mode: dynamic defaults to True for object types, False for numeric/str/time typesXlang mode: dynamic defaults to False for concrete typesUse dynamic=True when a concrete field may hold subclass instancesUse dynamic=False for performance optimization when type is known  ","version":"dev","tagName":"h2"},{"title":"Integer Type Annotations‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/python/field_configuration#integer-type-annotations","content":" Fory provides type annotations to control integer encoding:  ","version":"dev","tagName":"h2"},{"title":"Signed Integers‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/python/field_configuration#signed-integers","content":" @dataclass class SignedIntegers: byte_val: pyfory.int8 = 0 # 8-bit signed short_val: pyfory.int16 = 0 # 16-bit signed int_val: pyfory.int32 = 0 # 32-bit signed (varint encoding) long_val: pyfory.int64 = 0 # 64-bit signed (varint encoding)   ","version":"dev","tagName":"h3"},{"title":"Unsigned Integers‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/python/field_configuration#unsigned-integers","content":" @dataclass class UnsignedIntegers: # Fixed-size encoding u8_val: pyfory.uint8 = 0 # 8-bit unsigned (fixed) u16_val: pyfory.uint16 = 0 # 16-bit unsigned (fixed) # Variable-length encoding (default for u32/u64) u32_var: pyfory.uint32 = 0 # 32-bit unsigned (varint) u64_var: pyfory.uint64 = 0 # 64-bit unsigned (varint) # Explicit fixed-size encoding u32_fixed: pyfory.fixed_uint32 = 0 # 32-bit unsigned (fixed 4 bytes) u64_fixed: pyfory.fixed_uint64 = 0 # 64-bit unsigned (fixed 8 bytes) # Tagged encoding (includes type tag) u64_tagged: pyfory.tagged_uint64 = 0 # 64-bit unsigned (tagged)   ","version":"dev","tagName":"h3"},{"title":"Floating Point‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/python/field_configuration#floating-point","content":" @dataclass class FloatingPoint: float_val: pyfory.float32 = 0.0 # 32-bit float double_val: pyfory.float64 = 0.0 # 64-bit double   ","version":"dev","tagName":"h3"},{"title":"Encoding Summary‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/python/field_configuration#encoding-summary","content":" Type\tEncoding\tSizepyfory.int8\tfixed\t1 byte pyfory.int16\tfixed\t2 bytes pyfory.int32\tvarint\t1-5 bytes pyfory.int64\tvarint\t1-10 bytes pyfory.uint8\tfixed\t1 byte pyfory.uint16\tfixed\t2 bytes pyfory.uint32\tvarint\t1-5 bytes pyfory.uint64\tvarint\t1-10 bytes pyfory.fixed_uint32\tfixed\t4 bytes pyfory.fixed_uint64\tfixed\t8 bytes pyfory.tagged_uint64\ttagged\t1-9 bytes pyfory.float32\tfixed\t4 bytes pyfory.float64\tfixed\t8 bytes  When to Use:  varint: Best for values that are often small (default for int32/int64/uint32/uint64)fixed: Best for values that use full range (e.g., timestamps, hashes)tagged: When type information needs to be preserved (uint64 only)  ","version":"dev","tagName":"h3"},{"title":"Complete Example‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/python/field_configuration#complete-example","content":" from dataclasses import dataclass from typing import Optional, List, Dict, Set import pyfory @dataclass class Document: # Fields with tag IDs (recommended for compatible mode) title: str = pyfory.field(id=0, default=&quot;&quot;) version: pyfory.int32 = pyfory.field(id=1, default=0) # Nullable field description: Optional[str] = pyfory.field(id=2, nullable=True, default=None) # Collection fields tags: List[str] = pyfory.field(id=3, default_factory=list) metadata: Dict[str, str] = pyfory.field(id=4, default_factory=dict) categories: Set[str] = pyfory.field(id=5, default_factory=set) # Unsigned integers with different encodings view_count: pyfory.uint64 = pyfory.field(id=6, default=0) # varint encoding file_size: pyfory.fixed_uint64 = pyfory.field(id=7, default=0) # fixed encoding checksum: pyfory.tagged_uint64 = pyfory.field(id=8, default=0) # tagged encoding # Reference-tracked field for shared/circular references parent: Optional[&quot;Document&quot;] = pyfory.field(id=9, ref=True, nullable=True, default=None) # Ignored field (not serialized) _cache: dict = pyfory.field(ignore=True, default_factory=dict) def main(): fory = pyfory.Fory(xlang=True, compatible=True, ref=True) fory.register_type(Document, type_id=100) doc = Document( title=&quot;My Document&quot;, version=1, description=&quot;A sample document&quot;, tags=[&quot;tag1&quot;, &quot;tag2&quot;], metadata={&quot;key&quot;: &quot;value&quot;}, categories={&quot;cat1&quot;}, view_count=42, file_size=1024, checksum=123456789, parent=None, ) # Serialize data = fory.serialize(doc) # Deserialize decoded = fory.deserialize(data) assert decoded.title == doc.title assert decoded.version == doc.version if __name__ == &quot;__main__&quot;: main()   ","version":"dev","tagName":"h2"},{"title":"Cross-Language Compatibility‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/python/field_configuration#cross-language-compatibility","content":" When serializing data to be read by other languages (Java, Rust, C++, Go), use field IDs and matching type annotations:  @dataclass class CrossLangData: # Use field IDs for cross-language compatibility int_var: pyfory.int32 = pyfory.field(id=0, default=0) long_fixed: pyfory.fixed_uint64 = pyfory.field(id=1, default=0) long_tagged: pyfory.tagged_uint64 = pyfory.field(id=2, default=0) optional_value: Optional[str] = pyfory.field(id=3, nullable=True, default=None)   ","version":"dev","tagName":"h2"},{"title":"Schema Evolution‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/python/field_configuration#schema-evolution","content":" Compatible mode supports schema evolution. It is recommended to configure field IDs to reduce serialization cost:  # Version 1 @dataclass class DataV1: id: pyfory.int64 = pyfory.field(id=0, default=0) name: str = pyfory.field(id=1, default=&quot;&quot;) # Version 2: Added new field @dataclass class DataV2: id: pyfory.int64 = pyfory.field(id=0, default=0) name: str = pyfory.field(id=1, default=&quot;&quot;) email: Optional[str] = pyfory.field(id=2, nullable=True, default=None) # New field   Data serialized with V1 can be deserialized with V2 (new field will be None).  Alternatively, field IDs can be omitted (field names will be used in metadata with larger overhead):  @dataclass class Data: id: pyfory.int64 = 0 name: str = &quot;&quot;   ","version":"dev","tagName":"h2"},{"title":"Native Mode vs Xlang Mode‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/python/field_configuration#native-mode-vs-xlang-mode","content":" Field configuration behaves differently depending on the serialization mode:  ","version":"dev","tagName":"h2"},{"title":"Native Mode (Python-only)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/python/field_configuration#native-mode-python-only","content":" Native mode has relaxed default values for maximum compatibility:  Nullable: str and numeric types are non-nullable by default unless Optional is usedRef tracking: Enabled by default for object references (except str and numeric types)  In native mode, you typically don't need to configure field annotations unless you want to:  Reduce serialized size by using field IDsOptimize performance by disabling unnecessary ref tracking  # Native mode: works without field configuration @dataclass class User: id: int = 0 name: str = &quot;&quot; tags: List[str] = None   ","version":"dev","tagName":"h3"},{"title":"Xlang Mode (Cross-language)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/python/field_configuration#xlang-mode-cross-language","content":" Xlang mode has stricter default values due to type system differences between languages:  Nullable: Fields are non-nullable by default (nullable=False)Ref tracking: Disabled by default (ref=False)  In xlang mode, you need to configure fields when:  A field can be None (use Optional[T] with nullable=True)A field needs reference tracking for shared/circular objects (use ref=True)Integer types need specific encoding for cross-language compatibilityYou want to reduce metadata size (use field IDs)  # Xlang mode: explicit configuration required for nullable/ref fields @dataclass class User: id: pyfory.int64 = pyfory.field(id=0, default=0) name: str = pyfory.field(id=1, default=&quot;&quot;) email: Optional[str] = pyfory.field(id=2, nullable=True, default=None) # Must declare nullable friend: Optional[&quot;User&quot;] = pyfory.field(id=3, ref=True, nullable=True, default=None) # Must declare ref   ","version":"dev","tagName":"h3"},{"title":"Default Values Summary‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/python/field_configuration#default-values-summary","content":" Option\tNative Mode Default\tXlang Mode Defaultnullable\tFalse for str/numeric; others nullable by default\tFalse ref\tTrue (except str and numeric types)\tFalse dynamic\tTrue (except numeric/str/time types)\tFalse (concrete)  ","version":"dev","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/python/field_configuration#best-practices","content":" Configure field IDs: Recommended for compatible mode to reduce serialization costUse Optional[T] with nullable=True: Required for nullable fields in xlang modeEnable ref tracking for shared objects: Use ref=True when objects are shared or circularUse ignore=True for sensitive data: Passwords, tokens, internal stateChoose appropriate encoding: varint for small values, fixed for full-range valuesKeep IDs stable: Once assigned, don't change field IDs  ","version":"dev","tagName":"h2"},{"title":"Options Reference‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/python/field_configuration#options-reference","content":" Configuration\tDescriptionpyfory.field(id=N)\tField tag ID to reduce metadata size pyfory.field(nullable=True)\tMark field as nullable pyfory.field(ref=True)\tEnable reference tracking pyfory.field(ignore=True)\tExclude field from serialization pyfory.field(dynamic=True)\tForce type info to be written pyfory.field(dynamic=False)\tSkip type info (use declared type) Optional[T]\tType hint for nullable fields pyfory.int32, pyfory.int64\tSigned integers (varint encoding) pyfory.uint32, pyfory.uint64\tUnsigned integers (varint encoding) pyfory.fixed_uint32, pyfory.fixed_uint64\tFixed-size unsigned pyfory.tagged_uint64\tTagged encoding for uint64  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/python/field_configuration#related-topics","content":" Basic Serialization - Getting started with Fory serializationSchema Evolution - Compatible mode and schema evolutionCross-Language - Interoperability with Java, Rust, C++, Go ","version":"dev","tagName":"h2"},{"title":"Security Best Practices","type":0,"sectionRef":"#","url":"/docs/next/guide/python/security","content":"","keywords":"","version":"dev"},{"title":"Production Configuration‚Äã","type":1,"pageTitle":"Security Best Practices","url":"/docs/next/guide/python/security#production-configuration","content":" Never disable strict=True in production unless your environment is completely trusted:  import pyfory # Recommended production settings f = pyfory.Fory( xlang=False, # or True for cross-language ref=True, # Handle circular references strict=True, # IMPORTANT: Prevent malicious data max_depth=100 # Prevent deep recursion attacks ) # Explicitly register allowed types f.register(UserModel, type_id=100) f.register(OrderModel, type_id=101) # Never set strict=False in production with untrusted data!   ","version":"dev","tagName":"h2"},{"title":"Development vs Production‚Äã","type":1,"pageTitle":"Security Best Practices","url":"/docs/next/guide/python/security#development-vs-production","content":" Use environment variables to switch between configurations:  import pyfory import os # Development configuration if os.getenv('ENV') == 'development': fory = pyfory.Fory( xlang=False, ref=True, strict=False, # Allow any type for development max_depth=1000 # Higher limit for development ) else: # Production configuration (security hardened) fory = pyfory.Fory( xlang=False, ref=True, strict=True, # CRITICAL: Require registration max_depth=100 # Reasonable limit ) # Register only known safe types for idx, model_class in enumerate([UserModel, ProductModel, OrderModel]): fory.register(model_class, type_id=100 + idx)   ","version":"dev","tagName":"h2"},{"title":"DeserializationPolicy‚Äã","type":1,"pageTitle":"Security Best Practices","url":"/docs/next/guide/python/security#deserializationpolicy","content":" When strict=False is necessary (e.g., deserializing functions/lambdas), use DeserializationPolicy to implement fine-grained security controls during deserialization.  Why use DeserializationPolicy?  Block dangerous classes/modules (e.g., subprocess.Popen)Intercept and validate __reduce__ callables before invocationSanitize sensitive data during __setstate__Replace or reject deserialized objects based on custom rules  ","version":"dev","tagName":"h2"},{"title":"Blocking Dangerous Classes‚Äã","type":1,"pageTitle":"Security Best Practices","url":"/docs/next/guide/python/security#blocking-dangerous-classes","content":" import pyfory from pyfory import DeserializationPolicy dangerous_modules = {'subprocess', 'os', '__builtin__'} class SafeDeserializationPolicy(DeserializationPolicy): &quot;&quot;&quot;Block potentially dangerous classes during deserialization.&quot;&quot;&quot; def validate_class(self, cls, is_local, **kwargs): # Block dangerous modules if cls.__module__ in dangerous_modules: raise ValueError(f&quot;Blocked dangerous class: {cls.__module__}.{cls.__name__}&quot;) return None def intercept_reduce_call(self, callable_obj, args, **kwargs): # Block specific callable invocations during __reduce__ if getattr(callable_obj, '__name__', &quot;&quot;) == 'Popen': raise ValueError(&quot;Blocked attempt to invoke subprocess.Popen&quot;) return None def intercept_setstate(self, obj, state, **kwargs): # Sanitize sensitive data if isinstance(state, dict) and 'password' in state: state['password'] = '***REDACTED***' return None # Create Fory with custom security policy policy = SafeDeserializationPolicy() fory = pyfory.Fory(xlang=False, ref=True, strict=False, policy=policy) # Now deserialization is protected by your custom policy data = fory.serialize(my_object) result = fory.deserialize(data) # Policy hooks will be invoked   ","version":"dev","tagName":"h3"},{"title":"Available Policy Hooks‚Äã","type":1,"pageTitle":"Security Best Practices","url":"/docs/next/guide/python/security#available-policy-hooks","content":" Hook\tDescriptionvalidate_class(cls, is_local)\tValidate/block class types during deserialization validate_module(module, is_local)\tValidate/block module imports validate_function(func, is_local)\tValidate/block function references intercept_reduce_call(callable_obj, args)\tIntercept __reduce__ invocations inspect_reduced_object(obj)\tInspect/replace objects created via __reduce__ intercept_setstate(obj, state)\tSanitize state before __setstate__ authorize_instantiation(cls, args, kwargs)\tControl class instantiation  See also: pyfory/policy.py contains detailed documentation and examples for each hook.  ","version":"dev","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Security Best Practices","url":"/docs/next/guide/python/security#best-practices","content":" Always use strict=True in productionUse DeserializationPolicy when strict=False is necessaryBlock dangerous modules (subprocess, os, etc.)Set appropriate max_depth to prevent stack overflowValidate data sources before deserializationLog security events for auditing  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Security Best Practices","url":"/docs/next/guide/python/security#related-topics","content":" Type Registration - Registration and strict modeConfiguration - Fory parametersPython Native Mode - Functions and lambdas ","version":"dev","tagName":"h2"},{"title":"Type Registration & Security","type":0,"sectionRef":"#","url":"/docs/next/guide/python/type_registration","content":"","keywords":"","version":"dev"},{"title":"Type Registration‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/next/guide/python/type_registration#type-registration","content":" In strict mode, only registered types can be deserialized. This prevents arbitrary code execution:  import pyfory # Strict mode (recommended for production) f = pyfory.Fory(strict=True) class SafeClass: def __init__(self, data): self.data = data # Must register types in strict mode f.register(SafeClass, typename=&quot;com.example.SafeClass&quot;) # Now serialization works obj = SafeClass(&quot;safe data&quot;) data = f.serialize(obj) result = f.deserialize(data) # Unregistered types will raise an exception class UnsafeClass: pass # This will fail in strict mode try: f.serialize(UnsafeClass()) except Exception as e: print(&quot;Security protection activated!&quot;)   ","version":"dev","tagName":"h2"},{"title":"Registration Patterns‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/next/guide/python/type_registration#registration-patterns","content":" ","version":"dev","tagName":"h2"},{"title":"Pattern 1: Simple Registration‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/next/guide/python/type_registration#pattern-1-simple-registration","content":" fory.register(MyClass, type_id=100)   ","version":"dev","tagName":"h3"},{"title":"Pattern 2: Cross-Language with Typename‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/next/guide/python/type_registration#pattern-2-cross-language-with-typename","content":" fory.register(MyClass, typename=&quot;com.example.MyClass&quot;)   ","version":"dev","tagName":"h3"},{"title":"Pattern 3: With Custom Serializer‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/next/guide/python/type_registration#pattern-3-with-custom-serializer","content":" fory.register(MyClass, type_id=100, serializer=MySerializer(fory, MyClass))   ","version":"dev","tagName":"h3"},{"title":"Pattern 4: Batch Registration‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/next/guide/python/type_registration#pattern-4-batch-registration","content":" type_id = 100 for model_class in [User, Order, Product, Invoice]: fory.register(model_class, type_id=type_id) type_id += 1   ","version":"dev","tagName":"h3"},{"title":"Security Modes‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/next/guide/python/type_registration#security-modes","content":" ","version":"dev","tagName":"h2"},{"title":"Strict Mode (Recommended)‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/next/guide/python/type_registration#strict-mode-recommended","content":" # Always use strict=True in production fory = pyfory.Fory(strict=True) # Explicitly register allowed types fory.register(UserModel, type_id=100) fory.register(OrderModel, type_id=101)   ","version":"dev","tagName":"h3"},{"title":"Non-Strict Mode‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/next/guide/python/type_registration#non-strict-mode","content":" ‚ö†Ô∏è Security Warning: When strict=False, Fory will deserialize arbitrary types, which can pose security risks if data comes from untrusted sources. Only use strict=False in controlled environments where you trust the data source completely.  # Only in trusted environments fory = pyfory.Fory(xlang=False, ref=True, strict=False)   If you do need to use strict=False, configure a DeserializationPolicy:  from pyfory import DeserializationPolicy class SafePolicy(DeserializationPolicy): def validate_class(self, cls, is_local, **kwargs): # Block dangerous modules if cls.__module__ in {'subprocess', 'os', '__builtin__'}: raise ValueError(f&quot;Blocked: {cls}&quot;) return None fory = pyfory.Fory(xlang=False, strict=False, policy=SafePolicy())   ","version":"dev","tagName":"h3"},{"title":"Max Depth Protection‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/next/guide/python/type_registration#max-depth-protection","content":" Limit deserialization depth to prevent stack overflow attacks:  fory = pyfory.Fory( strict=True, max_depth=100 # Adjust based on your data structure depth )   ","version":"dev","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/next/guide/python/type_registration#best-practices","content":" Always use strict=True in productionUse type_id for performance, typename for flexibilityRegister all types upfront before any serializationSet appropriate max_depth based on your data structuresUse DeserializationPolicy when strict=False is necessary  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/next/guide/python/type_registration#related-topics","content":" Configuration - Fory parametersSecurity - DeserializationPolicy detailsCustom Serializers - Custom serialization ","version":"dev","tagName":"h2"},{"title":"Troubleshooting","type":0,"sectionRef":"#","url":"/docs/next/guide/python/troubleshooting","content":"","keywords":"","version":"dev"},{"title":"Common Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/python/troubleshooting#common-issues","content":" ","version":"dev","tagName":"h2"},{"title":"ImportError with Format Features‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/python/troubleshooting#importerror-with-format-features","content":" # Solution: Install Row format support pip install pyfory[format] # Or install from source with format support pip install -e &quot;.[format]&quot;   ","version":"dev","tagName":"h3"},{"title":"Slow Serialization Performance‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/python/troubleshooting#slow-serialization-performance","content":" # Check if Cython acceleration is enabled import pyfory print(pyfory.ENABLE_FORY_CYTHON_SERIALIZATION) # Should be True # If False, Cython extension may not be compiled correctly # Reinstall with: pip install --force-reinstall --no-cache-dir pyfory   ","version":"dev","tagName":"h3"},{"title":"Cross-Language Compatibility Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/python/troubleshooting#cross-language-compatibility-issues","content":" # Use explicit type registration with consistent naming f = pyfory.Fory(xlang=True) f.register(MyClass, typename=&quot;com.package.MyClass&quot;) # Use same name in all languages   ","version":"dev","tagName":"h3"},{"title":"Circular Reference Errors or Duplicate Data‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/python/troubleshooting#circular-reference-errors-or-duplicate-data","content":" # Enable reference tracking f = pyfory.Fory(ref=True) # Required for circular references # Example with circular reference class Node: def __init__(self, value): self.value = value self.next = None node1 = Node(1) node2 = Node(2) node1.next = node2 node2.next = node1 # Circular reference data = f.dumps(node1) result = f.loads(data) assert result.next.next is result # Circular reference preserved   ","version":"dev","tagName":"h3"},{"title":"Schema Evolution Not Working‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/python/troubleshooting#schema-evolution-not-working","content":" # Enable compatible mode for schema evolution f = pyfory.Fory(xlang=True, compatible=True) # Version 1: Original class @dataclass class User: name: str age: int f.register(User, typename=&quot;User&quot;) data = f.dumps(User(&quot;Alice&quot;, 30)) # Version 2: Add new field (backward compatible) @dataclass class User: name: str age: int email: str = &quot;unknown@example.com&quot; # New field with default # Can still deserialize old data user = f.loads(data) print(user.email) # &quot;unknown@example.com&quot;   ","version":"dev","tagName":"h3"},{"title":"Type Registration Errors in Strict Mode‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/python/troubleshooting#type-registration-errors-in-strict-mode","content":" # Register all custom types before serialization f = pyfory.Fory(strict=True) # Must register before use f.register(MyClass, type_id=100) f.register(AnotherClass, type_id=101) # Or disable strict mode (NOT recommended for production) f = pyfory.Fory(strict=False) # Use only in trusted environments   ","version":"dev","tagName":"h3"},{"title":"Debug Mode‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/python/troubleshooting#debug-mode","content":" Set environment variable BEFORE importing pyfory to disable Cython for debugging:  import os os.environ['ENABLE_FORY_CYTHON_SERIALIZATION'] = '0' import pyfory # Now uses pure Python implementation # This is useful for: # 1. Debugging protocol issues # 2. Understanding serialization behavior # 3. Development without recompiling Cython   ","version":"dev","tagName":"h2"},{"title":"Error Handling‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/python/troubleshooting#error-handling","content":" Handle common serialization errors gracefully:  import pyfory from pyfory.error import TypeUnregisteredError, TypeNotCompatibleError fory = pyfory.Fory(strict=True) try: data = fory.dumps(my_object) except TypeUnregisteredError as e: print(f&quot;Type not registered: {e}&quot;) # Register the type and retry fory.register(type(my_object), type_id=100) data = fory.dumps(my_object) except Exception as e: print(f&quot;Serialization failed: {e}&quot;) try: obj = fory.loads(data) except TypeNotCompatibleError as e: print(f&quot;Schema mismatch: {e}&quot;) # Handle version mismatch except Exception as e: print(f&quot;Deserialization failed: {e}&quot;)   ","version":"dev","tagName":"h2"},{"title":"Development Setup‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/python/troubleshooting#development-setup","content":" git clone https://github.com/apache/fory.git cd fory/python # Install dependencies pip install -e &quot;.[dev,format]&quot; # Run tests pytest -v -s . # Run specific test pytest -v -s pyfory/tests/test_serializer.py # Format code ruff format . ruff check --fix .   ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/python/troubleshooting#related-topics","content":" Configuration - Fory parametersType Registration - Registration best practicesSecurity - Security configuration ","version":"dev","tagName":"h2"},{"title":"Rust Serialization Guide","type":0,"sectionRef":"#","url":"/docs/next/guide/rust/","content":"","keywords":"","version":"dev"},{"title":"Why Apache Fory‚Ñ¢ Rust?‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/next/guide/rust/#why-apache-fory-rust","content":" üî• Blazingly Fast: Zero-copy deserialization and optimized binary protocolsüåç Cross-Language: Seamlessly serialize/deserialize data across Java, Python, C++, Go, JavaScript, and RustüéØ Type-Safe: Compile-time type checking with derive macrosüîÑ Circular References: Automatic tracking of shared and circular references with Rc/Arc and weak pointersüß¨ Polymorphic: Serialize trait objects with Box&lt;dyn Trait&gt;, Rc&lt;dyn Trait&gt;, and Arc&lt;dyn Trait&gt;üì¶ Schema Evolution: Compatible mode for independent schema changes‚ö° Two Formats: Object graph serialization and zero-copy row-based format  ","version":"dev","tagName":"h2"},{"title":"Crates‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/next/guide/rust/#crates","content":" Crate\tDescription\tVersionfory\tHigh-level API with derive macros fory-core\tCore serialization engine fory-derive\tProcedural macros\t  ","version":"dev","tagName":"h2"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/next/guide/rust/#quick-start","content":" Add Apache Fory‚Ñ¢ to your Cargo.toml:  [dependencies] fory = &quot;0.13&quot;   ","version":"dev","tagName":"h2"},{"title":"Basic Example‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/next/guide/rust/#basic-example","content":" use fory::{Fory, Error, Reader}; use fory::ForyObject; #[derive(ForyObject, Debug, PartialEq)] struct User { name: String, age: i32, email: String, } fn main() -&gt; Result&lt;(), Error&gt; { let mut fory = Fory::default(); fory.register::&lt;User&gt;(1)?; let user = User { name: &quot;Alice&quot;.to_string(), age: 30, email: &quot;alice@example.com&quot;.to_string(), }; // Serialize let bytes = fory.serialize(&amp;user)?; // Deserialize let decoded: User = fory.deserialize(&amp;bytes)?; assert_eq!(user, decoded); // Serialize to specified buffer let mut buf: Vec&lt;u8&gt; = vec![]; fory.serialize_to(&amp;mut buf, &amp;user)?; // Deserialize from specified buffer let mut reader = Reader::new(&amp;buf); let decoded: User = fory.deserialize_from(&amp;mut reader)?; assert_eq!(user, decoded); Ok(()) }   ","version":"dev","tagName":"h3"},{"title":"Thread Safety‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/next/guide/rust/#thread-safety","content":" Apache Fory‚Ñ¢ Rust is fully thread-safe: Fory implements both Send and Sync, so one configured instance can be shared across threads for concurrent work. The internal read/write context pools are lazily initialized with thread-safe primitives, letting worker threads reuse buffers without coordination.  use fory::{Fory, Error}; use fory::ForyObject; use std::sync::Arc; use std::thread; #[derive(ForyObject, Clone, Copy, Debug, PartialEq)] struct Item { value: i32, } fn main() -&gt; Result&lt;(), Error&gt; { let mut fory = Fory::default(); fory.register::&lt;Item&gt;(1000)?; let fory = Arc::new(fory); let handles: Vec&lt;_&gt; = (0..8) .map(|i| { let shared = Arc::clone(&amp;fory); thread::spawn(move || { let item = Item { value: i }; shared.serialize(&amp;item) }) }) .collect(); for handle in handles { let bytes = handle.join().unwrap()?; let item: Item = fory.deserialize(&amp;bytes)?; assert!(item.value &gt;= 0); } Ok(()) }   Tip: Perform registrations (such as fory.register::&lt;T&gt;(id)) before spawning threads so every worker sees the same metadata. Once configured, wrapping the instance in Arc is enough to fan out serialization and deserialization tasks safely.  ","version":"dev","tagName":"h2"},{"title":"Architecture‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/next/guide/rust/#architecture","content":" The Rust implementation consists of three main crates:  fory/ # High-level API ‚îú‚îÄ‚îÄ src/lib.rs # Public API exports fory-core/ # Core serialization engine ‚îú‚îÄ‚îÄ src/ ‚îÇ ‚îú‚îÄ‚îÄ fory.rs # Main serialization entry point ‚îÇ ‚îú‚îÄ‚îÄ buffer.rs # Binary buffer management ‚îÇ ‚îú‚îÄ‚îÄ serializer/ # Type-specific serializers ‚îÇ ‚îú‚îÄ‚îÄ resolver/ # Type resolution and metadata ‚îÇ ‚îú‚îÄ‚îÄ meta/ # Meta string compression ‚îÇ ‚îú‚îÄ‚îÄ row/ # Row format implementation ‚îÇ ‚îî‚îÄ‚îÄ types.rs # Type definitions fory-derive/ # Procedural macros ‚îú‚îÄ‚îÄ src/ ‚îÇ ‚îú‚îÄ‚îÄ object/ # ForyObject macro ‚îÇ ‚îî‚îÄ‚îÄ fory_row.rs # ForyRow macro   ","version":"dev","tagName":"h2"},{"title":"Use Cases‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/next/guide/rust/#use-cases","content":" ","version":"dev","tagName":"h2"},{"title":"Object Serialization‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/next/guide/rust/#object-serialization","content":" Complex data structures with nested objects and referencesCross-language communication in microservicesGeneral-purpose serialization with full type safetySchema evolution with compatible modeGraph-like data structures with circular references  ","version":"dev","tagName":"h3"},{"title":"Row-Based Serialization‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/next/guide/rust/#row-based-serialization","content":" High-throughput data processingAnalytics workloads requiring fast field accessMemory-constrained environmentsReal-time data streaming applicationsZero-copy scenarios  ","version":"dev","tagName":"h3"},{"title":"Next Steps‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/next/guide/rust/#next-steps","content":" Configuration - Fory builder options and modesBasic Serialization - Object graph serializationReferences - Shared and circular referencesPolymorphism - Trait object serializationCross-Language - XLANG modeRow Format - Zero-copy row-based format ","version":"dev","tagName":"h2"},{"title":"Configuration","type":0,"sectionRef":"#","url":"/docs/next/guide/rust/configuration","content":"","keywords":"","version":"dev"},{"title":"Serialization Modes‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/rust/configuration#serialization-modes","content":" Apache Fory‚Ñ¢ supports two serialization modes:  ","version":"dev","tagName":"h2"},{"title":"SchemaConsistent Mode (Default)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/rust/configuration#schemaconsistent-mode-default","content":" Type declarations must match exactly between peers:  let fory = Fory::default(); // SchemaConsistent by default   ","version":"dev","tagName":"h3"},{"title":"Compatible Mode‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/rust/configuration#compatible-mode","content":" Allows independent schema evolution:  let fory = Fory::default().compatible(true);   ","version":"dev","tagName":"h3"},{"title":"Configuration Options‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/rust/configuration#configuration-options","content":" ","version":"dev","tagName":"h2"},{"title":"Maximum Dynamic Object Nesting Depth‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/rust/configuration#maximum-dynamic-object-nesting-depth","content":" Apache Fory‚Ñ¢ provides protection against stack overflow from deeply nested dynamic objects during deserialization. By default, the maximum nesting depth is set to 5 levels for trait objects and containers.  Default configuration:  let fory = Fory::default(); // max_dyn_depth = 5   Custom depth limit:  let fory = Fory::default().max_dyn_depth(10); // Allow up to 10 levels   When to adjust:  Increase: For legitimate deeply nested data structuresDecrease: For stricter security requirements or shallow data structures  Protected types:  Box&lt;dyn Any&gt;, Rc&lt;dyn Any&gt;, Arc&lt;dyn Any&gt;Box&lt;dyn Trait&gt;, Rc&lt;dyn Trait&gt;, Arc&lt;dyn Trait&gt; (trait objects)RcWeak&lt;T&gt;, ArcWeak&lt;T&gt;Collection types (Vec, HashMap, HashSet)Nested struct types in Compatible mode  Note: Static data types (non-dynamic types) are secure by nature and not subject to depth limits, as their structure is known at compile time.  ","version":"dev","tagName":"h3"},{"title":"Cross-Language Mode‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/rust/configuration#cross-language-mode","content":" Enable cross-language serialization:  let fory = Fory::default() .compatible(true) .xlang(true);   ","version":"dev","tagName":"h3"},{"title":"Builder Pattern‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/rust/configuration#builder-pattern","content":" use fory::Fory; // Default configuration let fory = Fory::default(); // Compatible mode for schema evolution let fory = Fory::default().compatible(true); // Cross-language mode let fory = Fory::default() .compatible(true) .xlang(true); // Custom depth limit let fory = Fory::default().max_dyn_depth(10); // Combined configuration let fory = Fory::default() .compatible(true) .xlang(true) .max_dyn_depth(10);   ","version":"dev","tagName":"h2"},{"title":"Configuration Summary‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/rust/configuration#configuration-summary","content":" Option\tDescription\tDefaultcompatible(bool)\tEnable schema evolution\tfalse xlang(bool)\tEnable cross-language mode\tfalse max_dyn_depth(u32)\tMaximum nesting depth for dynamic types\t5  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/rust/configuration#related-topics","content":" Basic Serialization - Using configured ForySchema Evolution - Compatible mode detailsCross-Language - XLANG mode ","version":"dev","tagName":"h2"},{"title":"Basic Serialization","type":0,"sectionRef":"#","url":"/docs/next/guide/rust/basic_serialization","content":"","keywords":"","version":"dev"},{"title":"Object Graph Serialization‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/rust/basic_serialization#object-graph-serialization","content":" Apache Fory‚Ñ¢ provides automatic serialization of complex object graphs, preserving the structure and relationships between objects. The #[derive(ForyObject)] macro generates efficient serialization code at compile time, eliminating runtime overhead.  Key capabilities:  Nested struct serialization with arbitrary depthCollection types (Vec, HashMap, HashSet, BTreeMap)Optional fields with Option&lt;T&gt;Automatic handling of primitive types and stringsEfficient binary encoding with variable-length integers  use fory::{Fory, Error}; use fory::ForyObject; use std::collections::HashMap; #[derive(ForyObject, Debug, PartialEq)] struct Person { name: String, age: i32, address: Address, hobbies: Vec&lt;String&gt;, metadata: HashMap&lt;String, String&gt;, } #[derive(ForyObject, Debug, PartialEq)] struct Address { street: String, city: String, country: String, } let mut fory = Fory::default(); fory.register::&lt;Address&gt;(100); fory.register::&lt;Person&gt;(200); let person = Person { name: &quot;John Doe&quot;.to_string(), age: 30, address: Address { street: &quot;123 Main St&quot;.to_string(), city: &quot;New York&quot;.to_string(), country: &quot;USA&quot;.to_string(), }, hobbies: vec![&quot;reading&quot;.to_string(), &quot;coding&quot;.to_string()], metadata: HashMap::from([ (&quot;role&quot;.to_string(), &quot;developer&quot;.to_string()), ]), }; let bytes = fory.serialize(&amp;person); let decoded: Person = fory.deserialize(&amp;bytes)?; assert_eq!(person, decoded);   ","version":"dev","tagName":"h2"},{"title":"Supported Types‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/rust/basic_serialization#supported-types","content":" ","version":"dev","tagName":"h2"},{"title":"Primitive Types‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/rust/basic_serialization#primitive-types","content":" Rust Type\tDescriptionbool\tBoolean i8, i16, i32, i64\tSigned integers f32, f64\tFloating point String\tUTF-8 string  ","version":"dev","tagName":"h3"},{"title":"Collections‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/rust/basic_serialization#collections","content":" Rust Type\tDescriptionVec&lt;T&gt;\tDynamic array VecDeque&lt;T&gt;\tDouble-ended queue LinkedList&lt;T&gt;\tDoubly-linked list HashMap&lt;K, V&gt;\tHash map BTreeMap&lt;K, V&gt;\tOrdered map HashSet&lt;T&gt;\tHash set BTreeSet&lt;T&gt;\tOrdered set BinaryHeap&lt;T&gt;\tBinary heap Option&lt;T&gt;\tOptional value  ","version":"dev","tagName":"h3"},{"title":"Smart Pointers‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/rust/basic_serialization#smart-pointers","content":" Rust Type\tDescriptionBox&lt;T&gt;\tHeap allocation Rc&lt;T&gt;\tReference counting (shared refs tracked) Arc&lt;T&gt;\tThread-safe reference counting (shared refs tracked) RcWeak&lt;T&gt;\tWeak reference to Rc&lt;T&gt; (breaks circular refs) ArcWeak&lt;T&gt;\tWeak reference to Arc&lt;T&gt; (breaks circular refs) RefCell&lt;T&gt;\tInterior mutability (runtime borrow checking) Mutex&lt;T&gt;\tThread-safe interior mutability  ","version":"dev","tagName":"h3"},{"title":"Date and Time‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/rust/basic_serialization#date-and-time","content":" Rust Type\tDescriptionchrono::NaiveDate\tDate without timezone chrono::NaiveDateTime\tTimestamp without timezone  ","version":"dev","tagName":"h3"},{"title":"Custom Types‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/rust/basic_serialization#custom-types","content":" Macro\tDescription#[derive(ForyObject)]\tObject graph serialization #[derive(ForyRow)]\tRow-based serialization  ","version":"dev","tagName":"h3"},{"title":"Serialization APIs‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/rust/basic_serialization#serialization-apis","content":" use fory::{Fory, Reader}; let mut fory = Fory::default(); fory.register::&lt;MyStruct&gt;(1)?; let obj = MyStruct { /* ... */ }; // Basic serialize/deserialize let bytes = fory.serialize(&amp;obj)?; let decoded: MyStruct = fory.deserialize(&amp;bytes)?; // Serialize to existing buffer let mut buf: Vec&lt;u8&gt; = vec![]; fory.serialize_to(&amp;mut buf, &amp;obj)?; // Deserialize from reader let mut reader = Reader::new(&amp;buf); let decoded: MyStruct = fory.deserialize_from(&amp;mut reader)?;   ","version":"dev","tagName":"h2"},{"title":"Performance Tips‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/rust/basic_serialization#performance-tips","content":" Zero-Copy Deserialization: Row format enables direct memory access without copyingBuffer Pre-allocation: Minimizes memory allocations during serializationCompact Encoding: Variable-length encoding for space efficiencyLittle-Endian: Optimized for modern CPU architecturesReference Deduplication: Shared objects serialized only once  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/rust/basic_serialization#related-topics","content":" Type Registration - Registering typesReferences - Shared and circular referencesCustom Serializers - Manual serialization ","version":"dev","tagName":"h2"},{"title":"Cross-Language Serialization","type":0,"sectionRef":"#","url":"/docs/next/guide/rust/cross_language","content":"","keywords":"","version":"dev"},{"title":"Enable Cross-Language Mode‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/rust/cross_language#enable-cross-language-mode","content":" use fory::Fory; // Enable cross-language mode let mut fory = Fory::default() .compatible(true) .xlang(true); // Register types with consistent IDs across languages fory.register::&lt;MyStruct&gt;(100); // Or use namespace-based registration fory.register_by_namespace::&lt;MyStruct&gt;(&quot;com.example&quot;, &quot;MyStruct&quot;);   ","version":"dev","tagName":"h2"},{"title":"Type Registration for Cross-Language‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/rust/cross_language#type-registration-for-cross-language","content":" ","version":"dev","tagName":"h2"},{"title":"Register by ID‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/rust/cross_language#register-by-id","content":" For fast, compact serialization with consistent IDs across languages:  let mut fory = Fory::default() .compatible(true) .xlang(true); fory.register::&lt;User&gt;(100); // Same ID in Java, Python, etc.   ","version":"dev","tagName":"h3"},{"title":"Register by Namespace‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/rust/cross_language#register-by-namespace","content":" For more flexible type naming:  fory.register_by_namespace::&lt;User&gt;(&quot;com.example&quot;, &quot;User&quot;);   ","version":"dev","tagName":"h3"},{"title":"Cross-Language Example‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/rust/cross_language#cross-language-example","content":" ","version":"dev","tagName":"h2"},{"title":"Rust (Serializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/rust/cross_language#rust-serializer","content":" use fory::Fory; use fory::ForyObject; #[derive(ForyObject)] struct Person { name: String, age: i32, } let mut fory = Fory::default() .compatible(true) .xlang(true); fory.register::&lt;Person&gt;(100); let person = Person { name: &quot;Alice&quot;.to_string(), age: 30, }; let bytes = fory.serialize(&amp;person)?; // bytes can be deserialized by Java, Python, etc.   ","version":"dev","tagName":"h3"},{"title":"Java (Deserializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/rust/cross_language#java-deserializer","content":" import org.apache.fory.*; import org.apache.fory.config.*; public class Person { public String name; public int age; } Fory fory = Fory.builder() .withLanguage(Language.XLANG) .withRefTracking(true) .build(); fory.register(Person.class, 100); // Same ID as Rust Person person = (Person) fory.deserialize(bytesFromRust);   ","version":"dev","tagName":"h3"},{"title":"Python (Deserializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/rust/cross_language#python-deserializer","content":" import pyfory from dataclasses import dataclass @dataclass class Person: name: str age: pyfory.int32 fory = pyfory.Fory(xlang=True, ref=True) fory.register_type(Person, type_id=100) # Same ID as Rust person = fory.deserialize(bytes_from_rust)   ","version":"dev","tagName":"h3"},{"title":"Type Mapping‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/rust/cross_language#type-mapping","content":" See xlang_type_mapping.md for complete type mapping across languages.  ","version":"dev","tagName":"h2"},{"title":"Common Type Mappings‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/rust/cross_language#common-type-mappings","content":" Rust\tJava\tPythoni32\tint\tint32 i64\tlong\tint64 f32\tfloat\tfloat32 f64\tdouble\tfloat64 String\tString\tstr Vec&lt;T&gt;\tList&lt;T&gt;\tList[T] HashMap&lt;K,V&gt;\tMap&lt;K,V&gt;\tDict[K,V] Option&lt;T&gt;\tnullable T\tOptional[T]  ","version":"dev","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/rust/cross_language#best-practices","content":" Use consistent type IDs across all languagesEnable compatible mode for schema evolutionRegister all types before serializationTest cross-language compatibility during development  ","version":"dev","tagName":"h2"},{"title":"See Also‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/rust/cross_language#see-also","content":" Cross-Language Serialization SpecificationType Mapping ReferenceJava Cross-Language GuidePython Cross-Language Guide  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/rust/cross_language#related-topics","content":" Configuration - XLANG mode configurationSchema Evolution - Compatible modeType Registration - Registration methods ","version":"dev","tagName":"h2"},{"title":"Custom Serializers","type":0,"sectionRef":"#","url":"/docs/next/guide/rust/custom_serializers","content":"","keywords":"","version":"dev"},{"title":"When to Use Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/rust/custom_serializers#when-to-use-custom-serializers","content":" External types from other cratesTypes with special serialization requirementsLegacy data format compatibilityPerformance-critical custom encoding  ","version":"dev","tagName":"h2"},{"title":"Implementing the Serializer Trait‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/rust/custom_serializers#implementing-the-serializer-trait","content":" use fory::{Fory, ReadContext, WriteContext, Serializer, ForyDefault, Error}; use std::any::Any; #[derive(Debug, PartialEq, Default)] struct CustomType { value: i32, name: String, } impl Serializer for CustomType { fn fory_write_data(&amp;self, context: &amp;mut WriteContext, is_field: bool) { context.writer.write_i32(self.value); context.writer.write_varuint32(self.name.len() as u32); context.writer.write_utf8_string(&amp;self.name); } fn fory_read_data(context: &amp;mut ReadContext, is_field: bool) -&gt; Result&lt;Self, Error&gt; { let value = context.reader.read_i32(); let len = context.reader.read_varuint32() as usize; let name = context.reader.read_utf8_string(len); Ok(Self { value, name }) } fn fory_type_id_dyn(&amp;self, type_resolver: &amp;TypeResolver) -&gt; u32 { Self::fory_get_type_id(type_resolver) } fn as_any(&amp;self) -&gt; &amp;dyn Any { self } } // ForyDefault delegates to Default impl ForyDefault for CustomType { fn fory_default() -&gt; Self { Self::default() } }   Note: When implementing ForyDefault manually, ensure your type also implements Default if you use Self::default(). Alternatively, you can construct a default instance directly in fory_default(). Tip: If your type supports #[derive(ForyObject)], you can use #[fory(generate_default)] to automatically generate both ForyDefault and Default implementations.  ","version":"dev","tagName":"h2"},{"title":"Registering Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/rust/custom_serializers#registering-custom-serializers","content":" let mut fory = Fory::default(); fory.register_serializer::&lt;CustomType&gt;(100); let custom = CustomType { value: 42, name: &quot;test&quot;.to_string(), }; let bytes = fory.serialize(&amp;custom); let decoded: CustomType = fory.deserialize(&amp;bytes)?; assert_eq!(custom, decoded);   ","version":"dev","tagName":"h2"},{"title":"WriteContext and ReadContext‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/rust/custom_serializers#writecontext-and-readcontext","content":" The WriteContext and ReadContext provide access to:  writer/reader: Binary buffer operationstype_resolver: Type registration informationref_resolver: Reference tracking (for shared/circular references)  ","version":"dev","tagName":"h2"},{"title":"Common Writer Methods‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/rust/custom_serializers#common-writer-methods","content":" // Primitive types context.writer.write_i8(value); context.writer.write_i16(value); context.writer.write_i32(value); context.writer.write_i64(value); context.writer.write_f32(value); context.writer.write_f64(value); context.writer.write_bool(value); // Variable-length integers context.writer.write_varint32(value); context.writer.write_varuint32(value); // Strings context.writer.write_utf8_string(&amp;string);   ","version":"dev","tagName":"h3"},{"title":"Common Reader Methods‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/rust/custom_serializers#common-reader-methods","content":" // Primitive types let value = context.reader.read_i8(); let value = context.reader.read_i16(); let value = context.reader.read_i32(); let value = context.reader.read_i64(); let value = context.reader.read_f32(); let value = context.reader.read_f64(); let value = context.reader.read_bool(); // Variable-length integers let value = context.reader.read_varint32(); let value = context.reader.read_varuint32(); // Strings let string = context.reader.read_utf8_string(len);   ","version":"dev","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/rust/custom_serializers#best-practices","content":" Use variable-length encoding for integers that may be smallWrite length first for variable-length dataHandle errors properly in read methodsImplement ForyDefault for schema evolution support  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/rust/custom_serializers#related-topics","content":" Type Registration - Registering serializersBasic Serialization - Using ForyObject deriveSchema Evolution - Compatible mode ","version":"dev","tagName":"h2"},{"title":"Row Format","type":0,"sectionRef":"#","url":"/docs/next/guide/rust/row_format","content":"","keywords":"","version":"dev"},{"title":"Overview‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/rust/row_format#overview","content":" Unlike traditional object serialization that reconstructs entire objects in memory, row format enables random access to fields directly from binary data without full deserialization.  Key benefits:  Zero-copy access: Read fields without allocating or copying dataPartial deserialization: Access only the fields you needMemory-mapped files: Work with data larger than RAMCache-friendly: Sequential memory layout for better CPU cache utilizationLazy evaluation: Defer expensive operations until field access  ","version":"dev","tagName":"h2"},{"title":"When to Use Row Format‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/rust/row_format#when-to-use-row-format","content":" Analytics workloads with selective field accessLarge datasets where only a subset of fields is neededMemory-constrained environmentsHigh-throughput data pipelinesReading from memory-mapped files or shared memory  ","version":"dev","tagName":"h2"},{"title":"Basic Usage‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/rust/row_format#basic-usage","content":" use fory::{to_row, from_row}; use fory::ForyRow; use std::collections::BTreeMap; #[derive(ForyRow)] struct UserProfile { id: i64, username: String, email: String, scores: Vec&lt;i32&gt;, preferences: BTreeMap&lt;String, String&gt;, is_active: bool, } let profile = UserProfile { id: 12345, username: &quot;alice&quot;.to_string(), email: &quot;alice@example.com&quot;.to_string(), scores: vec![95, 87, 92, 88], preferences: BTreeMap::from([ (&quot;theme&quot;.to_string(), &quot;dark&quot;.to_string()), (&quot;language&quot;.to_string(), &quot;en&quot;.to_string()), ]), is_active: true, }; // Serialize to row format let row_data = to_row(&amp;profile); // Zero-copy deserialization - no object allocation! let row = from_row::&lt;UserProfile&gt;(&amp;row_data); // Access fields directly from binary data assert_eq!(row.id(), 12345); assert_eq!(row.username(), &quot;alice&quot;); assert_eq!(row.email(), &quot;alice@example.com&quot;); assert_eq!(row.is_active(), true); // Access collections efficiently let scores = row.scores(); assert_eq!(scores.size(), 4); assert_eq!(scores.get(0), 95); assert_eq!(scores.get(1), 87); let prefs = row.preferences(); assert_eq!(prefs.keys().size(), 2); assert_eq!(prefs.keys().get(0), &quot;language&quot;); assert_eq!(prefs.values().get(0), &quot;en&quot;);   ","version":"dev","tagName":"h2"},{"title":"How It Works‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/rust/row_format#how-it-works","content":" Fields are encoded in a binary row with fixed offsets for primitivesVariable-length data (strings, collections) stored with offset pointersNull bitmap tracks which fields are presentNested structures supported through recursive row encoding  ","version":"dev","tagName":"h2"},{"title":"Performance Comparison‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/rust/row_format#performance-comparison","content":" Operation\tObject Format\tRow FormatFull deserialization\tAllocates all objects\tZero allocation Single field access\tFull deserialization required\tDirect offset read Memory usage\tFull object graph in memory\tOnly accessed fields in memory Suitable for\tSmall objects, full access\tLarge objects, selective access  ","version":"dev","tagName":"h2"},{"title":"ForyRow vs ForyObject‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/rust/row_format#foryrow-vs-foryobject","content":" Feature\t#[derive(ForyRow)]\t#[derive(ForyObject)]Deserialization\tZero-copy, lazy\tFull object reconstruction Field access\tDirect from binary\tNormal struct access Memory usage\tMinimal\tFull object Best for\tAnalytics, large data\tGeneral serialization  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/rust/row_format#related-topics","content":" Basic Serialization - Object graph serializationCross-Language - Row format across languagesRow Format Specification - Protocol details ","version":"dev","tagName":"h2"},{"title":"Shared & Circular References","type":0,"sectionRef":"#","url":"/docs/next/guide/rust/references","content":"","keywords":"","version":"dev"},{"title":"Shared References‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/next/guide/rust/references#shared-references","content":" When the same object is referenced multiple times, Fory serializes it only once and uses reference IDs for subsequent occurrences. This ensures:  Space efficiency: No data duplication in serialized outputReference identity preservation: Deserialized objects maintain the same sharing relationshipsCircular reference support: Use RcWeak&lt;T&gt; and ArcWeak&lt;T&gt; to break cycles  ","version":"dev","tagName":"h2"},{"title":"Shared References with Rc‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/next/guide/rust/references#shared-references-with-rc","content":" use fory::Fory; use std::rc::Rc; let fory = Fory::default(); // Create a shared value let shared = Rc::new(String::from(&quot;shared_value&quot;)); // Reference it multiple times let data = vec![shared.clone(), shared.clone(), shared.clone()]; // The shared value is serialized only once let bytes = fory.serialize(&amp;data); let decoded: Vec&lt;Rc&lt;String&gt;&gt; = fory.deserialize(&amp;bytes)?; // Verify reference identity is preserved assert_eq!(decoded.len(), 3); assert_eq!(*decoded[0], &quot;shared_value&quot;); // All three Rc pointers point to the same object assert!(Rc::ptr_eq(&amp;decoded[0], &amp;decoded[1])); assert!(Rc::ptr_eq(&amp;decoded[1], &amp;decoded[2]));   ","version":"dev","tagName":"h3"},{"title":"Shared References with Arc‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/next/guide/rust/references#shared-references-with-arc","content":" For thread-safe shared references, use Arc&lt;T&gt;:  use fory::Fory; use std::sync::Arc; let fory = Fory::default(); let shared = Arc::new(String::from(&quot;shared_value&quot;)); let data = vec![shared.clone(), shared.clone()]; let bytes = fory.serialize(&amp;data); let decoded: Vec&lt;Arc&lt;String&gt;&gt; = fory.deserialize(&amp;bytes)?; assert!(Arc::ptr_eq(&amp;decoded[0], &amp;decoded[1]));   ","version":"dev","tagName":"h3"},{"title":"Circular References with Weak Pointers‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/next/guide/rust/references#circular-references-with-weak-pointers","content":" To serialize circular references like parent-child relationships or doubly-linked structures, use RcWeak&lt;T&gt; or ArcWeak&lt;T&gt; to break the cycle.  How it works:  Weak pointers serialize as references to their target objectsIf the strong pointer has been dropped, weak serializes as NullForward references (weak appearing before target) are resolved via callbacksAll clones of a weak pointer share the same internal cell for automatic updates  ","version":"dev","tagName":"h2"},{"title":"Circular References with RcWeak‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/next/guide/rust/references#circular-references-with-rcweak","content":" use fory::{Fory, Error}; use fory::ForyObject; use fory::RcWeak; use std::rc::Rc; use std::cell::RefCell; #[derive(ForyObject, Debug)] struct Node { value: i32, parent: RcWeak&lt;RefCell&lt;Node&gt;&gt;, children: Vec&lt;Rc&lt;RefCell&lt;Node&gt;&gt;&gt;, } let mut fory = Fory::default(); fory.register::&lt;Node&gt;(2000); // Build a parent-child tree let parent = Rc::new(RefCell::new(Node { value: 1, parent: RcWeak::new(), children: vec![], })); let child1 = Rc::new(RefCell::new(Node { value: 2, parent: RcWeak::from(&amp;parent), children: vec![], })); let child2 = Rc::new(RefCell::new(Node { value: 3, parent: RcWeak::from(&amp;parent), children: vec![], })); parent.borrow_mut().children.push(child1.clone()); parent.borrow_mut().children.push(child2.clone()); // Serialize and deserialize the circular structure let bytes = fory.serialize(&amp;parent); let decoded: Rc&lt;RefCell&lt;Node&gt;&gt; = fory.deserialize(&amp;bytes)?; // Verify the circular relationship assert_eq!(decoded.borrow().children.len(), 2); for child in &amp;decoded.borrow().children { let upgraded_parent = child.borrow().parent.upgrade().unwrap(); assert!(Rc::ptr_eq(&amp;decoded, &amp;upgraded_parent)); }   ","version":"dev","tagName":"h3"},{"title":"Thread-Safe Circular Graphs with Arc‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/next/guide/rust/references#thread-safe-circular-graphs-with-arc","content":" use fory::{Fory, Error}; use fory::ForyObject; use fory::ArcWeak; use std::sync::{Arc, Mutex}; #[derive(ForyObject)] struct Node { val: i32, parent: ArcWeak&lt;Mutex&lt;Node&gt;&gt;, children: Vec&lt;Arc&lt;Mutex&lt;Node&gt;&gt;&gt;, } let mut fory = Fory::default(); fory.register::&lt;Node&gt;(6000); let parent = Arc::new(Mutex::new(Node { val: 10, parent: ArcWeak::new(), children: vec![], })); let child1 = Arc::new(Mutex::new(Node { val: 20, parent: ArcWeak::from(&amp;parent), children: vec![], })); let child2 = Arc::new(Mutex::new(Node { val: 30, parent: ArcWeak::from(&amp;parent), children: vec![], })); parent.lock().unwrap().children.push(child1.clone()); parent.lock().unwrap().children.push(child2.clone()); let bytes = fory.serialize(&amp;parent); let decoded: Arc&lt;Mutex&lt;Node&gt;&gt; = fory.deserialize(&amp;bytes)?; assert_eq!(decoded.lock().unwrap().children.len(), 2); for child in &amp;decoded.lock().unwrap().children { let upgraded_parent = child.lock().unwrap().parent.upgrade().unwrap(); assert!(Arc::ptr_eq(&amp;decoded, &amp;upgraded_parent)); }   ","version":"dev","tagName":"h3"},{"title":"Supported Smart Pointer Types‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/next/guide/rust/references#supported-smart-pointer-types","content":" Type\tDescriptionRc&lt;T&gt;\tReference counting, shared refs tracked Arc&lt;T&gt;\tThread-safe reference counting, shared refs tracked RcWeak&lt;T&gt;\tWeak reference to Rc&lt;T&gt;, breaks circular refs ArcWeak&lt;T&gt;\tWeak reference to Arc&lt;T&gt;, breaks circular refs RefCell&lt;T&gt;\tInterior mutability with runtime borrow checking Mutex&lt;T&gt;\tThread-safe interior mutability  ","version":"dev","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/next/guide/rust/references#best-practices","content":" Use Rc/Arc for shared data: Let Fory handle deduplicationUse weak pointers for cycles: Prevent infinite recursionPrefer Arc for thread-safe scenarios: When data crosses thread boundariesCombine with RefCell/Mutex: For interior mutability  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/next/guide/rust/references#related-topics","content":" Basic Serialization - Supported typesPolymorphism - Trait objects with Rc/ArcConfiguration - Reference tracking options ","version":"dev","tagName":"h2"},{"title":"Trait Object Serialization","type":0,"sectionRef":"#","url":"/docs/next/guide/rust/polymorphism","content":"","keywords":"","version":"dev"},{"title":"Supported Trait Object Types‚Äã","type":1,"pageTitle":"Trait Object Serialization","url":"/docs/next/guide/rust/polymorphism#supported-trait-object-types","content":" Box&lt;dyn Trait&gt; - Owned trait objectsRc&lt;dyn Trait&gt; - Reference-counted trait objectsArc&lt;dyn Trait&gt; - Thread-safe reference-counted trait objectsVec&lt;Box&lt;dyn Trait&gt;&gt;, HashMap&lt;K, Box&lt;dyn Trait&gt;&gt; - Collections of trait objects  ","version":"dev","tagName":"h2"},{"title":"Basic Trait Object Serialization‚Äã","type":1,"pageTitle":"Trait Object Serialization","url":"/docs/next/guide/rust/polymorphism#basic-trait-object-serialization","content":" use fory::{Fory, register_trait_type}; use fory::Serializer; use fory::ForyObject; trait Animal: Serializer { fn speak(&amp;self) -&gt; String; fn name(&amp;self) -&gt; &amp;str; } #[derive(ForyObject)] struct Dog { name: String, breed: String } impl Animal for Dog { fn speak(&amp;self) -&gt; String { &quot;Woof!&quot;.to_string() } fn name(&amp;self) -&gt; &amp;str { &amp;self.name } } #[derive(ForyObject)] struct Cat { name: String, color: String } impl Animal for Cat { fn speak(&amp;self) -&gt; String { &quot;Meow!&quot;.to_string() } fn name(&amp;self) -&gt; &amp;str { &amp;self.name } } // Register trait implementations register_trait_type!(Animal, Dog, Cat); #[derive(ForyObject)] struct Zoo { star_animal: Box&lt;dyn Animal&gt;, } let mut fory = Fory::default().compatible(true); fory.register::&lt;Dog&gt;(100); fory.register::&lt;Cat&gt;(101); fory.register::&lt;Zoo&gt;(102); let zoo = Zoo { star_animal: Box::new(Dog { name: &quot;Buddy&quot;.to_string(), breed: &quot;Labrador&quot;.to_string(), }), }; let bytes = fory.serialize(&amp;zoo); let decoded: Zoo = fory.deserialize(&amp;bytes)?; assert_eq!(decoded.star_animal.name(), &quot;Buddy&quot;); assert_eq!(decoded.star_animal.speak(), &quot;Woof!&quot;);   ","version":"dev","tagName":"h2"},{"title":"Serializing dyn Any Trait Objects‚Äã","type":1,"pageTitle":"Trait Object Serialization","url":"/docs/next/guide/rust/polymorphism#serializing-dyn-any-trait-objects","content":" Apache Fory‚Ñ¢ supports serializing Rc&lt;dyn Any&gt; and Arc&lt;dyn Any&gt; for runtime type dispatch:  Key points:  Works with any type that implements SerializerRequires downcasting after deserialization to access the concrete typeType information is preserved during serializationUseful for plugin systems and dynamic type handling  use std::rc::Rc; use std::any::Any; let dog_rc: Rc&lt;dyn Animal&gt; = Rc::new(Dog { name: &quot;Rex&quot;.to_string(), breed: &quot;Golden&quot;.to_string() }); // Convert to Rc&lt;dyn Any&gt; for serialization let dog_any: Rc&lt;dyn Any&gt; = dog_rc.clone(); // Serialize the Any wrapper let bytes = fory.serialize(&amp;dog_any); let decoded: Rc&lt;dyn Any&gt; = fory.deserialize(&amp;bytes)?; // Downcast back to the concrete type let unwrapped = decoded.downcast_ref::&lt;Dog&gt;().unwrap(); assert_eq!(unwrapped.name, &quot;Rex&quot;);   For thread-safe scenarios, use Arc&lt;dyn Any&gt;:  use std::sync::Arc; use std::any::Any; let dog_arc: Arc&lt;dyn Animal&gt; = Arc::new(Dog { name: &quot;Buddy&quot;.to_string(), breed: &quot;Labrador&quot;.to_string() }); // Convert to Arc&lt;dyn Any&gt; let dog_any: Arc&lt;dyn Any&gt; = dog_arc.clone(); let bytes = fory.serialize(&amp;dog_any); let decoded: Arc&lt;dyn Any&gt; = fory.deserialize(&amp;bytes)?; // Downcast to concrete type let unwrapped = decoded.downcast_ref::&lt;Dog&gt;().unwrap(); assert_eq!(unwrapped.name, &quot;Buddy&quot;);   ","version":"dev","tagName":"h2"},{"title":"Rc/Arc-Based Trait Objects in Structs‚Äã","type":1,"pageTitle":"Trait Object Serialization","url":"/docs/next/guide/rust/polymorphism#rcarc-based-trait-objects-in-structs","content":" For fields with Rc&lt;dyn Trait&gt; or Arc&lt;dyn Trait&gt;, Fory automatically handles the conversion:  use std::sync::Arc; use std::rc::Rc; use std::collections::HashMap; #[derive(ForyObject)] struct AnimalShelter { animals_rc: Vec&lt;Rc&lt;dyn Animal&gt;&gt;, animals_arc: Vec&lt;Arc&lt;dyn Animal&gt;&gt;, registry: HashMap&lt;String, Arc&lt;dyn Animal&gt;&gt;, } let mut fory = Fory::default().compatible(true); fory.register::&lt;Dog&gt;(100); fory.register::&lt;Cat&gt;(101); fory.register::&lt;AnimalShelter&gt;(102); let shelter = AnimalShelter { animals_rc: vec![ Rc::new(Dog { name: &quot;Rex&quot;.to_string(), breed: &quot;Golden&quot;.to_string() }), Rc::new(Cat { name: &quot;Mittens&quot;.to_string(), color: &quot;Gray&quot;.to_string() }), ], animals_arc: vec![ Arc::new(Dog { name: &quot;Buddy&quot;.to_string(), breed: &quot;Labrador&quot;.to_string() }), ], registry: HashMap::from([ (&quot;pet1&quot;.to_string(), Arc::new(Dog { name: &quot;Max&quot;.to_string(), breed: &quot;Shepherd&quot;.to_string() }) as Arc&lt;dyn Animal&gt;), ]), }; let bytes = fory.serialize(&amp;shelter); let decoded: AnimalShelter = fory.deserialize(&amp;bytes)?; assert_eq!(decoded.animals_rc[0].name(), &quot;Rex&quot;); assert_eq!(decoded.animals_arc[0].speak(), &quot;Woof!&quot;);   ","version":"dev","tagName":"h2"},{"title":"Standalone Trait Object Serialization‚Äã","type":1,"pageTitle":"Trait Object Serialization","url":"/docs/next/guide/rust/polymorphism#standalone-trait-object-serialization","content":" Due to Rust's orphan rule, Rc&lt;dyn Trait&gt; and Arc&lt;dyn Trait&gt; cannot implement Serializer directly. For standalone serialization (not inside struct fields), the register_trait_type! macro generates wrapper types.  Note: If you don't want to use wrapper types, you can serialize as Rc&lt;dyn Any&gt; or Arc&lt;dyn Any&gt; instead (see the dyn Any section above).  The register_trait_type! macro generates AnimalRc and AnimalArc wrapper types:  // For Rc&lt;dyn Trait&gt; let dog_rc: Rc&lt;dyn Animal&gt; = Rc::new(Dog { name: &quot;Rex&quot;.to_string(), breed: &quot;Golden&quot;.to_string() }); let wrapper = AnimalRc::from(dog_rc); let bytes = fory.serialize(&amp;wrapper); let decoded: AnimalRc = fory.deserialize(&amp;bytes)?; // Unwrap back to Rc&lt;dyn Animal&gt; let unwrapped: Rc&lt;dyn Animal&gt; = decoded.unwrap(); assert_eq!(unwrapped.name(), &quot;Rex&quot;); // For Arc&lt;dyn Trait&gt; let dog_arc: Arc&lt;dyn Animal&gt; = Arc::new(Dog { name: &quot;Buddy&quot;.to_string(), breed: &quot;Labrador&quot;.to_string() }); let wrapper = AnimalArc::from(dog_arc); let bytes = fory.serialize(&amp;wrapper); let decoded: AnimalArc = fory.deserialize(&amp;bytes)?; let unwrapped: Arc&lt;dyn Animal&gt; = decoded.unwrap(); assert_eq!(unwrapped.name(), &quot;Buddy&quot;);   ","version":"dev","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Trait Object Serialization","url":"/docs/next/guide/rust/polymorphism#best-practices","content":" Use register_trait_type! to register all trait implementationsEnable compatible mode for trait objects: .compatible(true)Register all concrete types before serializationPrefer dyn Any for simpler standalone serialization  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Trait Object Serialization","url":"/docs/next/guide/rust/polymorphism#related-topics","content":" References - Rc/Arc shared referencesSchema Evolution - Compatible modeType Registration - Registering types ","version":"dev","tagName":"h2"},{"title":"Field Configuration","type":0,"sectionRef":"#","url":"/docs/next/guide/rust/field_configuration","content":"","keywords":"","version":"dev"},{"title":"Overview‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/rust/field_configuration#overview","content":" Apache Fory‚Ñ¢ provides the #[fory(...)] attribute macro to specify optional field-level metadata at compile time. This enables:  Tag IDs: Assign compact numeric IDs to minimize struct field meta size overheadNullability: Control whether fields can be nullReference Tracking: Enable reference tracking for shared ownership typesField Skipping: Exclude fields from serializationEncoding Control: Specify how integers are encoded (varint, fixed, tagged)  ","version":"dev","tagName":"h2"},{"title":"Basic Syntax‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/rust/field_configuration#basic-syntax","content":" The #[fory(...)] attribute is placed on individual struct fields:  use fory::ForyObject; #[derive(ForyObject)] struct Person { #[fory(id = 0)] name: String, #[fory(id = 1)] age: i32, #[fory(id = 2, nullable)] nickname: Option&lt;String&gt;, }   Multiple options are separated by commas.  ","version":"dev","tagName":"h2"},{"title":"Available Options‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/rust/field_configuration#available-options","content":" ","version":"dev","tagName":"h2"},{"title":"Field ID (id = N)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/rust/field_configuration#field-id-id--n","content":" Assigns a numeric ID to a field to minimize struct field meta size overhead:  #[derive(ForyObject)] struct User { #[fory(id = 0)] id: i64, #[fory(id = 1)] name: String, #[fory(id = 2)] age: i32, }   Benefits:  Smaller serialized size (numeric IDs vs field names in metadata)Allows renaming fields without breaking binary compatibility  Recommendation: It is recommended to configure field IDs for compatible mode since it reduces serialization cost.  Notes:  IDs must be unique within a structIDs must be &gt;= 0 (use -1 to explicitly opt-out of tag ID encoding)If not specified, field name is used in metadata (larger overhead)  ","version":"dev","tagName":"h3"},{"title":"Skipping Fields (skip)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/rust/field_configuration#skipping-fields-skip","content":" Excludes a field from serialization:  #[derive(ForyObject)] struct User { #[fory(id = 0)] id: i64, #[fory(id = 1)] name: String, #[fory(skip)] password: String, // Not serialized }   The password field will not be included in serialized output and will remain at its default value after deserialization.  ","version":"dev","tagName":"h3"},{"title":"Nullable (nullable)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/rust/field_configuration#nullable-nullable","content":" Controls whether null flags are written for fields:  use fory::{Fory, RcWeak}; #[derive(ForyObject)] struct Record { // RcWeak is nullable by default, override to non-nullable #[fory(id = 0, nullable = false)] required_ref: RcWeak&lt;Data&gt;, }   Default Behavior:  Type\tDefault NullableOption&lt;T&gt;\ttrue RcWeak&lt;T&gt;, ArcWeak&lt;T&gt;\ttrue All other types\tfalse  Notes:  For Option&lt;T&gt;, RcWeak&lt;T&gt;, ArcWeak&lt;T&gt;, nullable defaults to trueFor all other types, nullable defaults to falseUse nullable = false to override defaults for types that are nullable by default  ","version":"dev","tagName":"h3"},{"title":"Reference Tracking (ref)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/rust/field_configuration#reference-tracking-ref","content":" Controls per-field reference tracking for shared ownership types:  use std::rc::Rc; use std::sync::Arc; #[derive(ForyObject)] struct Container { // Enable reference tracking (default for Rc/Arc) #[fory(id = 0, ref = true)] shared_data: Rc&lt;Data&gt;, // Disable reference tracking #[fory(id = 1, ref = false)] unique_data: Rc&lt;Data&gt;, }   Default Behavior:  Type\tDefault Ref TrackingRc&lt;T&gt;, Arc&lt;T&gt;\ttrue RcWeak&lt;T&gt;, ArcWeak&lt;T&gt;\ttrue Option&lt;Rc&lt;T&gt;&gt;, Option&lt;Arc&lt;T&gt;&gt;\ttrue (inherited) All other types\tfalse  Use Cases:  Enable for fields that may be circular or sharedDisable for fields that are always unique (optimization)  ","version":"dev","tagName":"h3"},{"title":"Encoding (encoding)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/rust/field_configuration#encoding-encoding","content":" Controls how integer fields are encoded:  #[derive(ForyObject)] struct Metrics { // Variable-length encoding (smaller for small values) #[fory(id = 0, encoding = &quot;varint&quot;)] count: i64, // Fixed-length encoding (consistent size) #[fory(id = 1, encoding = &quot;fixed&quot;)] timestamp: i64, // Tagged encoding (includes type tag, u64 only) #[fory(id = 2, encoding = &quot;tagged&quot;)] value: u64, }   Supported Encodings:  Type\tOptions\tDefaulti32, u32\tvarint, fixed\tvarint i64, u64\tvarint, fixed, tagged\tvarint  When to Use:  varint: Best for values that are often small (default)fixed: Best for values that use full range (e.g., timestamps, hashes)tagged: When type information needs to be preserved (u64 only)  ","version":"dev","tagName":"h3"},{"title":"Compress (compress)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/rust/field_configuration#compress-compress","content":" A convenience shorthand for controlling integer encoding:  #[derive(ForyObject)] struct Data { // compress = true -&gt; varint encoding (default) #[fory(id = 0, compress)] small_value: i32, // compress = false -&gt; fixed encoding #[fory(id = 1, compress = false)] fixed_value: u32, }   Notes:  compress or compress = true is equivalent to encoding = &quot;varint&quot;compress = false is equivalent to encoding = &quot;fixed&quot;If both compress and encoding are specified, they must not conflict  ","version":"dev","tagName":"h3"},{"title":"Type Classification‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/rust/field_configuration#type-classification","content":" Fory classifies field types to determine default behavior:  Type Class\tExamples\tDefault Nullable\tDefault RefPrimitive\ti8, i32, f64, bool\tfalse\tfalse Option\tOption&lt;T&gt;\ttrue\tfalse Rc\tRc&lt;T&gt;\tfalse\ttrue Arc\tArc&lt;T&gt;\tfalse\ttrue RcWeak\tRcWeak&lt;T&gt; (fory type)\ttrue\ttrue ArcWeak\tArcWeak&lt;T&gt; (fory type)\ttrue\ttrue Other\tString, Vec&lt;T&gt;, user types\tfalse\tfalse  Special Case: Option&lt;Rc&lt;T&gt;&gt; and Option&lt;Arc&lt;T&gt;&gt; inherit the inner type's ref tracking behavior.  ","version":"dev","tagName":"h2"},{"title":"Complete Example‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/rust/field_configuration#complete-example","content":" use fory::ForyObject; use std::rc::Rc; #[derive(ForyObject, Default)] struct Document { // Required fields with tag IDs #[fory(id = 0)] title: String, #[fory(id = 1)] version: i32, // Optional field (nullable by default for Option) #[fory(id = 2)] description: Option&lt;String&gt;, // Reference-tracked shared pointer #[fory(id = 3)] parent: Rc&lt;Document&gt;, // Nullable + reference-tracked #[fory(id = 4, nullable)] related: Option&lt;Rc&lt;Document&gt;&gt;, // Counter with varint encoding (small values) #[fory(id = 5, encoding = &quot;varint&quot;)] view_count: u64, // Timestamp with fixed encoding (full range values) #[fory(id = 6, encoding = &quot;fixed&quot;)] created_at: i64, // Skip sensitive field #[fory(skip)] internal_state: String, } fn main() { let fory = fory::Fory::default(); let doc = Document { title: &quot;My Document&quot;.to_string(), version: 1, description: Some(&quot;A sample document&quot;.to_string()), parent: Rc::new(Document::default()), related: None, // Allowed because nullable view_count: 42, created_at: 1704067200, internal_state: &quot;secret&quot;.to_string(), // Will be skipped }; let bytes = fory.serialize(&amp;doc); let decoded: Document = fory.deserialize(&amp;bytes).unwrap(); }   ","version":"dev","tagName":"h2"},{"title":"Compile-Time Validation‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/rust/field_configuration#compile-time-validation","content":" Invalid configurations are caught at compile time:  // Error: duplicate field IDs #[derive(ForyObject)] struct Bad { #[fory(id = 0)] field1: String, #[fory(id = 0)] // Compile error: duplicate id field2: String, } // Error: invalid id value #[derive(ForyObject)] struct Bad2 { #[fory(id = -2)] // Compile error: id must be &gt;= -1 field: String, } // Error: conflicting encoding attributes #[derive(ForyObject)] struct Bad3 { #[fory(compress = true, encoding = &quot;fixed&quot;)] // Compile error: conflict field: i32, }   ","version":"dev","tagName":"h2"},{"title":"Cross-Language Compatibility‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/rust/field_configuration#cross-language-compatibility","content":" When serializing data to be read by other languages (Java, C++, Go, Python), use field configuration to match encoding expectations:  #[derive(ForyObject)] struct CrossLangData { // Matches Java Integer with varint #[fory(id = 0, encoding = &quot;varint&quot;)] int_var: i32, // Matches Java Integer with fixed #[fory(id = 1, encoding = &quot;fixed&quot;)] int_fixed: i32, // Matches Java Long with tagged encoding #[fory(id = 2, encoding = &quot;tagged&quot;)] long_tagged: u64, // Nullable pointer matches Java nullable reference #[fory(id = 3, nullable)] optional: Option&lt;String&gt;, }   ","version":"dev","tagName":"h2"},{"title":"Schema Evolution‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/rust/field_configuration#schema-evolution","content":" Compatible mode supports schema evolution. It is recommended to configure field IDs to reduce serialization cost:  // Version 1 #[derive(ForyObject)] struct DataV1 { #[fory(id = 0)] id: i64, #[fory(id = 1)] name: String, } // Version 2: Added new field #[derive(ForyObject)] struct DataV2 { #[fory(id = 0)] id: i64, #[fory(id = 1)] name: String, #[fory(id = 2)] email: Option&lt;String&gt;, // New nullable field }   Data serialized with V1 can be deserialized with V2 (new field will be None).  Alternatively, field IDs can be omitted (field names will be used in metadata with larger overhead):  #[derive(ForyObject)] struct Data { id: i64, name: String, }   ","version":"dev","tagName":"h2"},{"title":"Default Values‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/rust/field_configuration#default-values","content":" Nullable: Option&lt;T&gt;, RcWeak&lt;T&gt;, and ArcWeak&lt;T&gt; are nullable by default; all other types are non-nullableRef tracking: Rc&lt;T&gt;, Arc&lt;T&gt;, RcWeak&lt;T&gt;, and ArcWeak&lt;T&gt; enable ref tracking by default; all other types are disabled  You need to configure fields when:  A field can be None (use Option&lt;T&gt;)A field needs reference tracking for shared/circular objects (use ref = true)Integer types need specific encoding for cross-language compatibilityYou want to reduce metadata size (use field IDs)  // Xlang mode: explicit configuration required #[derive(ForyObject)] struct User { #[fory(id = 0)] name: String, // Non-nullable by default #[fory(id = 1)] email: Option&lt;String&gt;, // Nullable (Option&lt;T&gt;) #[fory(id = 2, ref = true)] friend: Rc&lt;User&gt;, // Ref tracking (default for Rc) }   ","version":"dev","tagName":"h2"},{"title":"Default Values Summary‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/rust/field_configuration#default-values-summary","content":" Type\tDefault Nullable\tDefault Ref TrackingPrimitives, String\tfalse\tfalse Option&lt;T&gt;\ttrue\tfalse Rc&lt;T&gt;, Arc&lt;T&gt;\tfalse\ttrue RcWeak&lt;T&gt;, ArcWeak&lt;T&gt;\ttrue\ttrue  ","version":"dev","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/rust/field_configuration#best-practices","content":" Configure field IDs: Recommended for compatible mode to reduce serialization costUse skip for sensitive data: Passwords, tokens, internal stateEnable ref tracking for shared objects: When the same pointer appears multiple timesDisable ref tracking for unique fields: Optimization when you know the field is uniqueChoose appropriate encoding: varint for small values, fixed for full-range valuesKeep IDs stable: Once assigned, don't change field IDs  ","version":"dev","tagName":"h2"},{"title":"Options Reference‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/rust/field_configuration#options-reference","content":" Option\tSyntax\tDescription\tValid Forid\tid = N\tField tag ID to reduce metadata size\tAll fields skip\tskip\tExclude field from serialization\tAll fields nullable\tnullable or nullable = bool\tControl null flag writing\tAll fields ref\tref or ref = bool\tControl reference tracking\tRc, Arc, weak types encoding\tencoding = &quot;varint/fixed/tagged&quot;\tInteger encoding method\ti32, u32, i64, u64 compress\tcompress or compress = bool\tShorthand for varint/fixed\ti32, u32  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/rust/field_configuration#related-topics","content":" Basic Serialization - Getting started with Fory serializationSchema Evolution - Compatible mode and schema evolutionCross-Language - Interoperability with Java, C++, Go, Python ","version":"dev","tagName":"h2"},{"title":"Troubleshooting","type":0,"sectionRef":"#","url":"/docs/next/guide/rust/troubleshooting","content":"","keywords":"","version":"dev"},{"title":"Common Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/rust/troubleshooting#common-issues","content":" ","version":"dev","tagName":"h2"},{"title":"Type Registry Errors‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/rust/troubleshooting#type-registry-errors","content":" Error: TypeId ... not found in type_info registry  Cause: The type was never registered with the current Fory instance.  Solution: Register the type before serialization:  let mut fory = Fory::default(); fory.register::&lt;MyStruct&gt;(100)?; // Register before use   Confirm that:  Every serializable struct or trait implementation calls fory.register::&lt;T&gt;(type_id)The same IDs are reused on the deserialize side  ","version":"dev","tagName":"h3"},{"title":"Type Mismatch Errors‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/rust/troubleshooting#type-mismatch-errors","content":" Cause: Field types are incompatible or schema has changed.  Solution:  Enable compatible mode for schema evolutionEnsure field types match across versions  let fory = Fory::default().compatible(true);   ","version":"dev","tagName":"h3"},{"title":"Debugging Techniques‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/rust/troubleshooting#debugging-techniques","content":" ","version":"dev","tagName":"h2"},{"title":"Enable Panic on Error for Backtraces‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/rust/troubleshooting#enable-panic-on-error-for-backtraces","content":" Toggle FORY_PANIC_ON_ERROR=1 alongside RUST_BACKTRACE=1 to panic at the exact site an error is constructed:  RUST_BACKTRACE=1 FORY_PANIC_ON_ERROR=1 cargo test --features tests   Reset the variable afterwards to avoid aborting user-facing code paths.  ","version":"dev","tagName":"h3"},{"title":"Struct Field Tracing‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/rust/troubleshooting#struct-field-tracing","content":" Add the #[fory(debug)] attribute alongside #[derive(ForyObject)] to emit hook invocations:  #[derive(ForyObject)] #[fory(debug)] struct MyStruct { field1: i32, field2: String, }   Once compiled with debug hooks, call these functions to plug in custom callbacks:  set_before_write_field_funcset_after_write_field_funcset_before_read_field_funcset_after_read_field_func  Use reset_struct_debug_hooks() when you want the defaults back.  ","version":"dev","tagName":"h3"},{"title":"Lightweight Logging‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/rust/troubleshooting#lightweight-logging","content":" Without custom hooks, enable ENABLE_FORY_DEBUG_OUTPUT=1 to print field-level read/write events:  ENABLE_FORY_DEBUG_OUTPUT=1 cargo test --features tests   This is especially useful when investigating alignment or cursor mismatches.  ","version":"dev","tagName":"h3"},{"title":"Inspect Generated Code‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/rust/troubleshooting#inspect-generated-code","content":" Use cargo expand to inspect code generated by Fory derive macros:  cargo expand --test mod $mod$::$file$ &gt; expanded.rs   ","version":"dev","tagName":"h3"},{"title":"Running Tests‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/rust/troubleshooting#running-tests","content":" ","version":"dev","tagName":"h2"},{"title":"Run All Tests‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/rust/troubleshooting#run-all-tests","content":" cargo test --features tests   ","version":"dev","tagName":"h3"},{"title":"Run Specific Test‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/rust/troubleshooting#run-specific-test","content":" cargo test -p tests --test $test_file $test_method   ","version":"dev","tagName":"h3"},{"title":"Run Test with Debugging‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/rust/troubleshooting#run-test-with-debugging","content":" RUST_BACKTRACE=1 FORY_PANIC_ON_ERROR=1 ENABLE_FORY_DEBUG_OUTPUT=1 \\ cargo test --test mod $dir$::$test_file::$test_method -- --nocapture   ","version":"dev","tagName":"h3"},{"title":"Test-Time Hygiene‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/rust/troubleshooting#test-time-hygiene","content":" Some integration tests expect FORY_PANIC_ON_ERROR to remain unset. Export it only for focused debugging sessions:  # For specific debugging only FORY_PANIC_ON_ERROR=1 cargo test -p tests --test specific_test -- --nocapture # Normal test run (without panic on error) cargo test --features tests   ","version":"dev","tagName":"h2"},{"title":"Error Handling Best Practices‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/rust/troubleshooting#error-handling-best-practices","content":" Prefer the static constructors on fory_core::error::Error:  Error::type_mismatchError::invalid_dataError::unknown  This keeps diagnostics consistent and makes opt-in panics work correctly.  ","version":"dev","tagName":"h2"},{"title":"Quick Reference‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/rust/troubleshooting#quick-reference","content":" Environment Variable\tPurposeRUST_BACKTRACE=1\tEnable stack traces FORY_PANIC_ON_ERROR=1\tPanic at error site for debugging ENABLE_FORY_DEBUG_OUTPUT=1\tPrint field-level read/write events  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/rust/troubleshooting#related-topics","content":" Configuration - Fory optionsType Registration - Registration best practicesSchema Evolution - Compatible mode ","version":"dev","tagName":"h2"},{"title":"Schema Evolution","type":0,"sectionRef":"#","url":"/docs/next/guide/rust/schema_evolution","content":"","keywords":"","version":"dev"},{"title":"Compatible Mode‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/rust/schema_evolution#compatible-mode","content":" Enable schema evolution with compatible(true):  use fory::Fory; use fory::ForyObject; use std::collections::HashMap; #[derive(ForyObject, Debug)] struct PersonV1 { name: String, age: i32, address: String, } #[derive(ForyObject, Debug)] struct PersonV2 { name: String, age: i32, // address removed // phone added phone: Option&lt;String&gt;, metadata: HashMap&lt;String, String&gt;, } let mut fory1 = Fory::default().compatible(true); fory1.register::&lt;PersonV1&gt;(1); let mut fory2 = Fory::default().compatible(true); fory2.register::&lt;PersonV2&gt;(1); let person_v1 = PersonV1 { name: &quot;Alice&quot;.to_string(), age: 30, address: &quot;123 Main St&quot;.to_string(), }; // Serialize with V1 let bytes = fory1.serialize(&amp;person_v1); // Deserialize with V2 - missing fields get default values let person_v2: PersonV2 = fory2.deserialize(&amp;bytes)?; assert_eq!(person_v2.name, &quot;Alice&quot;); assert_eq!(person_v2.age, 30); assert_eq!(person_v2.phone, None);   ","version":"dev","tagName":"h2"},{"title":"Disable Evolution for Stable Structs‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/rust/schema_evolution#disable-evolution-for-stable-structs","content":" If a struct schema is stable and will not change, you can disable evolution for that struct to avoid compatible metadata overhead. Use #[fory(evolving = false)]:  use fory::ForyObject; #[derive(ForyObject)] #[fory(evolving = false)] struct StableMessage { id: i32, }   ","version":"dev","tagName":"h3"},{"title":"Schema Evolution Features‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/rust/schema_evolution#schema-evolution-features","content":" Add new fields with default valuesRemove obsolete fields (skipped during deserialization)Change field nullability (T ‚Üî Option&lt;T&gt;)Reorder fields (matched by name, not position)Type-safe fallback to default values for missing fields  ","version":"dev","tagName":"h2"},{"title":"Compatibility Rules‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/rust/schema_evolution#compatibility-rules","content":" Field names must match (case-sensitive)Type changes are not supported (except nullable/non-nullable)Nested struct types must be registered on both sides  ","version":"dev","tagName":"h2"},{"title":"Enum Support‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/rust/schema_evolution#enum-support","content":" Apache Fory‚Ñ¢ supports three types of enum variants with full schema evolution in Compatible mode:  Variant Types:  Unit: C-style enums (Status::Active)Unnamed: Tuple-like variants (Message::Pair(String, i32))Named: Struct-like variants (Event::Click { x: i32, y: i32 })  use fory::{Fory, ForyObject}; #[derive(Default, ForyObject, Debug, PartialEq)] enum Value { #[default] Null, Bool(bool), Number(f64), Text(String), Object { name: String, value: i32 }, } let mut fory = Fory::default(); fory.register::&lt;Value&gt;(1)?; let value = Value::Object { name: &quot;score&quot;.to_string(), value: 100 }; let bytes = fory.serialize(&amp;value)?; let decoded: Value = fory.deserialize(&amp;bytes)?; assert_eq!(value, decoded);   ","version":"dev","tagName":"h2"},{"title":"Enum Schema Evolution‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/rust/schema_evolution#enum-schema-evolution","content":" Compatible mode enables robust schema evolution with variant type encoding (2 bits):  0b0 = Unit, 0b1 = Unnamed, 0b10 = Named  use fory::{Fory, ForyObject}; // Old version #[derive(ForyObject)] enum OldEvent { Click { x: i32, y: i32 }, Scroll { delta: f64 }, } // New version - added field and variant #[derive(Default, ForyObject)] enum NewEvent { #[default] Unknown, Click { x: i32, y: i32, timestamp: u64 }, // Added field Scroll { delta: f64 }, KeyPress(String), // New variant } let mut fory = Fory::default().compatible(true); // Serialize with old schema let old_bytes = fory.serialize(&amp;OldEvent::Click { x: 100, y: 200 })?; // Deserialize with new schema - timestamp gets default value (0) let new_event: NewEvent = fory.deserialize(&amp;old_bytes)?; assert!(matches!(new_event, NewEvent::Click { x: 100, y: 200, timestamp: 0 }));   Evolution capabilities:  Unknown variants ‚Üí Falls back to default variantNamed variant fields ‚Üí Add/remove fields (missing fields use defaults)Unnamed variant elements ‚Üí Add/remove elements (extras skipped, missing use defaults)Variant type mismatches ‚Üí Automatically uses default value for current variant  Best practices:  Always mark a default variant with #[default]Named variants provide better evolution than unnamedUse compatible mode for cross-version communication  ","version":"dev","tagName":"h3"},{"title":"Tuple Support‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/rust/schema_evolution#tuple-support","content":" Apache Fory‚Ñ¢ supports tuples up to 22 elements out of the box with efficient serialization in both compatible and non-compatible modes.  Features:  Automatic serialization for tuples from 1 to 22 elementsHeterogeneous type support (each element can be a different type)Schema evolution in Compatible mode (handles missing/extra elements)  Serialization modes:  Non-compatible mode: Serializes elements sequentially without collection headers for minimal overheadCompatible mode: Uses collection protocol with type metadata for schema evolution  use fory::{Fory, Error}; let mut fory = Fory::default(); // Tuple with heterogeneous types let data: (i32, String, bool, Vec&lt;i32&gt;) = ( 42, &quot;hello&quot;.to_string(), true, vec![1, 2, 3], ); let bytes = fory.serialize(&amp;data)?; let decoded: (i32, String, bool, Vec&lt;i32&gt;) = fory.deserialize(&amp;bytes)?; assert_eq!(data, decoded);   ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/rust/schema_evolution#related-topics","content":" Configuration - Enabling compatible modePolymorphism - Trait objects with schema evolutionCross-Language - Schema evolution across languages ","version":"dev","tagName":"h2"},{"title":"Scala Serialization Guide","type":0,"sectionRef":"#","url":"/docs/next/guide/scala/","content":"","keywords":"","version":"dev"},{"title":"Features‚Äã","type":1,"pageTitle":"Scala Serialization Guide","url":"/docs/next/guide/scala/#features","content":" Fory Scala inherits all features from Fory Java, plus Scala-specific optimizations:  High Performance: JIT code generation, zero-copy, 20-170x faster than traditional serializationScala Type Support: Optimized serializers for case classes, singletons, collections, tuples, Option, EitherDefault Value Support: Automatic handling of Scala class default parameters during schema evolutionSingleton Preservation: object singletons maintain referential equality after deserializationSchema Evolution: Forward/backward compatibility for class schema changes  See Java Features for complete feature list.  ","version":"dev","tagName":"h2"},{"title":"Installation‚Äã","type":1,"pageTitle":"Scala Serialization Guide","url":"/docs/next/guide/scala/#installation","content":" Add the dependency with sbt:  libraryDependencies += &quot;org.apache.fory&quot; %% &quot;fory-scala&quot; % &quot;0.15.0&quot;   ","version":"dev","tagName":"h2"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Scala Serialization Guide","url":"/docs/next/guide/scala/#quick-start","content":" import org.apache.fory.Fory import org.apache.fory.serializer.scala.ScalaSerializers case class Person(name: String, id: Long, github: String) case class Point(x: Int, y: Int, z: Int) object ScalaExample { // Create Fory with Scala optimization enabled val fory: Fory = Fory.builder() .withScalaOptimizationEnabled(true) .build() // Register optimized Fory serializers for Scala ScalaSerializers.registerSerializers(fory) // Register your classes fory.register(classOf[Person]) fory.register(classOf[Point]) def main(args: Array[String]): Unit = { val p = Person(&quot;Shawn Yang&quot;, 1, &quot;https://github.com/chaokunyang&quot;) println(fory.deserialize(fory.serialize(p))) println(fory.deserialize(fory.serialize(Point(1, 2, 3)))) } }   ","version":"dev","tagName":"h2"},{"title":"Built on Fory Java‚Äã","type":1,"pageTitle":"Scala Serialization Guide","url":"/docs/next/guide/scala/#built-on-fory-java","content":" Fory Scala is built on top of Fory Java. Most configuration options, features, and concepts from Fory Java apply directly to Scala. Refer to the Java documentation for:  Configuration Options - All ForyBuilder optionsBasic Serialization - Serialization patterns and APIsType Registration - Class registration and securitySchema Evolution - Forward/backward compatibilityCustom Serializers - Implement custom serializersCompression - Int, long, and string compressionTroubleshooting - Common issues and solutions  ","version":"dev","tagName":"h2"},{"title":"Scala-Specific Documentation‚Äã","type":1,"pageTitle":"Scala Serialization Guide","url":"/docs/next/guide/scala/#scala-specific-documentation","content":" Fory Creation - Scala-specific Fory setup requirementsType Serialization - Serializing Scala typesDefault Values - Scala class default values support ","version":"dev","tagName":"h2"},{"title":"Type Registration","type":0,"sectionRef":"#","url":"/docs/next/guide/rust/type_registration","content":"","keywords":"","version":"dev"},{"title":"Register by ID‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/rust/type_registration#register-by-id","content":" Register types with a numeric ID for fast, compact serialization:  use fory::Fory; use fory::ForyObject; #[derive(ForyObject)] struct User { name: String, age: i32, } let mut fory = Fory::default(); fory.register::&lt;User&gt;(1)?; let user = User { name: &quot;Alice&quot;.to_string(), age: 30, }; let bytes = fory.serialize(&amp;user)?; let decoded: User = fory.deserialize(&amp;bytes)?;   ","version":"dev","tagName":"h2"},{"title":"Register by Namespace‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/rust/type_registration#register-by-namespace","content":" For cross-language compatibility, register with namespace and type name:  let mut fory = Fory::default() .compatible(true) .xlang(true); // Register with namespace-based naming fory.register_by_namespace::&lt;MyStruct&gt;(&quot;com.example&quot;, &quot;MyStruct&quot;)?;   ","version":"dev","tagName":"h2"},{"title":"Register Custom Serializer‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/rust/type_registration#register-custom-serializer","content":" For types that need custom serialization logic:  let mut fory = Fory::default(); fory.register_serializer::&lt;CustomType&gt;(100)?;   ","version":"dev","tagName":"h2"},{"title":"Registration Consistency‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/rust/type_registration#registration-consistency","content":" Rust registration APIs use explicit IDs or explicit namespace/type names. Keep the same registration mapping on serializer and deserializer peers:  // Serializer side let mut fory = Fory::default(); fory.register::&lt;TypeA&gt;(1)?; fory.register::&lt;TypeB&gt;(2)?; fory.register::&lt;TypeC&gt;(3)?; // Deserializer side - MUST use the same ID mapping let mut fory = Fory::default(); fory.register::&lt;TypeA&gt;(1)?; fory.register::&lt;TypeB&gt;(2)?; fory.register::&lt;TypeC&gt;(3)?;   ","version":"dev","tagName":"h2"},{"title":"Thread-Safe Registration‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/rust/type_registration#thread-safe-registration","content":" Perform all registrations before spawning threads:  use std::sync::Arc; use std::thread; let mut fory = Fory::default(); fory.register::&lt;User&gt;(1)?; fory.register::&lt;Order&gt;(2)?; // Now share across threads let fory = Arc::new(fory); let handles: Vec&lt;_&gt; = (0..4) .map(|_| { let shared = Arc::clone(&amp;fory); thread::spawn(move || { // Use fory for serialization }) }) .collect();   ","version":"dev","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/rust/type_registration#best-practices","content":" Use consistent IDs: Same type ID across all languages for cross-language compatibilityRegister before threading: Complete all registrations before spawning threadsUse namespace for xlang: Makes type names consistent across languagesExplicit IDs for stability: Avoid auto-generated IDs in production  ","version":"dev","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/rust/type_registration#related-topics","content":" Configuration - Fory builder optionsCross-Language - XLANG mode registrationCustom Serializers - Custom serialization ","version":"dev","tagName":"h2"},{"title":"Default Values","type":0,"sectionRef":"#","url":"/docs/next/guide/scala/default_values","content":"","keywords":"","version":"dev"},{"title":"Overview‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/next/guide/scala/default_values#overview","content":" When a Scala class has default parameters, the Scala compiler generates methods in the companion object (for case classes) or in the class itself (for regular Scala classes) like apply$default$1, apply$default$2, etc. that return the default values. Fory can detect these methods and use them when deserializing objects where certain fields are missing from the serialized data.  ","version":"dev","tagName":"h2"},{"title":"Supported Class Types‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/next/guide/scala/default_values#supported-class-types","content":" Fory supports default values for:  Case classes with default parametersRegular Scala classes with default parameters in their primary constructorNested case classes with default parameters  ","version":"dev","tagName":"h2"},{"title":"How It Works‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/next/guide/scala/default_values#how-it-works","content":" Detection: Fory detects if a class is a Scala class by checking for the presence of default value methods (apply$default$N or $default$N). Default Value Discovery: For case classes: Fory scans the companion object for methods named apply$default$1, apply$default$2, etc.For regular Scala classes: Fory scans the class itself for methods named $default$1, $default$2, etc. Field Mapping: During deserialization, Fory identifies fields that exist in the target class but are missing from the serialized data. Value Application: After reading all available fields from the serialized data, Fory applies default values to any missing fields.  ","version":"dev","tagName":"h2"},{"title":"Usage‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/next/guide/scala/default_values#usage","content":" This feature is automatically enabled when:  Compatible mode is enabled (withCompatibleMode(CompatibleMode.COMPATIBLE))The target class is detected as a Scala class with default valuesA field is missing from the serialized data but exists in the target class  No additional configuration is required.  ","version":"dev","tagName":"h2"},{"title":"Examples‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/next/guide/scala/default_values#examples","content":" ","version":"dev","tagName":"h2"},{"title":"Case Class with Default Values‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/next/guide/scala/default_values#case-class-with-default-values","content":" import org.apache.fory.Fory import org.apache.fory.config.CompatibleMode import org.apache.fory.serializer.scala.ScalaSerializers // Class WITHOUT default values (for serialization) case class PersonV1(name: String) // Class WITH default values (for deserialization) case class PersonV2(name: String, age: Int = 25, city: String = &quot;Unknown&quot;) val fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .withScalaOptimizationEnabled(true) .build() ScalaSerializers.registerSerializers(fory) // Serialize using class without default values val original = PersonV1(&quot;John&quot;) val serialized = fory.serialize(original) // Deserialize into class with default values // Missing fields will use defaults val deserialized = fory.deserialize(serialized).asInstanceOf[PersonV2] // deserialized.name == &quot;John&quot; // deserialized.age == 25 (default) // deserialized.city == &quot;Unknown&quot; (default)   ","version":"dev","tagName":"h3"},{"title":"Regular Scala Class with Default Values‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/next/guide/scala/default_values#regular-scala-class-with-default-values","content":" // Class WITHOUT default values (for serialization) class EmployeeV1(val name: String) // Class WITH default values (for deserialization) class EmployeeV2( val name: String, val age: Int = 30, val department: String = &quot;Engineering&quot; ) val fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .withScalaOptimizationEnabled(true) .build() ScalaSerializers.registerSerializers(fory) // Serialize using class without default values val original = new EmployeeV1(&quot;Jane&quot;) val serialized = fory.serialize(original) // Deserialize into class with default values val deserialized = fory.deserialize(serialized).asInstanceOf[EmployeeV2] // deserialized.name == &quot;Jane&quot; // deserialized.age == 30 (default) // deserialized.department == &quot;Engineering&quot; (default)   ","version":"dev","tagName":"h3"},{"title":"Complex Default Values‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/next/guide/scala/default_values#complex-default-values","content":" Default values can be complex expressions:  // Class WITHOUT default values (for serialization) case class ConfigV1(name: String) // Class WITH default values (for deserialization) case class ConfigV2( name: String, settings: Map[String, String] = Map(&quot;default&quot; -&gt; &quot;value&quot;), tags: List[String] = List(&quot;default&quot;), enabled: Boolean = true ) val fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .withScalaOptimizationEnabled(true) .build() ScalaSerializers.registerSerializers(fory) val original = ConfigV1(&quot;myConfig&quot;) val serialized = fory.serialize(original) val deserialized = fory.deserialize(serialized).asInstanceOf[ConfigV2] // deserialized.name == &quot;myConfig&quot; // deserialized.settings == Map(&quot;default&quot; -&gt; &quot;value&quot;) // deserialized.tags == List(&quot;default&quot;) // deserialized.enabled == true   ","version":"dev","tagName":"h3"},{"title":"Nested Case Classes‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/next/guide/scala/default_values#nested-case-classes","content":" object Models { // Class WITHOUT default values (for serialization) case class PersonV1(name: String) // Classes WITH default values (for deserialization) case class Address(street: String, city: String = &quot;DefaultCity&quot;) case class PersonV2(name: String, address: Address = Address(&quot;DefaultStreet&quot;)) } val fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .withScalaOptimizationEnabled(true) .build() ScalaSerializers.registerSerializers(fory) val original = Models.PersonV1(&quot;Alice&quot;) val serialized = fory.serialize(original) val deserialized = fory.deserialize(serialized).asInstanceOf[Models.PersonV2] // deserialized.name == &quot;Alice&quot; // deserialized.address == Address(&quot;DefaultStreet&quot;, &quot;DefaultCity&quot;)   ","version":"dev","tagName":"h3"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/next/guide/scala/default_values#related-topics","content":" Schema Evolution - Forward/backward compatibility in JavaFory Creation - Setting up Fory with compatible mode ","version":"dev","tagName":"h2"},{"title":"Fory Creation","type":0,"sectionRef":"#","url":"/docs/next/guide/scala/fory_creation","content":"","keywords":"","version":"dev"},{"title":"Basic Setup‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/next/guide/scala/fory_creation#basic-setup","content":" When using Fory for Scala serialization, you must:  Enable Scala optimization via withScalaOptimizationEnabled(true)Register Scala serializers via ScalaSerializers.registerSerializers(fory)  import org.apache.fory.Fory import org.apache.fory.serializer.scala.ScalaSerializers val fory = Fory.builder() .withScalaOptimizationEnabled(true) .build() // Register optimized Fory serializers for Scala ScalaSerializers.registerSerializers(fory)   ","version":"dev","tagName":"h2"},{"title":"Registering Scala Internal Types‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/next/guide/scala/fory_creation#registering-scala-internal-types","content":" Depending on the object types you serialize, you may need to register some Scala internal types:  fory.register(Class.forName(&quot;scala.Enumeration.Val&quot;))   To avoid such registration, you can disable class registration:  val fory = Fory.builder() .withScalaOptimizationEnabled(true) .requireClassRegistration(false) .build()   Note: Disabling class registration allows deserialization of unknown types. This is more flexible but may be insecure if the classes contain malicious code.  ","version":"dev","tagName":"h2"},{"title":"Reference Tracking‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/next/guide/scala/fory_creation#reference-tracking","content":" Circular references are common in Scala. Reference tracking should be enabled with withRefTracking(true):  val fory = Fory.builder() .withScalaOptimizationEnabled(true) .withRefTracking(true) .build()   Note: If you don't enable reference tracking, StackOverflowError may occur for some Scala versions when serializing Scala Enumeration.  ","version":"dev","tagName":"h2"},{"title":"Thread Safety‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/next/guide/scala/fory_creation#thread-safety","content":" Fory instance creation is not cheap. Instances should be shared between multiple serializations.  ","version":"dev","tagName":"h2"},{"title":"Single-Thread Usage‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/next/guide/scala/fory_creation#single-thread-usage","content":" import org.apache.fory.Fory import org.apache.fory.serializer.scala.ScalaSerializers object ForyHolder { val fory: Fory = { val f = Fory.builder() .withScalaOptimizationEnabled(true) .build() ScalaSerializers.registerSerializers(f) f } }   ","version":"dev","tagName":"h3"},{"title":"Multi-Thread Usage‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/next/guide/scala/fory_creation#multi-thread-usage","content":" For multi-threaded applications, use ThreadSafeFory:  import org.apache.fory.ThreadSafeFory import org.apache.fory.ThreadLocalFory import org.apache.fory.serializer.scala.ScalaSerializers object ForyHolder { val fory: ThreadSafeFory = new ThreadLocalFory(classLoader =&gt; { val f = Fory.builder() .withScalaOptimizationEnabled(true) .withClassLoader(classLoader) .build() ScalaSerializers.registerSerializers(f) f }) }   ","version":"dev","tagName":"h3"},{"title":"Configuration Options‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/next/guide/scala/fory_creation#configuration-options","content":" All configuration options from Fory Java are available. See Java Configuration Options for the complete list.  Common options for Scala:  import org.apache.fory.Fory import org.apache.fory.config.CompatibleMode import org.apache.fory.serializer.scala.ScalaSerializers val fory = Fory.builder() .withScalaOptimizationEnabled(true) // Enable reference tracking for circular references .withRefTracking(true) // Enable schema evolution support .withCompatibleMode(CompatibleMode.COMPATIBLE) // Enable async compilation for better startup performance .withAsyncCompilation(true) .build() ScalaSerializers.registerSerializers(fory)  ","version":"dev","tagName":"h2"},{"title":"Swift Serialization Guide","type":0,"sectionRef":"#","url":"/docs/next/guide/swift/","content":"","keywords":"","version":"dev"},{"title":"Why Fory Swift?‚Äã","type":1,"pageTitle":"Swift Serialization Guide","url":"/docs/next/guide/swift/#why-fory-swift","content":" Fast binary serialization for Swift value and reference types@ForyObject macro for zero-boilerplate model serializationCross-language protocol compatibility (xlang) with Java, Rust, Go, Python, and moreCompatible mode for schema evolution across versionsBuilt-in support for dynamic values (Any, AnyObject, any Serializer, AnyHashable)Reference tracking for shared/circular graphs, including weak references on classes  ","version":"dev","tagName":"h2"},{"title":"Install‚Äã","type":1,"pageTitle":"Swift Serialization Guide","url":"/docs/next/guide/swift/#install","content":" Add Fory Swift from the Apache Fory GitHub repository:  dependencies: [ .package(url: &quot;https://github.com/apache/fory.git&quot;, exact: &quot;$version&quot;) ], targets: [ .target( name: &quot;MyApp&quot;, dependencies: [ .product(name: &quot;Fory&quot;, package: &quot;fory&quot;) ] ) ]   ","version":"dev","tagName":"h2"},{"title":"Guide Contents‚Äã","type":1,"pageTitle":"Swift Serialization Guide","url":"/docs/next/guide/swift/#guide-contents","content":" ConfigurationBasic SerializationType RegistrationCustom SerializersField ConfigurationShared and Circular ReferencesPolymorphism and Dynamic TypesSchema EvolutionCross-Language SerializationRow Format StatusTroubleshooting  ","version":"dev","tagName":"h2"},{"title":"Quick Example‚Äã","type":1,"pageTitle":"Swift Serialization Guide","url":"/docs/next/guide/swift/#quick-example","content":" import Fory @ForyObject struct User: Equatable { var name: String = &quot;&quot; var age: Int32 = 0 } let fory = Fory() fory.register(User.self, id: 1) let input = User(name: &quot;alice&quot;, age: 30) let data = try fory.serialize(input) let output: User = try fory.deserialize(data) assert(input == output)  ","version":"dev","tagName":"h2"},{"title":"Type Serialization","type":0,"sectionRef":"#","url":"/docs/next/guide/scala/type_serialization","content":"","keywords":"","version":"dev"},{"title":"Setup‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/scala/type_serialization#setup","content":" All examples assume the following setup:  import org.apache.fory.Fory import org.apache.fory.serializer.scala.ScalaSerializers val fory = Fory.builder() .withScalaOptimizationEnabled(true) .build() ScalaSerializers.registerSerializers(fory)   ","version":"dev","tagName":"h2"},{"title":"Case Class‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/scala/type_serialization#case-class","content":" case class Person(github: String, age: Int, id: Long) fory.register(classOf[Person]) val p = Person(&quot;https://github.com/chaokunyang&quot;, 18, 1) println(fory.deserialize(fory.serialize(p)))   ","version":"dev","tagName":"h2"},{"title":"POJO Class‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/scala/type_serialization#pojo-class","content":" class Foo(f1: Int, f2: String) { override def toString: String = s&quot;Foo($f1, $f2)&quot; } fory.register(classOf[Foo]) println(fory.deserialize(fory.serialize(new Foo(1, &quot;chaokunyang&quot;))))   ","version":"dev","tagName":"h2"},{"title":"Object Singleton‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/scala/type_serialization#object-singleton","content":" Scala object singletons are serialized and deserialized to the same instance:  object MySingleton { val value = 42 } fory.register(MySingleton.getClass) val o1 = fory.deserialize(fory.serialize(MySingleton)) val o2 = fory.deserialize(fory.serialize(MySingleton)) println(o1 == o2) // true   ","version":"dev","tagName":"h2"},{"title":"Collection‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/scala/type_serialization#collection","content":" Scala collections are fully supported:  val seq = Seq(1, 2) val list = List(&quot;a&quot;, &quot;b&quot;) val map = Map(&quot;a&quot; -&gt; 1, &quot;b&quot; -&gt; 2) println(fory.deserialize(fory.serialize(seq))) println(fory.deserialize(fory.serialize(list))) println(fory.deserialize(fory.serialize(map)))   ","version":"dev","tagName":"h2"},{"title":"Tuple‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/scala/type_serialization#tuple","content":" All Scala tuple types (Tuple1 through Tuple22) are supported:  val tuple2 = (100, 10000L) println(fory.deserialize(fory.serialize(tuple2))) val tuple4 = (100, 10000L, 10000L, &quot;str&quot;) println(fory.deserialize(fory.serialize(tuple4)))   ","version":"dev","tagName":"h2"},{"title":"Enum‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/scala/type_serialization#enum","content":" ","version":"dev","tagName":"h2"},{"title":"Scala 3 Enum‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/scala/type_serialization#scala-3-enum","content":" enum Color { case Red, Green, Blue } fory.register(classOf[Color]) println(fory.deserialize(fory.serialize(Color.Green)))   ","version":"dev","tagName":"h3"},{"title":"Scala 2 Enumeration‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/scala/type_serialization#scala-2-enumeration","content":" object ColorEnum extends Enumeration { type ColorEnum = Value val Red, Green, Blue = Value } fory.register(Class.forName(&quot;scala.Enumeration.Val&quot;)) println(fory.deserialize(fory.serialize(ColorEnum.Green)))   Note: For Scala 2 Enumeration, you may need to register scala.Enumeration.Val or enable reference tracking to avoid StackOverflowError.  ","version":"dev","tagName":"h3"},{"title":"Option‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/scala/type_serialization#option","content":" val some: Option[Long] = Some(100) println(fory.deserialize(fory.serialize(some))) val none: Option[Long] = None println(fory.deserialize(fory.serialize(none)))   ","version":"dev","tagName":"h2"},{"title":"Either‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/scala/type_serialization#either","content":" val right: Either[String, Int] = Right(42) println(fory.deserialize(fory.serialize(right))) val left: Either[String, Int] = Left(&quot;error&quot;) println(fory.deserialize(fory.serialize(left)))   ","version":"dev","tagName":"h2"},{"title":"Nested Types‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/next/guide/scala/type_serialization#nested-types","content":" Complex nested structures are fully supported:  case class Address(street: String, city: String) case class Company(name: String, address: Address) case class Employee(name: String, company: Company, tags: List[String]) fory.register(classOf[Address]) fory.register(classOf[Company]) fory.register(classOf[Employee]) val employee = Employee( &quot;John&quot;, Company(&quot;Acme&quot;, Address(&quot;123 Main St&quot;, &quot;Springfield&quot;)), List(&quot;developer&quot;, &quot;scala&quot;) ) println(fory.deserialize(fory.serialize(employee)))  ","version":"dev","tagName":"h2"},{"title":"GraalVM Guide","type":0,"sectionRef":"#","url":"/docs/next/guide/serialization","content":"","keywords":"","version":"dev"},{"title":"GraalVM Native Image‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/guide/serialization#graalvm-native-image","content":" GraalVM native image compiles Java code into native executables ahead-of-time, resulting in faster startup and lower memory usage. However, native images don't support runtime JIT compilation or reflection without explicit configuration.  Apache Fory‚Ñ¢ works excellently with GraalVM native image by using codegen instead of reflection. All serializer code is generated at build time, eliminating the need for reflection configuration files in most cases.  ","version":"dev","tagName":"h2"},{"title":"How It Works‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/guide/serialization#how-it-works","content":" Fory generates serialization code at GraalVM build time when you:  Create Fory as a static fieldRegister all classes in a static initializerCall fory.ensureSerializersCompiled() to compile serializersConfigure the class to initialize at build time via native-image.properties  The main benefit: You don't need to configure reflection json or serialization json for most serializable classes.  Note: Fory's asyncCompilationEnabled option is automatically disabled for GraalVM native image since runtime JIT is not supported.  ","version":"dev","tagName":"h2"},{"title":"Basic Usage‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/guide/serialization#basic-usage","content":" ","version":"dev","tagName":"h2"},{"title":"Step 1: Create Fory and Register Classes‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/guide/serialization#step-1-create-fory-and-register-classes","content":" import org.apache.fory.Fory; public class Example { // Must be static field static Fory fory; static { fory = Fory.builder().build(); fory.register(MyClass.class); fory.register(AnotherClass.class); // Compile all serializers at build time fory.ensureSerializersCompiled(); } public static void main(String[] args) { byte[] bytes = fory.serialize(new MyClass()); MyClass obj = (MyClass) fory.deserialize(bytes); } }   ","version":"dev","tagName":"h3"},{"title":"Step 2: Configure Build-Time Initialization‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/guide/serialization#step-2-configure-build-time-initialization","content":" Create resources/META-INF/native-image/your-group/your-artifact/native-image.properties:  Args = --initialize-at-build-time=com.example.Example   ","version":"dev","tagName":"h3"},{"title":"ForyGraalVMFeature (Optional)‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/guide/serialization#forygraalvmfeature-optional","content":" For most types with public constructors, the basic setup above is sufficient. However, some advanced cases require reflection registration:  Private constructors (classes without accessible no-arg constructor)Private inner classes/recordsDynamic proxy serialization  The fory-graalvm-feature module automatically handles these cases, eliminating the need for manual reflect-config.json configuration.  ","version":"dev","tagName":"h2"},{"title":"Adding the Dependency‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/guide/serialization#adding-the-dependency","content":" &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-graalvm-feature&lt;/artifactId&gt; &lt;version&gt;${fory.version}&lt;/version&gt; &lt;/dependency&gt;   ","version":"dev","tagName":"h3"},{"title":"Enabling the Feature‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/guide/serialization#enabling-the-feature","content":" Add to your native-image.properties:  Args = --initialize-at-build-time=com.example.Example \\ --features=org.apache.fory.graalvm.feature.ForyGraalVMFeature   ","version":"dev","tagName":"h3"},{"title":"What ForyGraalVMFeature Handles‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/guide/serialization#what-forygraalvmfeature-handles","content":" Scenario\tWithout Feature\tWith FeaturePublic classes with no-arg ctor\t‚úÖ Works\t‚úÖ Works Private constructors\t‚ùå Needs reflect-config.json\t‚úÖ Auto-registered Private inner records\t‚ùå Needs reflect-config.json\t‚úÖ Auto-registered Dynamic proxies\t‚ùå Needs manual config\t‚úÖ Auto-registered  ","version":"dev","tagName":"h3"},{"title":"Example with Private Record‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/guide/serialization#example-with-private-record","content":" public class Example { // Private inner record - requires ForyGraalVMFeature private record PrivateRecord(int id, String name) {} static Fory fory; static { fory = Fory.builder().build(); fory.register(PrivateRecord.class); fory.ensureSerializersCompiled(); } }   ","version":"dev","tagName":"h3"},{"title":"Example with Dynamic Proxy‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/guide/serialization#example-with-dynamic-proxy","content":" import org.apache.fory.util.GraalvmSupport; public class ProxyExample { public interface MyService { String execute(); } static Fory fory; static { fory = Fory.builder().build(); // Register proxy interface for serialization GraalvmSupport.registerProxySupport(MyService.class); fory.ensureSerializersCompiled(); } }   ","version":"dev","tagName":"h3"},{"title":"Thread-Safe Fory‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/guide/serialization#thread-safe-fory","content":" For multi-threaded applications, use ThreadLocalFory:  import org.apache.fory.Fory; import org.apache.fory.ThreadLocalFory; import org.apache.fory.ThreadSafeFory; public class ThreadSafeExample { public record Foo(int f1, String f2, List&lt;String&gt; f3) {} static ThreadSafeFory fory; static { fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().build(); f.register(Foo.class); f.ensureSerializersCompiled(); return f; }); } public static void main(String[] args) { Foo foo = new Foo(10, &quot;abc&quot;, List.of(&quot;str1&quot;, &quot;str2&quot;)); byte[] bytes = fory.serialize(foo); Foo result = (Foo) fory.deserialize(bytes); } }   ","version":"dev","tagName":"h2"},{"title":"Troubleshooting‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/guide/serialization#troubleshooting","content":" ","version":"dev","tagName":"h2"},{"title":"\"Type is instantiated reflectively but was never registered\"‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/guide/serialization#type-is-instantiated-reflectively-but-was-never-registered","content":" If you see this error:  Type com.example.MyClass is instantiated reflectively but was never registered   Solution: Register the class with Fory (don't add to reflect-config.json):  fory.register(MyClass.class); fory.ensureSerializersCompiled();   If the class has a private constructor, either:  Add fory-graalvm-feature dependency, orCreate a reflect-config.json for that specific class  ","version":"dev","tagName":"h3"},{"title":"Framework Integration‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/guide/serialization#framework-integration","content":" For framework developers integrating Fory:  Provide a configuration file for users to list serializable classesLoad those classes and call fory.register(Class&lt;?&gt;) for eachCall fory.ensureSerializersCompiled() after all registrationsConfigure your integration class for build-time initialization  ","version":"dev","tagName":"h2"},{"title":"Benchmark‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/guide/serialization#benchmark","content":" Performance comparison between Fory and GraalVM JDK Serialization:  Type\tCompression\tSpeed\tSizeStruct\tOff\t46x faster\t43% Struct\tOn\t24x faster\t31% Pojo\tOff\t12x faster\t56% Pojo\tOn\t12x faster\t48%  See Benchmark.java for benchmark code.  ","version":"dev","tagName":"h2"},{"title":"Struct Benchmark‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/guide/serialization#struct-benchmark","content":" Class Fields‚Äã  public class Struct implements Serializable { public int f1; public long f2; public float f3; public double f4; public int f5; public long f6; public float f7; public double f8; public int f9; public long f10; public float f11; public double f12; }   Benchmark Results‚Äã  No compression:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Struct Compress number: false Fory size: 76.0 JDK size: 178.0 Fory serialization took mills: 49 JDK serialization took mills: 2254 Compare speed: Fory is 45.70x speed of JDK Compare size: Fory is 0.43x size of JDK   Compress number:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Struct Compress number: true Fory size: 55.0 JDK size: 178.0 Fory serialization took mills: 130 JDK serialization took mills: 3161 Compare speed: Fory is 24.16x speed of JDK Compare size: Fory is 0.31x size of JDK   ","version":"dev","tagName":"h3"},{"title":"Pojo Benchmark‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/next/guide/serialization#pojo-benchmark","content":" Class Fields‚Äã  public class Foo implements Serializable { int f1; String f2; List&lt;String&gt; f3; Map&lt;String, Long&gt; f4; }   Benchmark Results‚Äã  No compression:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Foo Compress number: false Fory size: 541.0 JDK size: 964.0 Fory serialization took mills: 1663 JDK serialization took mills: 16266 Compare speed: Fory is 12.19x speed of JDK Compare size: Fory is 0.56x size of JDK   Compress number:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Foo Compress number: true Fory size: 459.0 JDK size: 964.0 Fory serialization took mills: 1289 JDK serialization took mills: 15069 Compare speed: Fory is 12.11x speed of JDK Compare size: Fory is 0.48x size of JDK  ","version":"dev","tagName":"h3"},{"title":"Cross-Language Serialization","type":0,"sectionRef":"#","url":"/docs/next/guide/swift/cross_language","content":"","keywords":"","version":"dev"},{"title":"Recommended Cross-language Configuration‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/swift/cross_language#recommended-cross-language-configuration","content":" let fory = Fory(xlang: true, trackRef: false, compatible: true)   ","version":"dev","tagName":"h2"},{"title":"Register Types with Shared Identity‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/swift/cross_language#register-types-with-shared-identity","content":" ","version":"dev","tagName":"h2"},{"title":"ID-based registration‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/swift/cross_language#id-based-registration","content":" @ForyObject struct Order { var id: Int64 = 0 var amount: Double = 0 } let fory = Fory(xlang: true, compatible: true) fory.register(Order.self, id: 100)   ","version":"dev","tagName":"h3"},{"title":"Name-based registration‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/swift/cross_language#name-based-registration","content":" try fory.register(Order.self, namespace: &quot;com.example&quot;, name: &quot;Order&quot;)   ","version":"dev","tagName":"h3"},{"title":"Cross-language Rules‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/swift/cross_language#cross-language-rules","content":" Keep type registration mapping consistent across languagesUse compatible mode when independently evolving schemasRegister all user-defined concrete types used by dynamic fields (Any, any Serializer)  ","version":"dev","tagName":"h2"},{"title":"Debugging Cross-language Tests‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/next/guide/swift/cross_language#debugging-cross-language-tests","content":" Enable debug output when running xlang tests:  ENABLE_FORY_DEBUG_OUTPUT=1 FORY_SWIFT_JAVA_CI=1 mvn -T16 test -Dtest=org.apache.fory.xlang.SwiftXlangTest  ","version":"dev","tagName":"h2"},{"title":"Configuration","type":0,"sectionRef":"#","url":"/docs/next/guide/swift/configuration","content":"","keywords":"","version":"dev"},{"title":"ForyConfig‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/swift/configuration#foryconfig","content":" Fory is configured with:  public struct ForyConfig { public var xlang: Bool public var trackRef: Bool public var compatible: Bool }   Default configuration:  let fory = Fory() // xlang=true, trackRef=false, compatible=false   ","version":"dev","tagName":"h2"},{"title":"Options‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/swift/configuration#options","content":" ","version":"dev","tagName":"h2"},{"title":"xlang‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/swift/configuration#xlang","content":" Controls cross-language protocol mode.  true: Use xlang wire format (default)false: Use Swift-native mode  let fory = Fory(xlang: true)   ","version":"dev","tagName":"h3"},{"title":"trackRef‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/swift/configuration#trackref","content":" Enables shared/circular reference tracking for reference-trackable types.  false: No reference table (smaller/faster for acyclic or value-only graphs)true: Preserve object identity for class/reference graphs  let fory = Fory(xlang: true, trackRef: true)   ","version":"dev","tagName":"h3"},{"title":"compatible‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/swift/configuration#compatible","content":" Enables compatible schema mode for evolution across versions.  false: Schema-consistent mode (stricter, lower metadata overhead)true: Compatible mode (supports add/remove/reorder fields)  let fory = Fory(xlang: true, trackRef: false, compatible: true)   ","version":"dev","tagName":"h3"},{"title":"Recommended Presets‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/swift/configuration#recommended-presets","content":" ","version":"dev","tagName":"h2"},{"title":"Local, strict schema‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/swift/configuration#local-strict-schema","content":" let fory = Fory(xlang: false, trackRef: false, compatible: false)   ","version":"dev","tagName":"h3"},{"title":"Cross-language service payloads‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/swift/configuration#cross-language-service-payloads","content":" let fory = Fory(xlang: true, trackRef: false, compatible: true)   ","version":"dev","tagName":"h3"},{"title":"Graph/object identity workloads‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/next/guide/swift/configuration#graphobject-identity-workloads","content":" let fory = Fory(xlang: true, trackRef: true, compatible: true)  ","version":"dev","tagName":"h3"},{"title":"Basic Serialization","type":0,"sectionRef":"#","url":"/docs/next/guide/swift/basic_serialization","content":"","keywords":"","version":"dev"},{"title":"Object Graph Serialization‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/swift/basic_serialization#object-graph-serialization","content":" Use @ForyObject on structs/classes/enums, register types, then serialize and deserialize.  import Foundation import Fory @ForyObject struct Address: Equatable { var street: String = &quot;&quot; var zip: Int32 = 0 } @ForyObject struct Person: Equatable { var id: Int64 = 0 var name: String = &quot;&quot; var nickname: String? = nil var tags: Set&lt;String&gt; = [] var scores: [Int32] = [] var addresses: [Address] = [] var metadata: [Int8: Int32?] = [:] } let fory = Fory() fory.register(Address.self, id: 100) fory.register(Person.self, id: 101) let person = Person( id: 42, name: &quot;Alice&quot;, nickname: nil, tags: [&quot;swift&quot;, &quot;xlang&quot;], scores: [10, 20, 30], addresses: [Address(street: &quot;Main&quot;, zip: 94107)], metadata: [1: 100, 2: nil] ) let data = try fory.serialize(person) let decoded: Person = try fory.deserialize(data) assert(decoded == person)   ","version":"dev","tagName":"h2"},{"title":"Working with Existing Buffers‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/swift/basic_serialization#working-with-existing-buffers","content":" Append serialized bytes to an existing Data and deserialize from ByteBuffer.  var output = Data() try fory.serialize(person, to: &amp;output) let inputBuffer = ByteBuffer(data: output) let fromBuffer: Person = try fory.deserialize(from: inputBuffer) assert(fromBuffer == person)   ","version":"dev","tagName":"h2"},{"title":"Built-in Supported Types‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/swift/basic_serialization#built-in-supported-types","content":" ","version":"dev","tagName":"h2"},{"title":"Primitive and scalar‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/swift/basic_serialization#primitive-and-scalar","content":" BoolInt8, Int16, Int32, Int64, IntUInt8, UInt16, UInt32, UInt64, UIntFloat, DoubleStringData  ","version":"dev","tagName":"h3"},{"title":"Date and time‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/swift/basic_serialization#date-and-time","content":" DateForyDateForyTimestamp  ","version":"dev","tagName":"h3"},{"title":"Collections‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/swift/basic_serialization#collections","content":" [T] where T: SerializerSet&lt;T&gt; where T: Serializer &amp; Hashable[K: V] where K: Serializer &amp; Hashable, V: SerializerOptional variants (T?)  ","version":"dev","tagName":"h3"},{"title":"Dynamic‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/next/guide/swift/basic_serialization#dynamic","content":" AnyAnyObjectany SerializerAnyHashable[Any][String: Any][Int32: Any][AnyHashable: Any] ","version":"dev","tagName":"h3"},{"title":"Field Configuration","type":0,"sectionRef":"#","url":"/docs/next/guide/swift/field_configuration","content":"","keywords":"","version":"dev"},{"title":"Available Macro Attributes‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/swift/field_configuration#available-macro-attributes","content":" @ForyObject on struct/class/enum@ForyField(encoding: ...) on numeric fields  ","version":"dev","tagName":"h2"},{"title":"@ForyField(encoding:)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/swift/field_configuration#foryfieldencoding","content":" Use @ForyField to override integer encoding strategy.  @ForyObject struct Metrics: Equatable { @ForyField(encoding: .fixed) var u32Fixed: UInt32 = 0 @ForyField(encoding: .tagged) var u64Tagged: UInt64 = 0 }   ","version":"dev","tagName":"h2"},{"title":"Supported combinations‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/swift/field_configuration#supported-combinations","content":" Swift type\tSupported encoding values\tDefault encodingInt32\t.varint, .fixed\t.varint UInt32\t.varint, .fixed\t.varint Int64\t.varint, .fixed, .tagged\t.varint UInt64\t.varint, .fixed, .tagged\t.varint Int\t.varint, .fixed, .tagged\t.varint UInt\t.varint, .fixed, .tagged\t.varint  Compile-time validation rejects unsupported combinations (for example, Int32 with .tagged).  ","version":"dev","tagName":"h3"},{"title":"@ForyObject Requirements‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/swift/field_configuration#foryobject-requirements","content":" ","version":"dev","tagName":"h2"},{"title":"Struct and class fields‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/swift/field_configuration#struct-and-class-fields","content":" Stored properties must declare explicit typesComputed properties are ignoredStatic/class properties are ignored  ","version":"dev","tagName":"h3"},{"title":"Class requirement‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/swift/field_configuration#class-requirement","content":" Classes annotated with @ForyObject must provide a required init() for default construction.  @ForyObject final class Node { var value: Int32 = 0 var next: Node? = nil required init() {} }   ","version":"dev","tagName":"h3"},{"title":"Dynamic Any Fields in Macro Types‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/next/guide/swift/field_configuration#dynamic-any-fields-in-macro-types","content":" @ForyObject supports dynamic fields and nested containers:  Any, AnyObject, any SerializerAnyHashable[Any][String: Any][Int32: Any][AnyHashable: Any]  Current limitations:  Dictionary&lt;K, Any&gt; is only supported when K is String, Int32, or AnyHashable ","version":"dev","tagName":"h2"},{"title":"Custom Serializers","type":0,"sectionRef":"#","url":"/docs/next/guide/swift/custom_serializers","content":"","keywords":"","version":"dev"},{"title":"When to Use Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/swift/custom_serializers#when-to-use-custom-serializers","content":" External types with strict wire compatibility requirementsSpecialized compact encodingsLegacy payload migration pathsHighly tuned hot-path serialization  ","version":"dev","tagName":"h2"},{"title":"Implementing Serializer‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/swift/custom_serializers#implementing-serializer","content":" import Foundation import Fory struct UUIDBox: Serializer, Equatable { var value: UUID = UUID(uuidString: &quot;00000000-0000-0000-0000-000000000000&quot;)! static func foryDefault() -&gt; UUIDBox { UUIDBox() } static var staticTypeId: ForyTypeId { .ext } func foryWriteData(_ context: WriteContext, hasGenerics: Bool) throws { _ = hasGenerics try value.uuidString.foryWriteData(context, hasGenerics: false) } static func foryReadData(_ context: ReadContext) throws -&gt; UUIDBox { let raw = try String.foryReadData(context) guard let uuid = UUID(uuidString: raw) else { throw ForyError.invalidData(&quot;invalid UUID string: \\(raw)&quot;) } return UUIDBox(value: uuid) } }   ","version":"dev","tagName":"h2"},{"title":"Register and Use‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/swift/custom_serializers#register-and-use","content":" let fory = Fory() fory.register(UUIDBox.self, id: 300) let input = UUIDBox(value: UUID()) let data = try fory.serialize(input) let output: UUIDBox = try fory.deserialize(data) assert(input == output)   ","version":"dev","tagName":"h2"},{"title":"Choosing staticTypeId‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/next/guide/swift/custom_serializers#choosing-statictypeid","content":" For manually implemented custom types, use staticTypeId that matches the wire kind you are implementing.  Typical choices:  .structType: regular structured object.enumType / .typedUnion: enum-like values.ext: extension/custom kind ","version":"dev","tagName":"h2"},{"title":"Polymorphism and Dynamic Types","type":0,"sectionRef":"#","url":"/docs/next/guide/swift/polymorphism","content":"","keywords":"","version":"dev"},{"title":"Top-level Dynamic APIs‚Äã","type":1,"pageTitle":"Polymorphism and Dynamic Types","url":"/docs/next/guide/swift/polymorphism#top-level-dynamic-apis","content":" let fory = Fory() let dynamic: Any = Int32(7) let data = try fory.serialize(dynamic) let decoded: Any = try fory.deserialize(data)   Equivalent overloads exist for:  AnyObjectany SerializerAnyHashable[Any][String: Any][Int32: Any][AnyHashable: Any]  ","version":"dev","tagName":"h2"},{"title":"Dynamic Fields in @ForyObject Types‚Äã","type":1,"pageTitle":"Polymorphism and Dynamic Types","url":"/docs/next/guide/swift/polymorphism#dynamic-fields-in-foryobject-types","content":" @ForyObject struct DynamicHolder { var value: Any = ForyAnyNullValue() var list: [Any] = [] var byName: [String: Any] = [:] var byId: [Int32: Any] = [:] var byDynamicKey: [AnyHashable: Any] = [:] }   ","version":"dev","tagName":"h2"},{"title":"Concrete Type Registration Still Applies‚Äã","type":1,"pageTitle":"Polymorphism and Dynamic Types","url":"/docs/next/guide/swift/polymorphism#concrete-type-registration-still-applies","content":" If dynamic values contain user-defined runtime types, register those concrete types.  @ForyObject struct Address { var street: String = &quot;&quot; var zip: Int32 = 0 } let fory = Fory() fory.register(Address.self, id: 100)   ","version":"dev","tagName":"h2"},{"title":"Null Semantics‚Äã","type":1,"pageTitle":"Polymorphism and Dynamic Types","url":"/docs/next/guide/swift/polymorphism#null-semantics","content":" Any null representation: ForyAnyNullValueAnyObject null representation: NSNullOptional dynamic values map to the corresponding null representation on decode  ","version":"dev","tagName":"h2"},{"title":"Current Limitations‚Äã","type":1,"pageTitle":"Polymorphism and Dynamic Types","url":"/docs/next/guide/swift/polymorphism#current-limitations","content":" AnyHashable keys must wrap runtime values that are both Hashable and supported by Fory dynamic serialization ","version":"dev","tagName":"h2"},{"title":"Row Format","type":0,"sectionRef":"#","url":"/docs/next/guide/swift/row_format","content":"","keywords":"","version":"dev"},{"title":"Current Status‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/swift/row_format#current-status","content":" Object graph serialization: supportedCross-language xlang object protocol: supportedSwift row-format APIs: not exposed yet  ","version":"dev","tagName":"h2"},{"title":"Recommended Approach Today‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/swift/row_format#recommended-approach-today","content":" Use object serialization for application payloadsUse compatible mode for schema evolution across service versionsUse xlang mode for interoperability with other Fory runtimes  ","version":"dev","tagName":"h2"},{"title":"Future Direction‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/swift/row_format#future-direction","content":" Row-format support in Swift can be added without changing existing object serialization APIs. Until then, treat row-format features as unavailable in Swift runtime code. ","version":"dev","tagName":"h2"},{"title":"Shared and Circular References","type":0,"sectionRef":"#","url":"/docs/next/guide/swift/references","content":"","keywords":"","version":"dev"},{"title":"Enable Reference Tracking‚Äã","type":1,"pageTitle":"Shared and Circular References","url":"/docs/next/guide/swift/references#enable-reference-tracking","content":" let fory = Fory(xlang: true, trackRef: true, compatible: false)   When enabled, reference-trackable types preserve identity and cycles.  ","version":"dev","tagName":"h2"},{"title":"Shared Reference Example‚Äã","type":1,"pageTitle":"Shared and Circular References","url":"/docs/next/guide/swift/references#shared-reference-example","content":" import Fory @ForyObject final class Animal { var name: String = &quot;&quot; required init() {} init(name: String) { self.name = name } } @ForyObject final class AnimalPair { var first: Animal? = nil var second: Animal? = nil required init() {} init(first: Animal? = nil, second: Animal? = nil) { self.first = first self.second = second } } let fory = Fory(xlang: true, trackRef: true) fory.register(Animal.self, id: 200) fory.register(AnimalPair.self, id: 201) let shared = Animal(name: &quot;cat&quot;) let input = AnimalPair(first: shared, second: shared) let data = try fory.serialize(input) let decoded: AnimalPair = try fory.deserialize(data) assert(decoded.first === decoded.second)   ","version":"dev","tagName":"h2"},{"title":"Circular Reference Example (Use weak)‚Äã","type":1,"pageTitle":"Shared and Circular References","url":"/docs/next/guide/swift/references#circular-reference-example-use-weak","content":" trackRef preserves the reference graph, but it does not change ARC ownership. Use weak on at least one edge in a cycle to avoid leaks.  import Fory @ForyObject final class Node { var value: Int32 = 0 weak var next: Node? = nil required init() {} init(value: Int32, next: Node? = nil) { self.value = value self.next = next } } let fory = Fory(xlang: true, trackRef: true) fory.register(Node.self, id: 300) let node = Node(value: 7) node.next = node let data = try fory.serialize(node) let decoded: Node = try fory.deserialize(data) assert(decoded.next === decoded)   ","version":"dev","tagName":"h2"},{"title":"Notes‚Äã","type":1,"pageTitle":"Shared and Circular References","url":"/docs/next/guide/swift/references#notes","content":" Value types (struct, primitive values) do not carry identity semanticstrackRef controls serialization graph identity, not ARC memory ownershipUse trackRef=false for purely value-based payloads to reduce overhead ","version":"dev","tagName":"h2"},{"title":"Schema Evolution","type":0,"sectionRef":"#","url":"/docs/next/guide/swift/schema_evolution","content":"","keywords":"","version":"dev"},{"title":"Enable Compatible Mode‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/swift/schema_evolution#enable-compatible-mode","content":" let fory = Fory(xlang: true, trackRef: false, compatible: true)   ","version":"dev","tagName":"h2"},{"title":"Example: Evolving a Struct‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/swift/schema_evolution#example-evolving-a-struct","content":" import Fory @ForyObject struct PersonV1 { var name: String = &quot;&quot; var age: Int32 = 0 var address: String = &quot;&quot; } @ForyObject struct PersonV2 { var name: String = &quot;&quot; var age: Int32 = 0 var phone: String? = nil // added field } let writer = Fory(xlang: true, compatible: true) writer.register(PersonV1.self, id: 1) let reader = Fory(xlang: true, compatible: true) reader.register(PersonV2.self, id: 1) let v1 = PersonV1(name: &quot;alice&quot;, age: 30, address: &quot;main st&quot;) let bytes = try writer.serialize(v1) let v2: PersonV2 = try reader.deserialize(bytes) assert(v2.name == &quot;alice&quot;) assert(v2.age == 30) assert(v2.phone == nil)   ","version":"dev","tagName":"h2"},{"title":"What Is Safe in Compatible Mode‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/swift/schema_evolution#what-is-safe-in-compatible-mode","content":" Add new fieldsRemove old fieldsReorder fields  ","version":"dev","tagName":"h2"},{"title":"What Is Not Safe‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/swift/schema_evolution#what-is-not-safe","content":" Arbitrary type changes for an existing field (for example Int32 to String)Inconsistent registration mapping across peers  ","version":"dev","tagName":"h2"},{"title":"Schema-consistent Mode Behavior‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/next/guide/swift/schema_evolution#schema-consistent-mode-behavior","content":" With compatible=false, Fory validates schema hash and fails fast on mismatch. ","version":"dev","tagName":"h2"},{"title":"Type Registration","type":0,"sectionRef":"#","url":"/docs/next/guide/swift/type_registration","content":"","keywords":"","version":"dev"},{"title":"Why Registration Is Required‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/swift/type_registration#why-registration-is-required","content":" User types (struct, class, enum/union, ext types) must be registered before serialization/deserialization.  If a type is missing, deserialization fails with:  Type not registered: ...  ","version":"dev","tagName":"h2"},{"title":"Register by Numeric ID‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/swift/type_registration#register-by-numeric-id","content":" Use a stable ID shared by serializer and deserializer peers.  @ForyObject struct User { var name: String = &quot;&quot; var age: Int32 = 0 } let fory = Fory() fory.register(User.self, id: 1)   ","version":"dev","tagName":"h2"},{"title":"Register by Name‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/swift/type_registration#register-by-name","content":" ","version":"dev","tagName":"h2"},{"title":"Fully-qualified name‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/swift/type_registration#fully-qualified-name","content":" try fory.register(User.self, name: &quot;com.example.User&quot;)   name is split by .:  namespace: com.exampletype name: User  ","version":"dev","tagName":"h3"},{"title":"Explicit namespace + name‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/swift/type_registration#explicit-namespace--name","content":" try fory.register(User.self, namespace: &quot;com.example&quot;, name: &quot;User&quot;)   ","version":"dev","tagName":"h3"},{"title":"Consistency Rules‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/swift/type_registration#consistency-rules","content":" Keep registration mapping consistent across peers:  ID mode: same type uses same numeric ID on all peersName mode: same type uses same namespace and type name on all peersDo not mix ID and name mapping for the same logical type across services  ","version":"dev","tagName":"h2"},{"title":"Dynamic Types and Registration‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/next/guide/swift/type_registration#dynamic-types-and-registration","content":" When serializing dynamic values (Any, AnyObject, any Serializer) that contain user-defined types, the concrete runtime types must still be registered. ","version":"dev","tagName":"h2"},{"title":"Troubleshooting","type":0,"sectionRef":"#","url":"/docs/next/guide/swift/troubleshooting","content":"","keywords":"","version":"dev"},{"title":"Common Runtime Errors‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/swift/troubleshooting#common-runtime-errors","content":" ","version":"dev","tagName":"h2"},{"title":"Type not registered: ...‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/swift/troubleshooting#type-not-registered-","content":" Cause: user type was not registered on the current Fory instance.  Fix:  fory.register(MyType.self, id: 100)   ","version":"dev","tagName":"h3"},{"title":"Type mismatch: expected ..., got ...‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/swift/troubleshooting#type-mismatch-expected--got-","content":" Cause: registration mapping or field type info differs across peers.  Fix:  Ensure both sides register the same type ID/name mappingVerify field type compatibility  ","version":"dev","tagName":"h3"},{"title":"Invalid data: xlang bitmap mismatch‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/swift/troubleshooting#invalid-data-xlang-bitmap-mismatch","content":" Cause: serializer and deserializer use different xlang settings.  Fix: configure both sides with matching xlang mode.  ","version":"dev","tagName":"h3"},{"title":"Invalid data: class version hash mismatch‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/swift/troubleshooting#invalid-data-class-version-hash-mismatch","content":" Cause: schema changed while compatible=false.  Fix:  Enable compatible mode for evolving schemasOr keep strict schema parity with schema-consistent mode  ","version":"dev","tagName":"h3"},{"title":"Common Macro-time Errors‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/swift/troubleshooting#common-macro-time-errors","content":" ","version":"dev","tagName":"h2"},{"title":"@ForyObject requires explicit types for stored properties‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/swift/troubleshooting#foryobject-requires-explicit-types-for-stored-properties","content":" Add explicit type annotations to stored properties.  ","version":"dev","tagName":"h3"},{"title":"@ForyObject enum associated values cannot have default values‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/swift/troubleshooting#foryobject-enum-associated-values-cannot-have-default-values","content":" Remove default values from enum case associated values.  ","version":"dev","tagName":"h3"},{"title":"Set<...> with Any elements is not supported by @ForyObject yet‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/swift/troubleshooting#set-with-any-elements-is-not-supported-by-foryobject-yet","content":" Use [Any] or a typed set instead.  ","version":"dev","tagName":"h3"},{"title":"Dictionary<..., ...> with Any values is only supported for String, Int32, or AnyHashable keys‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/swift/troubleshooting#dictionary--with-any-values-is-only-supported-for-string-int32-or-anyhashable-keys","content":" Switch key type to String, Int32, or AnyHashable, or avoid dynamic Any map values.  ","version":"dev","tagName":"h3"},{"title":"Debugging Commands‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/swift/troubleshooting#debugging-commands","content":" Run Swift tests:  cd swift ENABLE_FORY_DEBUG_OUTPUT=1 swift test   Run Java-driven Swift xlang tests:  cd java/fory-core ENABLE_FORY_DEBUG_OUTPUT=1 FORY_SWIFT_JAVA_CI=1 mvn -T16 test -Dtest=org.apache.fory.xlang.SwiftXlangTest  ","version":"dev","tagName":"h2"},{"title":"Cross-Language Serialization Guide","type":0,"sectionRef":"#","url":"/docs/next/guide/xlang/","content":"","keywords":"","version":"dev"},{"title":"Features‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/next/guide/xlang/#features","content":" No IDL Required: Serialize objects directly with native language typesMulti-Language Support: Java, Python, C++, Go, Rust, JavaScript all interoperate seamlesslyReference Support: Shared and circular references work across language boundariesSchema Evolution: Forward/backward compatibility when class definitions changeZero-Copy: Out-of-band serialization for large binary dataHigh Performance: JIT compilation and optimized binary protocol  ","version":"dev","tagName":"h2"},{"title":"Supported Languages‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/next/guide/xlang/#supported-languages","content":" Language\tStatus\tPackageJava\t‚úÖ\torg.apache.fory:fory-core Python\t‚úÖ\tpyfory C++\t‚úÖ\tBazel/CMake build Go\t‚úÖ\tgithub.com/apache/fory/go/fory Rust\t‚úÖ\tfory crate JavaScript\t‚úÖ\t@apache-fory/fory  ","version":"dev","tagName":"h2"},{"title":"When to Use Xlang Mode‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/next/guide/xlang/#when-to-use-xlang-mode","content":" Use xlang mode when:  Building multi-language microservicesCreating polyglot data pipelinesSharing data between frontend (JavaScript) and backend (Java/Python/Go)  Use language-native mode when:  All serialization/deserialization happens in the same languageMaximum performance is required (native mode is faster)You need language-specific features (Python pickle compatibility, Java serialization hooks)  ","version":"dev","tagName":"h2"},{"title":"Quick Example‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/next/guide/xlang/#quick-example","content":" ","version":"dev","tagName":"h2"},{"title":"Java (Producer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/next/guide/xlang/#java-producer","content":" import org.apache.fory.*; import org.apache.fory.config.*; public class Person { public String name; public int age; } Fory fory = Fory.builder() .withLanguage(Language.XLANG) .build(); fory.register(Person.class, &quot;example.Person&quot;); Person person = new Person(); person.name = &quot;Alice&quot;; person.age = 30; byte[] bytes = fory.serialize(person); // Send bytes to Python, Go, Rust, etc.   ","version":"dev","tagName":"h3"},{"title":"Python (Consumer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/next/guide/xlang/#python-consumer","content":" import pyfory from dataclasses import dataclass @dataclass class Person: name: str age: pyfory.Int32Type fory = pyfory.Fory(xlang=True) fory.register_type(Person, typename=&quot;example.Person&quot;) # Receive bytes from Java person = fory.deserialize(bytes_from_java) print(f&quot;{person.name}, {person.age}&quot;) # Alice, 30   ","version":"dev","tagName":"h3"},{"title":"Fory IDL‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/next/guide/xlang/#fory-idl","content":" For schema-first projects, Fory also provides Fory IDL and code generation.  Compiler docs: Fory IDL OverviewBest for large multi-language message contracts and long-lived schemas  ","version":"dev","tagName":"h2"},{"title":"Minimal IDL Example‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/next/guide/xlang/#minimal-idl-example","content":" Create person.fdl:  package example; message Person { string name = 1; int32 age = 2; optional string email = 3; }   Generate code:  foryc person.fdl --lang java,python,go,rust,cpp --output ./generated   This generates native language types with consistent field/type mappings across all targets.  ","version":"dev","tagName":"h3"},{"title":"When to Fory IDL‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/next/guide/xlang/#when-to-fory-idl","content":" Option\tUse When\tWhyNative xlang types (no IDL)\tYou only have a few message types and want to move quickly\tAvoids the integration/setup cost of introducing and operating the compiler Fory IDL (schema-first + codegen)\tYou have many messages across multiple languages/teams/services\tProvides a single contract, stronger consistency, and easier long-term evolution Hybrid (start native, move to IDL)\tProject starts small but message count and cross-team dependency grows\tLets you keep early velocity, then standardize once schema complexity increases  ","version":"dev","tagName":"h2"},{"title":"Documentation‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/next/guide/xlang/#documentation","content":" Topic\tDescriptionGetting Started\tInstallation and basic setup for all languages Type Mapping\tCross-language type mapping reference Serialization\tBuilt-in types, custom types, reference handling Zero-Copy\tOut-of-band serialization for large data Row Format\tCache-friendly binary format with random access Troubleshooting\tCommon issues and solutions  ","version":"dev","tagName":"h2"},{"title":"Language-Specific Guides‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/next/guide/xlang/#language-specific-guides","content":" For language-specific details and API reference:  Java Cross-Language GuidePython Cross-Language GuideC++ Cross-Language GuideRust Cross-Language Guide  ","version":"dev","tagName":"h2"},{"title":"Specifications‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/next/guide/xlang/#specifications","content":" Xlang Serialization Specification - Binary protocol detailsType Mapping Specification - Complete type mapping reference ","version":"dev","tagName":"h2"},{"title":"Field Nullability","type":0,"sectionRef":"#","url":"/docs/next/guide/xlang/field_nullability","content":"","keywords":"","version":"dev"},{"title":"Default Behavior‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/next/guide/xlang/field_nullability#default-behavior","content":" In xlang mode, fields are non-nullable by default. This means:  Values must always be present (non-null)No null flag byte is written for the fieldSerialization is more compact  The following types are nullable by default:  Optional&lt;T&gt; (Java, C++)Java boxed types (Integer, Long, Double, etc.)Go pointer types (*int32, *string, etc.)Rust Option&lt;T&gt;Python Optional[T]  Field Type\tDefault Nullable\tNull Flag WrittenPrimitives (int, bool, float, etc.)\tNo\tNo String\tNo\tNo List&lt;T&gt;, Map&lt;K,V&gt;, Set&lt;T&gt;\tNo\tNo Custom structs\tNo\tNo Enums\tNo\tNo Java boxed types (Integer, Long, etc.)\tYes\tYes Go pointer types (*int32, *string)\tYes\tYes Optional&lt;T&gt; / Option&lt;T&gt;\tYes\tYes  ","version":"dev","tagName":"h2"},{"title":"Wire Format‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/next/guide/xlang/field_nullability#wire-format","content":" The nullable flag controls whether a null flag byte is written before the field value:  Non-nullable field: [value data] Nullable field: [null_flag] [value data if not null]   Where null_flag is:  -1 (NULL_FLAG): Value is null-2 (NOT_NULL_VALUE_FLAG): Value is present  ","version":"dev","tagName":"h2"},{"title":"Nullable vs Reference Tracking‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/next/guide/xlang/field_nullability#nullable-vs-reference-tracking","content":" These are related but distinct concepts:  Concept\tPurpose\tFlag ValuesNullable\tAllow null values for a field\t-1 (null), -2 (not null) Reference Tracking\tDeduplicate shared object references\t-1 (null), -2 (not null), ‚â•0 (ref ID)  Key differences:  Nullable only: Writes -1 or -2 flag, no reference deduplicationReference tracking: Extends nullable semantics with reference IDs (‚â•0) for previously seen objectsBoth use the same flag byte position‚Äîref tracking is a superset of nullable  When refTracking=true, the null flag byte doubles as a ref flag:  ref_flag = -1 ‚Üí null value ref_flag = -2 ‚Üí new object (first occurrence) ref_flag &gt;= 0 ‚Üí reference to object at index ref_flag   For detailed reference tracking behavior, see Reference Tracking.  ","version":"dev","tagName":"h2"},{"title":"Language-Specific Examples‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/next/guide/xlang/field_nullability#language-specific-examples","content":" ","version":"dev","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/next/guide/xlang/field_nullability#java","content":" public class Person { // Non-nullable by default in xlang mode String name; // Must not be null int age; // Primitive, always non-nullable List&lt;String&gt; tags; // Must not be null // Explicitly nullable @ForyField(nullable = true) String nickname; // Can be null // Optional wrapper - nullable by default Optional&lt;String&gt; bio; // Can be empty/null } Fory fory = Fory.builder() .withLanguage(Language.XLANG) .build(); fory.register(Person.class, &quot;example.Person&quot;);   ","version":"dev","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/next/guide/xlang/field_nullability#python","content":" from dataclasses import dataclass from typing import Optional, List import pyfory @dataclass class Person: # Non-nullable by default name: str # Must have a value age: pyfory.int32 # Primitive tags: List[str] # Must not be None # Optional makes it nullable nickname: Optional[str] = None # Can be None bio: Optional[str] = None # Can be None fory = pyfory.Fory(xlang=True) fory.register_type(Person, typename=&quot;example.Person&quot;)   ","version":"dev","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/next/guide/xlang/field_nullability#rust","content":" use fory::{Fory, ForyObject}; #[derive(ForyObject)] struct Person { // Non-nullable by default name: String, age: i32, tags: Vec&lt;String&gt;, // Option&lt;T&gt; is nullable nickname: Option&lt;String&gt;, // Can be None bio: Option&lt;String&gt;, // Can be None }   ","version":"dev","tagName":"h3"},{"title":"Go‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/next/guide/xlang/field_nullability#go","content":" type Person struct { // Non-nullable by default Name string Age int32 Tags []string // Pointer types for nullable fields Nickname *string // Can be nil Bio *string // Can be nil } fory := forygo.NewFory(forygo.WithXlang(true)) fory.RegisterNamedStruct(Person{}, &quot;example.Person&quot;)   ","version":"dev","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/next/guide/xlang/field_nullability#c","content":" struct Person { // Non-nullable by default std::string name; int32_t age; std::vector&lt;std::string&gt; tags; // std::optional for nullable std::optional&lt;std::string&gt; nickname; std::optional&lt;std::string&gt; bio; }; FORY_STRUCT(Person, name, age, tags, nickname, bio);   ","version":"dev","tagName":"h3"},{"title":"Customizing Nullability‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/next/guide/xlang/field_nullability#customizing-nullability","content":" ","version":"dev","tagName":"h2"},{"title":"Java: @ForyField Annotation‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/next/guide/xlang/field_nullability#java-foryfield-annotation","content":" public class Config { @ForyField(nullable = true) String optionalSetting; // Explicitly nullable @ForyField(nullable = false) String requiredSetting; // Explicitly non-nullable (default) }   ","version":"dev","tagName":"h3"},{"title":"C++: fory::field Wrapper‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/next/guide/xlang/field_nullability#c-foryfield-wrapper","content":" struct Config { // Explicitly mark as nullable fory::field&lt;std::string, 1, fory::nullable&lt;true&gt;&gt; optional_setting; // Explicitly mark as non-nullable (default) fory::field&lt;std::string, 2, fory::nullable&lt;false&gt;&gt; required_setting; }; FORY_STRUCT(Config, optional_setting, required_setting);   ","version":"dev","tagName":"h3"},{"title":"Null Value Handling‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/next/guide/xlang/field_nullability#null-value-handling","content":" When a non-nullable field receives a null value:  Language\tBehaviorJava\tThrows NullPointerException or serialization error Python\tRaises TypeError or serialization error Rust\tCompile-time error (non-Option types can't be None) Go\tZero value is used (empty string, 0, etc.) C++\tDefault-constructed value or undefined behavior  ","version":"dev","tagName":"h2"},{"title":"Schema Compatibility‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/next/guide/xlang/field_nullability#schema-compatibility","content":" The nullable flag is part of the struct schema fingerprint. Changing a field's nullability is a breaking change that will cause schema version mismatch errors.  Schema A: { name: String (non-nullable) } Schema B: { name: String (nullable) } // These have different fingerprints and are incompatible   ","version":"dev","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/next/guide/xlang/field_nullability#best-practices","content":" Use non-nullable by default: Only make fields nullable when null is a valid semantic valueUse Optional/Option wrappers: Instead of raw types with nullable annotationBe consistent across languages: Use the same nullability for corresponding fieldsDocument nullable fields: Make it clear which fields can be null in your API  ","version":"dev","tagName":"h2"},{"title":"See Also‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/next/guide/xlang/field_nullability#see-also","content":" Reference Tracking - Shared and circular reference handlingSerialization - Basic cross-language serializationType Mapping - Cross-language type mapping referenceXlang Specification - Binary protocol details ","version":"dev","tagName":"h2"},{"title":"Field Type Meta","type":0,"sectionRef":"#","url":"/docs/next/guide/xlang/field_type_meta","content":"","keywords":"","version":"dev"},{"title":"Overview‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/next/guide/xlang/field_type_meta#overview","content":" When serializing a struct field, Fory needs to determine whether to write type metadata:  Static typing: Use the declared field type's serializer directly (no type info written)Dynamic typing: Write type information to support runtime subtypes  ","version":"dev","tagName":"h2"},{"title":"When Type Meta Is Needed‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/next/guide/xlang/field_type_meta#when-type-meta-is-needed","content":" Type metadata is required when:  Interface/abstract fields: The declared type is abstract, so concrete type must be recordedPolymorphic fields: The runtime type may be a subclass of the declared typeCross-language compatibility: When the receiver needs type information to deserialize correctly  Type metadata is NOT needed when:  Final/concrete types: The declared type is final/sealed and cannot be subclassedPrimitive types: Type is known at compile timePerformance optimization: When you know the runtime type always matches the declared type  ","version":"dev","tagName":"h2"},{"title":"Language-Specific Configuration‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/next/guide/xlang/field_type_meta#language-specific-configuration","content":" ","version":"dev","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/next/guide/xlang/field_type_meta#java","content":" Java requires explicit configuration because concrete classes can be subclassed unless marked final.  Use the @ForyField annotation with the dynamic parameter:  import org.apache.fory.annotation.ForyField; import org.apache.fory.annotation.ForyField.Dynamic; public class Container { // AUTO (default): Interface types write type info, concrete types don't @ForyField(id = 0) private Shape shape; // Interface - type info written // FALSE: Never write type info (use declared type's serializer) @ForyField(id = 1, dynamic = Dynamic.FALSE) private Circle circle; // Always treated as Circle // TRUE: Always write type info (support runtime subtypes) @ForyField(id = 2, dynamic = Dynamic.TRUE) private Shape concreteShape; // Type info written even if concrete }   Dynamic Options:  Value\tBehaviorAUTO\tInterface/abstract types are dynamic, concrete are not FALSE\tNever write type info, use declared type's serializer TRUE\tAlways write type info to support runtime subtypes  Use Cases:  AUTO: Default behavior, suitable for most casesFALSE: Performance optimization when you know the exact typeTRUE: When a concrete field may hold subclass instances  ","version":"dev","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/next/guide/xlang/field_type_meta#c","content":" C++ uses the fory::dynamic&lt;V&gt; template tag or .dynamic(bool) builder method:  Using fory::field&lt;&gt; template:  #include &quot;fory/serialization/fory.h&quot; // Abstract base class with pure virtual methods struct Animal { virtual ~Animal() = default; virtual std::string speak() const = 0; }; struct Zoo { // Auto: type info written because Animal is polymorphic (std::is_polymorphic) fory::field&lt;std::shared_ptr&lt;Animal&gt;, 0, fory::nullable&gt; animal; // Force non-dynamic: skip type info even though Animal is polymorphic fory::field&lt;std::shared_ptr&lt;Animal&gt;, 1, fory::nullable, fory::dynamic&lt;false&gt;&gt; fixed_animal; // Force dynamic: write type info even for non-polymorphic types fory::field&lt;std::shared_ptr&lt;Data&gt;, 2, fory::dynamic&lt;true&gt;&gt; polymorphic_data; }; FORY_STRUCT(Zoo, animal, fixed_animal, polymorphic_data);   Using FORY_FIELD_CONFIG macro:  struct Zoo { std::shared_ptr&lt;Animal&gt; animal; std::shared_ptr&lt;Animal&gt; fixed_animal; std::shared_ptr&lt;Data&gt; polymorphic_data; }; FORY_STRUCT(Zoo, animal, fixed_animal, polymorphic_data); FORY_FIELD_CONFIG(Zoo, (animal, fory::F(0).nullable()), // Auto-detect polymorphism (fixed_animal, fory::F(1).nullable().dynamic(false)), // Skip type info (polymorphic_data, fory::F(2).dynamic(true)) // Force type info );   Default Behavior: Fory auto-detects polymorphism via std::is_polymorphic&lt;T&gt;. Types with pure virtual methods are treated as dynamic by default.  ","version":"dev","tagName":"h3"},{"title":"Go and Rust‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/next/guide/xlang/field_type_meta#go-and-rust","content":" Go and Rust do not require explicit dynamic configuration because:  Go: Interface types are inherently dynamic - Fory can determine from the type whether it's an interfaceRust: Trait objects (dyn Trait) are explicitly marked in the type system  The type system in these languages already indicates whether a field is polymorphic:  // Go: interface types are automatically dynamic type Container struct { Shape Shape // Interface - type info written automatically Circle Circle // Concrete struct - no type info needed }   // Rust: trait objects are explicitly marked struct Container { shape: Box&lt;dyn Shape&gt;, // Trait object - type info written automatically circle: Circle, // Concrete type - no type info needed }   ","version":"dev","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/next/guide/xlang/field_type_meta#python","content":" Use pyfory.field() with the dynamic parameter:  from dataclasses import dataclass from abc import ABC, abstractmethod import pyfory class Shape(ABC): @abstractmethod def area(self) -&gt; float: pass @dataclass class Circle(Shape): radius: float = 0.0 def area(self) -&gt; float: return 3.14159 * self.radius * self.radius @dataclass class Container: # Abstract class: dynamic is always True (type info written) shape: Shape = pyfory.field(id=0) # Concrete type with explicit dynamic=True (force type info) circle: Circle = pyfory.field(id=1, dynamic=True) # Concrete type with explicit dynamic=False (skip type info) fixed_circle: Circle = pyfory.field(id=2, dynamic=False)   Default Behavior:  Mode\tAbstract Class\tConcrete Object Types\tNumeric/str/time TypesNative mode\tTrue\tTrue\tFalse Xlang mode\tTrue\tFalse\tFalse  Abstract classes: dynamic is always True (type info must be written)Native mode: dynamic defaults to True for object types, False for numeric/str/time typesXlang mode: dynamic defaults to False for concrete types  ","version":"dev","tagName":"h3"},{"title":"Default Behavior‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/next/guide/xlang/field_type_meta#default-behavior","content":" Language\tInterface/Abstract Types\tConcrete TypesJava\tDynamic (write type)\tStatic (no type) C++\tDynamic (virtual)\tStatic Go\tDynamic (interface)\tStatic (struct) Rust\tDynamic (dyn Trait)\tStatic Python\tDynamic (all objects)\tDynamic  ","version":"dev","tagName":"h2"},{"title":"Performance Considerations‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/next/guide/xlang/field_type_meta#performance-considerations","content":" Writing type metadata has overhead:  Space: Type information adds bytes to serialized outputTime: Type resolution during serialization/deserialization  Use dynamic = FALSE (Java) or dynamic(false) (C++) when:  You're certain the runtime type matches the declared typePerformance is critical and polymorphism is not neededThe field type is effectively final  ","version":"dev","tagName":"h2"},{"title":"Cross-Language Compatibility‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/next/guide/xlang/field_type_meta#cross-language-compatibility","content":" When serializing data for cross-language consumption:  Use consistent type registration: Register types with the same ID across languagesPrefer explicit configuration: Use dynamic = TRUE when unsure about receiver's expectationsDocument polymorphic fields: Make it clear which fields may contain subtypes  ","version":"dev","tagName":"h2"},{"title":"Example: Polymorphic Container‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/next/guide/xlang/field_type_meta#example-polymorphic-container","content":" ","version":"dev","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/next/guide/xlang/field_type_meta#java-1","content":" public interface Animal { String speak(); } public class Dog implements Animal { private String name; @Override public String speak() { return &quot;Woof!&quot;; } } public class Cat implements Animal { private String name; @Override public String speak() { return &quot;Meow!&quot;; } } public class Zoo { // Type info written because Animal is an interface @ForyField(id = 0) private Animal animal; // Force type info for concrete type that may hold subtypes @ForyField(id = 1, dynamic = Dynamic.TRUE) private Dog maybeMixedBreed; }   ","version":"dev","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/next/guide/xlang/field_type_meta#c-1","content":" // Abstract base class with pure virtual methods class Animal { public: virtual std::string speak() const = 0; virtual ~Animal() = default; }; class Dog : public Animal { public: std::string name; std::string speak() const override { return &quot;Woof!&quot;; } }; struct Zoo { std::shared_ptr&lt;Animal&gt; animal; std::shared_ptr&lt;Dog&gt; maybe_mixed_breed; }; FORY_STRUCT(Zoo, animal, maybe_mixed_breed); FORY_FIELD_CONFIG(Zoo, (animal, fory::F(0).nullable()), // Auto-detect (Animal is polymorphic) (maybe_mixed_breed, fory::F(1).dynamic(true)) // Force dynamic for concrete type );   ","version":"dev","tagName":"h3"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/next/guide/xlang/field_type_meta#related-topics","content":" Field Nullability - Controlling null handling for fieldsField Reference Tracking - Managing shared/circular referencesType Mapping - Cross-language type compatibility ","version":"dev","tagName":"h2"},{"title":"Getting Started","type":0,"sectionRef":"#","url":"/docs/next/guide/xlang/getting_started","content":"","keywords":"","version":"dev"},{"title":"Installation‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/next/guide/xlang/getting_started#installation","content":" ","version":"dev","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/next/guide/xlang/getting_started#java","content":" Maven:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-core&lt;/artifactId&gt; &lt;version&gt;0.15.0&lt;/version&gt; &lt;/dependency&gt;   Gradle:  implementation 'org.apache.fory:fory-core:0.15.0'   ","version":"dev","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/next/guide/xlang/getting_started#python","content":" pip install pyfory   ","version":"dev","tagName":"h3"},{"title":"Go‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/next/guide/xlang/getting_started#go","content":" go get github.com/apache/fory/go/fory   ","version":"dev","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/next/guide/xlang/getting_started#rust","content":" [dependencies] fory = &quot;0.13&quot;   ","version":"dev","tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/next/guide/xlang/getting_started#javascript","content":" npm install @apache-fory/fory   ","version":"dev","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/next/guide/xlang/getting_started#c","content":" Use Bazel or CMake to build from source. See C++ Guide for details.  ","version":"dev","tagName":"h3"},{"title":"Enable Cross-Language Mode‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/next/guide/xlang/getting_started#enable-cross-language-mode","content":" Each language requires enabling xlang mode to ensure binary compatibility across languages.  ","version":"dev","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/next/guide/xlang/getting_started#java-1","content":" import org.apache.fory.*; import org.apache.fory.config.*; Fory fory = Fory.builder() .withLanguage(Language.XLANG) // Enable cross-language mode .withRefTracking(true) // Optional: for circular references .build();   ","version":"dev","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/next/guide/xlang/getting_started#python-1","content":" import pyfory # Cross-language mode must be enabled explicitly fory = pyfory.Fory(xlang=True) # Enable reference tracking when needed fory = pyfory.Fory(xlang=True, ref=True)   ","version":"dev","tagName":"h3"},{"title":"Go‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/next/guide/xlang/getting_started#go-1","content":" import forygo &quot;github.com/apache/fory/go/fory&quot; fory := forygo.NewFory(forygo.WithXlang(true)) // Or with reference tracking fory := forygo.NewFory(forygo.WithXlang(true), forygo.WithTrackRef(true))   ","version":"dev","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/next/guide/xlang/getting_started#rust-1","content":" use fory::Fory; let fory = Fory::default().xlang(true);   ","version":"dev","tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/next/guide/xlang/getting_started#javascript-1","content":" import Fory from &quot;@apache-fory/fory&quot;; const fory = new Fory();   ","version":"dev","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/next/guide/xlang/getting_started#c-1","content":" #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; auto fory = Fory::builder() .xlang(true) .build();   ","version":"dev","tagName":"h3"},{"title":"Type Registration‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/next/guide/xlang/getting_started#type-registration","content":" Custom types must be registered with consistent names or IDs across all languages.  ","version":"dev","tagName":"h2"},{"title":"Register by Name (Recommended)‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/next/guide/xlang/getting_started#register-by-name-recommended","content":" Using string names is more flexible and less prone to conflicts:  Java:  fory.register(Person.class, &quot;example.Person&quot;);   Python:  fory.register_type(Person, typename=&quot;example.Person&quot;)   Go:  fory.RegisterNamedStruct(Person{}, &quot;example.Person&quot;)   Rust:  use fory::{Fory, ForyObject}; #[derive(ForyObject)] struct Person { name: String, age: i32, } let mut fory = Fory::default().xlang(true); fory .register_by_namespace::&lt;Person&gt;(&quot;example&quot;, &quot;Person&quot;) .expect(&quot;register Person&quot;);   JavaScript:  const description = Type.object(&quot;example.Person&quot;, { name: Type.string(), age: Type.int32(), }); fory.registerSerializer(description);   C++:  fory.register_struct&lt;Person&gt;(&quot;example.Person&quot;); // For enums, use register_enum: // fory.register_enum&lt;Color&gt;(&quot;example.Color&quot;);   ","version":"dev","tagName":"h3"},{"title":"Register by ID‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/next/guide/xlang/getting_started#register-by-id","content":" Using numeric IDs is faster and produces smaller binary output:  Java:  fory.register(Person.class, 100);   Python:  fory.register_type(Person, type_id=100)   Go:  fory.RegisterStruct(Person{}, 100)   C++:  fory.register_struct&lt;Person&gt;(100); // For enums, use register_enum: // fory.register_enum&lt;Color&gt;(101);   ","version":"dev","tagName":"h3"},{"title":"Hello World Example‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/next/guide/xlang/getting_started#hello-world-example","content":" A complete example showing serialization in Java and deserialization in Python:  ","version":"dev","tagName":"h2"},{"title":"Java (Serializer)‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/next/guide/xlang/getting_started#java-serializer","content":" import org.apache.fory.*; import org.apache.fory.config.*; import java.nio.file.*; public class Person { public String name; public int age; } public class HelloWorld { public static void main(String[] args) throws Exception { Fory fory = Fory.builder() .withLanguage(Language.XLANG) .build(); fory.register(Person.class, &quot;example.Person&quot;); Person person = new Person(); person.name = &quot;Alice&quot;; person.age = 30; byte[] bytes = fory.serialize(person); Files.write(Path.of(&quot;person.bin&quot;), bytes); System.out.println(&quot;Serialized to person.bin&quot;); } }   ","version":"dev","tagName":"h3"},{"title":"Python (Deserializer)‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/next/guide/xlang/getting_started#python-deserializer","content":" import pyfory from dataclasses import dataclass @dataclass class Person: name: str age: pyfory.Int32Type fory = pyfory.Fory(xlang=True) fory.register_type(Person, typename=&quot;example.Person&quot;) with open(&quot;person.bin&quot;, &quot;rb&quot;) as f: data = f.read() person = fory.deserialize(data) print(f&quot;Name: {person.name}, Age: {person.age}&quot;) # Output: Name: Alice, Age: 30   ","version":"dev","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/next/guide/xlang/getting_started#best-practices","content":" Use consistent type names: Ensure all languages use the same type name or IDEnable reference tracking: If your data has circular or shared referencesReuse Fory instances: Creating Fory is expensive; reuse instancesUse type annotations: In Python, use pyfory.Int32Type etc. for precise type mappingTest cross-language: Verify serialization works across all target languages  ","version":"dev","tagName":"h2"},{"title":"Next Steps‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/next/guide/xlang/getting_started#next-steps","content":" Type Mapping - Cross-language type mapping referenceSerialization - Detailed serialization examplesTroubleshooting - Common issues and solutions ","version":"dev","tagName":"h2"},{"title":"Reference Tracking","type":0,"sectionRef":"#","url":"/docs/next/guide/xlang/reference_tracking","content":"","keywords":"","version":"dev"},{"title":"Overview‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/next/guide/xlang/reference_tracking#overview","content":" Reference tracking enables:  Shared references: Same object referenced multiple times is serialized onceCircular references: Objects that reference themselves or form cyclesMemory efficiency: No duplicate data for repeated objects  ","version":"dev","tagName":"h2"},{"title":"Enabling Reference Tracking‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/next/guide/xlang/reference_tracking#enabling-reference-tracking","content":" ","version":"dev","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/next/guide/xlang/reference_tracking#java","content":" Fory fory = Fory.builder() .withLanguage(Language.XLANG) .withRefTracking(true) .build();   ","version":"dev","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/next/guide/xlang/reference_tracking#python","content":" fory = pyfory.Fory(xlang=True, ref=True)   ","version":"dev","tagName":"h3"},{"title":"Go‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/next/guide/xlang/reference_tracking#go","content":" fory := forygo.NewFory( forygo.WithXlang(true), forygo.WithTrackRef(true), )   ","version":"dev","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/next/guide/xlang/reference_tracking#c","content":" auto fory = fory::Fory::builder().xlang(true).track_ref(true).build();   ","version":"dev","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/next/guide/xlang/reference_tracking#rust","content":" let fory = Fory::default() .xlang(true) .track_ref(true);   ","version":"dev","tagName":"h3"},{"title":"Wire Format‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/next/guide/xlang/reference_tracking#wire-format","content":" When reference tracking is enabled, nullable fields write a ref flag byte before the value:  [ref_flag] [value data if not null/ref]   Where ref_flag is:  Value\tMeaning-1 (NULL_FLAG)\tValue is null -2 (NOT_NULL_VALUE_FLAG)\tValue is present, first occurrence ‚â•0\tReference ID pointing to previously serialized object  ","version":"dev","tagName":"h2"},{"title":"Reference Tracking vs Nullability‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/next/guide/xlang/reference_tracking#reference-tracking-vs-nullability","content":" These are independent concepts:  Concept\tPurpose\tControlled ByNullability\tWhether a field can hold null values\tField type (Optional&lt;T&gt;) or annotation Reference Tracking\tWhether duplicate objects are deduplicated\tGlobal refTracking option  Key behavior:  Ref flag bytes are only written for nullable fieldsNon-nullable fields skip ref flags entirely, even with refTracking=trueReference deduplication only applies to objects that appear multiple times  // Reference tracking enabled, but non-nullable fields still skip ref flags Fory fory = Fory.builder() .withLanguage(Language.XLANG) .withRefTracking(true) .build();   ","version":"dev","tagName":"h2"},{"title":"Per-Field Reference Tracking‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/next/guide/xlang/reference_tracking#per-field-reference-tracking","content":" By default, most fields do not track references even when global refTracking=true. Only specific pointer/smart pointer types track references by default.  ","version":"dev","tagName":"h2"},{"title":"Default Behavior by Language‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/next/guide/xlang/reference_tracking#default-behavior-by-language","content":" Language\tDefault Ref Tracking\tTypes That Track Refs by DefaultJava\tNo\tNone (use annotation to enable) Python\tNo\tNone (use annotation to enable) Go\tNo\tNone (use fory:&quot;ref&quot; to enable) C++\tYes\tstd::shared_ptr&lt;T&gt;, fory::serialization::SharedWeak&lt;T&gt; Rust\tNo\tRc&lt;T&gt;, Arc&lt;T&gt;, Weak&lt;T&gt;  ","version":"dev","tagName":"h3"},{"title":"Customizing Per-Field Ref Tracking‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/next/guide/xlang/reference_tracking#customizing-per-field-ref-tracking","content":" Java: @ForyField Annotation‚Äã  public class Document { // Default: no ref tracking String title; // Enable ref tracking for this field @ForyField(trackingRef = true) Author author; // Shared across documents, track refs to avoid duplicates @ForyField(trackingRef = true) List&lt;Tag&gt; tags; }   C++: fory::field Wrapper‚Äã  struct Document { std::string title; // shared_ptr/SharedWeak track refs by default std::shared_ptr&lt;Author&gt; author; fory::serialization::SharedWeak&lt;Data&gt; data; // Explicitly mark ref tracking when using field wrappers (optional) fory::field&lt;std::shared_ptr&lt;Tag&gt;, 1, fory::ref&gt; tag_owner; }; FORY_STRUCT(Document, title, author, data, tag_owner);   To disable reference tracking for C++ entirely, setFory::builder().track_ref(false) on the serializer.  Rust: Field Attributes‚Äã  use fory::ForyObject; use std::rc::Rc; #[derive(ForyObject)] struct Document { title: String, // Rc/Arc track refs by default author: Rc&lt;Author&gt;, // Explicitly enable ref tracking #[fory(ref = true)] tags: Vec&lt;Tag&gt;, }   Go: Struct Tags‚Äã  type Document struct { Title string // Enable ref tracking for pointer to struct Author *Author `fory:&quot;ref&quot;` // Enable ref tracking for slice Tags []Tag `fory:&quot;ref&quot;` }   ","version":"dev","tagName":"h3"},{"title":"When to Enable Per-Field Ref Tracking‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/next/guide/xlang/reference_tracking#when-to-enable-per-field-ref-tracking","content":" Enable ref tracking for fields that:  May contain the same object instance multiple timesAre part of circular reference chainsHold large objects that might be shared  Disable (or leave default) for fields that:  Always contain unique valuesAre primitives or simple value typesDon't participate in object sharing  ","version":"dev","tagName":"h3"},{"title":"Example: Shared References‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/next/guide/xlang/reference_tracking#example-shared-references","content":" public class Container { List&lt;String&gt; data; List&lt;String&gt; sameData; // Points to same list } Container obj = new Container(); obj.data = Arrays.asList(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;); obj.sameData = obj.data; // Shared reference // With refTracking=true: data serialized once, sameData stores reference ID // With refTracking=false: data serialized twice (duplicate)   ","version":"dev","tagName":"h2"},{"title":"Example: Circular References‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/next/guide/xlang/reference_tracking#example-circular-references","content":" public class Node { String value; Node next; } Node a = new Node(&quot;A&quot;); Node b = new Node(&quot;B&quot;); a.next = b; b.next = a; // Circular reference // With refTracking=true: works correctly // With refTracking=false: infinite recursion error   ","version":"dev","tagName":"h2"},{"title":"Language Support‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/next/guide/xlang/reference_tracking#language-support","content":" Language\tShared Refs\tCircular RefsJava\tYes\tYes Python\tYes\tYes Go\tYes\tYes C++\tYes\tYes JavaScript\tYes\tYes Rust\tYes\tNo (ownership rules)  ","version":"dev","tagName":"h2"},{"title":"Performance Considerations‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/next/guide/xlang/reference_tracking#performance-considerations","content":" Overhead: Reference tracking adds a hash map lookup per objectWhen to enable: Use when data has shared/circular referencesWhen to disable: Use for simple data structures without sharing  ","version":"dev","tagName":"h2"},{"title":"See Also‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/next/guide/xlang/reference_tracking#see-also","content":" Field Nullability - How nullability affects serializationSerialization - Basic cross-language serialization examplesXlang Specification - Binary protocol details ","version":"dev","tagName":"h2"},{"title":"Row Format","type":0,"sectionRef":"#","url":"/docs/next/guide/xlang/row_format","content":"","keywords":"","version":"dev"},{"title":"Features‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/xlang/row_format#features","content":" Zero-Copy Random Access: Read specific fields directly from binary dataPartial Serialization: Skip unnecessary fields during serializationCross-Language Compatible: Row format data can be shared between Java, Python, and C++Apache Arrow Integration: Convert row format to/from Arrow RecordBatch for analytics (Java/Python)  ","version":"dev","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/xlang/row_format#java","content":" public class Bar { String f1; List&lt;Long&gt; f2; } public class Foo { int f1; List&lt;Integer&gt; f2; Map&lt;String, Integer&gt; f3; List&lt;Bar&gt; f4; } RowEncoder&lt;Foo&gt; encoder = Encoders.bean(Foo.class); Foo foo = new Foo(); foo.f1 = 10; foo.f2 = IntStream.range(0, 1000000).boxed().collect(Collectors.toList()); foo.f3 = IntStream.range(0, 1000000).boxed().collect(Collectors.toMap(i -&gt; &quot;k&quot;+i, i-&gt;i)); List&lt;Bar&gt; bars = new ArrayList&lt;&gt;(1000000); for (int i = 0; i &lt; 1000000; i++) { Bar bar = new Bar(); bar.f1 = &quot;s&quot;+i; bar.f2 = LongStream.range(0, 10).boxed().collect(Collectors.toList()); bars.add(bar); } foo.f4 = bars; // Can be zero-copy read by Python BinaryRow binaryRow = encoder.toRow(foo); // Can be data from Python Foo newFoo = encoder.fromRow(binaryRow); // Zero-copy read List&lt;Integer&gt; f2 BinaryArray binaryArray2 = binaryRow.getArray(1); // Zero-copy read List&lt;Bar&gt; f4 BinaryArray binaryArray4 = binaryRow.getArray(3); // Zero-copy read 11th element of List&lt;Bar&gt; f4 BinaryRow barStruct = binaryArray4.getStruct(10); // Zero-copy read 6th element of f2 of 11th element of List&lt;Bar&gt; f4 barStruct.getArray(1).getInt64(5); RowEncoder&lt;Bar&gt; barEncoder = Encoders.bean(Bar.class); // Deserialize part of data Bar newBar = barEncoder.fromRow(barStruct); Bar newBar2 = barEncoder.fromRow(binaryArray4.getStruct(20));   ","version":"dev","tagName":"h2"},{"title":"Python‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/xlang/row_format#python","content":" @dataclass class Bar: f1: str f2: List[pa.int64] @dataclass class Foo: f1: pa.int32 f2: List[pa.int32] f3: Dict[str, pa.int32] f4: List[Bar] encoder = pyfory.encoder(Foo) foo = Foo(f1=10, f2=list(range(1000_000)), f3={f&quot;k{i}&quot;: i for i in range(1000_000)}, f4=[Bar(f1=f&quot;s{i}&quot;, f2=list(range(10))) for i in range(1000_000)]) binary: bytes = encoder.to_row(foo).to_bytes() print(f&quot;start: {datetime.datetime.now()}&quot;) foo_row = pyfory.RowData(encoder.schema, binary) print(foo_row.f2[100000], foo_row.f4[100000].f1, foo_row.f4[200000].f2[5]) print(f&quot;end: {datetime.datetime.now()}&quot;) binary = pickle.dumps(foo) print(f&quot;pickle start: {datetime.datetime.now()}&quot;) new_foo = pickle.loads(binary) print(new_foo.f2[100000], new_foo.f4[100000].f1, new_foo.f4[200000].f2[5]) print(f&quot;pickle end: {datetime.datetime.now()}&quot;)   ","version":"dev","tagName":"h2"},{"title":"Apache Arrow Support‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/xlang/row_format#apache-arrow-support","content":" Fory Row Format supports automatic conversion from/to Arrow Table/RecordBatch for analytics workloads.  ","version":"dev","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/xlang/row_format#java-1","content":" Schema schema = TypeInference.inferSchema(BeanA.class); ArrowWriter arrowWriter = ArrowUtils.createArrowWriter(schema); Encoder&lt;BeanA&gt; encoder = Encoders.rowEncoder(BeanA.class); for (int i = 0; i &lt; 10; i++) { BeanA beanA = BeanA.createBeanA(2); arrowWriter.write(encoder.toRow(beanA)); } return arrowWriter.finishAsRecordBatch();   ","version":"dev","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/xlang/row_format#python-1","content":" import pyfory encoder = pyfory.encoder(Foo) encoder.to_arrow_record_batch([foo] * 10000) encoder.to_arrow_table([foo] * 10000)   ","version":"dev","tagName":"h3"},{"title":"Support for Interface and Extension Types‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/xlang/row_format#support-for-interface-and-extension-types","content":" Fory supports row format mapping for Java interface types and subclassed (extends) types, enabling more dynamic and flexible data schemas.  These enhancements were introduced in #2243, #2250, and #2256.  ","version":"dev","tagName":"h2"},{"title":"Example: Interface Mapping with RowEncoder‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/xlang/row_format#example-interface-mapping-with-rowencoder","content":" public interface Animal { String speak(); } public class Dog implements Animal { public String name; @Override public String speak() { return &quot;Woof&quot;; } } // Encode and decode using RowEncoder with interface type RowEncoder&lt;Animal&gt; encoder = Encoders.bean(Animal.class); Dog dog = new Dog(); dog.name = &quot;Bingo&quot;; BinaryRow row = encoder.toRow(dog); Animal decoded = encoder.fromRow(row); System.out.println(decoded.speak()); // Woof   ","version":"dev","tagName":"h3"},{"title":"Example: Extension Type with RowEncoder‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/xlang/row_format#example-extension-type-with-rowencoder","content":" public class Parent { public String parentField; } public class Child extends Parent { public String childField; } // Encode and decode using RowEncoder with parent class type RowEncoder&lt;Parent&gt; encoder = Encoders.bean(Parent.class); Child child = new Child(); child.parentField = &quot;Hello&quot;; child.childField = &quot;World&quot;; BinaryRow row = encoder.toRow(child); Parent decoded = encoder.fromRow(row);   ","version":"dev","tagName":"h3"},{"title":"See Also‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/guide/xlang/row_format#see-also","content":" Row Format Specification - Binary format detailsJava Row Format Guide - Java-specific row format documentationPython Row Format Guide - Python-specific row format documentation ","version":"dev","tagName":"h2"},{"title":"Benchmark","type":0,"sectionRef":"#","url":"/docs/next/introduction/benchmark","content":"","keywords":"","version":"dev"},{"title":"Java Benchmark‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/next/introduction/benchmark#java-benchmark","content":" The following benchmarks compare Fory against popular Java serialization frameworks. Charts labeled &quot;compatible&quot; show schema evolution mode with forward/backward compatibility enabled, while others show schema consistent mode where class schemas must match.  Test Classes:  Struct: Class with 100 primitive fieldsMediaContent: Class from jvm-serializersSample: Class from Kryo benchmark  ","version":"dev","tagName":"h2"},{"title":"Java Serialization‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/next/introduction/benchmark#java-serialization","content":"         ","version":"dev","tagName":"h3"},{"title":"Java Deserialization‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/next/introduction/benchmark#java-deserialization","content":"         Important: Fory's runtime code generation requires proper warm-up for performance measurement:  For additional benchmarks covering type forward/backward compatibility, off-heap support, and zero-copy serialization, see Java Benchmarks.  ","version":"dev","tagName":"h3"},{"title":"Rust Benchmark‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/next/introduction/benchmark#rust-benchmark","content":" Fory Rust demonstrates competitive performance compared to other Rust serialization frameworks.        Note: Results depend on hardware, dataset, and implementation versions. See the Rust guide for how to run benchmarks yourself: https://github.com/apache/fory/blob/main/benchmarks/rust_benchmark/README.md  ","version":"dev","tagName":"h2"},{"title":"C++ Benchmark‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/next/introduction/benchmark#c-benchmark","content":" Fory C++ demonstrates competitive performance compared to Protobuf C++ serialization framework.    ","version":"dev","tagName":"h2"},{"title":"JavaScript Benchmark‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/next/introduction/benchmark#javascript-benchmark","content":"   The data used for this bar graph includes a complex object that has many kinds of field types, and the size of the JSON data is 3KB.  See benchmarks for the benchmark code. ","version":"dev","tagName":"h2"},{"title":"Troubleshooting","type":0,"sectionRef":"#","url":"/docs/next/guide/xlang/troubleshooting","content":"","keywords":"","version":"dev"},{"title":"Type Registration Errors‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/xlang/troubleshooting#type-registration-errors","content":" ","version":"dev","tagName":"h2"},{"title":"\"Type not registered\" Error‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/xlang/troubleshooting#type-not-registered-error","content":" Symptom:  Error: Type 'example.Person' is not registered   Cause: The type was not registered before deserialization, or the type name doesn't match.  Solution:  Ensure the type is registered with the same name on both sides: // Java fory.register(Person.class, &quot;example.Person&quot;); # Python fory.register_type(Person, typename=&quot;example.Person&quot;) Check for typos or case differences in type names Register types before any serialization/deserialization calls  ","version":"dev","tagName":"h3"},{"title":"\"Type ID mismatch\" Error‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/xlang/troubleshooting#type-id-mismatch-error","content":" Symptom:  Error: Expected type ID 100, got 101   Cause: Different type IDs used across languages.  Solution: Use consistent type IDs:  // Java fory.register(Person.class, 100); fory.register(Address.class, 101);   # Python fory.register_type(Person, type_id=100) fory.register_type(Address, type_id=101)   ","version":"dev","tagName":"h3"},{"title":"Type Mapping Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/xlang/troubleshooting#type-mapping-issues","content":" ","version":"dev","tagName":"h2"},{"title":"Integer Overflow‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/xlang/troubleshooting#integer-overflow","content":" Symptom: Values are truncated or wrapped unexpectedly.  Cause: Using different integer sizes across languages.  Solution:  In Python, use explicit type annotations: @dataclass class Data: value: pyfory.Int32Type # Not just 'int' Ensure integer ranges are compatible: int8: -128 to 127int16: -32,768 to 32,767int32: -2,147,483,648 to 2,147,483,647  ","version":"dev","tagName":"h3"},{"title":"Float Precision Loss‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/xlang/troubleshooting#float-precision-loss","content":" Symptom: Float values have unexpected precision.  Cause: Mixing float32 and float64 types.  Solution:  Use consistent float types: @dataclass class Data: value: pyfory.Float32Type # Explicit 32-bit float Be aware that Python's float maps to float64 by default  ","version":"dev","tagName":"h3"},{"title":"String Encoding Errors‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/xlang/troubleshooting#string-encoding-errors","content":" Symptom:  Error: Invalid UTF-8 sequence   Cause: Non-UTF-8 encoded strings.  Solution:  Ensure all strings are valid UTF-8 In Python, decode bytes before serialization: text = raw_bytes.decode('utf-8')   ","version":"dev","tagName":"h3"},{"title":"Field Order Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/xlang/troubleshooting#field-order-issues","content":" ","version":"dev","tagName":"h2"},{"title":"\"Field mismatch\" Error‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/xlang/troubleshooting#field-mismatch-error","content":" Symptom: Deserialized objects have wrong field values.  Cause: Field order differs between languages.  Solution: Fory sorts fields by their snake_cased names. Ensure field names are consistent:  // Java - fields will be sorted: age, email, name public class Person { public String name; public int age; public String email; }   # Python - same field order @dataclass class Person: name: str age: pyfory.Int32Type email: str   ","version":"dev","tagName":"h3"},{"title":"Reference Tracking Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/xlang/troubleshooting#reference-tracking-issues","content":" ","version":"dev","tagName":"h2"},{"title":"Stack Overflow with Circular References‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/xlang/troubleshooting#stack-overflow-with-circular-references","content":" Symptom:  StackOverflowError or RecursionError   Cause: Reference tracking is disabled but data has circular references.  Solution: Enable reference tracking:  // Java Fory fory = Fory.builder() .withLanguage(Language.XLANG) .withRefTracking(true) .build();   # Python fory = pyfory.Fory(xlang=True, ref=True)   ","version":"dev","tagName":"h3"},{"title":"Duplicate Objects‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/xlang/troubleshooting#duplicate-objects","content":" Symptom: Shared objects are duplicated after deserialization.  Cause: Reference tracking is disabled.  Solution: Enable reference tracking if objects are shared within the graph.  ","version":"dev","tagName":"h3"},{"title":"Language Mode Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/xlang/troubleshooting#language-mode-issues","content":" ","version":"dev","tagName":"h2"},{"title":"Incompatible Types in Xlang Mode‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/xlang/troubleshooting#incompatible-types-in-xlang-mode","content":" Symptom:  Error: Type 'Optional' is not supported in xlang mode   Cause: Using Java-specific types that don't have cross-language equivalents.  Solution: Use compatible types:  // Instead of Optional&lt;String&gt; public String email; // nullable // Instead of BigDecimal public double amount; // Instead of EnumSet&lt;Status&gt; public Set&lt;Status&gt; statuses;   ","version":"dev","tagName":"h3"},{"title":"Version Compatibility‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/xlang/troubleshooting#version-compatibility","content":" ","version":"dev","tagName":"h2"},{"title":"Serialization Format Changed‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/xlang/troubleshooting#serialization-format-changed","content":" Symptom: Deserialization fails after upgrading Fory.  Cause: Breaking changes in serialization format.  Solution:  Ensure all services use compatible Fory versionsCheck release notes for breaking changesConsider using schema evolution (compatible mode) for gradual upgrades  ","version":"dev","tagName":"h3"},{"title":"Debugging Tips‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/xlang/troubleshooting#debugging-tips","content":" ","version":"dev","tagName":"h2"},{"title":"Enable Debug Logging‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/xlang/troubleshooting#enable-debug-logging","content":" Java:  // Add to JVM options -Dfory.debug=true   Python:  import logging logging.getLogger('pyfory').setLevel(logging.DEBUG)   ","version":"dev","tagName":"h3"},{"title":"Inspect Serialized Data‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/xlang/troubleshooting#inspect-serialized-data","content":" Use hex dump to inspect the binary format:  data = fory.serialize(obj) print(data.hex())   ","version":"dev","tagName":"h3"},{"title":"Test Round-Trip‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/xlang/troubleshooting#test-round-trip","content":" Always test round-trip serialization in each language:  byte[] bytes = fory.serialize(obj); Object result = fory.deserialize(bytes); assert obj.equals(result);   ","version":"dev","tagName":"h3"},{"title":"Cross-Language Testing‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/xlang/troubleshooting#cross-language-testing","content":" Test serialization across all target languages before deployment:  # Serialize in Java java -jar serializer.jar &gt; data.bin # Deserialize in Python python deserializer.py data.bin   ","version":"dev","tagName":"h3"},{"title":"Common Mistakes‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/xlang/troubleshooting#common-mistakes","content":" Not registering types: Always register custom types before useInconsistent type names/IDs: Use the same names/IDs across all languagesForgetting xlang mode: Use Language.XLANG in JavaWrong type annotations: Use pyfory.Int32Type etc. in PythonIgnoring reference tracking: Enable for circular/shared references  ","version":"dev","tagName":"h2"},{"title":"See Also‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/next/guide/xlang/troubleshooting#see-also","content":" Type Mapping - Cross-language type mapping referenceGetting Started - Setup guideJava Troubleshooting - Java-specific issuesPython Troubleshooting - Python-specific issues ","version":"dev","tagName":"h2"},{"title":"Features","type":0,"sectionRef":"#","url":"/docs/next/introduction/features","content":"","keywords":"","version":"dev"},{"title":"Core Capabilities‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#core-capabilities","content":" ","version":"dev","tagName":"h2"},{"title":"üöÄ High-Performance Serialization‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#-high-performance-serialization","content":" Apache Fory‚Ñ¢ delivers exceptional performance through advanced optimization techniques:  JIT Compilation: Runtime code generation for Java eliminates virtual method calls and inlines hot pathsStatic Code Generation: Compile-time code generation for Rust, C++, and Go delivers peak performance without runtime overheadZero-Copy Operations: Direct memory access without intermediate buffer copies; row format enables random access and partial serializationIntelligent Encoding: Variable-length compression for integers and strings; SIMD acceleration for arrays (Java 16+)Meta Sharing: Class metadata packing reduces redundant type information across serializations  ","version":"dev","tagName":"h3"},{"title":"üåç Cross-Language Serialization‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#-cross-language-serialization","content":" The xlang serialization format enables seamless data exchange across programming languages:  Automatic Type Mapping: Intelligent conversion between language-specific types (type mapping)Reference Preservation: Shared and circular references work correctly across languagesPolymorphism: Objects serialize/deserialize with their actual runtime typesSchema Evolution: Optional forward/backward compatibility for evolving schemasAutomatic Serialization: No IDL or schema definitions required; serialize any object directly without code generation  ","version":"dev","tagName":"h3"},{"title":"üìä Row Format‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#-row-format","content":" A cache-friendly row format optimized for analytics workloads:  Zero-Copy Random Access: Read individual fields without deserializing entire objectsPartial Operations: Selective field serialization and deserialization for efficiencyApache Arrow Integration: Seamless conversion to columnar format for analytics pipelinesMulti-Language: Available in Java, Python, Rust and C++  ","version":"dev","tagName":"h3"},{"title":"üîí Security & Production-Readiness‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#-security--production-readiness","content":" Enterprise-grade security and compatibility:  Class Registration: Whitelist-based deserialization control (enabled by default)Depth Limiting: Protection against recursive object graph attacksConfigurable Policies: Custom class checkers and deserialization policiesPlatform Support: Java 8-24, GraalVM native image, multiple OS platforms  ","version":"dev","tagName":"h3"},{"title":"Java Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#java-features","content":" ","version":"dev","tagName":"h2"},{"title":"üöÄ High Performance‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#-high-performance","content":" JIT Code Generation: Highly-extensible JIT framework generates serializer code at runtime using async multi-threaded compilation, delivering 20-170x speedup through: Inlining variables to reduce memory accessInlining method calls to eliminate virtual dispatch overheadMinimizing conditional branchingEliminating hash lookups Zero-Copy: Direct memory access without intermediate buffer copies; row format supports random access and partial serializationVariable-Length Encoding: Optimized compression for integers, longsMeta Sharing: Cached class metadata reduces redundant type informationSIMD Acceleration: Java Vector API support for array operations (Java 16+)  ","version":"dev","tagName":"h3"},{"title":"üîß Drop-in Replacement‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#-drop-in-replacement","content":" 100% JDK Serialization Compatible: Supports writeObject/readObject/writeReplace/readResolve/readObjectNoData/ExternalizableJava 8-24 Support: Works across all modern Java versions including Java 17+ recordsGraalVM Native Image: AOT compilation support without reflection configuration  ","version":"dev","tagName":"h3"},{"title":"üîÑ Advanced Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#-advanced-features","content":" Reference Tracking: Automatic handling of shared and circular referencesSchema Evolution: Forward/backward compatibility for class schema changesPolymorphism: Full support for inheritance hierarchies and interfacesDeep Copy: Efficient deep cloning of complex object graphs with reference preservationSecurity: Class registration and configurable deserialization policies  ","version":"dev","tagName":"h3"},{"title":"Python Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#python-features","content":" ","version":"dev","tagName":"h2"},{"title":"üîß Flexible Serialization Modes‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#-flexible-serialization-modes","content":" Python native Mode: Full Python compatibility, drop-in replacement for pickle/cloudpickleCross-Language Mode: Optimized for multi-language data exchangeRow Format: Zero-copy row format for analytics workloads  ","version":"dev","tagName":"h3"},{"title":"üéØ Versatile Serialization Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#-versatile-serialization-features","content":" Shared/circular reference support for complex object graphs in both Python-native and cross-language modesPolymorphism support for customized types with automatic type dispatchingSchema evolution support for backward/forward compatibility when using dataclasses in cross-language modeOut-of-band buffer support for zero-copy serialization of large data structures like NumPy arrays and Pandas DataFrames, compatible with pickle protocol 5  ","version":"dev","tagName":"h3"},{"title":"‚ö° Blazing Fast Performance‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#-blazing-fast-performance","content":" Extremely fast performance compared to other serialization frameworksRuntime code generation and Cython-accelerated core implementation for optimal performance  ","version":"dev","tagName":"h3"},{"title":"üì¶ Compact Data Size‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#-compact-data-size","content":" Compact object graph protocol with minimal space overhead‚Äîup to 3√ó size reduction compared to pickle/cloudpickleMeta packing and sharing to minimize type forward/backward compatibility space overhead  ","version":"dev","tagName":"h3"},{"title":"üõ°Ô∏è Security & Safety‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#Ô∏è-security--safety","content":" Strict mode prevents deserialization of untrusted types by type registration and checks.Reference tracking for handling circular references safely  ","version":"dev","tagName":"h3"},{"title":"Rust Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#rust-features","content":" ","version":"dev","tagName":"h2"},{"title":"üöÄ Why Apache Fory‚Ñ¢ Rust?‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#-why-apache-fory-rust","content":" üî• Blazingly Fast: Zero-copy deserialization and optimized binary protocolsüåç Cross-Language: Seamlessly serialize/deserialize data across Java, Python, C++, Go, JavaScript, and RustüéØ Type-Safe: Compile-time type checking with derive macrosüîÑ Circular References: Automatic tracking of shared and circular references with Rc/Arc and weak pointersüß¨ Polymorphic: Serialize trait objects with Box&lt;dyn Trait&gt;, Rc&lt;dyn Trait&gt;, and Arc&lt;dyn Trait&gt;üì¶ Schema Evolution: Compatible mode for independent schema changes‚ö° Two Modes: Object graph serialization and zero-copy row-based format  ","version":"dev","tagName":"h3"},{"title":"Object Graph Serialization‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#object-graph-serialization","content":" Automatic serialization of complex object graphs, preserving the structure and relationships between objects. The #[derive(ForyObject)] macro generates efficient serialization code at compile time, eliminating runtime overhead:  Nested struct serialization with arbitrary depthCollection types (Vec, HashMap, HashSet, BTreeMap)Enum type supportOptional fields with Option&lt;T&gt;Automatic handling of primitive types and stringsEfficient binary encoding with variable-length integers  ","version":"dev","tagName":"h3"},{"title":"Shared and Circular References‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#shared-and-circular-references","content":" Automatically tracks and preserves reference identity for shared objects using Rc&lt;T&gt; and Arc&lt;T&gt;. When the same object is referenced multiple times, Fory serializes it only once and uses reference IDs for subsequent occurrences. This ensures:  Space efficiency: No data duplication in serialized outputReference identity preservation: Deserialized objects maintain the same sharing relationshipsCircular reference support: Use RcWeak&lt;T&gt; and ArcWeak&lt;T&gt; to break cycles  ","version":"dev","tagName":"h3"},{"title":"Trait Object Serialization‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#trait-object-serialization","content":" Polymorphic serialization through trait objects, enabling dynamic dispatch and type flexibility. This is essential for plugin systems, heterogeneous collections, and extensible architectures. Supported trait object types:  Box&lt;dyn Trait&gt; - Owned trait objectsRc&lt;dyn Trait&gt; - Reference-counted trait objectsArc&lt;dyn Trait&gt; - Thread-safe reference-counted trait objectsVec&lt;Box&lt;dyn Trait&gt;&gt;, HashMap&lt;K, Box&lt;dyn Trait&gt;&gt; - Collections of trait objects  ","version":"dev","tagName":"h3"},{"title":"Schema Evolution‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#schema-evolution","content":" Schema evolution in Compatible mode, allowing serialization and deserialization peers to have different type definitions. This enables independent evolution of services in distributed systems without breaking compatibility:  Add new fields with default valuesRemove obsolete fields (skipped during deserialization)Change field nullability (T ‚Üî Option&lt;T&gt;)Reorder fields (matched by name, not position)Type-safe fallback to default values for missing fields  ","version":"dev","tagName":"h3"},{"title":"Custom Serializers‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#custom-serializers","content":" For types that don't support #[derive(ForyObject)], implement the Serializer trait manually. This is useful for:  External types from other cratesTypes with special serialization requirementsLegacy data format compatibilityPerformance-critical custom encoding  ","version":"dev","tagName":"h3"},{"title":"Row-Based Serialization‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#row-based-serialization","content":" High-performance row format for zero-copy deserialization. Unlike traditional object serialization that reconstructs entire objects in memory, row format enables random access to fields directly from binary data without full deserialization.  Zero-copy access: Read fields without allocating or copying dataPartial deserialization: Access only the fields you needMemory-mapped files: Work with data larger than RAMCache-friendly: Sequential memory layout for better CPU cache utilizationLazy evaluation: Defer expensive operations until field access  ","version":"dev","tagName":"h3"},{"title":"Scala Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#scala-features","content":" ","version":"dev","tagName":"h2"},{"title":"Supported Types‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#supported-types","content":" Apache Fory‚Ñ¢ supports all scala object serialization:  case class serialization supportedpojo/bean class serialization supportedobject singleton serialization supportedcollection serialization supportedother types such as tuple/either and basic types are all supported too.  Scala 2 and 3 are both supported.  ","version":"dev","tagName":"h3"},{"title":"Scala Class Default Values Support‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#scala-class-default-values-support","content":" Fory supports Scala class default values during deserialization when using compatible mode. This feature enables forward/backward compatibility when case classes or regular Scala classes have default parameters.  When a Scala class has default parameters, the Scala compiler generates methods in the companion object (for case classes) or in the class itself (for regular Scala classes) like apply$default$1, apply$default$2, etc. that return the default values. Fory can detect these methods and use them when deserializing objects where certain fields are missing from the serialized data.  ","version":"dev","tagName":"h3"},{"title":"Kotlin Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#kotlin-features","content":" ","version":"dev","tagName":"h2"},{"title":"Supported Types‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#supported-types-1","content":" primitives: Byte, Boolean, Int, Short, Long, Char, Float, Double, UByte, UShort, UInt, ULong.Byte, Boolean, Int, Short, Long, Char, Float, Double works out of the box with the default fory java implementation.stdlib collection: ArrayDeque, ArrayList, HashMap,HashSet, LinkedHashSet, LinkedHashMap.ArrayList, HashMap,HashSet, LinkedHashSet, LinkedHashMap works out of the box with the default fory java implementation.String works out of the box with the default fory java implementation.arrays: Array, BooleanArray, ByteArray, CharArray, DoubleArray, FloatArray, IntArray, LongArray, ShortArrayall standard array types work out of the box with the default fory java implementation.unsigned arrays: UByteArray, UShortArray, UIntArray, ULongArrayfrom stdlib: Pair, Triple, Resultkotlin.random: Randomkotlin.ranges: CharRange, CharProgression, IntRange, IntProgression, LongRange, LongProgression, UintRange, UintProgression, ULongRange, ULongProgressionkotlin.text: Regexkotlin.time: Durationkotlin.uuid: Uuid  Additional support is added for the following classes in kotlin:  Unsigned primitives: UByte, UShort, UInt, ULongUnsigned array types: UByteArray, UShortArray, UIntArray, ULongArrayEmpty collections: emptyList, emptyMap, emptySetCollections: ArrayDequekotlin.time: Durationkotlin.uuid: Uuid  ","version":"dev","tagName":"h3"},{"title":"Data Class Default Value Support‚Äã","type":1,"pageTitle":"Features","url":"/docs/next/introduction/features#data-class-default-value-support","content":" Apache Fory‚Ñ¢ Kotlin provides support for Kotlin data class default values during serialization and deserialization. This feature allows for backward and forward compatibility when data class schemas evolve.  When a Kotlin data class has parameters with default values, Apache Fory‚Ñ¢ can:  Detect default values using Kotlin reflectionApply default values during deserialization when fields are missing from serialized dataSupport schema evolution by allowing new fields with defaults to be added without breaking existing serialized data ","version":"dev","tagName":"h3"},{"title":"Zero-Copy Serialization","type":0,"sectionRef":"#","url":"/docs/next/guide/xlang/zero_copy","content":"","keywords":"","version":"dev"},{"title":"When to Use Zero-Copy‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/next/guide/xlang/zero_copy#when-to-use-zero-copy","content":" Use zero-copy serialization when:  Serializing large byte arrays or binary blobsWorking with numeric arrays (int[], double[], etc.)Transferring data over high-performance networksMemory efficiency is critical  ","version":"dev","tagName":"h2"},{"title":"How It Works‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/next/guide/xlang/zero_copy#how-it-works","content":" Serialization: Large buffers are extracted and returned separately via a callbackTransport: The main serialized data and buffer objects are transmitted separatelyDeserialization: Buffers are provided back to reconstruct the original object  This avoids copying large data into the main serialization buffer.  ","version":"dev","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/next/guide/xlang/zero_copy#java","content":" import org.apache.fory.*; import org.apache.fory.config.*; import org.apache.fory.serializer.BufferObject; import org.apache.fory.memory.MemoryBuffer; import java.util.*; import java.util.stream.Collectors; public class ZeroCopyExample { public static void main(String[] args) { Fory fory = Fory.builder().withLanguage(Language.XLANG).build(); // Data with large arrays List&lt;Object&gt; list = List.of( &quot;str&quot;, new byte[1000], // Large byte array new int[100], // Large int array new double[100] // Large double array ); // Collect buffer objects during serialization Collection&lt;BufferObject&gt; bufferObjects = new ArrayList&lt;&gt;(); byte[] bytes = fory.serialize(list, e -&gt; !bufferObjects.add(e)); // Convert to buffers for transport List&lt;MemoryBuffer&gt; buffers = bufferObjects.stream() .map(BufferObject::toBuffer) .collect(Collectors.toList()); // Deserialize with buffers Object result = fory.deserialize(bytes, buffers); System.out.println(result); } }   ","version":"dev","tagName":"h2"},{"title":"Python‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/next/guide/xlang/zero_copy#python","content":" import array import pyfory import numpy as np fory = pyfory.Fory(xlang=True) # Data with large arrays data = [ &quot;str&quot;, bytes(bytearray(1000)), # Large byte array array.array(&quot;i&quot;, range(100)), # Large int array np.full(100, 0.0, dtype=np.double) # Large numpy array ] # Collect buffer objects during serialization serialized_objects = [] serialized_data = fory.serialize(data, buffer_callback=serialized_objects.append) # Convert to buffers for transport buffers = [obj.to_buffer() for obj in serialized_objects] # Deserialize with buffers result = fory.deserialize(serialized_data, buffers=buffers) print(result)   ","version":"dev","tagName":"h2"},{"title":"Go‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/next/guide/xlang/zero_copy#go","content":" package main import forygo &quot;github.com/apache/fory/go/fory&quot; import &quot;fmt&quot; func main() { serializer := forygo.NewFory(forygo.WithXlang(true)) // Data with large arrays list := []any{ &quot;str&quot;, make([]byte, 1000), // Large byte array } buf := forygo.NewByteBuffer(nil) var bufferObjects []forygo.BufferObject // Collect buffer objects during serialization if err := serializer.SerializeWithCallback(buf, list, func(o forygo.BufferObject) bool { bufferObjects = append(bufferObjects, o) return false }); err != nil { panic(err) } // Convert to buffers for transport var buffers []*forygo.ByteBuffer for _, o := range bufferObjects { buffers = append(buffers, o.ToBuffer()) } // Deserialize with buffers var newList []any if err := serializer.DeserializeWithCallbackBuffers(buf, &amp;newList, buffers); err != nil { panic(err) } fmt.Println(newList) }   ","version":"dev","tagName":"h2"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/next/guide/xlang/zero_copy#javascript","content":" // Zero-copy support coming soon   ","version":"dev","tagName":"h2"},{"title":"Use Cases‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/next/guide/xlang/zero_copy#use-cases","content":" ","version":"dev","tagName":"h2"},{"title":"High-Performance Data Transfer‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/next/guide/xlang/zero_copy#high-performance-data-transfer","content":" When sending large datasets over the network:  // Sender Collection&lt;BufferObject&gt; buffers = new ArrayList&lt;&gt;(); byte[] metadata = fory.serialize(dataObject, e -&gt; !buffers.add(e)); // Send metadata and buffers separately network.sendMetadata(metadata); for (BufferObject buf : buffers) { network.sendBuffer(buf.toBuffer()); } // Receiver byte[] metadata = network.receiveMetadata(); List&lt;MemoryBuffer&gt; buffers = network.receiveBuffers(); Object data = fory.deserialize(metadata, buffers);   ","version":"dev","tagName":"h3"},{"title":"Memory-Mapped Files‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/next/guide/xlang/zero_copy#memory-mapped-files","content":" Zero-copy works well with memory-mapped files:  // Write Collection&lt;BufferObject&gt; buffers = new ArrayList&lt;&gt;(); byte[] data = fory.serialize(largeObject, e -&gt; !buffers.add(e)); writeToFile(&quot;data.bin&quot;, data); for (int i = 0; i &lt; buffers.size(); i++) { writeToFile(&quot;buffer&quot; + i + &quot;.bin&quot;, buffers.get(i).toBuffer()); } // Read byte[] data = readFromFile(&quot;data.bin&quot;); List&lt;MemoryBuffer&gt; buffers = readBufferFiles(); Object result = fory.deserialize(data, buffers);   ","version":"dev","tagName":"h3"},{"title":"Performance Considerations‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/next/guide/xlang/zero_copy#performance-considerations","content":" Threshold: Small arrays may not benefit from zero-copy due to callback overheadNetwork: Zero-copy is most beneficial when buffers can be sent without copyingMemory: Reduces peak memory usage by avoiding buffer copies  ","version":"dev","tagName":"h2"},{"title":"See Also‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/next/guide/xlang/zero_copy#see-also","content":" Serialization - Standard serialization examplesPython Out-of-Band Guide - Python-specific zero-copy details ","version":"dev","tagName":"h2"},{"title":"Overview","type":0,"sectionRef":"#","url":"/docs/next/introduction/overview","content":"","keywords":"","version":"dev"},{"title":"Quick Example‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/introduction/overview#quick-example","content":" Cross-language serialization ‚Äî serialize in Rust, deserialize in Python:  Rust  use fory::{Fory, ForyObject}; #[derive(ForyObject, Debug, PartialEq)] struct User { name: String, age: i32, } fn main() { let mut fory = Fory::default().xlang(true); fory.register::&lt;User&gt;(1); let user = User { name: &quot;Alice&quot;.to_string(), age: 30 }; let bytes = fory.serialize(&amp;user).unwrap(); let decoded: User = fory.deserialize(&amp;bytes).unwrap(); println!(&quot;{:?}&quot;, decoded); // User { name: &quot;Alice&quot;, age: 30 } }   Python  import pyfory from dataclasses import dataclass @dataclass class User: name: str age: pyfory.int32 fory = pyfory.Fory(xlang=True) fory.register(User, type_id=1) user = User(name=&quot;Alice&quot;, age=30) data = fory.serialize(user) decoded = fory.deserialize(data) print(decoded) # User(name='Alice', age=30)   ","version":"dev","tagName":"h2"},{"title":"Key Features‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/introduction/overview#key-features","content":" ","version":"dev","tagName":"h2"},{"title":"üöÄ High-Performance Serialization‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/introduction/overview#-high-performance-serialization","content":" Apache Fory‚Ñ¢ delivers exceptional performance through advanced optimization techniques:  JIT Compilation: Runtime code generation for Java eliminates virtual method calls and inlines hot pathsStatic Code Generation: Compile-time code generation for Rust, C++, and Go delivers peak performance without runtime overheadZero-Copy Operations: Direct memory access without intermediate buffer copies; row format enables random access and partial serializationIntelligent Encoding: Variable-length compression for integers and strings; SIMD acceleration for arrays (Java 16+)Meta Sharing: Class metadata packing reduces redundant type information across serializations  ","version":"dev","tagName":"h3"},{"title":"üîÑ Cross-Language Serialization‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/introduction/overview#-cross-language-serialization","content":" The xlang serialization format enables seamless data exchange across programming languages:  Automatic Type Mapping: Intelligent conversion between language-specific types (type mapping)Reference Preservation: Shared and circular references work correctly across languagesPolymorphism: Objects serialize/deserialize with their actual runtime typesSchema Evolution: Optional forward/backward compatibility for evolving schemasAutomatic Serialization: No IDL or schema definitions required; serialize any object directly without code generation  ","version":"dev","tagName":"h3"},{"title":"üìä Row Format‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/introduction/overview#-row-format","content":" A cache-friendly row format optimized for analytics workloads:  Zero-Copy Random Access: Read individual fields without deserializing entire objectsPartial Operations: Selective field serialization and deserialization for efficiencyApache Arrow Integration: Seamless conversion to columnar format for analytics pipelinesMulti-Language: Available in Java, Python, Rust and C++  ","version":"dev","tagName":"h3"},{"title":"üîí Security & Production-Readiness‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/introduction/overview#-security--production-readiness","content":" Enterprise-grade security and compatibility:  Class Registration: Whitelist-based deserialization control (enabled by default)Depth Limiting: Protection against recursive object graph attacksConfigurable Policies: Custom class checkers and deserialization policiesPlatform Support: Java 8-24, GraalVM native image, multiple OS platforms  ","version":"dev","tagName":"h3"},{"title":"Protocols‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/introduction/overview#protocols","content":" Apache Fory‚Ñ¢ implements multiple binary protocols optimized for different scenarios:  Protocol\tUse Case\tKey FeaturesXlang Serialization\tCross-language object exchange\tAutomatic serialization, references, polymorphism Java Serialization\tHigh-performance Java-only\tDrop-in JDK serialization replacement, 100x faster Row Format\tAnalytics and data processing\tZero-copy random access, Arrow compatibility Python Native\tPython-specific serialization\tPickle/cloudpickle replacement with better performance  All protocols share the same optimized codebase, allowing improvements in one protocol to benefit others.  ","version":"dev","tagName":"h2"},{"title":"Documentation‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/introduction/overview#documentation","content":" ","version":"dev","tagName":"h2"},{"title":"User Guides‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/introduction/overview#user-guides","content":" Guide\tDescription\tSource\tWebsiteJava Serialization\tComprehensive guide for Java serialization\tJava Guide\tüìñ View Cross-Language Serialization\tMulti-language object exchange\tXlang Guide\tüìñ View Row Format\tZero-copy random access format\tJava Row Format\tüìñ View Python\tPython-specific features and usage\tPython Guide\tüìñ View Rust\tRust implementation and patterns\tRust Guide\tüìñ View Go\tGo implementation and usage\tGo Guide\tüìñ View Scala\tScala integration and best practices\tScala Guide\tüìñ View GraalVM\tNative image support and AOT compilation\tGraalVM Guide\tüìñ View Development\tBuilding and contributing to Fory\tDevelopment\tüìñ View  ","version":"dev","tagName":"h3"},{"title":"Protocol Specifications‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/introduction/overview#protocol-specifications","content":" Specification\tDescription\tSource\tWebsiteXlang Serialization\tCross-language binary protocol\txlang_serialization_spec.md\tüìñ View Java Serialization\tJava-optimized protocol\tjava_serialization_spec.md\tüìñ View Row Format\tRow-based binary format\trow_format_spec.md\tüìñ View Type Mapping\tCross-language type conversion\txlang_type_mapping.md\tüìñ View  ","version":"dev","tagName":"h3"},{"title":"Compatibility‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/introduction/overview#compatibility","content":" ","version":"dev","tagName":"h2"},{"title":"Schema Compatibility‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/introduction/overview#schema-compatibility","content":" Apache Fory‚Ñ¢ supports class schema forward/backward compatibility across Java, Python, Rust, and Golang, enabling seamless schema evolution in production systems without requiring coordinated upgrades across all services. Fory provides two schema compatibility modes:  Schema Consistent Mode (Default): Assumes identical class schemas between serialization and deserialization peers. This mode offers minimal serialization overhead, smallest data size, and fastest performance: ideal for stable schemas or controlled environments. Compatible Mode: Supports independent schema evolution with forward and backward compatibility. This mode enables field addition/deletion, limited type evolution, and graceful handling of schema mismatches. Enable using withCompatibleMode(CompatibleMode.COMPATIBLE) in Java, compatible=True in Python, compatible_mode(true) in Rust, or NewFory(true) in Go.  ","version":"dev","tagName":"h3"},{"title":"Binary Compatibility‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/introduction/overview#binary-compatibility","content":" Current Status: Binary compatibility is not guaranteed between Fory major releases as the protocol continues to evolve. However, compatibility is guaranteed between minor versions (e.g., 0.13.x).  Recommendations:  Version your serialized data by Fory major versionPlan migration strategies when upgrading major versionsSee upgrade guide for details  Future: Binary compatibility will be guaranteed starting from Fory 1.0 release.  ","version":"dev","tagName":"h3"},{"title":"Security‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/introduction/overview#security","content":" ","version":"dev","tagName":"h2"},{"title":"Overview‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/introduction/overview#overview","content":" Serialization security varies by protocol:  Row Format: Secure with predefined schemasObject Graph Serialization (Java/Python native): More flexible but requires careful security configuration  Dynamic serialization can deserialize arbitrary types, which may introduces risks. For example, the deserialization may invoke init constructor or equals/hashCode method, if the method body contains malicious code, the system will be at risk.  Fory enables class registration by default for dynamic protocols, allowing only trusted registered types.Do not disable class registration unless you can ensure your environment is secure.  If this option is disabled, you are responsible for serialization security. You should implement and configure a customized ClassChecker or DeserializationPolicy for fine-grained security control  To report security vulnerabilities in Apache Fory‚Ñ¢, please follow the ASF vulnerability reporting process.  ","version":"dev","tagName":"h3"},{"title":"Community and Support‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/introduction/overview#community-and-support","content":" ","version":"dev","tagName":"h2"},{"title":"Getting Help‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/introduction/overview#getting-help","content":" Slack: Join our Slack workspace for community discussionsTwitter/X: Follow @ApacheFory for updates and announcementsGitHub Issues: Report bugs and request features at apache/foryMailing Lists: Subscribe to Apache Fory mailing lists for development discussions  ","version":"dev","tagName":"h3"},{"title":"Contributing‚Äã","type":1,"pageTitle":"Overview","url":"/docs/next/introduction/overview#contributing","content":" We welcome contributions! Please read our Contributing Guide to get started.  Ways to Contribute:  üêõ Report bugs and issuesüí° Propose new featuresüìù Improve documentationüîß Submit pull requestsüß™ Add test casesüìä Share benchmarks  See Development Guide for build instructions and development workflow. ","version":"dev","tagName":"h3"},{"title":"Java Serialization Format","type":0,"sectionRef":"#","url":"/docs/next/specification/java_serialization_spec","content":"","keywords":"","version":"dev"},{"title":"Spec overview‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#spec-overview","content":" Apache Fory Java serialization is a dynamic binary format for Java object graphs. It supports shared references, circular references, polymorphism, and optional schema evolution. The format is stream friendly: shared type metadata is written inline when needed and there is no meta start offset.  The Java native format is an extension of the xlang wire format and reuses the same core framing and encodings; see docs/specification/xlang_serialization_spec.md for the shared baseline.  Overall layout:  | fory header | object ref meta | object type meta | object value data |   All data is encoded in little endian byte order. When running on a big endian platform, array serializers swap byte order on write/read so the on-wire layout remains little endian.  ","version":"dev","tagName":"h2"},{"title":"Fory header‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#fory-header","content":" Java native serialization writes a one byte bitmap header. The header layout mirrors the xlang bitmap and uses the same flag bits.  | 5 bits | 1 bit | 1 bit | 1 bit | +--------------+-------+-------+-------+ | reserved | oob | xlang | null |   null flag: 1 when object is null, 0 otherwise. If object is null, other bits are not set.xlang flag: 1 when serialization uses xlang format, 0 when serialization uses Java native format.oob flag: 1 when BufferCallback is not null, 0 otherwise.  The header is always a single byte; no language ID is written.  ","version":"dev","tagName":"h2"},{"title":"Reference meta‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#reference-meta","content":" Reference tracking uses the same flags as the xlang specification.  Flag\tByte Value\tDescriptionNULL FLAG\t-3\tObject is null. No further bytes are written for this object. REF FLAG\t-2\tObject was already serialized. Followed by unsigned varint32 reference ID. NOT_NULL VALUE FLAG\t-1\tObject is non-null but reference tracking is disabled for this type. Object data follows immediately. REF VALUE FLAG\t0\tObject is referencable and this is its first occurrence. Object data follows. Assigns next reference ID.  When reference tracking is disabled globally or for a specific field/type, only NULL FLAG andNOT_NULL VALUE FLAG are used.  ","version":"dev","tagName":"h2"},{"title":"Type system and type IDs‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#type-system-and-type-ids","content":" Java native serialization uses the unified type ID layout shared with xlang:  full_type_id = (user_type_id &lt;&lt; 8) | internal_type_id   internal_type_id is the low 8 bits describing the kind (enum/struct/ext, named variants, or a built-in type).user_type_id is the numeric registration ID (0-based) for user-defined enum/struct/ext types.Named types use NAMED_* internal IDs and carry names in metadata rather than embedding a user ID.  ","version":"dev","tagName":"h2"},{"title":"Shared internal type IDs (0-63)‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#shared-internal-type-ids-0-63","content":" Java native mode shares the xlang internal IDs for all values below 64. IDs 0~56 are defined by the xlang spec, while 57~63 are reserved for future internal use. These IDs are stable across languages.  See the internal type ID table inXlang Serialization Format. Java shares all IDs &lt; 64, with 57~63 reserved for future internal use.  ","version":"dev","tagName":"h3"},{"title":"Java native built-in type IDs‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#java-native-built-in-type-ids","content":" Java native serialization assigns Java-specific built-ins starting atTypes.BOUND + 5 (Types.BOUND is 64; 5 IDs are reserved for future use). Type IDs in 0~56 are shared with xlang; 57~63 are reserved; 64+ are only valid in Java native mode.  Type ID\tName\tDescription69\tVOID_ID\tjava.lang.Void 70\tCHAR_ID\tjava.lang.Character 71\tPRIMITIVE_VOID_ID\tvoid 72\tPRIMITIVE_BOOL_ID\tboolean 73\tPRIMITIVE_INT8_ID\tbyte 74\tPRIMITIVE_CHAR_ID\tchar 75\tPRIMITIVE_INT16_ID\tshort 76\tPRIMITIVE_INT32_ID\tint 77\tPRIMITIVE_FLOAT32_ID\tfloat 78\tPRIMITIVE_INT64_ID\tlong 79\tPRIMITIVE_FLOAT64_ID\tdouble 80\tPRIMITIVE_BOOLEAN_ARRAY_ID\tboolean[] 81\tPRIMITIVE_BYTE_ARRAY_ID\tbyte[] 82\tPRIMITIVE_CHAR_ARRAY_ID\tchar[] 83\tPRIMITIVE_SHORT_ARRAY_ID\tshort[] 84\tPRIMITIVE_INT_ARRAY_ID\tint[] 85\tPRIMITIVE_FLOAT_ARRAY_ID\tfloat[] 86\tPRIMITIVE_LONG_ARRAY_ID\tlong[] 87\tPRIMITIVE_DOUBLE_ARRAY_ID\tdouble[] 88\tSTRING_ARRAY_ID\tString[] 89\tOBJECT_ARRAY_ID\tObject[] 90\tARRAYLIST_ID\tjava.util.ArrayList 91\tHASHMAP_ID\tjava.util.HashMap 92\tHASHSET_ID\tjava.util.HashSet 93\tCLASS_ID\tjava.lang.Class 94\tEMPTY_OBJECT_ID\tempty object stub 95\tLAMBDA_STUB_ID\tlambda stub 96\tJDK_PROXY_STUB_ID\tJDK proxy stub 97\tREPLACE_STUB_ID\twriteReplace/readResolve stub 98\tNONEXISTENT_META_SHARED_ID\tmeta-shared unknown class stub  ","version":"dev","tagName":"h3"},{"title":"Registration and named types‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#registration-and-named-types","content":" User-defined enum/struct/ext types can be registered by numeric ID or by name.  Numeric registration: full_type_id = (user_id &lt;&lt; 8) | internal_type_id.Name registration: type meta uses namespace and type name (see below).Unregistered types are encoded as named types using namespace = package name and type name = simple class name.  Named type selection rules for unregistered types:  enum -&gt; NAMED_ENUMstruct-like serializers -&gt; NAMED_STRUCT (or NAMED_COMPATIBLE_STRUCT in compatible mode)all other custom serializers -&gt; NAMED_EXT  ","version":"dev","tagName":"h3"},{"title":"Type meta encoding‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#type-meta-encoding","content":" Every value is written with a type ID followed by optional type metadata:  Write type_id using varuint32 small7 encoding.For NAMED_ENUM, NAMED_STRUCT, NAMED_EXT, NAMED_COMPATIBLE_STRUCT: If meta share is enabled: write shared class meta (streaming format).Otherwise: write namespace and type name as meta strings. For COMPATIBLE_STRUCT: If meta share is enabled: write shared class meta (streaming format).Otherwise: no extra meta (type ID is sufficient). All other types: no extra meta.  ","version":"dev","tagName":"h2"},{"title":"Shared class meta (streaming)‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#shared-class-meta-streaming","content":" When meta share is enabled, Java uses the streaming shared meta protocol and writes TypeDef bytes inline on first use.  | varuint32: index_marker | [class def bytes if new] | index_marker = (index &lt;&lt; 1) | flag flag = 1 -&gt; reference flag = 0 -&gt; new type   If flag == 1, this is a reference to a previously written type. No class def bytes follow.If flag == 0, this is a new type definition and class def bytes are written inline.  The index is assigned sequentially in the order types are first encountered.  ","version":"dev","tagName":"h3"},{"title":"Schema modes‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#schema-modes","content":" Java native serialization supports two schema modes:  Schema consistent (compatible mode disabled): fields are serialized in a fixed order and no ClassDef is required. Type meta uses STRUCT or NAMED_STRUCT for user-defined classes.Schema evolution (compatible mode enabled): fields are serialized with schema evolution metadata (ClassDef). Type meta uses COMPATIBLE_STRUCT or NAMED_COMPATIBLE_STRUCT.  ","version":"dev","tagName":"h2"},{"title":"ClassDef format (compatible mode)‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#classdef-format-compatible-mode","content":" ClassDef is the schema evolution metadata encoded for compatible structs. It is written inline when shared meta is enabled, or referenced by index when already seen.  ","version":"dev","tagName":"h2"},{"title":"Binary layout‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#binary-layout","content":" | 8 bytes header | [varuint32 extra size] | class meta bytes |   Header layout (lower bits on the right):  | 50-bit hash | 4 bits reserved | 1 bit compress | 1 bit has_fields_meta | 8-bit size |   size: lower 8 bits. If size equals the mask (0xFF), write extra size as varuint32 and add it.compress: set when payload is compressed.has_fields_meta: set when field metadata is present.reserved: bits 10-13 are reserved for future use and must be zero.hash: 50-bit hash of the payload and flags.  ","version":"dev","tagName":"h3"},{"title":"Class meta bytes‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#class-meta-bytes","content":" Class meta encodes a linearized class hierarchy (from parent to leaf) and field metadata:  | num_classes | class_layer_0 | class_layer_1 | ... | class_layer: | num_fields &lt;&lt; 1 | registered_flag | [type_id if registered] | | namespace | type_name | field_infos |   num_classes stores (num_layers - 1) in a single byte. If it equals 0b1111, read an extra varuint32 small7 and add it.The actual number of layers is num_classes + 1. registered_flag is 1 if the class is registered by numeric ID.If registered by ID, the class type ID follows (varuint32 small7).If registered by name or unregistered, namespace and type name are written as meta strings.  ","version":"dev","tagName":"h3"},{"title":"Field info‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#field-info","content":" Each field uses a compact header followed by its name bytes (omitted when TAG_ID is used) and its type info:  | field_header | [field_name_bytes] | field_type |   field_header bits:  bit 0: trackingRefbit 1: nullablebits 2-3: field name encodingbits 4-6: name length (len-1), or tag ID when TAG_ID is used; value 7 indicates extended lengthbit 7: reserved (0)  Field name encoding:  0: UTF81: ALL_TO_LOWER_SPECIAL2: LOWER_UPPER_DIGIT_SPECIAL3: TAG_ID (field name omitted, tag ID stored in size field)  If length is extended (size==7), an extra varuint32 small7 storing (len-1) - 7 follows.  ","version":"dev","tagName":"h3"},{"title":"Field type encoding‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#field-type-encoding","content":" Field types are encoded with a type tag and optional nested type info. For nested types, the header includes nullable/trackingRef flags in the low bits. Top-level field types use the tag only (no flags).  Type tags:  Tag\tField type0\tObject (ObjectFieldType) 1\tMap (MapFieldType) 2\tCollection/List/Set (CollectionFieldType) 3\tArray (ArrayFieldType) 4\tEnum (EnumFieldType) 5+\tRegistered type (RegisteredFieldType)  Encoding rules:  ObjectFieldType: write tag 0.MapFieldType: write tag 1, then key type, then value type.CollectionFieldType: write tag 2, then element type.ArrayFieldType: write tag 3, then dimensions, then component type.EnumFieldType: write tag 4.RegisteredFieldType: write tag 5 + type_id.  For nested types, nullable/trackingRef flags are stored in the low bits of the header as(type_tag &lt;&lt; 2) | (nullable &lt;&lt; 1) | tracking_ref.  ","version":"dev","tagName":"h3"},{"title":"Meta string encoding‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#meta-string-encoding","content":" Namespace, type names, and field names use the same meta string encodings as the xlang spec.  ","version":"dev","tagName":"h2"},{"title":"Package and type names‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#package-and-type-names","content":" Header format:  | 6 bits size | 2 bits encoding |   size is the byte length of the encoded name.if size == 63, write extra length (size - 63) as varuint32 small7.  Encodings:  Package name: UTF8, ALL_TO_LOWER_SPECIAL, LOWER_UPPER_DIGIT_SPECIALType name: UTF8, LOWER_UPPER_DIGIT_SPECIAL, FIRST_TO_LOWER_SPECIAL, ALL_TO_LOWER_SPECIAL  ","version":"dev","tagName":"h3"},{"title":"Field names‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#field-names","content":" Field name encoding is described in the ClassDef field header section. When using TAG_ID, the field name bytes are omitted and the tag ID is stored in the size field.  ","version":"dev","tagName":"h3"},{"title":"Encoding algorithms‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#encoding-algorithms","content":" See the xlang specification for encoding algorithms and tables:docs/specification/xlang_serialization_spec.md#meta-string.  ","version":"dev","tagName":"h3"},{"title":"Value encodings‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#value-encodings","content":" This section describes the byte layouts for common built-in serializers used in Java native serialization. Custom serializers (EXT) may define additional formats but must still follow the reference and type meta rules described above.  ","version":"dev","tagName":"h2"},{"title":"Primitives‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#primitives","content":" boolean: 1 byte (0x00 or 0x01).byte: 1 byte.short: 2 bytes little endian.char: 2 bytes little endian (UTF-16 code unit).int: fixed: 4 bytes little endian.varint: signed varint32 (ZigZag) when compressInt is enabled. long: fixed: 8 bytes little endian.varint: signed varint64 (ZigZag) when longEncoding=VARINT.tagged: tagged int64 when longEncoding=TAGGED. float: IEEE 754 float32, little endian.double: IEEE 754 float64, little endian.  Varint encodings follow the xlang spec:docs/specification/xlang_serialization_spec.md#unsigned-varint32.  ","version":"dev","tagName":"h3"},{"title":"String‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#string","content":" Strings are encoded as:  | varuint36_small: (num_bytes &lt;&lt; 2) | coder | string bytes |   coder: 2-bit value 0: LATIN11: UTF162: UTF8 num_bytes: byte length of the encoded string payload.  UTF16 is encoded as little endian 2-byte code units.  ","version":"dev","tagName":"h3"},{"title":"Enum‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#enum","content":" If serializeEnumByName is enabled: write enum name as a meta string.Otherwise: write enum ordinal as varuint32 small7.  ","version":"dev","tagName":"h3"},{"title":"Binary (byte[])‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#binary-byte","content":" Primitive byte arrays are encoded as:  | varuint32: num_bytes | raw bytes |   ","version":"dev","tagName":"h3"},{"title":"Primitive arrays‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#primitive-arrays","content":" Primitive arrays use writePrimitiveArrayWithSize unless compression is enabled:  | varuint32: byte_length | raw bytes |   compressIntArray: int[] encoded as | varuint32: length | varint32... |.compressLongArray: long[] encoded as | varuint32: length | varint64/tagged... |.  ","version":"dev","tagName":"h3"},{"title":"Object arrays‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#object-arrays","content":" Object arrays encode length and a monomorphic flag:  | varuint32_small7: (length &lt;&lt; 1) | mono_flag |   If mono_flag == 1, all elements share a known component serializer. Each element uses ref flags and the component serializer writes the value.If mono_flag == 0, each element uses ref flags and writes its own class info and data.  ","version":"dev","tagName":"h3"},{"title":"Collections (List/Set)‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#collections-listset","content":" Collections encode length and a one-byte elements header:  | varuint32_small7: length | elements_header | [elem_class_info] | elements... |   elements_header bits (see CollectionFlags):  bit 0: TRACKING_REFbit 1: HAS_NULLbit 2: IS_DECL_ELEMENT_TYPEbit 3: IS_SAME_TYPE  If IS_SAME_TYPE is set and IS_DECL_ELEMENT_TYPE is not set, the element class info is written once before the elements. Element values then follow with either ref flags (if TRACKING_REF) or per-element null flags (if HAS_NULL).  If IS_SAME_TYPE is not set, each element is written with its own class info and data (and optionally ref flags).  ","version":"dev","tagName":"h3"},{"title":"Maps‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#maps","content":" Maps encode entry count and then a sequence of chunks. Each chunk groups entries that share key and value types.  | varuint32_small7: size | chunk_1 | chunk_2 | ... | chunk (non-null entries): | header | chunk_size | [key_class_info] | [value_class_info] | entries... |   header bits (see MapFlags):  bit 0: TRACKING_KEY_REFbit 1: KEY_HAS_NULLbit 2: KEY_DECL_TYPEbit 3: TRACKING_VALUE_REFbit 4: VALUE_HAS_NULLbit 5: VALUE_DECL_TYPE  If KEY_DECL_TYPE or VALUE_DECL_TYPE is unset, the corresponding class info is written once at the start of the chunk. chunk_size is a single byte (1..255) and MAX_CHUNK_SIZE is 255.  Null key/value entries‚Äã  Entries with null key or null value are encoded as special single-entry chunks without achunk_size byte:  null key, non-null value: NULL_KEY_VALUE_DECL_TYPE* flags, then value payloadnull value, non-null key: NULL_VALUE_KEY_DECL_TYPE* flags, then key payloadnull key and null value: KV_NULL header only  These chunks always represent exactly one entry.  ","version":"dev","tagName":"h3"},{"title":"Objects and structs‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#objects-and-structs","content":" Object values are encoded as:  | ref meta | type meta | field data |   Field data is written by the serializer selected by the class info. For standard object serialization:  Fields are sorted deterministically using DescriptorGrouper order: primitives, boxed primitives, built-ins, collections, maps, then other fields, with names sorted within each category.For compatible mode, MetaSharedSerializer uses ClassDef field metadata to read and skip unknown fields.For each field, the serializer uses field metadata (nullable, trackingRef, polymorphic) to decide whether to write ref flags and/or type meta before the field value.  ","version":"dev","tagName":"h3"},{"title":"Extensions (EXT)‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#extensions-ext","content":" Extension types are encoded by their registered serializer. Type meta is still written before the value as described above. The serializer is responsible for the value layout.  ","version":"dev","tagName":"h3"},{"title":"Out-of-band buffers‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/next/specification/java_serialization_spec#out-of-band-buffers","content":" When a BufferCallback is provided, the oob flag is set in the header and serializers may emit buffer references instead of inline bytes (for example, large primitive arrays). The out-of-band buffer protocol is specific to the callback implementation; the main stream only contains references to those buffers. ","version":"dev","tagName":"h2"},{"title":"Row Format","type":0,"sectionRef":"#","url":"/docs/next/specification/row_format_spec","content":"","keywords":"","version":"dev"},{"title":"Overview‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#overview","content":" Apache Fory Row Format is a cache-friendly, random-access binary format designed for high-performance data processing. Unlike traditional serialization formats that require full deserialization, the row format enables:  Random Field Access: Read individual fields without deserializing the entire rowZero-Copy Operations: Direct memory access without data transformationCache-Friendly Layout: Optimized memory layout for CPU cache efficiencyCross-Language Support: Consistent binary format across Java, C++, and Python  Fory provides two row format variants:  Format\tLanguages\tUse CaseStandard Format\tJava, C++, Python\tCross-language compatibility Compact Format\tJava only\tSpace efficiency, smaller rows  ","version":"dev","tagName":"h2"},{"title":"Format Comparison‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#format-comparison","content":" Feature\tStandard Format\tCompact FormatField Slot Size\tFixed 8 bytes\tNatural width (1, 2, 4, or 8 bytes) Null Bitmap Size\t8-byte aligned\tByte-aligned, can borrow padding Null Bitmap Position\tBefore field slots\tAfter field slots (at end) Fixed-Size Structs\tVariable region (offset+size)\tInline in fixed region Field Ordering\tSchema-defined order\tSorted by alignment All Non-Nullable\tBitmap still present\tBitmap skipped entirely Alignment\tStrict 8-byte\tRelaxed (2, 4, or 8-byte)    ","version":"dev","tagName":"h2"},{"title":"Standard Row Format‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#standard-row-format","content":" The standard format prioritizes cross-language compatibility and simplicity with uniform 8-byte field slots.  ","version":"dev","tagName":"h2"},{"title":"Design Principles‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#design-principles","content":" 8-Byte Alignment: All major structures are aligned to 8-byte boundaries for optimal memory accessFixed-Width Field Slots: Every field uses an 8-byte slot for uniform offset calculationNull Bitmap: Compact null tracking using bit vectorsRelative Offsets: Variable-length data uses relative offsets for sub-buffer navigation  ","version":"dev","tagName":"h3"},{"title":"Row Binary Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#row-binary-layout","content":" A row stores structured data with the following layout:  +----------------+------------------+------------------+-----+------------------+------------------+ | Null Bitmap | Field 0 Slot | Field 1 Slot | ... | Field N-1 Slot | Variable Data | +----------------+------------------+------------------+-----+------------------+------------------+ | B bytes | 8 bytes | 8 bytes | | 8 bytes | Variable size |   Null Bitmap‚Äã  The null bitmap tracks which fields contain null values:  Size: ((num_fields + 63) / 64) * 8 bytes (rounded up to nearest 8-byte word)Encoding: Each bit corresponds to a field index Bit value 1 = field is nullBit value 0 = field is not null Bit Order: Bit 0 of the first byte corresponds to field 0  Example: For 10 fields, bitmap size = ((10 + 63) / 64) * 8 = 8 bytes  Field Slots‚Äã  Each field occupies a fixed 8-byte slot regardless of its actual data type:  Slot Offset: bitmap_size + field_index * 8Total Fixed Region: bitmap_size + num_fields * 8 bytes  Field Slot Contents by Type:  Type Category\tSlot ContentsFixed-width\tValue stored directly (zero-padded) Variable-width\tOffset + Size encoding (see below)  Variable-Width Data Encoding‚Äã  Variable-length fields (strings, arrays, maps, nested structs) store an offset-size pair in their slot:  +---------------------------+---------------------------+ | Relative Offset | Size | | (32 bits) | (32 bits) | +---------------------------+---------------------------+ |&lt;-------------- 64-bit field slot value --------------&gt;|   Relative Offset (upper 32 bits): Offset from the row's base addressSize (lower 32 bits): Size of the variable-width data in bytes  Encoding:  offset_and_size = (relative_offset &lt;&lt; 32) | size   Decoding:  relative_offset = (offset_and_size &gt;&gt; 32) &amp; 0xFFFFFFFF size = offset_and_size &amp; 0xFFFFFFFF   Variable Data Region‚Äã  Variable-length data is stored after the fixed region:  Data is written sequentially as fields are setEach variable-length value is padded to 8-byte alignmentPadding bytes are zeroed for deterministic output  ","version":"dev","tagName":"h3"},{"title":"Array Binary Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#array-binary-layout","content":" Arrays store homogeneous sequences of elements:  +------------------+------------------+------------------+ | Element Count | Null Bitmap | Element Data | +------------------+------------------+------------------+ | 8 bytes | B bytes | Variable size |   Array Header‚Äã  Field\tSize\tDescriptionElement Count\t8 bytes\tNumber of elements (uint64) Null Bitmap\t((count + 63) / 64) * 8 bytes\tPer-element null flags  Header Size: 8 + ((num_elements + 63) / 64) * 8 bytes  Array Element Data‚Äã  Elements are stored contiguously after the header:  Fixed-width elements: Stored with their natural width (1, 2, 4, or 8 bytes)Variable-width elements: Stored as 8-byte offset+size pairs  Element Offset: header_size + element_index * element_size  Data Region Size: Rounded up to nearest 8-byte boundary  Array Element Sizes‚Äã  Element Type\tElement Sizebool\t1 byte int8\t1 byte int16\t2 bytes int32\t4 bytes int64\t8 bytes float32\t4 bytes float64\t8 bytes string/binary\t8 bytes (offset+size) array/map/struct\t8 bytes (offset+size)  ","version":"dev","tagName":"h3"},{"title":"Map Binary Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#map-binary-layout","content":" Maps store key-value pairs as two separate arrays:  +------------------+------------------+------------------+ | Keys Array Size | Keys Array | Values Array | +------------------+------------------+------------------+ | 8 bytes | Variable size | Variable size |   Map Structure‚Äã  Field\tSize\tDescriptionKeys Array Size\t8 bytes\tTotal size of keys array in bytes Keys Array\tVariable\tFull array structure for keys Values Array\tVariable\tFull array structure for values  Keys Array Offset: base_offset + 8Values Array Offset: base_offset + 8 + keys_array_size  Both keys and values arrays follow the standard array binary layout.  ","version":"dev","tagName":"h3"},{"title":"Nested Struct Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#nested-struct-layout","content":" Nested structs are stored as complete row structures within the variable data region:  Parent field slot contains offset+size pointing to nested rowNested row has its own null bitmap and field slotsSupports arbitrary nesting depth  Parent Row: +----------------+------------------+------------------+ | Null Bitmap | ... Slots ... | Nested Row Data | +----------------+------------------+------------------+ | ^ | offset+size | +-------------------&gt;+ Nested Row: +----------------+------------------+------------------+ | Null Bitmap | Field Slots | Variable Data | +----------------+------------------+------------------+     ","version":"dev","tagName":"h3"},{"title":"Compact Row Format (Java Only)‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#compact-row-format-java-only","content":" The compact format provides space-efficient encoding with additional optimizations. It is currently implemented in Java only.  Note: The compact format is still under development and may not be stable yet.  ","version":"dev","tagName":"h2"},{"title":"Design Principles‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#design-principles-1","content":" Natural Width Storage: Fixed-size fields use their natural byte width instead of 8 bytesAlignment-Based Field Sorting: Fields are sorted by alignment requirements to minimize paddingConditional Null Bitmap: Null bitmap is omitted when all fields are non-nullableInline Fixed-Size Structs: Nested structs with all fixed-size fields are stored inline  ","version":"dev","tagName":"h3"},{"title":"Compact Row Binary Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#compact-row-binary-layout","content":" +------------------+------------------+-----+------------------+----------------+------------------+ | Field 0 Value | Field 1 Value | ... | Field N-1 Value | Null Bitmap | Variable Data | +------------------+------------------+-----+------------------+----------------+------------------+ | W0 bytes | W1 bytes | | WN-1 bytes | B bytes (opt) | Variable size |   Key Differences from Standard Format‚Äã  Field Slot Sizes: Each field uses its natural width (Wi = type width or 8 for variable)Null Bitmap Position: Placed after field slots, can borrow alignment paddingField Order: Fields are sorted by alignment (8-byte ‚Üí 4-byte ‚Üí 2-byte ‚Üí 1-byte ‚Üí variable)Conditional Bitmap: Skipped entirely if all fields are non-nullable  Null Bitmap (Compact)‚Äã  Size: (num_nullable_fields + 7) / 8 bytes (byte-aligned, not 8-byte aligned)Skipped: When all fields are primitive/non-nullablePosition: After all fixed-size field slots, can use alignment padding space  Field Sorting Algorithm‚Äã  Fields are sorted to minimize padding and optimize alignment:  Priority order (highest to lowest): 1. Fields with 8-byte alignment (int64, float64, variable-width) 2. Fields with 4-byte alignment (int32, float32) 3. Fields with 2-byte alignment (int16) 4. Fields with 1-byte alignment (int8, bool)   Within each alignment group, larger fields come first.  Fixed-Size Struct Inlining‚Äã  Nested structs with all fixed-size fields are stored inline in the parent row:  Standard Format (nested struct with 2 int32 fields):  Parent slot: [offset (4 bytes) | size (4 bytes)] ‚Üí Points to nested row (8+ bytes elsewhere)   Compact Format (same nested struct):  Parent slot: [int32 field 0 | int32 field 1] ‚Üí 8 bytes total, inline   This eliminates the offset+size indirection for fixed-size nested structures.  Fixed-Width Calculation‚Äã  A field's fixed width is determined recursively:  Primitive types: Natural byte width (1, 2, 4, or 8)Struct types: Sum of all child fixed widths (if all children are fixed-width)Variable types (string, array, map): Returns -1 (uses 8-byte offset+size slot)  fixed_width(field) = if primitive: type_width if struct and all_children_fixed: header_bytes + sum(fixed_width(child) for each child) else: -1 (variable, uses 8-byte slot)   ","version":"dev","tagName":"h3"},{"title":"Compact Array Binary Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#compact-array-binary-layout","content":" +------------------+------------------+------------------+ | Element Count | Null Bitmap | Element Data | +------------------+------------------+------------------+ | 4 bytes | B bytes (opt) | Variable size |   Compact Array Header‚Äã  Field\tSize\tDescriptionElement Count\t4 bytes\tNumber of elements (int32) Null Bitmap\t(count + 7) / 8 bytes (opt)\tPer-element null flags  Header Size Calculation:  header_size = 4 + (element_nullable ? (num_elements + 7) / 8 : 0) // Round to 8-byte boundary only if element width is 8-byte aligned if (fixed_width % 8 == 0): header_size = round_to_8_bytes(header_size)   Key Differences from Standard Array‚Äã  Element Count: 4 bytes instead of 8 bytesNull Bitmap: Byte-aligned, skipped if elements are non-nullableFixed-Size Structs: Inline storage for fixed-width struct elements    ","version":"dev","tagName":"h3"},{"title":"Common Specifications‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#common-specifications","content":" The following specifications apply to both standard and compact formats.  ","version":"dev","tagName":"h2"},{"title":"Type Encoding‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#type-encoding","content":" Primitive Types‚Äã  Type\tWidth\tEncodingbool\t1 byte\t0x00 (false) or 0x01 (true) int8\t1 byte\tTwo's complement int16\t2 bytes\tTwo's complement, little-endian int32\t4 bytes\tTwo's complement, little-endian int64\t8 bytes\tTwo's complement, little-endian float32\t4 bytes\tIEEE 754 single precision float64\t8 bytes\tIEEE 754 double precision  Temporal Types‚Äã  Type\tWidth\tEncodingtimestamp\t8 bytes\tMicroseconds since Unix epoch (int64) date32\t4 bytes\tDays since Unix epoch (int32) duration\t8 bytes\tDuration in microseconds (int64)  String and Binary‚Äã  Encoding: UTF-8 for strings, raw bytes for binaryStorage: Offset+size pair in field slot, data in variable regionPadding: Data padded to 8-byte alignment (standard) or natural alignment (compact)  ","version":"dev","tagName":"h3"},{"title":"Null Handling‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#null-handling","content":" Row Null Handling‚Äã  Null fields have their corresponding bit set to 1 in the null bitmapField slot contents are undefined for null fields (standard) or zeroed (compact)Reading a null field returns a null/empty value indicator  Array Null Handling‚Äã  Null elements have their corresponding bit set to 1 in the array's null bitmapElement data is undefined for null elementsCompact format: Bitmap skipped if elements are non-nullable  Variable-Width Null Semantics‚Äã  When reading variable-width data from a null field:  Returns size of -1 or equivalent null indicatorNo data access is performed  ","version":"dev","tagName":"h3"},{"title":"Alignment and Padding‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#alignment-and-padding","content":" Standard Format Alignment‚Äã  Null Bitmap: Size rounded to 8-byte boundaryField Slots: Always 8 bytes eachVariable Data: Each value padded to 8-byte boundaryArray Data: Total data region padded to 8-byte boundary  Compact Format Alignment‚Äã  Field Slots: Natural width (1, 2, 4, or 8 bytes)Null Bitmap: Byte-aligned, placed after fieldsVariable Data: Padded to 8-byte boundary only when neededHeader: May use relaxed alignment for smaller overhead  Padding Bytes‚Äã  All padding bytes must be set to zeroEnsures deterministic serialization outputPrevents information leakage from uninitialized memory  ","version":"dev","tagName":"h3"},{"title":"Size Calculations‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#size-calculations","content":" ","version":"dev","tagName":"h2"},{"title":"Standard Row Size‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#standard-row-size","content":" row_size = bitmap_size + num_fields * 8 + variable_data_size where: bitmap_size = ((num_fields + 63) / 64) * 8 variable_data_size = sum of (padded_size for each variable field) padded_size = ((size + 7) / 8) * 8   ","version":"dev","tagName":"h3"},{"title":"Compact Row Size‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#compact-row-size","content":" row_size = fixed_region_size + bitmap_size + variable_data_size where: fixed_region_size = sum of (fixed_width(field) or 8 for each field) bitmap_size = all_non_nullable ? 0 : (num_nullable_fields + 7) / 8 // May be rounded to 8-byte boundary if has variable fields   ","version":"dev","tagName":"h3"},{"title":"Standard Array Size‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#standard-array-size","content":" array_size = header_size + data_size where: header_size = 8 + ((num_elements + 63) / 64) * 8 data_size = ((num_elements * element_size + 7) / 8) * 8   ","version":"dev","tagName":"h3"},{"title":"Compact Array Size‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#compact-array-size","content":" array_size = header_size + data_size where: header_size = 4 + (element_nullable ? (num_elements + 7) / 8 : 0) // header_size rounded to 8 if element_width % 8 == 0 data_size = num_elements * element_width   ","version":"dev","tagName":"h3"},{"title":"Map Size‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#map-size","content":" map_size = 8 + keys_array_size + values_array_size   ","version":"dev","tagName":"h3"},{"title":"Summary Tables‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#summary-tables","content":" ","version":"dev","tagName":"h2"},{"title":"Layout Summary‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#layout-summary","content":" Component\tStandard Format\tCompact FormatRow Header\t((N + 63) / 64) * 8 bytes\t0 or (N + 7) / 8 bytes (at end) Row Field Slots\tN * 8 bytes\tsum(field_widths) bytes Array Header\t8 + ((E + 63) / 64) * 8 bytes\t4 + (E + 7) / 8 bytes (if nullable) Array Elements\tE * element_size (8-aligned)\tE * element_width Map Header\t8 bytes\t8 bytes Offset+Size Pair\t8 bytes (32-bit offset + size)\t8 bytes (same)  Where N = number of fields, E = number of elements  ","version":"dev","tagName":"h3"},{"title":"Type Width Summary‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#type-width-summary","content":" Category\tStorage Width\tStandard Slot\tCompact Slotbool\t1 byte\t8 bytes\t1 byte int8\t1 byte\t8 bytes\t1 byte int16\t2 bytes\t8 bytes\t2 bytes int32\t4 bytes\t8 bytes\t4 bytes int64\t8 bytes\t8 bytes\t8 bytes float32\t4 bytes\t8 bytes\t4 bytes float64\t8 bytes\t8 bytes\t8 bytes string/binary\tVariable\t8 bytes\t8 bytes array\tVariable\t8 bytes\t8 bytes map\tVariable\t8 bytes\t8 bytes struct\tVariable\t8 bytes\tinline or 8  ","version":"dev","tagName":"h3"},{"title":"Implementation Notes‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#implementation-notes","content":" ","version":"dev","tagName":"h2"},{"title":"Endianness‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#endianness","content":" All multi-byte integers are stored in little-endian formatFloating-point values use native IEEE 754 representation  ","version":"dev","tagName":"h3"},{"title":"Memory Safety‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#memory-safety","content":" Writers must zero padding bytes to prevent information leakageReaders must validate offsets and sizes before accessing dataBuffer bounds checking is required for untrusted input  ","version":"dev","tagName":"h3"},{"title":"Performance Considerations‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#performance-considerations","content":" Standard Format:  Fixed 8-byte slots enable O(1) field access with simple arithmetic8-byte alignment optimizes CPU cache line usageBest for cross-language interoperability  Compact Format:  Smaller row sizes reduce memory bandwidthField sorting minimizes padding wasteInline structs eliminate pointer chasingRelaxed alignment may have slight CPU overhead on some architectures  ","version":"dev","tagName":"h3"},{"title":"When to Use Each Format‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/next/specification/row_format_spec#when-to-use-each-format","content":" Scenario\tRecommended FormatCross-language data exchange\tStandard Java-only, memory-constrained\tCompact Many small primitive fields\tCompact Many nested fixed-size structs\tCompact Maximum read performance\tStandard Interoperability with C++/Python\tStandard ","version":"dev","tagName":"h3"},{"title":"Serialization","type":0,"sectionRef":"#","url":"/docs/next/guide/xlang/serialization","content":"","keywords":"","version":"dev"},{"title":"Serialize Built-in Types‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/next/guide/xlang/serialization#serialize-built-in-types","content":" Common types can be serialized automatically without registration: primitive numeric types, string, binary, array, list, map, and more.  ","version":"dev","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/next/guide/xlang/serialization#java","content":" import org.apache.fory.*; import org.apache.fory.config.*; import java.util.*; public class Example1 { public static void main(String[] args) { Fory fory = Fory.builder().withLanguage(Language.XLANG).build(); List&lt;Object&gt; list = ofArrayList(true, false, &quot;str&quot;, -1.1, 1, new int[100], new double[20]); byte[] bytes = fory.serialize(list); // bytes can be deserialized by other languages fory.deserialize(bytes); Map&lt;Object, Object&gt; map = new HashMap&lt;&gt;(); map.put(&quot;k1&quot;, &quot;v1&quot;); map.put(&quot;k2&quot;, list); map.put(&quot;k3&quot;, -1); bytes = fory.serialize(map); // bytes can be deserialized by other languages fory.deserialize(bytes); } }   ","version":"dev","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/next/guide/xlang/serialization#python","content":" import pyfory import numpy as np fory = pyfory.Fory(xlang=True) object_list = [True, False, &quot;str&quot;, -1.1, 1, np.full(100, 0, dtype=np.int32), np.full(20, 0.0, dtype=np.double)] data = fory.serialize(object_list) # bytes can be deserialized by other languages new_list = fory.deserialize(data) object_map = {&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: object_list, &quot;k3&quot;: -1} data = fory.serialize(object_map) # bytes can be deserialized by other languages new_map = fory.deserialize(data) print(new_map)   ","version":"dev","tagName":"h3"},{"title":"Go‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/next/guide/xlang/serialization#go","content":" package main import forygo &quot;github.com/apache/fory/go/fory&quot; import &quot;fmt&quot; func main() { list := []any{true, false, &quot;str&quot;, -1.1, 1, make([]int32, 10), make([]float64, 20)} fory := forygo.NewFory(forygo.WithXlang(true)) bytes, err := fory.Marshal(list) if err != nil { panic(err) } var newValue any // bytes can be deserialized by other languages if err := fory.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) dict := map[string]any{ &quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: list, &quot;k3&quot;: -1, } bytes, err = fory.Marshal(dict) if err != nil { panic(err) } // bytes can be deserialized by other languages if err := fory.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) }   ","version":"dev","tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/next/guide/xlang/serialization#javascript","content":" import Fory from &quot;@apache-fory/fory&quot;; /** * @apache-fory/hps use v8's fast-calls-api that can be called directly by jit, * ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment. * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from &quot;@apache-fory/hps&quot;; const fory = new Fory({ hps }); const input = fory.serialize(&quot;hello fory&quot;); const result = fory.deserialize(input); console.log(result);   ","version":"dev","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/next/guide/xlang/serialization#rust","content":" use fory::Fory; fn run() { let fory = Fory::default().xlang(true); let bin = fory.serialize(&amp;&quot;hello&quot;.to_string()).expect(&quot;serialize success&quot;); let obj: String = fory.deserialize(&amp;bin).expect(&quot;deserialize success&quot;); assert_eq!(&quot;hello&quot;.to_string(), obj); }   ","version":"dev","tagName":"h3"},{"title":"Serialize Custom Types‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/next/guide/xlang/serialization#serialize-custom-types","content":" User-defined types must be registered using the register API to establish the mapping relationship between types in different languages. Use consistent type names across all languages.  ","version":"dev","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/next/guide/xlang/serialization#java-1","content":" import org.apache.fory.*; import org.apache.fory.config.*; import java.util.*; public class Example2 { public static class SomeClass1 { Object f1; Map&lt;Byte, Integer&gt; f2; } public static class SomeClass2 { Object f1; String f2; List&lt;Object&gt; f3; Map&lt;Byte, Integer&gt; f4; Byte f5; Short f6; Integer f7; Long f8; Float f9; Double f10; short[] f11; List&lt;Short&gt; f12; } public static Object createObject() { SomeClass1 obj1 = new SomeClass1(); obj1.f1 = true; obj1.f2 = ofHashMap((byte) -1, 2); SomeClass2 obj = new SomeClass2(); obj.f1 = obj1; obj.f2 = &quot;abc&quot;; obj.f3 = ofArrayList(&quot;abc&quot;, &quot;abc&quot;); obj.f4 = ofHashMap((byte) 1, 2); obj.f5 = Byte.MAX_VALUE; obj.f6 = Short.MAX_VALUE; obj.f7 = Integer.MAX_VALUE; obj.f8 = Long.MAX_VALUE; obj.f9 = 1.0f / 2; obj.f10 = 1 / 3.0; obj.f11 = new short[]{(short) 1, (short) 2}; obj.f12 = ofArrayList((short) -1, (short) 4); return obj; } // mvn exec:java -Dexec.mainClass=&quot;org.apache.fory.examples.Example2&quot; public static void main(String[] args) { Fory fory = Fory.builder().withLanguage(Language.XLANG).build(); fory.register(SomeClass1.class, &quot;example.SomeClass1&quot;); fory.register(SomeClass2.class, &quot;example.SomeClass2&quot;); byte[] bytes = fory.serialize(createObject()); // bytes can be deserialized by other languages System.out.println(fory.deserialize(bytes)); } }   ","version":"dev","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/next/guide/xlang/serialization#python-1","content":" from dataclasses import dataclass from typing import List, Dict, Any import pyfory, array @dataclass class SomeClass1: f1: Any f2: Dict[pyfory.Int8Type, pyfory.Int32Type] @dataclass class SomeClass2: f1: Any = None f2: str = None f3: List[str] = None f4: Dict[pyfory.Int8Type, pyfory.Int32Type] = None f5: pyfory.Int8Type = None f6: pyfory.Int16Type = None f7: pyfory.Int32Type = None # int type will be taken as `pyfory.Int64Type`. # use `pyfory.Int32Type` for type hint if peer uses more narrow type. f8: int = None f9: pyfory.Float32Type = None # float type will be taken as `pyfory.Float64Type` f10: float = None f11: pyfory.Int16ArrayType = None f12: List[pyfory.Int16Type] = None if __name__ == &quot;__main__&quot;: f = pyfory.Fory(xlang=True) f.register_type(SomeClass1, typename=&quot;example.SomeClass1&quot;) f.register_type(SomeClass2, typename=&quot;example.SomeClass2&quot;) obj1 = SomeClass1(f1=True, f2={-1: 2}) obj = SomeClass2( f1=obj1, f2=&quot;abc&quot;, f3=[&quot;abc&quot;, &quot;abc&quot;], f4={1: 2}, f5=2 ** 7 - 1, f6=2 ** 15 - 1, f7=2 ** 31 - 1, f8=2 ** 63 - 1, f9=1.0 / 2, f10=1 / 3.0, f11=array.array(&quot;h&quot;, [1, 2]), f12=[-1, 4], ) data = f.serialize(obj) # bytes can be deserialized by other languages print(f.deserialize(data))   ","version":"dev","tagName":"h3"},{"title":"Go‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/next/guide/xlang/serialization#go-1","content":" package main import forygo &quot;github.com/apache/fory/go/fory&quot; import &quot;fmt&quot; func main() { type SomeClass1 struct { F1 any F2 map[int8]int32 } type SomeClass2 struct { F1 any F2 string F3 []any F4 map[int8]int32 F5 int8 F6 int16 F7 int32 F8 int64 F9 float32 F10 float64 F11 []int16 F12 []int16 } serializer := forygo.NewFory(forygo.WithXlang(true)) if err := serializer.RegisterNamedStruct(SomeClass1{}, &quot;example.SomeClass1&quot;); err != nil { panic(err) } if err := serializer.RegisterNamedStruct(SomeClass2{}, &quot;example.SomeClass2&quot;); err != nil { panic(err) } obj1 := &amp;SomeClass1{F1: true, F2: map[int8]int32{-1: 2}} obj := &amp;SomeClass2{ F1: obj1, F2: &quot;abc&quot;, F3: []any{&quot;abc&quot;, &quot;abc&quot;}, F4: map[int8]int32{1: 2}, F5: 127, F6: 32767, F7: 2147483647, F8: 9223372036854775807, F9: 1.0 / 2, F10: 1.0 / 3.0, F11: []int16{1, 2}, F12: []int16{-1, 4}, } bytes, err := serializer.Marshal(obj) if err != nil { panic(err) } var newValue any // bytes can be deserialized by other languages if err := serializer.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) }   ","version":"dev","tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/next/guide/xlang/serialization#javascript-1","content":" import Fory, { Type, InternalSerializerType } from &quot;@apache-fory/fory&quot;; /** * @apache-fory/hps use v8's fast-calls-api that can be called directly by jit, * ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment. * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from &quot;@apache-fory/hps&quot;; // Describe data structures using JSON schema const description = Type.object(&quot;example.foo&quot;, { foo: Type.string(), }); const fory = new Fory({ hps }); const { serialize, deserialize } = fory.registerSerializer(description); const input = serialize({ foo: &quot;hello fory&quot; }); const result = deserialize(input); console.log(result);   ","version":"dev","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/next/guide/xlang/serialization#rust-1","content":" use chrono::{NaiveDate, NaiveDateTime}; use fory::{Fory, ForyObject}; use std::collections::HashMap; #[test] fn complex_struct() { #[derive(ForyObject, Debug, PartialEq)] struct Animal { category: String, } #[derive(ForyObject, Debug, PartialEq)] struct Person { c1: Vec&lt;u8&gt;, // binary c2: Vec&lt;i16&gt;, // primitive array animal: Vec&lt;Animal&gt;, c3: Vec&lt;Vec&lt;u8&gt;&gt;, name: String, c4: HashMap&lt;String, String&gt;, age: u16, op: Option&lt;String&gt;, op2: Option&lt;String&gt;, date: NaiveDate, time: NaiveDateTime, c5: f32, c6: f64, } let person: Person = Person { c1: vec![1, 2, 3], c2: vec![5, 6, 7], c3: vec![vec![1, 2], vec![1, 3]], animal: vec![Animal { category: &quot;Dog&quot;.to_string(), }], c4: HashMap::from([ (&quot;hello1&quot;.to_string(), &quot;hello2&quot;.to_string()), (&quot;hello2&quot;.to_string(), &quot;hello3&quot;.to_string()), ]), age: 12, name: &quot;helo&quot;.to_string(), op: Some(&quot;option&quot;.to_string()), op2: None, date: NaiveDate::from_ymd_opt(2025, 12, 12).unwrap(), time: NaiveDateTime::from_timestamp_opt(1689912359, 0).unwrap(), c5: 2.0, c6: 4.0, }; let mut fory = Fory::default().xlang(true); fory .register_by_namespace::&lt;Animal&gt;(&quot;example&quot;, &quot;foo2&quot;) .expect(&quot;register Animal&quot;); fory .register_by_namespace::&lt;Person&gt;(&quot;example&quot;, &quot;foo&quot;) .expect(&quot;register Person&quot;); let bin = fory.serialize(&amp;person).expect(&quot;serialize success&quot;); let obj: Person = fory.deserialize(&amp;bin).expect(&quot;deserialize success&quot;); assert_eq!(person, obj); }   ","version":"dev","tagName":"h3"},{"title":"Serialize Shared and Circular References‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/next/guide/xlang/serialization#serialize-shared-and-circular-references","content":" Shared references and circular references can be serialized automatically with no duplicate data or recursion errors. Enable reference tracking to use this feature.  ","version":"dev","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/next/guide/xlang/serialization#java-2","content":" import org.apache.fory.*; import org.apache.fory.config.*; import java.util.*; public class ReferenceExample { public static class SomeClass { SomeClass f1; Map&lt;String, String&gt; f2; Map&lt;String, String&gt; f3; } public static Object createObject() { SomeClass obj = new SomeClass(); obj.f1 = obj; obj.f2 = ofHashMap(&quot;k1&quot;, &quot;v1&quot;, &quot;k2&quot;, &quot;v2&quot;); obj.f3 = obj.f2; return obj; } // mvn exec:java -Dexec.mainClass=&quot;org.apache.fory.examples.ReferenceExample&quot; public static void main(String[] args) { Fory fory = Fory.builder().withLanguage(Language.XLANG) .withRefTracking(true).build(); fory.register(SomeClass.class, &quot;example.SomeClass&quot;); byte[] bytes = fory.serialize(createObject()); // bytes can be deserialized by other languages System.out.println(fory.deserialize(bytes)); } }   ","version":"dev","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/next/guide/xlang/serialization#python-2","content":" from typing import Dict import pyfory class SomeClass: f1: &quot;SomeClass&quot; f2: Dict[str, str] f3: Dict[str, str] fory = pyfory.Fory(xlang=True, ref=True) fory.register_type(SomeClass, typename=&quot;example.SomeClass&quot;) obj = SomeClass() obj.f2 = {&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: &quot;v2&quot;} obj.f1, obj.f3 = obj, obj.f2 data = fory.serialize(obj) # bytes can be deserialized by other languages print(fory.deserialize(data))   ","version":"dev","tagName":"h3"},{"title":"Go‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/next/guide/xlang/serialization#go-2","content":" package main import forygo &quot;github.com/apache/fory/go/fory&quot; import &quot;fmt&quot; func main() { type SomeClass struct { F1 *SomeClass F2 map[string]string F3 map[string]string } fory := forygo.NewFory( forygo.WithXlang(true), forygo.WithTrackRef(true), ) if err := fory.RegisterStruct(SomeClass{}, 65); err != nil { panic(err) } value := &amp;SomeClass{F2: map[string]string{&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: &quot;v2&quot;}} value.F3 = value.F2 value.F1 = value bytes, err := fory.Marshal(value) if err != nil { panic(err) } var newValue any // bytes can be deserialized by other languages if err := fory.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) }   ","version":"dev","tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/next/guide/xlang/serialization#javascript-2","content":" import Fory, { Type } from &quot;@apache-fory/fory&quot;; /** * @apache-fory/hps use v8's fast-calls-api that can be called directly by jit, * ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment. * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from &quot;@apache-fory/hps&quot;; const description = Type.object(&quot;example.foo&quot;, { foo: Type.string(), bar: Type.object(&quot;example.foo&quot;), }); const fory = new Fory({ hps }); const { serialize, deserialize } = fory.registerSerializer(description); const data: any = { foo: &quot;hello fory&quot;, }; data.bar = data; const input = serialize(data); const result = deserialize(input); console.log(result.bar.foo === result.foo);   ","version":"dev","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/next/guide/xlang/serialization#rust-2","content":" Circular references cannot be implemented in Rust due to ownership restrictions.  ","version":"dev","tagName":"h3"},{"title":"See Also‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/next/guide/xlang/serialization#see-also","content":" Zero-Copy Serialization - Out-of-band serialization for large dataType Mapping - Cross-language type mapping referenceGetting Started - Installation and setupXlang Serialization Specification - Binary protocol details ","version":"dev","tagName":"h2"},{"title":"Xlang Implementation Guide","type":0,"sectionRef":"#","url":"/docs/next/specification/xlang_implementation_guide","content":"","keywords":"","version":"dev"},{"title":"Implementation guidelines‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/next/specification/xlang_implementation_guide#implementation-guidelines","content":" ","version":"dev","tagName":"h2"},{"title":"How to reduce memory read/write code‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/next/specification/xlang_implementation_guide#how-to-reduce-memory-readwrite-code","content":" Try to merge multiple bytes into an int/long write before writing to reduce memory IO and bound check cost.Read multiple bytes as an int/long, then split into multiple bytes to reduce memory IO and bound check cost.Try to use one varint/long to write flags and length together to save one byte cost and reduce memory io.Condition branches are less expensive compared to memory IO cost unless there are too many branches.  ","version":"dev","tagName":"h3"},{"title":"Fast deserialization for static languages without runtime codegen support‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/next/specification/xlang_implementation_guide#fast-deserialization-for-static-languages-without-runtime-codegen-support","content":" For type evolution, the serializer will encode the type meta into the serialized data. The deserializer will compare this meta with class meta in the current process, and use the diff to determine how to deserialize the data.  For java/javascript/python, we can use the diff to generate serializer code at runtime and load it as class/function for deserialization. In this way, the type evolution will be as fast as type consist mode.  For C++/Rust, we can't generate the serializer code at runtime. So we need to generate the code at compile-time using meta programming. But at that time, we don't know the type schema in other processes, so we can't generate the serializer code for such inconsistent types. We may need to generate the code which has a loop and compare field name one by one to decide whether to deserialize and assign the field or skip the field value.  One fast way is that we can optimize the string comparison into jump instructions:  Assume the current type has n fields, and the peer type has n1 fields.Generate an auto growing field id from 0 for every sorted field in the current type at the compile time.Compare the received type meta with current type, generate same id if the field name is same, otherwise generate an auto growing id starting from n, cache this meta at runtime.Iterate the fields of received type meta, use a switch to compare the field id to deserialize data and assign/skip field value. Continuous field id will be optimized into jump in switch block, so it will very fast.  Here is an example, suppose process A has a class Foo with version 1 defined as Foo1, process B has a class Foowith version 2 defined as Foo2:  // class Foo with version 1 class Foo1 { int32_t v1; // id 0 std::string v2; // id 1 }; // class Foo with version 2 class Foo2 { // id 0, but will have id 2 in process A bool v0; // id 1, but will have id 0 in process A int32_t v1; // id 2, but will have id 3 in process A int64_t long_value; // id 3, but will have id 1 in process A std::string v2; // id 4, but will have id 4 in process A std::vector&lt;std::string&gt; list; };   When process A received serialized Foo2 from process B, here is how it deserialize the data:  Foo1 foo1 = ...; const std::vector&lt;fory::FieldInfo&gt; &amp;field_infos = type_meta.field_infos; for (const auto &amp;field_info : field_infos) { switch (field_info.field_id) { case 0: foo1.v1 = buffer.read_varint32(); break; case 1: foo1.v2 = fory.read_string(); break; default: fory.skip_data(field_info); } }   ","version":"dev","tagName":"h3"},{"title":"Implementation Checklist for New Languages‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/next/specification/xlang_implementation_guide#implementation-checklist-for-new-languages","content":" This section provides a step-by-step guide for implementing Fory xlang serialization in a new language.  ","version":"dev","tagName":"h2"},{"title":"Phase 1: Core Infrastructure‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/next/specification/xlang_implementation_guide#phase-1-core-infrastructure","content":" Buffer Implementation Create a byte buffer with read/write cursor tracking Implement little-endian byte order for all multi-byte writes Implement write_int8, write_int16, write_int32, write_int64 Implement write_float32, write_float64 Implement read_* counterparts for all write methods Implement buffer growth strategy (e.g., doubling) Varint Encoding Implement write_varuint32 / read_varuint32 Implement write_varint32 / read_varint32 (with ZigZag) Implement write_varuint64 / read_varuint64 Implement write_varint64 / read_varint64 (with ZigZag) Implement write_varuint36_small / read_varuint36_small (for strings) Optionally implement Hybrid encoding (TAGGED_INT64/TAGGED_UINT64) for int64 Header Handling Write/read bitmap flags (null, xlang, oob)  ","version":"dev","tagName":"h3"},{"title":"Phase 2: Basic Type Serializers‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/next/specification/xlang_implementation_guide#phase-2-basic-type-serializers","content":" Primitive Types bool (1 byte: 0 or 1) int8, int16, int32, int64 (little endian) float32, float64 (IEEE 754, little endian) String Serialization Implement string header: (byte_length &lt;&lt; 2) | encoding Support UTF-8 encoding (required for xlang) Optionally support LATIN1 and UTF-16 Temporal Types Duration (seconds + nanoseconds) Timestamp (seconds + nanoseconds since epoch) Date (days since epoch) Reference Tracking Implement write-side object tracking (object ‚Üí ref_id map) Implement read-side object tracking (ref_id ‚Üí object list) Handle all four reference flags: NULL(-3), REF(-2), NOT_NULL(-1), REF_VALUE(0) Support disabling reference tracking per-type or globally  ","version":"dev","tagName":"h3"},{"title":"Phase 3: Collection Types‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/next/specification/xlang_implementation_guide#phase-3-collection-types","content":" List/Array Serialization Write length as varuint32 Write elements header byte Handle homogeneous vs heterogeneous elements Handle null elements Map Serialization Write total size as varuint32 Implement chunk-based format (max 255 pairs per chunk) Write KV header byte per chunk Handle key and value type variations Set Serialization Same format as List (reuse implementation)  ","version":"dev","tagName":"h3"},{"title":"Phase 4: Meta String Encoding‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/next/specification/xlang_implementation_guide#phase-4-meta-string-encoding","content":" Meta strings are required for enum and struct serialization (encoding field names, type names, namespaces).  Meta String Compression Implement LOWER_SPECIAL encoding (5 bits/char) Implement LOWER_UPPER_DIGIT_SPECIAL encoding (6 bits/char) Implement FIRST_TO_LOWER_SPECIAL encoding Implement ALL_TO_LOWER_SPECIAL encoding Implement encoding selection algorithm Implement meta string deduplication  ","version":"dev","tagName":"h3"},{"title":"Phase 5: Enum Serialization‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/next/specification/xlang_implementation_guide#phase-5-enum-serialization","content":" Enum Serialization Write ordinal as varuint32 Support named enum (namespace + type name)  ","version":"dev","tagName":"h3"},{"title":"Phase 6: Struct Serialization‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/next/specification/xlang_implementation_guide#phase-6-struct-serialization","content":" Type Registration Support registration by numeric ID Support registration by namespace + type name Maintain type ‚Üí serializer mapping Generate type IDs: write internal type ID, then user_type_id as varuint32 Field Ordering Implement the spec-defined grouping and ordering (primitive/boxed/built-in, collections/maps, other) Use a stable comparator within each group (type ID and name) Use tag ID or snake_case field name as field identifier for fingerprints Schema Consistent Mode If class-version check is enabled, compute schema hash from field identifiers Write 4-byte schema hash before fields Serialize fields in Fory order Compatible/Meta Share Mode Implement shared TypeDef stream (inline new TypeDefs, index references) Map fields by name or tag ID, skip unknown fields Apply nullable/ref flags from TypeDef metadata  ","version":"dev","tagName":"h3"},{"title":"Phase 7: Other types‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/next/specification/xlang_implementation_guide#phase-7-other-types","content":" Binary/Array Types   Primitive arrays (direct buffer copy) Multi-dimensional arrays as nested lists (no tensor encoding)  ","version":"dev","tagName":"h3"},{"title":"Testing Strategy‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/next/specification/xlang_implementation_guide#testing-strategy","content":" Cross-Language Compatibility Tests Serialize in new language, deserialize in Java/Python Serialize in Java/Python, deserialize in new language Test all primitive types Test strings with various encodings Test collections (empty, single, multiple elements) Test maps with various key/value types Test nested structs Test circular references (if supported)  ","version":"dev","tagName":"h3"},{"title":"Language-Specific Implementation Notes‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/next/specification/xlang_implementation_guide#language-specific-implementation-notes","content":" ","version":"dev","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/next/specification/xlang_implementation_guide#java","content":" Uses runtime code generation (JIT) for maximum performanceSupports all reference tracking modesUses internal String coder for encoding selectionThread-safe via ThreadSafeFory wrapper  ","version":"dev","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/next/specification/xlang_implementation_guide#python","content":" Two modes: Pure Python (debugging) and Cython (performance)Uses id(obj) for reference trackingLatin1/UTF-16/UTF-8 encoding for all strings in xlang modedataclass support via code generation  ","version":"dev","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/next/specification/xlang_implementation_guide#c","content":" Compile-time reflection via macros (FORY_STRUCT)Template meta programming for type dispatch and serializer selectionUses std::shared_ptr for reference trackingCompile-time field orderingNo runtime code generation  ","version":"dev","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/next/specification/xlang_implementation_guide#rust","content":" Derive macros for automatic serialization (#[derive(ForyObject)])Uses Rc&lt;T&gt; / Arc&lt;T&gt; for reference trackingThread-local context caching for performanceCompile-time field ordering  ","version":"dev","tagName":"h3"},{"title":"Go‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/next/specification/xlang_implementation_guide#go","content":" Reflection-based and codegen-based modesStruct tags for field annotationsInterface types for polymorphism ","version":"dev","tagName":"h3"},{"title":"Xlang Type Mapping","type":0,"sectionRef":"#","url":"/docs/next/specification/xlang_type_mapping","content":"","keywords":"","version":"dev"},{"title":"User Type IDs‚Äã","type":1,"pageTitle":"Xlang Type Mapping","url":"/docs/next/specification/xlang_type_mapping#user-type-ids","content":" When registering user types (struct/ext/enum/union), the internal type ID is written as the 8-bit kind, and the user type ID is written separately as an unsigned varint32. There is no bit shift/packing, and user_type_id can be in the range 0~0xFFFFFFFE.  Examples:  User ID\tType\tInternal ID\tEncoded User ID\tDecimal0\tSTRUCT\t27\t0\t0 0\tENUM\t25\t0\t0 1\tSTRUCT\t27\t1\t1 1\tCOMPATIBLE_STRUCT\t28\t1\t1 2\tNAMED_STRUCT\t29\t2\t2  When reading type IDs:  Read internal type ID from the type ID field.If the internal type is a user-registered kind, read user_type_id as varuint32.  ","version":"dev","tagName":"h2"},{"title":"Type Mapping‚Äã","type":1,"pageTitle":"Xlang Type Mapping","url":"/docs/next/specification/xlang_type_mapping#type-mapping","content":" Fory Type\tFory Type ID\tJava\tPython\tJavascript\tC++\tGolang\tRustbool\t1\tbool/Boolean\tbool\tBoolean\tbool\tbool\tbool int8\t2\tbyte/Byte\tint/pyfory.int8\tType.int8()\tint8_t\tint8\ti8 int16\t3\tshort/Short\tint/pyfory.int16\tType.int16()\tint16_t\tint16\ti16 int32\t4\tint/Integer\tint/pyfory.fixed_int32\tType.int32()\tint32_t\tint32\ti32 varint32\t5\tint/Integer\tint/pyfory.int32\tType.varint32()\tint32_t\tint32\ti32 int64\t6\tlong/Long\tint/pyfory.fixed_int64\tType.int64()\tint64_t\tint64\ti64 varint64\t7\tlong/Long\tint/pyfory.int64\tType.varint64()\tint64_t\tint64\ti64 tagged_int64\t8\tlong/Long\tint/pyfory.tagged_int64\tType.tagged_int64()\tint64_t\tint64\ti64 uint8\t9\tshort/Short\tint/pyfory.uint8\tType.uint8()\tuint8_t\tuint8\tu8 uint16\t10\tint/Integer\tint/pyfory.uint16\tType.uint16()\tuint16_t\tuint16\tu16 uint32\t11\tlong/Long\tint/pyfory.fixed_uint32\tType.uint32()\tuint32_t\tuint32\tu32 var_uint32\t12\tlong/Long\tint/pyfory.uint32\tType.varUInt32()\tuint32_t\tuint32\tu32 uint64\t13\tlong/Long\tint/pyfory.fixed_uint64\tType.uint64()\tuint64_t\tuint64\tu64 var_uint64\t14\tlong/Long\tint/pyfory.uint64\tType.varUInt64()\tuint64_t\tuint64\tu64 tagged_uint64\t15\tlong/Long\tint/pyfory.tagged_uint64\tType.taggedUInt64()\tuint64_t\tuint64\tu64 float8\t16\t/\t/\t/\t/\t/\t/ float16\t17\tfloat/Float\tfloat/pyfory.float16\tType.float16()\tfory::float16_t\tfory.float16\tfory::f16 bfloat16\t18\t/\t/\t/\t/\t/\t/ float32\t19\tfloat/Float\tfloat/pyfory.float32\tType.float32()\tfloat\tfloat32\tf32 float64\t20\tdouble/Double\tfloat/pyfory.float64\tType.float64()\tdouble\tfloat64\tf64 string\t21\tString\tstr\tString\tstring\tstring\tString/str list\t22\tList/Collection\tlist/tuple\tarray\tvector\tslice\tVec set\t23\tSet\tset\t/\tset\tfory.Set\tSet map\t24\tMap\tdict\tMap\tunordered_map\tmap\tHashMap enum\t25\tEnum subclasses\tenum subclasses\t/\tenum\t/\tenum named_enum\t26\tEnum subclasses\tenum subclasses\t/\tenum\t/\tenum struct\t27\tpojo/record\tdata class\tobject\tstruct/class\tstruct\tstruct compatible_struct\t28\tpojo/record\tdata class\tobject\tstruct/class\tstruct\tstruct named_struct\t29\tpojo/record\tdata class\tobject\tstruct/class\tstruct\tstruct named_compatible_struct\t30\tpojo/record\tdata class\tobject\tstruct/class\tstruct\tstruct ext\t31\tpojo/record\tdata class\tobject\tstruct/class\tstruct\tstruct named_ext\t32\tpojo/record\tdata class\tobject\tstruct/class\tstruct\tstruct union\t33\tUnion\ttyping.Union\t/\tstd::variant&lt;Ts...&gt;\t/\ttagged union enum none\t36\tnull\tNone\tnull\tstd::monostate\tnil\t() duration\t37\tDuration\ttimedelta\tNumber\tduration\tDuration\tDuration timestamp\t38\tInstant\tdatetime\tNumber\tstd::chrono::nanoseconds\tTime\tDateTime date\t39\tDate\tdatetime\tNumber\tfory::serialization::Date\tTime\tDateTime decimal\t40\tBigDecimal\tDecimal\tbigint\t/\t/\t/ binary\t41\tbyte[]\tbytes\t/\tuint8_t[n]/vector&lt;T&gt;\t[n]uint8/[]T\tVec&lt;uint8_t&gt; array\t42\tarray\tnp.ndarray\t/\t/\tarray/slice\tVec bool_array\t43\tbool[]\tndarray(np.bool_)\t/\tbool[n]\t[n]bool/[]T\tVec&lt;bool&gt; int8_array\t44\tbyte[]\tndarray(int8)\t/\tint8_t[n]/vector&lt;T&gt;\t[n]int8/[]T\tVec&lt;i8&gt; int16_array\t45\tshort[]\tndarray(int16)\t/\tint16_t[n]/vector&lt;T&gt;\t[n]int16/[]T\tVec&lt;i16&gt; int32_array\t46\tint[]\tndarray(int32)\t/\tint32_t[n]/vector&lt;T&gt;\t[n]int32/[]T\tVec&lt;i32&gt; int64_array\t47\tlong[]\tndarray(int64)\t/\tint64_t[n]/vector&lt;T&gt;\t[n]int64/[]T\tVec&lt;i64&gt; uint8_array\t48\tshort[]\tndarray(uint8)\t/\tuint8_t[n]/vector&lt;T&gt;\t[n]uint8/[]T\tVec&lt;u8&gt; uint16_array\t49\tint[]\tndarray(uint16)\t/\tuint16_t[n]/vector&lt;T&gt;\t[n]uint16/[]T\tVec&lt;u16&gt; uint32_array\t50\tlong[]\tndarray(uint32)\t/\tuint32_t[n]/vector&lt;T&gt;\t[n]uint32/[]T\tVec&lt;u32&gt; uint64_array\t51\tlong[]\tndarray(uint64)\t/\tuint64_t[n]/vector&lt;T&gt;\t[n]uint64/[]T\tVec&lt;u64&gt; float8_array\t52\t/\t/\t/\t/\t/\t/ float16_array\t53\tfloat[]\tndarray(float16)\t/\tfory::float16_t[n]/vector&lt;T&gt;\t[n]float16/[]T\tVec&lt;fory::f16&gt; bfloat16_array\t54\t/\t/\t/\t/\t/\t/ float32_array\t55\tfloat[]\tndarray(float32)\t/\tfloat[n]/vector&lt;T&gt;\t[n]float32/[]T\tVec&lt;f32&gt; float64_array\t56\tdouble[]\tndarray(float64)\t/\tdouble[n]/vector&lt;T&gt;\t[n]float64/[]T\tVec&lt;f64&gt;  ","version":"dev","tagName":"h2"},{"title":"Type info(not implemented currently)‚Äã","type":1,"pageTitle":"Xlang Type Mapping","url":"/docs/next/specification/xlang_type_mapping#type-infonot-implemented-currently","content":" Due to differences between type systems of languages, those types can't be mapped one-to-one between languages.  If the user notices that one type on a language corresponds to multiple types in Fory type systems, for example, longin java has type int64/varint64/h64, it means the language lacks some types, and the user must provide extra type info when using Fory.  ","version":"dev","tagName":"h2"},{"title":"Type annotation‚Äã","type":1,"pageTitle":"Xlang Type Mapping","url":"/docs/next/specification/xlang_type_mapping#type-annotation","content":" If the type is a field of another class, users can provide meta hints for fields of a type, or for the whole type. Such information can be provided in other languages too:  java: use annotation.cpp: use macro and template.golang: use struct tag.python: use typehint.rust: use macro.  Here is en example:  Java: class Foo { @Int32Type(varint = true) int f1; List&lt;@Int32Type(varint = true) Integer&gt; f2; } Python: class Foo: f1: pyfory.varint32 f2: List[pyfory.varint32]  ","version":"dev","tagName":"h2"},{"title":"Install","type":0,"sectionRef":"#","url":"/docs/next/start/install","content":"","keywords":"","version":"dev"},{"title":"Java‚Äã","type":1,"pageTitle":"Install","url":"/docs/next/start/install#java","content":" To add a dependency on Apache Fory‚Ñ¢ using Maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-core&lt;/artifactId&gt; &lt;version&gt;0.15.0&lt;/version&gt; &lt;/dependency&gt; &lt;!-- Optional row format support --&gt; &lt;!-- &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-format&lt;/artifactId&gt; &lt;version&gt;0.13.1&lt;/version&gt; &lt;/dependency&gt; --&gt; &lt;!-- SIMD acceleration for array compression (Java 16+) --&gt; &lt;!-- &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-simd&lt;/artifactId&gt; &lt;version&gt;0.13.1&lt;/version&gt; &lt;/dependency&gt; --&gt;   ","version":"dev","tagName":"h2"},{"title":"Scala‚Äã","type":1,"pageTitle":"Install","url":"/docs/next/start/install#scala","content":" To add a dependency on Apache Fory‚Ñ¢ scala for scala 2.13 with maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-scala_2.13&lt;/artifactId&gt; &lt;version&gt;0.15.0&lt;/version&gt; &lt;/dependency&gt;   To add a dependency on Apache Fory‚Ñ¢ scala for scala 3 with maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-scala_3&lt;/artifactId&gt; &lt;version&gt;0.15.0&lt;/version&gt; &lt;/dependency&gt;   To add a dependency on Apache Fory‚Ñ¢ scala for scala 2.13 with sbt, use the following:  libraryDependencies += &quot;org.apache.fory&quot; % &quot;fory-scala_2.13&quot; % &quot;0.15.0&quot;   To add a dependency on Apache Fory‚Ñ¢ scala for scala 3 with sbt, use the following:  libraryDependencies += &quot;org.apache.fory&quot; % &quot;fory-scala_3&quot; % &quot;0.15.0&quot;   ","version":"dev","tagName":"h2"},{"title":"Kotlin‚Äã","type":1,"pageTitle":"Install","url":"/docs/next/start/install#kotlin","content":" To add a dependency on Apache Fory‚Ñ¢ kotlin with maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-kotlin&lt;/artifactId&gt; &lt;version&gt;0.15.0&lt;/version&gt; &lt;/dependency&gt;   ","version":"dev","tagName":"h2"},{"title":"Python‚Äã","type":1,"pageTitle":"Install","url":"/docs/next/start/install#python","content":" python -m pip install --upgrade pip pip install pyfory==0.15.0   ","version":"dev","tagName":"h2"},{"title":"Rust‚Äã","type":1,"pageTitle":"Install","url":"/docs/next/start/install#rust","content":" [dependencies] fory = &quot;0.14&quot;   or just execute command:  cargo add fory@0.15.0   ","version":"dev","tagName":"h2"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Install","url":"/docs/next/start/install#javascript","content":" Apache Fory‚Ñ¢ is NOT yet available on npm, please install from source code now. ","version":"dev","tagName":"h2"},{"title":"C++ Benchmark Performance Report","type":0,"sectionRef":"#","url":"/docs/benchmarks/cpp/","content":"","keywords":"","version":"0.15"},{"title":"How to Generate This Report‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/benchmarks/cpp/#how-to-generate-this-report","content":" cd benchmarks/cpp_benchmark/build ./fory_benchmark --benchmark_format=json --benchmark_out=benchmark_results.json cd .. python benchmark_report.py --json-file build/benchmark_results.json --output-dir report   ","version":"0.15","tagName":"h2"},{"title":"Hardware & OS Info‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/benchmarks/cpp/#hardware--os-info","content":" Key\tValueOS\tDarwin 24.6.0 Machine\tarm64 Processor\tarm CPU Cores (Physical)\t12 CPU Cores (Logical)\t12 Total RAM (GB)\t48.0 Benchmark Date\t2025-12-15T23:02:49+08:00 CPU Cores (from benchmark)\t12  ","version":"0.15","tagName":"h2"},{"title":"Benchmark Plots‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/benchmarks/cpp/#benchmark-plots","content":"   ","version":"0.15","tagName":"h2"},{"title":"Benchmark Results‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/benchmarks/cpp/#benchmark-results","content":" ","version":"0.15","tagName":"h2"},{"title":"Timing Results (nanoseconds)‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/benchmarks/cpp/#timing-results-nanoseconds","content":" Datatype\tOperation\tFory (ns)\tProtobuf (ns)\tFasterMediacontent\tSerialize\t443.5\t1982.5\tFory (4.5x) Mediacontent\tDeserialize\t1349.0\t2525.2\tFory (1.9x) Sample\tSerialize\t235.4\t309.7\tFory (1.3x) Sample\tDeserialize\t1068.7\t1397.0\tFory (1.3x) Struct\tSerialize\t109.4\t170.0\tFory (1.6x) Struct\tDeserialize\t129.1\t161.2\tFory (1.2x)  ","version":"0.15","tagName":"h3"},{"title":"Throughput Results (ops/sec)‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/benchmarks/cpp/#throughput-results-opssec","content":" Datatype\tOperation\tFory TPS\tProtobuf TPS\tFasterMediacontent\tSerialize\t2,254,915\t504,410\tFory (4.5x) Mediacontent\tDeserialize\t741,303\t396,013\tFory (1.9x) Sample\tSerialize\t4,248,973\t3,229,102\tFory (1.3x) Sample\tDeserialize\t935,709\t715,837\tFory (1.3x) Struct\tSerialize\t9,143,618\t5,881,005\tFory (1.6x) Struct\tDeserialize\t7,746,787\t6,202,164\tFory (1.2x)  ","version":"0.15","tagName":"h3"},{"title":"Serialized Data Sizes (bytes)‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/benchmarks/cpp/#serialized-data-sizes-bytes","content":" Datatype\tFory\tProtobufStruct\t32\t61 Sample\t384\t375 ","version":"0.15","tagName":"h3"},{"title":"C++ Benchmark Performance Report","type":0,"sectionRef":"#","url":"/docs/benchmarks/cpp/REPORT","content":"","keywords":"","version":"0.15"},{"title":"How to Generate This Report‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/benchmarks/cpp/REPORT#how-to-generate-this-report","content":" cd benchmarks/cpp_benchmark/build ./fory_benchmark --benchmark_format=json --benchmark_out=benchmark_results.json cd .. python benchmark_report.py --json-file build/benchmark_results.json --output-dir report   ","version":"0.15","tagName":"h2"},{"title":"Hardware & OS Info‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/benchmarks/cpp/REPORT#hardware--os-info","content":" Key\tValueOS\tDarwin 24.6.0 Machine\tarm64 Processor\tarm CPU Cores (Physical)\t12 CPU Cores (Logical)\t12 Total RAM (GB)\t48.0 Benchmark Date\t2026-02-06T20:00:20+08:00 CPU Cores (from benchmark)\t12  ","version":"0.15","tagName":"h2"},{"title":"Benchmark Plots‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/benchmarks/cpp/REPORT#benchmark-plots","content":" ","version":"0.15","tagName":"h2"},{"title":"Mediacontent‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/benchmarks/cpp/REPORT#mediacontent","content":"   ","version":"0.15","tagName":"h3"},{"title":"Mediacontentlist‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/benchmarks/cpp/REPORT#mediacontentlist","content":"   ","version":"0.15","tagName":"h3"},{"title":"Sample‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/benchmarks/cpp/REPORT#sample","content":"   ","version":"0.15","tagName":"h3"},{"title":"Samplelist‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/benchmarks/cpp/REPORT#samplelist","content":"   ","version":"0.15","tagName":"h3"},{"title":"Struct‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/benchmarks/cpp/REPORT#struct","content":"   ","version":"0.15","tagName":"h3"},{"title":"Structlist‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/benchmarks/cpp/REPORT#structlist","content":"   ","version":"0.15","tagName":"h3"},{"title":"Throughput‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/benchmarks/cpp/REPORT#throughput","content":"   ","version":"0.15","tagName":"h3"},{"title":"Benchmark Results‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/benchmarks/cpp/REPORT#benchmark-results","content":" ","version":"0.15","tagName":"h2"},{"title":"Timing Results (nanoseconds)‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/benchmarks/cpp/REPORT#timing-results-nanoseconds","content":" Datatype\tOperation\tFory (ns)\tProtobuf (ns)\tFasterMediacontent\tSerialize\t512.0\t1990.9\tFory (3.9x) Mediacontent\tDeserialize\t1674.1\t2516.6\tFory (1.5x) Mediacontentlist\tSerialize\t2261.0\t10804.2\tFory (4.8x) Mediacontentlist\tDeserialize\t6943.5\t13375.9\tFory (1.9x) Sample\tSerialize\t241.7\t309.4\tFory (1.3x) Sample\tDeserialize\t1055.8\t1361.5\tFory (1.3x) Samplelist\tSerialize\t963.2\t11716.7\tFory (12.2x) Samplelist\tDeserialize\t5295.9\t12162.2\tFory (2.3x) Struct\tSerialize\t117.1\t169.6\tFory (1.4x) Struct\tDeserialize\t138.6\t156.2\tFory (1.1x) Structlist\tSerialize\t308.4\t1299.4\tFory (4.2x) Structlist\tDeserialize\t706.2\t1188.0\tFory (1.7x)  ","version":"0.15","tagName":"h3"},{"title":"Throughput Results (ops/sec)‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/benchmarks/cpp/REPORT#throughput-results-opssec","content":" Datatype\tOperation\tFory TPS\tProtobuf TPS\tFasterMediacontent\tSerialize\t1,952,940\t502,295\tFory (3.9x) Mediacontent\tDeserialize\t597,343\t397,356\tFory (1.5x) Mediacontentlist\tSerialize\t442,277\t92,557\tFory (4.8x) Mediacontentlist\tDeserialize\t144,020\t74,761\tFory (1.9x) Sample\tSerialize\t4,138,037\t3,232,073\tFory (1.3x) Sample\tDeserialize\t947,188\t734,472\tFory (1.3x) Samplelist\tSerialize\t1,038,236\t85,348\tFory (12.2x) Samplelist\tDeserialize\t188,825\t82,222\tFory (2.3x) Struct\tSerialize\t8,542,313\t5,896,325\tFory (1.4x) Struct\tDeserialize\t7,217,541\t6,403,969\tFory (1.1x) Structlist\tSerialize\t3,242,105\t769,562\tFory (4.2x) Structlist\tDeserialize\t1,416,005\t841,739\tFory (1.7x)  ","version":"0.15","tagName":"h3"},{"title":"Serialized Data Sizes (bytes)‚Äã","type":1,"pageTitle":"C++ Benchmark Performance Report","url":"/docs/benchmarks/cpp/REPORT#serialized-data-sizes-bytes","content":" Datatype\tFory\tProtobufStruct\t58\t61 Sample\t446\t375 MediaContent\t365\t301 StructList\t184\t315 SampleList\t1980\t1890 MediaContentList\t1535\t1520 ","version":"0.15","tagName":"h3"},{"title":"Go Serialization Benchmark Report","type":0,"sectionRef":"#","url":"/docs/benchmarks/go/","content":"","keywords":"","version":"0.15"},{"title":"System Information‚Äã","type":1,"pageTitle":"Go Serialization Benchmark Report","url":"/docs/benchmarks/go/#system-information","content":" OS: Darwin 24.6.0Architecture: arm64Python: 3.10.8  ","version":"0.15","tagName":"h2"},{"title":"Performance Charts‚Äã","type":1,"pageTitle":"Go Serialization Benchmark Report","url":"/docs/benchmarks/go/#performance-charts","content":"   ","version":"0.15","tagName":"h2"},{"title":"Performance Summary‚Äã","type":1,"pageTitle":"Go Serialization Benchmark Report","url":"/docs/benchmarks/go/#performance-summary","content":" Data Type\tOperation\tFory (ops/s)\tProtobuf (ops/s)\tMsgpack (ops/s)\tFory vs PB\tFory vs MPStruct\tSerialize\t15.16M\t10.23M\t5.41M\t1.48x\t2.80x Struct\tDeserialize\t12.10M\t11.01M\t3.23M\t1.10x\t3.75x Structlist\tSerialize\t1.58M\t561K\t299K\t2.82x\t5.28x Structlist\tDeserialize\t1.10M\t529K\t175K\t2.09x\t6.30x Sample\tSerialize\t7.28M\t2.72M\t670K\t2.68x\t10.87x Sample\tDeserialize\t3.79M\t2.37M\t376K\t1.60x\t10.09x Samplelist\tSerialize\t510K\t141K\t38K\t3.61x\t13.34x Samplelist\tDeserialize\t236K\t107K\t19K\t2.20x\t12.66x Mediacontent\tSerialize\t3.72M\t2.12M\t1.29M\t1.75x\t2.88x Mediacontent\tDeserialize\t2.34M\t1.81M\t698K\t1.30x\t3.35x Mediacontentlist\tSerialize\t268K\t110K\t72K\t2.44x\t3.72x Mediacontentlist\tDeserialize\t138K\t87K\t36K\t1.58x\t3.86x  ","version":"0.15","tagName":"h2"},{"title":"Detailed Timing (ns/op)‚Äã","type":1,"pageTitle":"Go Serialization Benchmark Report","url":"/docs/benchmarks/go/#detailed-timing-nsop","content":" Data Type\tOperation\tFory\tProtobuf\tMsgpackStruct\tSerialize\t66.0\t97.8\t184.9 Struct\tDeserialize\t82.7\t90.9\t309.6 Structlist\tSerialize\t632.8\t1783.0\t3340.0 Structlist\tDeserialize\t906.4\t1891.0\t5709.0 Sample\tSerialize\t137.3\t367.3\t1492.0 Sample\tDeserialize\t263.6\t422.2\t2661.0 Samplelist\tSerialize\t1962.0\t7087.0\t26169.0 Samplelist\tDeserialize\t4234.0\t9321.0\t53615.0 Mediacontent\tSerialize\t268.8\t471.1\t773.7 Mediacontent\tDeserialize\t426.9\t553.1\t1432.0 Mediacontentlist\tSerialize\t3736.0\t9107.0\t13911.0 Mediacontentlist\tDeserialize\t7247.0\t11435.0\t27975.0  ","version":"0.15","tagName":"h2"},{"title":"Serialized Data Sizes (bytes)‚Äã","type":1,"pageTitle":"Go Serialization Benchmark Report","url":"/docs/benchmarks/go/#serialized-data-sizes-bytes","content":" Data Type\tFory\tProtobuf\tMsgpackStruct\t58\t61\t57 Sample\t446\t375\t524 MediaContent\t342\t301\t400 StructList\t560\t1260\t1146 SampleList\t7600\t7560\t10486 MediaContentList\t5776\t6080\t8006 ","version":"0.15","tagName":"h3"},{"title":"Community","type":0,"sectionRef":"#","url":"/docs/community/","content":"","keywords":"","version":"0.15"},{"title":"Mailing list‚Äã","type":1,"pageTitle":"Community","url":"/docs/community/#mailing-list","content":" Name\tDesc\tSubscribe\tUnsubscribe\tPost\tArchivedev@fory.apache.org\tDevelopment related discussions\tSubscribe\tUnsubscribe\tPost\tArchive commits@fory.apache.org\tAll commits to our repositories\tSubscribe\tUnsubscribe\tRead only list\tArchive  Please make sure subscribe to any list before attempting to post.  If you are not subscribed to the mailing list, your message will either be rejected or you won't receive the response.  ","version":"0.15","tagName":"h2"},{"title":"How to subscribe to a mailing list‚Äã","type":1,"pageTitle":"Community","url":"/docs/community/#how-to-subscribe-to-a-mailing-list","content":" To post messages, subscribe first by:  Sending an email to listname-subscribe@fory.apache.org with listname replaced accordingly.Replying to the confirmation email you'll receive, keeping the subject line intact.You'll then get a welcome email, and the subscription succeeds.  When discussing code snippets in emails, ensure:  You do not link to files in external services, as such files can change, get deleted or the link might break and thus make an archived email thread useless.You paste text instead of screenshots of text.You keep formatting when pasting code in order to keep the code readable.There are enough import statements to avoid ambiguities.  ","version":"0.15","tagName":"h3"},{"title":"Slack‚Äã","type":1,"pageTitle":"Community","url":"/docs/community/#slack","content":" You can join the Apache Fory‚Ñ¢ community on Slack.  There are a couple of community rules:  Be respectful and nice.All important decisions and conclusions must be reflected back to the mailing lists. &quot;If it didn't happen on a mailing list, it didn't happen.&quot; - The Apache Mottos.Use Slack threads to keep parallel conversations from overwhelming a channel.Please do not direct message people for troubleshooting, issue assigning and PR review. These should be picked-up voluntarily.  ","version":"0.15","tagName":"h2"},{"title":"Issue tracker‚Äã","type":1,"pageTitle":"Community","url":"/docs/community/#issue-tracker","content":" We use GitHub Issues to track all issues:  code related issues: https://github.com/apache/fory/issueswebsite related issues: https://github.com/apache/fory-site/issues  You need to have a GitHub account in order to create issues. If you don't have a GitHub account, you can post an email to dev@fory.apache.org.  ","version":"0.15","tagName":"h2"},{"title":"Bug reports‚Äã","type":1,"pageTitle":"Community","url":"/docs/community/#bug-reports","content":" To report a bug:  Verify that the bug does in fact exist.Search the issue tracker to verify there is no existing issue reporting the bug you've found.Create a bug report on issue tracker.If possible, dive into the source code of fory, and submit a patch for the bug you reported, this helps ensure the bug will be fixed quickly.  ","version":"0.15","tagName":"h3"},{"title":"Reporting a Vulnerability‚Äã","type":1,"pageTitle":"Community","url":"/docs/community/#reporting-a-vulnerability","content":" Apache Fory‚Ñ¢ is a project of the Apache Software Foundation and follows the ASF vulnerability handling process.  To report a new vulnerability you have discovered please follow the ASF vulnerability reporting process, which explains how to send us details privately.  ","version":"0.15","tagName":"h3"},{"title":"Enhancement‚Äã","type":1,"pageTitle":"Community","url":"/docs/community/#enhancement","content":" Enhancements or new feature proposals are also welcome. The more concrete and rationale the proposal is, the greater the chance it will be incorporated into future releases.  ","version":"0.15","tagName":"h3"},{"title":"Source code‚Äã","type":1,"pageTitle":"Community","url":"/docs/community/#source-code","content":" fory core repository: https://github.com/apache/foryfory website repository: https://github.com/apache/fory-site ","version":"0.15","tagName":"h2"},{"title":"Xlang Serialization Format","type":0,"sectionRef":"#","url":"/docs/next/specification/xlang_serialization_spec","content":"","keywords":"","version":"dev"},{"title":"Cross-language Serialization Specification‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#cross-language-serialization-specification","content":" Apache Fory‚Ñ¢ xlang serialization enables automatic cross-language object serialization with support for shared references, circular references, and polymorphism. Unlike traditional serialization frameworks that require IDL definitions and schema compilation, Fory serializes objects directly without any intermediate steps.  Key characteristics:  Automatic: No IDL definition, no schema compilation, no manual object-to-protocol conversionCross-language: Same binary format works seamlessly across Java, Python, C++, Rust, Go, JavaScript, and moreReference-aware: Handles shared references and circular references without duplication or infinite recursionPolymorphic: Supports object polymorphism with runtime type resolution  This specification defines the Fory xlang binary format. The format is dynamic rather than static, which enables flexibility and ease of use at the cost of additional complexity in the wire format.  ","version":"dev","tagName":"h2"},{"title":"Type Systems‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#type-systems","content":" ","version":"dev","tagName":"h2"},{"title":"Data Types‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#data-types","content":" bool: a boolean value (true or false).int8: a 8-bit signed integer.int16: a 16-bit signed integer.int32: a 32-bit signed integer.varint32: a 32-bit signed integer which use fory variable-length encoding.int64: a 64-bit signed integer.varint64: a 64-bit signed integer which use fory PVL encoding.tagged_int64: a 64-bit signed integer which use fory Hybrid encoding.uint8: an 8-bit unsigned integer.uint16: a 16-bit unsigned integer.uint32: a 32-bit unsigned integer.var_uint32: a 32-bit unsigned integer which use fory variable-length encoding.uint64: a 64-bit unsigned integer.var_uint64: a 64-bit unsigned integer which use fory PVL encoding.tagged_uint64: a 64-bit unsigned integer which use fory Hybrid encoding.float8: an 8-bit floating point number.float16: a 16-bit floating point number.bfloat16: a 16-bit brain floating point number.float32: a 32-bit floating point number.float64: a 64-bit floating point number including NaN and Infinity.string: a text string encoded using Latin1/UTF16/UTF-8 encoding.enum: a data type consisting of a set of named values. Rust enum with non-predefined field values are not supported as an enum.named_enum: an enum whose value will be serialized as the registered name.struct: a dynamic(final) type serialized by Fory Struct serializer. i.e. it doesn't have subclasses. Suppose we're deserializing List&lt;SomeClass&gt;, we can save dynamic serializer dispatch since SomeClass is dynamic(final).compatible_struct: a dynamic(final) type serialized by Fory compatible Struct serializer.named_struct: a struct whose type mapping will be encoded as a name.named_compatible_struct: a compatible_struct whose type mapping will be encoded as a name.ext: a type which will be serialized by a customized serializer.named_ext: an ext type whose type mapping will be encoded as a name.list: a sequence of objects.set: an unordered set of unique elements.map: a map of key-value pairs. Mutable types such as list/map/set/array are not allowed as key of map.duration: an absolute length of time, independent of any calendar/timezone, as a count of nanoseconds.timestamp: a point in time, independent of any calendar/timezone, encoded as seconds (int64) and nanoseconds (uint32) since the epoch at UTC midnight on January 1, 1970.date: a naive date without timezone. The count is days relative to an epoch at UTC midnight on Jan 1, 1970.decimal: exact decimal value represented as an integer value in two's complement.binary: an variable-length array of bytes.array: only allow 1d numeric components. Other arrays will be taken as List. The implementation should support the interoperability between array and list. bool_array: one dimensional bool array.int8_array: one dimensional int8 array.int16_array: one dimensional int16 array.int32_array: one dimensional int32 array.int64_array: one dimensional int64 array.float8_array: one dimensional float8 array.float16_array: one dimensional half_float_16 array.bfloat16_array: one dimensional bfloat16 array.float32_array: one dimensional float32 array.float64_array: one dimensional float64 array. union: a tagged union type that can hold one of several alternative types. The active alternative is identified by an index.typed_union: a union value with registered numeric union type ID.named_union: a union value with embedded union type name or shared TypeDef.none: represents an empty/unit value with no data (e.g., for empty union alternatives).  Note:  Unsigned integer types use the same byte sizes as their signed counterparts; the difference is in value interpretation. See Type mapping for language-specific type mappings.  ","version":"dev","tagName":"h3"},{"title":"Polymorphisms‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#polymorphisms","content":" For polymorphism, if one non-final class is registered, and only one subclass is registered, then we can take all elements in List/Map have same type, thus reduce runtime check cost.  Collection/Array polymorphism are not fully supported, since some languages such as golang have only one collection type. If users want to get exactly the type he passed, he must pass that type when deserializing or annotate that type to the field of struct.  ","version":"dev","tagName":"h3"},{"title":"Type disambiguation‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#type-disambiguation","content":" Due to differences between type systems of languages, those types can't be mapped one-to-one between languages. When deserializing, Fory use the target data structure type and the data type in the data jointly to determine how to deserialize and populate the target data structure. For example:  class Foo { int[] intArray; Object[] objects; List&lt;Object&gt; objectList; } class Foo2 { int[] intArray; List&lt;Object&gt; objects; List&lt;Object&gt; objectList; }   intArray has an int32_array type. But both objects and objectList fields in the serialize data have list data type. When deserializing, the implementation will create an Object array for objects, but create a ArrayListfor objectList to populate its elements. And the serialized data of Foo can be deserialized into Foo2 too.  Users can also provide meta hints for fields of a type, or the type whole. Here is an example in java which use annotation to provide such information.  @ForyObject(fieldsNullable = false, trackingRef = false) class Foo { @ForyField(trackingRef = false) int[] intArray; @ForyField(polymorphic = true) Object object; @ForyField(tagId = 1, nullable = true) List&lt;Object&gt; objectList; }   Such information can be provided in other languages too:  cpp: use macro and template.golang: use struct tag.python: use typehint.rust: use macro.  ","version":"dev","tagName":"h3"},{"title":"Type ID‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#type-id","content":" All internal data types use an 8-bit internal ID (0~255, with 0~56 defined here). Users can register types by numeric ID (0~0xFFFFFFFE in current implementations). User IDs are encoded separately from the internal type ID; there is no bit shifting/packing.  Named types (NAMED_*) do not embed a user ID; their names are carried in metadata instead.  Internal Type ID Table‚Äã  Type ID\tName\tDescription0\tUNKNOWN\tUnknown type, used for dynamic typing 1\tBOOL\tBoolean value 2\tINT8\t8-bit signed integer 3\tINT16\t16-bit signed integer 4\tINT32\t32-bit signed integer 5\tVARINT32\tVariable-length encoded 32-bit signed integer 6\tINT64\t64-bit signed integer 7\tVARINT64\tVariable-length encoded 64-bit signed integer 8\tTAGGED_INT64\tHybrid encoded 64-bit signed integer 9\tUINT8\t8-bit unsigned integer 10\tUINT16\t16-bit unsigned integer 11\tUINT32\t32-bit unsigned integer 12\tVAR_UINT32\tVariable-length encoded 32-bit unsigned integer 13\tUINT64\t64-bit unsigned integer 14\tVAR_UINT64\tVariable-length encoded 64-bit unsigned integer 15\tTAGGED_UINT64\tHybrid encoded 64-bit unsigned integer 16\tFLOAT8\t8-bit floating point (float8) 17\tFLOAT16\t16-bit floating point (half precision) 18\tBFLOAT16\t16-bit brain floating point 19\tFLOAT32\t32-bit floating point (single precision) 20\tFLOAT64\t64-bit floating point (double precision) 21\tSTRING\tUTF-8/UTF-16/Latin1 encoded string 22\tLIST\tOrdered collection (List, Array, Vector) 23\tSET\tUnordered collection of unique elements 24\tMAP\tKey-value mapping 25\tENUM\tEnum registered by numeric ID 26\tNAMED_ENUM\tEnum registered by namespace + type name 27\tSTRUCT\tStruct registered by numeric ID (schema consistent) 28\tCOMPATIBLE_STRUCT\tStruct with schema evolution support (by ID) 29\tNAMED_STRUCT\tStruct registered by namespace + type name 30\tNAMED_COMPATIBLE_STRUCT\tStruct with schema evolution (by name) 31\tEXT\tExtension type registered by numeric ID 32\tNAMED_EXT\tExtension type registered by namespace + type name 33\tUNION\tUnion value, schema identity not embedded 34\tTYPED_UNION\tUnion value with registered numeric type ID 35\tNAMED_UNION\tUnion value with embedded type name/TypeDef 36\tNONE\tEmpty/unit type (no data) 37\tDURATION\tTime duration (seconds + nanoseconds) 38\tTIMESTAMP\tPoint in time (seconds + nanoseconds since epoch) 39\tDATE\tDate without timezone (days since epoch) 40\tDECIMAL\tArbitrary precision decimal 41\tBINARY\tRaw binary data 42\tARRAY\tGeneric array type 43\tBOOL_ARRAY\t1D boolean array 44\tINT8_ARRAY\t1D int8 array 45\tINT16_ARRAY\t1D int16 array 46\tINT32_ARRAY\t1D int32 array 47\tINT64_ARRAY\t1D int64 array 48\tUINT8_ARRAY\t1D uint8 array 49\tUINT16_ARRAY\t1D uint16 array 50\tUINT32_ARRAY\t1D uint32 array 51\tUINT64_ARRAY\t1D uint64 array 52\tFLOAT8_ARRAY\t1D float8 array 53\tFLOAT16_ARRAY\t1D float16 array 54\tBFLOAT16_ARRAY\t1D bfloat16 array 55\tFLOAT32_ARRAY\t1D float32 array 56\tFLOAT64_ARRAY\t1D float64 array  Type ID Encoding for User Types‚Äã  When registering user types (struct/ext/enum/union), the internal type ID is written as the 8-bit kind. The user type ID is written separately as an unsigned varint32 (small7); there is no bit shift or packing.  Examples:  User ID\tType\tInternal ID\tEncoded User ID\tDecimal0\tSTRUCT\t27\t0\t0 0\tENUM\t25\t0\t0 1\tSTRUCT\t27\t1\t1 1\tCOMPATIBLE_STRUCT\t28\t1\t1 2\tNAMED_STRUCT\t29\t2\t2  When reading type IDs:  Read internal type ID from the type ID field.If the internal type is a user-registered kind, read user_type_id as varuint32.  ","version":"dev","tagName":"h3"},{"title":"Type mapping‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#type-mapping","content":" See Type mapping  ","version":"dev","tagName":"h3"},{"title":"Spec overview‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#spec-overview","content":" Here is the overall format:  | fory header | object ref meta | object type meta | object value data |   The data are serialized using little endian byte order for all types.  ","version":"dev","tagName":"h2"},{"title":"Fory header‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#fory-header","content":" Fory header format for xlang serialization:  | 1 byte bitmap | +--------------------------------+ | flags |   Detailed byte layout:  Byte 0: Bitmap flags - Bit 0: null flag (0x01) - Bit 1: xlang flag (0x02) - Bit 2: oob flag (0x04) - Bits 3-7: reserved   null flag (bit 0): 1 when object is null, 0 otherwise. If an object is null, only this flag is set.xlang flag (bit 1): 1 when serialization uses Fory xlang format, 0 when serialization uses Fory language-native format.oob flag (bit 2): 1 when out-of-band serialization is enabled (BufferCallback is not null), 0 otherwise.  All data is encoded in little-endian format.  ","version":"dev","tagName":"h2"},{"title":"Reference Meta‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#reference-meta","content":" Reference tracking handles whether the object is null, and whether to track reference for the object by writing corresponding flags and maintaining internal state.  ","version":"dev","tagName":"h2"},{"title":"Reference Flags‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#reference-flags","content":" Flag\tByte Value (int8)\tHex\tDescriptionNULL FLAG\t-3\t0xFD\tObject is null. No further bytes are written for this object. REF FLAG\t-2\t0xFE\tObject was already serialized. Followed by unsigned varint32 reference ID. NOT_NULL VALUE FLAG\t-1\t0xFF\tObject is non-null but reference tracking is disabled for this type. Object data follows immediately. REF VALUE FLAG\t0\t0x00\tObject is referencable and this is its first occurrence. Object data follows. Assigns next reference ID.  ","version":"dev","tagName":"h3"},{"title":"Reference Tracking Algorithm‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#reference-tracking-algorithm","content":" Writing:  function write_ref_or_null(buffer, obj): if obj is null: buffer.write_int8(NULL_FLAG) // -3 return true // done, no more data to write if reference_tracking_enabled: ref_id = lookup_written_objects(obj) if ref_id exists: buffer.write_int8(REF_FLAG) // -2 buffer.write_varuint32(ref_id) return true // done, reference written else: buffer.write_int8(REF_VALUE_FLAG) // 0 add_to_written_objects(obj, next_ref_id++) return false // continue to serialize object data else: buffer.write_int8(NOT_NULL_VALUE_FLAG) // -1 return false // continue to serialize object data   Reading:  function read_ref_or_null(buffer): flag = buffer.read_int8() switch flag: case NULL_FLAG (-3): return (null, true) // null object, done case REF_FLAG (-2): ref_id = buffer.read_varuint32() obj = get_from_read_objects(ref_id) return (obj, true) // referenced object, done case NOT_NULL_VALUE_FLAG (-1): return (null, false) // non-null, continue reading case REF_VALUE_FLAG (0): reserve_ref_slot() // will be filled after reading return (null, false) // non-null, continue reading   ","version":"dev","tagName":"h3"},{"title":"Reference ID Assignment‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#reference-id-assignment","content":" Reference IDs are assigned sequentially starting from 0The ID is assigned when REF_VALUE_FLAG is written (first occurrence)Objects are stored in a list/map indexed by their reference IDFor reading, a placeholder slot is reserved before deserializing the object, then filled after  ","version":"dev","tagName":"h3"},{"title":"When Reference Tracking is Disabled‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#when-reference-tracking-is-disabled","content":" When reference tracking is disabled globally or for specific types, only the NULL and NOT_NULL VALUE flags will be used for reference meta. This reduces overhead for types that are known not to have references.  ","version":"dev","tagName":"h3"},{"title":"Language-Specific Considerations‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#language-specific-considerations","content":" Languages with nullable and reference types by default (Java, Python, JavaScript):  In xlang mode, for cross-language compatibility:  All fields are treated as not-null by defaultReference tracking is disabled by defaultUsers can explicitly mark fields as nullable or enable reference tracking via annotationsOptional types (e.g., java.util.Optional, typing.Optional) are treated as nullable  Annotation examples:  // Java: use @ForyField annotation public class MyClass { @ForyField(nullable = true, ref = true) private Object refField; @ForyField(nullable = false) private String requiredField; }   # Python: use typing with fory field descriptors from pyfory import Fory, ForyField class MyClass: ref_field: ForyField(SomeType, nullable=True, ref=True) required_field: ForyField(str, nullable=False)   Languages with non-nullable types by default:  Language\tNull Representation\tReference Tracking SupportRust\tOption::None\tVia Rc&lt;T&gt;, Arc&lt;T&gt;, Weak&lt;T&gt; C++\tstd::nullopt, nullptr\tVia std::shared_ptr&lt;T&gt;, weak_ptr&lt;T&gt; Go\tnil interface/pointer\tVia pointer/interface types  Important: For languages like Rust that don't have implicit reference semantics, reference tracking must use explicit smart pointers (Rc, Arc).  ","version":"dev","tagName":"h3"},{"title":"Type Meta‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#type-meta","content":" Every non-primitive value begins with a type ID that identifies its concrete type. The type ID is followed by optional type-specific metadata.  ","version":"dev","tagName":"h2"},{"title":"Type ID encoding‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#type-id-encoding","content":" The type ID is written as an unsigned varint32 (small7).Internal types use their internal type ID directly (low 8 bits).User-registered types write the internal type ID, then write user_type_id as varuint32. user_type_id is a numeric ID (0~0xFFFFFFFE in current implementations).internal_type_id is one of ENUM, STRUCT, COMPATIBLE_STRUCT, EXT, or TYPED_UNION. Named types do not embed a user ID. They use NAMED_* internal type IDs and carry a namespace and type name (or shared TypeDef) instead.  ","version":"dev","tagName":"h3"},{"title":"Type meta payload‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#type-meta-payload","content":" After the type ID:  ENUM / STRUCT / EXT / TYPED_UNION: no extra bytes beyond the user_type_id (registration by ID required on both sides).COMPATIBLE_STRUCT: If meta share is enabled, write a shared TypeDef entry (see below).If meta share is disabled, no extra bytes. NAMED_ENUM / NAMED_STRUCT / NAMED_COMPATIBLE_STRUCT / NAMED_EXT / NAMED_UNION: If meta share is disabled, write namespace and type_name as meta strings.If meta share is enabled, write a shared TypeDef entry (see below). UNION: no extra bytes at this layer.LIST / SET / MAP / ARRAY / primitives: no extra bytes at this layer.  Unregistered types are serialized as named types:  Enums -&gt; NAMED_ENUMStruct-like classes -&gt; NAMED_STRUCT (or NAMED_COMPATIBLE_STRUCT when meta share is enabled)Custom extension types -&gt; NAMED_EXTUnions -&gt; NAMED_UNION  The namespace is the package/module name and the type name is the simple class name.  ","version":"dev","tagName":"h3"},{"title":"Shared Type Meta (streaming)‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#shared-type-meta-streaming","content":" When meta share is enabled, TypeDef metadata is written inline the first time a type is encountered, and subsequent occurrences only reference it.  Encoding:  marker = (index &lt;&lt; 1) | flagflag = 0: new type definition followsflag = 1: reference to a previously written type definitionindex is the sequential index assigned to this type (starting from 0).  Write algorithm:  Look up the class in the per-stream meta context map.If found, write (index &lt;&lt; 1) | 1.If not found: assign index = next_idwrite (index &lt;&lt; 1)write the encoded TypeDef bytes immediately after  Read algorithm:  Read marker as varuint32.flag = marker &amp; 1, index = marker &gt;&gt;&gt; 1.If flag == 1, use the cached TypeDef at index.If flag == 0, read a TypeDef, cache it at index, and use it.  TypeDef bytes include the 8-byte global header and optional size extension.  ","version":"dev","tagName":"h3"},{"title":"TypeDef (schema evolution metadata)‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#typedef-schema-evolution-metadata","content":" TypeDef describes a struct-like type (or a named enum/ext) for schema evolution and name resolution. It is encoded as:  | 8-byte global header | [optional size varuint] | TypeDef body |   Global header‚Äã  The 8-byte header is a little-endian uint64:  Low 8 bits: meta size (number of bytes in the TypeDef body). If meta size &gt;= 0xFF, the low 8 bits are set to 0xFF and an extravaruint32(meta_size - 0xFF) follows immediately after the header. Bit 8: HAS_FIELDS_META (1 = fields metadata present).Bit 9: COMPRESS_META (1 = body is compressed; decompress before parsing).Bits 10-13: reserved for future extension (must be zero).High 50 bits: hash of the TypeDef body.  TypeDef body‚Äã  TypeDef body has a single layer (fields are flattened in class hierarchy order):  | meta header (1 byte) | type spec | field info ... |   Meta header byte:  Bits 0-4: num_fields (0-30). If num_fields == 31, read an extra varuint32 and add it. Bit 5: REGISTER_BY_NAME (1 = namespace + type name, 0 = numeric type ID).Bits 6-7: reserved.  Type spec:  If REGISTER_BY_NAME is set: namespace meta stringtype_name meta string Otherwise: type_id as varuint32 (small7)  Field info list:  Each field is encoded as:  | field header (1 byte) | field type info | [field name bytes] |   Field header layout:  Bits 6-7: field name encoding (UTF8, ALL_TO_LOWER_SPECIAL,LOWER_UPPER_DIGIT_SPECIAL, or TAG_ID)Bits 2-5: size For name encoding: size = (name_bytes_length - 1)For tag ID: size = tag_idIf size == 0b1111, read varuint32(size - 15) and add it Bit 1: nullable flagBit 0: reference tracking flag  Field type info:  The top-level field type is written as varuint32(type_id) (small7) without flags.For LIST / SET, an element type follows, encoded as(nested_type_id &lt;&lt; 2) | (nullable &lt;&lt; 1) | tracking_ref.For MAP, key type and value type follow, both encoded the same way.One-dimensional primitive arrays use *_ARRAY type IDs; other arrays are encoded as LIST.  Field names:  If TAG_ID encoding is used, no name bytes are written.Otherwise, write the encoded field name bytes as a meta string.For xlang, field names are converted to snake_case before encoding for cross-language compatibility.  Field order:  Field order is implementation-defined. Decoders must match fields by name or tag ID rather than position. Fory uses a stable grouping and sorting order to produce deterministic TypeDefs.  ","version":"dev","tagName":"h3"},{"title":"Meta String‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#meta-string","content":" Meta string is a compressed encoding for metadata strings such as field names, type names, and namespaces. This compression significantly reduces the size of type metadata in serialized data.  ","version":"dev","tagName":"h2"},{"title":"Encoding Type IDs‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#encoding-type-ids","content":" ID\tName\tBits/Char\tCharacter Set0\tUTF8\t8\tAny UTF-8 character 1\tLOWER_SPECIAL\t5\ta-z . _ $ | 2\tLOWER_UPPER_DIGIT_SPECIAL\t6\ta-z A-Z 0-9 . _ 3\tFIRST_TO_LOWER_SPECIAL\t5\tFirst char uppercase, rest a-z . _ 4\tALL_TO_LOWER_SPECIAL\t5\ta-z A-Z . _ (uppercase escaped)  ","version":"dev","tagName":"h3"},{"title":"Character Mapping Tables‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#character-mapping-tables","content":" LOWER_SPECIAL (5 bits per character)‚Äã  Character\tCode (binary)\tCode (decimal)a-z\t00000-11001\t0-25 .\t11010\t26 _\t11011\t27 $\t11100\t28 |\t11101\t29  Note: The | character is used as an escape sequence in ALL_TO_LOWER_SPECIAL encoding.  LOWER_UPPER_DIGIT_SPECIAL (6 bits per character)‚Äã  Character\tCode (binary)\tCode (decimal)a-z\t000000-011001\t0-25 A-Z\t011010-110011\t26-51 0-9\t110100-111101\t52-61 .\t111110\t62 _\t111111\t63  ","version":"dev","tagName":"h3"},{"title":"Encoding Algorithms‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#encoding-algorithms","content":" LOWER_SPECIAL Encoding‚Äã  For strings containing only a-z, ., _, $, |:  function encode_lower_special(str): bits = [] for char in str: bits.append(lookup_lower_special[char]) // 5 bits each // Pad to byte boundary total_bits = len(str) * 5 padding_bits = (8 - (total_bits % 8)) % 8 // First bit indicates if last char should be stripped (due to padding) strip_last = (padding_bits &gt;= 5) if strip_last: prepend bit 1 else: prepend bit 0 return pack_bits_to_bytes(bits)   FIRST_TO_LOWER_SPECIAL Encoding‚Äã  For strings like MyFieldName where only the first character is uppercase:  function encode_first_to_lower_special(str): // Convert first char to lowercase modified = str[0].lower() + str[1:] // Then use LOWER_SPECIAL encoding return encode_lower_special(modified)   ALL_TO_LOWER_SPECIAL Encoding‚Äã  For strings with multiple uppercase characters like MyTypeName:  function encode_all_to_lower_special(str): result = &quot;&quot; for char in str: if char.is_upper(): result += &quot;|&quot; + char.lower() // Escape uppercase with | else: result += char return encode_lower_special(result)   Example: MyType ‚Üí |my|type ‚Üí encoded with LOWER_SPECIAL  ","version":"dev","tagName":"h3"},{"title":"Encoding Selection Algorithm‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#encoding-selection-algorithm","content":" function choose_encoding(str): if all chars in str are in [a-z . _ $ |]: return LOWER_SPECIAL if first char is uppercase AND rest are in [a-z . _]: return FIRST_TO_LOWER_SPECIAL if all chars are in [a-z A-Z . _]: lower_special_size = encode_all_to_lower_special(str).size luds_size = encode_lower_upper_digit_special(str).size if lower_special_size &lt;= luds_size: return ALL_TO_LOWER_SPECIAL else: return LOWER_UPPER_DIGIT_SPECIAL if all chars are in [a-z A-Z 0-9 . _]: return LOWER_UPPER_DIGIT_SPECIAL return UTF8   ","version":"dev","tagName":"h3"},{"title":"Meta String Header Format‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#meta-string-header-format","content":" Meta strings are written with a header that includes the encoding type:  | 3 bits encoding | 5+ bits length | encoded bytes |   Or for larger strings:  | varuint: (length &lt;&lt; 3) | encoding | encoded bytes |   ","version":"dev","tagName":"h3"},{"title":"Special Character Sets by Context‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#special-character-sets-by-context","content":" Different contexts use different special characters:  Context\tSpecial Chars\tNotesField Name\t. _ $ |\t$ for inner classes, | for escape Namespace\t. _\tPackage/module separators Type Name\t$ _\t$ for inner classes in Java  ","version":"dev","tagName":"h3"},{"title":"Deduplication‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#deduplication","content":" Meta strings are deduplicated within a serialization session:  First occurrence: | (length &lt;&lt; 1) | [hash if large] | encoding | bytes | Reference: | ((id + 1) &lt;&lt; 1) | 1 |   Bit 0 of the header indicates: 0 = new string, 1 = reference to previousLarge strings (&gt; 16 bytes) include 64-bit hash for content-based deduplicationSmall strings use exact byte comparison  ","version":"dev","tagName":"h3"},{"title":"Value Format‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#value-format","content":" ","version":"dev","tagName":"h2"},{"title":"Basic types‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#basic-types","content":" bool‚Äã  size: 1 byteformat: 0 for false, 1 for true  int8‚Äã  size: 1 byteformat: write as pure byte.  int16‚Äã  size: 2 bytebyte order: raw bytes of little endian order  unsigned int32‚Äã  size: 4 bytebyte order: raw bytes of little endian order  unsigned varint32‚Äã  size: 1~5 bytesFormat: The most significant bit (MSB) in every byte indicates whether to have the next byte. If the continuation bit is set (i.e. b &amp; 0x80 == 0x80), then the next byte should be read until a byte with unset continuation bit.  Encoding Algorithm:  function write_varuint32(value): while value &gt;= 0x80: buffer.write_byte((value &amp; 0x7F) | 0x80) // 7 bits of data + continuation bit value = value &gt;&gt; 7 buffer.write_byte(value) // final byte without continuation bit   Decoding Algorithm:  function read_varuint32(): result = 0 shift = 0 while true: byte = buffer.read_byte() result = result | ((byte &amp; 0x7F) &lt;&lt; shift) if (byte &amp; 0x80) == 0: break shift = shift + 7 return result   Byte sizes by value range:  Value Range\tBytes0 ~ 127\t1 128 ~ 16383\t2 16384 ~ 2097151\t3 2097152 ~ 268435455\t4 268435456 ~ 4294967295\t5  signed int32‚Äã  size: 4 bytesbyte order: raw bytes of little endian order  signed varint32‚Äã  size: 1~5 bytesFormat: First convert the number into positive unsigned int using ZigZag encoding, then encode as unsigned varint.  ZigZag Encoding:  // Encode: convert signed to unsigned zigzag_value = (value &lt;&lt; 1) ^ (value &gt;&gt; 31) // Decode: convert unsigned back to signed original = (zigzag_value &gt;&gt; 1) ^ (-(zigzag_value &amp; 1)) // Or equivalently: original = (zigzag_value &gt;&gt; 1) ^ (~(zigzag_value &amp; 1) + 1)   ZigZag encoding maps signed integers to unsigned integers so that small absolute values (positive or negative) have small encoded values:  Original\tZigZag Encoded0\t0 -1\t1 1\t2 -2\t3 2\t4 ...\t...  unsigned int64‚Äã  size: 8 bytesbyte order: raw bytes of little endian order  unsigned varint64‚Äã  size: 1~9 bytes  Uses PVL (Progressive Variable-Length) encoding:  function write_varuint64(value): while value &gt;= 0x80: buffer.write_byte((value &amp; 0x7F) | 0x80) value = value &gt;&gt; 7 buffer.write_byte(value)   Value Range\tBytes0 ~ 127\t1 128 ~ 16383\t2 ...\t... 2^56 ~ 2^63-1\t9  unsigned hybrid int64 (TAGGED_UINT64)‚Äã  size: 4 or 9 bytes  Optimized for unsigned values that fit in 31 bits (common case for IDs, sizes, counts, etc.):  if value in [0, 2147483647]: // fits in 31 bits (2^31 - 1), full unsigned range write 4 bytes: ((int32) value) &lt;&lt; 1 // bit 0 is 0, indicating 4-byte encoding else: write 1 byte: 0x01 // bit 0 is 1, indicating 9-byte encoding write 8 bytes: value as little-endian uint64   Reading:  first_int32 = read_int32_le() if (first_int32 &amp; 1) == 0: return (uint64)(first_int32 &gt;&gt; 1) // 4-byte encoding, unsigned else: return read_uint64_le() // read remaining 8 bytes   Note: TAGGED_UINT64 uses the full 31 bits for positive values [0, 2^31-1], compared to TAGGED_INT64 which splits the range for signed values [-2^30, 2^30-1].  VarUint36Small‚Äã  A specialized encoding used for string headers that combines size (up to 36 bits) with encoding flags:  // Write: encodes (size &lt;&lt; 2) | encoding_flags function write_varuint36_small(value): if value &lt; 0x80: buffer.write_byte(value) else: // Standard varint encoding for values &gt;= 128 write_varuint64(value)   This encoding is optimized for the common case where string length fits in 7 bits (strings &lt; 32 characters).  signed int64‚Äã  size: 8 bytesbyte order: raw bytes of little endian order  signed varint64‚Äã  size: 1~9 bytes  Uses ZigZag encoding first, then PVL varint:  // Encode zigzag_value = (value &lt;&lt; 1) ^ (value &gt;&gt; 63) write_varuint64(zigzag_value) // Decode zigzag_value = read_varuint64() value = (zigzag_value &gt;&gt; 1) ^ (-(zigzag_value &amp; 1))   signed hybrid int64 (TAGGED_INT64)‚Äã  size: 4 or 9 bytes  Optimized for small signed values:  if value in [-1073741824, 1073741823]: // fits in 30 bits + sign ([-2^30, 2^30-1]) write 4 bytes: ((int32) value) &lt;&lt; 1 // bit 0 is 0, indicating 4-byte encoding else: write 1 byte: 0x01 // bit 0 is 1, indicating 9-byte encoding write 8 bytes: value as little-endian int64   Reading:  first_int32 = read_int32_le() if (first_int32 &amp; 1) == 0: return (int64)(first_int32 &gt;&gt; 1) // 4-byte encoding, sign-extended else: return read_int64_le() // read remaining 8 bytes   Note: TAGGED_INT64 uses 30 bits + sign for values [-2^30, 2^30-1], while TAGGED_UINT64 uses full 31 bits for unsigned values [0, 2^31-1].  float8‚Äã  size: 1 byteformat: float8 has 4 kinds: float8 kind enum: float8_e4m3fn, float8_e4m3fnuz, float8_e5m2, float8_e5m2fnuzwhen serialize as field, write raw 8 bits as one byte directlywhen serialize as an object: write type kind as a byte, then write value byte  float16‚Äã  size: 2 bytesformat: encode the specified floating-point value according to the IEEE 754 standard binary16 format, preserving NaN values, then write as binary by little endian order.  bfloat16‚Äã  size: 2 bytesformat: encode the specified floating-point value according to the IEEE 754 standard bfloat16 format, preserving NaN values, then write as binary by little endian order.  float32‚Äã  size: 4 byteformat: encode the specified floating-point value according to the IEEE 754 floating-point &quot;single format&quot; bit layout, preserving Not-a-Number (NaN) values, then write as binary by little endian order.  float64‚Äã  size: 8 byteformat: encode the specified floating-point value according to the IEEE 754 floating-point &quot;double format&quot; bit layout, preserving Not-a-Number (NaN) values. then write as binary by little endian order.  ","version":"dev","tagName":"h3"},{"title":"string‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#string","content":" Format:  | varuint36_small: (size &lt;&lt; 2) | encoding | binary data |   String Header‚Äã  The header is encoded using varuint36_small format, which combines the byte length and encoding type:  header = (byte_length &lt;&lt; 2) | encoding_type   Encoding Type\tValue\tDescriptionLATIN1\t0\tISO-8859-1 single-byte encoding UTF16\t1\tUTF-16 encoding (2 bytes per code unit) UTF8\t2\tUTF-8 variable-length encoding Reserved\t3\tReserved for future use  Encoding Algorithm‚Äã  Writing:  function write_string(str): bytes = encode_to_bytes(str, chosen_encoding) header = (bytes.length &lt;&lt; 2) | encoding_type buffer.write_varuint36_small(header) buffer.write_bytes(bytes)   Reading:  function read_string(): header = buffer.read_varuint36_small() encoding = header &amp; 0x03 byte_length = header &gt;&gt; 2 bytes = buffer.read_bytes(byte_length) return decode_bytes(bytes, encoding)   Encoding Selection by Language‚Äã  Writing:  Language\tEncoding StrategyJava (JDK8)\tDetect at runtime: LATIN1 if all chars &lt; 256, else UTF16 Java (JDK9+)\tUse String's internal coder: LATIN1 or UTF16 Python\tCan write LATIN1, UTF16, or UTF8 based on string content C++\tUTF8 (std::string) or UTF16 (std::u16string) Rust\tUTF8 (String) Go\tUTF8 (string) JavaScript\tUTF8  Reading: All languages support decoding all three encodings (LATIN1, UTF16, UTF8).  Recommendation: Select encoding based on maximum performance - use the encoding that matches the language's native string representation to avoid conversion overhead.  Empty String‚Äã  Empty strings are encoded with header 0 (length 0, any encoding) followed by no data bytes.  ","version":"dev","tagName":"h3"},{"title":"duration‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#duration","content":" Duration is an absolute length of time, independent of any calendar/timezone, as a count of seconds and nanoseconds.  Format:  | signed varint64: seconds | signed int32: nanoseconds |   seconds: Number of seconds in the duration, encoded as a signed varint64. Can be positive or negative.nanoseconds: Nanosecond adjustment to the duration, encoded as a signed int32. Value range is [0, 999,999,999] for positive durations, and [-999,999,999, 0] for negative durations.  Notes:  The duration is stored as two separate fields to maintain precision and avoid overflow issues.Seconds are encoded using varint64 for compact representation of common duration values.Nanoseconds are stored as a fixed int32 since the range is limited.The sign of the duration is determined by the seconds field. When seconds is 0, the sign is determined by nanoseconds.  ","version":"dev","tagName":"h3"},{"title":"collection/list‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#collectionlist","content":" Format:  | varuint32: length | 1 byte elements header | [optional type info] | elements data |   Elements Header‚Äã  The elements header is a single byte that encodes metadata about the collection elements to optimize serialization:  | bit 7-4 (reserved) | bit 3 | bit 2 | bit 1 | bit 0 | +--------------------+-------------+------------------+----------+-----------+ | reserved | is_same_type| is_decl_elem_type| has_null | track_ref |   Bit\tName\tValue\tMeaning when SET (1)\tMeaning when UNSET (0)0\ttrack_ref\t0x01\tTrack references for elements\tDon't track element references 1\thas_null\t0x02\tCollection may contain null elements\tNo null elements (skip null checks) 2\tis_decl_elem_type\t0x04\tElements are the declared generic type\tElement types differ from declared type 3\tis_same_type\t0x08\tAll elements have the same runtime type\tElements have different runtime types  Common header values:  Header\tHex\tMeaning0x0C\t12\tDeclared type + same type, non-null, no ref tracking (optimal) 0x0D\t13\tDeclared type + same type, non-null, with ref tracking 0x0E\t14\tDeclared type + same type, may have nulls, no ref tracking 0x08\t8\tSame type but not declared type (type info written once) 0x00\t0\tDifferent types, non-null, no ref tracking (type per element)  Type Info After Header‚Äã  When is_decl_elem_type (bit 2) is NOT set, the element type info is written once after the header if is_same_type (bit 3) is set:  | header (0x08) | type_id (varuint32) | elements... |   When both is_decl_elem_type and is_same_type are NOT set, type info is written per element.  Element Serialization Based on Header‚Äã  The header determines how each element is serialized:  elements data‚Äã  Based on the elements header, the serialization of elements data may skip ref flag/null flag/element type info.  fory = ... buffer = ... elems = ... if element_type_is_same: if not is_declared_type: fory.write_type(buffer, elem_type) elem_serializer = get_serializer(...) if track_ref: for elem in elems: if not ref_resolver.write_ref_or_null(buffer, elem): elem_serializer.write(buffer, elem) elif has_null: for elem in elems: if elem is None: buffer.write_byte(null_flag) else: buffer.write_byte(not_null_flag) elem_serializer.write(buffer, elem) else: for elem in elems: elem_serializer.write(buffer, elem) else: if track_ref: for elem in elems: fory.write_ref(buffer, elem) elif has_null: for elem in elems: fory.write_nullable(buffer, elem) else: for elem in elems: fory.write_value(buffer, elem)   CollectionSerializer#writeElementscan be taken as an example.  ","version":"dev","tagName":"h3"},{"title":"array‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#array","content":" primitive array‚Äã  Primitive array are taken as a binary buffer, serialization will just write the length of array size as an unsigned int, then copy the whole buffer into the stream.  Such serialization won't compress the array. If users want to compress primitive array, users need to register custom serializers for such types or mark it as list type.  Float array specifics:  float16/bfloat16 array: write varuint length, then raw bytes in little endian order.float8 array: write element type kind as a byte, then varuint length, then raw bytes in little endian order.  Multi-dimensional arrays‚Äã  Xlang does not define a dedicated tensor encoding. Multi-dimensional arrays are serialized as nested lists, while one-dimensional primitive arrays use the *_ARRAY type IDs.  object array‚Äã  Object array is serialized using the list format. Object component type will be taken as list element generic type.  ","version":"dev","tagName":"h3"},{"title":"map‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#map","content":" Map uses a chunk-based format to handle heterogeneous key-value pairs efficiently:  | varuint32: total_size | chunk_1 | chunk_2 | ... | chunk_n |   Map Chunk Format‚Äã  Each chunk contains up to 255 key-value pairs with the same metadata characteristics:  | 1 byte | 1 byte | variable bytes | +--------------+----------------+------------------------------+ | KV header | chunk size N | N key-value pairs (N*2 obj) |   KV Header Bits‚Äã  The KV header is a single byte encoding metadata for both keys and values:  | bit 7-6 | bit 5 | bit 4 | bit 3 | bit 2 | bit 1 | bit 0 | +------------+---------------+--------------+---------------+---------------+--------------+---------------+ | reserved | val_decl_type | val_has_null | val_track_ref | key_decl_type | key_has_null | key_track_ref |   Bit\tName\tValue\tMeaning when SET (1)0\tkey_track_ref\t0x01\tTrack references for keys 1\tkey_has_null\t0x02\tKeys may be null (rare, usually invalid) 2\tkey_decl_type\t0x04\tKey is the declared generic type 3\tval_track_ref\t0x08\tTrack references for values 4\tval_has_null\t0x10\tValues may be null 5\tval_decl_type\t0x20\tValue is the declared generic type  Common KV header values:  Header\tHex\tMeaning0x24\t36\tKey + value are declared types, non-null, no ref tracking (optimal) 0x2C\t44\tKey + value declared types, value tracks refs 0x34\t52\tKey + value declared types, value may be null 0x00\t0\tKey + value not declared types, non-null, no ref tracking  Chunk Size‚Äã  Maximum chunk size: 255 pairs (fits in 1 byte)When key or value is null, that entry is serialized as a separate chunk with implicit size 1 (chunk size byte is skipped)Reader tracks accumulated count against total map size to know when to stop reading chunks  Why Chunk-Based Format?‚Äã  Map iteration is expensive. Computing a single header for all pairs would require two passes. The chunk-based approach allows:  Optimistic prediction: Use first key-value pair to predict headerAdaptive chunking: Start new chunk if prediction fails for a pairEfficient reading: Most maps fit in single chunk (&lt; 255 pairs)Memory efficiency: Minimal overhead for common homogeneous maps  Why serialize chunk by chunk?‚Äã  When fory will use first key-value pair to predict header optimistically, it can't know how many pairs have same meta(tracking kef ref, key has null and so on). If we don't write chunk by chunk with max chunk size, we must write at least X bytes to take up a place for later to update the number which has same elements, X is the num_bytes for encoding varint encoding of map size.  And most map size are smaller than 255, if all pairs have same data, the chunk will be 1. This is common in golang/rust, which object are not reference by default.  Also, if only one or two keys have different meta, we can make it into a different chunk, so that most pairs can share meta.  The implementation can accumulate read count with map size to decide whether to read more chunks.  ","version":"dev","tagName":"h3"},{"title":"enum‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#enum","content":" Enums are serialized as an unsigned var int. If the order of enum values change, the deserialized enum value may not be the value users expect. In such cases, users must register enum serializer by make it write enum value as an enumerated string with unique hash disabled.  ","version":"dev","tagName":"h3"},{"title":"timestamp‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#timestamp","content":" Timestamp represents a point in time independent of any calendar/timezone. It is encoded as:  seconds (int64): seconds since Unix epoch (1970-01-01T00:00:00Z)nanos (uint32): nanosecond adjustment within the second  On write, implementations must normalize negative timestamps so that nanos is always in [0, 1_000_000_000). This is a fixed-size 12-byte payload (8 bytes seconds + 4 bytes nanos).  ","version":"dev","tagName":"h3"},{"title":"date‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#date","content":" Date represents a date without timezone. It is encoded as an int32 count of days since the Unix epoch (1970-01-01). This is a fixed-size 4-byte payload.  ","version":"dev","tagName":"h3"},{"title":"decimal‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#decimal","content":" Not supported for now.  ","version":"dev","tagName":"h3"},{"title":"struct‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#struct","content":" Struct means object of class/pojo/struct/bean/record type. Struct values are serialized by writing fields in Fory order. The type meta before the value is written according to the rules inType Meta.  Field order‚Äã  Field order must be deterministic and identical across languages. This section defines the language-neutral ordering algorithm; implementations must follow the rules here rather than any language-specific helper classes.  Step 1: Field identifier‚Äã  For every field, compute a stable identifier used for ordering:  If a tag ID is configured (e.g., @ForyField(id=...)), use the tag ID as a decimal string.Otherwise, use the field name converted to snake_case.  Tag IDs must be unique within a type; duplicate tag IDs are invalid.  Step 2: Group assignment‚Äã  Assign each field to exactly one group in the following order:  Primitive (non-nullable): primitive or boxed numeric/boolean types with nullable=false.Primitive (nullable): primitive or boxed numeric/boolean types with nullable=true.Built-in (non-container): internal type IDs that are not user-defined and not UNKNOWN, excluding collections and maps (for example: STRING, TIME types, UNION/TYPED_UNION/NAMED_UNION, primitive arrays).Collection: list/set/object-array fields. Non-primitive arrays are treated as LIST for ordering purposes.Map: map fields.Other: user-defined enum/struct/ext and UNKNOWN types.  Step 3: Intra-group ordering‚Äã  Within each group, apply the following sort keys in order until a difference is found:  Primitive groups (1 and 2):  Compression category: fixed-size numeric and boolean types first, then compressed numeric types (VARINT32, VAR_UINT32, VARINT64, VAR_UINT64, TAGGED_INT64, TAGGED_UINT64).Primitive size (descending): 8-byte &gt; 4-byte &gt; 2-byte &gt; 1-byte.Internal type ID (descending) as a tie-breaker for equal sizes.Field identifier (lexicographic ascending).  Built-in / Collection / Map groups (3-5):  Internal type ID (ascending).Field identifier (lexicographic ascending).  Other group (6):  Field identifier (lexicographic ascending).  If two fields still compare equal after the rules above, preserve a deterministic order by comparing declaring class name and then the original field name. This tie-breaker should be reachable only in invalid schemas (e.g., duplicate tag IDs).  Notes‚Äã  The ordering above is used for serialization order and TypeDef field lists. Schema hashes use the field identifier ordering described in the schema hash section.Collection/map normalization is required so peers with different concrete types (e.g.,List vs Collection) still agree on ordering.The compressed numeric rule is critical for cross-language consistency: compressed integer fields are always placed after all fixed-width integer fields.  Schema consistent (meta share disabled)‚Äã  Object value layout:  | [optional 4-byte schema hash] | field values |   The schema hash is written only when class-version checking is enabled. It is the low 32 bits of a MurmurHash3 x64_128 of the struct fingerprint string:  For each field, build &lt;field_id_or_name&gt;,&lt;type_id&gt;,&lt;ref&gt;,&lt;nullable&gt;;.Field identifier is the tag ID if present, otherwise the snake_case field name.Sort by field identifier lexicographically before concatenation.  Field values are serialized in Fory order. Primitive fields are written as raw values (nullable primitives include a null flag). Non-primitive fields write ref/null flags as needed and then the value; polymorphic fields include type meta.  Compatible mode (meta share enabled)‚Äã  The field value layout is the same as schema-consistent mode, but the type meta forCOMPATIBLE_STRUCT and NAMED_COMPATIBLE_STRUCT uses shared TypeDef entries. Deserializers use TypeDef to map fields by name or tag ID and to honor nullable/ref flags from metadata; unknown fields are skipped.  ","version":"dev","tagName":"h3"},{"title":"Union‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#union","content":" Union values are encoded using three union type IDs so the union schema identity lives in type meta (likeSTRUCT/ENUM/EXT) and is easy to carry inside Any.  IDL syntax‚Äã  union Contact [id=0] { string email = 1; int32 phone = 2; }   Rules:  Each union alternative MUST have a stable tag number (= 1, = 2, ...).Tag numbers MUST be unique within the union and MUST NOT be reused.  Type IDs and type meta‚Äã  Type ID\tName\tMeaning33\tUNION\tUnion value, schema identity not embedded 34\tTYPED_UNION\tUnion value with registered numeric type ID 35\tNAMED_UNION\tUnion value with embedded type name / shared TypeDef  Type meta encoding:  UNION (33): no additional type meta payload.TYPED_UNION (34): write user_type_id as varuint32 after the type ID.NAMED_UNION (35): followed by named type meta (namespace + type name, or shared TypeDef marker/body).  Union value payload‚Äã  A union payload is:  | case_id (varuint32) | case_value (Any-style value) |   case_id is the union alternative tag number.  case_value MUST be encoded as a full xlang value:  | field_ref_meta | field_value_type_meta | field_value_bytes |   This is required even for primitives so unknown alternatives can be skipped safely.  Wire layouts‚Äã  UNION (schema known from context)  | ... outer ref meta ... | type_id=UNION(33) | case_id | case_value |   TYPED_UNION (schema identified by numeric id)  | ... outer ref meta ... | type_id=TYPED_UNION(34) | user_type_id | case_id | case_value |   user_type_id: varuint32 numeric registration ID for the union schema.  NAMED_UNION (schema embedded by name/typedef)  | ... outer ref meta ... | type_id=NAMED_UNION(35) | name_or_typedef | case_id | case_value |   Decoding rules‚Äã  Read outer ref meta and type_id.If TYPED_UNION, read user_type_id and resolve the union schema by ID.If NAMED_UNION, read named type meta and resolve the union schema.Read case_id.Read case_value as Any-style value (ref meta + type meta + value).  If case_id is unknown, the decoder MUST still consume the case value using field_value_type_meta and standard skipValue(type_id).  When to use each type ID‚Äã  Use UNION when the union schema is known from context.Use TYPED_UNION for dynamic containers when numeric registration is available.Use NAMED_UNION when name-based resolution is preferred or required.  Compatibility notes‚Äã  case_id is a stable identifier; added alternatives are forward compatible and unknown cases can be skipped.  ","version":"dev","tagName":"h3"},{"title":"Type‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#type","content":" Type will be serialized using type meta format.  ","version":"dev","tagName":"h3"},{"title":"Common Pitfalls‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#common-pitfalls","content":" Byte Order: Always use little-endian for multi-byte valuesVarint Sign Extension: Ensure proper handling of signed vs unsigned varintsReference ID Ordering: IDs must be assigned in serialization orderField Order Consistency: Must match exactly across languages in schema-consistent mode; in compatible mode, match by TypeDef field names or tag IDsString Encoding: Use best encoding for current languageNull Handling: Different languages represent null differentlyEmpty Collections: Still write length (0) and header byteSchema Hash Calculation: Must use the same fingerprint and MurmurHash3 algorithm across languages when enabled  ","version":"dev","tagName":"h2"},{"title":"Language Implementation Guidelines‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/next/specification/xlang_serialization_spec#language-implementation-guidelines","content":" See Xlang Implementation Guide documentation. ","version":"dev","tagName":"h2"},{"title":"How to join Apache Fory‚Ñ¢","type":0,"sectionRef":"#","url":"/docs/community/how_to_join_community","content":"","keywords":"","version":"0.15"},{"title":"Fory Contribution Guide‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/community/how_to_join_community#fory-contribution-guide","content":" The Fory team usually conducts development and issue maintenance on GitHub. Please open the GitHub website, click the Sign up button in the upper right corner, register your own account, and take the first step of your open source journey.  In the Fory repository, we have a guide for all open source contributors, introducing contents such as version management and branch management. Please take a few minutes to read and understand it.  ","version":"0.15","tagName":"h2"},{"title":"Your First Pull Request‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/community/how_to_join_community#your-first-pull-request","content":" ","version":"0.15","tagName":"h2"},{"title":"Step 0: Install Git‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/community/how_to_join_community#step-0-install-git","content":" Git is a version control system used to track and manage code changes in software development projects. It helps developers record and manage the history of the code, facilitating team collaboration, code version control, code merging, and other operations. With Git, you can track each version of each file and easily switch and compare between different versions. Git also provides branch management functionality, allowing multiple concurrent development tasks to be carried out simultaneously.  Visit the official Git website: [https://git-scm.com/] (https://git-scm.com/)Download the latest version of the Git installer.Run the downloaded installer and follow the prompts of the installation wizard to install.After the installation is complete, you can use the git version command in the command line to confirm the successful installation.  ","version":"0.15","tagName":"h3"},{"title":"Step 1: Fork the Project‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/community/how_to_join_community#step-1-fork-the-project","content":" First, you need to fork this project. Enter the Fory project page, and click the Fork button in the upper right corner.In your GitHub account, the project xxxx (your GitHub username)/fory will appear.On your local computer, use the following commands to obtain a fory folder:  // ssh git clone git@github.com:xxxx (your GitHub username)/fory.git // https git clone https://github.com/xxxx (your GitHub username)/fory.git   ","version":"0.15","tagName":"h3"},{"title":"Step 2: Obtain the Project Code‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/community/how_to_join_community#step-2-obtain-the-project-code","content":" Enter the fory folder and add the remote address of fory:  git remote add upstream https://github.com/apache/fory.git   ","version":"0.15","tagName":"h3"},{"title":"Step 3: Create a Branch‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/community/how_to_join_community#step-3-create-a-branch","content":" Alright, now you can start contributing our code. The default branch of Fory is the main branch. Whether it is for function development, bug fixes, or documentation writing, please create a new branch and then merge it to the main branch. Use the following code to create a branch:  // Create a function development branch git checkout -b feat/xxxx // Create a problem-fixing development branch git checkout -b fix/xxxx // Create a documentation, demo branch git checkout -b docs/add-java-demo   Suppose we have created the documentation modification branch docs/add-java-demo and we have added some code and submitted it to the code repository.  git add .git commit -a -m &quot;docs: add java demo and related docs&quot;  ","version":"0.15","tagName":"h3"},{"title":"Step 4: Merge the Modifications‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/community/how_to_join_community#step-4-merge-the-modifications","content":" Switch back to your development branch:  git checkout docs/add-java-demo   Submit the updated code to your branch:  git push origin docs/add-java-demo   ","version":"0.15","tagName":"h3"},{"title":"Step 5: Submit a Pull Request‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/community/how_to_join_community#step-5-submit-a-pull-request","content":" You can click the Compare &amp; pull request button on your GitHub code repository page. Or create it through the contribute button.  Fill in what type of modification this is.Fill in the associated issue.If there are complex changes, please explain the background and solution.  After filling in the relevant information, click Create pull request to submit.  ","version":"0.15","tagName":"h3"},{"title":"Easily Step into the Fory Open Source Contribution Journey‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/community/how_to_join_community#easily-step-into-the-fory-open-source-contribution-journey","content":" &quot;good first issue&quot; is a common label in the open source community, and the purpose of this label is to help new contributors find entry-level issues that are suitable for them.  The entry-level issues of Fory can be viewed through the issue list.  If you currently have the time and willingness to participate in community contributions, you can take a look at good first issue in the issues and select one that interests you and is suitable for you to claim.  ","version":"0.15","tagName":"h2"},{"title":"Embrace the Apache Fory‚Ñ¢ Community‚Äã","type":1,"pageTitle":"How to join Apache Fory‚Ñ¢","url":"/docs/community/how_to_join_community#embrace-the-apache-fory-community","content":" While you contribute code to Fory, we encourage you to participate in other things that make the community more prosperous, such as:  Offer suggestions for the project's development, functional planning, etc.Create articles, videos, and hold lectures to promote Fory.Write promotion plans and execute them together with the team. ","version":"0.15","tagName":"h2"},{"title":"Java Benchmarks","type":0,"sectionRef":"#","url":"/docs/benchmarks/java/","content":"","keywords":"","version":"0.15"},{"title":"System Environment‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/benchmarks/java/#system-environment","content":" Operation SystemÔºö4.9.151-015.x86_64CPUÔºöIntel(R) Xeon(R) Platinum 8163 CPU @ 2.50GHzByte OrderÔºöLittle EndianL1d cacheÔºö 32KL1i cacheÔºö32KL2 cacheÔºö 1024KL3 cacheÔºö 33792K  ","version":"0.15","tagName":"h2"},{"title":"JMH params‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/benchmarks/java/#jmh-params","content":" Don't skip warm up, otherwise the results aren't accurate.   -f 1 -wi 3 -i 3 -t 1 -w 2s -r 2s -rf cs   ","version":"0.15","tagName":"h2"},{"title":"Benchmark Data‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/benchmarks/java/#benchmark-data","content":" ","version":"0.15","tagName":"h2"},{"title":"Struct‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/benchmarks/java/#struct","content":" Struct is a class with 100 primitive fields:  public class Struct { public int f1; public long f2; public float f3; public double f4; // ... public double f99; }   ","version":"0.15","tagName":"h3"},{"title":"Struct2‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/benchmarks/java/#struct2","content":" Struct2 is a class with 100 boxed fields:  public class Struct { public Integer f1; public Long f2; public Float f3; public Double f4; // ... public Double f99; }   ","version":"0.15","tagName":"h3"},{"title":"MediaContent‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/benchmarks/java/#mediacontent","content":" MEDIA_CONTENT is a class from jvm-serializers.  ","version":"0.15","tagName":"h3"},{"title":"Sample‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/benchmarks/java/#sample","content":" SAMPLE is a class from kryo benchmark  ","version":"0.15","tagName":"h3"},{"title":"Benchmark Plots‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/benchmarks/java/#benchmark-plots","content":" ","version":"0.15","tagName":"h2"},{"title":"Serialize to heap buffer‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/benchmarks/java/#serialize-to-heap-buffer","content":" Serialize data java byte array.  Java schema consistent serialization‚Äã  The deserialization peer must have same class definition with the serialization peer. No class forward/backward compatibility are supported in this mode.    Java schema compatible serialization‚Äã  The deserialization peer can have different class definition with the serialization peer. Class forward/backward compatibility are supported in this mode.    Java schema consistent deserialization‚Äã  The deserialization peer must have same class definition with the serialization peer. No class forward/backward compatibility are supported in this mode.    Java schema compatible deserialization‚Äã  The deserialization peer can have different class definition with the serialization peer. Class forward/backward compatibility are supported in this mode.    ","version":"0.15","tagName":"h3"},{"title":"Off-heap serialization‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/benchmarks/java/#off-heap-serialization","content":" Serialize data off-heap memory.  Java schema consistent serialization‚Äã  The deserialization peer must have same class definition with the serialization peer. No class forward/backward compatibility are supported in this mode.    Java schema compatible serialization‚Äã  The deserialization peer can have different class definition with the serialization peer. Class forward/backward compatibility are supported in this mode.    Java schema consistent deserialization‚Äã  The deserialization peer must have same class definition with the serialization peer. No class forward/backward compatibility are supported in this mode.    Java schema compatible deserialization‚Äã  The deserialization peer can have different class definition with the serialization peer. Class forward/backward compatibility are supported in this mode.    ","version":"0.15","tagName":"h3"},{"title":"Zero-copy serialization‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/benchmarks/java/#zero-copy-serialization","content":" Note that zero-copy serialization just avoid the copy in serialization, if you send data to other machine, there may be copies.  But if you serialize data between processes on same node and use shared-memory, if the data are in off-heap before serialization, then other processes can read this buffer without any copies.  Java zero-copy serialize to heap buffer‚Äã    Java zero-copy serialize to direct buffer‚Äã    ","version":"0.15","tagName":"h3"},{"title":"Benchmark Data‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/benchmarks/java/#benchmark-data-1","content":" ","version":"0.15","tagName":"h2"},{"title":"Java Serialization‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/benchmarks/java/#java-serialization","content":" Benchmark\tobjectType\tbufferType\treferences\tFory\tForyMetaShared\tKryo\tFst\tHession\tJdk\tProtostuffserialize\tSTRUCT\tarray\tFalse\t7501415.567260 558194.100861\t882178.995727\t258233.998931\t155908.244240\t330975.350403 serialize\tSTRUCT\tarray\tTrue\t6264439.154428 557542.628765\t757753.756691\t260845.209485\t151258.539369 serialize\tSTRUCT\tdirectBuffer\tFalse\t9834223.243204 1078046.011115\t807847.663261\t266481.009225\t154875.908438\t340262.650047 serialize\tSTRUCT\tdirectBuffer\tTrue\t7551780.823133 853350.408656\t762088.935404\t261762.594966\t156404.686214 serialize\tSTRUCT2\tarray\tFalse\t3586126.623874 325172.969175\t371762.982661\t56056.080075\t36846.049162\t322563.440433 serialize\tSTRUCT2\tarray\tTrue\t3306474.506382 259863.332448\t380638.700267\t60038.879790\t38183.705811 serialize\tSTRUCT2\tdirectBuffer\tFalse\t2643155.135327 355688.882786\t365317.705376\t55924.319442\t37444.967981\t325093.716261 serialize\tSTRUCT2\tdirectBuffer\tTrue\t2391110.083108 338960.426033\t370851.880711\t56674.065604\t35798.679246 serialize\tMEDIA_CONTENT\tarray\tFalse\t3031642.924542 730792.521676\t751892.023189\t367782.358049\t137989.198821\t780618.761219 serialize\tMEDIA_CONTENT\tarray\tTrue\t2250384.600246 445251.084327\t583859.907758\t329427.470680\t140260.668888 serialize\tMEDIA_CONTENT\tdirectBuffer\tFalse\t2479862.129632 608972.517580\t728001.080250\t372477.138150\t138567.623369\t805941.345157 serialize\tMEDIA_CONTENT\tdirectBuffer\tTrue\t1938527.588331 359875.473951\t595679.580108\t353376.085025\t140158.673910 serialize\tSAMPLE\tarray\tFalse\t3570966.469087 1105365.931217\t915907.574306\t220386.502846\t118374.836631\t663272.710783 serialize\tSAMPLE\tarray\tTrue\t1767693.835090 734215.482291\t731869.156376\t192414.014211\t119858.140625 serialize\tSAMPLE\tdirectBuffer\tFalse\t3684487.760591 1376560.302168\t902302.261168\t220981.308085\t118273.584257\t693641.589806 serialize\tSAMPLE\tdirectBuffer\tTrue\t1826456.709478 932887.968348\t723614.066770\t211949.960255\t108263.040839 serialize_compatible\tSTRUCT\tarray\tFalse\t3530406.108869\t9204444.777172\t145964.199559 258650.663523 serialize_compatible\tSTRUCT\tarray\tTrue\t3293059.098127\t7064625.291374\t136180.832879 263564.913879 serialize_compatible\tSTRUCT\tdirectBuffer\tFalse\t2653169.568374\t11650229.648715\t106695.800225 249221.452137 serialize_compatible\tSTRUCT\tdirectBuffer\tTrue\t2393817.762938\t8702412.752357\t106458.212005 263623.143601 serialize_compatible\tSTRUCT2\tarray\tFalse\t2773368.997680\t2575824.143864\t125807.748004 58509.125342 serialize_compatible\tSTRUCT2\tarray\tTrue\t2564174.550276\t3543082.528217\t114983.546343 55552.977735 serialize_compatible\tSTRUCT2\tdirectBuffer\tFalse\t1912402.937879\t2714748.572248\t92130.672361 58908.567439 serialize_compatible\tSTRUCT2\tdirectBuffer\tTrue\t1848338.968058\t1866073.031851\t88989.724768 55524.373547 serialize_compatible\tMEDIA_CONTENT\tarray\tFalse\t1679272.036223\t2992288.235281\t188911.259146 377195.903772 serialize_compatible\tMEDIA_CONTENT\tarray\tTrue\t1406736.538716\t2058738.716953\t145782.916427 351657.879556 serialize_compatible\tMEDIA_CONTENT\tdirectBuffer\tFalse\t1710680.937387\t2291443.556971\t185363.714829 371729.727192 serialize_compatible\tMEDIA_CONTENT\tdirectBuffer\tTrue\t1149999.473994\t1804349.244125\t142836.961878 343834.954942 serialize_compatible\tSAMPLE\tarray\tFalse\t3604596.465625\t4409055.687063\t378907.663184 234454.975158 serialize_compatible\tSAMPLE\tarray\tTrue\t1619648.337293\t1840705.439334\t320815.567701 206174.173039 serialize_compatible\tSAMPLE\tdirectBuffer\tFalse\t3484533.218305\t5043538.364886\t296102.615094 194761.224263 serialize_compatible\tSAMPLE\tdirectBuffer\tTrue\t1730822.630648\t1859289.705838\t276757.392449 212840.483308 deserialize\tSTRUCT\tarray\tFalse\t4595230.434552 607750.343557\t357887.235311\t84709.108821\t29603.066599\t517381.168594 deserialize\tSTRUCT\tarray\tTrue\t4634753.596131 552802.227807\t353480.554035\t91050.370224\t29727.744196 deserialize\tSTRUCT\tdirectBuffer\tFalse\t5012002.859236 910534.169114\t352441.597147\t91151.633583\t28717.004518\t538922.947147 deserialize\tSTRUCT\tdirectBuffer\tTrue\t4864329.316938 914404.107564\t334574.303484\t91037.205901\t29549.998286 deserialize\tSTRUCT2\tarray\tFalse\t1126298.359550 275984.042401\t280131.091068\t69758.767783\t14888.805111\t416212.973861 deserialize\tSTRUCT2\tarray\tTrue\t1046649.083082 222710.554833\t260649.308016\t68616.029248\t14034.100664 deserialize\tSTRUCT2\tdirectBuffer\tFalse\t1117586.457565 319247.256793\t262519.858810\t66866.108653\t14652.043788\t425523.315814 deserialize\tSTRUCT2\tdirectBuffer\tTrue\t1018277.848128 249105.828416\t234973.637096\t65338.345185\t14425.886048 deserialize\tMEDIA_CONTENT\tarray\tFalse\t2054066.903469 577631.234369\t363455.785182\t118156.072284\t38536.250402\t951662.019963 deserialize\tMEDIA_CONTENT\tarray\tTrue\t1507767.206603 365530.417232\t304371.728638\t120016.594171\t38957.191090 deserialize\tMEDIA_CONTENT\tdirectBuffer\tFalse\t1502746.028159 389473.174523\t311691.658687\t111067.942626\t40512.632076\t964664.641598 deserialize\tMEDIA_CONTENT\tdirectBuffer\tTrue\t1290593.975753 306995.220799\t251820.171513\t121820.821260\t37030.594632 deserialize\tSAMPLE\tarray\tFalse\t2069988.624415 979173.981159\t473409.796491\t119471.518388\t29309.573998\t619338.385412 deserialize\tSAMPLE\tarray\tTrue\t1797942.442313 716438.884369\t428315.502365\t121106.002978\t27466.003923 deserialize\tSAMPLE\tdirectBuffer\tFalse\t2229791.078395 983538.936801\t441027.550809\t117806.916589\t28128.457935\t624804.978534 deserialize\tSAMPLE\tdirectBuffer\tTrue\t1958815.397807 762889.302732\t420523.770904\t121940.783597\t28221.014735 deserialize_compatible\tSTRUCT\tarray\tFalse\t2110335.039275\t4978833.206806\t78771.635309 88617.486795 deserialize_compatible\tSTRUCT\tarray\tTrue\t2135681.982674\t4807963.882520\t72805.937649 90206.654212 deserialize_compatible\tSTRUCT\tdirectBuffer\tFalse\t1596464.248141\t5149070.657830\t58574.904225 89580.561575 deserialize_compatible\tSTRUCT\tdirectBuffer\tTrue\t1684681.074242\t5137500.621288\t60685.320299 84407.472531 deserialize_compatible\tSTRUCT2\tarray\tFalse\t849507.176263\t1201998.142474\t60602.285743 63703.763814 deserialize_compatible\tSTRUCT2\tarray\tTrue\t815120.319155\t1058423.614156\t62729.908347 69521.573119 deserialize_compatible\tSTRUCT2\tdirectBuffer\tFalse\t784036.589363\t1131212.586953\t54637.329134 69342.030965 deserialize_compatible\tSTRUCT2\tdirectBuffer\tTrue\t782679.662083\t1089162.408165\t51761.569591 68542.055543 deserialize_compatible\tMEDIA_CONTENT\tarray\tFalse\t1441671.706320\t2279742.810882\t180882.860363 121619.090797 deserialize_compatible\tMEDIA_CONTENT\tarray\tTrue\t1121136.039627\t1623938.202345\t154311.211540 119994.104050 deserialize_compatible\tMEDIA_CONTENT\tdirectBuffer\tFalse\t1256034.732514\t1718098.363961\t134485.160300 107594.474890 deserialize_compatible\tMEDIA_CONTENT\tdirectBuffer\tTrue\t1054942.751816\t1333345.536684\t119311.787329 116531.023438 deserialize_compatible\tSAMPLE\tarray\tFalse\t2296046.895861\t2485564.396196\t255086.928308 121898.105768 deserialize_compatible\tSAMPLE\tarray\tTrue\t1834139.395757\t2002938.794909\t238811.995510 121297.485903 deserialize_compatible\tSAMPLE\tdirectBuffer\tFalse\t2308111.633661\t2289261.533644\t201993.787890 124044.417439 deserialize_compatible\tSAMPLE\tdirectBuffer\tTrue\t1820490.585648\t1927548.827586\t174534.710870 120276.449497   ","version":"0.15","tagName":"h3"},{"title":"Java Zero-copy‚Äã","type":1,"pageTitle":"Java Benchmarks","url":"/docs/benchmarks/java/#java-zero-copy","content":" Benchmark\tarray_size\tbufferType\tdataType\tFory\tKryo\tFstserialize\t200\tarray\tBUFFER\t5123572.914045\t1985187.977633\t2400193.220466 serialize\t200\tarray\tPRIMITIVE_ARRAY\t8297232.942927\t147342.606262\t313986.053417 serialize\t200\tdirectBuffer\tBUFFER\t5400346.890126\t1739454.519770\t2282550.111756 serialize\t200\tdirectBuffer\tPRIMITIVE_ARRAY\t8335248.350301\t972683.763633\t294132.218623 serialize\t1000\tarray\tBUFFER\t4979590.929127\t1616159.671230\t1805557.477810 serialize\t1000\tarray\tPRIMITIVE_ARRAY\t8772856.921028\t31395.721514\t67209.107012 serialize\t1000\tdirectBuffer\tBUFFER\t5376191.775007\t1377272.568510\t1644789.427010 serialize\t1000\tdirectBuffer\tPRIMITIVE_ARRAY\t8207563.785251\t209183.090868\t66108.014322 serialize\t5000\tarray\tBUFFER\t5018916.322770\t711287.533377\t811029.402136 serialize\t5000\tarray\tPRIMITIVE_ARRAY\t8027439.580226\t6248.006967\t14997.400124 serialize\t5000\tdirectBuffer\tBUFFER\t5330897.682960\t707092.956534\t477148.540850 serialize\t5000\tdirectBuffer\tPRIMITIVE_ARRAY\t7695981.988316\t43565.678616\t15000.378818 deserialize\t200\tarray\tBUFFER\t3302149.383135\t1296284.787720\t657754.887247 deserialize\t200\tarray\tPRIMITIVE_ARRAY\t986136.067809\t146675.360652\t219333.990504 deserialize\t200\tdirectBuffer\tBUFFER\t3113115.471758\t1004844.498712\t598421.278941 deserialize\t200\tdirectBuffer\tPRIMITIVE_ARRAY\t991807.969328\t518713.299422\t179604.045774 deserialize\t1000\tarray\tBUFFER\t2831942.848999\t721266.541130\t422147.154601 deserialize\t1000\tarray\tPRIMITIVE_ARRAY\t205671.992736\t30409.835023\t53100.903684 deserialize\t1000\tdirectBuffer\tBUFFER\t3397690.327371\t592972.713203\t298929.116572 deserialize\t1000\tdirectBuffer\tPRIMITIVE_ARRAY\t202275.242341\t112132.004609\t38572.001768 deserialize\t5000\tarray\tBUFFER\t3296658.120035\t147251.846111\t136934.604328 deserialize\t5000\tarray\tPRIMITIVE_ARRAY\t40312.590172\t6122.351228\t10672.872798 deserialize\t5000\tdirectBuffer\tBUFFER\t3284441.570594\t148614.476829\t77950.612503 deserialize\t5000\tdirectBuffer\tPRIMITIVE_ARRAY\t40413.743717\t21826.040410\t8561.694533 ","version":"0.15","tagName":"h3"},{"title":"Usage","type":0,"sectionRef":"#","url":"/docs/next/start/usage","content":"","keywords":"","version":"dev"},{"title":"Native Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/next/start/usage#native-serialization","content":" Always use native mode when working with a single language. Native mode delivers optimal performance by avoiding the type metadata overhead required for cross-language compatibility.  Xlang mode introduces additional metadata encoding costs and restricts serialization to types that are common across all supported languages. Language-specific types will be rejected during serialization in xlang-mode.  ","version":"dev","tagName":"h2"},{"title":"Java Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/next/start/usage#java-serialization","content":" When you don't need cross-language support, use Java mode for optimal performance.  import org.apache.fory.*; import org.apache.fory.config.*; public class Example { public static class Person { String name; int age; } public static void main(String[] args) { // Create Fory instance - should be reused across serializations BaseFory fory = Fory.builder() .withLanguage(Language.JAVA) .requireClassRegistration(true) // replace `build` with `buildThreadSafeFory` for Thread-Safe Usage .build(); // Register your classes (required when class registration is enabled) fory.register(Person.class); // Serialize Person person = new Person(); person.name = &quot;chaokunyang&quot;; person.age = 28; byte[] bytes = fory.serialize(person); Person result = (Person) fory.deserialize(bytes); System.out.println(result.name + &quot; &quot; + result.age); // Output: chaokunyang 28 } }   For detailed Java usage including compatibility modes, compression, and advanced features, see Java Serialization Guide.  ","version":"dev","tagName":"h3"},{"title":"Python Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/next/start/usage#python-serialization","content":" Python native mode provides a high-performance drop-in replacement for pickle/cloudpickle with better speed and compatibility.  from dataclasses import dataclass import pyfory @dataclass class Person: name: str age: pyfory.int32 # Create Fory instance - should be reused across serializations fory = pyfory.Fory() # Register your classes (required when class registration is enabled) fory.register_type(Person) person = Person(name=&quot;chaokunyang&quot;, age=28) data = fory.serialize(person) result = fory.deserialize(data) print(result.name, result.age) # Output: chaokunyang 28   For detailed Python usage including type hints, compatibility modes, and advanced features, see Python Guide.  ","version":"dev","tagName":"h3"},{"title":"Scala Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/next/start/usage#scala-serialization","content":" Scala native mode provides optimized serialization for Scala-specific types including case classes, collections, and Option types.  import org.apache.fory.Fory import org.apache.fory.config.Language import org.apache.fory.serializer.scala.ScalaSerializers case class Person(name: String, age: Int) object Example { def main(args: Array[String]): Unit = { // Create Fory instance - should be reused across serializations val fory = Fory.builder() .withLanguage(Language.JAVA) .requireClassRegistration(true) .build() // Register Scala serializers for Scala-specific types ScalaSerializers.registerSerializers(fory) // Register your case classes fory.register(classOf[Person]) val bytes = fory.serialize(Person(&quot;chaokunyang&quot;, 28)) val result = fory.deserialize(bytes).asInstanceOf[Person] println(s&quot;${result.name} ${result.age}&quot;) // Output: chaokunyang 28 } }   For detailed Scala usage including collection serialization and integration patterns, see Scala Guide.  ","version":"dev","tagName":"h3"},{"title":"Kotlin Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/next/start/usage#kotlin-serialization","content":" Kotlin native mode provides optimized serialization for Kotlin-specific types including data classes, nullable types, and Kotlin collections.  import org.apache.fory.Fory import org.apache.fory.config.Language import org.apache.fory.serializer.kotlin.KotlinSerializers data class Person(val name: String, val age: Int) fun main() { // Create Fory instance - should be reused across serializations val fory = Fory.builder() .withLanguage(Language.JAVA) .requireClassRegistration(true) .build() // Register Kotlin serializers for Kotlin-specific types KotlinSerializers.registerSerializers(fory) // Register your data classes fory.register(Person::class.java) val bytes = fory.serialize(Person(&quot;chaokunyang&quot;, 28)) val result = fory.deserialize(bytes) as Person println(&quot;${result.name} ${result.age}&quot;) // Output: chaokunyang 28 }   For detailed Kotlin usage including null safety and default value support, see kotlin/README.md.  ","version":"dev","tagName":"h3"},{"title":"Cross-Language Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/next/start/usage#cross-language-serialization","content":" Only use xlang mode when you need cross-language data exchange. Xlang mode adds type metadata overhead for cross-language compatibility and only supports types that can be mapped across all languages. For single-language use cases, always prefer native mode for better performance.  The following examples demonstrate serializing a Person object across Java and Rust. For other languages (Python, Go, JavaScript, etc.), simply set the language mode to XLANG and follow the same pattern.  ","version":"dev","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Usage","url":"/docs/next/start/usage#java","content":" import org.apache.fory.*; import org.apache.fory.config.*; public class XlangExample { public record Person(String name, int age) {} public static void main(String[] args) { // Create Fory instance with XLANG mode Fory fory = Fory.builder() .withLanguage(Language.XLANG) .build(); // Register with cross-language type id/name fory.register(Person.class, 1); // fory.register(Person.class, &quot;example.Person&quot;); Person person = new Person(&quot;chaokunyang&quot;, 28); byte[] bytes = fory.serialize(person); // bytes can be deserialized by Rust, Python, Go, or other languages Person result = (Person) fory.deserialize(bytes); System.out.println(result.name + &quot; &quot; + result.age); // Output: chaokunyang 28 } }   ","version":"dev","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Usage","url":"/docs/next/start/usage#rust","content":" use fory::{Fory, ForyObject}; #[derive(ForyObject, Debug)] struct Person { name: String, age: i32, } fn main() -&gt; Result&lt;(), Error&gt; { let mut fory = Fory::default(); fory.register::&lt;Person&gt;(1)?; // fory.register_by_name::&lt;Person&gt;(&quot;example.Person&quot;)?; let person = Person { name: &quot;chaokunyang&quot;.to_string(), age: 28, }; let bytes = fory.serialize(&amp;person); // bytes can be deserialized by Java, Python, Go, or other languages let result: Person = fory.deserialize(&amp;bytes)?; println!(&quot;{} {}&quot;, result.name, result.age); // Output: chaokunyang 28 }   ","version":"dev","tagName":"h3"},{"title":"Golang‚Äã","type":1,"pageTitle":"Usage","url":"/docs/next/start/usage#golang","content":" type Person struct { name: string age: i32 } fory := fory.NewFory(true) fory.Register(Person{}, 1) person := Person{&quot;chaokunyang&quot;, 28} bytes, err := fory.Marshal(person) var p Person err = fory.Unmarshal(bytes, &amp;p)   ","version":"dev","tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Usage","url":"/docs/next/start/usage#javascript","content":" import Fory, { Type } from &quot;@apache-fory/fory&quot;; /** * @apache-fory/hps use v8's fast-calls-api that can be called directly by jit, ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from &quot;@apache-fory/hps&quot;; // Now we describe data structures using JSON, but in the future, we will use more ways. const description = Type.object(&quot;example.Person&quot;, { name: Type.string(), age: Type.int32(), }); const fory = new Fory({ hps }); const { serialize, deserialize } = fory.registerSerializer(description); const input = serialize({ name: &quot;chaokunyang&quot;, age: 28 }); const result = deserialize(input); console.log(result);   ","version":"dev","tagName":"h3"},{"title":"Key Points‚Äã","type":1,"pageTitle":"Usage","url":"/docs/next/start/usage#key-points","content":" Use Language.XLANG mode in all languagesRegister types with consistent IDs or names across all languages: By ID (fory.register(Person.class, 1)): Faster serialization, more compact encoding, but requires coordination to avoid ID conflictsBy name (fory.register(Person.class, &quot;example.Person&quot;)): More flexible, less prone to conflicts, easier to manage across teams, but slightly larger encoding Type IDs/names must match across all languages for successful deserializationOnly use types that have cross-language mappings (see Type Mapping)  For examples with circular references, shared references, and polymorphism across languages, see:  Cross-Language Serialization GuideJava Serialization Guide - Cross LanguagePython Guide - Cross Language  ","version":"dev","tagName":"h3"},{"title":"Row Format Encoding‚Äã","type":1,"pageTitle":"Usage","url":"/docs/next/start/usage#row-format-encoding","content":" Row format provides zero-copy random access to serialized data, making it ideal for analytics workloads and data processing pipelines.  ","version":"dev","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Usage","url":"/docs/next/start/usage#java-1","content":" import org.apache.fory.format.*; import java.util.*; import java.util.stream.*; public class Bar { String f1; List&lt;Long&gt; f2; } public class Foo { int f1; List&lt;Integer&gt; f2; Map&lt;String, Integer&gt; f3; List&lt;Bar&gt; f4; } RowEncoder&lt;Foo&gt; encoder = Encoders.bean(Foo.class); Foo foo = new Foo(); foo.f1 = 10; foo.f2 = IntStream.range(0, 1000000).boxed().collect(Collectors.toList()); foo.f3 = IntStream.range(0, 1000000).boxed().collect(Collectors.toMap(i -&gt; &quot;k&quot;+i, i -&gt; i)); List&lt;Bar&gt; bars = new ArrayList&lt;&gt;(1000000); for (int i = 0; i &lt; 1000000; i++) { Bar bar = new Bar(); bar.f1 = &quot;s&quot; + i; bar.f2 = LongStream.range(0, 10).boxed().collect(Collectors.toList()); bars.add(bar); } foo.f4 = bars; // Serialize to row format (can be zero-copy read by Python) BinaryRow binaryRow = encoder.toRow(foo); // Deserialize entire object Foo newFoo = encoder.fromRow(binaryRow); // Zero-copy access to nested fields without full deserialization BinaryArray binaryArray2 = binaryRow.getArray(1); // Access f2 field BinaryArray binaryArray4 = binaryRow.getArray(3); // Access f4 field BinaryRow barStruct = binaryArray4.getStruct(10); // Access 11th Bar element long value = barStruct.getArray(1).getInt64(5); // Access nested value // Partial deserialization RowEncoder&lt;Bar&gt; barEncoder = Encoders.bean(Bar.class); Bar newBar = barEncoder.fromRow(barStruct); Bar newBar2 = barEncoder.fromRow(binaryArray4.getStruct(20));   ","version":"dev","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Usage","url":"/docs/next/start/usage#python","content":" from dataclasses import dataclass from typing import List, Dict import pyarrow as pa import pyfory @dataclass class Bar: f1: str f2: List[pa.int64] @dataclass class Foo: f1: pa.int32 f2: List[pa.int32] f3: Dict[str, pa.int32] f4: List[Bar] encoder = pyfory.encoder(Foo) foo = Foo( f1=10, f2=list(range(1000_000)), f3={f&quot;k{i}&quot;: i for i in range(1000_000)}, f4=[Bar(f1=f&quot;s{i}&quot;, f2=list(range(10))) for i in range(1000_000)] ) # Serialize to row format binary: bytes = encoder.to_row(foo).to_bytes() # Zero-copy random access without full deserialization foo_row = pyfory.RowData(encoder.schema, binary) print(foo_row.f2[100000]) # Access element directly print(foo_row.f4[100000].f1) # Access nested field print(foo_row.f4[200000].f2[5]) # Access deeply nested field   For more details on row format, see Java Row Format Guide or Python Row Format Guide. ","version":"dev","tagName":"h3"},{"title":"How to verify","type":0,"sectionRef":"#","url":"/docs/community/how_to_verify","content":"","keywords":"","version":"0.15"},{"title":"Download the candidate version‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/community/how_to_verify#download-the-candidate-version","content":" #If there is svn locally, you can clone to the local svn co https://dist.apache.org/repos/dist/dev/fory/${release_version}-${rc_version}/ # You can download the material file directly wget https://dist.apache.org/repos/dist/dev/fory/${release_version}-${rc_version}/xxx.xxx   ","version":"0.15","tagName":"h2"},{"title":"Verify checksums and signatures‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/community/how_to_verify#verify-checksums-and-signatures","content":" First you need to install gpg:  apt-get install gnupg # or yum install gnupg # or brew install gnupg   Then import the Fory release manager's public key:  curl https://downloads.apache.org/fory/KEYS &gt; KEYS # Download KEYS gpg --import KEYS # Import KEYS to local # Then, trust the public key: gpg --edit-key &lt;KEY-used-in-this-version&gt; # Edit the key(mentioned in vote email) # It will enter the interactive mode, use the following command to trust the key: gpg (GnuPG) 2.0.22; Copyright (C) 2013 Free Software Foundation, Inc. This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. pub 4096R/5E580BA4 created: 2024-03-27 expires: never usage: SC trust: unknown validity: unknown sub 4096R/A31EF728 created: 2024-03-27 expires: never usage: E [ unknown] (1). chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; gpg&gt; trust pub 4096R/5E580BA4 created: 2024-03-27 expires: never usage: SC trust: unknown validity: unknown sub 4096R/A31EF728 created: 2024-03-27 expires: never usage: E [ unknown] (1). chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; Please decide how far you trust this user to correctly verify other users' keys (by looking at passports, checking fingerprints from different sources, etc.) 1 = I don't know or won't say 2 = I do NOT trust 3 = I trust marginally 4 = I trust fully 5 = I trust ultimately m = back to the main menu Your decision? 5 Do you really want to set this key to ultimate trust? (y/N) y pub 4096R/5E580BA4 created: 2024-03-27 expires: never usage: SC trust: ultimate validity: unknown sub 4096R/A31EF728 created: 2024-03-27 expires: never usage: E [ unknown] (1). chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; Please note that the shown key validity is not necessarily correct unless you restart the program.   Next verify signature:  for i in *.tar.gz; do echo $i; gpg --verify $i.asc $i; done   If something like the following appears, it means the signature is correct:  apache-fory-0.12.0-src.tar.gz gpg: Signature made Wed 17 Apr 2024 11:49:45 PM CST using RSA key ID 5E580BA4 gpg: checking the trustdb gpg: 3 marginal(s) needed, 1 complete(s) needed, PGP trust model gpg: depth: 0 valid: 1 signed: 0 trust: 0-, 0q, 0n, 0m, 0f, 1u gpg: Good signature from &quot;chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt;&quot;   Then verify checksum:  for i in *.tar.gz; do echo $i; sha512sum --check $i.sha512*; done   It should output something like:  apache-fory-0.12.0-src.tar.gz apache-fory-0.12.0-src.tar.gz: OK   A quick way to verify above is:  curl -s https://raw.githubusercontent.com/apache/fory/main/ci/release.py | python3 - verify -v 0.5.0   ","version":"0.15","tagName":"h2"},{"title":"Check the file content of the source package‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/community/how_to_verify#check-the-file-content-of-the-source-package","content":" Unzip apache-fory-${release_version}-${rc_version}-src.tar.gz and check the follows:  LICENSE and NOTICE files are correct for the repository.All files have ASF license headers if necessary.Building is OK.  ","version":"0.15","tagName":"h2"},{"title":"Check the Maven artifacts of fory-java‚Äã","type":1,"pageTitle":"How to verify","url":"/docs/community/how_to_verify#check-the-maven-artifacts-of-fory-java","content":" Download the artifacts from https://repository.apache.org/content/repositories/orgapachefory-${maven_artifact_number}/.  You can check the follows:  Checksum of JARs match the bundled checksum file.Signature of JARs match the bundled signature file.JARs is reproducible locally. This means you can build the JARs on your machine and verify the checksum is the same with the bundled one. ","version":"0.15","tagName":"h2"},{"title":"FlatBuffers IDL Support","type":0,"sectionRef":"#","url":"/docs/compiler/flatbuffers_idl","content":"","keywords":"","version":"0.15"},{"title":"What This Page Covers‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/compiler/flatbuffers_idl#what-this-page-covers","content":" When to use FlatBuffers input with ForyExact FlatBuffers to Fory mapping behaviorSupported Fory-specific attributes in .fbsMigration notes and generated-code differences  ","version":"0.15","tagName":"h2"},{"title":"Why Use Apache Fory‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/compiler/flatbuffers_idl#why-use-apache-fory","content":" Idiomatic generated code: Fory generates language-idiomatic classes/structs that can be used directly as domain objects.Java performance: In Java object-serialization workloads, Fory is faster than FlatBuffers in Fory benchmarks.Other languages: serialization performance is generally in a similar range.Deserialization in practice: FlatBuffers does not perform native-object deserialization and is faster by default, but if your application needs native objects, it requires conversion and that conversion step can dominate read cost. In those cases, Fory deserialization is often faster end-to-end.Easier APIs: Fory uses direct native objects, so you do not need to reverse-build tables or manually manage offsets.Better graph modeling: Shared and circular references are first-class features in Fory.  ","version":"0.15","tagName":"h2"},{"title":"Quick Decision Guide‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/compiler/flatbuffers_idl#quick-decision-guide","content":" Situation\tRecommended PathYou already have .fbs schemas and want Fory runtime/codegen\tUse FlatBuffers input You are starting new schema work and want full Fory syntax control\tUse native Fory IDL You need FlatBuffers wire compatibility at runtime\tKeep FlatBuffers stack You need Fory object-graph semantics (ref, weak refs, etc.)\tUse Fory  ","version":"0.15","tagName":"h2"},{"title":"FlatBuffers to Fory Mapping‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/compiler/flatbuffers_idl#flatbuffers-to-fory-mapping","content":" ","version":"0.15","tagName":"h2"},{"title":"Schema-Level Rules‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/compiler/flatbuffers_idl#schema-level-rules","content":" namespace maps to Fory package namespace.include entries map to Fory imports.table is translated as evolving=true.struct is translated as evolving=false.root_type is parsed but ignored by Fory runtime/codegen.file_identifier and file_extension are parsed but not used by Fory codegen.  ","version":"0.15","tagName":"h3"},{"title":"Field Numbering‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/compiler/flatbuffers_idl#field-numbering","content":" FlatBuffers fields do not have explicit field IDs. Fory assigns field numbers by source declaration order, starting at 1.  ","version":"0.15","tagName":"h3"},{"title":"Scalar Type Mapping‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/compiler/flatbuffers_idl#scalar-type-mapping","content":" FlatBuffers\tFory Typebyte\tint8 ubyte\tuint8 short\tint16 ushort\tuint16 int\tint32 uint\tuint32 long\tint64 ulong\tuint64 float\tfloat32 double\tfloat64 bool\tbool string\tstring  Vectors ([T]) map to Fory lists.  ","version":"0.15","tagName":"h3"},{"title":"Unions‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/compiler/flatbuffers_idl#unions","content":" FlatBuffers unions map to Fory unions.  Case IDs are assigned by declaration order, starting at 1.Case names are derived from type names using snake_case field naming.  FlatBuffers  union Payload { Note, Metric } table Container { payload: Payload; }   Fory shape after translation  union Payload { Note note = 1; Metric metric = 2; } message Container { Payload payload = 1; }   ","version":"0.15","tagName":"h3"},{"title":"Defaults and Metadata‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/compiler/flatbuffers_idl#defaults-and-metadata","content":" FlatBuffers default values are parsed but not applied as Fory runtime defaults.Non-Fory metadata attributes are preserved as generic options in IR and may be consumed by downstream tooling.  ","version":"0.15","tagName":"h3"},{"title":"Fory-Specific Attributes in FlatBuffers‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/compiler/flatbuffers_idl#fory-specific-attributes-in-flatbuffers","content":" FlatBuffers metadata attributes use key:value. For Fory-specific options, usefory_ (or fory.) prefix in .fbs; the prefix is removed during parsing.  ","version":"0.15","tagName":"h2"},{"title":"Supported Field Attributes‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/compiler/flatbuffers_idl#supported-field-attributes","content":" FlatBuffers Attribute\tEffect in Foryfory_ref:true\tEnable reference tracking for the field fory_nullable:true\tMark field optional/nullable fory_weak_ref:true\tEnable weak reference semantics and implies ref fory_thread_safe_pointer:false\tFor ref fields, select non-thread-safe pointer flavor  Semantics:  fory_weak_ref:true implies ref.fory_thread_safe_pointer only takes effect when the field is ref-tracked.For list fields, fory_ref:true applies to list elements.  Example:  table Node { parent: Node (fory_weak_ref: true); children: [Node] (fory_ref: true); cached: Node (fory_ref: true, fory_thread_safe_pointer: false); }   ","version":"0.15","tagName":"h3"},{"title":"Generated Code Differences‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/compiler/flatbuffers_idl#generated-code-differences","content":" Using .fbs as input to Fory still produces normal Fory-generated code, not FlatBuffers ByteBuffer-style APIs.  Java: POJOs/records with Fory metadataPython: dataclasses plus registration helpersGo/Rust/C++: native structs and Fory metadata  The serialization format is Fory binary protocol, not FlatBuffers wire format.  ","version":"0.15","tagName":"h2"},{"title":"Usage‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/compiler/flatbuffers_idl#usage","content":" Compile a FlatBuffers schema directly:  foryc schema.fbs --lang java,python --output ./generated   Inspect translated schema syntax for debugging:  foryc schema.fbs --emit-fdl --emit-fdl-path ./translated   ","version":"0.15","tagName":"h2"},{"title":"Migration Notes‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/compiler/flatbuffers_idl#migration-notes","content":" Keep existing namespace values stable to keep type registration stable.Review fields that relied on FlatBuffers default literals and set explicit defaults in application code if needed.Add fory_ref/fory_weak_ref where object-graph semantics are required.Validate generated model behavior with roundtrip tests before replacing existing serialization paths.  ","version":"0.15","tagName":"h2"},{"title":"Summary‚Äã","type":1,"pageTitle":"FlatBuffers IDL Support","url":"/docs/compiler/flatbuffers_idl#summary","content":" FlatBuffers input lets you reuse existing .fbs schemas while moving to Fory's runtime and code generation model. This is useful for incremental migration, while preserving schema investment and adopting Fory-native object APIs. ","version":"0.15","tagName":"h2"},{"title":"Overview","type":0,"sectionRef":"#","url":"/docs/compiler/","content":"","keywords":"","version":"0.15"},{"title":"Example Schema‚Äã","type":1,"pageTitle":"Overview","url":"/docs/compiler/#example-schema","content":" Fory IDL provides a simple, intuitive syntax for defining cross-language data structures:  package example; enum Status { PENDING = 0; ACTIVE = 1; COMPLETED = 2; } message User { string name = 1; int32 age = 2; optional string email = 3; list&lt;string&gt; tags = 4; } message Item { string sku = 1; int32 quantity = 2; } message Order { ref User customer = 1; list&lt;Item&gt; items = 2; Status status = 3; map&lt;string, int32&gt; metadata = 4; } message Dog [id=104] { string name = 1; int32 bark_volume = 2; } message Cat [id=105] { string name = 1; int32 lives = 2; } union Animal [id=106] { Dog dog = 1; Cat cat = 2; }   ","version":"0.15","tagName":"h2"},{"title":"Why Fory IDL?‚Äã","type":1,"pageTitle":"Overview","url":"/docs/compiler/#why-fory-idl","content":" ","version":"0.15","tagName":"h2"},{"title":"Schema-First Development‚Äã","type":1,"pageTitle":"Overview","url":"/docs/compiler/#schema-first-development","content":" Define your data model once in Fory IDL and generate consistent, type-safe code across all languages. This ensures:  Type Safety: Catch type errors at compile time, not runtimeConsistency: All languages use the same field names, types, and structuresDocumentation: Schema serves as living documentationEvolution: Managed schema changes across all implementations  ","version":"0.15","tagName":"h3"},{"title":"Fory-Native Features‚Äã","type":1,"pageTitle":"Overview","url":"/docs/compiler/#fory-native-features","content":" Unlike generic IDLs, Fory IDL is designed specifically for Fory serialization:  Reference Tracking: First-class support for shared and circular references via refNullable Fields: Explicit optional modifier for nullable typesType Registration: Built-in support for both numeric IDs and namespace-based registrationNative Code Generation: Generates idiomatic code with Fory annotations/macros  ","version":"0.15","tagName":"h3"},{"title":"Low Integration Overhead‚Äã","type":1,"pageTitle":"Overview","url":"/docs/compiler/#low-integration-overhead","content":" Generated code uses native language constructs:  Java: Plain POJOs with @ForyField annotationsPython: Dataclasses with type hintsGo: Structs with struct tagsRust: Structs with #[derive(ForyObject)]C++: Structs with FORY_STRUCT macros  ","version":"0.15","tagName":"h3"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Overview","url":"/docs/compiler/#quick-start","content":" ","version":"0.15","tagName":"h2"},{"title":"1. Install the Compiler‚Äã","type":1,"pageTitle":"Overview","url":"/docs/compiler/#1-install-the-compiler","content":" pip install fory-compiler   Or install from source:  cd compiler pip install -e .   ","version":"0.15","tagName":"h3"},{"title":"2. Write Your Schema‚Äã","type":1,"pageTitle":"Overview","url":"/docs/compiler/#2-write-your-schema","content":" Create example.fdl:  package example; message Person { string name = 1; int32 age = 2; optional string email = 3; }   ","version":"0.15","tagName":"h3"},{"title":"3. Generate Code‚Äã","type":1,"pageTitle":"Overview","url":"/docs/compiler/#3-generate-code","content":" # Generate for all languages foryc example.fdl --output ./generated # Generate for specific languages foryc example.fdl --lang java,python --output ./generated   ","version":"0.15","tagName":"h3"},{"title":"4. Use Generated Code‚Äã","type":1,"pageTitle":"Overview","url":"/docs/compiler/#4-use-generated-code","content":" Java:  Person person = new Person(); person.setName(&quot;Alice&quot;); person.setAge(30); byte[] data = person.toBytes();   Python:  import pyfory from example import Person person = Person(name=&quot;Alice&quot;, age=30) data = bytes(person) # or `person.to_bytes()`   ","version":"0.15","tagName":"h3"},{"title":"Documentation‚Äã","type":1,"pageTitle":"Overview","url":"/docs/compiler/#documentation","content":" Document\tDescriptionFory IDL Syntax\tComplete language syntax and grammar Type System\tPrimitive types, collections, and type rules Compiler Guide\tCLI options and build integration Generated Code\tOutput format for each target language Protocol Buffers IDL Support\tComparison with protobuf and migration guide FlatBuffers IDL Support\tFlatBuffers mapping rules and codegen differences  ","version":"0.15","tagName":"h2"},{"title":"Key Concepts‚Äã","type":1,"pageTitle":"Overview","url":"/docs/compiler/#key-concepts","content":" ","version":"0.15","tagName":"h2"},{"title":"Field Modifiers‚Äã","type":1,"pageTitle":"Overview","url":"/docs/compiler/#field-modifiers","content":" optional: Field can be null/Noneref: Enable reference tracking for shared/circular referenceslist: Field is a list/array (alias: repeated)  message Example { optional string nullable = 1; ref Node parent = 2; list&lt;int32&gt; numbers = 3; }   ","version":"0.15","tagName":"h3"},{"title":"Cross-Language Compatibility‚Äã","type":1,"pageTitle":"Overview","url":"/docs/compiler/#cross-language-compatibility","content":" Fory IDL types map to native types in each language:  Fory IDL Type\tJava\tPython\tGo\tRust\tC++int32\tint\tpyfory.int32\tint32\ti32\tint32_t string\tString\tstr\tstring\tString\tstd::string bool\tboolean\tbool\tbool\tbool\tbool  See Type System for complete mappings.  ","version":"0.15","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Overview","url":"/docs/compiler/#best-practices","content":" Use meaningful package names: Group related types togetherAssign type IDs for performance: Numeric IDs are faster than name-based registrationReserve ID ranges: Leave gaps for future additions (e.g., 100-199 for users, 200-299 for orders)Use optional explicitly: Make nullability clear in the schemaUse ref for shared objects: Enable reference tracking when objects are shared  ","version":"0.15","tagName":"h2"},{"title":"Examples‚Äã","type":1,"pageTitle":"Overview","url":"/docs/compiler/#examples","content":" See the examples directory for complete working examples. ","version":"0.15","tagName":"h2"},{"title":"How to release","type":0,"sectionRef":"#","url":"/docs/community/how_to_release","content":"","keywords":"","version":"0.15"},{"title":"Introduction‚Äã","type":1,"pageTitle":"How to release","url":"/docs/community/how_to_release#introduction","content":" Source Release is the most important part which Apache values.  Please pay more attention to license and signing issues. Publishing software is a serious thing and has legal consequences.  ","version":"0.15","tagName":"h2"},{"title":"First-time as a release manager‚Äã","type":1,"pageTitle":"How to release","url":"/docs/community/how_to_release#first-time-as-a-release-manager","content":" ","version":"0.15","tagName":"h2"},{"title":"Environmental requirements‚Äã","type":1,"pageTitle":"How to release","url":"/docs/community/how_to_release#environmental-requirements","content":" This release process is operated in the Ubuntu OS, and the following tools are required:  JDK 1.8Apache Maven 3.xPython 3.8GnuPG 2.xGitSVN (apache uses svn to host project releases)Pay attention to setting environment variables: if you configure gpg keys under a different directory, please export GNUPGHOME=$(xxx)  ","version":"0.15","tagName":"h3"},{"title":"Prepare GPG Key‚Äã","type":1,"pageTitle":"How to release","url":"/docs/community/how_to_release#prepare-gpg-key","content":" If you are the first to become a release manager, you need to prepare a gpg key.  Following is a quick setup, you can refer to Apache openpgp doc for further details.  Install GPG‚Äã  sudo apt install gnupg2   Generate GPG Key‚Äã  Please use your apache name and email for generate key  $ gpg --full-gen-key gpg (GnuPG) 2.2.20; Copyright (C) 2020 Free Software Foundation, Inc. This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. Please select what kind of key you want: (1) RSA and RSA (default) (2) DSA and Elgamal (3) DSA (sign only) (4) RSA (sign only) (14) Existing key from card Your selection? 1 # input 1 RSA keys may be between 1024 and 4096 bits long. What keysize do you want? (2048) 4096 # input 4096 Requested keysize is 4096 bits Please specify how long the key should be valid. 0 = key does not expire &lt;n&gt; = key expires in n days &lt;n&gt;w = key expires in n weeks &lt;n&gt;m = key expires in n months &lt;n&gt;y = key expires in n years Key is valid for? (0) 0 # input 0 Key does not expire at all Is this correct? (y/N) y # input y GnuPG needs to construct a user ID to identify your key. Real name: Chaokun Yang # input your name Email address: chaokunyang@apache.org # input your email Comment: CODE SIGNING KEY # input some annotations, optional You selected this USER-ID: &quot;Chaokun &lt;chaokunyang@apache.org&gt;&quot; Change (N)ame, (C)omment, (E)mail or (O)kay/(Q)uit? O # input O We need to generate a lot of random bytes. It is a good idea to perform some other action (type on the keyboard, move the mouse, utilize the disks) during the prime generation; this gives the random number generator a better chance to gain enough entropy. We need to generate a lot of random bytes. It is a good idea to perform some other action (type on the keyboard, move the mouse, utilize the disks) during the prime generation; this gives the random number generator a better chance to gain enough entropy. # Input the security key ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ Please enter this passphrase ‚îÇ ‚îÇ ‚îÇ ‚îÇ Passphrase: _______________________________ ‚îÇ ‚îÇ ‚îÇ ‚îÇ &lt;OK&gt; &lt;Cancel&gt; ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò # key generation will be done after your inputting the key with the following output gpg: key E49B00F626B marked as ultimately trusted gpg: revocation certificate stored as '/Users/chaokunyang/.gnupg/openpgp-revocs.d/1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4.rev' public and secret key created and signed. pub rsa4096 2022-07-12 [SC] 1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4 uid [ultimate] Chaokun &lt;chaokunyang@apache.org&gt; sub rsa4096 2022-07-12 [E]   Upload your public key to public GPG keyserver‚Äã  Firstly, list your key:  gpg --list-keys   The output is like:  -------------------------------------------------- pub rsa4096 2024-03-27 [SC] 1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4 uid [ultimate] chaokunyang (CODE SIGNING KEY) &lt;chaokunyang@apache.org&gt; sub rsa4096 2024-03-27 [E]   Then, send your key id to key server:  gpg --keyserver keys.openpgp.org --send-key &lt;key-id&gt; # e.g., 1E2CDAE4C08AD7D694D1CB139D7BE8E45E580BA4   Among them, keys.openpgp.org is a randomly selected keyserver, you can use keyserver.ubuntu.com or any other full-featured keyserver.  Check whether the key is created successfully‚Äã  Uploading takes about one minute; after that, you can check by email at the corresponding keyserver.  Uploading keys to the keyserver is mainly for joining a Web of Trust.  Add your GPG public key to the project KEYS file‚Äã  The svn repository of the release branch is: https://dist.apache.org/repos/dist/release/fory  Please add the public key to KEYS in the release branch:  svn co --depth=files https://dist.apache.org/repos/dist/release/fory fory-dist cd fory-dist (gpg --list-sigs YOUR_NAME@apache.org &amp;&amp; gpg --export --armor YOUR_NAME@apache.org) &gt;&gt; KEYS # Append your key to the KEYS file svn add . # It is not needed if the KEYS document exists before. svn ci -m &quot;add gpg key for YOUR_NAME&quot; # Later on, if you are asked to enter a username and password, just use your apache username and password.   Upload the GPG public key to your GitHub account‚Äã  Enter https://github.com/settings/keys to add your GPG key.Please remember to bind the email address used in the GPG key to your GitHub account (https://github.com/settings/emails) if you find &quot;unverified&quot; after adding it.  ","version":"0.15","tagName":"h3"},{"title":"Further reading‚Äã","type":1,"pageTitle":"How to release","url":"/docs/community/how_to_release#further-reading","content":" It's recommended but not mandatory to read following documents before making a release to know more details about apache release:  Release policy: https://www.apache.org/legal/release-policy.htmlTLP release: https://infra.apache.org/release-distributionRelease sign: https://infra.apache.org/release-signing.htmlRelease publish: https://infra.apache.org/release-publishing.htmlRelease download pages: https://infra.apache.org/release-download-pages.htmlPublishing maven artifacts: https://infra.apache.org/publishing-maven-artifacts.html  ","version":"0.15","tagName":"h3"},{"title":"Start discussion about the release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/community/how_to_release#start-discussion-about-the-release","content":" Start a discussion about the next release via sending email to: dev@fory.apache.org:  Title:  [DISCUSS] Release Apache Fory ${release_version}   Content:  Hello, Apache Fory Community, This is a call for a discussion to release Apache Fory version ${release_version}. The change lists about this release: https://github.com/apache/fory/compare/v0.12.0...v0.12.1-rc1 Please leave your comments here about this release plan. We will bump the version in repo and start the release process after the discussion. Thanks, ${name}   ","version":"0.15","tagName":"h2"},{"title":"Preparing for release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/community/how_to_release#preparing-for-release","content":" If the discussion goes positive, you will need to prepare the release artifiacts.  ","version":"0.15","tagName":"h2"},{"title":"Github branch and tag‚Äã","type":1,"pageTitle":"How to release","url":"/docs/community/how_to_release#github-branch-and-tag","content":" Create a new branch named releases-0.12.0Bump version to $version by executing command python ci/release.py bump_version -l all -version $versionMake a git commit and push the branch to git@github.com:apache/fory.gitCreate a new tag by git tag v0.12.0-rc1, then push it to git@github.com:apache/fory.git  ","version":"0.15","tagName":"h3"},{"title":"Build and upload artifacts to SVN dist/dev repo‚Äã","type":1,"pageTitle":"How to release","url":"/docs/community/how_to_release#build-and-upload-artifacts-to-svn-distdev-repo","content":" First you need to build source release artifacts by python ci/release.py build -v $version.  Then you need to upload it to svn dist repo. The dist repo of the dev branch is: https://dist.apache.org/repos/dist/dev/fory  # As this step will copy all the versions, it will take some time. If the network is broken, please use svn cleanup to delete the lock before re-execute it. svn co https://dist.apache.org/repos/dist/dev/fory fory-dist-dev   Then, upload the artifacts:  cd fory-dist-dev # create a directory named by version mkdir ${release_version}-${rc_version} # copy source code and signature package to the versioned directory cp ${repo_dir}/dist/* ${release_version}-${rc_version} # check svn status svn status # add to svn svn add ${release_version}-${rc_version} # check svn status svn status # commit to SVN remote server svn commit -m &quot;Prepare for fory ${release_version}-${rc_version}&quot;   Visit https://dist.apache.org/repos/dist/dev/fory/ to check the artifacts are uploaded correctly.  ","version":"0.15","tagName":"h3"},{"title":"What to do if something goes wrong‚Äã","type":1,"pageTitle":"How to release","url":"/docs/community/how_to_release#what-to-do-if-something-goes-wrong","content":" If some files are unexpected, you need to remove by svn delete and repeat the above upload process.  ","version":"0.15","tagName":"h3"},{"title":"Voting‚Äã","type":1,"pageTitle":"How to release","url":"/docs/community/how_to_release#voting","content":" ","version":"0.15","tagName":"h2"},{"title":"check version‚Äã","type":1,"pageTitle":"How to release","url":"/docs/community/how_to_release#check-version","content":" Fory requires votes from the Fory Community.  release_version: the version for fory, like 0.12.0.release_candidate_version: the version for voting, like 0.12.0-rc1.maven_artifact_number: the number for Maven staging artifacts, like 1001. Specifically, the maven_artifact_number can be found by searching &quot;fory&quot; on https://repository.apache.org/#stagingRepositories.  ","version":"0.15","tagName":"h3"},{"title":"Build the source code of fory and release it to nexus‚Äã","type":1,"pageTitle":"How to release","url":"/docs/community/how_to_release#build-the-source-code-of-fory-and-release-it-to-nexus","content":" Configure Apache Account Passwords‚Äã  Before publishing Fory to Nexus, you need to securely configure your Apache account credentials. This step is critical as passwords must be encrypted.  First, open your Maven global settings file settings.xml, typically located at ~/.m2/settings.xml. Add or modify the following section:   &lt;servers&gt; &lt;server&gt; &lt;id&gt;apache.snapshots.https&lt;/id&gt; &lt;username&gt;your-apache-username&lt;/username&gt; &lt;password&gt;{your-encrypted-password}&lt;/password&gt; &lt;/server&gt; &lt;server&gt; &lt;id&gt;apache.releases.https&lt;/id&gt; &lt;username&gt;your-apache-username&lt;/username&gt; &lt;password&gt;{your-encrypted-password}&lt;/password&gt; &lt;/server&gt; &lt;/servers&gt;   Important Notes:  Replace your-apache-username with your Apache LDAP usernamePasswords must be encrypted using Maven's password encryption toolEncrypted passwords should be enclosed in curly braces {}  Refer to the official documentation for detailed encryption instructions: Publishing Maven Artifacts  Steps to encrypt your password:  Generate a master password (if you haven't already): mvn --encrypt-master-password your-master-password Save the output to ~/.m2/settings-security.xml: &lt;settingsSecurity&gt; &lt;master&gt;{your-encrypted-master-password}&lt;/master&gt; &lt;/settingsSecurity&gt; Encrypt your Apache account password: mvn --encrypt-password your-apache-password Place the encrypted output into the password field in settings.xml  Build and Publish Java Module‚Äã   # Navigate to the Java module directory cd java # Execute Maven build and deploy to Nexus # -T10: Use 10 threads for parallel build, improving speed # clean: Clean the project # deploy: Deploy to remote repository # -Papache-release: Activate apache-release profile # -DskipTests: Skip tests # -Dgpg.skip=false: Enable GPG signing (required for release verification) mvn -T10 clean deploy -Papache-release -DskipTests -Dgpg.skip=false   Build and Publish Kotlin Module‚Äã   # Return to project root and navigate to Kotlin module cd ../kotlin # Execute the same Maven command as Java module # Configuration parameters are identical to Java module mvn -T10 clean deploy -Papache-release -DskipTests -Dgpg.skip=false   Build and Publish Scala Module‚Äã   # Return to project root and navigate to Scala module cd ../scala # Build and sign JARs for all Scala versions # +publishSigned: Execute publishSigned for all configured Scala versions echo &quot;Starting to build Scala JARs...&quot; sbt +publishSigned # Prepare for upload to Sonatype (Nexus) # sonatypePrepare: Prepare for Maven Central Repository release echo &quot;Starting upload preparation...&quot; sbt sonatypePrepare # Upload packaged JARs to Sonatype # sonatypeBundleUpload: Upload prepared bundles echo &quot;Starting JAR upload...&quot; sbt sonatypeBundleUpload echo &quot;Scala JAR deployment succeeded!&quot;   Lock the Release in Nexus‚Äã  After completing the publication of all modules, perform the following steps in Nexus:  Log in to the Apache Nexus repository management interfaceNavigate to the &quot;Snapshots&quot; or &quot;Releases&quot; repository (depending on your release type)Locate the latest Fory project versionExecute the &quot;Close&quot; operation to validate all uploaded artifactsAfter successful validation, execute the &quot;Release&quot; operation to finalize the deployment  These steps ensure all published artifacts are verified and correctly deployed to the public repository.  ","version":"0.15","tagName":"h3"},{"title":"build a Pre-release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/community/how_to_release#build-a-pre-release","content":" You need to build a Pre-release before voting, such as:https://github.com/apache/fory/releases/tag/v0.12.0-rc1  ","version":"0.15","tagName":"h3"},{"title":"Fory Community Vote‚Äã","type":1,"pageTitle":"How to release","url":"/docs/community/how_to_release#fory-community-vote","content":" you need send a email to Fory Community: dev@fory.apache.org:  Title:  [VOTE] Release Apache Fory v${release_version}-${rc_version}   Content:  Hello, Apache Fory Community: This is a call for vote to release Apache Fory version release-${release_version}-${rc_version}. Apache Fory - A blazingly fast multi-language serialization framework powered by JIT and zero-copy. The discussion thread: https://lists.apache.org/thread/xxr3od301g6v3ndj14zqc05byp9qvclh The change lists about this release: https://github.com/apache/fory/compare/v0.12.0...v0.12.1-rc1 The release candidates: https://dist.apache.org/repos/dist/dev/fory/0.5.0-rc3/ The maven staging for this release: https://repository.apache.org/content/repositories/orgapachefory-1003 Git tag for the release: https://github.com/apache/fory/releases/tag/v0.12.0-rc1 Git commit for the release: https://github.com/apache/fory/commit/fae06330edd049bb960536e978a45b97bca66faf The artifacts signed with PGP key [5E580BA4], corresponding to [chaokunyang@apache.org], that can be found in keys file: https://downloads.apache.org/fory/KEYS The vote will be open for at least 72 hours until the necessary number of votes are reached. Please vote accordingly: [ ] +1 approve [ ] +0 no opinion [ ] -1 disapprove with the reason To learn more about Fory, please see https://fory.apache.org/ *Valid check is a requirement for a vote. *Checklist for reference: [ ] Download Fory is valid. [ ] Checksums and PGP signatures are valid. [ ] Source code distributions have correct names matching the current release. [ ] LICENSE and NOTICE files are correct. [ ] All files have license headers if necessary. [ ] No compiled archives bundled in source archive. [ ] Can compile from source. How to Build and Test, please refer to: https://github.com/apache/fory/blob/main/docs/guide/DEVELOPMENT.md Thanks, ${name}   After at least 3 +1 binding vote (from Fory Podling PMC member and committers) and no veto, first, reply to the above voting thread to notify that the voting has ended.  Hi all, The vote for Release Apache Fory v${release_version}-${rc_version} is closed now. Thanks to everyone for helping checking and voting for the release. I will close the vote later in another thread. Best, ${name}   Immediately afterward, launch a new voting thread to claim the voting results.  Title:  [RESULT][VOTE] Release Apache Fory v${release_version}-${rc_version}   Content:  Hello, Apache Fory Community, The vote to release Apache Fory v${release_version}-${rc_version} has passed. The vote PASSED with 3 binding +1 and 0 -1 vote: Binding votes: - xxx - yyy - zzz Vote thread: ${vote_thread_url} Thanks, ${name}   ","version":"0.15","tagName":"h3"},{"title":"What if vote fail‚Äã","type":1,"pageTitle":"How to release","url":"/docs/community/how_to_release#what-if-vote-fail","content":" If the vote failed, click &quot;Drop&quot; to drop the staging Maven artifacts.  Address the raised issues, then bump rc_version and file a new vote again.  ","version":"0.15","tagName":"h3"},{"title":"Official Release‚Äã","type":1,"pageTitle":"How to release","url":"/docs/community/how_to_release#official-release","content":" ","version":"0.15","tagName":"h2"},{"title":"Publish artifacts to SVN Release Directory‚Äã","type":1,"pageTitle":"How to release","url":"/docs/community/how_to_release#publish-artifacts-to-svn-release-directory","content":" release_version: the release version for fory, like 0.5.0release_candidate_version: the version for voting, like 0.5.0-rc1  svn mv https://dist.apache.org/repos/dist/dev/fory/${release_version}-${rc_version} https://dist.apache.org/repos/dist/release/fory/${release_version} -m &quot;Release fory ${release_version}&quot;   In the repository at https://dist.apache.org/repos/dist/dev/fory/, if any outdated release_candidate_version are left behind when releasing the release_version, please clear them to keep the dev repository tidy.  When https://archive.apache.org/dist/fory/0.12.0/${release_version} is accessible (confirming that the release_version has been successfully released and archived), we may clean up the previous release version in the release repository, leaving only the current version.  ","version":"0.15","tagName":"h3"},{"title":"Update Fory&Fory-Site content‚Äã","type":1,"pageTitle":"How to release","url":"/docs/community/how_to_release#update-foryfory-site-content","content":" Submit a PR to https://github.com/apache/fory-site to update Fory-site. Reference implementation: #283and #285.  Update Fory-Site‚Äã  In general, the following two key areas need to be modified:  Write a new announcement, for example: Add a new markdown file under the blog folder:  The Apache Fory team is pleased to announce the [?] release. This is a major release that includes [? PR](https://github.com/apache/fory/compare/v[?]...v[?]) from ? distinct contributors. See the [Install](https://fory.apache.org/docs/start/install) Page to learn how to get the libraries for your platform.   Replace versions by upgrading old versions to new ones. For example, in install section, it is necessary to update the documentation for both the development branch and the latest release branch::  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-core&lt;/artifactId&gt; &lt;version&gt;0.11.2&lt;/version&gt; &lt;/dependency&gt;   Update Fory‚Äã  Submit a PR to https://github.com/apache/fury to update README, like #2207.  ","version":"0.15","tagName":"h3"},{"title":"Github officially released‚Äã","type":1,"pageTitle":"How to release","url":"/docs/community/how_to_release#github-officially-released","content":" You need to officially release this version in the Fory project Reference implementation: https://github.com/apache/fory/releases/tag/v0.12.0  ","version":"0.15","tagName":"h3"},{"title":"Release Maven artifacts‚Äã","type":1,"pageTitle":"How to release","url":"/docs/community/how_to_release#release-maven-artifacts","content":" maven_artifact_number: the number for Maven staging artifacts, like 1001.Open https://repository.apache.org/#stagingRepositories.Find the artifact orgapachefory-${maven_artifact_number}, click &quot;Release&quot;.  ","version":"0.15","tagName":"h3"},{"title":"Send the announcement‚Äã","type":1,"pageTitle":"How to release","url":"/docs/community/how_to_release#send-the-announcement","content":" Send the release announcement to dev@fory.apache.org and CC announce@apache.org.  Title:  [ANNOUNCE] Apache Fory ${release_version} released   Content:  Hi all, The Apache Fory community is pleased to announce that Apache Fory {release_version} has been released! Apache Fory - A blazingly fast multi-language serialization framework powered by JIT and zero-copy. The release notes are available here: https://github.com/apache/fory/releases/tag/v${release_version} For the complete list of changes: https://github.com/apache/fory/compare/v0.12.0...v${release_version} Apache Fory website: https://fory.apache.org/ Download Links: https://fory.apache.org/download Fory Resources: - Fory github repo: https://github.com/apache/fory - Issue: https://github.com/apache/fory/issues - Mailing list: dev@fory.apache.org We are looking to grow our community and welcome new contributors. If you are interested in contributing to Fory, please contact us on the mailing list or on GitHub. We will be happy to help you get started. ------------------ Best Regards, ${your_name}   Remember to use plain text instead of rich text format, or you may be rejected when CC announce@apache.org  After completing the above steps, the Fory release process comes to an end. ","version":"0.15","tagName":"h3"},{"title":"Compiler Guide","type":0,"sectionRef":"#","url":"/docs/compiler/compiler_guide","content":"","keywords":"","version":"0.15"},{"title":"Installation‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#installation","content":" ","version":"0.15","tagName":"h2"},{"title":"From Source‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#from-source","content":" cd compiler pip install -e .   ","version":"0.15","tagName":"h3"},{"title":"Verify Installation‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#verify-installation","content":" foryc --help   ","version":"0.15","tagName":"h3"},{"title":"Command Line Interface‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#command-line-interface","content":" ","version":"0.15","tagName":"h2"},{"title":"Basic Usage‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#basic-usage","content":" foryc [OPTIONS] FILES...   foryc --scan-generated [OPTIONS]   ","version":"0.15","tagName":"h3"},{"title":"Options‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#options","content":" Compile options:  Option\tDescription\tDefault--lang\tComma-separated target languages\tall --output, -o\tOutput directory\t./generated --package\tOverride package name from Fory IDL file\t(from file) -I, --proto_path, --import_path\tAdd directory to import search path (can be repeated)\t(none) --java_out=DST_DIR\tGenerate Java code in DST_DIR\t(none) --python_out=DST_DIR\tGenerate Python code in DST_DIR\t(none) --cpp_out=DST_DIR\tGenerate C++ code in DST_DIR\t(none) --go_out=DST_DIR\tGenerate Go code in DST_DIR\t(none) --rust_out=DST_DIR\tGenerate Rust code in DST_DIR\t(none) --go_nested_type_style\tGo nested type naming: camelcase or underscore\tfrom schema/default --emit-fdl\tPrint translated Fory IDL for non-.fdl inputs\tfalse --emit-fdl-path\tWrite translated Fory IDL to a file or directory\t(stdout)  Scan options (with --scan-generated):  Option\tDescription\tDefault--root\tRoot directory to scan\t. --relative\tPrint paths relative to root\tfalse --delete\tDelete matched generated files\tfalse --dry-run\tScan/print only, do not delete\tfalse  ","version":"0.15","tagName":"h3"},{"title":"Scan Generated Files‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#scan-generated-files","content":" Use --scan-generated to find files produced by foryc. The scanner walks the tree recursively, skips build/, target/, and hidden directories, and prints each generated file as it is found.  # Scan current directory foryc --scan-generated # Scan a specific root foryc --scan-generated --root ./src # Print paths relative to the scan root foryc --scan-generated --root ./src --relative # Delete scanned generated files foryc --scan-generated --root ./src --delete # Dry-run (scan and print only) foryc --scan-generated --root ./src --dry-run   ","version":"0.15","tagName":"h3"},{"title":"Examples‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#examples","content":" Compile for all languages:  foryc schema.fdl   Compile for specific languages:  foryc schema.fdl --lang java,python   Specify output directory:  foryc schema.fdl --output ./src/generated   Override package name:  foryc schema.fdl --package com.myapp.models   Compile multiple files:  foryc user.fdl order.fdl product.fdl --output ./generated   Use import search paths:  # Add a single import path foryc src/main.fdl -I libs/common # Add multiple import paths (repeated option) foryc src/main.fdl -I libs/common -I libs/types # Add multiple import paths (comma-separated) foryc src/main.fdl -I libs/common,libs/types,third_party/ # Using --proto_path (protoc-compatible alias) foryc src/main.fdl --proto_path=libs/common # Mix all styles foryc src/main.fdl -I libs/common,libs/types --proto_path third_party/   Language-specific output directories (protoc-style):  # Generate only Java code to a specific directory foryc schema.fdl --java_out=./src/main/java # Generate multiple languages to different directories foryc schema.fdl --java_out=./java/gen --python_out=./python/src --go_out=./go/gen # Combine with import paths foryc schema.fdl --java_out=./gen/java -I proto/ -I common/   When using --{lang}_out options:  Only the specified languages are generated (not all languages)The compiler writes under the specified directory (language-specific generators may still create package/module subdirectories)This is compatible with protoc-style workflows  Inspect translated Fory IDL from proto/fbs input:  # Print translated Fory IDL to stdout foryc schema.proto --emit-fdl # Write translated Fory IDL to a directory foryc schema.fbs --emit-fdl --emit-fdl-path ./translated   ","version":"0.15","tagName":"h3"},{"title":"Import Path Resolution‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#import-path-resolution","content":" When compiling Fory IDL files with imports, the compiler searches for imported files in this order:  Relative to the importing file (default) - The directory containing the file with the import statement is always searched first, automatically. No -I flag needed for same-directory imports.Each -I path in order - Additional search paths specified on the command line  Same-directory imports work automatically:  // main.fdl import &quot;common.fdl&quot;; // Found if common.fdl is in the same directory   # No -I needed for same-directory imports foryc main.fdl   Example project structure:  project/ ‚îú‚îÄ‚îÄ src/ ‚îÇ ‚îî‚îÄ‚îÄ main.fdl # import &quot;common.fdl&quot;; ‚îî‚îÄ‚îÄ libs/ ‚îî‚îÄ‚îÄ common.fdl   Without -I (fails):  $ foryc src/main.fdl Import error: Import not found: common.fdl Searched in: /project/src   With -I (succeeds):  $ foryc src/main.fdl -I libs/ Compiling src/main.fdl... Resolved 1 import(s)   ","version":"0.15","tagName":"h2"},{"title":"Supported Languages‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#supported-languages","content":" Language\tFlag\tOutput Extension\tDescriptionJava\tjava\t.java\tPOJOs with Fory annotations Python\tpython\t.py\tDataclasses with type hints Go\tgo\t.go\tStructs with struct tags Rust\trust\t.rs\tStructs with derive macros C++\tcpp\t.h\tStructs with FORY macros  ","version":"0.15","tagName":"h2"},{"title":"Output Structure‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#output-structure","content":" ","version":"0.15","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#java","content":" generated/ ‚îî‚îÄ‚îÄ java/ ‚îî‚îÄ‚îÄ com/ ‚îî‚îÄ‚îÄ example/ ‚îú‚îÄ‚îÄ User.java ‚îú‚îÄ‚îÄ Order.java ‚îú‚îÄ‚îÄ Status.java ‚îî‚îÄ‚îÄ ExampleForyRegistration.java   One file per type (enum or message)Package structure matches Fory IDL packageRegistration helper class generated  ","version":"0.15","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#python","content":" generated/ ‚îî‚îÄ‚îÄ python/ ‚îî‚îÄ‚îÄ example.py   Single module with all typesModule name derived from packageRegistration function included  ","version":"0.15","tagName":"h3"},{"title":"Go‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#go","content":" generated/ ‚îî‚îÄ‚îÄ go/ ‚îî‚îÄ‚îÄ example/ ‚îî‚îÄ‚îÄ example.go   Single file with all typesDirectory and package name are derived from go_package or the Fory IDL packageRegistration function included  ","version":"0.15","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#rust","content":" generated/ ‚îî‚îÄ‚îÄ rust/ ‚îî‚îÄ‚îÄ example.rs   Single module with all typesModule name derived from packageRegistration function included  ","version":"0.15","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#c","content":" generated/ ‚îî‚îÄ‚îÄ cpp/ ‚îî‚îÄ‚îÄ example.h   Single header fileNamespace matches package (dots to ::)Header guards and forward declarations  ","version":"0.15","tagName":"h3"},{"title":"Build Integration‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#build-integration","content":" ","version":"0.15","tagName":"h2"},{"title":"Maven (Java)‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#maven-java","content":" Add to your pom.xml:  &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt; &lt;artifactId&gt;exec-maven-plugin&lt;/artifactId&gt; &lt;version&gt;3.1.0&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;generate-fory-types&lt;/id&gt; &lt;phase&gt;generate-sources&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;exec&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;executable&gt;foryc&lt;/executable&gt; &lt;arguments&gt; &lt;argument&gt;${project.basedir}/src/main/fdl/schema.fdl&lt;/argument&gt; &lt;argument&gt;--java_out&lt;/argument&gt; &lt;argument&gt;${project.build.directory}/generated-sources/fory&lt;/argument&gt; &lt;/arguments&gt; &lt;/configuration&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;   Add generated sources:  &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt; &lt;artifactId&gt;build-helper-maven-plugin&lt;/artifactId&gt; &lt;version&gt;3.4.0&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;phase&gt;generate-sources&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;add-source&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;sources&gt; &lt;source&gt;${project.build.directory}/generated-sources/fory&lt;/source&gt; &lt;/sources&gt; &lt;/configuration&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;   ","version":"0.15","tagName":"h3"},{"title":"Gradle (Java/Kotlin)‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#gradle-javakotlin","content":" Add to build.gradle:  task generateForyTypes(type: Exec) { commandLine 'foryc', &quot;${projectDir}/src/main/fdl/schema.fdl&quot;, '--java_out', &quot;${buildDir}/generated/sources/fory&quot; } compileJava.dependsOn generateForyTypes sourceSets { main { java { srcDir &quot;${buildDir}/generated/sources/fory&quot; } } }   ","version":"0.15","tagName":"h3"},{"title":"Python (setuptools)‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#python-setuptools","content":" Add to setup.py or pyproject.toml:  # setup.py from setuptools import setup from setuptools.command.build_py import build_py import subprocess class BuildWithForyIdl(build_py): def run(self): subprocess.run([ 'foryc', 'schema.fdl', '--python_out', 'src/generated' ], check=True) super().run() setup( cmdclass={'build_py': BuildWithForyIdl}, # ... )   ","version":"0.15","tagName":"h3"},{"title":"Go (go generate)‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#go-go-generate","content":" Add to your Go file:  //go:generate foryc ../schema.fdl --lang go --output . package models   Run:  go generate ./...   ","version":"0.15","tagName":"h3"},{"title":"Rust (build.rs)‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#rust-buildrs","content":" Add to build.rs:  use std::process::Command; fn main() { println!(&quot;cargo:rerun-if-changed=schema.fdl&quot;); let status = Command::new(&quot;foryc&quot;) .args(&amp;[&quot;schema.fdl&quot;, &quot;--rust_out&quot;, &quot;src/generated&quot;]) .status() .expect(&quot;Failed to run foryc&quot;); if !status.success() { panic!(&quot;Fory IDL compilation failed&quot;); } }   ","version":"0.15","tagName":"h3"},{"title":"CMake (C++)‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#cmake-c","content":" Add to CMakeLists.txt:  find_program(FORY_COMPILER foryc) add_custom_command( OUTPUT ${CMAKE_CURRENT_SOURCE_DIR}/generated/example.h COMMAND ${FORY_COMPILER} ${CMAKE_CURRENT_SOURCE_DIR}/schema.fdl --cpp_out ${CMAKE_CURRENT_SOURCE_DIR}/generated DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/schema.fdl COMMENT &quot;Generating Fory IDL types&quot; ) add_custom_target(generate_fory_idl DEPENDS ${CMAKE_CURRENT_SOURCE_DIR}/generated/example.h) add_library(mylib ...) add_dependencies(mylib generate_fory_idl) target_include_directories(mylib PRIVATE ${CMAKE_CURRENT_SOURCE_DIR}/generated)   ","version":"0.15","tagName":"h3"},{"title":"Bazel‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#bazel","content":" Create a rule in BUILD:  genrule( name = &quot;generate_fdl&quot;, srcs = [&quot;schema.fdl&quot;], outs = [&quot;generated/example.h&quot;], cmd = &quot;$(location //:fory_compiler) $(SRCS) --cpp_out $(RULEDIR)/generated&quot;, tools = [&quot;//:fory_compiler&quot;], ) cc_library( name = &quot;models&quot;, hdrs = [&quot;:generate_fdl&quot;], # ... )   ","version":"0.15","tagName":"h3"},{"title":"Error Handling‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#error-handling","content":" ","version":"0.15","tagName":"h2"},{"title":"Syntax Errors‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#syntax-errors","content":" Error: Line 5, Column 12: Expected ';' after field declaration   Fix: Check the indicated line for missing semicolons or syntax issues.  ","version":"0.15","tagName":"h3"},{"title":"Duplicate Type Names‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#duplicate-type-names","content":" Error: Duplicate type name: User   Fix: Ensure each enum and message has a unique name within the file.  ","version":"0.15","tagName":"h3"},{"title":"Duplicate Type IDs‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#duplicate-type-ids","content":" Error: Duplicate type ID 100: User and Order   Fix: Assign unique type IDs to each type.  ","version":"0.15","tagName":"h3"},{"title":"Unknown Type References‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#unknown-type-references","content":" Error: Unknown type 'Address' in Customer.address   Fix: Define the referenced type before using it, or check for typos.  ","version":"0.15","tagName":"h3"},{"title":"Duplicate Field Numbers‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#duplicate-field-numbers","content":" Error: Duplicate field number 1 in User: name and id   Fix: Assign unique field numbers within each message.  ","version":"0.15","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#best-practices","content":" ","version":"0.15","tagName":"h2"},{"title":"Project Structure‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#project-structure","content":" project/ ‚îú‚îÄ‚îÄ fdl/ ‚îÇ ‚îú‚îÄ‚îÄ common.fdl # Shared types ‚îÇ ‚îú‚îÄ‚îÄ user.fdl # User domain ‚îÇ ‚îî‚îÄ‚îÄ order.fdl # Order domain ‚îú‚îÄ‚îÄ src/ ‚îÇ ‚îî‚îÄ‚îÄ generated/ # Generated code (git-ignored) ‚îî‚îÄ‚îÄ build.gradle   ","version":"0.15","tagName":"h3"},{"title":"Version Control‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#version-control","content":" Track: Fory IDL schema filesIgnore: Generated code (can be regenerated)  Add to .gitignore:  # Generated Fory IDL code src/generated/ generated/   ","version":"0.15","tagName":"h3"},{"title":"CI/CD Integration‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#cicd-integration","content":" Always regenerate during builds:  # GitHub Actions example steps: - name: Install Fory IDL Compiler run: pip install ./compiler - name: Generate Types run: foryc fdl/*.fdl --output src/generated - name: Build run: ./gradlew build   ","version":"0.15","tagName":"h3"},{"title":"Schema Evolution‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#schema-evolution","content":" When modifying schemas:  Never reuse field numbers - Mark as reserved insteadNever change type IDs - They're part of the binary formatAdd new fields - Use new field numbersUse optional - For backward compatibility  message User [id=100] { string id = 1; string name = 2; // Field 3 was removed, don't reuse optional string email = 4; // New field }   ","version":"0.15","tagName":"h3"},{"title":"Troubleshooting‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#troubleshooting","content":" ","version":"0.15","tagName":"h2"},{"title":"Command Not Found‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#command-not-found","content":" foryc: command not found   Solution: Ensure the compiler is installed and in your PATH:  pip install -e ./compiler # Or add to PATH export PATH=$PATH:~/.local/bin   ","version":"0.15","tagName":"h3"},{"title":"Permission Denied‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#permission-denied","content":" Permission denied: ./generated   Solution: Ensure write permissions on the output directory:  chmod -R u+w ./generated   ","version":"0.15","tagName":"h3"},{"title":"Import Errors in Generated Code‚Äã","type":1,"pageTitle":"Compiler Guide","url":"/docs/compiler/compiler_guide#import-errors-in-generated-code","content":" Java: Ensure Fory dependency is in your project:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-core&lt;/artifactId&gt; &lt;version&gt;${fory.version}&lt;/version&gt; &lt;/dependency&gt;   Python: Ensure pyfory is installed:  pip install pyfory   Go: Ensure fory module is available:  go get github.com/apache/fory/go/fory   Rust: Ensure fory crate is in Cargo.toml:  [dependencies] fory = &quot;x.y.z&quot;   C++: Ensure Fory headers are in include path. ","version":"0.15","tagName":"h3"},{"title":"Protobuf IDL Support","type":0,"sectionRef":"#","url":"/docs/compiler/protobuf_idl_support","content":"","keywords":"","version":"0.15"},{"title":"What This Page Covers‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/compiler/protobuf_idl_support#what-this-page-covers","content":" Choosing protobuf vs Fory for your use caseSyntax and semantic differences that matter during migrationSupported Fory extension options in protobuf filesPractical migration patterns from protobuf to Fory  ","version":"0.15","tagName":"h2"},{"title":"Quick Decision Guide‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/compiler/protobuf_idl_support#quick-decision-guide","content":" Situation\tRecommended FormatYou are building gRPC APIs and rely on protobuf tooling\tProtocol Buffers You need maximum object-graph performance and ref tracking\tFory You need circular/shared references in serialized data\tFory You need strong unknown-field behavior for wire compatibility\tProtocol Buffers You need native structs/classes instead of protobuf wrappers\tFory  ","version":"0.15","tagName":"h2"},{"title":"Protobuf vs Fory at a Glance‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/compiler/protobuf_idl_support#protobuf-vs-fory-at-a-glance","content":" Aspect\tProtocol Buffers\tForyPrimary purpose\tRPC/message contracts\tHigh-performance object serialization Encoding model\tTag-length-value\tFory binary protocol Reference tracking\tNot built-in\tFirst-class (ref) Circular refs\tNot supported\tSupported Unknown fields\tPreserved\tNot preserved Generated types\tProtobuf-specific model types\tNative language constructs gRPC ecosystem\tNative\tIn progress (active development)  Fory gRPC support is under active development. For production gRPC workflows today, protobuf remains the mature/default choice.  ","version":"0.15","tagName":"h2"},{"title":"Why Use Apache Fory‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/compiler/protobuf_idl_support#why-use-apache-fory","content":" Idiomatic generated code: Fory IDL generates language-idiomatic classes and structs that can be used directly as domain objects.Faster serialization: In Fory benchmarks, Fory can be around 10x faster than protobuf for object serialization workloads.Better graph modeling: Shared and circular references are first-class features instead of application-level ID-link workarounds.  See benchmark details under Performance References.  ","version":"0.15","tagName":"h2"},{"title":"Syntax and Semantic Mapping‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/compiler/protobuf_idl_support#syntax-and-semantic-mapping","content":" ","version":"0.15","tagName":"h2"},{"title":"Package and File Options‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/compiler/protobuf_idl_support#package-and-file-options","content":" Protocol Buffers  syntax = &quot;proto3&quot;; package example.models; option java_package = &quot;com.example.models&quot;; option go_package = &quot;example.com/models&quot;;   Fory  package example.models;   Fory uses one package namespace for cross-language registration. Language-specific package placement is still configurable in code generation.  ","version":"0.15","tagName":"h3"},{"title":"Message and Enum Definitions‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/compiler/protobuf_idl_support#message-and-enum-definitions","content":" Protocol Buffers  message User { string id = 1; string name = 2; optional string email = 3; int32 age = 4; repeated string tags = 5; map&lt;string, string&gt; metadata = 6; } enum Status { STATUS_UNSPECIFIED = 0; STATUS_ACTIVE = 1; }   Fory  message User [id=101] { string id = 1; string name = 2; optional string email = 3; int32 age = 4; list&lt;string&gt; tags = 5; map&lt;string, string&gt; metadata = 6; } enum Status [id=102] { UNKNOWN = 0; ACTIVE = 1; }   Key differences:  Fory can assign stable type IDs directly ([id=...]).Fory uses list&lt;T&gt; (with repeated T as alias).Enum naming conventions are language-driven instead of protobuf prefix style.  ","version":"0.15","tagName":"h3"},{"title":"oneof to union‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/compiler/protobuf_idl_support#oneof-to-union","content":" Protobuf oneof is translated to a nested Fory union plus an optional field referencing that union.  Protocol Buffers  message Event { oneof payload { string text = 1; int32 number = 2; } }   Fory-style shape after translation  message Event { union payload { string text = 1; int32 number = 2; } optional payload payload = 1; }   Notes:  Union case IDs are derived from the original oneof field numbers.The synthetic union field uses the smallest oneof case number.  ","version":"0.15","tagName":"h3"},{"title":"Imports and Well-Known Types‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/compiler/protobuf_idl_support#imports-and-well-known-types","content":" Protobuf imports are supported. Common well-known types map directly:  google.protobuf.Timestamp -&gt; timestampgoogle.protobuf.Duration -&gt; durationgoogle.protobuf.Any -&gt; any  ","version":"0.15","tagName":"h3"},{"title":"Type Mapping Highlights‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/compiler/protobuf_idl_support#type-mapping-highlights","content":" Protobuf Type\tFory Mappingbool\tbool int32, uint32\tvariable-length 32-bit integer kinds sint32\tzigzag 32-bit integer int64, uint64\tvariable-length 64-bit integer kinds sint64\tzigzag 64-bit integer fixed32, fixed64\tfixed-width unsigned integer kinds sfixed32, sfixed64\tfixed-width signed integer kinds float, double\tfloat32, float64 string, bytes\tstring, bytes repeated T\tlist&lt;T&gt; map&lt;K, V&gt;\tmap&lt;K, V&gt; optional T\toptional T oneof\tunion + optional union reference field int64 [(fory).type = &quot;tagged_int64&quot;]\ttagged_int64 encoding uint64 [(fory).type = &quot;tagged_uint64&quot;]\ttagged_uint64 encoding  ","version":"0.15","tagName":"h2"},{"title":"Fory Extension Options (Protobuf)‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/compiler/protobuf_idl_support#fory-extension-options-protobuf","content":" Fory-specific options in .proto use the (fory). prefix.  option (fory).enable_auto_type_id = true; message TreeNode { TreeNode parent = 1 [(fory).weak_ref = true]; repeated TreeNode children = 2 [(fory).ref = true]; }   ","version":"0.15","tagName":"h2"},{"title":"File-Level Options‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/compiler/protobuf_idl_support#file-level-options","content":" Option\tType\tDescription(fory).use_record_for_java_message\tbool\tGenerate Java records for all messages in this file (fory).polymorphism\tbool\tEnable polymorphic serialization metadata by default (fory).enable_auto_type_id\tbool\tAuto-generate type IDs when omitted (compiler default is true) (fory).evolving\tbool\tDefault schema-evolution behavior for messages (fory).go_nested_type_style\tstring\tGo nested naming style: underscore (default) or camelcase  ","version":"0.15","tagName":"h3"},{"title":"Message and Enum Options‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/compiler/protobuf_idl_support#message-and-enum-options","content":" Option\tApplies To\tType\tDescription(fory).id\tmessage, enum\tint\tExplicit type ID for registration (fory).alias\tmessage, enum\tstring\tAlternate name used for auto-ID hashing (fory).evolving\tmessage\tbool\tOverride file-level evolution setting (fory).use_record_for_java\tmessage\tbool\tGenerate Java record for this message (fory).deprecated\tmessage, enum\tbool\tMark type as deprecated (fory).namespace\tmessage\tstring\tOverride default package-based namespace  ","version":"0.15","tagName":"h3"},{"title":"Field-Level Options‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/compiler/protobuf_idl_support#field-level-options","content":" Option\tType\tDescription(fory).ref\tbool\tEnable reference tracking for this field (fory).nullable\tbool\tTreat field as nullable (optional) (fory).weak_ref\tbool\tGenerate weak pointer semantics (C++/Rust codegen) (fory).thread_safe_pointer\tbool\tRust pointer flavor for ref fields (Arc vs Rc) (fory).deprecated\tbool\tMark field as deprecated (fory).type\tstring\tPrimitive override, currently tagged_int64/tagged_uint64  Reference option behavior:  weak_ref = true implies ref tracking.For repeated fields, (fory).ref = true applies to list elements.For map&lt;K, V&gt; fields, (fory).ref = true applies to map values.weak_ref and thread_safe_pointer are codegen hints for C++/Rust.  ","version":"0.15","tagName":"h3"},{"title":"Option Examples by Shape‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/compiler/protobuf_idl_support#option-examples-by-shape","content":" message Graph { Node root = 1 [(fory).ref = true, (fory).thread_safe_pointer = false]; repeated Node nodes = 2 [(fory).ref = true]; map&lt;string, Node&gt; cache = 3 [(fory).ref = true]; Node parent = 4 [(fory).weak_ref = true]; }   ","version":"0.15","tagName":"h3"},{"title":"Reference Tracking vs Protobuf IDs‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/compiler/protobuf_idl_support#reference-tracking-vs-protobuf-ids","content":" Protobuf itself does not preserve shared/cyclic object graphs. With Fory protobuf extensions, you can opt into graph semantics.  Without Fory ref options (protobuf-style IDs):  message TreeNode { string id = 1; string parent_id = 2; repeated string child_ids = 3; }   With Fory ref options (object graph):  message TreeNode { TreeNode parent = 1 [(fory).weak_ref = true]; repeated TreeNode children = 2 [(fory).ref = true]; }   ","version":"0.15","tagName":"h2"},{"title":"Migration Guide: Protobuf to Fory‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/compiler/protobuf_idl_support#migration-guide-protobuf-to-fory","content":" ","version":"0.15","tagName":"h2"},{"title":"Step 1: Translate Schema Syntax‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/compiler/protobuf_idl_support#step-1-translate-schema-syntax","content":" Keep package names stable.Replace repeated T with list&lt;T&gt; (or keep repeated alias).Add explicit [id=...] where you need stable numeric registration.  ","version":"0.15","tagName":"h3"},{"title":"Step 2: Convert oneof and Special Types‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/compiler/protobuf_idl_support#step-2-convert-oneof-and-special-types","content":" oneof -&gt; union + optional union field.Map protobuf well-known types to Fory primitives (timestamp, duration, any).  ","version":"0.15","tagName":"h3"},{"title":"Step 3: Replace Protobuf Workarounds with ref‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/compiler/protobuf_idl_support#step-3-replace-protobuf-workarounds-with-ref","content":" Where protobuf used manual ID links for object graphs, switch to Fory refmodifiers (and optional ref(weak=true) where needed).  ","version":"0.15","tagName":"h3"},{"title":"Step 4: Update Build/Codegen‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/compiler/protobuf_idl_support#step-4-update-buildcodegen","content":" Replace protobuf generation steps with the Fory compiler invocation for target languages.  ","version":"0.15","tagName":"h3"},{"title":"Step 5: Run Compatibility Checks‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/compiler/protobuf_idl_support#step-5-run-compatibility-checks","content":" For staged migrations, keep both formats in parallel and verify payload-level parity with integration tests.  ","version":"0.15","tagName":"h3"},{"title":"Coexistence Strategy‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/compiler/protobuf_idl_support#coexistence-strategy","content":" You can run protobuf and Fory in parallel during migration:  public byte[] serialize(Object obj, Format format) { if (format == Format.PROTOBUF) { return ((MessageLite) obj).toByteArray(); } return fory.serialize(obj); }   Use translators at service boundaries while internal object-graph heavy paths migrate first.  ","version":"0.15","tagName":"h2"},{"title":"Performance References‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/compiler/protobuf_idl_support#performance-references","content":" Benchmarks: https://fory.apache.org/docs/introduction/benchmarkBenchmark code: https://github.com/apache/fory/tree/main/benchmarks  ","version":"0.15","tagName":"h2"},{"title":"Summary‚Äã","type":1,"pageTitle":"Protobuf IDL Support","url":"/docs/compiler/protobuf_idl_support#summary","content":" Use protobuf when your primary concern is API contracts and gRPC ecosystem integration. Use Fory when object-graph performance, native models, and reference semantics are the primary concern. ","version":"0.15","tagName":"h2"},{"title":"C++ Serialization Guide","type":0,"sectionRef":"#","url":"/docs/guide/cpp/","content":"","keywords":"","version":"0.15"},{"title":"Why Apache Fory‚Ñ¢ C++?‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/guide/cpp/#why-apache-fory-c","content":" üî• Blazingly Fast: Fast serialization and optimized binary protocolsüåç Cross-Language: Seamlessly serialize/deserialize data across Java, Python, C++, Go, JavaScript, and RustüéØ Type-Safe: Compile-time type checking with macro-based struct registrationüîÑ Reference Tracking: Automatic tracking of shared and circular referencesüì¶ Schema Evolution: Compatible mode for independent schema changes‚ö° Two Formats: Object graph serialization and zero-copy row-based formatüßµ Thread Safety: Both single-threaded (fastest) and thread-safe variants  ","version":"0.15","tagName":"h2"},{"title":"Installation‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/guide/cpp/#installation","content":" The C++ implementation supports both CMake and Bazel build systems.  ","version":"0.15","tagName":"h2"},{"title":"Prerequisites‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/guide/cpp/#prerequisites","content":" CMake 3.16+ (for CMake build) or Bazel 8+ (for Bazel build)C++17 compatible compiler (GCC 7+, Clang 5+, MSVC 2017+)  ","version":"0.15","tagName":"h3"},{"title":"Using CMake (Recommended)‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/guide/cpp/#using-cmake-recommended","content":" The easiest way to use Fory is with CMake's FetchContent module:  cmake_minimum_required(VERSION 3.16) project(my_project LANGUAGES CXX) set(CMAKE_CXX_STANDARD 17) set(CMAKE_CXX_STANDARD_REQUIRED ON) if(MSVC) add_compile_options(/Zc:preprocessor) endif() include(FetchContent) FetchContent_Declare( fory GIT_REPOSITORY https://github.com/apache/fory.git GIT_TAG v0.15.0 SOURCE_SUBDIR cpp ) FetchContent_MakeAvailable(fory) add_executable(my_app main.cc) target_link_libraries(my_app PRIVATE fory::serialization)   Then build and run:  mkdir build &amp;&amp; cd build cmake .. -DCMAKE_BUILD_TYPE=Release cmake --build . --parallel ./my_app   ","version":"0.15","tagName":"h3"},{"title":"Using Bazel‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/guide/cpp/#using-bazel","content":" Create a MODULE.bazel file in your project root:  module( name = &quot;my_project&quot;, version = &quot;1.0.0&quot;, ) bazel_dep(name = &quot;rules_cc&quot;, version = &quot;0.1.1&quot;) bazel_dep(name = &quot;fory&quot;, version = &quot;0.15.0&quot;) git_override( module_name = &quot;fory&quot;, remote = &quot;https://github.com/apache/fory.git&quot;, commit = &quot;v0.15.0&quot;, # Or use a specific commit hash for reproducibility )   Create a BUILD file for your application:  cc_binary( name = &quot;my_app&quot;, srcs = [&quot;main.cc&quot;], deps = [&quot;@fory//cpp/fory/serialization:fory_serialization&quot;], )   Then build and run:  bazel build //:my_app bazel run //:my_app   For local development, you can use local_path_override instead:  bazel_dep(name = &quot;fory&quot;, version = &quot;0.15.0&quot;) local_path_override( module_name = &quot;fory&quot;, path = &quot;/path/to/fory&quot;, )   ","version":"0.15","tagName":"h3"},{"title":"Examples‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/guide/cpp/#examples","content":" See the examples/cpp directory for complete working examples:  hello_world - Object graph serializationhello_row - Row format encoding  ","version":"0.15","tagName":"h3"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/guide/cpp/#quick-start","content":" ","version":"0.15","tagName":"h2"},{"title":"Basic Example‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/guide/cpp/#basic-example","content":" #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; // Define a struct class Person { std::string name; int32_t age; std::vector&lt;std::string&gt; hobbies; bool operator==(const Person &amp;other) const { return name == other.name &amp;&amp; age == other.age &amp;&amp; hobbies == other.hobbies; } public: // Register the struct with Fory (FORY_STRUCT must be in public scope). FORY_STRUCT(Person, name, age, hobbies); }; int main() { // Create a Fory instance auto fory = Fory::builder() .xlang(true) // Enable cross-language mode .track_ref(false) // Disable reference tracking for simple types .build(); // Register the type with a unique ID fory.register_struct&lt;Person&gt;(1); // Create an object Person person{&quot;Alice&quot;, 30, {&quot;reading&quot;, &quot;coding&quot;}}; // Serialize auto result = fory.serialize(person); if (!result.ok()) { // Handle error return 1; } std::vector&lt;uint8_t&gt; bytes = std::move(result).value(); // Deserialize auto deser_result = fory.deserialize&lt;Person&gt;(bytes); if (!deser_result.ok()) { // Handle error return 1; } Person decoded = std::move(deser_result).value(); assert(person == decoded); return 0; }   ","version":"0.15","tagName":"h3"},{"title":"Inherited Fields‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/guide/cpp/#inherited-fields","content":" To include base-class fields in a derived type, list FORY_BASE(Base) insideFORY_STRUCT. The base must define its own FORY_STRUCT so its fields can be referenced.  struct Base { int32_t id; FORY_STRUCT(Base, id); }; struct Derived : Base { std::string name; FORY_STRUCT(Derived, FORY_BASE(Base), name); };   ","version":"0.15","tagName":"h3"},{"title":"Thread Safety‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/guide/cpp/#thread-safety","content":" Apache Fory‚Ñ¢ C++ provides two variants for different threading needs:  ","version":"0.15","tagName":"h2"},{"title":"Single-Threaded (Fastest)‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/guide/cpp/#single-threaded-fastest","content":" // Single-threaded Fory - fastest, NOT thread-safe auto fory = Fory::builder() .xlang(true) .build();   ","version":"0.15","tagName":"h3"},{"title":"Thread-Safe‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/guide/cpp/#thread-safe","content":" // Thread-safe Fory - uses context pools auto fory = Fory::builder() .xlang(true) .build_thread_safe(); // Can be used from multiple threads safely std::thread t1([&amp;]() { auto result = fory.serialize(obj1); }); std::thread t2([&amp;]() { auto result = fory.serialize(obj2); });   Tip: Perform type registrations before spawning threads so every worker sees the same metadata.  ","version":"0.15","tagName":"h3"},{"title":"Use Cases‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/guide/cpp/#use-cases","content":" ","version":"0.15","tagName":"h2"},{"title":"Object Serialization‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/guide/cpp/#object-serialization","content":" Complex data structures with nested objects and referencesCross-language communication in microservicesGeneral-purpose serialization with full type safetySchema evolution with compatible mode  ","version":"0.15","tagName":"h3"},{"title":"Row-Based Serialization‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/guide/cpp/#row-based-serialization","content":" High-throughput data processingAnalytics workloads requiring fast field accessMemory-constrained environmentsZero-copy scenarios  ","version":"0.15","tagName":"h3"},{"title":"Next Steps‚Äã","type":1,"pageTitle":"C++ Serialization Guide","url":"/docs/guide/cpp/#next-steps","content":" Configuration - Builder options and modesBasic Serialization - Object graph serializationSchema Evolution - Compatible mode and schema changesType Registration - Registering typesField Configuration - Field-level metadata (nullable, ref tracking)Supported Types - All supported typesCross-Language - XLANG modeRow Format - Zero-copy row-based format ","version":"0.15","tagName":"h2"},{"title":"Configuration","type":0,"sectionRef":"#","url":"/docs/guide/cpp/configuration","content":"","keywords":"","version":"0.15"},{"title":"Serialization Modes‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/cpp/configuration#serialization-modes","content":" Apache Fory‚Ñ¢ supports two serialization modes:  ","version":"0.15","tagName":"h2"},{"title":"SchemaConsistent Mode (Default)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/cpp/configuration#schemaconsistent-mode-default","content":" Type declarations must match exactly between peers:  auto fory = Fory::builder().build(); // SchemaConsistent by default   ","version":"0.15","tagName":"h3"},{"title":"Compatible Mode‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/cpp/configuration#compatible-mode","content":" Allows independent schema evolution:  auto fory = Fory::builder().compatible(true).build();   ","version":"0.15","tagName":"h3"},{"title":"Builder Pattern‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/cpp/configuration#builder-pattern","content":" Use ForyBuilder to construct Fory instances with custom configuration:  #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; // Default configuration auto fory = Fory::builder().build(); // Compatible mode for schema evolution auto fory = Fory::builder() .compatible(true) .build(); // Cross-language mode auto fory = Fory::builder() .xlang(true) .build(); // Full configuration auto fory = Fory::builder() .compatible(true) .xlang(true) .track_ref(true) .max_dyn_depth(10) .check_struct_version(true) .build();   ","version":"0.15","tagName":"h2"},{"title":"Configuration Options‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/cpp/configuration#configuration-options","content":" ","version":"0.15","tagName":"h2"},{"title":"xlang(bool)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/cpp/configuration#xlangbool","content":" Enable/disable cross-language (xlang) serialization mode.  auto fory = Fory::builder() .xlang(true) // Enable cross-language compatibility .build();   When enabled, includes metadata for cross-language compatibility with Java, Python, Go, Rust, and JavaScript.  Default: true  ","version":"0.15","tagName":"h3"},{"title":"compatible(bool)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/cpp/configuration#compatiblebool","content":" Enable/disable compatible mode for schema evolution.  auto fory = Fory::builder() .compatible(true) // Enable schema evolution .build();   When enabled, supports reading data serialized with different schema versions.  Default: false  ","version":"0.15","tagName":"h3"},{"title":"track_ref(bool)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/cpp/configuration#track_refbool","content":" Enable/disable reference tracking for shared and circular references.  auto fory = Fory::builder() .track_ref(true) // Enable reference tracking .build();   When enabled, avoids duplicating shared objects and handles cycles.  Default: true  ","version":"0.15","tagName":"h3"},{"title":"max_dyn_depth(uint32_t)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/cpp/configuration#max_dyn_depthuint32_t","content":" Set maximum allowed nesting depth for dynamically-typed objects.  auto fory = Fory::builder() .max_dyn_depth(10) // Allow up to 10 levels .build();   This limits the maximum depth for nested polymorphic object serialization (e.g., shared_ptr&lt;Base&gt;, unique_ptr&lt;Base&gt;). This prevents stack overflow from deeply nested structures in dynamic serialization scenarios.  Default: 5  When to adjust:  Increase: For legitimate deeply nested data structuresDecrease: For stricter security requirements or shallow data structures  ","version":"0.15","tagName":"h3"},{"title":"check_struct_version(bool)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/cpp/configuration#check_struct_versionbool","content":" Enable/disable struct version checking.  auto fory = Fory::builder() .check_struct_version(true) // Enable version checking .build();   When enabled, validates type hashes to detect schema mismatches.  Default: false  ","version":"0.15","tagName":"h3"},{"title":"Thread-Safe vs Single-Threaded‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/cpp/configuration#thread-safe-vs-single-threaded","content":" ","version":"0.15","tagName":"h2"},{"title":"Single-Threaded (Fastest)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/cpp/configuration#single-threaded-fastest","content":" auto fory = Fory::builder() .xlang(true) .build(); // Returns Fory   Single-threaded Fory is the fastest option, but NOT thread-safe. Use one instance per thread.  ","version":"0.15","tagName":"h3"},{"title":"Thread-Safe‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/cpp/configuration#thread-safe","content":" auto fory = Fory::builder() .xlang(true) .build_thread_safe(); // Returns ThreadSafeFory   ThreadSafeFory uses a pool of Fory instances to provide thread-safe serialization. Slightly slower due to pool overhead, but safe to use from multiple threads concurrently.  ","version":"0.15","tagName":"h3"},{"title":"Configuration Summary‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/cpp/configuration#configuration-summary","content":" Option\tDescription\tDefaultxlang(bool)\tEnable cross-language mode\ttrue compatible(bool)\tEnable schema evolution\tfalse track_ref(bool)\tEnable reference tracking\ttrue max_dyn_depth(uint32_t)\tMaximum nesting depth for dynamic types\t5 check_struct_version(bool)\tEnable struct version checking\tfalse  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/cpp/configuration#related-topics","content":" Basic Serialization - Using configured ForyCross-Language - XLANG mode detailsType Registration - Registering types ","version":"0.15","tagName":"h2"},{"title":"Basic Serialization","type":0,"sectionRef":"#","url":"/docs/guide/cpp/basic_serialization","content":"","keywords":"","version":"0.15"},{"title":"Object Graph Serialization‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/cpp/basic_serialization#object-graph-serialization","content":" Apache Fory‚Ñ¢ provides automatic serialization of complex object graphs, preserving the structure and relationships between objects. The FORY_STRUCT macro generates efficient serialization code at compile time, eliminating runtime overhead.  Key capabilities:  Nested struct serialization with arbitrary depthCollection types (vector, set, map)Optional fields with std::optional&lt;T&gt;Smart pointers (std::shared_ptr, std::unique_ptr)Automatic handling of primitive types and stringsEfficient binary encoding with variable-length integers  #include &quot;fory/serialization/fory.h&quot; #include &lt;vector&gt; #include &lt;map&gt; using namespace fory::serialization; // Define structs struct Address { std::string street; std::string city; std::string country; bool operator==(const Address &amp;other) const { return street == other.street &amp;&amp; city == other.city &amp;&amp; country == other.country; } }; FORY_STRUCT(Address, street, city, country); struct Person { std::string name; int32_t age; Address address; std::vector&lt;std::string&gt; hobbies; std::map&lt;std::string, std::string&gt; metadata; bool operator==(const Person &amp;other) const { return name == other.name &amp;&amp; age == other.age &amp;&amp; address == other.address &amp;&amp; hobbies == other.hobbies &amp;&amp; metadata == other.metadata; } }; FORY_STRUCT(Person, name, age, address, hobbies, metadata); int main() { auto fory = Fory::builder().xlang(true).build(); fory.register_struct&lt;Address&gt;(100); fory.register_struct&lt;Person&gt;(200); Person person{ &quot;John Doe&quot;, 30, {&quot;123 Main St&quot;, &quot;New York&quot;, &quot;USA&quot;}, {&quot;reading&quot;, &quot;coding&quot;}, {{&quot;role&quot;, &quot;developer&quot;}} }; auto result = fory.serialize(person); auto decoded = fory.deserialize&lt;Person&gt;(result.value()); assert(person == decoded.value()); }   ","version":"0.15","tagName":"h2"},{"title":"Serialization APIs‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/cpp/basic_serialization#serialization-apis","content":" ","version":"0.15","tagName":"h2"},{"title":"Serialize to New Vector‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/cpp/basic_serialization#serialize-to-new-vector","content":" auto fory = Fory::builder().xlang(true).build(); fory.register_struct&lt;MyStruct&gt;(1); MyStruct obj{/* ... */}; // Serialize - returns Result&lt;std::vector&lt;uint8_t&gt;, Error&gt; auto result = fory.serialize(obj); if (result.ok()) { std::vector&lt;uint8_t&gt; bytes = std::move(result).value(); // Use bytes... } else { // Handle error std::cerr &lt;&lt; result.error().to_string() &lt;&lt; std::endl; }   ","version":"0.15","tagName":"h3"},{"title":"Serialize to Existing Buffer‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/cpp/basic_serialization#serialize-to-existing-buffer","content":" // Serialize to existing Buffer (fastest path) Buffer buffer; auto result = fory.serialize_to(buffer, obj); if (result.ok()) { size_t bytes_written = result.value(); // buffer now contains serialized data } // Serialize to existing vector (zero-copy) std::vector&lt;uint8_t&gt; output; auto result = fory.serialize_to(output, obj); if (result.ok()) { size_t bytes_written = result.value(); // output now contains serialized data }   ","version":"0.15","tagName":"h3"},{"title":"Deserialize from Byte Array‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/cpp/basic_serialization#deserialize-from-byte-array","content":" // Deserialize from raw pointer auto result = fory.deserialize&lt;MyStruct&gt;(data_ptr, data_size); if (result.ok()) { MyStruct obj = std::move(result).value(); } // Deserialize from vector std::vector&lt;uint8_t&gt; data = /* ... */; auto result = fory.deserialize&lt;MyStruct&gt;(data); // Deserialize from Buffer (updates reader_index) Buffer buffer(data); auto result = fory.deserialize&lt;MyStruct&gt;(buffer);   ","version":"0.15","tagName":"h3"},{"title":"Error Handling‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/cpp/basic_serialization#error-handling","content":" Fory uses a Result&lt;T, Error&gt; type for error handling:  auto result = fory.serialize(obj); // Check if operation succeeded if (result.ok()) { auto value = std::move(result).value(); // Use value... } else { Error error = result.error(); std::cerr &lt;&lt; &quot;Error: &quot; &lt;&lt; error.to_string() &lt;&lt; std::endl; } // Or use FORY_TRY macro for early return FORY_TRY(bytes, fory.serialize(obj)); // Use bytes directly...   Common error types:  Error::type_mismatch - Type ID mismatch during deserializationError::invalid_data - Invalid or corrupted dataError::buffer_out_of_bound - Buffer overflow/underflowError::type_error - Type registration error  ","version":"0.15","tagName":"h2"},{"title":"The FORY_STRUCT Macro‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/cpp/basic_serialization#the-fory_struct-macro","content":" The FORY_STRUCT macro registers a class for serialization (struct works the same way):  class MyStruct { public: int32_t x; std::string y; std::vector&lt;int32_t&gt; z; FORY_STRUCT(MyStruct, x, y, z); };   Private fields are supported when the macro is placed in a public: section:  class PrivateUser { public: PrivateUser(int32_t id, std::string name) : id_(id), name_(std::move(name)) {} bool operator==(const PrivateUser &amp;other) const { return id_ == other.id_ &amp;&amp; name_ == other.name_; } private: int32_t id_ = 0; std::string name_; public: FORY_STRUCT(PrivateUser, id_, name_); };   The macro:  Generates compile-time field metadataEnables member or ADL (Argument-Dependent Lookup) discovery for serializationCreates efficient serialization code via template specialization  Requirements:  Must be declared inside the class definition (struct works the same way) or at namespace scopeMust be placed after all field declarations (when used inside the class)When used inside a class, the macro must be placed in a public: sectionAll listed fields must be serializable typesField order in the macro is not important  ","version":"0.15","tagName":"h2"},{"title":"External / Third-Party Types‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/cpp/basic_serialization#external--third-party-types","content":" When you cannot modify a third-party type, use FORY_STRUCT at namespace scope. This only works with public fields.  namespace thirdparty { struct Foo { int32_t id; std::string name; }; FORY_STRUCT(Foo, id, name); } // namespace thirdparty   Limitations:  Must be declared at namespace scope in the same namespace as the typeOnly public fields are supported  ","version":"0.15","tagName":"h2"},{"title":"Inherited Fields‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/cpp/basic_serialization#inherited-fields","content":" To include base-class fields in a derived type, use FORY_BASE(Base) insideFORY_STRUCT. The base must define its own FORY_STRUCT so its fields can be referenced.  struct Base { int32_t a; FORY_STRUCT(Base, a); }; struct Derived : Base { int32_t b; FORY_STRUCT(Derived, FORY_BASE(Base), b); };   Notes:  Base fields are serialized before derived fields.Only fields visible from the derived type are supported.  ","version":"0.15","tagName":"h2"},{"title":"Nested Structs‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/cpp/basic_serialization#nested-structs","content":" Nested structs are fully supported:  struct Inner { int32_t value; FORY_STRUCT(Inner, value); }; struct Outer { Inner inner; std::string label; FORY_STRUCT(Outer, inner, label); }; // Both must be registered fory.register_struct&lt;Inner&gt;(1); fory.register_struct&lt;Outer&gt;(2);   ","version":"0.15","tagName":"h2"},{"title":"Performance Tips‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/cpp/basic_serialization#performance-tips","content":" Buffer Reuse: Use serialize_to(buffer, obj) with pre-allocated buffersPre-registration: Register all types before serialization startsSingle-Threaded: Use build() instead of build_thread_safe() when possibleDisable Tracking: Use track_ref(false) when references aren't neededCompact Encoding: Variable-length encoding for space efficiency  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/cpp/basic_serialization#related-topics","content":" Configuration - Builder optionsType Registration - Registering typesSupported Types - All supported types ","version":"0.15","tagName":"h2"},{"title":"Generated Code","type":0,"sectionRef":"#","url":"/docs/compiler/generated_code","content":"","keywords":"","version":"0.15"},{"title":"Reference Schemas‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#reference-schemas","content":" The examples below use two real schemas:  addressbook.fdl (explicit type IDs)auto_id.fdl (no explicit type IDs)  ","version":"0.15","tagName":"h2"},{"title":"addressbook.fdl (excerpt)‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#addressbookfdl-excerpt","content":" package addressbook; option go_package = &quot;github.com/myorg/myrepo/gen/addressbook;addressbook&quot;; message Person [id=100] { string name = 1; int32 id = 2; enum PhoneType [id=101] { PHONE_TYPE_MOBILE = 0; PHONE_TYPE_HOME = 1; PHONE_TYPE_WORK = 2; } message PhoneNumber [id=102] { string number = 1; PhoneType phone_type = 2; } list&lt;PhoneNumber&gt; phones = 7; Animal pet = 8; } message Dog [id=104] { string name = 1; int32 bark_volume = 2; } message Cat [id=105] { string name = 1; int32 lives = 2; } union Animal [id=106] { Dog dog = 1; Cat cat = 2; } message AddressBook [id=103] { list&lt;Person&gt; people = 1; map&lt;string, Person&gt; people_by_name = 2; }   ","version":"0.15","tagName":"h3"},{"title":"auto_id.fdl (excerpt)‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#auto_idfdl-excerpt","content":" package auto_id; enum Status { UNKNOWN = 0; OK = 1; } message Envelope { string id = 1; message Payload { int32 value = 1; } union Detail { Payload payload = 1; string note = 2; } Payload payload = 2; Detail detail = 3; Status status = 4; } union Wrapper { Envelope envelope = 1; string raw = 2; }   ","version":"0.15","tagName":"h3"},{"title":"Java‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#java","content":" ","version":"0.15","tagName":"h2"},{"title":"Output Layout‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#output-layout","content":" For package addressbook, Java output is generated under:  &lt;java_out&gt;/addressbook/Type files: AddressBook.java, Person.java, Dog.java, Cat.java, Animal.javaRegistration helper: AddressbookForyRegistration.java  ","version":"0.15","tagName":"h3"},{"title":"Type Generation‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#type-generation","content":" Messages generate Java classes with @ForyField, default constructors, getters/setters, and byte helpers:  public class Person { public static enum PhoneType { MOBILE, HOME, WORK; } public static class PhoneNumber { @ForyField(id = 1) private String number; @ForyField(id = 2) private PhoneType phoneType; public byte[] toBytes() { ... } public static PhoneNumber fromBytes(byte[] bytes) { ... } } @ForyField(id = 1) private String name; @ForyField(id = 8) private Animal pet; public byte[] toBytes() { ... } public static Person fromBytes(byte[] bytes) { ... } }   Unions generate classes extending org.apache.fory.type.union.Union:  public final class Animal extends Union { public enum AnimalCase { DOG(1), CAT(2); public final int id; AnimalCase(int id) { this.id = id; } } public static Animal ofDog(Dog v) { ... } public AnimalCase getAnimalCase() { ... } public int getAnimalCaseId() { ... } public boolean hasDog() { ... } public Dog getDog() { ... } public void setDog(Dog v) { ... } }   ","version":"0.15","tagName":"h3"},{"title":"Registration‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#registration","content":" Generated registration helper:  public static void register(Fory fory) { org.apache.fory.resolver.TypeResolver resolver = fory.getTypeResolver(); resolver.registerUnion(Animal.class, 106L, new org.apache.fory.serializer.UnionSerializer(fory, Animal.class)); resolver.register(Person.class, 100L); resolver.register(Person.PhoneType.class, 101L); resolver.register(Person.PhoneNumber.class, 102L); resolver.register(Dog.class, 104L); resolver.register(Cat.class, 105L); resolver.register(AddressBook.class, 103L); }   For schemas without explicit [id=...], generated registration uses computed numeric IDs (for example from auto_id.fdl):  resolver.register(Status.class, 1124725126L); resolver.registerUnion(Wrapper.class, 1471345060L, new org.apache.fory.serializer.UnionSerializer(fory, Wrapper.class)); resolver.register(Envelope.class, 3022445236L); resolver.registerUnion(Envelope.Detail.class, 1609214087L, new org.apache.fory.serializer.UnionSerializer(fory, Envelope.Detail.class)); resolver.register(Envelope.Payload.class, 2862577837L);   If option enable_auto_type_id = false; is set, registration uses namespace and type name:  resolver.register(Config.class, &quot;myapp.models&quot;, &quot;Config&quot;); resolver.registerUnion( Holder.class, &quot;myapp.models&quot;, &quot;Holder&quot;, new org.apache.fory.serializer.UnionSerializer(fory, Holder.class));   ","version":"0.15","tagName":"h3"},{"title":"Usage‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#usage","content":" Person person = new Person(); person.setName(&quot;Alice&quot;); person.setPet(Animal.ofDog(new Dog())); byte[] data = person.toBytes(); Person restored = Person.fromBytes(data);   ","version":"0.15","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#python","content":" ","version":"0.15","tagName":"h2"},{"title":"Output Layout‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#output-layout-1","content":" Python output is one module per schema file, for example:  &lt;python_out&gt;/addressbook.py  ","version":"0.15","tagName":"h3"},{"title":"Type Generation‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#type-generation-1","content":" Unions generate a case enum plus a Union subclass with typed helpers:  class AnimalCase(Enum): DOG = 1 CAT = 2 class Animal(Union): @classmethod def dog(cls, v: Dog) -&gt; &quot;Animal&quot;: ... def case(self) -&gt; AnimalCase: ... def case_id(self) -&gt; int: ... def is_dog(self) -&gt; bool: ... def dog_value(self) -&gt; Dog: ... def set_dog(self, v: Dog) -&gt; None: ...   Messages generate @pyfory.dataclass types, and nested types stay nested:  @pyfory.dataclass class Person: class PhoneType(IntEnum): MOBILE = 0 HOME = 1 WORK = 2 @pyfory.dataclass class PhoneNumber: number: str = pyfory.field(id=1, default=&quot;&quot;) phone_type: Person.PhoneType = pyfory.field(id=2, default=None) name: str = pyfory.field(id=1, default=&quot;&quot;) phones: List[Person.PhoneNumber] = pyfory.field(id=7, default_factory=list) pet: Animal = pyfory.field(id=8, default=None) def to_bytes(self) -&gt; bytes: ... @classmethod def from_bytes(cls, data: bytes) -&gt; &quot;Person&quot;: ...   ","version":"0.15","tagName":"h3"},{"title":"Registration‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#registration-1","content":" Generated registration function:  def register_addressbook_types(fory: pyfory.Fory): fory.register_union(Animal, type_id=106, serializer=AnimalSerializer(fory)) fory.register_type(Person, type_id=100) fory.register_type(Person.PhoneType, type_id=101) fory.register_type(Person.PhoneNumber, type_id=102) fory.register_type(Dog, type_id=104) fory.register_type(Cat, type_id=105) fory.register_type(AddressBook, type_id=103)   For schemas without explicit [id=...], generated registration uses computed numeric IDs:  fory.register_type(Status, type_id=1124725126) fory.register_union(Wrapper, type_id=1471345060, serializer=WrapperSerializer(fory)) fory.register_type(Envelope, type_id=3022445236) fory.register_union(Envelope.Detail, type_id=1609214087, serializer=Envelope.DetailSerializer(fory)) fory.register_type(Envelope.Payload, type_id=2862577837)   If option enable_auto_type_id = false; is set:  fory.register_type(Config, namespace=&quot;myapp.models&quot;, typename=&quot;Config&quot;) fory.register_union( Holder, namespace=&quot;myapp.models&quot;, typename=&quot;Holder&quot;, serializer=HolderSerializer(fory), )   ","version":"0.15","tagName":"h3"},{"title":"Usage‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#usage-1","content":" person = Person(name=&quot;Alice&quot;, pet=Animal.dog(Dog(name=&quot;Rex&quot;, bark_volume=10))) data = person.to_bytes() restored = Person.from_bytes(data)   ","version":"0.15","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#rust","content":" ","version":"0.15","tagName":"h2"},{"title":"Output Layout‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#output-layout-2","content":" Rust output is one module file per schema, for example:  &lt;rust_out&gt;/addressbook.rs  ","version":"0.15","tagName":"h3"},{"title":"Type Generation‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#type-generation-2","content":" Unions map to Rust enums with #[fory(id = ...)] case attributes:  #[derive(ForyObject, Debug, Clone, PartialEq)] pub enum Animal { #[fory(id = 1)] Dog(Dog), #[fory(id = 2)] Cat(Cat), }   Nested types generate nested modules:  pub mod person { #[derive(ForyObject, Debug, Clone, PartialEq, Default)] #[repr(i32)] pub enum PhoneType { #[default] Mobile = 0, Home = 1, Work = 2, } #[derive(ForyObject, Debug, Clone, PartialEq, Default)] pub struct PhoneNumber { #[fory(id = 1)] pub number: String, #[fory(id = 2)] pub phone_type: PhoneType, } }   Messages derive ForyObject and include to_bytes/from_bytes helpers:  #[derive(ForyObject, Debug, Clone, PartialEq, Default)] pub struct Person { #[fory(id = 1)] pub name: String, #[fory(id = 7)] pub phones: Vec&lt;person::PhoneNumber&gt;, #[fory(id = 8, type_id = &quot;union&quot;)] pub pet: Animal, }   ","version":"0.15","tagName":"h3"},{"title":"Registration‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#registration-2","content":" Generated registration function:  pub fn register_types(fory: &amp;mut Fory) -&gt; Result&lt;(), fory::Error&gt; { fory.register_union::&lt;Animal&gt;(106)?; fory.register::&lt;person::PhoneType&gt;(101)?; fory.register::&lt;person::PhoneNumber&gt;(102)?; fory.register::&lt;Person&gt;(100)?; fory.register::&lt;Dog&gt;(104)?; fory.register::&lt;Cat&gt;(105)?; fory.register::&lt;AddressBook&gt;(103)?; Ok(()) }   For schemas without explicit [id=...], generated registration uses computed numeric IDs:  fory.register::&lt;Status&gt;(1124725126)?; fory.register_union::&lt;Wrapper&gt;(1471345060)?; fory.register::&lt;Envelope&gt;(3022445236)?; fory.register_union::&lt;envelope::Detail&gt;(1609214087)?; fory.register::&lt;envelope::Payload&gt;(2862577837)?;   If option enable_auto_type_id = false; is set:  fory.register_by_namespace::&lt;Config&gt;(&quot;myapp.models&quot;, &quot;Config&quot;)?; fory.register_union_by_namespace::&lt;Holder&gt;(&quot;myapp.models&quot;, &quot;Holder&quot;)?;   ","version":"0.15","tagName":"h3"},{"title":"Usage‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#usage-2","content":" let person = Person { name: &quot;Alice&quot;.into(), pet: Animal::Dog(Dog::default()), ..Default::default() }; let bytes = person.to_bytes()?; let restored = Person::from_bytes(&amp;bytes)?;   ","version":"0.15","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#c","content":" ","version":"0.15","tagName":"h2"},{"title":"Output Layout‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#output-layout-3","content":" C++ output is one header per schema file, for example:  &lt;cpp_out&gt;/addressbook.h  ","version":"0.15","tagName":"h3"},{"title":"Type Generation‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#type-generation-3","content":" Messages generate final classes with typed accessors and byte helpers:  class Person final { public: class PhoneNumber final { public: const std::string&amp; number() const; std::string* mutable_number(); template &lt;class Arg, class... Args&gt; void set_number(Arg&amp;&amp; arg, Args&amp;&amp;... args); fory::Result&lt;std::vector&lt;uint8_t&gt;, fory::Error&gt; to_bytes() const; static fory::Result&lt;PhoneNumber, fory::Error&gt; from_bytes(const std::vector&lt;uint8_t&gt;&amp; data); }; const std::string&amp; name() const; std::string* mutable_name(); template &lt;class Arg, class... Args&gt; void set_name(Arg&amp;&amp; arg, Args&amp;&amp;... args); const Animal&amp; pet() const; Animal* mutable_pet(); };   Optional message fields generate has_xxx, mutable_xxx, and clear_xxx APIs:  class Envelope final { public: bool has_payload() const { return payload_ != nullptr; } const Envelope::Payload&amp; payload() const { return *payload_; } Envelope::Payload* mutable_payload() { if (!payload_) { payload_ = std::make_unique&lt;Envelope::Payload&gt;(); } return payload_.get(); } void clear_payload() { payload_.reset(); } private: std::unique_ptr&lt;Envelope::Payload&gt; payload_; };   Unions generate std::variant wrappers:  class Animal final { public: enum class AnimalCase : uint32_t { DOG = 1, CAT = 2, }; static Animal dog(Dog v); static Animal cat(Cat v); AnimalCase animal_case() const noexcept; uint32_t animal_case_id() const noexcept; bool is_dog() const noexcept; const Dog* as_dog() const noexcept; Dog* as_dog() noexcept; const Dog&amp; dog() const; Dog&amp; dog(); template &lt;class Visitor&gt; decltype(auto) visit(Visitor&amp;&amp; vis) const; private: std::variant&lt;Dog, Cat&gt; value_; };   Generated headers also include FORY_UNION, FORY_FIELD_CONFIG, FORY_ENUM, and FORY_STRUCT macros for serialization metadata.  ","version":"0.15","tagName":"h3"},{"title":"Registration‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#registration-3","content":" Generated registration function:  inline void register_types(fory::serialization::BaseFory&amp; fory) { fory.register_union&lt;Animal&gt;(106); fory.register_enum&lt;Person::PhoneType&gt;(101); fory.register_struct&lt;Person::PhoneNumber&gt;(102); fory.register_struct&lt;Person&gt;(100); fory.register_struct&lt;Dog&gt;(104); fory.register_struct&lt;Cat&gt;(105); fory.register_struct&lt;AddressBook&gt;(103); }   For schemas without explicit [id=...], generated registration uses computed numeric IDs:  fory.register_enum&lt;Status&gt;(1124725126); fory.register_union&lt;Wrapper&gt;(1471345060); fory.register_struct&lt;Envelope&gt;(3022445236); fory.register_union&lt;Envelope::Detail&gt;(1609214087); fory.register_struct&lt;Envelope::Payload&gt;(2862577837);   If option enable_auto_type_id = false; is set:  fory.register_struct&lt;Config&gt;(&quot;myapp.models&quot;, &quot;Config&quot;); fory.register_union&lt;Holder&gt;(&quot;myapp.models&quot;, &quot;Holder&quot;);   ","version":"0.15","tagName":"h3"},{"title":"Usage‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#usage-3","content":" addressbook::Person person; person.set_name(&quot;Alice&quot;); *person.mutable_pet() = addressbook::Animal::dog(addressbook::Dog{}); auto bytes = person.to_bytes(); auto restored = addressbook::Person::from_bytes(bytes.value());   ","version":"0.15","tagName":"h3"},{"title":"Go‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#go","content":" ","version":"0.15","tagName":"h2"},{"title":"Output Layout‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#output-layout-4","content":" Go output path depends on schema options and --go_out.  For addressbook.fdl, go_package is configured and generated output follows the configured import path/package (for example under your --go_out root).  Without go_package, output uses the requested --go_out directory and package-derived file naming.  ","version":"0.15","tagName":"h3"},{"title":"Type Generation‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#type-generation-4","content":" Nested types use underscore naming by default (Person_PhoneType, Person_PhoneNumber):  type Person_PhoneType int32 const ( Person_PhoneTypeMobile Person_PhoneType = 0 Person_PhoneTypeHome Person_PhoneType = 1 Person_PhoneTypeWork Person_PhoneType = 2 ) type Person_PhoneNumber struct { Number string `fory:&quot;id=1&quot;` PhoneType Person_PhoneType `fory:&quot;id=2&quot;` }   Messages generate structs with fory tags and byte helpers:  type Person struct { Name string `fory:&quot;id=1&quot;` Id int32 `fory:&quot;id=2,compress=true&quot;` Phones []Person_PhoneNumber `fory:&quot;id=7&quot;` Pet Animal `fory:&quot;id=8&quot;` } func (m *Person) ToBytes() ([]byte, error) { ... } func (m *Person) FromBytes(data []byte) error { ... }   Unions generate typed case structs with constructors/accessors/visitor APIs:  type AnimalCase uint32 type Animal struct { case_ AnimalCase value any } func DogAnimal(v *Dog) Animal { ... } func CatAnimal(v *Cat) Animal { ... } func (u Animal) Case() AnimalCase { ... } func (u Animal) AsDog() (*Dog, bool) { ... } func (u Animal) Visit(visitor AnimalVisitor) error { ... }   ","version":"0.15","tagName":"h3"},{"title":"Registration‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#registration-4","content":" Generated registration function:  func RegisterTypes(f *fory.Fory) error { if err := f.RegisterUnion(Animal{}, 106, fory.NewUnionSerializer(...)); err != nil { return err } if err := f.RegisterEnum(Person_PhoneType(0), 101); err != nil { return err } if err := f.RegisterStruct(Person_PhoneNumber{}, 102); err != nil { return err } if err := f.RegisterStruct(Person{}, 100); err != nil { return err } return nil }   For schemas without explicit [id=...], generated registration uses computed numeric IDs:  if err := f.RegisterEnum(Status(0), 1124725126); err != nil { ... } if err := f.RegisterUnion(Wrapper{}, 1471345060, fory.NewUnionSerializer(...)); err != nil { ... } if err := f.RegisterStruct(Envelope{}, 3022445236); err != nil { ... } if err := f.RegisterUnion(Envelope_Detail{}, 1609214087, fory.NewUnionSerializer(...)); err != nil { ... } if err := f.RegisterStruct(Envelope_Payload{}, 2862577837); err != nil { ... }   If option enable_auto_type_id = false; is set:  if err := f.RegisterNamedStruct(Config{}, &quot;myapp.models.Config&quot;); err != nil { ... } if err := f.RegisterNamedUnion(Holder{}, &quot;myapp.models.Holder&quot;, fory.NewUnionSerializer(...)); err != nil { ... }   go_nested_type_style controls nested type naming:  option go_nested_type_style = &quot;camelcase&quot;;   ","version":"0.15","tagName":"h3"},{"title":"Usage‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#usage-4","content":" person := &amp;Person{ Name: &quot;Alice&quot;, Pet: DogAnimal(&amp;Dog{Name: &quot;Rex&quot;}), } data, err := person.ToBytes() if err != nil { panic(err) } var restored Person if err := restored.FromBytes(data); err != nil { panic(err) }   ","version":"0.15","tagName":"h3"},{"title":"Cross-Language Notes‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#cross-language-notes","content":" ","version":"0.15","tagName":"h2"},{"title":"Type ID Behavior‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#type-id-behavior","content":" Explicit [id=...] values are used directly in generated registration.When type IDs are omitted, generated code uses computed numeric IDs (see auto_id.* outputs).If option enable_auto_type_id = false; is set, generated registration uses namespace/type-name APIs instead of numeric IDs.  ","version":"0.15","tagName":"h3"},{"title":"Nested Type Shape‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#nested-type-shape","content":" Language\tNested type formJava\tPerson.PhoneNumber Python\tPerson.PhoneNumber Rust\tperson::PhoneNumber C++\tPerson::PhoneNumber Go\tPerson_PhoneNumber (default)  ","version":"0.15","tagName":"h3"},{"title":"Byte Helper Naming‚Äã","type":1,"pageTitle":"Generated Code","url":"/docs/compiler/generated_code#byte-helper-naming","content":" Language\tHelpersJava\ttoBytes / fromBytes Python\tto_bytes / from_bytes Rust\tto_bytes / from_bytes C++\tto_bytes / from_bytes Go\tToBytes / FromBytes ","version":"0.15","tagName":"h3"},{"title":"Cross-Language Serialization","type":0,"sectionRef":"#","url":"/docs/guide/cpp/cross_language","content":"","keywords":"","version":"0.15"},{"title":"Overview‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/cpp/cross_language#overview","content":" Apache Fory‚Ñ¢ enables seamless data exchange between C++, Java, Python, Go, Rust, and JavaScript. The xlang (cross-language) mode ensures binary compatibility across all supported languages.  ","version":"0.15","tagName":"h2"},{"title":"Enabling Cross-Language Mode‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/cpp/cross_language#enabling-cross-language-mode","content":" #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; auto fory = Fory::builder() .xlang(true) // Enable cross-language mode .build();   ","version":"0.15","tagName":"h2"},{"title":"Cross-Language Example‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/cpp/cross_language#cross-language-example","content":" ","version":"0.15","tagName":"h2"},{"title":"C++ Producer‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/cpp/cross_language#c-producer","content":" #include &quot;fory/serialization/fory.h&quot; #include &lt;fstream&gt; using namespace fory::serialization; struct Message { std::string topic; int64_t timestamp; std::map&lt;std::string, std::string&gt; headers; std::vector&lt;uint8_t&gt; payload; bool operator==(const Message &amp;other) const { return topic == other.topic &amp;&amp; timestamp == other.timestamp &amp;&amp; headers == other.headers &amp;&amp; payload == other.payload; } }; FORY_STRUCT(Message, topic, timestamp, headers, payload); int main() { auto fory = Fory::builder().xlang(true).build(); fory.register_struct&lt;Message&gt;(100); Message msg{ &quot;events.user&quot;, 1699999999000, {{&quot;content-type&quot;, &quot;application/json&quot;}}, {'h', 'e', 'l', 'l', 'o'} }; auto result = fory.serialize(msg); if (result.ok()) { auto bytes = std::move(result).value(); // write to file, send over network, etc. std::ofstream file(&quot;message.bin&quot;, std::ios::binary); file.write(reinterpret_cast&lt;const char*&gt;(bytes.data()), bytes.size()); } return 0; }   ","version":"0.15","tagName":"h3"},{"title":"Java Consumer‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/cpp/cross_language#java-consumer","content":" import org.apache.fory.Fory; import org.apache.fory.config.Language; public class Message { public String topic; public long timestamp; public Map&lt;String, String&gt; headers; public byte[] payload; } public class Consumer { public static void main(String[] args) throws Exception { Fory fory = Fory.builder() .withLanguage(Language.XLANG) .build(); fory.register(Message.class, 100); // Same ID as C++ byte[] bytes = Files.readAllBytes(Path.of(&quot;message.bin&quot;)); Message msg = (Message) fory.deserialize(bytes); System.out.println(&quot;Topic: &quot; + msg.topic); System.out.println(&quot;Timestamp: &quot; + msg.timestamp); } }   ","version":"0.15","tagName":"h3"},{"title":"Python Consumer‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/cpp/cross_language#python-consumer","content":" import pyfory class Message: topic: str timestamp: int headers: dict[str, str] payload: bytes fory = pyfory.Fory(xlang=True) fory.register(Message, type_id=100) # Same ID as C++ with open(&quot;message.bin&quot;, &quot;rb&quot;) as f: data = f.read() msg = fory.deserialize(data) print(f&quot;Topic: {msg.topic}&quot;) print(f&quot;Timestamp: {msg.timestamp}&quot;)   ","version":"0.15","tagName":"h3"},{"title":"Type Mapping‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/cpp/cross_language#type-mapping","content":" ","version":"0.15","tagName":"h2"},{"title":"Primitive Types‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/cpp/cross_language#primitive-types","content":" C++ Type\tJava Type\tPython Type\tGo Type\tRust Typebool\tboolean\tbool\tbool\tbool int8_t\tbyte\tint\tint8\ti8 int16_t\tshort\tint\tint16\ti16 int32_t\tint\tint\tint32\ti32 int64_t\tlong\tint\tint64\ti64 float\tfloat\tfloat\tfloat32\tf32 double\tdouble\tfloat\tfloat64\tf64  ","version":"0.15","tagName":"h3"},{"title":"String Types‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/cpp/cross_language#string-types","content":" C++ Type\tJava Type\tPython Type\tGo Type\tRust Typestd::string\tString\tstr\tstring\tString  ","version":"0.15","tagName":"h3"},{"title":"Collection Types‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/cpp/cross_language#collection-types","content":" C++ Type\tJava Type\tPython Type\tGo Typestd::vector&lt;T&gt;\tList&lt;T&gt;\tlist\t[]T std::set&lt;T&gt;\tSet&lt;T&gt;\tset\tmap[T]struct{} std::map&lt;K,V&gt;\tMap&lt;K,V&gt;\tdict\tmap[K]V  ","version":"0.15","tagName":"h3"},{"title":"Temporal Types‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/cpp/cross_language#temporal-types","content":" C++ Type\tJava Type\tPython Type\tGo TypeTimestamp\tInstant\tdatetime\ttime.Time Duration\tDuration\ttimedelta\ttime.Duration Date\tLocalDate\tdatetime.date\ttime.Time  ","version":"0.15","tagName":"h3"},{"title":"Field Order Requirements‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/cpp/cross_language#field-order-requirements","content":" Critical: Fields are sorted by snake_case field name. The converted names must match across languages.  ","version":"0.15","tagName":"h2"},{"title":"C++‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/cpp/cross_language#c","content":" struct Person { std::string name; // Field 0 int32_t age; // Field 1 std::string email; // Field 2 }; FORY_STRUCT(Person, name, age, email); // Order matters!   ","version":"0.15","tagName":"h3"},{"title":"Java‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/cpp/cross_language#java","content":" public class Person { public String name; // Field 0 public int age; // Field 1 public String email; // Field 2 }   ","version":"0.15","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/cpp/cross_language#python","content":" class Person: name: str # Field 0 age: int # Field 1 email: str # Field 2   ","version":"0.15","tagName":"h3"},{"title":"Type ID Consistency‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/cpp/cross_language#type-id-consistency","content":" All languages must use the same type IDs:  // C++ fory.register_struct&lt;Person&gt;(100); fory.register_struct&lt;Address&gt;(101); fory.register_struct&lt;Order&gt;(102);   // Java fory.register(Person.class, 100); fory.register(Address.class, 101); fory.register(Order.class, 102);   # Python fory.register(Person, type_id=100) fory.register(Address, type_id=101) fory.register(Order, type_id=102)   ","version":"0.15","tagName":"h2"},{"title":"Compatible Mode‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/cpp/cross_language#compatible-mode","content":" For schema evolution across language boundaries:  // C++ with compatible mode auto fory = Fory::builder() .xlang(true) .compatible(true) // Enable schema evolution .build();   Compatible mode allows:  Adding new fields (with defaults)Removing unused fieldsReordering fields  ","version":"0.15","tagName":"h2"},{"title":"Troubleshooting‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/cpp/cross_language#troubleshooting","content":" ","version":"0.15","tagName":"h2"},{"title":"Type Mismatch Errors‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/cpp/cross_language#type-mismatch-errors","content":" Error: Type mismatch: expected 100, got 101   Solution: Ensure type IDs match across all languages.  ","version":"0.15","tagName":"h3"},{"title":"Encoding Errors‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/cpp/cross_language#encoding-errors","content":" Error: Invalid UTF-8 sequence   Solution: Ensure strings are valid UTF-8 in all languages.  ","version":"0.15","tagName":"h3"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/cpp/cross_language#related-topics","content":" Configuration - Builder optionsType Registration - Registering typesSupported Types - Type compatibility ","version":"0.15","tagName":"h2"},{"title":"Custom Serializers","type":0,"sectionRef":"#","url":"/docs/guide/cpp/custom_serializers","content":"","keywords":"","version":"0.15"},{"title":"When to Use Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/cpp/custom_serializers#when-to-use-custom-serializers","content":" External types from third-party librariesTypes with special serialization requirementsLegacy data format compatibilityPerformance-critical custom encodingCross-language interoperability with custom protocols  ","version":"0.15","tagName":"h2"},{"title":"Implementing the Serializer Template‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/cpp/custom_serializers#implementing-the-serializer-template","content":" To create a custom serializer, specialize the Serializer template for your type within the fory::serialization namespace:  #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; // Define your custom type struct MyExt { int32_t id; bool operator==(const MyExt &amp;other) const { return id == other.id; } }; namespace fory { namespace serialization { template &lt;&gt; struct Serializer&lt;MyExt&gt; { // Declare as extension type for custom serialization static constexpr TypeId type_id = TypeId::EXT; // Main write method - handles null checking and type info static void write(const MyExt &amp;value, WriteContext &amp;ctx, RefMode ref_mode, bool write_type, bool has_generics = false) { (void)has_generics; write_not_null_ref_flag(ctx, ref_mode); if (write_type) { auto result = ctx.write_any_type_info( static_cast&lt;uint32_t&gt;(TypeId::UNKNOWN), std::type_index(typeid(MyExt))); if (!result.ok()) { ctx.set_error(std::move(result).error()); return; } } write_data(value, ctx); } // write only the data (no type info) static void write_data(const MyExt &amp;value, WriteContext &amp;ctx) { Serializer&lt;int32_t&gt;::write_data(value.id, ctx); } // write data with generics support static void write_data_generic(const MyExt &amp;value, WriteContext &amp;ctx, bool has_generics) { (void)has_generics; write_data(value, ctx); } // Main read method - handles null checking and type info static MyExt read(ReadContext &amp;ctx, RefMode ref_mode, bool read_type) { bool has_value = read_null_only_flag(ctx, ref_mode); if (ctx.has_error() || !has_value) { return MyExt{}; } if (read_type) { const TypeInfo *type_info = ctx.read_any_type_info(ctx.error()); if (ctx.has_error()) { return MyExt{}; } if (!type_info) { ctx.set_error(Error::type_error(&quot;TypeInfo for MyExt not found&quot;)); return MyExt{}; } } return read_data(ctx); } // Read only the data (no type info) static MyExt read_data(ReadContext &amp;ctx) { MyExt value; value.id = Serializer&lt;int32_t&gt;::read_data(ctx); return value; } // Read data with generics support static MyExt read_data_generic(ReadContext &amp;ctx, bool has_generics) { (void)has_generics; return read_data(ctx); } // Read with pre-resolved type info static MyExt read_with_type_info(ReadContext &amp;ctx, RefMode ref_mode, const TypeInfo &amp;type_info) { (void)type_info; return read(ctx, ref_mode, false); } }; } // namespace serialization } // namespace fory   ","version":"0.15","tagName":"h2"},{"title":"Required Methods‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/cpp/custom_serializers#required-methods","content":" A custom serializer must implement these static methods:  Method\tPurposewrite\tMain serialization entry point with type info write_data\tSerialize data only (no type info) write_data_generic\tSerialize data with generics support read\tMain deserialization entry point with type info read_data\tDeserialize data only (no type info) read_data_generic\tDeserialize data with generics support read_with_type_info\tDeserialize with pre-resolved TypeInfo  The type_id constant should be set to TypeId::EXT for custom extension types.  ","version":"0.15","tagName":"h2"},{"title":"Registering Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/cpp/custom_serializers#registering-custom-serializers","content":" Register your custom serializer with Fory before use:  auto fory = Fory::builder().xlang(true).build(); // Register with numeric type ID (must match across languages) auto result = fory.register_extension_type&lt;MyExt&gt;(103); if (!result.ok()) { std::cerr &lt;&lt; &quot;Failed to register: &quot; &lt;&lt; result.error().to_string() &lt;&lt; std::endl; } // Or register with type name for named type systems fory.register_extension_type&lt;MyExt&gt;(&quot;my_ext&quot;); // Or with namespace and type name fory.register_extension_type&lt;MyExt&gt;(&quot;com.example&quot;, &quot;MyExt&quot;);   ","version":"0.15","tagName":"h2"},{"title":"Complete Example‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/cpp/custom_serializers#complete-example","content":" #include &quot;fory/serialization/fory.h&quot; #include &lt;iostream&gt; using namespace fory::serialization; struct CustomType { int32_t value; std::string name; bool operator==(const CustomType &amp;other) const { return value == other.value &amp;&amp; name == other.name; } }; namespace fory { namespace serialization { template &lt;&gt; struct Serializer&lt;CustomType&gt; { static constexpr TypeId type_id = TypeId::EXT; static void write(const CustomType &amp;value, WriteContext &amp;ctx, RefMode ref_mode, bool write_type, bool has_generics = false) { (void)has_generics; write_not_null_ref_flag(ctx, ref_mode); if (write_type) { auto result = ctx.write_any_type_info( static_cast&lt;uint32_t&gt;(TypeId::UNKNOWN), std::type_index(typeid(CustomType))); if (!result.ok()) { ctx.set_error(std::move(result).error()); return; } } write_data(value, ctx); } static void write_data(const CustomType &amp;value, WriteContext &amp;ctx) { // write value as varint for compact encoding Serializer&lt;int32_t&gt;::write_data(value.value, ctx); // Delegate string serialization to built-in serializer Serializer&lt;std::string&gt;::write_data(value.name, ctx); } static void write_data_generic(const CustomType &amp;value, WriteContext &amp;ctx, bool has_generics) { (void)has_generics; write_data(value, ctx); } static CustomType read(ReadContext &amp;ctx, RefMode ref_mode, bool read_type) { bool has_value = read_null_only_flag(ctx, ref_mode); if (ctx.has_error() || !has_value) { return CustomType{}; } if (read_type) { const TypeInfo *type_info = ctx.read_any_type_info(ctx.error()); if (ctx.has_error()) { return CustomType{}; } if (!type_info) { ctx.set_error(Error::type_error(&quot;TypeInfo for CustomType not found&quot;)); return CustomType{}; } } return read_data(ctx); } static CustomType read_data(ReadContext &amp;ctx) { CustomType value; value.value = Serializer&lt;int32_t&gt;::read_data(ctx); value.name = Serializer&lt;std::string&gt;::read_data(ctx); return value; } static CustomType read_data_generic(ReadContext &amp;ctx, bool has_generics) { (void)has_generics; return read_data(ctx); } static CustomType read_with_type_info(ReadContext &amp;ctx, RefMode ref_mode, const TypeInfo &amp;type_info) { (void)type_info; return read(ctx, ref_mode, false); } }; } // namespace serialization } // namespace fory int main() { auto fory = Fory::builder().xlang(true).build(); fory.register_extension_type&lt;CustomType&gt;(100); CustomType original{42, &quot;test&quot;}; auto serialized = fory.serialize(original); if (!serialized.ok()) { std::cerr &lt;&lt; &quot;Serialization failed&quot; &lt;&lt; std::endl; return 1; } auto deserialized = fory.deserialize&lt;CustomType&gt;(serialized.value()); if (!deserialized.ok()) { std::cerr &lt;&lt; &quot;Deserialization failed&quot; &lt;&lt; std::endl; return 1; } assert(original == deserialized.value()); std::cout &lt;&lt; &quot;Custom serializer works!&quot; &lt;&lt; std::endl; return 0; }   ","version":"0.15","tagName":"h2"},{"title":"WriteContext Methods‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/cpp/custom_serializers#writecontext-methods","content":" The WriteContext provides methods for writing data:  // Primitive types ctx.write_uint8(value); ctx.write_int8(value); ctx.write_uint16(value); // Variable-length integers (compact encoding) ctx.write_var_uint32(value); // Unsigned varint ctx.write_varint32(value); // Signed zigzag varint ctx.write_var_uint64(value); // Unsigned varint ctx.write_varint64(value); // Signed zigzag varint // Tagged integers (for mixed-size encoding) ctx.write_tagged_uint64(value); ctx.write_tagged_int64(value); // Raw bytes ctx.write_bytes(data_ptr, length); // Access underlying buffer for advanced operations ctx.buffer().write_int32(value); ctx.buffer().write_float(value); ctx.buffer().write_double(value);   ","version":"0.15","tagName":"h2"},{"title":"ReadContext Methods‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/cpp/custom_serializers#readcontext-methods","content":" The ReadContext provides methods for reading data:  // Primitive types (use error reference pattern) uint8_t u8 = ctx.read_uint8(ctx.error()); int8_t i8 = ctx.read_int8(ctx.error()); // Variable-length integers uint32_t u32 = ctx.read_var_uint32(ctx.error()); int32_t i32 = ctx.read_varint32(ctx.error()); uint64_t u64 = ctx.read_var_uint64(ctx.error()); int64_t i64 = ctx.read_varint64(ctx.error()); // Check for errors after read operations if (ctx.has_error()) { return MyType{}; // Return default on error } // Access underlying buffer for advanced operations int32_t value = ctx.buffer().read_int32(ctx.error()); float f = ctx.buffer().read_float(ctx.error()); double d = ctx.buffer().read_double(ctx.error());   ","version":"0.15","tagName":"h2"},{"title":"Delegating to Built-in Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/cpp/custom_serializers#delegating-to-built-in-serializers","content":" Reuse existing serializers for nested types:  static void write_data(const MyType &amp;value, WriteContext &amp;ctx) { // Delegate to built-in serializers Serializer&lt;int32_t&gt;::write_data(value.int_field, ctx); Serializer&lt;std::string&gt;::write_data(value.string_field, ctx); Serializer&lt;std::vector&lt;int32_t&gt;&gt;::write_data(value.vec_field, ctx); } static MyType read_data(ReadContext &amp;ctx) { MyType value; value.int_field = Serializer&lt;int32_t&gt;::read_data(ctx); value.string_field = Serializer&lt;std::string&gt;::read_data(ctx); value.vec_field = Serializer&lt;std::vector&lt;int32_t&gt;&gt;::read_data(ctx); return value; }   ","version":"0.15","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/cpp/custom_serializers#best-practices","content":" Use variable-length encoding for integers that may be smallCheck errors after read operations using ctx.has_error()Return default values on error to maintain consistent behaviorDelegate to built-in serializers for standard typesMatch type IDs across languages for cross-language compatibilityUse (void)param to suppress unused parameter warnings  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/cpp/custom_serializers#related-topics","content":" Type Registration - Registering serializersBasic Serialization - Using FORY_STRUCT macroSchema Evolution - Compatible modeCross-Language - Cross-language serialization ","version":"0.15","tagName":"h2"},{"title":"Schema IDL","type":0,"sectionRef":"#","url":"/docs/compiler/syntax","content":"","keywords":"","version":"0.15"},{"title":"File Structure‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#file-structure","content":" An Fory IDL file typically consists of:  Optional package declarationOptional file-level optionsOptional import statementsType definitions (enums, messages, and unions)  // Optional package declaration package com.example.models; // Optional file-level options option java_package = &quot;com.example.models&quot;; // Import statements import &quot;common/types.fdl&quot;; // Type definitions enum Color [id=100] { ... } message User [id=101] { ... } message Order [id=102] { ... } union Event [id=103] { ... }   ","version":"0.15","tagName":"h2"},{"title":"Comments‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#comments","content":" Fory IDL supports both single-line and block comments:  // This is a single-line comment /* * This is a block comment * that spans multiple lines */ message Example { string name = 1; // Inline comment }   ","version":"0.15","tagName":"h2"},{"title":"Package Declaration‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#package-declaration","content":" The package declaration defines the namespace for all types in the file.  package com.example.models;   You can optionally specify a package alias used for auto-generated type IDs:  package com.example.models alias models_v1;   Rules:  Optional but recommendedMust appear before any type definitionsOnly one package declaration per fileUsed for namespace-based type registrationPackage alias is used for auto-ID hashing  Language Mapping:  Language\tPackage UsageJava\tJava package Python\tModule name (dots to underscores) Go\tPackage name (last component) Rust\tModule name (dots to underscores) C++\tNamespace (dots to ::)  ","version":"0.15","tagName":"h2"},{"title":"File-Level Options‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#file-level-options","content":" Options can be specified at file level to control language-specific code generation.  ","version":"0.15","tagName":"h2"},{"title":"Syntax‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#syntax","content":" option option_name = value;   ","version":"0.15","tagName":"h3"},{"title":"Java Package Option‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#java-package-option","content":" Override the Java package for generated code:  package payment; option java_package = &quot;com.mycorp.payment.v1&quot;; message Payment { string id = 1; }   Effect:  Generated Java files will be in com/mycorp/payment/v1/ directoryJava package declaration will be package com.mycorp.payment.v1;Type registration still uses the Fory IDL package (payment) for cross-language compatibility  ","version":"0.15","tagName":"h3"},{"title":"Go Package Option‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#go-package-option","content":" Specify the Go import path and package name:  package payment; option go_package = &quot;github.com/mycorp/apis/gen/payment/v1;paymentv1&quot;; message Payment { string id = 1; }   Format: &quot;import/path;package_name&quot; or just &quot;import/path&quot; (last segment used as package name)  Effect:  Generated Go files will have package paymentv1The import path can be used in other Go codeType registration still uses the Fory IDL package (payment) for cross-language compatibility  ","version":"0.15","tagName":"h3"},{"title":"Java Outer Classname Option‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#java-outer-classname-option","content":" Generate all types as inner classes of a single outer wrapper class:  package payment; option java_outer_classname = &quot;DescriptorProtos&quot;; enum Status { UNKNOWN = 0; ACTIVE = 1; } message Payment { string id = 1; Status status = 2; }   Effect:  Generates a single file DescriptorProtos.java instead of separate filesAll enums and messages become public static inner classesThe outer class is public final with a private constructorUseful for grouping related types together  Generated structure:  public final class DescriptorProtos { private DescriptorProtos() {} public static enum Status { UNKNOWN, ACTIVE; } public static class Payment { private String id; private Status status; // ... } }   Combined with java_package:  package payment; option java_package = &quot;com.example.proto&quot;; option java_outer_classname = &quot;PaymentProtos&quot;; message Payment { string id = 1; }   This generates com/example/proto/PaymentProtos.java with all types as inner classes.  ","version":"0.15","tagName":"h3"},{"title":"Java Multiple Files Option‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#java-multiple-files-option","content":" Control whether types are generated in separate files or as inner classes:  package payment; option java_outer_classname = &quot;PaymentProtos&quot;; option java_multiple_files = true; message Payment { string id = 1; } message Receipt { string id = 1; }   Behavior:  java_outer_classname\tjava_multiple_files\tResultNot set\tAny\tSeparate files (one per type) Set\tfalse (default)\tSingle file with all types as inner classes Set\ttrue\tSeparate files (overrides outer class)  Effect of java_multiple_files = true:  Each top-level enum and message gets its own .java fileOverrides java_outer_classname behaviorUseful when you want separate files but still specify an outer class name for other purposes  Example without java_multiple_files (default):  option java_outer_classname = &quot;PaymentProtos&quot;; // Generates: PaymentProtos.java containing Payment and Receipt as inner classes   Example with java_multiple_files = true:  option java_outer_classname = &quot;PaymentProtos&quot;; option java_multiple_files = true; // Generates: Payment.java, Receipt.java (separate files)   ","version":"0.15","tagName":"h3"},{"title":"Multiple Options‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#multiple-options","content":" Multiple options can be specified:  package payment; option java_package = &quot;com.mycorp.payment.v1&quot;; option go_package = &quot;github.com/mycorp/apis/gen/payment/v1;paymentv1&quot;; option deprecated = true; message Payment { string id = 1; }   ","version":"0.15","tagName":"h3"},{"title":"Protobuf Extension Syntax‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#protobuf-extension-syntax","content":" In .fdl files, use native Fory IDL syntax only (for example, [id=100], ref,optional, nullable=true).  Protobuf extension syntax with (fory). is for .proto files and the protobuf frontend only.  For protobuf extension options, seeProtocol Buffers IDL Support.  ","version":"0.15","tagName":"h3"},{"title":"Option Priority‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#option-priority","content":" For language-specific packages:  Command-line package override (highest priority)Language-specific option (java_package, go_package)Fory IDL package declaration (fallback)  Example:  package myapp.models; option java_package = &quot;com.example.generated&quot;;   Scenario\tJava Package UsedNo override\tcom.example.generated CLI: --package=override\toverride No java_package option\tmyapp.models (fallback)  ","version":"0.15","tagName":"h3"},{"title":"Cross-Language Type Registration‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#cross-language-type-registration","content":" Language-specific options only affect where code is generated, not the type namespace used for serialization. This ensures cross-language compatibility:  package myapp.models; option java_package = &quot;com.mycorp.generated&quot;; option go_package = &quot;github.com/mycorp/gen;genmodels&quot;; message User { string name = 1; }   All languages will register User with namespace myapp.models, enabling:  Java serialized data ‚Üí Go deserializationGo serialized data ‚Üí Java deserializationAny language combination works seamlessly  ","version":"0.15","tagName":"h3"},{"title":"Import Statement‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#import-statement","content":" Import statements allow you to use types defined in other Fory IDL files.  ","version":"0.15","tagName":"h2"},{"title":"Basic Syntax‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#basic-syntax","content":" import &quot;path/to/file.fdl&quot;;   ","version":"0.15","tagName":"h3"},{"title":"Multiple Imports‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#multiple-imports","content":" import &quot;common/types.fdl&quot;; import &quot;common/enums.fdl&quot;; import &quot;models/address.fdl&quot;;   ","version":"0.15","tagName":"h3"},{"title":"Path Resolution‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#path-resolution","content":" Import paths are resolved relative to the importing file:  project/ ‚îú‚îÄ‚îÄ common/ ‚îÇ ‚îî‚îÄ‚îÄ types.fdl ‚îú‚îÄ‚îÄ models/ ‚îÇ ‚îú‚îÄ‚îÄ user.fdl # import &quot;../common/types.fdl&quot; ‚îÇ ‚îî‚îÄ‚îÄ order.fdl # import &quot;../common/types.fdl&quot; ‚îî‚îÄ‚îÄ main.fdl # import &quot;common/types.fdl&quot;   Rules:  Import paths are quoted strings (double or single quotes)Paths are resolved relative to the importing file's directoryImported types become available as if defined in the current fileCircular imports are detected and reported as errorsTransitive imports work (if A imports B and B imports C, A has access to C's types)  ","version":"0.15","tagName":"h3"},{"title":"Complete Example‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#complete-example","content":" common/types.fdl:  package common; enum Status [id=100] { PENDING = 0; ACTIVE = 1; COMPLETED = 2; } message Address [id=101] { string street = 1; string city = 2; string country = 3; }   models/user.fdl:  package models; import &quot;../common/types.fdl&quot;; message User [id=200] { string id = 1; string name = 2; Address home_address = 3; // Uses imported type Status status = 4; // Uses imported enum }   ","version":"0.15","tagName":"h3"},{"title":"Unsupported Import Syntax‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#unsupported-import-syntax","content":" The following protobuf import modifiers are not supported:  // NOT SUPPORTED - will produce an error import public &quot;other.fdl&quot;; import weak &quot;other.fdl&quot;;   import public: Fory IDL uses a simpler import model. All imported types are available to the importing file only. Re-exporting is not supported. Import each file directly where needed.  import weak: Fory IDL requires all imports to be present at compile time. Optional dependencies are not supported.  ","version":"0.15","tagName":"h3"},{"title":"Import Errors‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#import-errors","content":" The compiler reports errors for:  File not found: The imported file doesn't existCircular import: A imports B which imports A (directly or indirectly)Parse errors: Syntax errors in imported filesUnsupported syntax: import public or import weak  ","version":"0.15","tagName":"h3"},{"title":"Enum Definition‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#enum-definition","content":" Enums define a set of named integer constants.  ","version":"0.15","tagName":"h2"},{"title":"Basic Syntax‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#basic-syntax-1","content":" enum Status { PENDING = 0; ACTIVE = 1; COMPLETED = 2; }   ","version":"0.15","tagName":"h3"},{"title":"With Explicit Type ID‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#with-explicit-type-id","content":" enum Status [id=100] { PENDING = 0; ACTIVE = 1; COMPLETED = 2; }   ","version":"0.15","tagName":"h3"},{"title":"Reserved Values‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#reserved-values","content":" Reserve field numbers or names to prevent reuse:  enum Status { reserved 2, 15, 9 to 11, 40 to max; // Reserved numbers reserved &quot;OLD_STATUS&quot;, &quot;DEPRECATED&quot;; // Reserved names PENDING = 0; ACTIVE = 1; COMPLETED = 3; }   ","version":"0.15","tagName":"h3"},{"title":"Enum Type Options‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#enum-type-options","content":" Enum-level options are declared inline in [] after the enum name:  enum Status [deprecated=true] { PENDING = 0; ACTIVE = 1; }   FDL does not support option ...; statements inside enum bodies.  Unsupported:  allow_alias is not supported. Each enum value must have a unique integer.  ","version":"0.15","tagName":"h3"},{"title":"Language Mapping‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#language-mapping","content":" Language\tImplementationJava\tenum Status { UNKNOWN, ACTIVE, ... } Python\tclass Status(IntEnum): UNKNOWN = 0 Go\ttype Status int32 with constants Rust\t#[repr(i32)] enum Status { Unknown } C++\tenum class Status : int32_t { ... }  ","version":"0.15","tagName":"h3"},{"title":"Enum Prefix Stripping‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#enum-prefix-stripping","content":" When enum values use a protobuf-style prefix (enum name in UPPER_SNAKE_CASE), the compiler automatically strips the prefix for languages with scoped enums:  // Input with prefix enum DeviceTier { DEVICE_TIER_UNKNOWN = 0; DEVICE_TIER_TIER1 = 1; DEVICE_TIER_TIER2 = 2; }   Generated code:  Language\tOutput\tStyleJava\tUNKNOWN, TIER1, TIER2\tScoped enum Rust\tUnknown, Tier1, Tier2\tScoped enum C++\tUNKNOWN, TIER1, TIER2\tScoped enum Python\tUNKNOWN, TIER1, TIER2\tScoped IntEnum Go\tDeviceTierUnknown, DeviceTierTier1, ...\tUnscoped const  Note: The prefix is only stripped if the remainder is a valid identifier. For example, DEVICE_TIER_1 is kept unchanged because 1 is not a valid identifier name.  Grammar:  enum_def := 'enum' IDENTIFIER [type_options] '{' enum_body '}' type_options := '[' type_option (',' type_option)* ']' type_option := IDENTIFIER '=' option_value enum_body := (reserved_stmt | enum_value)* reserved_stmt := 'reserved' reserved_items ';' enum_value := IDENTIFIER '=' INTEGER ';'   Rules:  Enum names must be unique within the fileEnum values must have explicit integer assignmentsValue integers must be unique within the enum (no aliases)Type ID ([id=100]) is optional for enums but recommended for cross-language use  Example with All Features:  // HTTP status code categories enum HttpCategory [id=200] { reserved 10 to 20; // Reserved for future use reserved &quot;UNKNOWN&quot;; // Reserved name INFORMATIONAL = 1; SUCCESS = 2; REDIRECTION = 3; CLIENT_ERROR = 4; SERVER_ERROR = 5; }   ","version":"0.15","tagName":"h3"},{"title":"Message Definition‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#message-definition","content":" Messages define structured data types with typed fields.  ","version":"0.15","tagName":"h2"},{"title":"Basic Syntax‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#basic-syntax-2","content":" message Person { string name = 1; int32 age = 2; }   ","version":"0.15","tagName":"h3"},{"title":"With Explicit Type ID‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#with-explicit-type-id-1","content":" message Person [id=101] { string name = 1; int32 age = 2; }   ","version":"0.15","tagName":"h3"},{"title":"Without Explicit Type ID‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#without-explicit-type-id","content":" message Person { // Auto-generated when enable_auto_type_id = true string name = 1; int32 age = 2; }   ","version":"0.15","tagName":"h3"},{"title":"Language Mapping‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#language-mapping-1","content":" Language\tImplementationJava\tPOJO class with getters/setters Python\t@dataclass class Go\tStruct with exported fields Rust\tStruct with #[derive(ForyObject)] C++\tStruct with FORY_STRUCT macro  Type IDs control cross-language registration for messages, unions, and enums. SeeType IDs for auto-generation, aliases, and collision handling.  ","version":"0.15","tagName":"h3"},{"title":"Reserved Fields‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#reserved-fields","content":" Reserve field numbers or names to prevent reuse after removing fields:  message User { reserved 2, 15, 9 to 11; // Reserved field numbers reserved &quot;old_field&quot;, &quot;temp&quot;; // Reserved field names string id = 1; string name = 3; }   ","version":"0.15","tagName":"h3"},{"title":"Message Type Options‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#message-type-options","content":" Message-level options are declared inline in [] after the message name:  message User [deprecated=true] { string id = 1; string name = 2; }   FDL does not support option ...; statements inside message or enum bodies.  Grammar:  message_def := 'message' IDENTIFIER [type_options] '{' message_body '}' type_options := '[' type_option (',' type_option)* ']' type_option := IDENTIFIER '=' option_value message_body := (reserved_stmt | nested_type | field_def)* nested_type := enum_def | message_def | union_def   Rules:  Type IDs follow the rules in Type IDs.  ","version":"0.15","tagName":"h3"},{"title":"Nested Types‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#nested-types","content":" Messages can contain nested message, enum, and union definitions. This is useful for defining types that are closely related to their parent message.  ","version":"0.15","tagName":"h2"},{"title":"Nested Messages‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#nested-messages","content":" message SearchResponse { message Result { string url = 1; string title = 2; list&lt;string&gt; snippets = 3; } list&lt;Result&gt; results = 1; }   ","version":"0.15","tagName":"h3"},{"title":"Nested Enums‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#nested-enums","content":" message Container { enum Status { STATUS_UNKNOWN = 0; STATUS_ACTIVE = 1; STATUS_INACTIVE = 2; } Status status = 1; }   ","version":"0.15","tagName":"h3"},{"title":"Qualified Type Names‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#qualified-type-names","content":" Nested types can be referenced from other messages using qualified names (Parent.Child):  message SearchResponse { message Result { string url = 1; string title = 2; } } message SearchResultCache { // Reference nested type with qualified name SearchResponse.Result cached_result = 1; list&lt;SearchResponse.Result&gt; all_results = 2; }   ","version":"0.15","tagName":"h3"},{"title":"Deeply Nested Types‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#deeply-nested-types","content":" Nesting can be multiple levels deep:  message Outer { message Middle { message Inner { string value = 1; } Inner inner = 1; } Middle middle = 1; } message OtherMessage { // Reference deeply nested type Outer.Middle.Inner deep_ref = 1; }   ","version":"0.15","tagName":"h3"},{"title":"Language-Specific Generation‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#language-specific-generation","content":" Language\tNested Type GenerationJava\tStatic inner classes (SearchResponse.Result) Python\tNested classes within dataclass Go\tFlat structs with underscore (SearchResponse_Result, configurable to camelcase) Rust\tNested modules (search_response::Result) C++\tNested classes (SearchResponse::Result)  Note: Go defaults to underscore-separated nested names; set option go_nested_type_style = &quot;camelcase&quot;; to use concatenated names. Rust emits nested modules for nested types.  ","version":"0.15","tagName":"h3"},{"title":"Nested Type Rules‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#nested-type-rules","content":" Nested type names must be unique within their parent messageNested types can have their own type IDsNumeric type IDs must be globally unique (including nested types); see Type IDsfor auto-generation and collision handlingWithin a message, you can reference nested types by simple nameFrom outside, use the qualified name (Parent.Child)  ","version":"0.15","tagName":"h3"},{"title":"Union Definition‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#union-definition","content":" Unions define a value that can hold exactly one of several case types.  ","version":"0.15","tagName":"h2"},{"title":"Basic Syntax‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#basic-syntax-3","content":" union Animal [id=106] { Dog dog = 1; Cat cat = 2; }   ","version":"0.15","tagName":"h3"},{"title":"Using a Union in a Message‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#using-a-union-in-a-message","content":" message Person [id=100] { Animal pet = 1; optional Animal favorite_pet = 2; }   ","version":"0.15","tagName":"h3"},{"title":"Rules‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#rules","content":" Case IDs must be unique within the unionCases cannot be optional or refUnion cases do not support field optionsCase types can be primitives, enums, messages, or other named typesUnion type IDs follow the rules in Type IDs.  Grammar:  union_def := 'union' IDENTIFIER [type_options] '{' union_field* '}' union_field := field_type IDENTIFIER '=' INTEGER ';'   ","version":"0.15","tagName":"h3"},{"title":"Field Definition‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#field-definition","content":" Fields define the properties of a message.  ","version":"0.15","tagName":"h2"},{"title":"Basic Syntax‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#basic-syntax-4","content":" field_type field_name = field_number;   ","version":"0.15","tagName":"h3"},{"title":"With Modifiers‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#with-modifiers","content":" optional list&lt;string&gt; tags = 1; // Nullable list list&lt;optional string&gt; tags = 2; // Elements may be null ref list&lt;Node&gt; nodes = 3; // Collection tracked as a reference list&lt;ref Node&gt; nodes = 4; // Elements tracked as references   Grammar:  field_def := [modifiers] field_type IDENTIFIER '=' INTEGER ';' modifiers := { 'optional' | 'ref' } field_type := primitive_type | named_type | list_type | map_type list_type := 'list' '&lt;' { 'optional' | 'ref' } field_type '&gt;'   Modifiers apply to the field/collection. Use list&lt;...&gt; to describe element modifiers. repeated is accepted as an alias for list.  ","version":"0.15","tagName":"h3"},{"title":"Field Modifiers‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#field-modifiers","content":" optional‚Äã  Marks the field as nullable:  message User { string name = 1; // Required, non-null optional string email = 2; // Nullable }   Generated Code:  Language\tNon-optional\tOptionalJava\tString name\tString email with @ForyField(nullable=true) Python\tname: str\tname: Optional[str] Go\tName string\tName *string Rust\tname: String\tname: Option&lt;String&gt; C++\tstd::string name\tstd::optional&lt;std::string&gt; name  Default Values:  Type\tDefault ValueNon-optional types\tLanguage default Optional types\tnull/None/nil  ref‚Äã  Enables reference tracking for shared/circular references:  message Node { string value = 1; ref Node parent = 2; // Can point to shared object list&lt;ref Node&gt; children = 3; }   Use Cases:  Shared objects (same object referenced multiple times)Circular references (object graphs with cycles)Tree structures with parent pointers  Generated Code:  Language\tWithout ref\tWith refJava\tNode parent\tNode parent with @ForyField(ref=true) Python\tparent: Node\tparent: Node = pyfory.field(ref=True) Go\tParent Node\tParent *Node with fory:&quot;ref&quot; Rust\tparent: Node\tparent: Arc&lt;Node&gt; C++\tNode parent\tstd::shared_ptr&lt;Node&gt; parent  Rust uses Arc by default; use ref(thread_safe=false) or ref(weak=true)to customize pointer types. For protobuf option syntax, seeProtocol Buffers IDL Support.  list‚Äã  Marks the field as a list/array:  message Document { list&lt;string&gt; tags = 1; list&lt;User&gt; authors = 2; }   Generated Code:  Language\tTypeJava\tList&lt;String&gt; Python\tList[str] Go\t[]string Rust\tVec&lt;String&gt; C++\tstd::vector&lt;std::string&gt;  ","version":"0.15","tagName":"h3"},{"title":"Combining Modifiers‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#combining-modifiers","content":" Modifiers can be combined:  message Example { optional list&lt;string&gt; tags = 1; // Nullable list list&lt;optional string&gt; aliases = 2; // Elements may be null ref list&lt;Node&gt; nodes = 3; // Collection tracked as a reference list&lt;ref Node&gt; children = 4; // Elements tracked as references optional ref User owner = 5; // Nullable tracked reference }   Modifiers before list apply to the field/collection. Modifiers after listapply to elements. repeated is accepted as an alias for list.  List modifier mapping:  Fory IDL\tJava\tPython\tGo\tRust\tC++optional list&lt;string&gt;\tList&lt;String&gt; + @ForyField(nullable = true)\tOptional[List[str]]\t[]string + nullable\tOption&lt;Vec&lt;String&gt;&gt;\tstd::optional&lt;std::vector&lt;std::string&gt;&gt; list&lt;optional string&gt;\tList&lt;String&gt; (nullable elements)\tList[Optional[str]]\t[]*string\tVec&lt;Option&lt;String&gt;&gt;\tstd::vector&lt;std::optional&lt;std::string&gt;&gt; ref list&lt;User&gt;\tList&lt;User&gt; + @ForyField(ref = true)\tList[User] + pyfory.field(ref=True)\t[]User + ref\tArc&lt;Vec&lt;User&gt;&gt;\tstd::shared_ptr&lt;std::vector&lt;User&gt;&gt; list&lt;ref User&gt;\tList&lt;User&gt;\tList[User]\t[]*User + ref=false\tVec&lt;Arc&lt;User&gt;&gt;\tstd::vector&lt;std::shared_ptr&lt;User&gt;&gt;  Use ref(thread_safe=false) in Fory IDL (or [(fory).thread_safe_pointer = false] in protobuf) to generate Rc instead of Arc in Rust.  ","version":"0.15","tagName":"h3"},{"title":"Field Numbers‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#field-numbers","content":" Each field must have a unique positive integer identifier:  message Example { string first = 1; string second = 2; string third = 3; }   Rules and best practices:  Numbers must be unique within a message.Numbers must be positive integers.Gaps are allowed and are useful when fields are removed.Prefer sequential numbering from 1.Never reuse a removed field number for a different field.  ","version":"0.15","tagName":"h2"},{"title":"Type System‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#type-system","content":" Fory IDL provides a cross-language type system for primitives, named types, and collections. Field modifiers (optional, list, ref) control nullability, collection behavior, and reference tracking (seeField Modifiers).  ","version":"0.15","tagName":"h2"},{"title":"Primitive Types‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#primitive-types","content":" Type\tDescription\tSizebool\tBoolean value\t1 byte int8\tSigned 8-bit integer\t1 byte int16\tSigned 16-bit integer\t2 bytes int32\tSigned 32-bit integer (varint encoding)\t4 bytes int64\tSigned 64-bit integer (varint encoding)\t8 bytes uint8\tUnsigned 8-bit integer\t1 byte uint16\tUnsigned 16-bit integer\t2 bytes uint32\tUnsigned 32-bit integer (varint encoding)\t4 bytes uint64\tUnsigned 64-bit integer (varint encoding)\t8 bytes fixed_int32\tSigned 32-bit integer (fixed encoding)\t4 bytes fixed_int64\tSigned 64-bit integer (fixed encoding)\t8 bytes fixed_uint32\tUnsigned 32-bit integer (fixed encoding)\t4 bytes fixed_uint64\tUnsigned 64-bit integer (fixed encoding)\t8 bytes tagged_int64\tSigned 64-bit integer (tagged encoding)\t8 bytes tagged_uint64\tUnsigned 64-bit integer (tagged encoding)\t8 bytes float32\t32-bit floating point\t4 bytes float64\t64-bit floating point\t8 bytes string\tUTF-8 string\tVariable bytes\tBinary data\tVariable date\tCalendar date\tVariable timestamp\tDate and time with timezone\tVariable duration\tDuration\tVariable decimal\tDecimal value\tVariable any\tDynamic value (runtime type)\tVariable  Boolean‚Äã  Language\tType\tNotesJava\tboolean / Boolean\tPrimitive or boxed Python\tbool Go\tbool Rust\tbool C++\tbool\t  Integer Types‚Äã  Fory IDL provides fixed-width signed integers (varint encoding for 32/64-bit by default):  Fory IDL Type\tSize\tRangeint8\t8-bit\t-128 to 127 int16\t16-bit\t-32,768 to 32,767 int32\t32-bit\t-2^31 to 2^31 - 1 int64\t64-bit\t-2^63 to 2^63 - 1  Language Mapping (Signed):  Fory IDL\tJava\tPython\tGo\tRust\tC++int8\tbyte\tpyfory.int8\tint8\ti8\tint8_t int16\tshort\tpyfory.int16\tint16\ti16\tint16_t int32\tint\tpyfory.int32\tint32\ti32\tint32_t int64\tlong\tpyfory.int64\tint64\ti64\tint64_t  Fory IDL provides fixed-width unsigned integers (varint encoding for 32/64-bit by default):  Fory IDL\tSize\tRangeuint8\t8-bit\t0 to 255 uint16\t16-bit\t0 to 65,535 uint32\t32-bit\t0 to 2^32 - 1 uint64\t64-bit\t0 to 2^64 - 1  Language Mapping (Unsigned):  Fory IDL\tJava\tPython\tGo\tRust\tC++uint8\tshort\tpyfory.uint8\tuint8\tu8\tuint8_t uint16\tint\tpyfory.uint16\tuint16\tu16\tuint16_t uint32\tlong\tpyfory.uint32\tuint32\tu32\tuint32_t uint64\tlong\tpyfory.uint64\tuint64\tu64\tuint64_t  Integer Encoding Variants‚Äã  For 32/64-bit integers, Fory IDL uses varint encoding by default. Use explicit types when you need fixed-width or tagged encoding:  Fory IDL Type\tEncoding\tNotesfixed_int32\tfixed\tSigned 32-bit fixed_int64\tfixed\tSigned 64-bit fixed_uint32\tfixed\tUnsigned 32-bit fixed_uint64\tfixed\tUnsigned 64-bit tagged_int64\ttagged\tSigned 64-bit (hybrid) tagged_uint64\ttagged\tUnsigned 64-bit (hybrid)  Floating-Point Types‚Äã  Fory IDL Type\tSize\tPrecisionfloat32\t32-bit\t~7 digits float64\t64-bit\t~15-16 digits  Language Mapping:  Fory IDL\tJava\tPython\tGo\tRust\tC++float32\tfloat\tpyfory.float32\tfloat32\tf32\tfloat float64\tdouble\tpyfory.float64\tfloat64\tf64\tdouble  String Type‚Äã  Language\tType\tNotesJava\tString\tImmutable Python\tstr Go\tstring\tImmutable Rust\tString\tOwned, heap-allocated C++\tstd::string\t  Bytes Type‚Äã  Language\tType\tNotesJava\tbyte[] Python\tbytes\tImmutable Go\t[]byte Rust\tVec&lt;u8&gt; C++\tstd::vector&lt;uint8_t&gt;\t  Temporal Types‚Äã  Date‚Äã  Language\tType\tNotesJava\tjava.time.LocalDate Python\tdatetime.date Go\ttime.Time\tTime portion ignored Rust\tchrono::NaiveDate\tRequires chrono crate C++\tfory::serialization::Date\t  Timestamp‚Äã  Language\tType\tNotesJava\tjava.time.Instant\tUTC-based Python\tdatetime.datetime Go\ttime.Time Rust\tchrono::NaiveDateTime\tRequires chrono crate C++\tfory::serialization::Timestamp\t  Any‚Äã  Language\tType\tNotesJava\tObject\tRuntime type written Python\tAny\tRuntime type written Go\tany\tRuntime type written Rust\tBox&lt;dyn Any&gt;\tRuntime type written C++\tstd::any\tRuntime type written  Example:  enum EventType [id=120] { CREATED = 0; DELETED = 1; } message UserCreated [id=121] { string user_id = 1; } message Envelope [id=122] { EventType type = 1; any payload = 2; }   Generated Code (Envelope.payload):  Language\tGenerated Field TypeJava\tObject payload Python\tpayload: Any Go\tPayload any Rust\tpayload: Box&lt;dyn Any&gt; C++\tstd::any payload  Notes:  any always writes a null flag (same as nullable) because values may be empty.Allowed runtime values are limited to bool, string, enum, message, and union. Other primitives (numeric, bytes, date/time) and list/map are not supported; wrap them in a message or use explicit fields instead.ref is not allowed on any fields (including list/map values). Wrap any in a message if you need reference tracking.The runtime type must be registered in the target language schema/IDL registration; unknown types fail to deserialize.  ","version":"0.15","tagName":"h3"},{"title":"Named Types‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#named-types","content":" Reference other messages, enums, or unions by name:  enum Status { ... } message User { ... } message Order { User customer = 1; // Reference to User message Status status = 2; // Reference to Status enum }   ","version":"0.15","tagName":"h3"},{"title":"Collection Types‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#collection-types","content":" List (list)‚Äã  Use the list&lt;...&gt; type for list fields. repeated is accepted as an alias. See Field Modifiers for modifier combinations and language mapping.  Nested collection types are not supported. Use a message wrapper if you needlist&lt;list&lt;...&gt;&gt;, list&lt;map&lt;...&gt;&gt;, or map&lt;..., list&lt;...&gt;&gt;.  Map‚Äã  Maps with typed keys and values:  message Config { map&lt;string, string&gt; properties = 1; map&lt;string, int32&gt; counts = 2; map&lt;int32, User&gt; users = 3; }   Language Mapping:  Fory IDL\tJava\tPython\tGo\tRust\tC++map&lt;string, int32&gt;\tMap&lt;String, Integer&gt;\tDict[str, int]\tmap[string]int32\tHashMap&lt;String, i32&gt;\tstd::map&lt;std::string, int32_t&gt; map&lt;string, User&gt;\tMap&lt;String, User&gt;\tDict[str, User]\tmap[string]User\tHashMap&lt;String, User&gt;\tstd::map&lt;std::string, User&gt;  Key Type Restrictions:  string (most common)Integer types (int8, int16, int32, int64)bool  Avoid using messages or complex types as keys.  ","version":"0.15","tagName":"h3"},{"title":"Type Compatibility Matrix‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#type-compatibility-matrix","content":" This matrix shows which type conversions are safe across languages:  From -&gt; To\tbool\tint8\tint16\tint32\tint64\tfloat32\tfloat64\tstringbool\tY\tY\tY\tY\tY\t-\t-\t- int8\t-\tY\tY\tY\tY\tY\tY\t- int16\t-\t-\tY\tY\tY\tY\tY\t- int32\t-\t-\t-\tY\tY\t-\tY\t- int64\t-\t-\t-\t-\tY\t-\t-\t- float32\t-\t-\t-\t-\t-\tY\tY\t- float64\t-\t-\t-\t-\t-\t-\tY\t- string\t-\t-\t-\t-\t-\t-\t-\tY  Y = Safe conversion, - = Not recommended  ","version":"0.15","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#best-practices","content":" Use int32 as the default for most integers; use int64 for large values.Use string for text data (UTF-8) and bytes for binary data.Use optional only when the field may legitimately be absent.Use ref only when needed for shared or circular references.Prefer list for ordered sequences and map for key-value lookups.  ","version":"0.15","tagName":"h3"},{"title":"Type IDs‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#type-ids","content":" Type IDs enable efficient cross-language serialization and are used for messages, unions, and enums. When enable_auto_type_id = true (default) andid is omitted, the compiler auto-generates one usingMurmurHash3(utf8(package.type_name)) (32-bit) and annotates it in generated code. When enable_auto_type_id = false, types without explicit IDs are registered by namespace and name instead. Collisions are detected at compile-time across the current file and all imports; when a collision occurs, the compiler raises an error and asks for an explicit id or an alias.  enum Color [id=100] { ... } message User [id=101] { ... } union Event [id=102] { ... }   Enum type IDs remain optional; if omitted they are auto-generated using the same hash when enable_auto_type_id = true.  ","version":"0.15","tagName":"h2"},{"title":"With Explicit Type ID‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#with-explicit-type-id-2","content":" message User [id=101] { ... } message User [id=101, deprecated=true] { ... } // Multiple options   ","version":"0.15","tagName":"h3"},{"title":"Without Explicit Type ID‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#without-explicit-type-id-1","content":" message Config { ... } // Auto-generated when enable_auto_type_id = true   You can set [alias=&quot;...&quot;] to change the hash source without renaming the type.  ","version":"0.15","tagName":"h3"},{"title":"Practical Notes‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#practical-notes","content":" If a type omits id and enable_auto_type_id = true, Fory generates an ID with MurmurHash3(utf8(package.type_name)) (32-bit).Package alias and type alias change the hash input and can be used to resolve hash collisions without renaming public types.Manual IDs in the small varint range (0-127) are compact on the wire; auto IDs are typically larger and usually consume 4-5 bytes.  ","version":"0.15","tagName":"h3"},{"title":"ID Assignment Strategy‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#id-assignment-strategy","content":" // Enums: 100-199 enum Status [id=100] { ... } enum Priority [id=101] { ... } // User domain: 200-299 message User [id=200] { ... } message UserProfile [id=201] { ... } // Order domain: 300-399 message Order [id=300] { ... } message OrderItem [id=301] { ... }   ","version":"0.15","tagName":"h3"},{"title":"Complete Example‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#complete-example-1","content":" // E-commerce domain model package com.shop.models; // Enums with type IDs enum OrderStatus [id=100] { PENDING = 0; CONFIRMED = 1; SHIPPED = 2; DELIVERED = 3; CANCELLED = 4; } enum PaymentMethod [id=101] { CREDIT_CARD = 0; DEBIT_CARD = 1; PAYPAL = 2; BANK_TRANSFER = 3; } // Messages with type IDs message Address [id=200] { string street = 1; string city = 2; string state = 3; string country = 4; string postal_code = 5; } message Customer [id=201] { string id = 1; string name = 2; optional string email = 3; optional string phone = 4; optional Address billing_address = 5; optional Address shipping_address = 6; } message Product [id=202] { string sku = 1; string name = 2; string description = 3; float64 price = 4; int32 stock = 5; list&lt;string&gt; categories = 6; map&lt;string, string&gt; attributes = 7; } message OrderItem [id=203] { ref Product product = 1; // Track reference to avoid duplication int32 quantity = 2; float64 unit_price = 3; } message Order [id=204] { string id = 1; ref Customer customer = 2; list&lt;OrderItem&gt; items = 3; OrderStatus status = 4; PaymentMethod payment_method = 5; float64 total = 6; optional string notes = 7; timestamp created_at = 8; optional timestamp shipped_at = 9; } // Config without explicit type ID (auto-generated when enable_auto_type_id = true) message ShopConfig { string store_name = 1; string currency = 2; float64 tax_rate = 3; list&lt;string&gt; supported_countries = 4; }   For protobuf-specific extension options and (fory). syntax, seeProtocol Buffers IDL Support.  ","version":"0.15","tagName":"h2"},{"title":"Grammar Summary‚Äã","type":1,"pageTitle":"Schema IDL","url":"/docs/compiler/syntax#grammar-summary","content":" file := [package_decl] file_option* import_decl* type_def* package_decl := 'package' package_name ['alias' package_name] ';' package_name := IDENTIFIER ('.' IDENTIFIER)* file_option := 'option' option_name '=' option_value ';' option_name := IDENTIFIER import_decl := 'import' STRING ';' type_def := enum_def | message_def | union_def enum_def := 'enum' IDENTIFIER [type_options] '{' enum_body '}' enum_body := (reserved_stmt | enum_value)* enum_value := IDENTIFIER '=' INTEGER ';' message_def := 'message' IDENTIFIER [type_options] '{' message_body '}' message_body := (reserved_stmt | nested_type | field_def)* nested_type := enum_def | message_def | union_def field_def := [modifiers] field_type IDENTIFIER '=' INTEGER [field_options] ';' union_def := 'union' IDENTIFIER [type_options] '{' union_field* '}' union_field := ['repeated'] field_type IDENTIFIER '=' INTEGER [field_options] ';' option_value := 'true' | 'false' | IDENTIFIER | INTEGER | STRING reserved_stmt := 'reserved' reserved_items ';' reserved_items := reserved_item (',' reserved_item)* reserved_item := INTEGER | INTEGER 'to' INTEGER | INTEGER 'to' 'max' | STRING modifiers := { 'optional' | 'ref' | 'repeated' } field_type := primitive_type | named_type | list_type | map_type primitive_type := 'bool' | 'int8' | 'int16' | 'int32' | 'int64' | 'uint8' | 'uint16' | 'uint32' | 'uint64' | 'fixed_int32' | 'fixed_int64' | 'fixed_uint32' | 'fixed_uint64' | 'tagged_int64' | 'tagged_uint64' | 'float32' | 'float64' | 'string' | 'bytes' | 'date' | 'timestamp' | 'duration' | 'decimal' | 'any' named_type := qualified_name qualified_name := IDENTIFIER ('.' IDENTIFIER)* // e.g., Parent.Child list_type := 'list' '&lt;' { 'optional' | 'ref' } field_type '&gt;' map_type := 'map' '&lt;' field_type ',' field_type '&gt;' type_options := '[' type_option (',' type_option)* ']' type_option := IDENTIFIER '=' option_value // e.g., id=100, deprecated=true field_options := '[' field_option (',' field_option)* ']' field_option := IDENTIFIER '=' option_value // e.g., deprecated=true, ref=true STRING := '&quot;' [^&quot;\\n]* '&quot;' | &quot;'&quot; [^'\\n]* &quot;'&quot; IDENTIFIER := [a-zA-Z_][a-zA-Z0-9_]* INTEGER := '-'? [0-9]+  ","version":"0.15","tagName":"h2"},{"title":"Field Configuration","type":0,"sectionRef":"#","url":"/docs/guide/cpp/field_configuration","content":"","keywords":"","version":"0.15"},{"title":"Overview‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#overview","content":" Apache Fory‚Ñ¢ provides three ways to configure field-level metadata at compile time:  fory::field&lt;&gt; template - Inline metadata in struct definition with wrapper typesFORY_FIELD_TAGS macro - Non-invasive metadata for basic field configurationFORY_FIELD_CONFIG macro - Advanced configuration with builder pattern and encoding control  These enable:  Tag IDs: Assign compact numeric IDs for schema evolutionNullability: Mark pointer fields as nullableReference Tracking: Enable reference tracking for shared pointersEncoding Control: Specify wire format for integers (varint, fixed, tagged)Dynamic Dispatch: Control polymorphic type info for smart pointers  Comparison:  Feature\tfory::field&lt;&gt;\tFORY_FIELD_TAGS\tFORY_FIELD_CONFIGStruct modification\tRequired (wrap types)\tNone\tNone Encoding control\tNo\tNo\tYes (varint/fixed/tagged) Builder pattern\tNo\tNo\tYes Dynamic control\tYes\tNo\tYes Compile-time verify\tYes\tLimited\tYes (member pointers) Cross-lang compat\tLimited\tLimited\tFull Recommended for\tSimple structs\tThird-party types\tComplex/xlang structs  ","version":"0.15","tagName":"h2"},{"title":"The fory::field Template‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#the-foryfield-template","content":" template &lt;typename T, int16_t Id, typename... Options&gt; class field;   ","version":"0.15","tagName":"h2"},{"title":"Template Parameters‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#template-parameters","content":" Parameter\tDescriptionT\tThe underlying field type Id\tField tag ID (int16_t) for compact serialization Options\tOptional tags: fory::nullable, fory::ref  ","version":"0.15","tagName":"h3"},{"title":"Basic Usage‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#basic-usage","content":" #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; struct Person { fory::field&lt;std::string, 0&gt; name; fory::field&lt;int32_t, 1&gt; age; fory::field&lt;std::optional&lt;std::string&gt;, 2&gt; nickname; }; FORY_STRUCT(Person, name, age, nickname);   The fory::field&lt;&gt; wrapper is transparent - you can use it like the underlying type:  Person person; person.name = &quot;Alice&quot;; // Direct assignment person.age = 30; std::string n = person.name; // Implicit conversion int a = person.age.get(); // Explicit get()   ","version":"0.15","tagName":"h3"},{"title":"Tag Types‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#tag-types","content":" ","version":"0.15","tagName":"h2"},{"title":"fory::nullable‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#forynullable","content":" Marks a smart pointer field as nullable (can be nullptr):  struct Node { fory::field&lt;std::string, 0&gt; name; fory::field&lt;std::shared_ptr&lt;Node&gt;, 1, fory::nullable&gt; next; // Can be nullptr }; FORY_STRUCT(Node, name, next);   Valid for: std::shared_ptr&lt;T&gt;, fory::serialization::SharedWeak&lt;T&gt;, std::unique_ptr&lt;T&gt;  Note: For nullable primitives or strings, use std::optional&lt;T&gt; instead:  // Correct: use std::optional for nullable primitives fory::field&lt;std::optional&lt;int32_t&gt;, 0&gt; optional_value; // Wrong: nullable is not allowed for primitives // fory::field&lt;int32_t, 0, fory::nullable&gt; value; // Compile error!   ","version":"0.15","tagName":"h3"},{"title":"fory::not_null‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#forynot_null","content":" Explicitly marks a pointer field as non-nullable. This is the default for smart pointers, but can be used for documentation:  fory::field&lt;std::shared_ptr&lt;Data&gt;, 0, fory::not_null&gt; data; // Must not be nullptr   Valid for: std::shared_ptr&lt;T&gt;, fory::serialization::SharedWeak&lt;T&gt;, std::unique_ptr&lt;T&gt;  ","version":"0.15","tagName":"h3"},{"title":"fory::ref‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#foryref","content":" Enables reference tracking for shared pointer fields. When multiple fields reference the same object, it will be serialized once and shared:  struct Graph { fory::field&lt;std::string, 0&gt; name; fory::field&lt;std::shared_ptr&lt;Graph&gt;, 1, fory::ref&gt; left; // Ref tracked fory::field&lt;std::shared_ptr&lt;Graph&gt;, 2, fory::ref&gt; right; // Ref tracked }; FORY_STRUCT(Graph, name, left, right);   Valid for: std::shared_ptr&lt;T&gt;, fory::serialization::SharedWeak&lt;T&gt; (requires shared ownership)  ","version":"0.15","tagName":"h3"},{"title":"fory::dynamic<V>‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#forydynamicv","content":" Controls whether type info is written for polymorphic smart pointer fields:  fory::dynamic&lt;true&gt;: Force type info to be written (enable runtime subtype support)fory::dynamic&lt;false&gt;: skip type info (use declared type directly, no dynamic dispatch)  By default, Fory auto-detects polymorphism via std::is_polymorphic&lt;T&gt;. Use this tag to override:  // Base class with virtual methods (detected as polymorphic by default) struct Animal { virtual ~Animal() = default; virtual std::string speak() const = 0; }; struct Zoo { // Auto: type info written because Animal has virtual methods fory::field&lt;std::shared_ptr&lt;Animal&gt;, 0, fory::nullable&gt; animal; // Force non-dynamic: skip type info even though Animal has virtual methods // Use when you know the runtime type will always be exactly as declared fory::field&lt;std::shared_ptr&lt;Animal&gt;, 1, fory::nullable, fory::dynamic&lt;false&gt;&gt; fixed_animal; }; FORY_STRUCT(Zoo, animal, fixed_animal);   Valid for: std::shared_ptr&lt;T&gt;, std::unique_ptr&lt;T&gt;  ","version":"0.15","tagName":"h3"},{"title":"Combining Tags‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#combining-tags","content":" Multiple tags can be combined for shared pointers and SharedWeak:  // Nullable + ref tracking fory::field&lt;std::shared_ptr&lt;Node&gt;, 0, fory::nullable, fory::ref&gt; link;   ","version":"0.15","tagName":"h3"},{"title":"Type Rules‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#type-rules","content":" Type\tAllowed Options\tNullabilityPrimitives, strings\tNone\tUse std::optional&lt;T&gt; if nullable std::optional&lt;T&gt;\tNone\tInherently nullable std::shared_ptr&lt;T&gt;\tnullable, ref, dynamic&lt;V&gt;\tNon-null by default fory::serialization::SharedWeak&lt;T&gt;\tnullable, ref, dynamic&lt;V&gt;\tNon-null by default std::unique_ptr&lt;T&gt;\tnullable, dynamic&lt;V&gt;\tNon-null by default  ","version":"0.15","tagName":"h2"},{"title":"Complete Example‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#complete-example","content":" #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; // Define a struct with various field configurations struct Document { // Required fields (non-nullable) fory::field&lt;std::string, 0&gt; title; fory::field&lt;int32_t, 1&gt; version; // Optional primitive using std::optional fory::field&lt;std::optional&lt;std::string&gt;, 2&gt; description; // Nullable pointer fory::field&lt;std::unique_ptr&lt;std::string&gt;, 3, fory::nullable&gt; metadata; // Reference-tracked shared pointer fory::field&lt;std::shared_ptr&lt;Document&gt;, 4, fory::ref&gt; parent; // Nullable + reference-tracked fory::field&lt;std::shared_ptr&lt;Document&gt;, 5, fory::nullable, fory::ref&gt; related; }; FORY_STRUCT(Document, title, version, description, metadata, parent, related); int main() { auto fory = Fory::builder().xlang(true).build(); fory.register_struct&lt;Document&gt;(100); Document doc; doc.title = &quot;My Document&quot;; doc.version = 1; doc.description = &quot;A sample document&quot;; doc.metadata = nullptr; // Allowed because nullable doc.parent = std::make_shared&lt;Document&gt;(); doc.parent-&gt;title = &quot;Parent Doc&quot;; doc.related = nullptr; // Allowed because nullable auto bytes = fory.serialize(doc).value(); auto decoded = fory.deserialize&lt;Document&gt;(bytes).value(); }   ","version":"0.15","tagName":"h2"},{"title":"Compile-Time Validation‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#compile-time-validation","content":" Invalid configurations are caught at compile time:  // Error: nullable and not_null are mutually exclusive fory::field&lt;std::shared_ptr&lt;int&gt;, 0, fory::nullable, fory::not_null&gt; bad1; // Error: nullable only valid for smart pointers fory::field&lt;int32_t, 0, fory::nullable&gt; bad2; // Error: ref only valid for shared_ptr fory::field&lt;std::unique_ptr&lt;int&gt;, 0, fory::ref&gt; bad3; // Error: options not allowed for std::optional (inherently nullable) fory::field&lt;std::optional&lt;int&gt;, 0, fory::nullable&gt; bad4;   ","version":"0.15","tagName":"h2"},{"title":"Backwards Compatibility‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#backwards-compatibility","content":" Existing structs without fory::field&lt;&gt; wrappers continue to work:  // Old style - still works struct LegacyPerson { std::string name; int32_t age; }; FORY_STRUCT(LegacyPerson, name, age); // New style with field metadata struct ModernPerson { fory::field&lt;std::string, 0&gt; name; fory::field&lt;int32_t, 1&gt; age; }; FORY_STRUCT(ModernPerson, name, age);   ","version":"0.15","tagName":"h2"},{"title":"FORY_FIELD_TAGS Macro‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#fory_field_tags-macro","content":" The FORY_FIELD_TAGS macro provides a non-invasive way to add field metadata without modifying struct definitions. This is useful for:  Third-party types: Add metadata to types you don't ownClean structs: Keep struct definitions as pure C++Isolated dependencies: Confine Fory headers to serialization config files  ","version":"0.15","tagName":"h2"},{"title":"Usage‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#usage","content":" // user_types.h - NO fory headers needed! struct Document { std::string title; int32_t version; std::optional&lt;std::string&gt; description; std::shared_ptr&lt;User&gt; author; std::shared_ptr&lt;User&gt; reviewer; std::shared_ptr&lt;Document&gt; parent; std::unique_ptr&lt;Data&gt; data; }; // serialization_config.cpp - fory config isolated here #include &quot;fory/serialization/fory.h&quot; #include &quot;user_types.h&quot; FORY_STRUCT(Document, title, version, description, author, reviewer, parent, data) FORY_FIELD_TAGS(Document, (title, 0), // string: non-nullable (version, 1), // int: non-nullable (description, 2), // optional: inherently nullable (author, 3), // shared_ptr: non-nullable (default) (reviewer, 4, nullable), // shared_ptr: nullable (parent, 5, ref), // shared_ptr: non-nullable, with ref tracking (data, 6, nullable) // unique_ptr: nullable )   ","version":"0.15","tagName":"h3"},{"title":"FORY_FIELD_TAGS Options‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#fory_field_tags-options","content":" Field Type\tValid CombinationsPrimitives, strings\t(field, id) only std::optional&lt;T&gt;\t(field, id) only std::shared_ptr&lt;T&gt;\t(field, id), (field, id, nullable), (field, id, ref), (field, id, nullable, ref) std::unique_ptr&lt;T&gt;\t(field, id), (field, id, nullable)  ","version":"0.15","tagName":"h3"},{"title":"FORY_FIELD_CONFIG Macro‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#fory_field_config-macro","content":" The FORY_FIELD_CONFIG macro is the most powerful and flexible way to configure field-level serialization. It provides:  Builder pattern API: Fluent, chainable configuration with F(id).option1().option2()Encoding control: Specify how unsigned integers are encoded (varint, fixed, tagged)Compile-time verification: Field names are verified against member pointersCross-language compatibility: Configure encoding to match other languages (Java, Rust, etc.)  ","version":"0.15","tagName":"h2"},{"title":"Basic Syntax‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#basic-syntax","content":" FORY_FIELD_CONFIG(StructType, (field1, fory::F(0)), // Simple: just ID (field2, fory::F(1).nullable()), // With nullable (field3, fory::F(2).varint()), // With encoding (field4, fory::F(3).nullable().ref()), // Multiple options (field5, 4) // Backward compatible: integer ID );   ","version":"0.15","tagName":"h3"},{"title":"The F() Builder‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#the-f-builder","content":" The fory::F(id) factory creates a FieldMeta object that supports method chaining:  fory::F(0) // Create with field ID 0 .nullable() // Mark as nullable .ref() // Enable reference tracking .varint() // Use variable-length encoding .fixed() // Use fixed-size encoding .tagged() // Use tagged encoding .dynamic(false) // skip type info (no dynamic dispatch) .dynamic(true) // Force type info (enable dynamic dispatch) .compress(false) // Disable compression   Tip: To use F() without the fory:: prefix, add a using declaration:  using fory::F; FORY_FIELD_CONFIG(MyStruct, (field1, F(0).varint()), // No prefix needed (field2, F(1).nullable()) );   ","version":"0.15","tagName":"h3"},{"title":"Encoding Options for Unsigned Integers‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#encoding-options-for-unsigned-integers","content":" For uint32_t and uint64_t fields, you can specify the wire encoding:  Method\tType ID\tDescription\tUse Case.varint()\tVAR_UINT32/64\tVariable-length encoding (1-5 or 1-10 bytes)\tValues typically small .fixed()\tUINT32/64\tFixed-size encoding (always 4 or 8 bytes)\tValues uniformly distributed .tagged()\tTAGGED_UINT64\tTagged hybrid encoding with size hint (uint64)\tMixed small and large values (uint64)  Note: uint8_t and uint16_t always use fixed encoding (UINT8, UINT16).  ","version":"0.15","tagName":"h3"},{"title":"Complete Example‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#complete-example-1","content":" #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; // Define struct with unsigned integer fields struct MetricsData { // Counters - often small values, use varint for space efficiency uint32_t request_count; uint64_t bytes_sent; // IDs - uniformly distributed, use fixed for consistent performance uint32_t user_id; uint64_t session_id; // Timestamps - use tagged encoding for mixed value ranges uint64_t created_at; // Nullable fields std::optional&lt;uint32_t&gt; error_count; std::optional&lt;uint64_t&gt; last_access_time; }; FORY_STRUCT(MetricsData, request_count, bytes_sent, user_id, session_id, created_at, error_count, last_access_time); // Configure field encoding FORY_FIELD_CONFIG(MetricsData, // Small counters - varint saves space (request_count, fory::F(0).varint()), (bytes_sent, fory::F(1).varint()), // IDs - fixed for consistent performance (user_id, fory::F(2).fixed()), (session_id, fory::F(3).fixed()), // Timestamp - tagged encoding (created_at, fory::F(4).tagged()), // Nullable fields (error_count, fory::F(5).nullable().varint()), (last_access_time, fory::F(6).nullable().tagged()) ); int main() { auto fory = Fory::builder().xlang(true).build(); fory.register_struct&lt;MetricsData&gt;(100); MetricsData data{ .request_count = 42, .bytes_sent = 1024, .user_id = 12345678, .session_id = 9876543210, .created_at = 1704067200000000000ULL, // 2024-01-01 in nanoseconds .error_count = 3, .last_access_time = std::nullopt }; auto bytes = fory.serialize(data).value(); auto decoded = fory.deserialize&lt;MetricsData&gt;(bytes).value(); }   ","version":"0.15","tagName":"h3"},{"title":"Cross-Language Compatibility‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#cross-language-compatibility","content":" When serializing data to be read by other languages, use FORY_FIELD_CONFIG to match their encoding expectations:  Java Compatibility:  // Java uses these type IDs for unsigned integers: // - Byte (u8): UINT8 (fixed) // - Short (u16): UINT16 (fixed) // - Integer (u32): VAR_UINT32 (varint) or UINT32 (fixed) // - Long (u64): VAR_UINT64 (varint), UINT64 (fixed), or TAGGED_UINT64 struct JavaCompatible { uint8_t byte_field; // Maps to Java Byte uint16_t short_field; // Maps to Java Short uint32_t int_var_field; // Maps to Java Integer with varint uint32_t int_fixed_field; // Maps to Java Integer with fixed uint64_t long_var_field; // Maps to Java Long with varint uint64_t long_tagged; // Maps to Java Long with tagged }; FORY_STRUCT(JavaCompatible, byte_field, short_field, int_var_field, int_fixed_field, long_var_field, long_tagged); FORY_FIELD_CONFIG(JavaCompatible, (byte_field, fory::F(0)), // UINT8 (auto) (short_field, fory::F(1)), // UINT16 (auto) (int_var_field, fory::F(2).varint()), // VAR_UINT32 (int_fixed_field, fory::F(3).fixed()), // UINT32 (long_var_field, fory::F(4).varint()), // VAR_UINT64 (long_tagged, fory::F(5).tagged()) // TAGGED_UINT64 );   ","version":"0.15","tagName":"h3"},{"title":"Schema Evolution with FORY_FIELD_CONFIG‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#schema-evolution-with-fory_field_config","content":" In compatible mode, fields can have different nullability between sender and receiver:  // Version 1: All fields non-nullable struct DataV1 { uint32_t id; uint64_t timestamp; }; FORY_STRUCT(DataV1, id, timestamp); FORY_FIELD_CONFIG(DataV1, (id, fory::F(0).varint()), (timestamp, fory::F(1).tagged()) ); // Version 2: Added nullable fields struct DataV2 { uint32_t id; uint64_t timestamp; std::optional&lt;uint32_t&gt; version; // New nullable field }; FORY_STRUCT(DataV2, id, timestamp, version); FORY_FIELD_CONFIG(DataV2, (id, fory::F(0).varint()), (timestamp, fory::F(1).tagged()), (version, fory::F(2).nullable().varint()) // New field with nullable );   ","version":"0.15","tagName":"h3"},{"title":"FORY_FIELD_CONFIG Options Reference‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#fory_field_config-options-reference","content":" Method\tDescription\tValid For.nullable()\tMark field as nullable\tSmart pointers, primitives .ref()\tEnable reference tracking\tstd::shared_ptr, fory::serialization::SharedWeak .dynamic(true)\tForce type info to be written (dynamic dispatch)\tSmart pointers .dynamic(false)\tskip type info (use declared type directly)\tSmart pointers .varint()\tUse variable-length encoding\tuint32_t, uint64_t .fixed()\tUse fixed-size encoding\tuint32_t, uint64_t .tagged()\tUse tagged hybrid encoding\tuint64_t only .compress(v)\tEnable/disable field compression\tAll types  ","version":"0.15","tagName":"h3"},{"title":"Default Values‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#default-values","content":" Nullable: Only std::optional&lt;T&gt; is nullable by default; all other types (including std::shared_ptr) are non-nullableRef tracking: Enabled by default for std::shared_ptr&lt;T&gt; and fory::serialization::SharedWeak&lt;T&gt;, disabled for other types unless configured  You need to configure fields when:  A field can be null (use std::optional&lt;T&gt; or mark with nullable())A field needs reference tracking for shared/circular objects (use ref())Integer types need specific encoding for cross-language compatibilityYou want to reduce metadata size (use field IDs)  // Xlang mode: explicit configuration required struct User { std::string name; // Non-nullable by default std::optional&lt;std::string&gt; email; // Nullable (std::optional) std::shared_ptr&lt;User&gt; friend_ptr; // Ref tracking by default }; FORY_STRUCT(User, name, email, friend_ptr); FORY_FIELD_CONFIG(User, (name, fory::F(0)), (email, fory::F(1)), // nullable implicit for optional (friend_ptr, fory::F(2).nullable().ref()) // explicit nullable + ref );   ","version":"0.15","tagName":"h2"},{"title":"Default Values Summary‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#default-values-summary","content":" Type\tDefault Nullable\tDefault Ref TrackingPrimitives, string\tfalse\tfalse std::optional&lt;T&gt;\ttrue\tfalse std::shared_ptr&lt;T&gt;\tfalse\ttrue fory::serialization::SharedWeak&lt;T&gt;\tfalse\ttrue std::unique_ptr&lt;T&gt;\tfalse\tfalse  ","version":"0.15","tagName":"h3"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/cpp/field_configuration#related-topics","content":" Type Registration - Registering types with FORY_STRUCTSchema Evolution - Using tag IDs for schema evolutionConfiguration - Enabling reference tracking globallyCross-Language - Interoperability with Java, Rust, Python ","version":"0.15","tagName":"h2"},{"title":"Polymorphic Serialization","type":0,"sectionRef":"#","url":"/docs/guide/cpp/polymorphism","content":"","keywords":"","version":"0.15"},{"title":"Supported Polymorphic Types‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/guide/cpp/polymorphism#supported-polymorphic-types","content":" std::shared_ptr&lt;Base&gt; - Shared ownership with polymorphic dispatchstd::unique_ptr&lt;Base&gt; - Exclusive ownership with polymorphic dispatchCollections: std::vector&lt;std::shared_ptr&lt;Base&gt;&gt;, std::map&lt;K, std::unique_ptr&lt;Base&gt;&gt;Optional: std::optional&lt;std::shared_ptr&lt;Base&gt;&gt;  ","version":"0.15","tagName":"h2"},{"title":"Basic Polymorphic Serialization‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/guide/cpp/polymorphism#basic-polymorphic-serialization","content":" #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; // Define base class with virtual methods struct Animal { virtual ~Animal() = default; virtual std::string speak() const = 0; int32_t age = 0; }; FORY_STRUCT(Animal, age); // Define derived classes struct Dog : Animal { std::string speak() const override { return &quot;Woof!&quot;; } std::string breed; }; FORY_STRUCT(Dog, age, breed); struct Cat : Animal { std::string speak() const override { return &quot;Meow!&quot;; } std::string color; }; FORY_STRUCT(Cat, age, color); // Struct with polymorphic field struct Zoo { std::shared_ptr&lt;Animal&gt; star_animal; }; FORY_STRUCT(Zoo, star_animal); int main() { auto fory = Fory::builder().track_ref(true).build(); // Register all types with unique type IDs fory.register_struct&lt;Zoo&gt;(100); fory.register_struct&lt;Dog&gt;(101); fory.register_struct&lt;Cat&gt;(102); // Create object with polymorphic field Zoo zoo; zoo.star_animal = std::make_shared&lt;Dog&gt;(); zoo.star_animal-&gt;age = 3; static_cast&lt;Dog*&gt;(zoo.star_animal.get())-&gt;breed = &quot;Labrador&quot;; // Serialize auto bytes_result = fory.serialize(zoo); assert(bytes_result.ok()); // Deserialize - runtime type is preserved auto decoded_result = fory.deserialize&lt;Zoo&gt;(bytes_result.value()); assert(decoded_result.ok()); auto decoded = std::move(decoded_result).value(); assert(decoded.star_animal-&gt;speak() == &quot;Woof!&quot;); assert(decoded.star_animal-&gt;age == 3); auto* dog_ptr = dynamic_cast&lt;Dog*&gt;(decoded.star_animal.get()); assert(dog_ptr != nullptr); assert(dog_ptr-&gt;breed == &quot;Labrador&quot;); }   ","version":"0.15","tagName":"h2"},{"title":"Type Registration for Polymorphism‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/guide/cpp/polymorphism#type-registration-for-polymorphism","content":" For polymorphic serialization, register derived types with unique type IDs:  // Register with numeric type ID fory.register_struct&lt;Derived1&gt;(100); fory.register_struct&lt;Derived2&gt;(101);   Why type ID registration?  Compact binary representationFast type lookup and dispatchConsistent with non-polymorphic type registration  ","version":"0.15","tagName":"h2"},{"title":"Automatic Polymorphism Detection‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/guide/cpp/polymorphism#automatic-polymorphism-detection","content":" Fory automatically detects polymorphic types using std::is_polymorphic&lt;T&gt;:  struct Base { virtual ~Base() = default; // Virtual destructor makes it polymorphic int32_t value = 0; }; struct NonPolymorphic { int32_t value = 0; // No virtual methods }; // Polymorphic field - type info written automatically struct Container1 { std::shared_ptr&lt;Base&gt; ptr; // Auto-detected as polymorphic }; // Non-polymorphic field - no type info written struct Container2 { std::shared_ptr&lt;NonPolymorphic&gt; ptr; // Not polymorphic };   ","version":"0.15","tagName":"h2"},{"title":"Controlling Dynamic Dispatch‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/guide/cpp/polymorphism#controlling-dynamic-dispatch","content":" Use fory::dynamic&lt;V&gt; to override automatic polymorphism detection:  struct Animal { virtual ~Animal() = default; virtual std::string speak() const = 0; }; struct Pet { // Auto-detected: type info written (Animal has virtual methods) std::shared_ptr&lt;Animal&gt; animal1; // Force dynamic: type info written explicitly fory::field&lt;std::shared_ptr&lt;Animal&gt;, 0, fory::dynamic&lt;true&gt;&gt; animal2; // Force non-dynamic: skip type info (faster but no runtime subtyping) fory::field&lt;std::shared_ptr&lt;Animal&gt;, 1, fory::dynamic&lt;false&gt;&gt; animal3; }; FORY_STRUCT(Pet, animal1, animal2, animal3);   When to use fory::dynamic&lt;false&gt;:  You know the runtime type will always match the declared typePerformance is critical and you don't need subtype supportWorking with monomorphic data despite having a polymorphic base class  ","version":"0.15","tagName":"h2"},{"title":"Field Configuration Without Wrapper Types‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/guide/cpp/polymorphism#field-configuration-without-wrapper-types","content":" Use FORY_FIELD_CONFIG to configure fields without fory::field&lt;&gt; wrapper:  struct Zoo { std::shared_ptr&lt;Animal&gt; star; // Auto-detected as polymorphic std::shared_ptr&lt;Animal&gt; backup; // Nullable polymorphic field std::shared_ptr&lt;Animal&gt; mascot; // Non-dynamic (no subtype dispatch) }; FORY_STRUCT(Zoo, star, backup, mascot); // Configure fields with tag IDs and options FORY_FIELD_CONFIG(Zoo, (star, fory::F(0)), // Tag ID 0, default options (backup, fory::F(1).nullable()), // Tag ID 1, allow nullptr (mascot, fory::F(2).dynamic(false)) // Tag ID 2, disable polymorphism );   See Field Configuration for complete details on fory::nullable, fory::ref, and other field-level options  ","version":"0.15","tagName":"h3"},{"title":"std::unique_ptr Polymorphism‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/guide/cpp/polymorphism#stdunique_ptr-polymorphism","content":" std::unique_ptr works the same way as std::shared_ptr for polymorphic types:  struct Container { std::unique_ptr&lt;Animal&gt; pet; }; FORY_STRUCT(Container, pet); auto fory = Fory::builder().track_ref(true).build(); fory.register_struct&lt;Container&gt;(200); fory.register_struct&lt;Dog&gt;(201); Container container; container.pet = std::make_unique&lt;Dog&gt;(); static_cast&lt;Dog*&gt;(container.pet.get())-&gt;breed = &quot;Beagle&quot;; auto bytes = fory.serialize(container).value(); auto decoded = fory.deserialize&lt;Container&gt;(bytes).value(); // Runtime type preserved auto* dog = dynamic_cast&lt;Dog*&gt;(decoded.pet.get()); assert(dog != nullptr); assert(dog-&gt;breed == &quot;Beagle&quot;);   ","version":"0.15","tagName":"h2"},{"title":"Collections of Polymorphic Objects‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/guide/cpp/polymorphism#collections-of-polymorphic-objects","content":" #include &lt;vector&gt; #include &lt;map&gt; struct AnimalShelter { std::vector&lt;std::shared_ptr&lt;Animal&gt;&gt; animals; std::map&lt;std::string, std::unique_ptr&lt;Animal&gt;&gt; registry; }; FORY_STRUCT(AnimalShelter, animals, registry); auto fory = Fory::builder().track_ref(true).build(); fory.register_struct&lt;AnimalShelter&gt;(100); fory.register_struct&lt;Dog&gt;(101); fory.register_struct&lt;Cat&gt;(102); AnimalShelter shelter; shelter.animals.push_back(std::make_shared&lt;Dog&gt;()); shelter.animals.push_back(std::make_shared&lt;Cat&gt;()); shelter.registry[&quot;pet1&quot;] = std::make_unique&lt;Dog&gt;(); auto bytes = fory.serialize(shelter).value(); auto decoded = fory.deserialize&lt;AnimalShelter&gt;(bytes).value(); // All runtime types preserved assert(dynamic_cast&lt;Dog*&gt;(decoded.animals[0].get()) != nullptr); assert(dynamic_cast&lt;Cat*&gt;(decoded.animals[1].get()) != nullptr); assert(dynamic_cast&lt;Dog*&gt;(decoded.registry[&quot;pet1&quot;].get()) != nullptr);   ","version":"0.15","tagName":"h2"},{"title":"Reference Tracking‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/guide/cpp/polymorphism#reference-tracking","content":" Reference tracking for std::shared_ptr works the same with polymorphic types. See Supported Types for details and examples.  ","version":"0.15","tagName":"h2"},{"title":"Nested Polymorphism Depth Limit‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/guide/cpp/polymorphism#nested-polymorphism-depth-limit","content":" To prevent stack overflow from deeply nested polymorphic structures, Fory limits the maximum dynamic nesting depth:  struct Container { virtual ~Container() = default; int32_t value = 0; std::shared_ptr&lt;Container&gt; nested; }; FORY_STRUCT(Container, value, nested); // Default max_dyn_depth is 5 auto fory1 = Fory::builder().build(); assert(fory1.config().max_dyn_depth == 5); // Increase limit for deeper nesting auto fory2 = Fory::builder().max_dyn_depth(10).build(); fory2.register_struct&lt;Container&gt;(1); // Create deeply nested structure auto level3 = std::make_shared&lt;Container&gt;(); level3-&gt;value = 3; auto level2 = std::make_shared&lt;Container&gt;(); level2-&gt;value = 2; level2-&gt;nested = level3; auto level1 = std::make_shared&lt;Container&gt;(); level1-&gt;value = 1; level1-&gt;nested = level2; // Serialization succeeds auto bytes = fory2.serialize(level1).value(); // Deserialization succeeds with sufficient depth auto decoded = fory2.deserialize&lt;std::shared_ptr&lt;Container&gt;&gt;(bytes).value();   Depth exceeded error:  auto fory_shallow = Fory::builder().max_dyn_depth(2).build(); fory_shallow.register_struct&lt;Container&gt;(1); // 3 levels exceeds max_dyn_depth=2 auto result = fory_shallow.deserialize&lt;std::shared_ptr&lt;Container&gt;&gt;(bytes); assert(!result.ok()); // Fails with depth exceeded error   When to adjust:  Increase max_dyn_depth: For legitimate deeply nested polymorphic data structuresDecrease max_dyn_depth: For stricter security requirements or shallow data structures  ","version":"0.15","tagName":"h2"},{"title":"Nullability for Polymorphic Fields‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/guide/cpp/polymorphism#nullability-for-polymorphic-fields","content":" By default, std::shared_ptr&lt;T&gt; and std::unique_ptr&lt;T&gt; fields are treated as non-nullable in the schema. To allow nullptr, wrap the field withfory::field&lt;&gt; (or FORY_FIELD_TAGS) and opt in with fory::nullable.  struct Pet { // Non-nullable (default) std::shared_ptr&lt;Animal&gt; primary; // Nullable via explicit field metadata fory::field&lt;std::shared_ptr&lt;Animal&gt;, 0, fory::nullable&gt; optional; }; FORY_STRUCT(Pet, primary, optional);   See Field Configuration for more details.  ","version":"0.15","tagName":"h2"},{"title":"Combining Polymorphism with Other Features‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/guide/cpp/polymorphism#combining-polymorphism-with-other-features","content":" ","version":"0.15","tagName":"h2"},{"title":"Polymorphism + Reference Tracking‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/guide/cpp/polymorphism#polymorphism--reference-tracking","content":" struct GraphNode { virtual ~GraphNode() = default; int32_t id = 0; std::vector&lt;std::shared_ptr&lt;GraphNode&gt;&gt; neighbors; }; FORY_STRUCT(GraphNode, id, neighbors); struct WeightedNode : GraphNode { double weight = 0.0; }; FORY_STRUCT(WeightedNode, id, neighbors, weight); // Enable ref tracking to handle shared references and cycles auto fory = Fory::builder().track_ref(true).build(); fory.register_struct&lt;GraphNode&gt;(100); fory.register_struct&lt;WeightedNode&gt;(101); // Create cyclic graph auto node1 = std::make_shared&lt;WeightedNode&gt;(); node1-&gt;id = 1; auto node2 = std::make_shared&lt;WeightedNode&gt;(); node2-&gt;id = 2; node1-&gt;neighbors.push_back(node2); node2-&gt;neighbors.push_back(node1); // Cycle auto bytes = fory.serialize(node1).value(); auto decoded = fory.deserialize&lt;std::shared_ptr&lt;GraphNode&gt;&gt;(bytes).value(); // Cycle handled correctly   ","version":"0.15","tagName":"h3"},{"title":"Polymorphism + Schema Evolution‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/guide/cpp/polymorphism#polymorphism--schema-evolution","content":" Use compatible mode for schema evolution with polymorphic types:  auto fory = Fory::builder() .compatible(true) // Enable schema evolution .track_ref(true) .build();   ","version":"0.15","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/guide/cpp/polymorphism#best-practices","content":" Use type ID registration for polymorphic types: fory.register_struct&lt;DerivedType&gt;(100); Enable reference tracking for polymorphic types: auto fory = Fory::builder().track_ref(true).build(); Virtual destructors required: Ensure base classes have virtual destructors: struct Base { virtual ~Base() = default; // Required for polymorphism }; Register all concrete types before serialization/deserialization: fory.register_struct&lt;Derived1&gt;(100); fory.register_struct&lt;Derived2&gt;(101); Use dynamic_cast to downcast after deserialization: auto* derived = dynamic_cast&lt;DerivedType*&gt;(base_ptr.get()); if (derived) { // Use derived-specific members } Adjust max_dyn_depth based on your data structure depth: auto fory = Fory::builder().max_dyn_depth(10).build(); Use fory::nullable for optional polymorphic fields: fory::field&lt;std::shared_ptr&lt;Base&gt;, 0, fory::nullable&gt; optional_ptr;   ","version":"0.15","tagName":"h2"},{"title":"Error Handling‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/guide/cpp/polymorphism#error-handling","content":" auto bytes_result = fory.serialize(obj); if (!bytes_result.ok()) { std::cerr &lt;&lt; &quot;Serialization failed: &quot; &lt;&lt; bytes_result.error().to_string() &lt;&lt; std::endl; return; } auto decoded_result = fory.deserialize&lt;MyType&gt;(bytes_result.value()); if (!decoded_result.ok()) { std::cerr &lt;&lt; &quot;Deserialization failed: &quot; &lt;&lt; decoded_result.error().to_string() &lt;&lt; std::endl; return; }   Common errors:  Type not registered: Register all concrete types with unique IDs before useDepth exceeded: Increase max_dyn_depth for deeply nested structuresType ID conflict: Ensure each type has a unique type ID across all registered types  ","version":"0.15","tagName":"h2"},{"title":"Performance Considerations‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/guide/cpp/polymorphism#performance-considerations","content":" Polymorphic serialization overhead:  Type metadata written for each polymorphic object (~16-32 bytes)Dynamic type resolution during deserializationVirtual function calls for runtime dispatch  Optimization tips:  Use fory::dynamic&lt;false&gt; when runtime type matches declared type: fory::field&lt;std::shared_ptr&lt;Base&gt;, 0, fory::dynamic&lt;false&gt;&gt; fixed_type; Minimize nesting depth to reduce metadata overhead Batch polymorphic objects in collections rather than individual fields Consider non-polymorphic alternatives when polymorphism isn't needed: std::variant&lt;Dog, Cat&gt; animal; // Type-safe union instead of polymorphism   ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Polymorphic Serialization","url":"/docs/guide/cpp/polymorphism#related-topics","content":" Type Registration - Registering types for serializationField Configuration - Field-level metadata and optionsSupported Types - Smart pointers and collectionsConfiguration - max_dyn_depth and other settingsBasic Serialization - Core serialization concepts ","version":"0.15","tagName":"h2"},{"title":"Row Format","type":0,"sectionRef":"#","url":"/docs/guide/cpp/row_format","content":"","keywords":"","version":"0.15"},{"title":"Overview‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#overview","content":" Apache Fory‚Ñ¢ Row Format is a binary format optimized for:  Random Access: Read any field without deserializing the entire objectZero-copy: Direct memory access without data copyingCache-Friendly: Contiguous memory layout for CPU cache efficiencyColumnar Conversion: Easy conversion to Apache Arrow formatPartial Serialization: Serialize only needed fields  ","version":"0.15","tagName":"h2"},{"title":"When to Use Row Format‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#when-to-use-row-format","content":" Use Case\tRow Format\tObject GraphAnalytics/OLAP\t‚úÖ\t‚ùå Random field access\t‚úÖ\t‚ùå Full object serialization\t‚ùå\t‚úÖ Complex object graphs\t‚ùå\t‚úÖ Reference tracking\t‚ùå\t‚úÖ Cross-language (simple types)\t‚úÖ\t‚úÖ  ","version":"0.15","tagName":"h2"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#quick-start","content":" #include &quot;fory/encoder/row_encoder.h&quot; #include &quot;fory/row/writer.h&quot; using namespace fory::row; using namespace fory::row::encoder; struct Person { int32_t id; std::string name; float score; FORY_STRUCT(Person, id, name, score); }; int main() { // Create encoder RowEncoder&lt;Person&gt; encoder; // encode a person Person person{1, &quot;Alice&quot;, 95.5f}; encoder.encode(person); // get the encoded row auto row = encoder.get_writer().to_row(); // Random access to fields int32_t id = row-&gt;get_int32(0); std::string name = row-&gt;get_string(1); float score = row-&gt;get_float(2); assert(id == 1); assert(name == &quot;Alice&quot;); assert(score == 95.5f); return 0; }   ","version":"0.15","tagName":"h2"},{"title":"Row Encoder‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#row-encoder","content":" ","version":"0.15","tagName":"h2"},{"title":"Basic Usage‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#basic-usage","content":" The RowEncoder&lt;T&gt; template class provides type-safe encoding:  #include &quot;fory/encoder/row_encoder.h&quot; struct Point { double x; double y; FORY_STRUCT(Point, x, y); }; // Create encoder RowEncoder&lt;Point&gt; encoder; // Access schema (for inspection) const Schema&amp; schema = encoder.get_schema(); std::cout &lt;&lt; &quot;Fields: &quot; &lt;&lt; schema.field_names().size() &lt;&lt; std::endl; // encode value Point p{1.0, 2.0}; encoder.encode(p); // get result as Row auto row = encoder.get_writer().to_row();   ","version":"0.15","tagName":"h3"},{"title":"Nested Structs‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#nested-structs","content":" struct Address { std::string city; std::string country; FORY_STRUCT(Address, city, country); }; struct Person { std::string name; Address address; FORY_STRUCT(Person, name, address); }; // encode nested struct RowEncoder&lt;Person&gt; encoder; Person person{&quot;Alice&quot;, {&quot;New York&quot;, &quot;USA&quot;}}; encoder.encode(person); auto row = encoder.get_writer().to_row(); std::string name = row-&gt;get_string(0); // Access nested struct auto address_row = row-&gt;get_struct(1); std::string city = address_row-&gt;get_string(0); std::string country = address_row-&gt;get_string(1);   ","version":"0.15","tagName":"h3"},{"title":"Arrays / Lists‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#arrays--lists","content":" struct Record { std::vector&lt;int32_t&gt; values; std::string label; FORY_STRUCT(Record, values, label); }; RowEncoder&lt;Record&gt; encoder; Record record{{1, 2, 3, 4, 5}, &quot;test&quot;}; encoder.encode(record); auto row = encoder.get_writer().to_row(); auto array = row-&gt;get_array(0); int count = array-&gt;num_elements(); for (int i = 0; i &lt; count; i++) { int32_t value = array-&gt;get_int32(i); }   ","version":"0.15","tagName":"h3"},{"title":"Encoding Arrays Directly‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#encoding-arrays-directly","content":" // encode a vector directly (not inside a struct) std::vector&lt;Person&gt; people{ {&quot;Alice&quot;, {&quot;NYC&quot;, &quot;USA&quot;}}, {&quot;Bob&quot;, {&quot;London&quot;, &quot;UK&quot;}} }; RowEncoder&lt;decltype(people)&gt; encoder; encoder.encode(people); // get array data auto array = encoder.get_writer().copy_to_array_data(); auto first_person = array-&gt;get_struct(0); std::string first_name = first_person-&gt;get_string(0);   ","version":"0.15","tagName":"h3"},{"title":"Row Data Access‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#row-data-access","content":" ","version":"0.15","tagName":"h2"},{"title":"Row Class‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#row-class","content":" The Row class provides random access to struct fields:  class Row { public: // Null check bool is_null_at(int i) const; // Primitive getters bool get_boolean(int i) const; int8_t get_int8(int i) const; int16_t get_int16(int i) const; int32_t get_int32(int i) const; int64_t get_int64(int i) const; float get_float(int i) const; double get_double(int i) const; // String/binary getter std::string get_string(int i) const; std::vector&lt;uint8_t&gt; get_binary(int i) const; // Nested types std::shared_ptr&lt;Row&gt; get_struct(int i) const; std::shared_ptr&lt;ArrayData&gt; get_array(int i) const; std::shared_ptr&lt;MapData&gt; get_map(int i) const; // Metadata int num_fields() const; SchemaPtr schema() const; // Debug std::string to_string() const; };   ","version":"0.15","tagName":"h3"},{"title":"ArrayData Class‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#arraydata-class","content":" The ArrayData class provides access to list/array elements:  class ArrayData { public: // Null check bool is_null_at(int i) const; // Element count int num_elements() const; // Primitive getters (same as Row) int32_t get_int32(int i) const; // ... other primitives // String getter std::string get_string(int i) const; // Nested types std::shared_ptr&lt;Row&gt; get_struct(int i) const; std::shared_ptr&lt;ArrayData&gt; get_array(int i) const; std::shared_ptr&lt;MapData&gt; get_map(int i) const; // Type info ListTypePtr type() const; };   ","version":"0.15","tagName":"h3"},{"title":"MapData Class‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#mapdata-class","content":" The MapData class provides access to map key-value pairs:  class MapData { public: // Element count int num_elements(); // Access keys and values as arrays std::shared_ptr&lt;ArrayData&gt; keys_array(); std::shared_ptr&lt;ArrayData&gt; values_array(); // Type info MapTypePtr type(); };   ","version":"0.15","tagName":"h3"},{"title":"Schema and Types‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#schema-and-types","content":" ","version":"0.15","tagName":"h2"},{"title":"Schema Definition‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#schema-definition","content":" Schemas define the structure of row data:  #include &quot;fory/row/schema.h&quot; using namespace fory::row; // Create schema programmatically auto person_schema = schema({ field(&quot;id&quot;, int32()), field(&quot;name&quot;, utf8()), field(&quot;score&quot;, float32()), field(&quot;active&quot;, boolean()) }); // Access schema info for (const auto&amp; f : person_schema-&gt;fields()) { std::cout &lt;&lt; f-&gt;name() &lt;&lt; &quot;: &quot; &lt;&lt; f-&gt;type()-&gt;name() &lt;&lt; std::endl; }   ","version":"0.15","tagName":"h3"},{"title":"Type System‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#type-system","content":" Available types for row format:  // Primitive types DataTypePtr boolean(); // bool DataTypePtr int8(); // int8_t DataTypePtr int16(); // int16_t DataTypePtr int32(); // int32_t DataTypePtr int64(); // int64_t DataTypePtr float32(); // float DataTypePtr float64(); // double // String and binary DataTypePtr utf8(); // std::string DataTypePtr binary(); // std::vector&lt;uint8_t&gt; // Complex types DataTypePtr list(DataTypePtr element_type); DataTypePtr map(DataTypePtr key_type, DataTypePtr value_type); DataTypePtr struct_(std::vector&lt;FieldPtr&gt; fields);   ","version":"0.15","tagName":"h3"},{"title":"Type Inference‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#type-inference","content":" The RowEncodeTrait template automatically infers types:  // Type inference for primitives RowEncodeTrait&lt;int32_t&gt;::Type(); // Returns int32() RowEncodeTrait&lt;float&gt;::Type(); // Returns float32() RowEncodeTrait&lt;std::string&gt;::Type(); // Returns utf8() // Type inference for collections RowEncodeTrait&lt;std::vector&lt;int32_t&gt;&gt;::Type(); // Returns list(int32()) // Type inference for maps RowEncodeTrait&lt;std::map&lt;std::string, int32_t&gt;&gt;::Type(); // Returns map(utf8(), int32()) // Type inference for structs (requires FORY_STRUCT) RowEncodeTrait&lt;Person&gt;::Type(); // Returns struct_({...}) RowEncodeTrait&lt;Person&gt;::Schema(); // Returns schema({...})   ","version":"0.15","tagName":"h3"},{"title":"Row Writer‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#row-writer","content":" ","version":"0.15","tagName":"h2"},{"title":"RowWriter‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#rowwriter","content":" For manual row construction:  #include &quot;fory/row/writer.h&quot; // Create schema auto my_schema = schema({ field(&quot;x&quot;, int32()), field(&quot;y&quot;, float64()), field(&quot;name&quot;, utf8()) }); // Create writer RowWriter writer(my_schema); writer.reset(); // write fields writer.write(0, 42); // x = 42 writer.write(1, 3.14); // y = 3.14 writer.write_string(2, &quot;test&quot;); // name = &quot;test&quot; // get result auto row = writer.to_row();   ","version":"0.15","tagName":"h3"},{"title":"ArrayWriter‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#arraywriter","content":" For manual array construction:  // Create array type auto array_type = list(int32()); // Create writer ArrayWriter writer(array_type); writer.reset(5); // 5 elements // write elements for (int i = 0; i &lt; 5; i++) { writer.write(i, i * 10); } // get result auto array = writer.copy_to_array_data();   ","version":"0.15","tagName":"h3"},{"title":"Null Values‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#null-values","content":" // Set null at specific index writer.set_null_at(2); // Field 2 is null // Check null when reading if (!row-&gt;is_null_at(2)) { std::string value = row-&gt;get_string(2); }   ","version":"0.15","tagName":"h3"},{"title":"Memory Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#memory-layout","content":" ","version":"0.15","tagName":"h2"},{"title":"Row Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#row-layout","content":" +------------------+--------------------+--------------------+ | Null Bitmap | Fixed-Size Data | Variable-Size Data | +------------------+--------------------+--------------------+ | ceil(n/8) B | 8 * n bytes | variable | +------------------+--------------------+--------------------+   Null Bitmap: One bit per field, indicates null valuesFixed-Size Data: 8 bytes per field (primitives stored directly, offset+size for variable)Variable-Size Data: Strings, arrays, nested structs  ","version":"0.15","tagName":"h3"},{"title":"Array Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#array-layout","content":" +------------+------------------+--------------------+--------------------+ | Num Elems | Null Bitmap | Fixed-Size Data | Variable-Size Data | +------------+------------------+--------------------+--------------------+ | 8 bytes | ceil(n/8) bytes | elem_size * n | variable | +------------+------------------+--------------------+--------------------+   ","version":"0.15","tagName":"h3"},{"title":"Map Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#map-layout","content":" +------------------+------------------+ | Keys Array | Values Array | +------------------+------------------+   ","version":"0.15","tagName":"h3"},{"title":"Performance Tips‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#performance-tips","content":" ","version":"0.15","tagName":"h2"},{"title":"1. Reuse Encoders‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#1-reuse-encoders","content":" RowEncoder&lt;Person&gt; encoder; // encode multiple records for (const auto&amp; person : people) { encoder.encode(person); auto row = encoder.get_writer().to_row(); // Process row... }   ","version":"0.15","tagName":"h3"},{"title":"2. Pre-allocate Buffer‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#2-pre-allocate-buffer","content":" // get buffer reference for pre-allocation auto&amp; buffer = encoder.get_writer().buffer(); buffer-&gt;reserve(expected_size);   ","version":"0.15","tagName":"h3"},{"title":"3. Batch Processing‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#3-batch-processing","content":" // Process in batches for better cache utilization std::vector&lt;Person&gt; batch; batch.reserve(BATCH_SIZE); while (has_more()) { batch.clear(); fill_batch(batch); for (const auto&amp; person : batch) { encoder.encode(person); process(encoder.get_writer().to_row()); } }   ","version":"0.15","tagName":"h3"},{"title":"4. Zero-copy Reading‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#4-zero-copy-reading","content":" // Point to existing buffer (zero-copy) Row row(schema); row.point_to(buffer, offset, size); // Access fields directly from buffer int32_t id = row.get_int32(0);   ","version":"0.15","tagName":"h3"},{"title":"Supported Types Summary‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#supported-types-summary","content":" C++ Type\tRow Type\tFixed Sizebool\tboolean()\t1 byte int8_t\tint8()\t1 byte int16_t\tint16()\t2 bytes int32_t\tint32()\t4 bytes int64_t\tint64()\t8 bytes float\tfloat32()\t4 bytes double\tfloat64()\t8 bytes std::string\tutf8()\tVariable std::vector&lt;T&gt;\tlist(T)\tVariable std::map&lt;K,V&gt;\tmap(K,V)\tVariable std::optional&lt;T&gt;\tInner type\tNullable Struct (FORY_STRUCT)\tstruct_({...})\tVariable  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/cpp/row_format#related-topics","content":" Basic Serialization - Object graph serializationConfiguration - Builder optionsSupported Types - All supported types ","version":"0.15","tagName":"h2"},{"title":"Supported Types","type":0,"sectionRef":"#","url":"/docs/guide/cpp/supported_types","content":"","keywords":"","version":"0.15"},{"title":"Primitive Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/cpp/supported_types#primitive-types","content":" All C++ primitive types are supported with efficient binary encoding:  Type\tSize\tFory TypeId\tNotesbool\t1 byte\tBOOL\tTrue/false int8_t\t1 byte\tINT8\tSigned byte uint8_t\t1 byte\tINT8\tUnsigned byte int16_t\t2 byte\tINT16\tSigned short uint16_t\t2 byte\tINT16\tUnsigned short int32_t\t4 byte\tINT32\tSigned integer uint32_t\t4 byte\tINT32\tUnsigned integer int64_t\t8 byte\tINT64\tSigned long uint64_t\t8 byte\tINT64\tUnsigned long float\t4 byte\tFLOAT32\tIEEE 754 single double\t8 byte\tFLOAT64\tIEEE 754 double char\t1 byte\tINT8\tCharacter (as signed) char16_t\t2 byte\tINT16\t16-bits characters char32_t\t4 byte\tINT32\t32-bits characters  int32_t value = 42; auto bytes = fory.serialize(value).value(); auto decoded = fory.deserialize&lt;int32_t&gt;(bytes).value(); assert(value == decoded);   ","version":"0.15","tagName":"h2"},{"title":"String Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/cpp/supported_types#string-types","content":" Type\tFory TypeId\tNotesstd::string\tSTRING\tUTF-8 encoded std::string_view\tSTRING\tZero-copy view (read) std::u16string\tSTRING\tUTF-16 (converted) binary\tBINARY\tRaw bytes without length  std::string text = &quot;Hello, World!&quot;; auto bytes = fory.serialize(text).value(); auto decoded = fory.deserialize&lt;std::string&gt;(bytes).value(); assert(text == decoded);   ","version":"0.15","tagName":"h2"},{"title":"Collection Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/cpp/supported_types#collection-types","content":" ","version":"0.15","tagName":"h2"},{"title":"Vector / List‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/cpp/supported_types#vector--list","content":" std::vector&lt;T&gt; for any serializable element type:  std::vector&lt;int32_t&gt; numbers{1, 2, 3, 4, 5}; auto bytes = fory.serialize(numbers).value(); auto decoded = fory.deserialize&lt;std::vector&lt;int32_t&gt;&gt;(bytes).value(); // Nested vectors std::vector&lt;std::vector&lt;std::string&gt;&gt; nested{ {&quot;a&quot;, &quot;b&quot;}, {&quot;c&quot;, &quot;d&quot;, &quot;e&quot;} };   ","version":"0.15","tagName":"h3"},{"title":"Set‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/cpp/supported_types#set","content":" std::set&lt;T&gt; and std::unordered_set&lt;T&gt;:  std::set&lt;std::string&gt; tags{&quot;cpp&quot;, &quot;serialization&quot;, &quot;fory&quot;}; auto bytes = fory.serialize(tags).value(); auto decoded = fory.deserialize&lt;std::set&lt;std::string&gt;&gt;(bytes).value(); std::unordered_set&lt;int32_t&gt; ids{1, 2, 3};   ","version":"0.15","tagName":"h3"},{"title":"Map‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/cpp/supported_types#map","content":" std::map&lt;K, V&gt; and std::unordered_map&lt;K, V&gt;:  std::map&lt;std::string, int32_t&gt; scores{ {&quot;Alice&quot;, 100}, {&quot;Bob&quot;, 95} }; auto bytes = fory.serialize(scores).value(); auto decoded = fory.deserialize&lt;std::map&lt;std::string, int32_t&gt;&gt;(bytes).value(); // Unordered map std::unordered_map&lt;int32_t, std::string&gt; lookup{ {1, &quot;one&quot;}, {2, &quot;two&quot;} };   ","version":"0.15","tagName":"h3"},{"title":"Smart Pointers‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/cpp/supported_types#smart-pointers","content":" ","version":"0.15","tagName":"h2"},{"title":"std::optional‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/cpp/supported_types#stdoptional","content":" Nullable wrapper for any type:  std::optional&lt;int32_t&gt; maybe_value = 42; std::optional&lt;int32_t&gt; empty_value = std::nullopt; auto bytes = fory.serialize(maybe_value).value(); auto decoded = fory.deserialize&lt;std::optional&lt;int32_t&gt;&gt;(bytes).value(); assert(decoded.has_value() &amp;&amp; *decoded == 42);   ","version":"0.15","tagName":"h3"},{"title":"std::shared_ptr‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/cpp/supported_types#stdshared_ptr","content":" Shared ownership with reference tracking:  auto shared = std::make_shared&lt;Person&gt;(&quot;Alice&quot;, 30); auto bytes = fory.serialize(shared).value(); auto decoded = fory.deserialize&lt;std::shared_ptr&lt;Person&gt;&gt;(bytes).value();   With reference tracking enabled (default, track_ref(true)):  Shared objects are serialized onceReferences to the same object are preservedCircular references are handled automatically  ","version":"0.15","tagName":"h3"},{"title":"std::unique_ptr‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/cpp/supported_types#stdunique_ptr","content":" Exclusive ownership:  auto unique = std::make_unique&lt;Person&gt;(&quot;Bob&quot;, 25); auto bytes = fory.serialize(unique).value(); auto decoded = fory.deserialize&lt;std::unique_ptr&lt;Person&gt;&gt;(bytes).value();   ","version":"0.15","tagName":"h3"},{"title":"Variant Type‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/cpp/supported_types#variant-type","content":" std::variant&lt;Ts...&gt; for type-safe unions:  using MyVariant = std::variant&lt;int32_t, std::string, double&gt;; MyVariant v1 = 42; MyVariant v2 = std::string(&quot;hello&quot;); MyVariant v3 = 3.14; auto bytes = fory.serialize(v1).value(); auto decoded = fory.deserialize&lt;MyVariant&gt;(bytes).value(); assert(std::get&lt;int32_t&gt;(decoded) == 42);   ","version":"0.15","tagName":"h2"},{"title":"std::monostate‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/cpp/supported_types#stdmonostate","content":" Empty variant alternative:  using OptionalInt = std::variant&lt;std::monostate, int32_t&gt;; OptionalInt empty = std::monostate{}; OptionalInt value = 42;   ","version":"0.15","tagName":"h3"},{"title":"Temporal Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/cpp/supported_types#temporal-types","content":" ","version":"0.15","tagName":"h2"},{"title":"Duration‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/cpp/supported_types#duration","content":" std::chrono::nanoseconds:  using Duration = std::chrono::nanoseconds; Duration d = std::chrono::seconds(30); auto bytes = fory.serialize(d).value(); auto decoded = fory.deserialize&lt;Duration&gt;(bytes).value();   ","version":"0.15","tagName":"h3"},{"title":"Timestamp‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/cpp/supported_types#timestamp","content":" Point in time since Unix epoch:  using Timestamp = std::chrono::time_point&lt;std::chrono::system_clock, std::chrono::nanoseconds&gt;; Timestamp now = std::chrono::system_clock::now(); auto bytes = fory.serialize(now).value(); auto decoded = fory.deserialize&lt;Timestamp&gt;(bytes).value();   ","version":"0.15","tagName":"h3"},{"title":"Date‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/cpp/supported_types#date","content":" Days since Unix epoch:  Date date{18628}; // Days since 1970-01-01 auto bytes = fory.serialize(date).value(); auto decoded = fory.deserialize&lt;Date&gt;(bytes).value();   ","version":"0.15","tagName":"h3"},{"title":"User-Defined Structs‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/cpp/supported_types#user-defined-structs","content":" Any struct can be made serializable with FORY_STRUCT:  struct Point { double x; double y; double z; }; FORY_STRUCT(Point, x, y, z); struct Line { Point start; Point end; std::string label; }; FORY_STRUCT(Line, start, end, label);   ","version":"0.15","tagName":"h2"},{"title":"Enum Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/cpp/supported_types#enum-types","content":" Both scoped and unscoped enums are supported with FORY_ENUM:  // Scoped enum (C++11 enum class) enum class Color { RED = 0, GREEN = 1, BLUE = 2 }; // Unscoped enum with incontinuous values enum Priority : int32_t { LOW = -10, NORMAL = 0, HIGH = 10 }; FORY_ENUM(Priority, LOW, NORMAL, HIGH); // FORY_ENUM must be defined at namespace scope. // Usage Color c = Color::GREEN; auto bytes = fory.serialize(c).value(); auto decoded = fory.deserialize&lt;Color&gt;(bytes).value();   ","version":"0.15","tagName":"h2"},{"title":"Unsupported Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/cpp/supported_types#unsupported-types","content":" Currently not supported:  Raw pointers (T*) - use smart pointers insteadstd::tuple&lt;Ts...&gt; - use structs insteadstd::array&lt;T, N&gt; - use std::vector&lt;T&gt; insteadFunction pointersReferences (T&amp;, const T&amp;) - by value only  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/cpp/supported_types#related-topics","content":" Basic Serialization - Using these typesType Registration - Registering typesCross-Language - Cross-language compatibility ","version":"0.15","tagName":"h2"},{"title":"Schema Evolution","type":0,"sectionRef":"#","url":"/docs/guide/cpp/schema_evolution","content":"","keywords":"","version":"0.15"},{"title":"Compatible Mode‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/cpp/schema_evolution#compatible-mode","content":" Enable schema evolution with compatible(true):  #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; // Version 1: Original schema struct PersonV1 { std::string name; int32_t age; }; FORY_STRUCT(PersonV1, name, age); // Version 2: Added email field struct PersonV2 { std::string name; int32_t age; std::string email; // NEW FIELD }; FORY_STRUCT(PersonV2, name, age, email); int main() { // Create separate Fory instances for each schema version auto fory_v1 = Fory::builder() .compatible(true) // Enable schema evolution .xlang(true) .build(); auto fory_v2 = Fory::builder() .compatible(true) .xlang(true) .build(); // Register with the SAME type ID for schema evolution constexpr uint32_t PERSON_TYPE_ID = 100; fory_v1.register_struct&lt;PersonV1&gt;(PERSON_TYPE_ID); fory_v2.register_struct&lt;PersonV2&gt;(PERSON_TYPE_ID); // Serialize with V1 PersonV1 v1{&quot;Alice&quot;, 30}; auto bytes = fory_v1.serialize(v1).value(); // Deserialize as V2 - email gets default value (empty string) auto v2 = fory_v2.deserialize&lt;PersonV2&gt;(bytes).value(); assert(v2.name == &quot;Alice&quot;); assert(v2.age == 30); assert(v2.email == &quot;&quot;); // Default value for missing field return 0; }   ","version":"0.15","tagName":"h2"},{"title":"Disable Evolution for Stable Structs‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/cpp/schema_evolution#disable-evolution-for-stable-structs","content":" If a struct schema is stable and will not change, you can disable evolution for that struct to avoid compatible metadata overhead. Use FORY_STRUCT_EVOLVING after FORY_STRUCT:  struct StableMessage { int32_t id; }; FORY_STRUCT(StableMessage, id); FORY_STRUCT_EVOLVING(StableMessage, false);   ","version":"0.15","tagName":"h3"},{"title":"Schema Evolution Features‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/cpp/schema_evolution#schema-evolution-features","content":" Compatible mode supports the following schema changes:  Change Type\tSupport\tBehaviorAdd new fields\t‚úÖ\tMissing fields use default values Remove fields\t‚úÖ\tExtra fields are skipped Reorder fields\t‚úÖ\tFields matched by name, not position Change nullability\t‚úÖ\tT ‚Üî std::optional&lt;T&gt; Change field types\t‚ùå\tTypes must be compatible Rename fields\t‚ùå\tField names must match (case-sensitive)  ","version":"0.15","tagName":"h2"},{"title":"Adding Fields (Backward Compatibility)‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/cpp/schema_evolution#adding-fields-backward-compatibility","content":" When deserializing old data with a new schema that has additional fields:  // Old schema (V1) struct ProductV1 { std::string name; double price; }; FORY_STRUCT(ProductV1, name, price); // New schema (V2) with additional fields struct ProductV2 { std::string name; double price; std::vector&lt;std::string&gt; tags; // NEW std::map&lt;std::string, std::string&gt; attributes; // NEW }; FORY_STRUCT(ProductV2, name, price, tags, attributes); // Serialize V1 ProductV1 v1{&quot;Laptop&quot;, 999.99}; auto bytes = fory_v1.serialize(v1).value(); // Deserialize as V2 auto v2 = fory_v2.deserialize&lt;ProductV2&gt;(bytes).value(); assert(v2.name == &quot;Laptop&quot;); assert(v2.price == 999.99); assert(v2.tags.empty()); // Default: empty vector assert(v2.attributes.empty()); // Default: empty map   ","version":"0.15","tagName":"h2"},{"title":"Removing Fields (Forward Compatibility)‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/cpp/schema_evolution#removing-fields-forward-compatibility","content":" When deserializing new data with an old schema that has fewer fields:  // Full schema struct UserFull { int64_t id; std::string username; std::string email; std::string password_hash; int32_t login_count; }; FORY_STRUCT(UserFull, id, username, email, password_hash, login_count); // Minimal schema (removed 3 fields) struct UserMinimal { int64_t id; std::string username; }; FORY_STRUCT(UserMinimal, id, username); // Serialize full version UserFull full{12345, &quot;johndoe&quot;, &quot;john@example.com&quot;, &quot;hash123&quot;, 42}; auto bytes = fory_full.serialize(full).value(); // Deserialize as minimal - extra fields are skipped auto minimal = fory_minimal.deserialize&lt;UserMinimal&gt;(bytes).value(); assert(minimal.id == 12345); assert(minimal.username == &quot;johndoe&quot;); // email, password_hash, login_count are skipped   ","version":"0.15","tagName":"h2"},{"title":"Field Reordering‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/cpp/schema_evolution#field-reordering","content":" In compatible mode, fields are matched by name, not by position:  // Original field order struct ConfigOriginal { std::string host; int32_t port; bool enable_ssl; std::string protocol; }; FORY_STRUCT(ConfigOriginal, host, port, enable_ssl, protocol); // Reordered fields struct ConfigReordered { bool enable_ssl; // Moved to first std::string protocol; // Moved to second std::string host; // Moved to third int32_t port; // Moved to last }; FORY_STRUCT(ConfigReordered, enable_ssl, protocol, host, port); // Serialize with original order ConfigOriginal orig{&quot;localhost&quot;, 8080, true, &quot;https&quot;}; auto bytes = fory_orig.serialize(orig).value(); // Deserialize with different field order - works correctly auto reordered = fory_reord.deserialize&lt;ConfigReordered&gt;(bytes).value(); assert(reordered.host == &quot;localhost&quot;); assert(reordered.port == 8080); assert(reordered.enable_ssl == true); assert(reordered.protocol == &quot;https&quot;);   ","version":"0.15","tagName":"h2"},{"title":"Nested Struct Evolution‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/cpp/schema_evolution#nested-struct-evolution","content":" Schema evolution works recursively for nested structs:  // V1 Address struct AddressV1 { std::string street; std::string city; }; FORY_STRUCT(AddressV1, street, city); // V2 Address with new fields struct AddressV2 { std::string street; std::string city; std::string country; // NEW std::string zipcode; // NEW }; FORY_STRUCT(AddressV2, street, city, country, zipcode); // V1 Employee with V1 Address struct EmployeeV1 { std::string name; AddressV1 home_address; }; FORY_STRUCT(EmployeeV1, name, home_address); // V2 Employee with V2 Address and new field struct EmployeeV2 { std::string name; AddressV2 home_address; // Nested struct evolved std::string employee_id; // NEW }; FORY_STRUCT(EmployeeV2, name, home_address, employee_id); // Register types with same IDs constexpr uint32_t ADDRESS_TYPE_ID = 100; constexpr uint32_t EMPLOYEE_TYPE_ID = 101; fory_v1.register_struct&lt;AddressV1&gt;(ADDRESS_TYPE_ID); fory_v1.register_struct&lt;EmployeeV1&gt;(EMPLOYEE_TYPE_ID); fory_v2.register_struct&lt;AddressV2&gt;(ADDRESS_TYPE_ID); fory_v2.register_struct&lt;EmployeeV2&gt;(EMPLOYEE_TYPE_ID); // Serialize V1 EmployeeV1 emp_v1{&quot;Jane Doe&quot;, {&quot;123 Main St&quot;, &quot;NYC&quot;}}; auto bytes = fory_v1.serialize(emp_v1).value(); // Deserialize as V2 auto emp_v2 = fory_v2.deserialize&lt;EmployeeV2&gt;(bytes).value(); assert(emp_v2.name == &quot;Jane Doe&quot;); assert(emp_v2.home_address.street == &quot;123 Main St&quot;); assert(emp_v2.home_address.city == &quot;NYC&quot;); assert(emp_v2.home_address.country == &quot;&quot;); // Default assert(emp_v2.home_address.zipcode == &quot;&quot;); // Default assert(emp_v2.employee_id == &quot;&quot;); // Default   ","version":"0.15","tagName":"h2"},{"title":"Bidirectional Evolution‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/cpp/schema_evolution#bidirectional-evolution","content":" Schema evolution works in both directions:  // V2 -&gt; V1 (downgrade) PersonV2 v2{&quot;Charlie&quot;, 35, &quot;charlie@example.com&quot;}; auto bytes = fory_v2.serialize(v2).value(); auto v1 = fory_v1.deserialize&lt;PersonV1&gt;(bytes).value(); assert(v1.name == &quot;Charlie&quot;); assert(v1.age == 35); // email field is discarded during deserialization   ","version":"0.15","tagName":"h2"},{"title":"Default Values‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/cpp/schema_evolution#default-values","content":" When fields are missing, C++ default initialization is used:  Type\tDefault Valueint8_t, int16_t...\t0 float, double\t0.0 bool\tfalse std::string\t&quot;&quot; std::vector&lt;T&gt;\tEmpty vector std::map&lt;K,V&gt;\tEmpty map std::set&lt;T&gt;\tEmpty set std::optional&lt;T&gt;\tstd::nullopt Struct types\tDefault-constructed  ","version":"0.15","tagName":"h2"},{"title":"Schema Consistent Mode (Default)‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/cpp/schema_evolution#schema-consistent-mode-default","content":" Without compatible mode, schemas must match exactly:  // Strict mode (default) auto fory = Fory::builder() .compatible(false) // Default: schema must match .xlang(true) .build(); // Serialization/deserialization requires identical schemas // Schema mismatches may cause errors or undefined behavior   Use SchemaConsistent mode when:  Schemas are guaranteed to match (same binary version)Maximum performance is required (less metadata overhead)You control both serialization and deserialization  Use Compatible mode when:  Schemas may evolve independentlyCross-version compatibility is requiredDifferent services may have different schema versions  ","version":"0.15","tagName":"h2"},{"title":"Type ID Requirements‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/cpp/schema_evolution#type-id-requirements","content":" For schema evolution to work:  Same Type ID: Different versions of the same struct must use the same type IDConsistent IDs: Type IDs must be consistent across all Fory instancesRegister All Versions: Each Fory instance registers its own struct version  constexpr uint32_t PERSON_TYPE_ID = 100; // Instance 1 uses PersonV1 fory_v1.register_struct&lt;PersonV1&gt;(PERSON_TYPE_ID); // Instance 2 uses PersonV2 fory_v2.register_struct&lt;PersonV2&gt;(PERSON_TYPE_ID); // Same type ID enables schema evolution   ","version":"0.15","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/cpp/schema_evolution#best-practices","content":" ","version":"0.15","tagName":"h2"},{"title":"1. Plan for Evolution‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/cpp/schema_evolution#1-plan-for-evolution","content":" Design schemas with future changes in mind:  // Good: Use optional for fields that might be removed struct Config { std::string host; int32_t port; std::optional&lt;std::string&gt; deprecated_field; // Can be removed later };   ","version":"0.15","tagName":"h3"},{"title":"2. Use Meaningful Default Values‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/cpp/schema_evolution#2-use-meaningful-default-values","content":" Consider what default values make sense for new fields:  struct Settings { int32_t timeout_ms; // Default: 0 (might want a sensible default) bool enabled; // Default: false std::string mode; // Default: &quot;&quot; (might want &quot;default&quot;) };   ","version":"0.15","tagName":"h3"},{"title":"3. Document Schema Versions‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/cpp/schema_evolution#3-document-schema-versions","content":" Track schema changes for debugging:  // V1: Initial schema (2024-01-01) // V2: Added email field (2024-02-01) // V3: Added phone, address fields (2024-03-01)   ","version":"0.15","tagName":"h3"},{"title":"4. Test Evolution Paths‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/cpp/schema_evolution#4-test-evolution-paths","content":" Test both upgrade and downgrade scenarios:  // Test V1 -&gt; V2 // Test V2 -&gt; V1 // Test V1 -&gt; V3 // Test V3 -&gt; V1   ","version":"0.15","tagName":"h3"},{"title":"Cross-Language Schema Evolution‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/cpp/schema_evolution#cross-language-schema-evolution","content":" Schema evolution works across languages when using xlang mode:  // C++ with compatible mode auto fory = Fory::builder() .compatible(true) .xlang(true) .build();   // Java with compatible mode Fory fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .withLanguage(Language.XLANG) .build();   Both instances can exchange data even with different schema versions.  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/cpp/schema_evolution#related-topics","content":" Configuration - Enabling compatible modeType Registration - Type ID managementCross-Language - Cross-language considerations ","version":"0.15","tagName":"h2"},{"title":"Type Registration","type":0,"sectionRef":"#","url":"/docs/guide/cpp/type_registration","content":"","keywords":"","version":"0.15"},{"title":"Overview‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/cpp/type_registration#overview","content":" Apache Fory‚Ñ¢ requires explicit type registration for struct types. This design enables:  Cross-Language Compatibility: Registered type IDs are used across language boundariesType Safety: Detects type mismatches at deserialization timePolymorphic Serialization: Enables serialization of polymorphic objects via smart pointers  ","version":"0.15","tagName":"h2"},{"title":"Registering Structs‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/cpp/type_registration#registering-structs","content":" Use register_struct&lt;T&gt;(type_id) to register a struct type:  #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; struct Person { std::string name; int32_t age; }; FORY_STRUCT(Person, name, age); int main() { auto fory = Fory::builder().xlang(true).build(); // Register with a unique type ID fory.register_struct&lt;Person&gt;(100); Person person{&quot;Alice&quot;, 30}; auto bytes = fory.serialize(person).value(); auto decoded = fory.deserialize&lt;Person&gt;(bytes).value(); }   ","version":"0.15","tagName":"h2"},{"title":"Type ID Guidelines‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/cpp/type_registration#type-id-guidelines","content":" Type IDs must be:  Unique: Each type must have a unique ID within a Fory instanceConsistent: Same ID must be used across all languages and versions  User-registered type IDs are in a separate namespace from built-in type IDs, so you can start from 0:  // User type IDs can start from 0 fory.register_struct&lt;Address&gt;(0); fory.register_struct&lt;Person&gt;(1); fory.register_struct&lt;Order&gt;(2);   ","version":"0.15","tagName":"h2"},{"title":"Registering Enums‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/cpp/type_registration#registering-enums","content":" Use register_enum&lt;T&gt;(type_id) to register an enum type. For simple enums with continuous values starting from 0, no macro is needed:  // Simple continuous enum - no FORY_ENUM needed enum class Color { RED, GREEN, BLUE }; // Values: 0, 1, 2 // Register with register_enum fory.register_enum&lt;Color&gt;(0);   For enums with non-continuous values, use the FORY_ENUM macro to map values to ordinals:  // Non-continuous enum values - FORY_ENUM required enum class Priority { LOW = 10, MEDIUM = 50, HIGH = 100 }; FORY_ENUM(Priority, LOW, MEDIUM, HIGH); // FORY_ENUM must be defined at namespace scope. // Global namespace enum (prefix with ::) enum LegacyStatus { UNKNOWN = -1, OK = 0, ERROR = 1 }; FORY_ENUM(::LegacyStatus, UNKNOWN, OK, ERROR); // Register after FORY_ENUM fory.register_enum&lt;Priority&gt;(1); fory.register_enum&lt;LegacyStatus&gt;(2);   When to use FORY_ENUM:  Enum values don't start from 0Enum values are not continuous (e.g., 10, 50, 100)You need name-to-value mapping at compile time  ","version":"0.15","tagName":"h2"},{"title":"Thread-Safe Registration‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/cpp/type_registration#thread-safe-registration","content":" For ThreadSafeFory, register types before spawning threads:  auto fory = Fory::builder().xlang(true).build_thread_safe(); // Register all types first fory.register_struct&lt;TypeA&gt;(100); fory.register_struct&lt;TypeB&gt;(101); // Now safe to use from multiple threads std::thread t1([&amp;]() { auto result = fory.serialize(obj_a); }); std::thread t2([&amp;]() { auto result = fory.serialize(obj_b); });   ","version":"0.15","tagName":"h2"},{"title":"Cross-Language Registration‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/cpp/type_registration#cross-language-registration","content":" For cross-language compatibility, ensure:  Same Type ID: Use identical IDs in all languagesCompatible Types: Use equivalent types across languages  ","version":"0.15","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/cpp/type_registration#java","content":" Fory fory = Fory.builder().withXlang(true).build(); fory.register(Person.class, 100); fory.register(Address.class, 101);   ","version":"0.15","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/cpp/type_registration#python","content":" import pyfory fory = pyfory.Fory(xlang=True) fory.register(Person, type_id=100) fory.register(Address, type_id=101)   ","version":"0.15","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/cpp/type_registration#c","content":" auto fory = Fory::builder().xlang(true).build(); fory.register_struct&lt;Person&gt;(100); fory.register_struct&lt;Address&gt;(101);   ","version":"0.15","tagName":"h3"},{"title":"Built-in Type IDs‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/cpp/type_registration#built-in-type-ids","content":" Built-in types have pre-assigned type IDs and don't need registration:  Type ID\tType0\tNONE 1\tBOOL 2\tINT8 3\tINT16 4\tINT32 5\tVAR_INT32 6\tINT64 7\tVAR_INT64 8\tSLI_INT64 9\tFLOAT16 10\tFLOAT32 11\tFLOAT64 12\tSTRING 13\tLIST 14\tMAP 15\tSET 16\tTIMESTAMP 17\tDURATION 18\tDATE 19\tDECIMAL 20\tBINARY 21\tARRAY 22\tBOOL_ARRAY 23-28\tINT_ARRAY variants 29-31\tFLOAT_ARRAY variants 32\tSTRUCT 33\tCOMPATIBLE_STRUCT 34\tNAMED_STRUCT 35\tNAMEDCOMPATIBLE... 36\tEXT 37\tNAMED_EXT 63\tUNKNOWN  ","version":"0.15","tagName":"h2"},{"title":"Error Handling‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/cpp/type_registration#error-handling","content":" Registration errors are checked at serialization/deserialization time:  // Attempting to serialize unregistered type auto result = fory.serialize(unregistered_obj); if (!result.ok()) { // Error: &quot;Type not registered: ...&quot; std::cerr &lt;&lt; result.error().to_string() &lt;&lt; std::endl; } // Type ID mismatch during deserialization auto result = fory.deserialize&lt;WrongType&gt;(bytes); if (!result.ok()) { // Error: &quot;Type mismatch: expected X, got Y&quot; std::cerr &lt;&lt; result.error().to_string() &lt;&lt; std::endl; }   ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/cpp/type_registration#related-topics","content":" Basic Serialization - Using registered typesCross-Language - Cross-language considerationsSupported Types - All supported types ","version":"0.15","tagName":"h2"},{"title":"Development","type":0,"sectionRef":"#","url":"/docs/guide/development","content":"","keywords":"","version":"0.15"},{"title":"How to build Apache Fory‚Ñ¢‚Äã","type":1,"pageTitle":"Development","url":"/docs/guide/development#how-to-build-apache-fory","content":" Clone the source tree from https://github.com/apache/fory.  ","version":"0.15","tagName":"h2"},{"title":"Build Apache Fory‚Ñ¢ Java‚Äã","type":1,"pageTitle":"Development","url":"/docs/guide/development#build-apache-fory-java","content":" cd java mvn -T16 package   Environment Requirements‚Äã  JDK 17+Maven 3.6.3+  ","version":"0.15","tagName":"h3"},{"title":"Build Apache Fory‚Ñ¢ Python‚Äã","type":1,"pageTitle":"Development","url":"/docs/guide/development#build-apache-fory-python","content":" cd python pip install -v -e . # Optional: build Cython extension (replace X.Y with your Python version) bazel build //:cp_fory_so --@rules_python//python/config_settings:python_version=X.Y   Environment Requirements‚Äã  CPython 3.8+Bazel 8+ (required when building Cython extensions)  ","version":"0.15","tagName":"h3"},{"title":"Build Apache Fory‚Ñ¢ C++‚Äã","type":1,"pageTitle":"Development","url":"/docs/guide/development#build-apache-fory-c","content":" cd cpp bazel build //cpp/...   Environment Requirements‚Äã  C++17 compilerBazel 8+  ","version":"0.15","tagName":"h3"},{"title":"Build Apache Fory‚Ñ¢ Go‚Äã","type":1,"pageTitle":"Development","url":"/docs/guide/development#build-apache-fory-go","content":" cd go/fory go test -v ./...   Run Go xlang tests from Java test module:  cd java mvn -T16 install -DskipTests cd fory-core FORY_GO_JAVA_CI=1 ENABLE_FORY_DEBUG_OUTPUT=1 mvn test -Dtest=org.apache.fory.xlang.GoXlangTest   Environment Requirements‚Äã  Go 1.24+  ","version":"0.15","tagName":"h3"},{"title":"Build Apache Fory‚Ñ¢ Rust‚Äã","type":1,"pageTitle":"Development","url":"/docs/guide/development#build-apache-fory-rust","content":" cd rust cargo build cargo test --features tests # Debug a specific test RUST_BACKTRACE=1 FORY_PANIC_ON_ERROR=1 ENABLE_FORY_DEBUG_OUTPUT=1 \\ cargo test --test mod $dir$::$test_file::$test_method -- --nocapture   Environment Requirements‚Äã  Rust toolchain via rustupcargo-expand (optional, for macro expansion debugging)  ","version":"0.15","tagName":"h3"},{"title":"Build Apache Fory‚Ñ¢ JavaScript‚Äã","type":1,"pageTitle":"Development","url":"/docs/guide/development#build-apache-fory-javascript","content":" cd javascript npm install npm run build node ./node_modules/.bin/jest --ci --reporters=default --reporters=jest-junit   Environment Requirements‚Äã  Node.js (LTS)npm  ","version":"0.15","tagName":"h3"},{"title":"Lint Markdown Docs‚Äã","type":1,"pageTitle":"Development","url":"/docs/guide/development#lint-markdown-docs","content":" cd docs npx prettier --write &quot;**/*.md&quot;   Environment Requirements‚Äã  Node.js (LTS)npm  ","version":"0.15","tagName":"h3"},{"title":"Contributing‚Äã","type":1,"pageTitle":"Development","url":"/docs/guide/development#contributing","content":" For contribution details, see How to contribute to Apache Fory‚Ñ¢. ","version":"0.15","tagName":"h2"},{"title":"Go Serialization Guide","type":0,"sectionRef":"#","url":"/docs/guide/go/","content":"","keywords":"","version":"0.15"},{"title":"Why Fory Go?‚Äã","type":1,"pageTitle":"Go Serialization Guide","url":"/docs/guide/go/#why-fory-go","content":" High Performance: Fast serialization and optimized binary protocolsCross-Language: Seamless data exchange with Java, Python, C++, Rust, and JavaScriptAutomatic Serialization: No IDL definitions or schema compilation requiredReference Tracking: Built-in support for circular references and shared objectsType Safety: Strong typing with compile-time verification (optional codegen)Schema Evolution: Compatible mode for forward/backward compatibilityThread-Safe Option: Pool-based thread-safe wrapper for concurrent use  ","version":"0.15","tagName":"h2"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Go Serialization Guide","url":"/docs/guide/go/#quick-start","content":" ","version":"0.15","tagName":"h2"},{"title":"Installation‚Äã","type":1,"pageTitle":"Go Serialization Guide","url":"/docs/guide/go/#installation","content":" Requirements: Go 1.24 or later  go get github.com/apache/fory/go/fory   ","version":"0.15","tagName":"h3"},{"title":"Basic Usage‚Äã","type":1,"pageTitle":"Go Serialization Guide","url":"/docs/guide/go/#basic-usage","content":" package main import ( &quot;fmt&quot; &quot;github.com/apache/fory/go/fory&quot; ) type User struct { ID int64 Name string Age int32 } func main() { // Create a Fory instance f := fory.New() // Register struct with a type ID if err := f.RegisterStruct(User{}, 1); err != nil { panic(err) } // Serialize user := &amp;User{ID: 1, Name: &quot;Alice&quot;, Age: 30} data, err := f.Serialize(user) if err != nil { panic(err) } // Deserialize var result User if err := f.Deserialize(data, &amp;result); err != nil { panic(err) } fmt.Printf(&quot;Deserialized: %+v\\n&quot;, result) // Output: Deserialized: {ID:1 Name:Alice Age:30} }   ","version":"0.15","tagName":"h3"},{"title":"Architecture‚Äã","type":1,"pageTitle":"Go Serialization Guide","url":"/docs/guide/go/#architecture","content":" Fory Go provides two serialization paths:  ","version":"0.15","tagName":"h2"},{"title":"Reflection-Based (Default)‚Äã","type":1,"pageTitle":"Go Serialization Guide","url":"/docs/guide/go/#reflection-based-default","content":" The default path uses Go's reflection to inspect types at runtime. This works out-of-the-box with any struct. Although this mode uses reflection, it is highly optimized with type caching, inlined hot paths, delivering excellent performance for most use cases:  f := fory.New() data, _ := f.Serialize(myStruct)   ","version":"0.15","tagName":"h3"},{"title":"Code Generation (Experimental)‚Äã","type":1,"pageTitle":"Go Serialization Guide","url":"/docs/guide/go/#code-generation-experimental","content":" For performance-critical paths, Fory provides optional ahead-of-time code generation that eliminates reflection overhead. See the Code Generation guide for details.  ","version":"0.15","tagName":"h3"},{"title":"Configuration‚Äã","type":1,"pageTitle":"Go Serialization Guide","url":"/docs/guide/go/#configuration","content":" Fory Go uses a functional options pattern for configuration:  f := fory.New( fory.WithTrackRef(true), // Enable reference tracking fory.WithCompatible(true), // Enable schema evolution fory.WithMaxDepth(20), // Set max nesting depth )   See Configuration for all available options.  ","version":"0.15","tagName":"h2"},{"title":"Supported Types‚Äã","type":1,"pageTitle":"Go Serialization Guide","url":"/docs/guide/go/#supported-types","content":" Fory Go supports a wide range of types:  Primitives: bool, int8-int64, uint8-uint64, float32, float64, stringCollections: slices, maps, setsTime: time.Time, time.DurationPointers: pointer types with automatic nil handlingStructs: any struct with exported fields  See Supported Types for the complete type mapping.  ","version":"0.15","tagName":"h2"},{"title":"Cross-Language Serialization‚Äã","type":1,"pageTitle":"Go Serialization Guide","url":"/docs/guide/go/#cross-language-serialization","content":" Fory Go is fully compatible with other Fory implementations. Data serialized in Go can be deserialized in Java, Python, C++, Rust, or JavaScript:  // Go serialization f := fory.New() f.RegisterStruct(User{}, 1) data, _ := f.Serialize(&amp;User{ID: 1, Name: &quot;Alice&quot;}) // 'data' can be deserialized by Java, Python, etc.   See Cross-Language Serialization for type mapping and compatibility details.  ","version":"0.15","tagName":"h2"},{"title":"Documentation‚Äã","type":1,"pageTitle":"Go Serialization Guide","url":"/docs/guide/go/#documentation","content":" Topic\tDescriptionConfiguration\tOptions and settings Basic Serialization\tCore APIs and usage patterns Type Registration\tRegistering types for serialization Supported Types\tComplete type support reference References\tCircular references and shared objects Struct Tags\tField-level configuration Schema Evolution\tForward/backward compatibility Cross-Language\tMulti-language serialization Code Generation\tExperimental AOT code generation Thread Safety\tConcurrent usage patterns Troubleshooting\tCommon issues and solutions  ","version":"0.15","tagName":"h2"},{"title":"Related Resources‚Äã","type":1,"pageTitle":"Go Serialization Guide","url":"/docs/guide/go/#related-resources","content":" Xlang Serialization SpecificationCross-Language Type MappingGitHub Repository ","version":"0.15","tagName":"h2"},{"title":"Code Generation","type":0,"sectionRef":"#","url":"/docs/guide/go/codegen","content":"","keywords":"","version":"0.15"},{"title":"Why Code Generation?‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#why-code-generation","content":" Aspect\tReflection-Based\tCode GenerationSetup\tZero configuration\tRequires go generate Performance\tGood\tBetter (no reflection) Type Safety\tRuntime\tCompile-time Maintenance\tAutomatic\tRequires regeneration  Use code generation when:  Maximum performance is requiredCompile-time type safety is importantHot paths are performance-critical  Use reflection when:  Simple setup is preferredTypes change frequentlyDynamic typing is neededCode generation complexity is undesirable  ","version":"0.15","tagName":"h2"},{"title":"Installation‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#installation","content":" Install the fory generator binary:  go install github.com/apache/fory/go/fory/cmd/fory@latest GO111MODULE=on go get -u github.com/apache/fory/go/fory/cmd/fory   Ensure $GOBIN or $GOPATH/bin is in your PATH.  ","version":"0.15","tagName":"h2"},{"title":"Basic Usage‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#basic-usage","content":" ","version":"0.15","tagName":"h2"},{"title":"Step 1: Annotate Structs‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#step-1-annotate-structs","content":" Add the //fory:generate comment above structs:  package models //fory:generate type User struct { ID int64 `json:&quot;id&quot;` Name string `json:&quot;name&quot;` } //fory:generate type Order struct { ID int64 Customer string Total float64 }   ","version":"0.15","tagName":"h3"},{"title":"Step 2: Add Go Generate Directive‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#step-2-add-go-generate-directive","content":" Add a go:generate directive (once per file or package):  //go:generate fory -file models.go   Or for the entire package:  //go:generate fory -pkg .   ","version":"0.15","tagName":"h3"},{"title":"Step 3: Run Code Generation‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#step-3-run-code-generation","content":" go generate ./...   This creates models_fory_gen.go with generated serializers.  ","version":"0.15","tagName":"h3"},{"title":"Generated Code Structure‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#generated-code-structure","content":" The generator creates:  ","version":"0.15","tagName":"h2"},{"title":"Type Snapshot‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#type-snapshot","content":" A compile-time check to detect struct changes:  // Snapshot of User's underlying type at generation time type _User_expected struct { ID int64 Name string } // Compile-time check: fails if User no longer matches var _ = func(x User) { _ = _User_expected(x) }   ","version":"0.15","tagName":"h3"},{"title":"Serializer Implementation‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#serializer-implementation","content":" Strongly-typed serialization methods:  type User_ForyGenSerializer struct{} func NewSerializerFor_User() fory.Serializer { return &amp;User_ForyGenSerializer{} } func (User_ForyGenSerializer) WriteTyped(ctx *fory.WriteContext, v *User) error { buf := ctx.Buffer() buf.WriteInt64(v.ID) ctx.WriteString(v.Name) return nil } func (User_ForyGenSerializer) ReadTyped(ctx *fory.ReadContext, v *User) error { err := ctx.Err() buf := ctx.Buffer() v.ID = buf.ReadInt64(err) v.Name = ctx.ReadString() if ctx.HasError() { return ctx.TakeError() } return nil }   ","version":"0.15","tagName":"h3"},{"title":"Auto-Registration‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#auto-registration","content":" Serializers are registered in init():  func init() { fory.RegisterSerializerFactory((*User)(nil), NewSerializerFor_User) }   ","version":"0.15","tagName":"h3"},{"title":"Command-Line Options‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#command-line-options","content":" ","version":"0.15","tagName":"h2"},{"title":"File-Based Generation‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#file-based-generation","content":" Generate for a specific file:  fory -file models.go   ","version":"0.15","tagName":"h3"},{"title":"Package-Based Generation‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#package-based-generation","content":" Generate for a package:  fory -pkg ./models   ","version":"0.15","tagName":"h3"},{"title":"Explicit Types (Legacy)‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#explicit-types-legacy","content":" Specify types explicitly:  fory -pkg ./models -type &quot;User,Order&quot;   ","version":"0.15","tagName":"h3"},{"title":"Force Regeneration‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#force-regeneration","content":" Force regeneration even if up-to-date:  fory --force -file models.go   ","version":"0.15","tagName":"h3"},{"title":"When to Regenerate‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#when-to-regenerate","content":" Regenerate when any of these change:  Field additions, removals, or renamesField type changesStruct tag changesNew structs with //fory:generate  ","version":"0.15","tagName":"h2"},{"title":"Automatic Detection‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#automatic-detection","content":" Fory includes a compile-time guard:  // If struct changed, this fails to compile var _ = func(x User) { _ = _User_expected(x) }   If you forget to regenerate, the build fails with a clear message.  ","version":"0.15","tagName":"h3"},{"title":"Auto-Retry‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#auto-retry","content":" When invoked via go generate, the generator detects stale code and retries:  Detects compile error from guardRemoves stale generated fileRegenerates fresh code  ","version":"0.15","tagName":"h3"},{"title":"Supported Types‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#supported-types","content":" Code generation supports:  All primitive types (bool, int*, uint*, float*, string)Slices of primitives and structsMaps with supported key/value typesNested structs (must also be generated)Pointers to structs  ","version":"0.15","tagName":"h2"},{"title":"Nested Structs‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#nested-structs","content":" All nested structs must also have //fory:generate:  //fory:generate type Address struct { City string Country string } //fory:generate type Person struct { Name string Address Address // Address must also be generated }   ","version":"0.15","tagName":"h3"},{"title":"CI/CD Integration‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#cicd-integration","content":" ","version":"0.15","tagName":"h2"},{"title":"Check In Generated Code‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#check-in-generated-code","content":" Recommended for libraries:  go generate ./... git add *_fory_gen.go git commit -m &quot;Regenerate Fory serializers&quot;   Pros: Consumers can build without generator; reproducible buildsCons: Larger diffs; must remember to regenerate  ","version":"0.15","tagName":"h3"},{"title":"Generate in Pipeline‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#generate-in-pipeline","content":" Recommended for applications:  steps: - run: go install github.com/apache/fory/go/fory/cmd/fory@latest - run: go generate ./... - run: go build ./...   ","version":"0.15","tagName":"h3"},{"title":"Usage with Generated Code‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#usage-with-generated-code","content":" Generated code integrates transparently:  f := fory.New() // Fory automatically uses generated serializer if available user := &amp;User{ID: 1, Name: &quot;Alice&quot;} data, _ := f.Serialize(user) var result User f.Deserialize(data, &amp;result)   No code changes needed - registration happens in init().  ","version":"0.15","tagName":"h2"},{"title":"Mixing Generated and Non-Generated‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#mixing-generated-and-non-generated","content":" You can mix approaches:  //fory:generate type HotPathStruct struct { // Performance-critical, use codegen } type ColdPathStruct struct { // Not annotated, uses reflection }   ","version":"0.15","tagName":"h2"},{"title":"Limitations‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#limitations","content":" ","version":"0.15","tagName":"h2"},{"title":"Experimental Status‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#experimental-status","content":" API may changeNot all edge cases testedMay have undiscovered bugs  ","version":"0.15","tagName":"h3"},{"title":"Not Supported‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#not-supported","content":" Interface fields (dynamic types)Recursive types without pointersPrivate (unexported) fieldsCustom serializers  ","version":"0.15","tagName":"h3"},{"title":"Reflection Fallback‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#reflection-fallback","content":" If codegen fails, Fory falls back to reflection:  // If User_ForyGenSerializer not found, uses reflection f.Serialize(&amp;User{})   ","version":"0.15","tagName":"h3"},{"title":"Troubleshooting‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#troubleshooting","content":" ","version":"0.15","tagName":"h2"},{"title":"\"fory: command not found\"‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#fory-command-not-found","content":" Ensure the binary is in PATH:  export PATH=$PATH:$(go env GOPATH)/bin   ","version":"0.15","tagName":"h3"},{"title":"Compile Error After Struct Change‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#compile-error-after-struct-change","content":" Regenerate:  go generate ./...   Or force:  fory --force -file yourfile.go   ","version":"0.15","tagName":"h3"},{"title":"Generated Code Out of Sync‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#generated-code-out-of-sync","content":" The compile-time guard catches this:  cannot use x (variable of type User) as type _User_expected in argument   Run go generate to fix.  ","version":"0.15","tagName":"h3"},{"title":"Example Project Structure‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#example-project-structure","content":" myproject/ ‚îú‚îÄ‚îÄ models/ ‚îÇ ‚îú‚îÄ‚îÄ models.go # Struct definitions ‚îÇ ‚îú‚îÄ‚îÄ models_fory_gen.go # Generated code ‚îÇ ‚îî‚îÄ‚îÄ generate.go # go:generate directive ‚îú‚îÄ‚îÄ main.go ‚îî‚îÄ‚îÄ go.mod   models/generate.go:  package models //go:generate fory -pkg .   models/models.go:  package models //fory:generate type User struct { ID int64 Name string }   ","version":"0.15","tagName":"h2"},{"title":"FAQ‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#faq","content":" ","version":"0.15","tagName":"h2"},{"title":"Is codegen required?‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#is-codegen-required","content":" No. Reflection-based serialization works without code generation.  ","version":"0.15","tagName":"h3"},{"title":"Does generated code work across Go versions?‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#does-generated-code-work-across-go-versions","content":" Yes. Generated code is plain Go with no version-specific features.  ","version":"0.15","tagName":"h3"},{"title":"Can I mix generated and non-generated types?‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#can-i-mix-generated-and-non-generated-types","content":" Yes. Fory automatically uses generated serializers when available.  ","version":"0.15","tagName":"h3"},{"title":"How do I update generated code?‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#how-do-i-update-generated-code","content":" Run go generate ./... after struct changes.  ","version":"0.15","tagName":"h3"},{"title":"Should I commit generated files?‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#should-i-commit-generated-files","content":" For libraries: yes. For applications: either works.  ","version":"0.15","tagName":"h3"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Code Generation","url":"/docs/guide/go/codegen#related-topics","content":" Basic SerializationConfigurationTroubleshooting ","version":"0.15","tagName":"h2"},{"title":"Cross-Language Serialization","type":0,"sectionRef":"#","url":"/docs/guide/go/cross_language","content":"","keywords":"","version":"0.15"},{"title":"Enabling Cross-Language Mode‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/go/cross_language#enabling-cross-language-mode","content":" Cross-language (xlang) mode must be explicitly enabled:  f := fory.New(fory.WithXlang(true))   ","version":"0.15","tagName":"h2"},{"title":"Type Registration for Cross-Language‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/go/cross_language#type-registration-for-cross-language","content":" Use consistent type IDs across all languages:  ","version":"0.15","tagName":"h2"},{"title":"Go‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/go/cross_language#go","content":" type User struct { ID int64 Name string } f := fory.New(fory.WithXlang(true)) f.RegisterStruct(User{}, 1) data, _ := f.Serialize(&amp;User{ID: 1, Name: &quot;Alice&quot;})   ","version":"0.15","tagName":"h3"},{"title":"Java‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/go/cross_language#java","content":" public class User { public long id; public String name; } Fory fory = Fory.builder().withXlang(true).build(); fory.register(User.class, 1); User user = fory.deserialize(data, User.class);   ","version":"0.15","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/go/cross_language#python","content":" from dataclasses import dataclass import pyfory @dataclass class User: id: pyfory.Int64Type name: str fory = pyfory.Fory(xlang=True) fory.register(User, type_id=1) user = fory.deserialize(data)   ","version":"0.15","tagName":"h3"},{"title":"Type Mapping‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/go/cross_language#type-mapping","content":" See Type Mapping Specification for detailed type mappings across all languages.  ","version":"0.15","tagName":"h2"},{"title":"Field Ordering‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/go/cross_language#field-ordering","content":" Cross-language serialization requires consistent field ordering. Fory sorts fields by their snake_case names alphabetically.  Go field names are converted to snake_case for sorting:  type Example struct { UserID int64 // -&gt; user_id FirstName string // -&gt; first_name Age int32 // -&gt; age } // Sorted order: age, first_name, user_id   Ensure other languages use matching field names that produce the same snake_case ordering, or use field IDs for explicit control:  type Example struct { UserID int64 `fory:&quot;id=0&quot;` FirstName string `fory:&quot;id=1&quot;` Age int32 `fory:&quot;id=2&quot;` }   ","version":"0.15","tagName":"h2"},{"title":"Examples‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/go/cross_language#examples","content":" ","version":"0.15","tagName":"h2"},{"title":"Go to Java‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/go/cross_language#go-to-java","content":" Go (Serializer):  type Order struct { ID int64 Customer string Total float64 Items []string } f := fory.New(fory.WithXlang(true)) f.RegisterStruct(Order{}, 1) order := &amp;Order{ ID: 12345, Customer: &quot;Alice&quot;, Total: 99.99, Items: []string{&quot;Widget&quot;, &quot;Gadget&quot;}, } data, _ := f.Serialize(order) // Send 'data' to Java service   Java (Deserializer):  public class Order { public long id; public String customer; public double total; public List&lt;String&gt; items; } Fory fory = Fory.builder().withXlang(true).build(); fory.register(Order.class, 1); Order order = fory.deserialize(data, Order.class);   ","version":"0.15","tagName":"h3"},{"title":"Python to Go‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/go/cross_language#python-to-go","content":" Python (Serializer):  from dataclasses import dataclass import pyfory @dataclass class Message: id: pyfory.Int64Type content: str timestamp: pyfory.Int64Type fory = pyfory.Fory(xlang=True) fory.register(Message, type_id=1) msg = Message(id=1, content=&quot;Hello from Python&quot;, timestamp=1234567890) data = fory.serialize(msg)   Go (Deserializer):  type Message struct { ID int64 Content string Timestamp int64 } f := fory.New(fory.WithXlang(true)) f.RegisterStruct(Message{}, 1) var msg Message f.Deserialize(data, &amp;msg) fmt.Println(msg.Content) // &quot;Hello from Python&quot;   ","version":"0.15","tagName":"h3"},{"title":"Nested Structures‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/go/cross_language#nested-structures","content":" Cross-language nested structures require all types to be registered:  Go:  type Address struct { Street string City string Country string } type Company struct { Name string Address Address } f := fory.New(fory.WithXlang(true)) f.RegisterStruct(Address{}, 1) f.RegisterStruct(Company{}, 2)   Java:  public class Address { public String street; public String city; public String country; } public class Company { public String name; public Address address; } fory.register(Address.class, 1); fory.register(Company.class, 2);   ","version":"0.15","tagName":"h3"},{"title":"Common Issues‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/go/cross_language#common-issues","content":" ","version":"0.15","tagName":"h2"},{"title":"Field Name Mismatch‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/go/cross_language#field-name-mismatch","content":" Go uses PascalCase, other languages may use camelCase or snake_case. Fields are matched by their snake_case conversion:  // Go type User struct { FirstName string // -&gt; first_name } // Java - field name converted to snake_case must match public class User { public String firstName; // -&gt; first_name (matches) }   ","version":"0.15","tagName":"h3"},{"title":"Type Interpretation‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/go/cross_language#type-interpretation","content":" Go unsigned types map to Java signed types with the same bit pattern:  var value uint64 = 18446744073709551615 // Max uint64   Java's long holds the same bits but interprets as -1. Use Long.toUnsignedString() in Java if unsigned interpretation is needed.  ","version":"0.15","tagName":"h3"},{"title":"Nil vs Null‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/go/cross_language#nil-vs-null","content":" Go nil slices/maps serialize differently based on configuration:  var slice []string = nil // In xlang mode: serializes based on nullable configuration   Ensure other languages handle null appropriately.  ","version":"0.15","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/go/cross_language#best-practices","content":" Use consistent type IDs: Same numeric ID for the same type across all languagesRegister all types: Including nested struct typesMatch field ordering: Use same snake_case names or explicit field IDsTest cross-language: Run integration tests early and oftenHandle type differences: Be aware of signed/unsigned interpretation differences  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/go/cross_language#related-topics","content":" Type RegistrationSupported TypesSchema EvolutionXlang Serialization SpecificationType Mapping Specification ","version":"0.15","tagName":"h2"},{"title":"Configuration","type":0,"sectionRef":"#","url":"/docs/guide/go/configuration","content":"","keywords":"","version":"0.15"},{"title":"Creating a Fory Instance‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/go/configuration#creating-a-fory-instance","content":" ","version":"0.15","tagName":"h2"},{"title":"Default Configuration‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/go/configuration#default-configuration","content":" import &quot;github.com/apache/fory/go/fory&quot; f := fory.New()   Default settings:  Option\tDefault\tDescriptionTrackRef\tfalse\tReference tracking disabled MaxDepth\t20\tMaximum nesting depth IsXlang\tfalse\tCross-language mode disabled Compatible\tfalse\tSchema evolution mode disabled  ","version":"0.15","tagName":"h3"},{"title":"With Options‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/go/configuration#with-options","content":" f := fory.New( fory.WithTrackRef(true), fory.WithCompatible(true), fory.WithMaxDepth(10), )   ","version":"0.15","tagName":"h3"},{"title":"Configuration Options‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/go/configuration#configuration-options","content":" ","version":"0.15","tagName":"h2"},{"title":"WithTrackRef‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/go/configuration#withtrackref","content":" Enable reference tracking to handle circular references and shared objects:  f := fory.New(fory.WithTrackRef(true))   When enabled:  Objects appearing multiple times are serialized onceCircular references are handled correctlyPer-field fory:&quot;ref&quot; tags take effectAdds overhead for tracking object identity  When disabled (default):  Each object occurrence is serialized independentlyCircular references cause stack overflow or max depth errorPer-field fory:&quot;ref&quot; tags are ignoredBetter performance for simple data structures  Use reference tracking when:  Data contains circular referencesSame object is referenced multiple timesSerializing graph structures (trees with parent pointers, linked lists with cycles)  See References for details.  ","version":"0.15","tagName":"h3"},{"title":"WithCompatible‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/go/configuration#withcompatible","content":" Enable compatible mode for schema evolution:  f := fory.New(fory.WithCompatible(true))   When enabled:  Type metadata is written to serialized dataSupports adding/removing fields between versionsField names or ids are used for matching (order-independent)Larger serialized output due to metadata  When disabled (default):  Compact serialization without field metadataFaster serialization and smaller outputFields matched by sorted orderRequires consistent struct definitions across all services  See Schema Evolution for details.  ","version":"0.15","tagName":"h3"},{"title":"WithMaxDepth‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/go/configuration#withmaxdepth","content":" Set the maximum nesting depth to prevent stack overflow:  f := fory.New(fory.WithMaxDepth(30))   Default: 20Protects against deeply nested, recursive structures or malicious dataSerialization fails with error when exceeded  ","version":"0.15","tagName":"h3"},{"title":"WithXlang‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/go/configuration#withxlang","content":" Enable cross-language serialization mode:  f := fory.New(fory.WithXlang(true))   When enabled:  Uses cross-language type systemCompatible with Java, Python, C++, Rust, JavaScriptType IDs follow xlang specification  When disabled (default):  Go-native serialization modeSupport more Go-native typesNot compatible with other language implementations  ","version":"0.15","tagName":"h3"},{"title":"Thread Safety‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/go/configuration#thread-safety","content":" The default Fory instance is NOT thread-safe. For concurrent use, use the thread-safe wrapper:  import &quot;github.com/apache/fory/go/fory/threadsafe&quot; // Create thread-safe Fory with same options f := threadsafe.New( fory.WithTrackRef(true), fory.WithCompatible(true), ) // Safe for concurrent use from multiple goroutines go func() { data, _ := f.Serialize(value1) // data is already copied, safe to use after return }() go func() { data, _ := f.Serialize(value2) }()   The thread-safe wrapper:  Uses sync.Pool internally for efficient instance reuseAutomatically copies serialized data before returningAccepts the same configuration options as fory.New()  ","version":"0.15","tagName":"h2"},{"title":"Global Thread-Safe Instance‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/go/configuration#global-thread-safe-instance","content":" For convenience, the threadsafe package provides global functions:  import &quot;github.com/apache/fory/go/fory/threadsafe&quot; // Uses a global thread-safe instance with default configuration data, err := threadsafe.Marshal(&amp;myValue) err = threadsafe.Unmarshal(data, &amp;result)   See Thread Safety for details.  ","version":"0.15","tagName":"h3"},{"title":"Buffer Management‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/go/configuration#buffer-management","content":" ","version":"0.15","tagName":"h2"},{"title":"Zero-Copy Behavior‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/go/configuration#zero-copy-behavior","content":" The default Fory instance reuses its internal buffer:  f := fory.New() data1, _ := f.Serialize(value1) // WARNING: data1 becomes invalid after next Serialize call! data2, _ := f.Serialize(value2) // data1 now points to invalid memory // To keep the data, copy it: safeCopy := make([]byte, len(data1)) copy(safeCopy, data1)   The thread-safe wrapper automatically copies data, so this is not a concern:  f := threadsafe.New() data1, _ := f.Serialize(value1) data2, _ := f.Serialize(value2) // Both data1 and data2 are valid   ","version":"0.15","tagName":"h3"},{"title":"Manual Buffer Control‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/go/configuration#manual-buffer-control","content":" For high-throughput scenarios, you can manage buffers manually:  f := fory.New() buf := fory.NewByteBuffer(nil) // Serialize to existing buffer err := f.SerializeTo(buf, value) // Get serialized data data := buf.GetByteSlice(0, buf.WriterIndex()) // Process data... // Reset for next use buf.Reset()   ","version":"0.15","tagName":"h3"},{"title":"Configuration Examples‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/go/configuration#configuration-examples","content":" ","version":"0.15","tagName":"h2"},{"title":"Simple Data (Default)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/go/configuration#simple-data-default","content":" For simple structs without circular references:  f := fory.New() type Config struct { Host string Port int32 } f.RegisterStruct(Config{}, 1) data, _ := f.Serialize(&amp;Config{Host: &quot;localhost&quot;, Port: 8080})   ","version":"0.15","tagName":"h3"},{"title":"Graph Structures‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/go/configuration#graph-structures","content":" For data with circular references:  f := fory.New(fory.WithTrackRef(true)) type Node struct { Value int32 Next *Node `fory:&quot;ref&quot;` } f.RegisterStruct(Node{}, 1) n1 := &amp;Node{Value: 1} n2 := &amp;Node{Value: 2} n1.Next = n2 n2.Next = n1 // Circular reference data, _ := f.Serialize(n1)   ","version":"0.15","tagName":"h3"},{"title":"Schema Evolution‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/go/configuration#schema-evolution","content":" For data that may evolve over time:  // V1: original struct type UserV1 struct { ID int64 Name string } // V2: added Email field type UserV2 struct { ID int64 Name string Email string // New field } // Serialize with V1 f1 := fory.New(fory.WithCompatible(true)) f1.RegisterStruct(UserV1{}, 1) data, _ := f1.Serialize(&amp;UserV1{ID: 1, Name: &quot;Alice&quot;}) // Deserialize into V2 - Email will have zero value f2 := fory.New(fory.WithCompatible(true)) f2.RegisterStruct(UserV2{}, 1) var user UserV2 f2.Deserialize(data, &amp;user)   ","version":"0.15","tagName":"h3"},{"title":"High-Performance Concurrent‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/go/configuration#high-performance-concurrent","content":" For concurrent high-throughput scenarios:  type Request struct { ID int64 Payload string } f := threadsafe.New( fory.WithMaxDepth(30), ) f.RegisterStruct(Request{}, 1) // Process requests concurrently for req := range requests { go func(r Request) { data, _ := f.Serialize(&amp;r) sendResponse(data) }(req) }   ","version":"0.15","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/go/configuration#best-practices","content":" Reuse Fory instances: Creating a Fory instance involves initialization overhead. Create once and reuse. Use thread-safe wrapper for concurrency: Never share a non-thread-safe Fory instance across goroutines. Enable reference tracking only when needed: It adds overhead for tracking object identity. Copy serialized data if keeping it: With the default Fory, the returned byte slice is invalidated on the next operation. Set appropriate max depth: Increase for deeply nested structures, but be aware of memory usage. Use compatible mode for evolving schemas: Enable when struct definitions may change between service versions.  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/go/configuration#related-topics","content":" Basic SerializationReferencesSchema EvolutionThread Safety ","version":"0.15","tagName":"h2"},{"title":"Basic Serialization","type":0,"sectionRef":"#","url":"/docs/guide/go/basic_serialization","content":"","keywords":"","version":"0.15"},{"title":"Creating a Fory Instance‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/go/basic_serialization#creating-a-fory-instance","content":" Create a Fory instance and register your types before serialization:  import &quot;github.com/apache/fory/go/fory&quot; f := fory.New() // Register struct with a type ID f.RegisterStruct(User{}, 1) f.RegisterStruct(Order{}, 2) // Or register with a name (more flexible, less prone to ID conflicts, but higher serialization cost) f.RegisterNamedStruct(User{}, &quot;example.User&quot;) // Register enum types f.RegisterEnum(Color(0), 3)   Important: The Fory instance should be reused across serialization calls. Creating a new instance involves allocating internal buffers, type caches, and resolvers, which is expensive. The default Fory instance is not thread-safe; for concurrent usage, use the thread-safe wrapper (see Thread Safety).  See Type Registration for more details.  ","version":"0.15","tagName":"h2"},{"title":"Core API‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/go/basic_serialization#core-api","content":" ","version":"0.15","tagName":"h2"},{"title":"Serialize and Deserialize‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/go/basic_serialization#serialize-and-deserialize","content":" The primary API for serialization:  // Serialize any value data, err := f.Serialize(value) if err != nil { // Handle error } // Deserialize into target var result MyType err = f.Deserialize(data, &amp;result) if err != nil { // Handle error }   ","version":"0.15","tagName":"h3"},{"title":"Marshal and Unmarshal‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/go/basic_serialization#marshal-and-unmarshal","content":" Aliases for Serialize and Deserialize (familiar to Go developers):  data, err := f.Marshal(value) err = f.Unmarshal(data, &amp;result)   ","version":"0.15","tagName":"h3"},{"title":"Serializing Primitives‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/go/basic_serialization#serializing-primitives","content":" // Integers data, _ := f.Serialize(int64(42)) var i int64 f.Deserialize(data, &amp;i) // i = 42 // Floats data, _ = f.Serialize(float64(3.14)) var fl float64 f.Deserialize(data, &amp;fl) // fl = 3.14 // Strings data, _ = f.Serialize(&quot;hello&quot;) var s string f.Deserialize(data, &amp;s) // s = &quot;hello&quot; // Booleans data, _ = f.Serialize(true) var b bool f.Deserialize(data, &amp;b) // b = true   ","version":"0.15","tagName":"h2"},{"title":"Serializing Collections‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/go/basic_serialization#serializing-collections","content":" ","version":"0.15","tagName":"h2"},{"title":"Slices‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/go/basic_serialization#slices","content":" // String slice strs := []string{&quot;a&quot;, &quot;b&quot;, &quot;c&quot;} data, _ := f.Serialize(strs) var result []string f.Deserialize(data, &amp;result) // result = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;] // Integer slice nums := []int64{1, 2, 3} data, _ = f.Serialize(nums) var intResult []int64 f.Deserialize(data, &amp;intResult) // intResult = [1, 2, 3]   ","version":"0.15","tagName":"h3"},{"title":"Maps‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/go/basic_serialization#maps","content":" // String to string map m := map[string]string{&quot;key&quot;: &quot;value&quot;} data, _ := f.Serialize(m) var result map[string]string f.Deserialize(data, &amp;result) // result = {&quot;key&quot;: &quot;value&quot;} // String to int map m2 := map[string]int64{&quot;count&quot;: 42} data, _ = f.Serialize(m2) var result2 map[string]int64 f.Deserialize(data, &amp;result2) // result2 = {&quot;count&quot;: 42}   ","version":"0.15","tagName":"h3"},{"title":"Serializing Structs‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/go/basic_serialization#serializing-structs","content":" ","version":"0.15","tagName":"h2"},{"title":"Basic Struct Serialization‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/go/basic_serialization#basic-struct-serialization","content":" Only exported fields (starting with uppercase) are serialized:  type User struct { ID int64 // Serialized Name string // Serialized password string // NOT serialized (unexported) } f.RegisterStruct(User{}, 1) user := &amp;User{ID: 1, Name: &quot;Alice&quot;, password: &quot;secret&quot;} data, _ := f.Serialize(user) var result User f.Deserialize(data, &amp;result) // result.ID = 1, result.Name = &quot;Alice&quot;, result.password = &quot;&quot;   ","version":"0.15","tagName":"h3"},{"title":"Nested Structs‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/go/basic_serialization#nested-structs","content":" type Address struct { City string Country string } type Person struct { Name string Address Address } f.RegisterStruct(Address{}, 1) f.RegisterStruct(Person{}, 2) person := &amp;Person{ Name: &quot;Alice&quot;, Address: Address{City: &quot;NYC&quot;, Country: &quot;USA&quot;}, } data, _ := f.Serialize(person) var result Person f.Deserialize(data, &amp;result) // result.Address.City = &quot;NYC&quot;   ","version":"0.15","tagName":"h3"},{"title":"Pointer Fields‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/go/basic_serialization#pointer-fields","content":" type Node struct { Value int32 Child *Node } // Use WithTrackRef for pointer fields f := fory.New(fory.WithTrackRef(true)) f.RegisterStruct(Node{}, 1) root := &amp;Node{ Value: 1, Child: &amp;Node{Value: 2, Child: nil}, } data, _ := f.Serialize(root) var result Node f.Deserialize(data, &amp;result) // result.Child.Value = 2   ","version":"0.15","tagName":"h3"},{"title":"Streaming API‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/go/basic_serialization#streaming-api","content":" For scenarios where you want to control the buffer:  ","version":"0.15","tagName":"h2"},{"title":"SerializeTo‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/go/basic_serialization#serializeto","content":" Serialize to an existing buffer:  buf := fory.NewByteBuffer(nil) // Serialize multiple values to same buffer f.SerializeTo(buf, value1) f.SerializeTo(buf, value2) // Get all serialized data data := buf.GetByteSlice(0, buf.WriterIndex())   ","version":"0.15","tagName":"h3"},{"title":"DeserializeFrom‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/go/basic_serialization#deserializefrom","content":" Deserialize from an existing buffer:  buf := fory.NewByteBuffer(data) var result1, result2 MyType f.DeserializeFrom(buf, &amp;result1) f.DeserializeFrom(buf, &amp;result2)   ","version":"0.15","tagName":"h3"},{"title":"Generic API (Type-Safe)‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/go/basic_serialization#generic-api-type-safe","content":" Fory Go provides generic functions for type-safe serialization:  import &quot;github.com/apache/fory/go/fory&quot; type User struct { ID int64 Name string } // Type-safe serialization user := &amp;User{ID: 1, Name: &quot;Alice&quot;} data, err := fory.Serialize(f, user) // Type-safe deserialization var result User err = fory.Deserialize(f, data, &amp;result)   The generic API:  Infers type at compile timeProvides better type safetyMay offer performance benefits  ","version":"0.15","tagName":"h2"},{"title":"Error Handling‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/go/basic_serialization#error-handling","content":" Always check errors from serialization operations:  data, err := f.Serialize(value) if err != nil { switch e := err.(type) { case fory.Error: fmt.Printf(&quot;Fory error: %s (kind: %d)\\n&quot;, e.Error(), e.Kind()) default: fmt.Printf(&quot;Unknown error: %v\\n&quot;, err) } return } err = f.Deserialize(data, &amp;result) if err != nil { // Handle deserialization error }   Common error kinds:  ErrKindBufferOutOfBound: Read/write beyond buffer boundsErrKindTypeMismatch: Type ID mismatch during deserializationErrKindUnknownType: Unknown type encounteredErrKindMaxDepthExceeded: Recursion depth limit exceededErrKindHashMismatch: Struct hash mismatch (schema changed)  See Troubleshooting for error resolution.  ","version":"0.15","tagName":"h2"},{"title":"Nil Handling‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/go/basic_serialization#nil-handling","content":" ","version":"0.15","tagName":"h2"},{"title":"Nil Pointers‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/go/basic_serialization#nil-pointers","content":" var ptr *User = nil data, _ := f.Serialize(ptr) var result *User f.Deserialize(data, &amp;result) // result = nil   ","version":"0.15","tagName":"h3"},{"title":"Empty Collections‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/go/basic_serialization#empty-collections","content":" // Nil slice var slice []string = nil data, _ := f.Serialize(slice) var result []string f.Deserialize(data, &amp;result) // result = nil // Empty slice (different from nil) empty := []string{} data, _ = f.Serialize(empty) f.Deserialize(data, &amp;result) // result = [] (empty, not nil)   ","version":"0.15","tagName":"h3"},{"title":"Complete Example‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/go/basic_serialization#complete-example","content":" package main import ( &quot;fmt&quot; &quot;github.com/apache/fory/go/fory&quot; ) type Order struct { ID int64 Customer string Items []Item Total float64 } type Item struct { Name string Quantity int32 Price float64 } func main() { f := fory.New() f.RegisterStruct(Order{}, 1) f.RegisterStruct(Item{}, 2) order := &amp;Order{ ID: 12345, Customer: &quot;Alice&quot;, Items: []Item{ {Name: &quot;Widget&quot;, Quantity: 2, Price: 9.99}, {Name: &quot;Gadget&quot;, Quantity: 1, Price: 24.99}, }, Total: 44.97, } // Serialize data, err := f.Serialize(order) if err != nil { panic(err) } fmt.Printf(&quot;Serialized %d bytes\\n&quot;, len(data)) // Deserialize var result Order if err := f.Deserialize(data, &amp;result); err != nil { panic(err) } fmt.Printf(&quot;Order ID: %d\\n&quot;, result.ID) fmt.Printf(&quot;Customer: %s\\n&quot;, result.Customer) fmt.Printf(&quot;Items: %d\\n&quot;, len(result.Items)) fmt.Printf(&quot;Total: %.2f\\n&quot;, result.Total) }   ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/go/basic_serialization#related-topics","content":" ConfigurationType RegistrationSupported TypesReferences ","version":"0.15","tagName":"h2"},{"title":"Custom Serializers","type":0,"sectionRef":"#","url":"/docs/guide/go/custom_serializers","content":"","keywords":"","version":"0.15"},{"title":"When to Use Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/go/custom_serializers#when-to-use-custom-serializers","content":" Special encoding: Types that need a specific binary formatThird-party types: Types from external libraries that Fory doesn't handle automaticallyOptimization: When you can serialize more efficiently than the default reflection-based approachCross-language compatibility: When you need precise control over the binary format for interoperability  ","version":"0.15","tagName":"h2"},{"title":"ExtensionSerializer Interface‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/go/custom_serializers#extensionserializer-interface","content":" Custom serializers implement the ExtensionSerializer interface:  type ExtensionSerializer interface { // WriteData serializes the value to the buffer. // Only write the data - Fory handles type info and references. // Use ctx.Buffer() to access the ByteBuffer. // Use ctx.SetError() to report errors. WriteData(ctx *WriteContext, value reflect.Value) // ReadData deserializes the value from the buffer into the provided value. // Only read the data - Fory handles type info and references. // Use ctx.Buffer() to access the ByteBuffer. // Use ctx.SetError() to report errors. ReadData(ctx *ReadContext, value reflect.Value) }   ","version":"0.15","tagName":"h2"},{"title":"Basic Example‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/go/custom_serializers#basic-example","content":" Here's a simple custom serializer for a type with an integer field:  import ( &quot;reflect&quot; &quot;github.com/apache/fory/go/fory&quot; ) type MyExt struct { Id int32 } type MyExtSerializer struct{} func (s *MyExtSerializer) WriteData(ctx *fory.WriteContext, value reflect.Value) { myExt := value.Interface().(MyExt) ctx.Buffer().WriteVarint32(myExt.Id) } func (s *MyExtSerializer) ReadData(ctx *fory.ReadContext, value reflect.Value) { id := ctx.Buffer().ReadVarint32(ctx.Err()) value.Set(reflect.ValueOf(MyExt{Id: id})) } // Register the custom serializer f := fory.New() err := f.RegisterExtension(MyExt{}, 100, &amp;MyExtSerializer{})   ","version":"0.15","tagName":"h2"},{"title":"Context Methods‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/go/custom_serializers#context-methods","content":" The WriteContext and ReadContext provide access to serialization resources:  Method\tDescriptionBuffer()\tReturns the *ByteBuffer for reading/writing Err()\tReturns *Error for deferred error checking SetError(err)\tSets an error on the context HasError()\tReturns true if an error has been set TypeResolver()\tReturns the type resolver for nested types RefResolver()\tReturns the reference resolver for ref support  ","version":"0.15","tagName":"h2"},{"title":"ByteBuffer Methods‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/go/custom_serializers#bytebuffer-methods","content":" The ByteBuffer provides methods for reading and writing primitive types:  ","version":"0.15","tagName":"h2"},{"title":"Writing Methods‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/go/custom_serializers#writing-methods","content":" Method\tDescriptionWriteBool(v bool)\tWrite a boolean WriteInt8(v int8)\tWrite a signed 8-bit integer WriteInt16(v int16)\tWrite a signed 16-bit integer WriteInt32(v int32)\tWrite a signed 32-bit integer WriteInt64(v int64)\tWrite a signed 64-bit integer WriteFloat32(v float32)\tWrite a 32-bit float WriteFloat64(v float64)\tWrite a 64-bit float WriteVarint32(v int32)\tWrite a variable-length signed 32-bit integer WriteVarint64(v int64)\tWrite a variable-length signed 64-bit integer WriteBinary(data []byte)\tWrite raw bytes  ","version":"0.15","tagName":"h3"},{"title":"Reading Methods‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/go/custom_serializers#reading-methods","content":" All read methods take an *Error parameter for deferred error checking:  Method\tDescriptionReadBool(err *Error) bool\tRead a boolean ReadInt8(err *Error) int8\tRead a signed 8-bit integer ReadInt16(err *Error) int16\tRead a signed 16-bit integer ReadInt32(err *Error) int32\tRead a signed 32-bit integer ReadInt64(err *Error) int64\tRead a signed 64-bit integer ReadFloat32(err *Error) float32\tRead a 32-bit float ReadFloat64(err *Error) float64\tRead a 64-bit float ReadVarint32(err *Error) int32\tRead a variable-length signed 32-bit integer ReadVarint64(err *Error) int64\tRead a variable-length signed 64-bit integer ReadBinary(length int, err *Error) []byte\tRead raw bytes of specified length  ","version":"0.15","tagName":"h3"},{"title":"Complex Type Example‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/go/custom_serializers#complex-type-example","content":" A custom serializer for a type with multiple fields:  type Point3D struct { X, Y, Z float64 Label string } type Point3DSerializer struct{} func (s *Point3DSerializer) WriteData(ctx *fory.WriteContext, value reflect.Value) { p := value.Interface().(Point3D) buf := ctx.Buffer() buf.WriteFloat64(p.X) buf.WriteFloat64(p.Y) buf.WriteFloat64(p.Z) // Write string as length + bytes labelBytes := []byte(p.Label) buf.WriteVarint32(int32(len(labelBytes))) buf.WriteBinary(labelBytes) } func (s *Point3DSerializer) ReadData(ctx *fory.ReadContext, value reflect.Value) { buf := ctx.Buffer() err := ctx.Err() x := buf.ReadFloat64(err) y := buf.ReadFloat64(err) z := buf.ReadFloat64(err) labelLen := buf.ReadVarint32(err) labelBytes := buf.ReadBinary(int(labelLen), err) value.Set(reflect.ValueOf(Point3D{ X: x, Y: y, Z: z, Label: string(labelBytes), })) } f := fory.New() f.RegisterExtension(Point3D{}, 101, &amp;Point3DSerializer{})   ","version":"0.15","tagName":"h2"},{"title":"Handling Pointers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/go/custom_serializers#handling-pointers","content":" When your type contains pointers, handle nil values explicitly:  type OptionalValue struct { Value *int64 } type OptionalValueSerializer struct{} func (s *OptionalValueSerializer) WriteData(ctx *fory.WriteContext, value reflect.Value) { ov := value.Interface().(OptionalValue) buf := ctx.Buffer() if ov.Value == nil { buf.WriteBool(false) // nil flag } else { buf.WriteBool(true) // not nil buf.WriteInt64(*ov.Value) } } func (s *OptionalValueSerializer) ReadData(ctx *fory.ReadContext, value reflect.Value) { buf := ctx.Buffer() err := ctx.Err() hasValue := buf.ReadBool(err) if !hasValue { value.Set(reflect.ValueOf(OptionalValue{Value: nil})) return } v := buf.ReadInt64(err) value.Set(reflect.ValueOf(OptionalValue{Value: &amp;v})) }   ","version":"0.15","tagName":"h2"},{"title":"Error Handling‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/go/custom_serializers#error-handling","content":" Use ctx.SetError() to report errors:  func (s *MySerializer) ReadData(ctx *fory.ReadContext, value reflect.Value) { buf := ctx.Buffer() version := buf.ReadInt8(ctx.Err()) if ctx.HasError() { return } if version != 1 { ctx.SetError(fory.DeserializationErrorf(&quot;unsupported version: %d&quot;, version)) return } // Continue reading... value.Set(reflect.ValueOf(result)) }   ","version":"0.15","tagName":"h2"},{"title":"Registration Options‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/go/custom_serializers#registration-options","content":" ","version":"0.15","tagName":"h2"},{"title":"Register by ID‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/go/custom_serializers#register-by-id","content":" More compact serialization, requires ID coordination across languages:  f.RegisterExtension(MyType{}, 100, &amp;MySerializer{})   ","version":"0.15","tagName":"h3"},{"title":"Register by Name‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/go/custom_serializers#register-by-name","content":" More flexible but more serialization cost, type name included in serialized data:  f.RegisterNamedExtension(MyType{}, &quot;myapp.MyType&quot;, &amp;MySerializer{})   ","version":"0.15","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/go/custom_serializers#best-practices","content":" Keep it simple: Only serialize what you needUse variable-length integers: WriteVarint32/WriteVarint64 for integers that are often smallHandle nil explicitly: Check for nil pointers and slicesVersion your format: Consider adding a version byte for future compatibilityTest round-trips: Always verify that Read(Write(value)) == valueMatch read/write order: Read fields in exactly the same order you write themCheck errors: Use ctx.HasError() after reading to handle errors gracefullyDeploy before use: Always deploy the registered serializer to all services before sending data serialized with it. If a service receives data for an unregistered serializer, deserialization will fail  ","version":"0.15","tagName":"h2"},{"title":"Testing Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/go/custom_serializers#testing-custom-serializers","content":" func TestMySerializer(t *testing.T) { f := fory.New() f.RegisterExtension(MyType{}, 100, &amp;MySerializer{}) original := MyType{Field: &quot;test&quot;} // Serialize data, err := f.Serialize(original) require.NoError(t, err) // Deserialize var result MyType err = f.Deserialize(data, &amp;result) require.NoError(t, err) assert.Equal(t, original, result) }   ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/go/custom_serializers#related-topics","content":" Type RegistrationSupported TypesCross-Language Serialization ","version":"0.15","tagName":"h2"},{"title":"Field Configuration","type":0,"sectionRef":"#","url":"/docs/guide/go/struct_tags","content":"","keywords":"","version":"0.15"},{"title":"Tag Syntax‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/go/struct_tags#tag-syntax","content":" The general syntax for Fory struct tags:  type MyStruct struct { Field Type `fory:&quot;option1,option2=value&quot;` }   Multiple options are separated by commas (,).  ","version":"0.15","tagName":"h2"},{"title":"Available Tags‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/go/struct_tags#available-tags","content":" ","version":"0.15","tagName":"h2"},{"title":"Field ID‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/go/struct_tags#field-id","content":" Use id=N to assign a numeric ID to a field for compact encoding:  type User struct { ID int64 `fory:&quot;id=0&quot;` Name string `fory:&quot;id=1&quot;` Age int32 `fory:&quot;id=2&quot;` }   Benefits:  Smaller serialized size (numeric IDs vs field names)Faster serialization/deserializationRequired for optimal cross-language compatibility  Notes:  IDs must be unique within a structIDs must be &gt;= 0If not specified, field name is used (larger payload)  ","version":"0.15","tagName":"h3"},{"title":"Ignoring Fields‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/go/struct_tags#ignoring-fields","content":" Use - to exclude a field from serialization:  type User struct { ID int64 Name string Password string `fory:&quot;-&quot;` // Not serialized }   The Password field will not be included in serialized output and will remain at its zero value after deserialization.  ","version":"0.15","tagName":"h3"},{"title":"Nullable‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/go/struct_tags#nullable","content":" Use nullable to control whether null flags are written for pointer fields:  type Record struct { // Write null flag for this field (allows nil values) OptionalData *Data `fory:&quot;nullable&quot;` // Skip null flag (field must not be nil) RequiredData *Data `fory:&quot;nullable=false&quot;` }   Notes:  Only applies to pointer, slice, and map fieldsWhen nullable=false, serializing a nil value will cause an errorDefault is false (no null flag written)  ","version":"0.15","tagName":"h3"},{"title":"Reference Tracking‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/go/struct_tags#reference-tracking","content":" Control per-field reference tracking for slices, maps, or pointer to struct fields:  type Container struct { // Enable reference tracking for this field SharedData *Data `fory:&quot;ref&quot;` // Disable reference tracking for this field SimpleData *Data `fory:&quot;ref=false&quot;` }   Notes:  Applies to slices, maps, and pointer to struct fieldsPointer to primitive types (e.g., *int, *string) cannot use this tagDefault is ref=false (no reference tracking)When global WithTrackRef(false) is set, field ref tags are ignoredWhen global WithTrackRef(true) is set, use ref=false to disable for specific fields  Use cases:  Enable for fields that may be circular or sharedDisable for fields that are always unique (optimization)  ","version":"0.15","tagName":"h3"},{"title":"Encoding‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/go/struct_tags#encoding","content":" Use encoding to control how numeric fields are encoded:  type Metrics struct { // Variable-length encoding (default, smaller for small values) Count int64 `fory:&quot;encoding=varint&quot;` // Fixed-length encoding (consistent size) Timestamp int64 `fory:&quot;encoding=fixed&quot;` // Tagged encoding (includes type tag) Value int64 `fory:&quot;encoding=tagged&quot;` }   Supported encodings:  Type\tOptions\tDefaultint32\tvarint, fixed\tvarint uint32\tvarint, fixed\tvarint int64\tvarint, fixed, tagged\tvarint uint64\tvarint, fixed, tagged\tvarint  When to use:  varint: Best for values that are often small (default)fixed: Best for values that use full range (e.g., timestamps, hashes)tagged: When type information needs to be preserved  Shorthand for int32/uint32:  Use compress as a convenience tag for int32/uint32 fields:  type Data struct { SmallValue int32 `fory:&quot;compress&quot;` // Same as encoding=varint (default) FixedValue uint32 `fory:&quot;compress=false&quot;` // Same as encoding=fixed }   ","version":"0.15","tagName":"h3"},{"title":"Combining Tags‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/go/struct_tags#combining-tags","content":" Multiple tags can be combined using comma separator:  type Document struct { ID int64 `fory:&quot;id=0,encoding=fixed&quot;` Content string `fory:&quot;id=1&quot;` Author *User `fory:&quot;id=2,ref&quot;` }   ","version":"0.15","tagName":"h2"},{"title":"Integration with Other Tags‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/go/struct_tags#integration-with-other-tags","content":" Fory tags coexist with other struct tags:  type User struct { ID int64 `json:&quot;id&quot; fory:&quot;id=0&quot;` Name string `json:&quot;name,omitempty&quot; fory:&quot;id=1&quot;` Password string `json:&quot;-&quot; fory:&quot;-&quot;` }   Each tag namespace is independent.  ","version":"0.15","tagName":"h2"},{"title":"Field Visibility‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/go/struct_tags#field-visibility","content":" Only exported fields (starting with uppercase) are considered:  type User struct { ID int64 // Serialized Name string // Serialized password string // NOT serialized (unexported, no tag needed) }   Unexported fields are always ignored, regardless of tags.  ","version":"0.15","tagName":"h2"},{"title":"Field Ordering‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/go/struct_tags#field-ordering","content":" Fields are serialized in a consistent order based on:  Field name (alphabetically in snake_case)Field type  This ensures cross-language compatibility where field order matters.  ","version":"0.15","tagName":"h2"},{"title":"Struct Hash‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/go/struct_tags#struct-hash","content":" Fory computes a hash of struct fields for version checking:  Hash includes field names and typesHash is written to serialized dataMismatch triggers ErrKindHashMismatch  Struct field changes affect the hash:  // These produce different hashes type V1 struct { UserID int64 } type V2 struct { UserId int64 // Different field name = different hash }   ","version":"0.15","tagName":"h2"},{"title":"Examples‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/go/struct_tags#examples","content":" ","version":"0.15","tagName":"h2"},{"title":"API Response Struct‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/go/struct_tags#api-response-struct","content":" type APIResponse struct { Status int32 `json:&quot;status&quot; fory:&quot;id=0&quot;` Message string `json:&quot;message&quot; fory:&quot;id=1&quot;` Data any `json:&quot;data&quot; fory:&quot;id=2&quot;` Internal string `json:&quot;-&quot; fory:&quot;-&quot;` // Ignored in both JSON and Fory }   ","version":"0.15","tagName":"h3"},{"title":"Caching with Shared References‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/go/struct_tags#caching-with-shared-references","content":" type CacheEntry struct { Key string Value *CachedData `fory:&quot;ref&quot;` // May be shared Metadata *Metadata `fory:&quot;ref=false&quot;` // Always unique ExpiresAt int64 }   ","version":"0.15","tagName":"h3"},{"title":"Document with Circular References‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/go/struct_tags#document-with-circular-references","content":" type Document struct { ID int64 Title string Parent *Document `fory:&quot;ref&quot;` // May reference self or siblings Children []*Document `fory:&quot;ref&quot;` }   ","version":"0.15","tagName":"h3"},{"title":"Tag Parsing Errors‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/go/struct_tags#tag-parsing-errors","content":" Invalid tags produce errors during registration:  type BadStruct struct { Field int `fory:&quot;invalid=option=format&quot;` } f := fory.New() err := f.RegisterStruct(BadStruct{}, 1) // Error: ErrKindInvalidTag   ","version":"0.15","tagName":"h2"},{"title":"Native Mode vs Xlang Mode‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/go/struct_tags#native-mode-vs-xlang-mode","content":" Field configuration behaves differently depending on the serialization mode:  Native Mode:  Nullable: Pointer, slice, map, and interface types are nullable by defaultRef tracking: Disabled by default (ref tag not set)  Xlang Mode:  Nullable: Only pointer types are nullable by default (slices and maps are NOT nullable)Ref tracking: Disabled by default (ref tag not set)  You need to configure fields when:  A field can be nil (use pointer types like *string, *int32)A field needs reference tracking for shared/circular objects (use fory:&quot;ref&quot;)You want to reduce metadata size (use field IDs with fory:&quot;id=N&quot;)  // Xlang mode: explicit configuration required type User struct { ID int64 `fory:&quot;id=0&quot;` Name string `fory:&quot;id=1&quot;` Email *string `fory:&quot;id=2&quot;` // Pointer type for nullable Friend *User `fory:&quot;id=3,ref&quot;` // Must declare ref for shared objects }   ","version":"0.15","tagName":"h2"},{"title":"Default Values Summary‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/go/struct_tags#default-values-summary","content":" Option\tDefault\tHow to Enablenullable\tfalse\tUse pointer types (*T) ref\tfalse\tAdd fory:&quot;ref&quot; tag id\t-1\tAdd fory:&quot;id=N&quot; tag  ","version":"0.15","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/go/struct_tags#best-practices","content":" Use - for sensitive data: Passwords, tokens, internal stateEnable ref tracking for shared objects: When the same pointer appears multiple timesDisable ref tracking for simple fields: Optimization when you know the field is uniqueKeep names consistent: Cross-language names should matchDocument tag usage: Especially for non-obvious configurations  ","version":"0.15","tagName":"h2"},{"title":"Common Patterns‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/go/struct_tags#common-patterns","content":" ","version":"0.15","tagName":"h2"},{"title":"Ignoring Computed Fields‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/go/struct_tags#ignoring-computed-fields","content":" type Rectangle struct { Width float64 Height float64 Area float64 `fory:&quot;-&quot;` // Computed, don't serialize } func (r *Rectangle) ComputeArea() { r.Area = r.Width * r.Height }   ","version":"0.15","tagName":"h3"},{"title":"Circular Structure with Parent‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/go/struct_tags#circular-structure-with-parent","content":" type TreeNode struct { Value string Parent *TreeNode `fory:&quot;ref&quot;` // Circular back-reference Children []*TreeNode `fory:&quot;ref&quot;` }   ","version":"0.15","tagName":"h3"},{"title":"Mixed Serialization Needs‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/go/struct_tags#mixed-serialization-needs","content":" type Session struct { ID string UserID int64 Token string `fory:&quot;-&quot;` // Security: don't serialize User *User `fory:&quot;ref&quot;` // May be shared across sessions CreatedAt int64 }   ","version":"0.15","tagName":"h3"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/go/struct_tags#related-topics","content":" ReferencesBasic SerializationSchema Evolution ","version":"0.15","tagName":"h2"},{"title":"References","type":0,"sectionRef":"#","url":"/docs/guide/go/references","content":"","keywords":"","version":"0.15"},{"title":"Enabling Reference Tracking‚Äã","type":1,"pageTitle":"References","url":"/docs/guide/go/references#enabling-reference-tracking","content":" Reference tracking is disabled by default. Enable it when creating a Fory instance:  f := fory.New(fory.WithTrackRef(true))   Important: Global reference tracking must be enabled for any reference tracking to occur. When WithTrackRef(false) (the default), all per-field reference tags are ignored.  ","version":"0.15","tagName":"h2"},{"title":"How Reference Tracking Works‚Äã","type":1,"pageTitle":"References","url":"/docs/guide/go/references#how-reference-tracking-works","content":" ","version":"0.15","tagName":"h2"},{"title":"Without Reference Tracking (Default)‚Äã","type":1,"pageTitle":"References","url":"/docs/guide/go/references#without-reference-tracking-default","content":" When disabled, each object is serialized independently:  f := fory.New() // TrackRef disabled by default shared := &amp;Data{Value: 42} container := &amp;Container{A: shared, B: shared} data, _ := f.Serialize(container) // 'shared' is serialized TWICE (no deduplication)   ","version":"0.15","tagName":"h3"},{"title":"With Reference Tracking‚Äã","type":1,"pageTitle":"References","url":"/docs/guide/go/references#with-reference-tracking","content":" When enabled, objects are tracked by identity:  f := fory.New(fory.WithTrackRef(true)) shared := &amp;Data{Value: 42} container := &amp;Container{A: shared, B: shared} data, _ := f.Serialize(container) // 'shared' is serialized ONCE, second occurrence is a reference   ","version":"0.15","tagName":"h3"},{"title":"Reference Flags‚Äã","type":1,"pageTitle":"References","url":"/docs/guide/go/references#reference-flags","content":" Fory uses flags to indicate reference states during serialization:  Flag\tValue\tMeaningNullFlag\t-3\tNil/null value RefFlag\t-2\tReference to previously serialized object NotNullValueFlag\t-1\tNon-null value (data follows) RefValueFlag\t0\tReference value flag  ","version":"0.15","tagName":"h2"},{"title":"Referenceable Types‚Äã","type":1,"pageTitle":"References","url":"/docs/guide/go/references#referenceable-types","content":" Only certain types support reference tracking. In xlang mode, the following types can track references:  Type\tReference Tracked\tNotes*struct (pointer to struct)\tYes\tEnable with fory:&quot;ref&quot; tag any (interface)\tYes\tAutomatically tracked []T (slices)\tYes\tEnable with fory:&quot;ref&quot; tag map[K]V\tYes\tEnable with fory:&quot;ref&quot; tag *int, *string, etc.\tNo\tPointer to primitives excluded Primitives\tNo\tValue types time.Time, time.Duration\tNo\tValue types Arrays ([N]T)\tNo\tValue types  ","version":"0.15","tagName":"h2"},{"title":"Per-Field Reference Control‚Äã","type":1,"pageTitle":"References","url":"/docs/guide/go/references#per-field-reference-control","content":" By default, reference tracking is disabled for individual fields even when global WithTrackRef(true) is set. You can enable reference tracking for specific fields using the ref struct tag:  type Container struct { // Enable ref tracking for this field SharedData *Data `fory:&quot;ref&quot;` // Explicitly disable ref tracking (same as default) SimpleData *Data `fory:&quot;ref=false&quot;` }   Important notes:  Per-field tags only take effect when global WithTrackRef(true) is setWhen global WithTrackRef(false) (default), all field ref tags are ignoredApplies to slices, maps, and pointer to struct fieldsPointer to primitive types (e.g., *int, *string) cannot use this tagDefault is ref=false (no reference tracking per field)  See Struct Tags for more details.  ","version":"0.15","tagName":"h2"},{"title":"Circular References‚Äã","type":1,"pageTitle":"References","url":"/docs/guide/go/references#circular-references","content":" Reference tracking is required for circular data structures:  ","version":"0.15","tagName":"h2"},{"title":"Circular Linked List‚Äã","type":1,"pageTitle":"References","url":"/docs/guide/go/references#circular-linked-list","content":" type Node struct { Value int32 Next *Node `fory:&quot;ref&quot;` } f := fory.New(fory.WithTrackRef(true)) f.RegisterStruct(Node{}, 1) // Create circular list n1 := &amp;Node{Value: 1} n2 := &amp;Node{Value: 2} n3 := &amp;Node{Value: 3} n1.Next = n2 n2.Next = n3 n3.Next = n1 // Circular reference back to n1 data, _ := f.Serialize(n1) var result Node f.Deserialize(data, &amp;result) // Circular structure is preserved // result.Next.Next.Next == &amp;result   ","version":"0.15","tagName":"h3"},{"title":"Parent-Child Tree‚Äã","type":1,"pageTitle":"References","url":"/docs/guide/go/references#parent-child-tree","content":" type TreeNode struct { Value string Parent *TreeNode `fory:&quot;ref&quot;` Children []*TreeNode `fory:&quot;ref&quot;` } f := fory.New(fory.WithTrackRef(true)) f.RegisterStruct(TreeNode{}, 1) root := &amp;TreeNode{Value: &quot;root&quot;} child1 := &amp;TreeNode{Value: &quot;child1&quot;, Parent: root} child2 := &amp;TreeNode{Value: &quot;child2&quot;, Parent: root} root.Children = []*TreeNode{child1, child2} data, _ := f.Serialize(root) var result TreeNode f.Deserialize(data, &amp;result) // result.Children[0].Parent == &amp;result   ","version":"0.15","tagName":"h3"},{"title":"Graph Structures‚Äã","type":1,"pageTitle":"References","url":"/docs/guide/go/references#graph-structures","content":" type GraphNode struct { ID int32 Neighbors []*GraphNode `fory:&quot;ref&quot;` } f := fory.New(fory.WithTrackRef(true)) f.RegisterStruct(GraphNode{}, 1) // Create a graph a := &amp;GraphNode{ID: 1} b := &amp;GraphNode{ID: 2} c := &amp;GraphNode{ID: 3} // Bidirectional connections a.Neighbors = []*GraphNode{b, c} b.Neighbors = []*GraphNode{a, c} c.Neighbors = []*GraphNode{a, b} data, _ := f.Serialize(a) var result GraphNode f.Deserialize(data, &amp;result)   ","version":"0.15","tagName":"h3"},{"title":"Shared Object Deduplication‚Äã","type":1,"pageTitle":"References","url":"/docs/guide/go/references#shared-object-deduplication","content":" Reference tracking also deduplicates shared objects:  type Config struct { Setting string } type Application struct { MainConfig *Config `fory:&quot;ref&quot;` BackupConfig *Config `fory:&quot;ref&quot;` FallbackConfig *Config `fory:&quot;ref&quot;` } f := fory.New(fory.WithTrackRef(true)) f.RegisterStruct(Config{}, 1) f.RegisterStruct(Application{}, 2) // Shared configuration config := &amp;Config{Setting: &quot;value&quot;} // Multiple references to same object app := &amp;Application{ MainConfig: config, BackupConfig: config, FallbackConfig: config, } data, _ := f.Serialize(app) // 'config' serialized once, others are references var result Application f.Deserialize(data, &amp;result) // result.MainConfig == result.BackupConfig == result.FallbackConfig   ","version":"0.15","tagName":"h2"},{"title":"Performance Considerations‚Äã","type":1,"pageTitle":"References","url":"/docs/guide/go/references#performance-considerations","content":" ","version":"0.15","tagName":"h2"},{"title":"Overhead‚Äã","type":1,"pageTitle":"References","url":"/docs/guide/go/references#overhead","content":" Reference tracking adds overhead:  Memory for tracking seen objects (hash map)Hash lookups during serializationAdditional bytes for reference flags and IDs  ","version":"0.15","tagName":"h3"},{"title":"When to Enable‚Äã","type":1,"pageTitle":"References","url":"/docs/guide/go/references#when-to-enable","content":" Enable reference tracking when:  Data has circular referencesSame object referenced multiple timesSerializing graph structuresObject identity must be preserved  Disable reference tracking when:  Data is tree-structured (no cycles)Each object appears only onceMaximum performance is requiredObject identity doesn't matter  ","version":"0.15","tagName":"h3"},{"title":"Memory Usage‚Äã","type":1,"pageTitle":"References","url":"/docs/guide/go/references#memory-usage","content":" Reference tracking maintains a map of serializing objects:  // Internal reference tracking structure type RefResolver struct { writtenObjects map[refKey]int32 // pointer -&gt; reference ID readObjects []reflect.Value // reference ID -&gt; object }   For large object graphs, this may increase memory usage.  ","version":"0.15","tagName":"h3"},{"title":"Error Handling‚Äã","type":1,"pageTitle":"References","url":"/docs/guide/go/references#error-handling","content":" ","version":"0.15","tagName":"h2"},{"title":"Without Reference Tracking‚Äã","type":1,"pageTitle":"References","url":"/docs/guide/go/references#without-reference-tracking","content":" Circular references without tracking cause stack overflow or max depth errors:  f := fory.New() // No reference tracking n1 := &amp;Node{Value: 1} n1.Next = n1 // Self-reference data, err := f.Serialize(n1) // Error: max depth exceeded (or stack overflow)   ","version":"0.15","tagName":"h3"},{"title":"Invalid Reference ID‚Äã","type":1,"pageTitle":"References","url":"/docs/guide/go/references#invalid-reference-id","content":" During deserialization, an invalid reference ID produces an error:  // Error type: ErrKindInvalidRefId   This occurs when serialized data contains a reference to an object that wasn't previously serialized.  ","version":"0.15","tagName":"h3"},{"title":"Complete Example‚Äã","type":1,"pageTitle":"References","url":"/docs/guide/go/references#complete-example","content":" package main import ( &quot;fmt&quot; &quot;github.com/apache/fory/go/fory&quot; ) type Person struct { Name string Friends []*Person `fory:&quot;ref&quot;` BestFriend *Person `fory:&quot;ref&quot;` } func main() { f := fory.New(fory.WithTrackRef(true)) f.RegisterStruct(Person{}, 1) // Create people with mutual friendships alice := &amp;Person{Name: &quot;Alice&quot;} bob := &amp;Person{Name: &quot;Bob&quot;} charlie := &amp;Person{Name: &quot;Charlie&quot;} alice.Friends = []*Person{bob, charlie} alice.BestFriend = bob bob.Friends = []*Person{alice, charlie} bob.BestFriend = alice // Mutual best friends charlie.Friends = []*Person{alice, bob} // Serialize data, err := f.Serialize(alice) if err != nil { panic(err) } fmt.Printf(&quot;Serialized %d bytes\\n&quot;, len(data)) // Deserialize var result Person if err := f.Deserialize(data, &amp;result); err != nil { panic(err) } // Verify circular references preserved fmt.Printf(&quot;Alice's best friend: %s\\n&quot;, result.BestFriend.Name) fmt.Printf(&quot;Bob's best friend: %s\\n&quot;, result.BestFriend.BestFriend.Name) // Output: Alice (circular reference preserved) }   ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"References","url":"/docs/guide/go/references#related-topics","content":" ConfigurationStruct TagsCross-Language Serialization ","version":"0.15","tagName":"h2"},{"title":"Schema Evolution","type":0,"sectionRef":"#","url":"/docs/guide/go/schema_evolution","content":"","keywords":"","version":"0.15"},{"title":"Enabling Compatible Mode‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/go/schema_evolution#enabling-compatible-mode","content":" Enable compatible mode when creating a Fory instance:  f := fory.New(fory.WithCompatible(true))   ","version":"0.15","tagName":"h2"},{"title":"How It Works‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/go/schema_evolution#how-it-works","content":" ","version":"0.15","tagName":"h2"},{"title":"Without Compatible Mode (Default)‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/go/schema_evolution#without-compatible-mode-default","content":" Compact serialization without metadataStruct hash is checked during deserializationAny schema change causes ErrKindHashMismatch  ","version":"0.15","tagName":"h3"},{"title":"With Compatible Mode‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/go/schema_evolution#with-compatible-mode","content":" Type metadata is written to serialized dataSupports adding, removing, and reordering fieldsEnables forward and backward compatibility  ","version":"0.15","tagName":"h3"},{"title":"Disable Evolution for Stable Structs‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/go/schema_evolution#disable-evolution-for-stable-structs","content":" If a struct schema is stable and will not change, you can disable evolution for that struct to avoid compatible metadata overhead. Implement the ForyEvolving interface and return false:  type StableMessage struct { ID int64 } func (StableMessage) ForyEvolving() bool { return false }   ","version":"0.15","tagName":"h3"},{"title":"Supported Schema Changes‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/go/schema_evolution#supported-schema-changes","content":" ","version":"0.15","tagName":"h2"},{"title":"Adding Fields‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/go/schema_evolution#adding-fields","content":" New fields can be added; they receive zero values when deserializing old data:  // Version 1 type UserV1 struct { ID int64 Name string } // Version 2 (added Email) type UserV2 struct { ID int64 Name string Email string // New field } f := fory.New(fory.WithCompatible(true)) f.RegisterStruct(UserV1{}, 1) // Serialize with V1 userV1 := &amp;UserV1{ID: 1, Name: &quot;Alice&quot;} data, _ := f.Serialize(userV1) // Deserialize with V2 f2 := fory.New(fory.WithCompatible(true)) f2.RegisterStruct(UserV2{}, 1) var userV2 UserV2 f2.Deserialize(data, &amp;userV2) // userV2.Email = &quot;&quot; (zero value)   ","version":"0.15","tagName":"h3"},{"title":"Removing Fields‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/go/schema_evolution#removing-fields","content":" Removed fields are skipped during deserialization:  // Version 1 type ConfigV1 struct { Host string Port int32 Timeout int64 Debug bool // Will be removed } // Version 2 (removed Debug) type ConfigV2 struct { Host string Port int32 Timeout int64 // Debug field removed } f := fory.New(fory.WithCompatible(true)) f.RegisterStruct(ConfigV1{}, 1) // Serialize with V1 config := &amp;ConfigV1{Host: &quot;localhost&quot;, Port: 8080, Timeout: 30, Debug: true} data, _ := f.Serialize(config) // Deserialize with V2 f2 := fory.New(fory.WithCompatible(true)) f2.RegisterStruct(ConfigV2{}, 1) var configV2 ConfigV2 f2.Deserialize(data, &amp;configV2) // Debug field data is skipped   ","version":"0.15","tagName":"h3"},{"title":"Reordering Fields‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/go/schema_evolution#reordering-fields","content":" Field order can change between versions:  // Version 1 type PersonV1 struct { FirstName string LastName string Age int32 } // Version 2 (reordered) type PersonV2 struct { Age int32 // Moved up LastName string FirstName string // Moved down }   Compatible mode handles this automatically by matching fields by name.  ","version":"0.15","tagName":"h3"},{"title":"Incompatible Changes‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/go/schema_evolution#incompatible-changes","content":" Some changes are NOT supported, even in compatible mode:  ","version":"0.15","tagName":"h2"},{"title":"Type Changes‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/go/schema_evolution#type-changes","content":" // NOT SUPPORTED type V1 struct { Value int32 // int32 } type V2 struct { Value string // Changed to string - INCOMPATIBLE }   ","version":"0.15","tagName":"h3"},{"title":"Renaming Fields‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/go/schema_evolution#renaming-fields","content":" // NOT SUPPORTED (treated as remove + add) type V1 struct { UserName string } type V2 struct { Username string // Different name - NOT a rename }   This is treated as removing UserName and adding Username, resulting in data loss.  ","version":"0.15","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/go/schema_evolution#best-practices","content":" ","version":"0.15","tagName":"h2"},{"title":"1. Use Compatible Mode for Persistent Data‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/go/schema_evolution#1-use-compatible-mode-for-persistent-data","content":" // For data stored in databases, files, or caches f := fory.New(fory.WithCompatible(true))   ","version":"0.15","tagName":"h3"},{"title":"2. Provide Default Values‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/go/schema_evolution#2-provide-default-values","content":" type ConfigV2 struct { Host string Port int32 Timeout int64 Retries int32 // New field } func NewConfigV2() *ConfigV2 { return &amp;ConfigV2{ Retries: 3, // Default value } } // After deserialize, apply defaults if config.Retries == 0 { config.Retries = 3 }   ","version":"0.15","tagName":"h3"},{"title":"Cross-Language Schema Evolution‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/go/schema_evolution#cross-language-schema-evolution","content":" Schema evolution works across languages:  ","version":"0.15","tagName":"h2"},{"title":"Go (Producer)‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/go/schema_evolution#go-producer","content":" type MessageV1 struct { ID int64 Content string } f := fory.New(fory.WithCompatible(true)) f.RegisterStruct(MessageV1{}, 1) data, _ := f.Serialize(&amp;MessageV1{ID: 1, Content: &quot;Hello&quot;})   ","version":"0.15","tagName":"h3"},{"title":"Java (Consumer with newer schema)‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/go/schema_evolution#java-consumer-with-newer-schema","content":" public class Message { long id; String content; String author; // New field in Java } Fory fory = Fory.builder() .withXlang(true) .withCompatibleMode(true) .build(); fory.register(Message.class, 1); Message msg = fory.deserialize(data, Message.class); // msg.author will be null   ","version":"0.15","tagName":"h3"},{"title":"Performance Considerations‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/go/schema_evolution#performance-considerations","content":" Compatible mode mainly affects serialized size:  Aspect\tSchema Consistent\tCompatible ModeSerialized Size\tSmaller\tLarger (includes metadata, especially without field IDs) Speed\tFast\tSimilar (metadata is just memcpy) Schema Flexibility\tNone\tFull  Note: Using field IDs (fory:&quot;id=N&quot;) reduces metadata size in compatible mode.  Recommendation: Use compatible mode for:  Persistent storageCross-service communicationLong-lived caches  Use schema consistent mode for:  In-memory operationsSame-version communicationMinimum serialized size  ","version":"0.15","tagName":"h2"},{"title":"Error Handling‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/go/schema_evolution#error-handling","content":" ","version":"0.15","tagName":"h2"},{"title":"Hash Mismatch (Schema Consistent Mode)‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/go/schema_evolution#hash-mismatch-schema-consistent-mode","content":" f := fory.New() // Compatible mode disabled // Schema changed without compatible mode err := f.Deserialize(oldData, &amp;newStruct) // Error: ErrKindHashMismatch   ","version":"0.15","tagName":"h3"},{"title":"Unknown Fields‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/go/schema_evolution#unknown-fields","content":" In compatible mode, unknown fields are skipped silently. To detect them:  // Currently, Fory skips unknown fields automatically // No explicit API for detecting unknown fields   ","version":"0.15","tagName":"h3"},{"title":"Complete Example‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/go/schema_evolution#complete-example","content":" package main import ( &quot;fmt&quot; &quot;github.com/apache/fory/go/fory&quot; ) // V1: Initial schema type ProductV1 struct { ID int64 Name string Price float64 } // V2: Added fields type ProductV2 struct { ID int64 Name string Price float64 Description string // New InStock bool // New } func main() { // Serialize with V1 f1 := fory.New(fory.WithCompatible(true)) f1.RegisterStruct(ProductV1{}, 1) product := &amp;ProductV1{ID: 1, Name: &quot;Widget&quot;, Price: 9.99} data, _ := f1.Serialize(product) fmt.Printf(&quot;V1 serialized: %d bytes\\n&quot;, len(data)) // Deserialize with V2 f2 := fory.New(fory.WithCompatible(true)) f2.RegisterStruct(ProductV2{}, 1) var productV2 ProductV2 if err := f2.Deserialize(data, &amp;productV2); err != nil { panic(err) } fmt.Printf(&quot;ID: %d\\n&quot;, productV2.ID) fmt.Printf(&quot;Name: %s\\n&quot;, productV2.Name) fmt.Printf(&quot;Price: %.2f\\n&quot;, productV2.Price) fmt.Printf(&quot;Description: %q (zero value)\\n&quot;, productV2.Description) fmt.Printf(&quot;InStock: %v (zero value)\\n&quot;, productV2.InStock) }   ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/go/schema_evolution#related-topics","content":" ConfigurationCross-Language SerializationTroubleshooting ","version":"0.15","tagName":"h2"},{"title":"Supported Types","type":0,"sectionRef":"#","url":"/docs/guide/go/supported_types","content":"","keywords":"","version":"0.15"},{"title":"Primitive Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/go/supported_types#primitive-types","content":" Go Type\tFory TypeId\tEncoding\tNotesbool\tBOOL (1)\t1 byte int8\tINT8 (2)\t1 byte, signed int16\tINT16 (3)\t2 bytes, signed\tLittle-endian int32\tINT32 (4)\tVarint\tVariable-length encoding int64\tINT64 (6)\tVarint\tVariable-length encoding int\tINT32/INT64\tVarint\tPlatform-dependent (32 or 64 bit) uint8 / byte\tUINT8 (9)\t1 byte, unsigned uint16\tUINT16 (10)\t2 bytes, unsigned\tLittle-endian uint32\tUINT32 (11)\tVaruint\tVariable-length encoding uint64\tUINT64 (13)\tVaruint\tVariable-length encoding float32\tFLOAT32 (17)\t4 bytes\tIEEE 754 float64\tFLOAT64 (18)\t8 bytes\tIEEE 754 string\tSTRING (19)\tLength-prefixed UTF-8\t  ","version":"0.15","tagName":"h2"},{"title":"Integer Encoding‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/go/supported_types#integer-encoding","content":" Fory uses variable-length integer encoding (varint) for better compression:  Small values use fewer bytesNegative values use ZigZag encodingPlatform int maps to int32 on 32-bit, int64 on 64-bit systems  f := fory.New() // All integer types supported var i8 int8 = 127 var i16 int16 = 32767 var i32 int32 = 2147483647 var i64 int64 = 9223372036854775807 data, _ := f.Serialize(i64) // Uses varint encoding   ","version":"0.15","tagName":"h3"},{"title":"Collection Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/go/supported_types#collection-types","content":" ","version":"0.15","tagName":"h2"},{"title":"Slices‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/go/supported_types#slices","content":" Go Type\tFory TypeId\tNotes[]bool\tBOOL_ARRAY\tOptimized encoding []int8\tINT8_ARRAY\tOptimized encoding []int16\tINT16_ARRAY\tOptimized encoding []int32\tINT32_ARRAY\tOptimized encoding []int64\tINT64_ARRAY\tOptimized encoding []float32\tFLOAT32_ARRAY\tOptimized encoding []float64\tFLOAT64_ARRAY\tOptimized encoding []string\tLIST\tGeneric list encoding []T (any)\tLIST (20)\tAny serializable type []I (any/any)\tLIST\tAny interface type  f := fory.New() // Primitive slices (optimized) ints := []int32{1, 2, 3, 4, 5} data, _ := f.Serialize(ints) // String slices strs := []string{&quot;a&quot;, &quot;b&quot;, &quot;c&quot;} data, _ = f.Serialize(strs) // Struct slices users := []User{{ID: 1}, {ID: 2}} data, _ = f.Serialize(users) // Dynamic slices dynamic := []any{1, &quot;hello&quot;, true} data, _ = f.Serialize(dynamic)   ","version":"0.15","tagName":"h3"},{"title":"Maps‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/go/supported_types#maps","content":" Go Type\tFory TypeId\tNotesmap[string]string\tMAP (22)\tOptimized map[string]int64\tMAP\tOptimized map[string]int32\tMAP\tOptimized map[string]int\tMAP\tOptimized map[string]float64\tMAP\tOptimized map[string]bool\tMAP\tOptimized map[int32]int32\tMAP\tOptimized map[int64]int64\tMAP\tOptimized map[int]int\tMAP\tOptimized map[string]any\tMAP\tDynamic values map[any]any\tMAP\tDynamic keys and values  f := fory.New() // String key maps m1 := map[string]string{&quot;key&quot;: &quot;value&quot;} m2 := map[string]int64{&quot;count&quot;: 42} // Integer key maps m3 := map[int32]int32{1: 100, 2: 200} // Dynamic maps m4 := map[string]any{ &quot;name&quot;: &quot;Alice&quot;, &quot;age&quot;: int64(30), }   ","version":"0.15","tagName":"h3"},{"title":"Sets‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/go/supported_types#sets","content":" Fory provides a generic Set[T] type (uses map[T]struct{} for zero memory overhead):  // Create a set of strings s := fory.NewSet[string]() s.Add(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;) // Check membership if s.Contains(&quot;a&quot;) { fmt.Println(&quot;found&quot;) } // Serialize data, _ := f.Serialize(s)   ","version":"0.15","tagName":"h3"},{"title":"Time Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/go/supported_types#time-types","content":" Go Type\tFory TypeId\tNotestime.Time\tTIMESTAMP (34)\tNanosecond precision time.Duration\tDURATION (33)\tNanosecond precision  import &quot;time&quot; f := fory.New() // Timestamp t := time.Now() data, _ := f.Serialize(t) // Duration d := 5 * time.Second data, _ = f.Serialize(d)   ","version":"0.15","tagName":"h2"},{"title":"Struct Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/go/supported_types#struct-types","content":" Category\tFory TypeId\tNotesStruct\tSTRUCT (25)\tRegistered by ID, no evolution Compatible Struct\tCOMPATIBLE_STRUCT (26)\tWith schema evolution Named Struct\tNAMED_STRUCT (27)\tRegistered by name, no evolution Named Compatible Struct\tNAMED_COMPATIBLE_STRUCT (28)\tNamed with schema evolution  ","version":"0.15","tagName":"h2"},{"title":"Struct Requirements‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/go/supported_types#struct-requirements","content":" Exported fields only: Fields starting with uppercase are serializedSupported field types: All types listed in this documentRegistration: Structs should be registered for cross-language use  type User struct { ID int64 // Serialized Name string // Serialized Age int32 // Serialized password string // NOT serialized (unexported) } f := fory.New() f.RegisterStruct(User{}, 1) user := &amp;User{ID: 1, Name: &quot;Alice&quot;, Age: 30, password: &quot;secret&quot;} data, _ := f.Serialize(user)   ","version":"0.15","tagName":"h3"},{"title":"Nested Structs‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/go/supported_types#nested-structs","content":" type Address struct { Street string City string Country string } type Company struct { Name string Address Address Founded int32 } f := fory.New() f.RegisterStruct(Address{}, 1) f.RegisterStruct(Company{}, 2)   ","version":"0.15","tagName":"h3"},{"title":"Pointer Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/go/supported_types#pointer-types","content":" Go Type\tBehavior*T\tNil-able, reference tracked (if enabled) **T\tNested pointers supported  f := fory.New(fory.WithTrackRef(true)) type Node struct { Value int32 Left *Node Right *Node } f.RegisterStruct(Node{}, 1) root := &amp;Node{ Value: 1, Left: &amp;Node{Value: 2}, Right: &amp;Node{Value: 3}, } data, _ := f.Serialize(root)   ","version":"0.15","tagName":"h2"},{"title":"Nil Handling‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/go/supported_types#nil-handling","content":" var ptr *User = nil data, _ := f.Serialize(ptr) var result *User f.Deserialize(data, &amp;result) // result == nil   ","version":"0.15","tagName":"h3"},{"title":"Interface Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/go/supported_types#interface-types","content":" Go Type\tFory TypeId\tNotesany\tUNION (31)\tPolymorphic values  f := fory.New() // Serialize any var value any = &quot;hello&quot; data, _ := f.Serialize(value) var result any f.Deserialize(data, &amp;result) // result = &quot;hello&quot; (string)   For struct interfaces, register all possible concrete types:  type Shape interface { Area() float64 } type Circle struct { Radius float64 } func (c Circle) Area() float64 { return 3.14159 * c.Radius * c.Radius } f := fory.New() f.RegisterStruct(Circle{}, 1) var shape Shape = Circle{Radius: 5.0} data, _ := f.Serialize(shape)   ","version":"0.15","tagName":"h2"},{"title":"Binary Data‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/go/supported_types#binary-data","content":" Go Type\tFory TypeId\tNotes[]byte\tBINARY (37)\tVariable-length bytes  f := fory.New() data := []byte{0x01, 0x02, 0x03, 0x04} serialized, _ := f.Serialize(data) var result []byte f.Deserialize(serialized, &amp;result)   ","version":"0.15","tagName":"h2"},{"title":"Enum Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/go/supported_types#enum-types","content":" Go uses integer types for enums:  type Status int32 const ( StatusPending Status = 0 StatusActive Status = 1 StatusComplete Status = 2 ) f := fory.New() f.RegisterEnum(Status(0), 1) status := StatusActive data, _ := f.Serialize(status)   ","version":"0.15","tagName":"h2"},{"title":"Cross-Language Type Mapping‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/go/supported_types#cross-language-type-mapping","content":" Go Type\tJava\tPython\tC++\tRustbool\tboolean\tbool\tbool\tbool int8\tbyte\tint\tint8_t\ti8 int16\tshort\tint\tint16_t\ti16 int32\tint\tint\tint32_t\ti32 int64\tlong\tint\tint64_t\ti64 float32\tfloat\tfloat\tfloat\tf32 float64\tdouble\tfloat\tdouble\tf64 string\tString\tstr\tstd::string\tString []T\tList&lt;T&gt;\tlist\tstd::vector&lt;T&gt;\tVec&lt;T&gt; map[K]V\tMap&lt;K,V&gt;\tdict\tstd::unordered_map\tHashMap&lt;K,V&gt; time.Time\tInstant\tdatetime\t-\t- time.Duration\tDuration\ttimedelta\t-\t-  See Cross-Language Serialization for detailed mapping.  ","version":"0.15","tagName":"h2"},{"title":"Unsupported Types‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/go/supported_types#unsupported-types","content":" The following Go types are not supported:  Channels (chan T)Functions (func())Complex numbers (complex64, complex128)Unsafe pointers (unsafe.Pointer)  Attempting to serialize these types will result in an error.  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Supported Types","url":"/docs/guide/go/supported_types#related-topics","content":" Type RegistrationCross-Language SerializationReferences ","version":"0.15","tagName":"h2"},{"title":"Thread Safety","type":0,"sectionRef":"#","url":"/docs/guide/go/thread_safety","content":"","keywords":"","version":"0.15"},{"title":"Default Fory Instance‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/guide/go/thread_safety#default-fory-instance","content":" The default Fory instance is not thread-safe:  f := fory.New() // NOT SAFE: Concurrent access from multiple goroutines go func() { f.Serialize(value1) // Race condition! }() go func() { f.Serialize(value2) // Race condition! }()   ","version":"0.15","tagName":"h2"},{"title":"Why Not Thread-Safe?‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/guide/go/thread_safety#why-not-thread-safe","content":" For performance, Fory reuses internal state:  Buffer is cleared and reused between callsReference resolvers are resetContext objects are recycled  This avoids allocations but requires exclusive access.  ","version":"0.15","tagName":"h3"},{"title":"Thread-Safe Wrapper‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/guide/go/thread_safety#thread-safe-wrapper","content":" For concurrent use, use the threadsafe package:  import &quot;github.com/apache/fory/go/fory/threadsafe&quot; // Create thread-safe Fory f := threadsafe.New() // Safe for concurrent use go func() { data, _ := f.Serialize(value1) }() go func() { data, _ := f.Serialize(value2) }()   ","version":"0.15","tagName":"h2"},{"title":"How It Works‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/guide/go/thread_safety#how-it-works","content":" The thread-safe wrapper uses sync.Pool:  Acquire: Gets a Fory instance from the poolUse: Performs serialization/deserializationCopy: Copies result data (buffer will be reused)Release: Returns instance to pool  // Simplified implementation func (f *Fory) Serialize(v any) ([]byte, error) { fory := f.pool.Get().(*fory.Fory) defer f.pool.Put(fory) data, err := fory.Serialize(v) if err != nil { return nil, err } // Copy because underlying buffer will be reused result := make([]byte, len(data)) copy(result, data) return result, nil }   ","version":"0.15","tagName":"h3"},{"title":"API‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/guide/go/thread_safety#api","content":" // Create thread-safe instance f := threadsafe.New() // Instance methods data, err := f.Serialize(value) err = f.Deserialize(data, &amp;target) // Generic functions data, err := threadsafe.Serialize(f, &amp;value) err = threadsafe.Deserialize(f, data, &amp;target) // Global convenience functions data, err := threadsafe.Marshal(&amp;value) err = threadsafe.Unmarshal(data, &amp;target)   ","version":"0.15","tagName":"h3"},{"title":"Type Registration‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/guide/go/thread_safety#type-registration","content":" Type registration should be done before concurrent use:  f := threadsafe.New() // Register types BEFORE concurrent access f.RegisterStruct(User{}, 1) f.RegisterStruct(Order{}, 2) // Now safe to use concurrently go func() { f.Serialize(&amp;User{ID: 1}) }()   ","version":"0.15","tagName":"h2"},{"title":"Thread-Safe Registration‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/guide/go/thread_safety#thread-safe-registration","content":" The thread-safe wrapper handles registration safely:  // Safe: Registration is synchronized f := threadsafe.New() f.RegisterStruct(User{}, 1) // Thread-safe   However, for best performance, register all types at startup before concurrent use.  ","version":"0.15","tagName":"h3"},{"title":"Zero-Copy Considerations‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/guide/go/thread_safety#zero-copy-considerations","content":" ","version":"0.15","tagName":"h2"},{"title":"Non-Thread-Safe Instance‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/guide/go/thread_safety#non-thread-safe-instance","content":" With the default Fory, returned byte slices are views into the internal buffer:  f := fory.New() data1, _ := f.Serialize(value1) // data1 is valid data2, _ := f.Serialize(value2) // data1 is NOW INVALID (buffer was reused)   ","version":"0.15","tagName":"h3"},{"title":"Thread-Safe Instance‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/guide/go/thread_safety#thread-safe-instance","content":" The thread-safe wrapper copies data automatically:  f := threadsafe.New() data1, _ := f.Serialize(value1) data2, _ := f.Serialize(value2) // Both data1 and data2 are valid (independent copies)   This is safer but has allocation overhead.  ","version":"0.15","tagName":"h3"},{"title":"Performance Comparison‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/guide/go/thread_safety#performance-comparison","content":" Scenario\tNon-Thread-Safe\tThread-SafeSingle goroutine\tFastest\tSlower (pool overhead) Multiple goroutines\tUnsafe\tSafe, good scaling Memory allocations\tMinimal\tPer-call copy Buffer reuse\tYes\tPer-pool-instance  ","version":"0.15","tagName":"h2"},{"title":"Benchmarking‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/guide/go/thread_safety#benchmarking","content":" func BenchmarkNonThreadSafe(b *testing.B) { f := fory.New() f.RegisterStruct(User{}, 1) user := &amp;User{ID: 1, Name: &quot;Alice&quot;} for i := 0; i &lt; b.N; i++ { data, _ := f.Serialize(user) _ = data } } func BenchmarkThreadSafe(b *testing.B) { f := threadsafe.New() f.RegisterStruct(User{}, 1) user := &amp;User{ID: 1, Name: &quot;Alice&quot;} for i := 0; i &lt; b.N; i++ { data, _ := f.Serialize(user) _ = data } }   ","version":"0.15","tagName":"h3"},{"title":"Patterns‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/guide/go/thread_safety#patterns","content":" ","version":"0.15","tagName":"h2"},{"title":"Per-Goroutine Instance‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/guide/go/thread_safety#per-goroutine-instance","content":" For maximum performance with known goroutine count:  func worker(id int) { // Each worker has its own Fory instance f := fory.New() f.RegisterStruct(User{}, 1) for task := range tasks { data, _ := f.Serialize(task) process(data) } } // Start workers for i := 0; i &lt; numWorkers; i++ { go worker(i) }   ","version":"0.15","tagName":"h3"},{"title":"Shared Thread-Safe Instance‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/guide/go/thread_safety#shared-thread-safe-instance","content":" For dynamic goroutine count or simplicity:  // Single shared instance var f = threadsafe.New() func init() { f.RegisterStruct(User{}, 1) } func handleRequest(user *User) []byte { // Safe from any goroutine data, _ := f.Serialize(user) return data }   ","version":"0.15","tagName":"h3"},{"title":"HTTP Handler Example‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/guide/go/thread_safety#http-handler-example","content":" var fory = threadsafe.New() func init() { fory.RegisterStruct(Response{}, 1) } func handler(w http.ResponseWriter, r *http.Request) { response := &amp;Response{ Status: &quot;ok&quot;, Data: getData(), } // Safe: threadsafe.Fory handles concurrency data, err := fory.Serialize(response) if err != nil { http.Error(w, err.Error(), 500) return } w.Header().Set(&quot;Content-Type&quot;, &quot;application/octet-stream&quot;) w.Write(data) }   ","version":"0.15","tagName":"h3"},{"title":"Common Mistakes‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/guide/go/thread_safety#common-mistakes","content":" ","version":"0.15","tagName":"h2"},{"title":"Sharing Non-Thread-Safe Instance‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/guide/go/thread_safety#sharing-non-thread-safe-instance","content":" // WRONG: Race condition var f = fory.New() func handler1() { f.Serialize(value1) // Race! } func handler2() { f.Serialize(value2) // Race! }   Fix: Use threadsafe.New() or per-goroutine instances.  ","version":"0.15","tagName":"h3"},{"title":"Keeping Reference to Buffer‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/guide/go/thread_safety#keeping-reference-to-buffer","content":" // WRONG: Buffer invalidated on next call f := fory.New() data, _ := f.Serialize(value1) savedData := data // Just copies the slice header! f.Serialize(value2) // Invalidates data and savedData   Fix: Clone the data or use thread-safe wrapper.  // Correct: Clone the data data, _ := f.Serialize(value1) savedData := make([]byte, len(data)) copy(savedData, data) // Or use thread-safe (auto-copies) f := threadsafe.New() data, _ := f.Serialize(value1) // Already copied   ","version":"0.15","tagName":"h3"},{"title":"Registering Types Concurrently‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/guide/go/thread_safety#registering-types-concurrently","content":" // RISKY: Concurrent registration go func() { f.RegisterStruct(TypeA{}, 1) }() go func() { f.Serialize(value) // May not see TypeA }()   Fix: Register all types before concurrent use.  ","version":"0.15","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/guide/go/thread_safety#best-practices","content":" Register types at startup: Before any concurrent operationsClone data if keeping references: With non-thread-safe instanceUse per-worker instances for hot paths: Eliminates pool contentionProfile before optimizing: Thread-safe overhead may be negligible  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Thread Safety","url":"/docs/guide/go/thread_safety#related-topics","content":" ConfigurationBasic SerializationTroubleshooting ","version":"0.15","tagName":"h2"},{"title":"Type Registration","type":0,"sectionRef":"#","url":"/docs/guide/go/type_registration","content":"","keywords":"","version":"0.15"},{"title":"Why Register Types?‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/go/type_registration#why-register-types","content":" Type Identification: Fory needs to identify the actual type during deserializationPolymorphism: When deserializing interface types, Fory must know which concrete type to createCross-Language Compatibility: Other languages need to recognize and deserialize your types  ","version":"0.15","tagName":"h2"},{"title":"Struct Registration‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/go/type_registration#struct-registration","content":" ","version":"0.15","tagName":"h2"},{"title":"Register by ID‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/go/type_registration#register-by-id","content":" Register a struct with a numeric type ID for compact serialization:  type User struct { ID int64 Name string } f := fory.New() err := f.RegisterStruct(User{}, 1) if err != nil { panic(err) }   ID Guidelines:  IDs must be unique within your applicationIDs must be consistent across all languages for cross-language serializationUse the same ID for the same type in serializer and deserializer  ","version":"0.15","tagName":"h3"},{"title":"Register by Name‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/go/type_registration#register-by-name","content":" Register a struct with a type name string. This is more flexible but has higher serialization cost:  f := fory.New() err := f.RegisterNamedStruct(User{}, &quot;example.User&quot;) if err != nil { panic(err) }   Name Guidelines:  Use fully-qualified names following namespace.TypeName conventionNames must be unique and consistent across all languagesNames are case-sensitive  ","version":"0.15","tagName":"h3"},{"title":"Enum Registration‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/go/type_registration#enum-registration","content":" Go doesn't have native enums, but you can register integer types as enums:  ","version":"0.15","tagName":"h2"},{"title":"Register by ID‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/go/type_registration#register-by-id-1","content":" type Status int32 const ( StatusPending Status = 0 StatusActive Status = 1 StatusComplete Status = 2 ) f := fory.New() err := f.RegisterEnum(Status(0), 1)   ","version":"0.15","tagName":"h3"},{"title":"Register by Name‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/go/type_registration#register-by-name-1","content":" err := f.RegisterNamedEnum(Status(0), &quot;example.Status&quot;)   ","version":"0.15","tagName":"h3"},{"title":"Extension Types‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/go/type_registration#extension-types","content":" For types requiring custom serialization logic, register as extension types with a custom serializer:  f := fory.New() // Register by ID err := f.RegisterExtension(CustomType{}, 1, &amp;CustomSerializer{}) // Or register by name err = f.RegisterNamedExtension(CustomType{}, &quot;example.Custom&quot;, &amp;CustomSerializer{})   See Custom Serializers for details on implementing the ExtensionSerializer interface.  ","version":"0.15","tagName":"h2"},{"title":"Registration Scope‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/go/type_registration#registration-scope","content":" Type registration is per-Fory-instance:  f1 := fory.New() f2 := fory.New() // Types registered on f1 are NOT available on f2 f1.RegisterStruct(User{}, 1) // f2 cannot deserialize User unless also registered f2.RegisterStruct(User{}, 1)   ","version":"0.15","tagName":"h2"},{"title":"Registration Timing‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/go/type_registration#registration-timing","content":" Register types after creating a Fory instance and before any serialize/deserialize calls:  f := fory.New() // Register before use f.RegisterStruct(User{}, 1) f.RegisterStruct(Order{}, 2) // Now serialize/deserialize data, _ := f.Serialize(&amp;User{ID: 1, Name: &quot;Alice&quot;})   ","version":"0.15","tagName":"h2"},{"title":"Nested Type Registration‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/go/type_registration#nested-type-registration","content":" Register all struct types in the object graph, including nested types:  type Address struct { City string Country string } type Person struct { Name string Address Address } f := fory.New() // Register ALL struct types used in the object graph f.RegisterStruct(Address{}, 1) f.RegisterStruct(Person{}, 2)   ","version":"0.15","tagName":"h2"},{"title":"Cross-Language Registration‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/go/type_registration#cross-language-registration","content":" For cross-language serialization, types must be registered consistently across all languages.  ","version":"0.15","tagName":"h2"},{"title":"Using IDs‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/go/type_registration#using-ids","content":" All languages use the same numeric ID:  Go:  f.RegisterStruct(User{}, 1)   Java:  fory.register(User.class, 1);   Python:  fory.register(User, type_id=1)   ","version":"0.15","tagName":"h3"},{"title":"Using Names‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/go/type_registration#using-names","content":" All languages use the same type name:  Go:  f.RegisterNamedStruct(User{}, &quot;example.User&quot;)   Java:  fory.register(User.class, &quot;example.User&quot;);   Python:  fory.register(User, typename=&quot;example.User&quot;)   Rust:  use fory::{Fory, ForyObject}; #[derive(ForyObject)] struct User { id: i64, name: String, } let mut fory = Fory::default(); fory.register_by_name::&lt;User&gt;(&quot;example.User&quot;)?;   ","version":"0.15","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/go/type_registration#best-practices","content":" Register early: Register all types at application startup before any serializationBe consistent: Use the same ID or name across all languages and all instancesRegister all types: Include nested struct types, not just top-level typesPrefer IDs for performance: Numeric IDs have lower serialization overhead than namesUse names for flexibility: Names are easier to manage and less prone to conflicts  ","version":"0.15","tagName":"h2"},{"title":"Common Errors‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/go/type_registration#common-errors","content":" ","version":"0.15","tagName":"h2"},{"title":"Unregistered Type‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/go/type_registration#unregistered-type","content":" error: unknown type encountered   Solution: Register the type before serialization/deserialization.  ","version":"0.15","tagName":"h3"},{"title":"ID/Name Mismatch‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/go/type_registration#idname-mismatch","content":" Data serialized with one ID or name cannot be deserialized if registered with a different ID or name.  Solution: Use consistent IDs or names across serializer and deserializer.  ","version":"0.15","tagName":"h3"},{"title":"Duplicate Registration‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/go/type_registration#duplicate-registration","content":" Two types registered with the same ID will conflict.  Solution: Ensure unique IDs for each type.  ","version":"0.15","tagName":"h3"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/go/type_registration#related-topics","content":" Basic SerializationCross-Language SerializationSupported TypesTroubleshooting ","version":"0.15","tagName":"h2"},{"title":"Troubleshooting","type":0,"sectionRef":"#","url":"/docs/guide/go/troubleshooting","content":"","keywords":"","version":"0.15"},{"title":"Error Types‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#error-types","content":" Fory Go uses typed errors with specific error kinds:  type Error struct { kind ErrorKind message string // Additional context fields } func (e Error) Kind() ErrorKind { return e.kind } func (e Error) Error() string { return e.message }   ","version":"0.15","tagName":"h2"},{"title":"Error Kinds‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#error-kinds","content":" Kind\tValue\tDescriptionErrKindOK\t0\tNo error ErrKindBufferOutOfBound\t1\tRead/write beyond buffer bounds ErrKindTypeMismatch\t2\tType ID mismatch ErrKindUnknownType\t3\tUnknown type encountered ErrKindSerializationFailed\t4\tGeneral serialization failure ErrKindDeserializationFailed\t5\tGeneral deserialization failure ErrKindMaxDepthExceeded\t6\tRecursion depth limit exceeded ErrKindNilPointer\t7\tUnexpected nil pointer ErrKindInvalidRefId\t8\tInvalid reference ID ErrKindHashMismatch\t9\tStruct hash mismatch ErrKindInvalidTag\t10\tInvalid fory struct tag  ","version":"0.15","tagName":"h3"},{"title":"Common Errors and Solutions‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#common-errors-and-solutions","content":" ","version":"0.15","tagName":"h2"},{"title":"ErrKindUnknownType‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#errkindunknowntype","content":" Error: unknown type encountered  Cause: Type not registered before serialization/deserialization.  Solution:  f := fory.New() // Register type before use f.RegisterStruct(User{}, 1) // Now serialization works data, _ := f.Serialize(&amp;User{ID: 1})   ","version":"0.15","tagName":"h3"},{"title":"ErrKindTypeMismatch‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#errkindtypemismatch","content":" Error: type mismatch: expected X, got Y  Cause: Serialized data has different type than expected.  Solutions:  Use correct target type:  // Wrong: Deserializing User into Order var order Order f.Deserialize(userData, &amp;order) // Error! // Correct var user User f.Deserialize(userData, &amp;user)   Ensure consistent registration:  // Serializer f1 := fory.New() f1.RegisterStruct(User{}, 1) // Deserializer - must use same ID f2 := fory.New() f2.RegisterStruct(User{}, 1) // Same ID!   ","version":"0.15","tagName":"h3"},{"title":"ErrKindHashMismatch‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#errkindhashmismatch","content":" Error: hash X is not consistent with Y for type Z  Cause: Struct definition changed between serialization and deserialization.  Solutions:  Enable compatible mode:  f := fory.New(fory.WithCompatible(true))   Ensure struct definitions match:  // Both serializer and deserializer must have same struct type User struct { ID int64 Name string }   Regenerate codegen (if using):  go generate ./...   ","version":"0.15","tagName":"h3"},{"title":"ErrKindMaxDepthExceeded‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#errkindmaxdepthexceeded","content":" Error: max depth exceeded  Cause: Data nesting exceeds maximum depth limit.  Possible causes:  Deeply nested data structures exceeding the default limit (20)Unintended circular references without reference tracking enabledMalicious data: Attackers may craft deeply nested payloads to cause resource exhaustion  Solutions:  Increase max depth (default is 20):  f := fory.New(fory.WithMaxDepth(50))   Enable reference tracking (for circular data):  f := fory.New(fory.WithTrackRef(true))   Check for unintended circular references in your data. Validate untrusted data: When deserializing data from untrusted sources, do not blindly increase max depth. Consider validating input size and structure before deserialization.  ","version":"0.15","tagName":"h3"},{"title":"ErrKindBufferOutOfBound‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#errkindbufferoutofbound","content":" Error: buffer out of bound: offset=X, need=Y, size=Z  Cause: Reading beyond available data.  Solutions:  Ensure complete data transfer:  // Wrong: Truncated data data := fullData[:100] f.Deserialize(data, &amp;target) // Error if data was larger // Correct: Use full data f.Deserialize(fullData, &amp;target)   Check for data corruption: Verify data integrity during transmission.  ","version":"0.15","tagName":"h3"},{"title":"ErrKindInvalidRefId‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#errkindinvalidrefid","content":" Error: invalid reference ID  Cause: Reference to non-existent or unknown object in serialized data.  Solutions:  Ensure reference tracking consistency:  // Serializer and deserializer must have same setting f1 := fory.New(fory.WithTrackRef(true)) f2 := fory.New(fory.WithTrackRef(true)) // Must match!   Check for data corruption.  ","version":"0.15","tagName":"h3"},{"title":"ErrKindInvalidTag‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#errkindinvalidtag","content":" Error: invalid fory struct tag  Cause: Invalid struct tag configuration.  Common causes:  Invalid tag ID: ID must be &gt;= -1  // Wrong: negative ID (other than -1) type Bad struct { Field int `fory:&quot;id=-5&quot;` } // Correct type Good struct { Field int `fory:&quot;id=0&quot;` }   Duplicate tag IDs: Each field must have a unique ID within the struct  // Wrong: duplicate IDs type Bad struct { Field1 int `fory:&quot;id=0&quot;` Field2 int `fory:&quot;id=0&quot;` // Duplicate! } // Correct type Good struct { Field1 int `fory:&quot;id=0&quot;` Field2 int `fory:&quot;id=1&quot;` }   ","version":"0.15","tagName":"h3"},{"title":"Cross-Language Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#cross-language-issues","content":" ","version":"0.15","tagName":"h2"},{"title":"Field Order Mismatch‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#field-order-mismatch","content":" Symptom: Data deserializes but fields have wrong values.  Cause: Different field ordering between languages. In non-compatible mode, fields are sorted by their snake_case names. CamelCase field names (e.g., FirstName) are converted to snake_case (e.g., first_name) for sorting.  Solutions:  Ensure converted snake_case names are consistent: Field names across languages must produce the same snake_case ordering:  type User struct { FirstName string // Go: FirstName -&gt; first_name LastName string // Go: LastName -&gt; last_name // Sorted alphabetically by snake_case: first_name, last_name }   Use field IDs for consistent ordering: Field IDs (non-negative integers) act as aliases for field names, used for both sorting and field matching during deserialization:  type User struct { FirstName string `fory:&quot;id=0&quot;` LastName string `fory:&quot;id=1&quot;` }   Ensure the same field IDs are used across all languages for corresponding fields.  ","version":"0.15","tagName":"h3"},{"title":"Name Registration Mismatch‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#name-registration-mismatch","content":" Symptom: unknown type in other languages.  Solution: Use identical names:  // Go f.RegisterNamedStruct(User{}, &quot;example.User&quot;) // Java - must match exactly fory.register(User.class, &quot;example.User&quot;); // Python fory.register(User, typename=&quot;example.User&quot;)   ","version":"0.15","tagName":"h3"},{"title":"Performance Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#performance-issues","content":" ","version":"0.15","tagName":"h2"},{"title":"Slow Serialization‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#slow-serialization","content":" Possible causes:  Large object graphs: Reduce data size or serialize incrementally. Excessive reference tracking: Disable if not needed:  f := fory.New(fory.WithTrackRef(false))   Deep nesting: Flatten data structures where possible.  ","version":"0.15","tagName":"h3"},{"title":"High Memory Usage‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#high-memory-usage","content":" Possible causes:  Large serialized data: Process in chunks. Reference tracking overhead: Disable if not needed. Buffer not released: Reuse buffers:  buf := fory.NewByteBuffer(nil) f.SerializeTo(buf, value) // Process data buf.Reset() // Reuse for next serialization   ","version":"0.15","tagName":"h3"},{"title":"Thread Contention‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#thread-contention","content":" Symptom: Slowdown under concurrent load.  Solutions:  Use per-goroutine instances for hot paths:  func worker() { f := fory.New() // Each worker has own instance for task := range tasks { f.Serialize(task) } }   Profile pool usage with thread-safe wrapper.  ","version":"0.15","tagName":"h3"},{"title":"Debugging Techniques‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#debugging-techniques","content":" ","version":"0.15","tagName":"h2"},{"title":"Enable Debug Output‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#enable-debug-output","content":" Set environment variable:  ENABLE_FORY_DEBUG_OUTPUT=1 go test ./...   ","version":"0.15","tagName":"h3"},{"title":"Inspect Serialized Data‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#inspect-serialized-data","content":" data, _ := f.Serialize(value) fmt.Printf(&quot;Serialized %d bytes\\n&quot;, len(data)) fmt.Printf(&quot;Header: %x\\n&quot;, data[:4]) // Magic + flags   ","version":"0.15","tagName":"h3"},{"title":"Check Type Registration‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#check-type-registration","content":" // Verify type is registered f := fory.New() err := f.RegisterStruct(User{}, 1) if err != nil { fmt.Printf(&quot;Registration failed: %v\\n&quot;, err) }   ","version":"0.15","tagName":"h3"},{"title":"Compare Struct Hashes‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#compare-struct-hashes","content":" If getting hash mismatch, compare struct definitions:  // Print struct info for debugging t := reflect.TypeOf(User{}) for i := 0; i &lt; t.NumField(); i++ { f := t.Field(i) fmt.Printf(&quot;Field: %s, Type: %s\\n&quot;, f.Name, f.Type) }   ","version":"0.15","tagName":"h3"},{"title":"Testing Tips‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#testing-tips","content":" ","version":"0.15","tagName":"h2"},{"title":"Test Round-Trip‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#test-round-trip","content":" func TestRoundTrip(t *testing.T) { f := fory.New() f.RegisterStruct(User{}, 1) original := &amp;User{ID: 1, Name: &quot;Alice&quot;} data, err := f.Serialize(original) require.NoError(t, err) var result User err = f.Deserialize(data, &amp;result) require.NoError(t, err) assert.Equal(t, original.ID, result.ID) assert.Equal(t, original.Name, result.Name) }   ","version":"0.15","tagName":"h3"},{"title":"Test Cross-Language‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#test-cross-language","content":" cd java/fory-core FORY_GO_JAVA_CI=1 mvn test -Dtest=org.apache.fory.xlang.GoXlangTest   ","version":"0.15","tagName":"h3"},{"title":"Test Schema Evolution‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#test-schema-evolution","content":" func TestSchemaEvolution(t *testing.T) { f1 := fory.New(fory.WithCompatible(true)) f1.RegisterStruct(UserV1{}, 1) data, _ := f1.Serialize(&amp;UserV1{ID: 1, Name: &quot;Alice&quot;}) f2 := fory.New(fory.WithCompatible(true)) f2.RegisterStruct(UserV2{}, 1) var result UserV2 err := f2.Deserialize(data, &amp;result) require.NoError(t, err) }   ","version":"0.15","tagName":"h3"},{"title":"Getting Help‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#getting-help","content":" If you encounter issues not covered here:  Check GitHub Issues: github.com/apache/fory/issuesEnable debug output: ENABLE_FORY_DEBUG_OUTPUT=1Create minimal reproduction: Isolate the problemReport the issue: Include Go version, Fory version, and minimal code  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/go/troubleshooting#related-topics","content":" ConfigurationCross-Language SerializationSchema EvolutionThread Safety ","version":"0.15","tagName":"h2"},{"title":"Java Serialization Guide","type":0,"sectionRef":"#","url":"/docs/guide/java/","content":"","keywords":"","version":"0.15"},{"title":"Features‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/guide/java/#features","content":" ","version":"0.15","tagName":"h2"},{"title":"High Performance‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/guide/java/#high-performance","content":" JIT Code Generation: Highly-extensible JIT framework generates serializer code at runtime using async multi-threaded compilation, delivering 20-170x speedup through: Inlining variables to reduce memory accessInlining method calls to eliminate virtual dispatch overheadMinimizing conditional branchingEliminating hash lookups Zero-Copy: Direct memory access without intermediate buffer copies; row format supports random access and partial serializationVariable-Length Encoding: Optimized compression for integers, longsMeta Sharing: Cached class metadata reduces redundant type informationSIMD Acceleration: Java Vector API support for array operations (Java 16+)  ","version":"0.15","tagName":"h3"},{"title":"Drop-in Replacement‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/guide/java/#drop-in-replacement","content":" 100% JDK Serialization Compatible: Supports writeObject/readObject/writeReplace/readResolve/readObjectNoData/ExternalizableJava 8-24 Support: Works across all modern Java versions including Java 17+ recordsGraalVM Native Image: AOT compilation support without reflection configuration  ","version":"0.15","tagName":"h3"},{"title":"Advanced Features‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/guide/java/#advanced-features","content":" Reference Tracking: Automatic handling of shared and circular referencesSchema Evolution: Forward/backward compatibility for class schema changesPolymorphism: Full support for inheritance hierarchies and interfacesDeep Copy: Efficient deep cloning of complex object graphs with reference preservationSecurity: Class registration and configurable deserialization policies  ","version":"0.15","tagName":"h3"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/guide/java/#quick-start","content":" Note that Fory creation is not cheap, the Fory instances should be reused between serializations instead of creating it every time. You should keep Fory as a static global variable, or instance variable of some singleton object or limited objects.  ","version":"0.15","tagName":"h2"},{"title":"Single-Thread Usage‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/guide/java/#single-thread-usage","content":" import java.util.List; import java.util.Arrays; import org.apache.fory.*; import org.apache.fory.config.*; public class Example { public static void main(String[] args) { SomeClass object = new SomeClass(); // Note that Fory instances should be reused between // multiple serializations of different objects. Fory fory = Fory.builder().withLanguage(Language.JAVA) .requireClassRegistration(true) .build(); // Registering types can reduce class name serialization overhead, but not mandatory. // If class registration enabled, all custom types must be registered. // Registration order must be consistent if id is not specified fory.register(SomeClass.class); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes)); } }   ","version":"0.15","tagName":"h3"},{"title":"Multi-Thread Usage‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/guide/java/#multi-thread-usage","content":" import java.util.List; import java.util.Arrays; import org.apache.fory.*; import org.apache.fory.config.*; public class Example { public static void main(String[] args) { SomeClass object = new SomeClass(); // Note that Fory instances should be reused between // multiple serializations of different objects. ThreadSafeFory fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().withLanguage(Language.JAVA) .withClassLoader(classLoader).build(); f.register(SomeClass.class, 1); return f; }); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes)); } }   ","version":"0.15","tagName":"h3"},{"title":"Fory Instance Reuse Pattern‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/guide/java/#fory-instance-reuse-pattern","content":" import java.util.List; import java.util.Arrays; import org.apache.fory.*; import org.apache.fory.config.*; public class Example { // reuse fory. private static final ThreadSafeFory fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().withLanguage(Language.JAVA) .withClassLoader(classLoader).build(); f.register(SomeClass.class, 1); return f; }); public static void main(String[] args) { SomeClass object = new SomeClass(); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes)); } }   ","version":"0.15","tagName":"h3"},{"title":"Thread Safety‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/guide/java/#thread-safety","content":" Fory provides multiple options for thread-safe serialization:  ","version":"0.15","tagName":"h2"},{"title":"ThreadLocalFory‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/guide/java/#threadlocalfory","content":" Uses thread-local storage to maintain separate Fory instances per thread:  ThreadSafeFory fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().withLanguage(Language.JAVA) .withClassLoader(classLoader).build(); f.register(SomeClass.class, 1); return f; }); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes));   ","version":"0.15","tagName":"h3"},{"title":"ThreadSafeForyPool‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/guide/java/#threadsafeforypool","content":" For virtual threads or environments where thread-local storage is not appropriate, use buildThreadSafeForyPool:  ThreadSafeFory fory = Fory.builder() .withLanguage(Language.JAVA) .withRefTracking(false) .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT) .withAsyncCompilation(true) .buildThreadSafeForyPool(minPoolSize, maxPoolSize);   Note that calling buildThreadSafeFory() on ForyBuilder will create an instance of ThreadLocalFory. This may not be appropriate in environments where virtual threads are used, as each thread will create its own Fory instance, a relatively expensive operation. An alternative for virtual threads is to use buildThreadSafeForyPool.  ","version":"0.15","tagName":"h3"},{"title":"Builder Methods‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/guide/java/#builder-methods","content":" // Single-thread Fory Fory fory = Fory.builder() .withLanguage(Language.JAVA) .withRefTracking(false) .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT) .withAsyncCompilation(true) .build(); // Thread-safe Fory (ThreadLocalFory) ThreadSafeFory fory = Fory.builder() .withLanguage(Language.JAVA) .withRefTracking(false) .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT) .withAsyncCompilation(true) .buildThreadSafeFory();   ","version":"0.15","tagName":"h3"},{"title":"Next Steps‚Äã","type":1,"pageTitle":"Java Serialization Guide","url":"/docs/guide/java/#next-steps","content":" Configuration Options - Learn about ForyBuilder optionsBasic Serialization - Detailed serialization patternsType Registration - Class registration and securityCustom Serializers - Implement custom serializersCross-Language Serialization - Serialize data for other languages ","version":"0.15","tagName":"h2"},{"title":"Basic Serialization","type":0,"sectionRef":"#","url":"/docs/guide/java/basic_serialization","content":"","keywords":"","version":"0.15"},{"title":"Creating Fory Instances‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/java/basic_serialization#creating-fory-instances","content":" ","version":"0.15","tagName":"h2"},{"title":"Single-Thread Fory‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/java/basic_serialization#single-thread-fory","content":" For single-threaded applications:  Fory fory = Fory.builder() .withLanguage(Language.JAVA) // enable reference tracking for shared/circular reference. // Disable it will have better performance if no duplicate reference. .withRefTracking(false) .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT) // enable type forward/backward compatibility // disable it for small size and better performance. // .withCompatibleMode(CompatibleMode.COMPATIBLE) // enable async multi-threaded compilation. .withAsyncCompilation(true) .build(); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes));   ","version":"0.15","tagName":"h3"},{"title":"Thread-Safe Fory‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/java/basic_serialization#thread-safe-fory","content":" For multi-threaded applications:  ThreadSafeFory fory = Fory.builder() .withLanguage(Language.JAVA) // enable reference tracking for shared/circular reference. // Disable it will have better performance if no duplicate reference. .withRefTracking(false) // compress int for smaller size // .withIntCompressed(true) // compress long for smaller size // .withLongCompressed(true) .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT) // enable type forward/backward compatibility // disable it for small size and better performance. // .withCompatibleMode(CompatibleMode.COMPATIBLE) // enable async multi-threaded compilation. .withAsyncCompilation(true) .buildThreadSafeFory(); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes));   ","version":"0.15","tagName":"h3"},{"title":"Object Deep Copy‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/java/basic_serialization#object-deep-copy","content":" Fory provides efficient deep copy functionality:  ","version":"0.15","tagName":"h2"},{"title":"With Reference Tracking‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/java/basic_serialization#with-reference-tracking","content":" Fory fory = Fory.builder().withRefCopy(true).build(); SomeClass a = xxx; SomeClass copied = fory.copy(a);   ","version":"0.15","tagName":"h3"},{"title":"Without Reference Tracking (Better Performance)‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/java/basic_serialization#without-reference-tracking-better-performance","content":" When disabled, deep copy will ignore circular and shared references. Same reference of an object graph will be copied into different objects in one Fory#copy:  Fory fory = Fory.builder().withRefCopy(false).build(); SomeClass a = xxx; SomeClass copied = fory.copy(a);   ","version":"0.15","tagName":"h3"},{"title":"Serialization APIs‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/java/basic_serialization#serialization-apis","content":" ","version":"0.15","tagName":"h2"},{"title":"Basic Serialize/Deserialize‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/java/basic_serialization#basic-serializedeserialize","content":" // Serialize object to byte array byte[] bytes = fory.serialize(object); // Deserialize byte array to object Object obj = fory.deserialize(bytes);   ","version":"0.15","tagName":"h3"},{"title":"Serialize/Deserialize with Type‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/java/basic_serialization#serializedeserialize-with-type","content":" // Serialize with explicit type byte[] bytes = fory.serializeJavaObject(object); // Deserialize with expected type MyClass obj = fory.deserializeJavaObject(bytes, MyClass.class);   ","version":"0.15","tagName":"h3"},{"title":"Serialize/Deserialize with Type Info‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/java/basic_serialization#serializedeserialize-with-type-info","content":" // Serialize with type information byte[] bytes = fory.serializeJavaObjectAndClass(object); // Deserialize with embedded type info Object obj = fory.deserializeJavaObjectAndClass(bytes);   ","version":"0.15","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/java/basic_serialization#best-practices","content":" Reuse Fory instances: Creating Fory is expensive, always reuse instancesUse appropriate thread safety: Choose between single-thread and thread-safe based on your needsRegister classes: Register frequently used classes for better performanceConfigure reference tracking: Disable if you don't have circular/shared references  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/java/basic_serialization#related-topics","content":" Configuration Options - All ForyBuilder optionsType Registration - Class registrationTroubleshooting - Common API usage issues ","version":"0.15","tagName":"h2"},{"title":"Compression","type":0,"sectionRef":"#","url":"/docs/guide/java/compression","content":"","keywords":"","version":"0.15"},{"title":"Integer Compression‚Äã","type":1,"pageTitle":"Compression","url":"/docs/guide/java/compression#integer-compression","content":" ForyBuilder#withIntCompressed/ForyBuilder#withLongCompressed can be used to compress int/long for smaller size. Normally compressing int is enough.  Both compression options are enabled by default. If the serialized size is not important (for example, you use FlatBuffers for serialization before, which doesn't compress anything), then you should disable compression. If your data are all numbers, the compression may bring 80% performance regression.  ","version":"0.15","tagName":"h2"},{"title":"Int Compression‚Äã","type":1,"pageTitle":"Compression","url":"/docs/guide/java/compression#int-compression","content":" For int compression, Fory uses 1~5 bytes for encoding. The first bit in every byte indicates whether there is a next byte. If the first bit is set, then the next byte will be read until the first bit of the next byte is unset.  ","version":"0.15","tagName":"h3"},{"title":"Long Compression‚Äã","type":1,"pageTitle":"Compression","url":"/docs/guide/java/compression#long-compression","content":" For long compression, Fory supports two encodings:  SLI (Small Long as Int) Encoding (Default)‚Äã  If long is in [-1073741824, 1073741823], encode as 4 bytes int: | little-endian: ((int) value) &lt;&lt; 1 |Otherwise write as 9 bytes: | 0b1 | little-endian 8bytes long |  PVL (Progressive Variable-length Long) Encoding‚Äã  First bit in every byte indicates whether there is a next byte. If first bit is set, then next byte will be read until first bit of next byte is unset.Negative numbers will be converted to positive numbers by (v &lt;&lt; 1) ^ (v &gt;&gt; 63) to reduce cost of small negative numbers.  If a number is of long type but can't be represented by smaller bytes mostly, the compression won't get good enough results‚Äînot worthy compared to performance cost. Maybe you should try to disable long compression if you find it didn't bring much space savings.  ","version":"0.15","tagName":"h3"},{"title":"Array Compression‚Äã","type":1,"pageTitle":"Compression","url":"/docs/guide/java/compression#array-compression","content":" Fory supports SIMD-accelerated compression for primitive arrays (int[] and long[]) when array values can fit in smaller data types. This feature is available on Java 16+ and uses the Vector API for optimal performance.  ","version":"0.15","tagName":"h2"},{"title":"How Array Compression Works‚Äã","type":1,"pageTitle":"Compression","url":"/docs/guide/java/compression#how-array-compression-works","content":" Array compression analyzes arrays to determine if values can be stored using fewer bytes:  int[] ‚Üí byte[]: When all values are in range [-128, 127] (75% size reduction)int[] ‚Üí short[]: When all values are in range [-32768, 32767] (50% size reduction)long[] ‚Üí int[]: When all values fit in integer range (50% size reduction)  ","version":"0.15","tagName":"h3"},{"title":"Configuration and Registration‚Äã","type":1,"pageTitle":"Compression","url":"/docs/guide/java/compression#configuration-and-registration","content":" To enable array compression, you must explicitly register the serializers:  Fory fory = Fory.builder() .withLanguage(Language.JAVA) // Enable int array compression .withIntArrayCompressed(true) // Enable long array compression .withLongArrayCompressed(true) .build(); // You must explicitly register compressed array serializers CompressedArraySerializers.registerSerializers(fory);   Note: The fory-simd module must be included in your dependencies for compressed array serializers to be available.  ","version":"0.15","tagName":"h3"},{"title":"Maven Dependency‚Äã","type":1,"pageTitle":"Compression","url":"/docs/guide/java/compression#maven-dependency","content":" &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-simd&lt;/artifactId&gt; &lt;version&gt;0.15.0&lt;/version&gt; &lt;/dependency&gt;   ","version":"0.15","tagName":"h3"},{"title":"String Compression‚Äã","type":1,"pageTitle":"Compression","url":"/docs/guide/java/compression#string-compression","content":" String compression can be enabled via ForyBuilder#withStringCompressed(true). This is disabled by default.  ","version":"0.15","tagName":"h2"},{"title":"Configuration Summary‚Äã","type":1,"pageTitle":"Compression","url":"/docs/guide/java/compression#configuration-summary","content":" Option\tDescription\tDefaultcompressInt\tEnable int compression\ttrue compressLong\tEnable long compression\ttrue compressIntArray\tEnable SIMD int array compression (Java 16+)\tfalse compressLongArray\tEnable SIMD long array compression (Java 16+)\tfalse compressString\tEnable string compression\tfalse  ","version":"0.15","tagName":"h2"},{"title":"Performance Considerations‚Äã","type":1,"pageTitle":"Compression","url":"/docs/guide/java/compression#performance-considerations","content":" Disable compression for numeric-heavy data: If your data is mostly numbers, compression overhead may not be worth itArray compression requires Java 16+: Uses Vector API for SIMD accelerationLong compression may not help large values: If most longs can't fit in smaller representations, disable itString compression has overhead: Only enable if strings are highly compressible  ","version":"0.15","tagName":"h2"},{"title":"Example Configuration‚Äã","type":1,"pageTitle":"Compression","url":"/docs/guide/java/compression#example-configuration","content":" // For mostly numeric data - disable compression Fory fory = Fory.builder() .withLanguage(Language.JAVA) .withIntCompressed(false) .withLongCompressed(false) .build(); // For mixed data with arrays - enable array compression Fory fory = Fory.builder() .withLanguage(Language.JAVA) .withIntCompressed(true) .withLongCompressed(true) .withIntArrayCompressed(true) .withLongArrayCompressed(true) .build(); CompressedArraySerializers.registerSerializers(fory);   ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Compression","url":"/docs/guide/java/compression#related-topics","content":" Configuration Options - All ForyBuilder optionsAdvanced Features - Memory management ","version":"0.15","tagName":"h2"},{"title":"Advanced Features","type":0,"sectionRef":"#","url":"/docs/guide/java/advanced_features","content":"","keywords":"","version":"0.15"},{"title":"Zero-Copy Serialization‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/guide/java/advanced_features#zero-copy-serialization","content":" Fory supports zero-copy serialization for efficient handling of large binary data:  import org.apache.fory.*; import org.apache.fory.config.*; import org.apache.fory.serializer.BufferObject; import org.apache.fory.memory.MemoryBuffer; import java.util.*; import java.util.stream.Collectors; public class ZeroCopyExample { // Note that fory instance should be reused instead of creation every time. static Fory fory = Fory.builder() .withLanguage(Language.JAVA) .build(); public static void main(String[] args) { List&lt;Object&gt; list = Arrays.asList(&quot;str&quot;, new byte[1000], new int[100], new double[100]); Collection&lt;BufferObject&gt; bufferObjects = new ArrayList&lt;&gt;(); byte[] bytes = fory.serialize(list, e -&gt; !bufferObjects.add(e)); List&lt;MemoryBuffer&gt; buffers = bufferObjects.stream() .map(BufferObject::toBuffer).collect(Collectors.toList()); System.out.println(fory.deserialize(bytes, buffers)); } }   ","version":"0.15","tagName":"h2"},{"title":"Object Deep Copy‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/guide/java/advanced_features#object-deep-copy","content":" Fory provides efficient deep copy functionality:  ","version":"0.15","tagName":"h2"},{"title":"With Reference Tracking‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/guide/java/advanced_features#with-reference-tracking","content":" Fory fory = Fory.builder().withRefCopy(true).build(); SomeClass a = xxx; SomeClass copied = fory.copy(a);   ","version":"0.15","tagName":"h3"},{"title":"Without Reference Tracking (Better Performance)‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/guide/java/advanced_features#without-reference-tracking-better-performance","content":" When disabled, deep copy will ignore circular and shared references. Same reference of an object graph will be copied into different objects in one Fory#copy:  Fory fory = Fory.builder().withRefCopy(false).build(); SomeClass a = xxx; SomeClass copied = fory.copy(a);   ","version":"0.15","tagName":"h3"},{"title":"Memory Allocation Customization‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/guide/java/advanced_features#memory-allocation-customization","content":" Fory provides a MemoryAllocator interface that allows you to customize how memory buffers are allocated and grown during serialization operations. This can be useful for performance optimization, memory pooling, or debugging memory usage.  ","version":"0.15","tagName":"h2"},{"title":"MemoryAllocator Interface‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/guide/java/advanced_features#memoryallocator-interface","content":" The MemoryAllocator interface defines two key methods:  public interface MemoryAllocator { /** * Allocates a new MemoryBuffer with the specified initial capacity. */ MemoryBuffer allocate(int initialCapacity); /** * Grows an existing buffer to accommodate the new capacity. * The implementation must grow the buffer in-place by modifying * the existing buffer instance. */ MemoryBuffer grow(MemoryBuffer buffer, int newCapacity); }   ","version":"0.15","tagName":"h3"},{"title":"Using Custom Memory Allocators‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/guide/java/advanced_features#using-custom-memory-allocators","content":" You can set a global memory allocator that will be used by all MemoryBuffer instances:  // Create a custom allocator MemoryAllocator customAllocator = new MemoryAllocator() { @Override public MemoryBuffer allocate(int initialCapacity) { // Add extra capacity for debugging or pooling return MemoryBuffer.fromByteArray(new byte[initialCapacity + 100]); } @Override public MemoryBuffer grow(MemoryBuffer buffer, int newCapacity) { if (newCapacity &lt;= buffer.size()) { return buffer; } // Custom growth strategy - add 100% extra capacity int newSize = (int) (newCapacity * 2); byte[] data = new byte[newSize]; buffer.copyToUnsafe(0, data, Platform.BYTE_ARRAY_OFFSET, buffer.size()); buffer.initHeapBuffer(data, 0, data.length); return buffer; } }; // Set the custom allocator globally MemoryBuffer.setGlobalAllocator(customAllocator); // All subsequent MemoryBuffer allocations will use your custom allocator Fory fory = Fory.builder().withLanguage(Language.JAVA).build(); byte[] bytes = fory.serialize(someObject); // Uses custom allocator   ","version":"0.15","tagName":"h3"},{"title":"Default Memory Allocator Behavior‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/guide/java/advanced_features#default-memory-allocator-behavior","content":" The default allocator uses the following growth strategy:  For buffers smaller than BUFFER_GROW_STEP_THRESHOLD (100MB): multiply capacity by 2For larger buffers: multiply capacity by 1.5 (capped at Integer.MAX_VALUE - 8)  This provides a balance between avoiding frequent reallocations and preventing excessive memory usage.  ","version":"0.15","tagName":"h3"},{"title":"Use Cases‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/guide/java/advanced_features#use-cases","content":" Custom memory allocators are useful for:  Memory Pooling: Reuse allocated buffers to reduce GC pressurePerformance Tuning: Use different growth strategies based on your workloadDebugging: Add logging or tracking to monitor memory usageOff-heap Memory: Integrate with off-heap memory management systems  ","version":"0.15","tagName":"h3"},{"title":"Logging‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/guide/java/advanced_features#logging","content":" ","version":"0.15","tagName":"h2"},{"title":"ForyLogger‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/guide/java/advanced_features#forylogger","content":" By default, Fory uses a custom logger ForyLogger for internal needs. It builds resulting logged data into a single string and sends it directly to System.out. The result line layout is similar to (in Log4j notation):  %d{yyyy-MM-dd hh:mm:ss} %p %C:%L [%t] - %m%n   The layout can't be changed.  Example output:  2025-11-07 08:49:59 INFO CompileUnit:55 [main] - Generate code for org.apache.fory.builder.SerializedLambdaForyCodec_0 took 35 ms. 2025-11-07 08:50:00 INFO JaninoUtils:121 [main] - Compile [SerializedLambdaForyCodec_0] take 144 ms   ","version":"0.15","tagName":"h3"},{"title":"Slf4jLogger‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/guide/java/advanced_features#slf4jlogger","content":" If a more sophisticated logger is required, configure Fory to use Slf4j via LoggerFactory.useSlf4jLogging(). For example, enabling Slf4j before creating Fory:  public static final ThreadSafeFory FORY; static { LoggerFactory.useSlf4jLogging(true); FORY = Fory.builder() .buildThreadSafeFory(); }   Note: Enabling Slf4j via useSlf4jLogging will be ignored when the application runs in a GraalVM native image.  ","version":"0.15","tagName":"h3"},{"title":"Suppress Fory Logs‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/guide/java/advanced_features#suppress-fory-logs","content":" Both ForyLogger and Slf4jLogger allow controlling log output level or suppressing logs entirely. Configure logger level via LoggerFactory.setLogLevel():  static { // to log only WARN and higher LoggerFactory.setLogLevel(LogLevel.WARN_LEVEL); // to disable logging entirely LoggerFactory.disableLogging(); }   Note: Selected logging level is applied before Slf4j implementation's logger level. So if you set WARN_LEVEL (as in the example above) then you will not see INFO messages from Fory even if INFO is enabled in Logback.  ","version":"0.15","tagName":"h3"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Advanced Features","url":"/docs/guide/java/advanced_features#related-topics","content":" Compression - Data compression optionsConfiguration Options - All ForyBuilder optionsCross-Language Serialization - XLANG mode ","version":"0.15","tagName":"h2"},{"title":"Configuration Options","type":0,"sectionRef":"#","url":"/docs/guide/java/configuration","content":"","keywords":"","version":"0.15"},{"title":"ForyBuilder Options‚Äã","type":1,"pageTitle":"Configuration Options","url":"/docs/guide/java/configuration#forybuilder-options","content":" Option Name\tDescription\tDefault ValuetimeRefIgnored\tWhether to ignore reference tracking of all time types registered in TimeSerializers and subclasses of those types when ref tracking is enabled. If ignored, ref tracking of every time type can be enabled by invoking Fory#registerSerializer(Class, Serializer). For example, fory.registerSerializer(Date.class, new DateSerializer(fory, true)). Note that enabling ref tracking should happen before serializer codegen of any types which contain time fields. Otherwise, those fields will still skip ref tracking.\ttrue compressInt\tEnables or disables int compression for smaller size.\ttrue compressLong\tEnables or disables long compression for smaller size.\ttrue compressIntArray\tEnables or disables SIMD-accelerated compression for int arrays when values can fit in smaller data types. Requires Java 16+.\tfalse compressLongArray\tEnables or disables SIMD-accelerated compression for long arrays when values can fit in smaller data types. Requires Java 16+.\tfalse compressString\tEnables or disables string compression for smaller size.\tfalse classLoader\tThe classloader should not be updated; Fory caches class metadata. Use LoaderBinding or ThreadSafeFory for classloader updates.\tThread.currentThread().getContextClassLoader() compatibleMode\tType forward/backward compatibility config. Also Related to checkClassVersion config. SCHEMA_CONSISTENT: Class schema must be consistent between serialization peer and deserialization peer. COMPATIBLE: Class schema can be different between serialization peer and deserialization peer. They can add/delete fields independently. See more.\tCompatibleMode.SCHEMA_CONSISTENT checkClassVersion\tDetermines whether to check the consistency of the class schema. If enabled, Fory checks, writes, and checks consistency using the classVersionHash. It will be automatically disabled when CompatibleMode#COMPATIBLE is enabled. Disabling is not recommended unless you can ensure the class won't evolve.\tfalse checkJdkClassSerializable\tEnables or disables checking of Serializable interface for classes under java.*. If a class under java.* is not Serializable, Fory will throw an UnsupportedOperationException.\ttrue registerGuavaTypes\tWhether to pre-register Guava types such as RegularImmutableMap/RegularImmutableList. These types are not public API, but seem pretty stable.\ttrue requireClassRegistration\tDisabling may allow unknown classes to be deserialized, potentially causing security risks.\ttrue maxDepth\tSet max depth for deserialization, when depth exceeds, an exception will be thrown. This can be used to refuse deserialization DDOS attack.\t50 suppressClassRegistrationWarnings\tWhether to suppress class registration warnings. The warnings can be used for security audit, but may be annoying, this suppression will be enabled by default.\ttrue metaShareEnabled\tEnables or disables meta share mode.\ttrue if CompatibleMode.COMPATIBLE is set, otherwise false. scopedMetaShareEnabled\tScoped meta share focuses on a single serialization process. Metadata created or identified during this process is exclusive to it and is not shared with by other serializations.\ttrue if CompatibleMode.COMPATIBLE is set, otherwise false. metaCompressor\tSet a compressor for meta compression. Note that the passed MetaCompressor should be thread-safe. By default, a Deflater based compressor DeflaterMetaCompressor will be used. Users can pass other compressor such as zstd for better compression rate.\tDeflaterMetaCompressor deserializeUnknownClass\tEnables or disables deserialization/skipping of data for non-existent or unknown classes.\ttrue if CompatibleMode.COMPATIBLE is set, otherwise false. codeGenEnabled\tDisabling may result in faster initial serialization but slower subsequent serializations.\ttrue asyncCompilationEnabled\tIf enabled, serialization uses interpreter mode first and switches to JIT serialization after async serializer JIT for a class is finished.\tfalse scalaOptimizationEnabled\tEnables or disables Scala-specific serialization optimization.\tfalse copyRef\tWhen disabled, the copy performance will be better. But fory deep copy will ignore circular and shared reference. Same reference of an object graph will be copied into different objects in one Fory#copy.\tfalse serializeEnumByName\tWhen Enabled, fory serialize enum by name instead of ordinal.\tfalse  ","version":"0.15","tagName":"h2"},{"title":"Example Configuration‚Äã","type":1,"pageTitle":"Configuration Options","url":"/docs/guide/java/configuration#example-configuration","content":" Fory fory = Fory.builder() .withLanguage(Language.JAVA) // enable reference tracking for shared/circular reference. // Disable it will have better performance if no duplicate reference. .withRefTracking(false) // compress int for smaller size .withIntCompressed(true) // compress long for smaller size .withLongCompressed(true) .withCompatibleMode(CompatibleMode.SCHEMA_CONSISTENT) // enable type forward/backward compatibility // disable it for small size and better performance. // .withCompatibleMode(CompatibleMode.COMPATIBLE) // enable async multi-threaded compilation. .withAsyncCompilation(true) .build();   ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Configuration Options","url":"/docs/guide/java/configuration#related-topics","content":" Schema Evolution - Compatible mode and meta sharingCompression - Int, long, and array compression detailsType Registration - Class registration options ","version":"0.15","tagName":"h2"},{"title":"Cross-Language Serialization","type":0,"sectionRef":"#","url":"/docs/guide/java/cross_language","content":"","keywords":"","version":"0.15"},{"title":"Enable Cross-Language Mode‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/java/cross_language#enable-cross-language-mode","content":" To serialize data for consumption by other languages, use Language.XLANG mode:  import org.apache.fory.*; import org.apache.fory.config.*; // Create Fory instance with XLANG mode Fory fory = Fory.builder() .withLanguage(Language.XLANG) .withRefTracking(true) // Enable reference tracking for complex graphs .build();   ","version":"0.15","tagName":"h2"},{"title":"Register Types for Cross-Language Compatibility‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/java/cross_language#register-types-for-cross-language-compatibility","content":" Types must be registered with consistent IDs or names across all languages. Fory supports two registration methods:  ","version":"0.15","tagName":"h2"},{"title":"Register by ID (Recommended for Performance)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/java/cross_language#register-by-id-recommended-for-performance","content":" public record Person(String name, int age) {} // Register with numeric ID - faster and more compact fory.register(Person.class, 1); Person person = new Person(&quot;Alice&quot;, 30); byte[] bytes = fory.serialize(person); // bytes can be deserialized by Python, Rust, Go, etc.   Benefits: Faster serialization, smaller binary sizeTrade-offs: Requires coordination to avoid ID conflicts across teams/services  ","version":"0.15","tagName":"h3"},{"title":"Register by Name (Recommended for Flexibility)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/java/cross_language#register-by-name-recommended-for-flexibility","content":" public record Person(String name, int age) {} // Register with string name - more flexible fory.register(Person.class, &quot;example.Person&quot;); Person person = new Person(&quot;Alice&quot;, 30); byte[] bytes = fory.serialize(person); // bytes can be deserialized by Python, Rust, Go, etc.   Benefits: Less prone to conflicts, easier management across teams, no coordination neededTrade-offs: Slightly larger binary size due to string encoding  ","version":"0.15","tagName":"h3"},{"title":"Cross-Language Example: Java ‚Üî Python‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/java/cross_language#cross-language-example-java--python","content":" ","version":"0.15","tagName":"h2"},{"title":"Java (Serializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/java/cross_language#java-serializer","content":" import org.apache.fory.*; import org.apache.fory.config.*; public record Person(String name, int age) {} public class Example { public static void main(String[] args) { Fory fory = Fory.builder() .withLanguage(Language.XLANG) .withRefTracking(true) .build(); // Register with consistent name fory.register(Person.class, &quot;example.Person&quot;); Person person = new Person(&quot;Bob&quot;, 25); byte[] bytes = fory.serialize(person); // Send bytes to Python service via network/file/queue } }   ","version":"0.15","tagName":"h3"},{"title":"Python (Deserializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/java/cross_language#python-deserializer","content":" import pyfory from dataclasses import dataclass @dataclass class Person: name: str age: pyfory.int32 # Create Fory in xlang mode fory = pyfory.Fory(xlang=True, ref=True) # Register with the SAME name as Java fory.register_type(Person, typename=&quot;example.Person&quot;) # Deserialize bytes from Java person = fory.deserialize(bytes_from_java) print(f&quot;{person.name}, {person.age}&quot;) # Output: Bob, 25   ","version":"0.15","tagName":"h3"},{"title":"Handling Circular and Shared References‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/java/cross_language#handling-circular-and-shared-references","content":" Cross-language mode supports circular and shared references when reference tracking is enabled:  public class Node { public String value; public Node next; public Node parent; } Fory fory = Fory.builder() .withLanguage(Language.XLANG) .withRefTracking(true) // Required for circular references .build(); fory.register(Node.class, &quot;example.Node&quot;); // Create circular reference Node node1 = new Node(); node1.value = &quot;A&quot;; Node node2 = new Node(); node2.value = &quot;B&quot;; node1.next = node2; node2.parent = node1; // Circular reference byte[] bytes = fory.serialize(node1); // Python/Rust/Go can correctly deserialize this with circular references preserved   ","version":"0.15","tagName":"h2"},{"title":"Type Mapping Considerations‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/java/cross_language#type-mapping-considerations","content":" Not all Java types have equivalents in other languages. When using xlang mode:  Use primitive types (int, long, double, String) for maximum compatibilityUse standard collections (List, Map, Set) instead of language-specific onesAvoid Java-specific types like Optional, BigDecimal (unless the target language supports them)See Type Mapping Guide for complete compatibility matrix  ","version":"0.15","tagName":"h2"},{"title":"Compatible Types‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/java/cross_language#compatible-types","content":" public record UserData( String name, // ‚úÖ Compatible int age, // ‚úÖ Compatible List&lt;String&gt; tags, // ‚úÖ Compatible Map&lt;String, Integer&gt; scores // ‚úÖ Compatible ) {}   ","version":"0.15","tagName":"h3"},{"title":"Problematic Types‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/java/cross_language#problematic-types","content":" public record UserData( Optional&lt;String&gt; name, // ‚ùå Not cross-language compatible BigDecimal balance, // ‚ùå Limited support EnumSet&lt;Status&gt; statuses // ‚ùå Java-specific collection ) {}   ","version":"0.15","tagName":"h3"},{"title":"Performance Considerations‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/java/cross_language#performance-considerations","content":" Cross-language mode has additional overhead compared to Java-only mode:  Type metadata encoding: Adds extra bytes per typeType resolution: Requires name/ID lookup during deserialization  For best performance:  Use ID-based registration when possible (smaller encoding)Disable reference tracking if you don't need circular references (withRefTracking(false))Use Java mode (Language.JAVA) when only Java serialization is needed  ","version":"0.15","tagName":"h2"},{"title":"Cross-Language Best Practices‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/java/cross_language#cross-language-best-practices","content":" Consistent Registration: Ensure all services register types with identical IDs/namesVersion Compatibility: Use compatible mode for schema evolution across services  ","version":"0.15","tagName":"h2"},{"title":"Troubleshooting Cross-Language Serialization‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/java/cross_language#troubleshooting-cross-language-serialization","content":" ","version":"0.15","tagName":"h2"},{"title":"\"Type not registered\" errors‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/java/cross_language#type-not-registered-errors","content":" Verify type is registered with same ID/name on both sidesCheck if type name has typos or case differences  ","version":"0.15","tagName":"h3"},{"title":"\"Type mismatch\" errors‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/java/cross_language#type-mismatch-errors","content":" Ensure field types are compatible across languagesReview Type Mapping Guide  ","version":"0.15","tagName":"h3"},{"title":"Data corruption or unexpected values‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/java/cross_language#data-corruption-or-unexpected-values","content":" Verify both sides use Language.XLANG modeEnsure both sides have compatible Fory versions  ","version":"0.15","tagName":"h3"},{"title":"See Also‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/java/cross_language#see-also","content":" Cross-Language Serialization SpecificationType Mapping ReferencePython Cross-Language GuideRust Cross-Language Guide  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/java/cross_language#related-topics","content":" Schema Evolution - Compatible modeType Registration - Registration methodsRow Format - Cross-language row format ","version":"0.15","tagName":"h2"},{"title":"Migration Guide","type":0,"sectionRef":"#","url":"/docs/guide/java/migration","content":"","keywords":"","version":"0.15"},{"title":"JDK Serialization Migration‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/guide/java/migration#jdk-serialization-migration","content":" If you use JDK serialization before and can't upgrade your client and server at the same time (which is common for online applications), Fory provides a utility method org.apache.fory.serializer.JavaSerializer.serializedByJDK to check whether the binary was generated by JDK serialization.  You can use the following pattern to make existing serialization protocol-aware, then upgrade serialization to Fory in an async rolling-up way:  if (JavaSerializer.serializedByJDK(bytes)) { ObjectInputStream objectInputStream = xxx; return objectInputStream.readObject(); } else { return fory.deserialize(bytes); }   This allows you to:  Deploy new code that can read both JDK and Fory serialized dataGradually migrate serialization to ForyEventually remove JDK serialization support  ","version":"0.15","tagName":"h2"},{"title":"Upgrade Fory‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/guide/java/migration#upgrade-fory","content":" ","version":"0.15","tagName":"h2"},{"title":"Minor Version Upgrades‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/guide/java/migration#minor-version-upgrades","content":" Currently, binary compatibility is ensured for minor versions only. For example, if you are using Fory v0.2.0, binary compatibility will be provided if you upgrade to Fory v0.2.1.  If you upgrade by minor version, or you won't have data serialized by older Fory, you can upgrade Fory directly without any special handling.  ","version":"0.15","tagName":"h3"},{"title":"Major Version Upgrades‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/guide/java/migration#major-version-upgrades","content":" If you upgrade to Fory v0.4.1 from v0.2.x, no binary compatibility is ensured.  Most of the time there is no need to upgrade Fory to a newer major version‚Äîthe current version is fast and compact enough, and we provide some minor fixes for recent older versions.  ","version":"0.15","tagName":"h3"},{"title":"Versioning Serialized Data‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/guide/java/migration#versioning-serialized-data","content":" If you do want to upgrade Fory for better performance and smaller size, you need to write the Fory version as a header to serialized data using code like the following to keep binary compatibility:  Serialization with Version Header‚Äã  MemoryBuffer buffer = xxx; buffer.writeVarInt32(2); // Write Fory version fory.serialize(buffer, obj);   Deserialization with Version Header‚Äã  MemoryBuffer buffer = xxx; int foryVersion = buffer.readVarInt32(); Fory fory = getFory(foryVersion); fory.deserialize(buffer);   getFory is a method to load the corresponding Fory version. You can shade and relocate different versions of Fory to different packages, and load Fory by version.  ","version":"0.15","tagName":"h3"},{"title":"Shading Example‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/guide/java/migration#shading-example","content":" &lt;!-- Maven Shade Plugin configuration for multiple Fory versions --&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-shade-plugin&lt;/artifactId&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;shade-fory-v1&lt;/id&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;shade&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;relocations&gt; &lt;relocation&gt; &lt;pattern&gt;org.apache.fory&lt;/pattern&gt; &lt;shadedPattern&gt;com.myapp.fory.v1&lt;/shadedPattern&gt; &lt;/relocation&gt; &lt;/relocations&gt; &lt;/configuration&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt;   ","version":"0.15","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/guide/java/migration#best-practices","content":" Test thoroughly before upgrading: Ensure compatibility with existing serialized dataUse version headers for long-term storage: If data persists across Fory versionsMaintain backward compatibility: Keep old Fory versions available for reading legacy dataMonitor after upgrade: Watch for deserialization errors in production  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/guide/java/migration#related-topics","content":" Configuration Options - ForyBuilder optionsSchema Evolution - Handling class changesTroubleshooting - Common migration issues ","version":"0.15","tagName":"h2"},{"title":"Row Format","type":0,"sectionRef":"#","url":"/docs/guide/java/row_format","content":"","keywords":"","version":"0.15"},{"title":"Overview‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/java/row_format#overview","content":" Row format is a cache-friendly binary random access format that supports:  Zero-copy access: Read fields directly from binary without allocating objectsPartial deserialization: Access only the fields you needSkipping serialization: Skip serialization of fields you don't needCross-language compatibility: Works across Python, Java, C++, and other languagesColumn format conversion: Can convert to Apache Arrow columnar format automatically  ","version":"0.15","tagName":"h2"},{"title":"Basic Usage‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/java/row_format#basic-usage","content":" public class Bar { String f1; List&lt;Long&gt; f2; } public class Foo { int f1; List&lt;Integer&gt; f2; Map&lt;String, Integer&gt; f3; List&lt;Bar&gt; f4; } RowEncoder&lt;Foo&gt; encoder = Encoders.bean(Foo.class); // Create large dataset Foo foo = new Foo(); foo.f1 = 10; foo.f2 = IntStream.range(0, 1_000_000).boxed().collect(Collectors.toList()); foo.f3 = IntStream.range(0, 1_000_000).boxed().collect(Collectors.toMap(i -&gt; &quot;k&quot; + i, i -&gt; i)); List&lt;Bar&gt; bars = new ArrayList&lt;&gt;(1_000_000); for (int i = 0; i &lt; 1_000_000; i++) { Bar bar = new Bar(); bar.f1 = &quot;s&quot; + i; bar.f2 = LongStream.range(0, 10).boxed().collect(Collectors.toList()); bars.add(bar); } foo.f4 = bars; // Encode to row format (cross-language compatible with Python/C++) BinaryRow binaryRow = encoder.toRow(foo); // Zero-copy random access without full deserialization BinaryArray f2Array = binaryRow.getArray(1); // Access f2 list BinaryArray f4Array = binaryRow.getArray(3); // Access f4 list BinaryRow bar10 = f4Array.getStruct(10); // Access 11th Bar long value = bar10.getArray(1).getInt64(5); // Access 6th element of bar.f2 // Partial deserialization - only deserialize what you need RowEncoder&lt;Bar&gt; barEncoder = Encoders.bean(Bar.class); Bar bar1 = barEncoder.fromRow(f4Array.getStruct(10)); // Deserialize 11th Bar only Bar bar2 = barEncoder.fromRow(f4Array.getStruct(20)); // Deserialize 21st Bar only // Full deserialization when needed Foo newFoo = encoder.fromRow(binaryRow);   ","version":"0.15","tagName":"h2"},{"title":"Key Benefits‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/java/row_format#key-benefits","content":" Feature\tDescriptionZero-Copy Access\tRead nested fields without deserializing entire object Memory Efficiency\tMemory-map large datasets directly from disk Cross-Language\tBinary format compatible between Java, Python, C++ Partial Deserialization\tDeserialize only specific elements you need High Performance\tSkip unnecessary data parsing for analytics workloads  ","version":"0.15","tagName":"h2"},{"title":"When to Use Row Format‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/java/row_format#when-to-use-row-format","content":" Row format is ideal for:  Analytics workloads: When you only need to access specific fieldsLarge datasets: When full deserialization is too expensiveMemory-mapped files: Working with data larger than RAMData pipelines: Processing data without full object reconstructionCross-language data sharing: When data needs to be accessed from multiple languages  ","version":"0.15","tagName":"h2"},{"title":"Cross-Language Compatibility‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/java/row_format#cross-language-compatibility","content":" Row format works seamlessly across languages. The same binary data can be accessed from:  ","version":"0.15","tagName":"h2"},{"title":"Python‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/java/row_format#python","content":" import pyfory import pyarrow as pa from dataclasses import dataclass from typing import List, Dict @dataclass class Bar: f1: str f2: List[pa.int64] @dataclass class Foo: f1: pa.int32 f2: List[pa.int32] f3: Dict[str, pa.int32] f4: List[Bar] encoder = pyfory.encoder(Foo) binary: bytes = encoder.to_row(foo).to_bytes() # Zero-copy access foo_row = pyfory.RowData(encoder.schema, binary) print(foo_row.f2[100000]) print(foo_row.f4[100000].f1)   ","version":"0.15","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/java/row_format#c","content":" #include &quot;fory/encoder/row_encoder.h&quot; #include &quot;fory/row/writer.h&quot; struct Bar { std::string f1; std::vector&lt;int64_t&gt; f2; FORY_STRUCT(Bar, f1, f2); }; struct Foo { int32_t f1; std::vector&lt;int32_t&gt; f2; std::map&lt;std::string, int32_t&gt; f3; std::vector&lt;Bar&gt; f4; FORY_STRUCT(Foo, f1, f2, f3, f4); }; fory::encoder::RowEncoder&lt;Foo&gt; encoder; encoder.Encode(foo); auto row = encoder.GetWriter().ToRow(); // Zero-copy random access auto f2_array = row-&gt;GetArray(1); auto f4_array = row-&gt;GetArray(3); auto bar10 = f4_array-&gt;GetStruct(10); int64_t value = bar10-&gt;GetArray(1)-&gt;GetInt64(5); std::string str = bar10-&gt;GetString(0);   ","version":"0.15","tagName":"h3"},{"title":"Performance Comparison‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/java/row_format#performance-comparison","content":" Operation\tObject Format\tRow FormatFull deserialization\tAllocates all objects\tZero allocation Single field access\tFull deserialization required\tDirect offset read Memory usage\tFull object graph in memory\tOnly accessed fields Suitable for\tSmall objects, full access\tLarge objects, selective access  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/java/row_format#related-topics","content":" Cross-Language Serialization - XLANG modeAdvanced Features - Zero-copy serializationRow Format Specification - Protocol details ","version":"0.15","tagName":"h2"},{"title":"Schema Evolution","type":0,"sectionRef":"#","url":"/docs/guide/java/schema_evolution","content":"","keywords":"","version":"0.15"},{"title":"Handling Class Schema Evolution‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/java/schema_evolution#handling-class-schema-evolution","content":" In many systems, the schema of a class used for serialization may change over time. For instance, fields within a class may be added or removed. When serialization and deserialization processes use different versions of jars, the schema of the class being deserialized may differ from the one used during serialization.  ","version":"0.15","tagName":"h2"},{"title":"Default Mode: SCHEMA_CONSISTENT‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/java/schema_evolution#default-mode-schema_consistent","content":" By default, Fory serializes objects using the CompatibleMode.SCHEMA_CONSISTENT mode. This mode assumes that the deserialization process uses the same class schema as the serialization process, minimizing payload overhead. However, if there is a schema inconsistency, deserialization will fail.  ","version":"0.15","tagName":"h3"},{"title":"Compatible Mode‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/java/schema_evolution#compatible-mode","content":" If the schema is expected to change, to make deserialization succeed (i.e., schema forward/backward compatibility), users must configure Fory to use CompatibleMode.COMPATIBLE. This can be done using the ForyBuilder#withCompatibleMode(CompatibleMode.COMPATIBLE) method.  In this compatible mode, deserialization can handle schema changes such as missing or extra fields, allowing it to succeed even when the serialization and deserialization processes have different class schemas.  Fory fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .build(); byte[] bytes = fory.serialize(object); System.out.println(fory.deserialize(bytes));   This compatible mode involves serializing class metadata into the serialized output. Despite Fory's use of sophisticated compression techniques to minimize overhead, there is still some additional space cost associated with class metadata.  ","version":"0.15","tagName":"h3"},{"title":"Disable Evolution for Stable Classes‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/java/schema_evolution#disable-evolution-for-stable-classes","content":" If a class schema is stable and will not change, you can opt out of schema evolution on a per-class basis to avoid compatible metadata overhead. Annotate the class with @ForyObject(evolving = false) to force STRUCT/NAMED_STRUCT type IDs even when Compatible mode is enabled.  import org.apache.fory.annotation.ForyObject; @ForyObject(evolving = false) public class StableMessage { public int id; public String name; }   ","version":"0.15","tagName":"h3"},{"title":"Meta Sharing‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/java/schema_evolution#meta-sharing","content":" To further reduce metadata costs, Fory introduces a class metadata sharing mechanism, which allows the metadata to be sent to the deserialization process only once.  Fory supports sharing type metadata (class name, field name, final field type information, etc.) between multiple serializations in a context (ex. TCP connection). This information will be sent to the peer during the first serialization in the context. Based on this metadata, the peer can rebuild the same deserializer, which avoids transmitting metadata for subsequent serializations and reduces network traffic pressure while supporting type forward/backward compatibility automatically.  ","version":"0.15","tagName":"h2"},{"title":"Using Meta Sharing‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/java/schema_evolution#using-meta-sharing","content":" // Fory.builder() // .withLanguage(Language.JAVA) // .withRefTracking(false) // // share meta across serialization. // .withMetaShare(true) // Not thread-safe fory. MetaContext context = xxx; fory.getSerializationContext().setMetaContext(context); byte[] bytes = fory.serialize(o); // Not thread-safe fory. MetaContext context = xxx; fory.getSerializationContext().setMetaContext(context); fory.deserialize(bytes);   ","version":"0.15","tagName":"h3"},{"title":"Thread-Safe Meta Sharing‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/java/schema_evolution#thread-safe-meta-sharing","content":" // Thread-safe fory fory.setClassLoader(beanA.getClass().getClassLoader()); byte[] serialized = fory.execute( f -&gt; { f.getSerializationContext().setMetaContext(context); return f.serialize(beanA); } ); // Thread-safe fory fory.setClassLoader(beanA.getClass().getClassLoader()); Object newObj = fory.execute( f -&gt; { f.getSerializationContext().setMetaContext(context); return f.deserialize(serialized); } );   Note: MetaContext is not thread-safe and cannot be reused across instances of Fory or multiple threads. In cases of multi-threading, a separate MetaContext must be created for each Fory instance.  For more details, please refer to the Meta Sharing specification.  ","version":"0.15","tagName":"h3"},{"title":"Deserialize Unknown Classes‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/java/schema_evolution#deserialize-unknown-classes","content":" Fory supports deserializing non-existent or unknown classes. This feature can be enabled by ForyBuilder#deserializeUnknownClass(true).  When enabled and metadata sharing is enabled, Fory will store the deserialized data of this type in a lazy subclass of Map. By using the lazy map implemented by Fory, the rebalance cost of filling map during deserialization can be avoided, which further improves performance.  If this data is sent to another process and the class exists in this process, the data will be deserialized into the object of this type without losing any information.  If metadata sharing is not enabled, the new class data will be skipped and a UnknownSkipClass stub object will be returned.  ","version":"0.15","tagName":"h2"},{"title":"Copy/Map Object from One Type to Another‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/java/schema_evolution#copymap-object-from-one-type-to-another","content":" Fory supports mapping objects from one type to another type.  Notes:  This mapping will execute a deep copy. All mapped fields are serialized into binary and deserialized from that binary to map into another type.All struct types must be registered with the same ID, otherwise Fory cannot map to the correct struct type. Be careful when you use Fory#register(Class), because Fory will allocate an auto-grown ID which might be inconsistent if you register classes with different order between Fory instances.  public class StructMappingExample { static class Struct1 { int f1; String f2; public Struct1(int f1, String f2) { this.f1 = f1; this.f2 = f2; } } static class Struct2 { int f1; String f2; double f3; } static ThreadSafeFory fory1 = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE).buildThreadSafeFory(); static ThreadSafeFory fory2 = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE).buildThreadSafeFory(); static { fory1.register(Struct1.class); fory2.register(Struct2.class); } public static void main(String[] args) { Struct1 struct1 = new Struct1(10, &quot;abc&quot;); Struct2 struct2 = (Struct2) fory2.deserialize(fory1.serialize(struct1)); Assert.assertEquals(struct2.f1, struct1.f1); Assert.assertEquals(struct2.f2, struct1.f2); struct1 = (Struct1) fory1.deserialize(fory2.serialize(struct2)); Assert.assertEquals(struct1.f1, struct2.f1); Assert.assertEquals(struct1.f2, struct2.f2); } }   ","version":"0.15","tagName":"h2"},{"title":"Deserialize POJO into Another Type‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/java/schema_evolution#deserialize-pojo-into-another-type","content":" Fory allows you to serialize one POJO and deserialize it into a different POJO. The different POJO means schema inconsistency. Users must configure Fory with CompatibleMode set to org.apache.fory.config.CompatibleMode.COMPATIBLE.  public class DeserializeIntoType { static class Struct1 { int f1; String f2; public Struct1(int f1, String f2) { this.f1 = f1; this.f2 = f2; } } static class Struct2 { int f1; String f2; double f3; } static ThreadSafeFory fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE).buildThreadSafeFory(); public static void main(String[] args) { Struct1 struct1 = new Struct1(10, &quot;abc&quot;); byte[] data = fory.serializeJavaObject(struct1); Struct2 struct2 = (Struct2) fory.deserializeJavaObject(bytes, Struct2.class); } }   ","version":"0.15","tagName":"h2"},{"title":"Configuration Options‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/java/schema_evolution#configuration-options","content":" Option\tDescription\tDefaultcompatibleMode\tSCHEMA_CONSISTENT or COMPATIBLE\tSCHEMA_CONSISTENT checkClassVersion\tCheck class schema consistency\tfalse metaShareEnabled\tEnable meta sharing\ttrue if Compatible mode scopedMetaShareEnabled\tScoped meta share per serialization\ttrue if Compatible mode deserializeUnknownClass\tHandle non-existent or unknown classes\ttrue if Compatible mode metaCompressor\tCompressor for meta compression\tDeflaterMetaCompressor  ","version":"0.15","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/java/schema_evolution#best-practices","content":" Use COMPATIBLE mode for evolving schemas: When classes may change between versionsEnable meta sharing for network communication: Reduces bandwidth for repeated serializationsUse consistent type IDs for struct mapping: Ensure same registration order or explicit IDsConsider space overhead: Compatible mode adds metadata, balance with your requirements  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/java/schema_evolution#related-topics","content":" Configuration Options - All ForyBuilder optionsCross-Language Serialization - XLANG modeTroubleshooting - Common schema issues ","version":"0.15","tagName":"h2"},{"title":"Field Configuration","type":0,"sectionRef":"#","url":"/docs/guide/java/field_configuration","content":"","keywords":"","version":"0.15"},{"title":"Overview‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/java/field_configuration#overview","content":" Apache Fory‚Ñ¢ provides field-level configuration through annotations:  @ForyField: Configure field metadata (id, nullable, ref, dynamic)@Ignore: Exclude fields from serializationInteger type annotations: Control integer encoding (varint, fixed, tagged, unsigned)  This enables:  Tag IDs: Assign compact numeric IDs to reduce struct field meta size overhead for compatible modeNullability: Control whether fields can be nullReference Tracking: Enable reference tracking for shared objectsField Skipping: Exclude fields from serializationEncoding Control: Specify how integers are encodedPolymorphism Control: Control type info writing for struct fields  ","version":"0.15","tagName":"h2"},{"title":"Basic Syntax‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/java/field_configuration#basic-syntax","content":" Use annotations on fields:  import org.apache.fory.annotation.ForyField; public class Person { @ForyField(id = 0) private String name; @ForyField(id = 1) private int age; @ForyField(id = 2, nullable = true) private String nickname; }   ","version":"0.15","tagName":"h2"},{"title":"The @ForyField Annotation‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/java/field_configuration#the-foryfield-annotation","content":" Use @ForyField to configure field-level metadata:  public class User { @ForyField(id = 0) private long id; @ForyField(id = 1) private String name; @ForyField(id = 2, nullable = true) private String email; @ForyField(id = 3, ref = true) private List&lt;User&gt; friends; @ForyField(id = 4, dynamic = ForyField.Dynamic.TRUE) private Object data; }   ","version":"0.15","tagName":"h2"},{"title":"Parameters‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/java/field_configuration#parameters","content":" Parameter\tType\tDefault\tDescriptionid\tint\t-1\tField tag ID (-1 = use field name) nullable\tboolean\tfalse\tWhether the field can be null ref\tboolean\tfalse\tEnable reference tracking dynamic\tDynamic\tAUTO\tControl polymorphism for struct fields  ","version":"0.15","tagName":"h3"},{"title":"Field ID (id)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/java/field_configuration#field-id-id","content":" Assigns a numeric ID to a field to minimize struct field meta size overhead for compatible mode:  public class User { @ForyField(id = 0) private long id; @ForyField(id = 1) private String name; @ForyField(id = 2) private int age; }   Benefits:  Smaller serialized size (numeric IDs vs field names in metadata)Reduced struct field meta overheadAllows renaming fields without breaking binary compatibility  Recommendation: It is recommended to configure field IDs for compatible mode since it reduces serialization cost.  Notes:  IDs must be unique within a classIDs must be &gt;= 0 (use -1 to use field name encoding, which is the default)If not specified, field name is used in metadata (larger overhead)  Without field IDs (field names used in metadata):  public class User { private long id; private String name; }   ","version":"0.15","tagName":"h2"},{"title":"Nullable Fields (nullable)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/java/field_configuration#nullable-fields-nullable","content":" Use nullable = true for fields that can be null:  public class Record { // Nullable string field @ForyField(id = 0, nullable = true) private String optionalName; // Nullable Integer field (boxed type) @ForyField(id = 1, nullable = true) private Integer optionalCount; // Non-nullable field (default) @ForyField(id = 2) private String requiredName; }   Notes:  Default is nullable = false (non-nullable)When nullable = false, Fory skips writing the null flag (saves 1 byte)Boxed types (Integer, Long, etc.) that can be null should use nullable = true  ","version":"0.15","tagName":"h2"},{"title":"Reference Tracking (ref)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/java/field_configuration#reference-tracking-ref","content":" Enable reference tracking for fields that may be shared or circular:  public class RefOuter { // Both fields may point to the same inner object @ForyField(id = 0, ref = true, nullable = true) private RefInner inner1; @ForyField(id = 1, ref = true, nullable = true) private RefInner inner2; } public class CircularRef { @ForyField(id = 0) private String name; // Self-referencing field for circular references @ForyField(id = 1, ref = true, nullable = true) private CircularRef selfRef; }   Use Cases:  Enable for fields that may be circular or sharedWhen the same object is referenced from multiple fields  Notes:  Default is ref = false (no reference tracking)When ref = false, avoids IdentityMap overhead and skips ref tracking flagReference tracking only takes effect when global ref tracking is enabled  ","version":"0.15","tagName":"h2"},{"title":"Dynamic (Polymorphism Control)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/java/field_configuration#dynamic-polymorphism-control","content":" Controls polymorphism behavior for struct fields in cross-language serialization:  public class Container { // AUTO: Interface/abstract types are dynamic, concrete types are not @ForyField(id = 0, dynamic = ForyField.Dynamic.AUTO) private Animal animal; // Interface - type info written // FALSE: No type info written, uses declared type's serializer @ForyField(id = 1, dynamic = ForyField.Dynamic.FALSE) private Dog dog; // Concrete - no type info // TRUE: Type info written to support runtime subtypes @ForyField(id = 2, dynamic = ForyField.Dynamic.TRUE) private Object data; // Force polymorphic }   Options:  Value\tDescriptionAUTO\tAuto-detect: interface/abstract are dynamic, concrete types are not FALSE\tNo type info written, uses declared type's serializer directly TRUE\tType info written to support subtypes at runtime  ","version":"0.15","tagName":"h2"},{"title":"Skipping Fields‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/java/field_configuration#skipping-fields","content":" ","version":"0.15","tagName":"h2"},{"title":"Using @Ignore‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/java/field_configuration#using-ignore","content":" Exclude fields from serialization:  import org.apache.fory.annotation.Ignore; public class User { @ForyField(id = 0) private long id; @ForyField(id = 1) private String name; @Ignore private String password; // Not serialized @Ignore private Object internalState; // Not serialized }   ","version":"0.15","tagName":"h3"},{"title":"Using transient‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/java/field_configuration#using-transient","content":" Java's transient keyword also excludes fields:  public class User { @ForyField(id = 0) private long id; private transient String password; // Not serialized private transient Object cache; // Not serialized }   ","version":"0.15","tagName":"h3"},{"title":"Integer Type Annotations‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/java/field_configuration#integer-type-annotations","content":" Fory provides annotations to control integer encoding for cross-language compatibility.  ","version":"0.15","tagName":"h2"},{"title":"Signed 32-bit Integer (@Int32Type)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/java/field_configuration#signed-32-bit-integer-int32type","content":" import org.apache.fory.annotation.Int32Type; public class MyStruct { // Variable-length encoding (default) - compact for small values @Int32Type(compress = true) private int compactId; // Fixed 4-byte encoding - consistent size @Int32Type(compress = false) private int fixedId; }   ","version":"0.15","tagName":"h3"},{"title":"Signed 64-bit Integer (@Int64Type)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/java/field_configuration#signed-64-bit-integer-int64type","content":" import org.apache.fory.annotation.Int64Type; import org.apache.fory.config.LongEncoding; public class MyStruct { // Variable-length encoding (default) @Int64Type(encoding = LongEncoding.VARINT) private long compactId; // Fixed 8-byte encoding @Int64Type(encoding = LongEncoding.FIXED) private long fixedTimestamp; // Tagged encoding (4 bytes for small values, 9 bytes otherwise) @Int64Type(encoding = LongEncoding.TAGGED) private long taggedValue; }   ","version":"0.15","tagName":"h3"},{"title":"Unsigned Integers‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/java/field_configuration#unsigned-integers","content":" import org.apache.fory.annotation.Uint8Type; import org.apache.fory.annotation.Uint16Type; import org.apache.fory.annotation.Uint32Type; import org.apache.fory.annotation.Uint64Type; import org.apache.fory.config.LongEncoding; public class UnsignedStruct { // Unsigned 8-bit [0, 255] @Uint8Type private short flags; // Unsigned 16-bit [0, 65535] @Uint16Type private int port; // Unsigned 32-bit with varint encoding (default) @Uint32Type(compress = true) private long compactCount; // Unsigned 32-bit with fixed encoding @Uint32Type(compress = false) private long fixedCount; // Unsigned 64-bit with various encodings @Uint64Type(encoding = LongEncoding.VARINT) private long varintU64; @Uint64Type(encoding = LongEncoding.FIXED) private long fixedU64; @Uint64Type(encoding = LongEncoding.TAGGED) private long taggedU64; }   ","version":"0.15","tagName":"h3"},{"title":"Encoding Summary‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/java/field_configuration#encoding-summary","content":" Annotation\tType ID\tEncoding\tSize@Int32Type(compress = true)\t5\tvarint\t1-5 bytes @Int32Type(compress = false)\t4\tfixed\t4 bytes @Int64Type(encoding = VARINT)\t7\tvarint\t1-10 bytes @Int64Type(encoding = FIXED)\t6\tfixed\t8 bytes @Int64Type(encoding = TAGGED)\t8\ttagged\t4 or 9 bytes @Uint8Type\t9\tfixed\t1 byte @Uint16Type\t10\tfixed\t2 bytes @Uint32Type(compress = true)\t12\tvarint\t1-5 bytes @Uint32Type(compress = false)\t11\tfixed\t4 bytes @Uint64Type(encoding = VARINT)\t14\tvarint\t1-10 bytes @Uint64Type(encoding = FIXED)\t13\tfixed\t8 bytes @Uint64Type(encoding = TAGGED)\t15\ttagged\t4 or 9 bytes  When to Use:  varint: Best for values that are often small (default)fixed: Best for values that use full range (e.g., timestamps, hashes)tagged: Good balance between size and performanceUnsigned types: For cross-language compatibility with Rust, Go, C++  ","version":"0.15","tagName":"h3"},{"title":"Complete Example‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/java/field_configuration#complete-example","content":" import org.apache.fory.Fory; import org.apache.fory.annotation.ForyField; import org.apache.fory.annotation.Ignore; import org.apache.fory.annotation.Int64Type; import org.apache.fory.annotation.Uint64Type; import org.apache.fory.config.LongEncoding; import java.util.List; import java.util.Map; import java.util.Set; public class Document { // Fields with tag IDs (recommended for compatible mode) @ForyField(id = 0) private String title; @ForyField(id = 1) private int version; // Nullable field @ForyField(id = 2, nullable = true) private String description; // Collection fields @ForyField(id = 3) private List&lt;String&gt; tags; @ForyField(id = 4) private Map&lt;String, String&gt; metadata; @ForyField(id = 5) private Set&lt;String&gt; categories; // Integer with different encodings @ForyField(id = 6) @Uint64Type(encoding = LongEncoding.VARINT) private long viewCount; // varint encoding @ForyField(id = 7) @Uint64Type(encoding = LongEncoding.FIXED) private long fileSize; // fixed encoding @ForyField(id = 8) @Uint64Type(encoding = LongEncoding.TAGGED) private long checksum; // tagged encoding // Reference-tracked field for shared/circular references @ForyField(id = 9, ref = true, nullable = true) private Document parent; // Ignored field (not serialized) private transient Object cache; // Getters and setters... } // Usage public class Main { public static void main(String[] args) { Fory fory = Fory.builder() .withXlang(true) .withCompatible(true) .withRefTracking(true) .build(); fory.register(Document.class, 100); Document doc = new Document(); doc.setTitle(&quot;My Document&quot;); doc.setVersion(1); doc.setDescription(&quot;A sample document&quot;); // Serialize byte[] data = fory.serialize(doc); // Deserialize Document decoded = (Document) fory.deserialize(data); } }   ","version":"0.15","tagName":"h2"},{"title":"Cross-Language Compatibility‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/java/field_configuration#cross-language-compatibility","content":" When serializing data to be read by other languages (Python, Rust, C++, Go), use field IDs and matching type annotations:  public class CrossLangData { // Use field IDs for cross-language compatibility @ForyField(id = 0) @Int32Type(compress = true) private int intVar; @ForyField(id = 1) @Uint64Type(encoding = LongEncoding.FIXED) private long longFixed; @ForyField(id = 2) @Uint64Type(encoding = LongEncoding.TAGGED) private long longTagged; @ForyField(id = 3, nullable = true) private String optionalValue; }   ","version":"0.15","tagName":"h2"},{"title":"Schema Evolution‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/java/field_configuration#schema-evolution","content":" Compatible mode supports schema evolution. It is recommended to configure field IDs to reduce serialization cost:  // Version 1 public class DataV1 { @ForyField(id = 0) private long id; @ForyField(id = 1) private String name; } // Version 2: Added new field public class DataV2 { @ForyField(id = 0) private long id; @ForyField(id = 1) private String name; @ForyField(id = 2, nullable = true) private String email; // New field }   Data serialized with V1 can be deserialized with V2 (new field will be null).  Alternatively, field IDs can be omitted (field names will be used in metadata with larger overhead):  public class Data { private long id; private String name; }   ","version":"0.15","tagName":"h2"},{"title":"Native Mode vs Xlang Mode‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/java/field_configuration#native-mode-vs-xlang-mode","content":" Field configuration behaves differently depending on the serialization mode:  ","version":"0.15","tagName":"h2"},{"title":"Native Mode (Java-only)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/java/field_configuration#native-mode-java-only","content":" Native mode has relaxed default values for maximum compatibility:  Nullable: Reference types are nullable by defaultRef tracking: Enabled by default for object references (except String, boxed types, and time types)Polymorphism: All non-final classes support polymorphism by default  In native mode, you typically don't need to configure field annotations unless you want to:  Reduce serialized size by using field IDsOptimize performance by disabling unnecessary ref trackingControl integer encoding for specific fields  // Native mode: works without any annotations public class User { private long id; private String name; private List&lt;String&gt; tags; // Nullable and ref-tracked by default }   ","version":"0.15","tagName":"h3"},{"title":"Xlang Mode (Cross-language)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/java/field_configuration#xlang-mode-cross-language","content":" Xlang mode has stricter default values due to type system differences between languages:  Nullable: Fields are non-nullable by default (nullable = false)Ref tracking: Disabled by default (ref = false)Polymorphism: Concrete types are non-polymorphic by default  In xlang mode, you need to configure fields when:  A field can be null (use nullable = true)A field needs reference tracking for shared/circular objects (use ref = true)Integer types need specific encoding for cross-language compatibilityYou want to reduce metadata size (use field IDs)  // Xlang mode: explicit configuration required for nullable/ref fields public class User { @ForyField(id = 0) private long id; @ForyField(id = 1) private String name; @ForyField(id = 2, nullable = true) // Must declare nullable private String email; @ForyField(id = 3, ref = true, nullable = true) // Must declare ref for shared objects private User friend; }   ","version":"0.15","tagName":"h3"},{"title":"Default Values Summary‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/java/field_configuration#default-values-summary","content":" Option\tNative Mode Default\tXlang Mode Defaultnullable\ttrue (reference types)\tfalse ref\ttrue\tfalse dynamic\ttrue (non-final)\tAUTO (concrete types are final)  ","version":"0.15","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/java/field_configuration#best-practices","content":" Configure field IDs: Recommended for compatible mode to reduce serialization costUse nullable = true for nullable fields: Required for fields that can be nullEnable ref tracking for shared objects: Use ref = true when objects are shared or circularUse @Ignore or transient for sensitive data: Passwords, tokens, internal stateChoose appropriate encoding: varint for small values, fixed for full-range valuesKeep IDs stable: Once assigned, don't change field IDsConfigure unsigned types for cross-language compatibility: When interoperating with unsigned numbers in Rust, Go, C++  ","version":"0.15","tagName":"h2"},{"title":"Annotations Reference‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/java/field_configuration#annotations-reference","content":" Annotation\tDescription@ForyField(id = N)\tField tag ID to reduce metadata size @ForyField(nullable = true)\tMark field as nullable @ForyField(ref = true)\tEnable reference tracking @ForyField(dynamic = ...)\tControl polymorphism for struct fields @Ignore\tExclude field from serialization @Int32Type(compress = ...)\t32-bit signed integer encoding @Int64Type(encoding = ...)\t64-bit signed integer encoding @Uint8Type\tUnsigned 8-bit integer @Uint16Type\tUnsigned 16-bit integer @Uint32Type(compress = ...)\tUnsigned 32-bit integer encoding @Uint64Type(encoding = ...)\tUnsigned 64-bit integer encoding  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/java/field_configuration#related-topics","content":" Basic Serialization - Getting started with Fory serializationSchema Evolution - Compatible mode and schema evolutionCross-Language - Interoperability with Python, Rust, C++, Go ","version":"0.15","tagName":"h2"},{"title":"Troubleshooting","type":0,"sectionRef":"#","url":"/docs/guide/java/troubleshooting","content":"","keywords":"","version":"0.15"},{"title":"Class Inconsistency and Class Version Check‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/java/troubleshooting#class-inconsistency-and-class-version-check","content":" If you create Fory without setting CompatibleMode to org.apache.fory.config.CompatibleMode.COMPATIBLE, and you get a strange serialization error, it may be caused by class inconsistency between the serialization peer and deserialization peer.  In such cases, you can invoke ForyBuilder#withClassVersionCheck to create Fory to validate it. If deserialization throws org.apache.fory.exception.ClassNotCompatibleException, it shows classes are inconsistent, and you should create Fory with ForyBuilder#withCompatibleMode(CompatibleMode.COMPATIBLE).  // Enable class version check to diagnose issues Fory fory = Fory.builder() .withLanguage(Language.JAVA) .withClassVersionCheck(true) .build(); // If ClassNotCompatibleException is thrown, use compatible mode Fory fory = Fory.builder() .withLanguage(Language.JAVA) .withCompatibleMode(CompatibleMode.COMPATIBLE) .build();   Note: CompatibleMode.COMPATIBLE has more performance and space cost. Do not set it by default if your classes are always consistent between serialization and deserialization.  ","version":"0.15","tagName":"h2"},{"title":"Using Wrong API for Deserialization‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/java/troubleshooting#using-wrong-api-for-deserialization","content":" Make sure you use the matching API pairs:  Serialization API\tDeserialization APIFory#serialize\tFory#deserialize Fory#serializeJavaObject\tFory#deserializeJavaObject Fory#serializeJavaObjectAndClass\tFory#deserializeJavaObjectAndClass  Wrong usage examples:  // ‚ùå Wrong: serialize with serialize, deserialize with deserializeJavaObject byte[] bytes = fory.serialize(object); Object result = fory.deserializeJavaObject(bytes, MyClass.class); // Wrong! // ‚ùå Wrong: serialize with serializeJavaObject, deserialize with deserialize byte[] bytes = fory.serializeJavaObject(object); Object result = fory.deserialize(bytes); // Wrong!   Correct usage:  // ‚úÖ Correct: matching API pairs byte[] bytes = fory.serialize(object); Object result = fory.deserialize(bytes); byte[] bytes = fory.serializeJavaObject(object); MyClass result = fory.deserializeJavaObject(bytes, MyClass.class); byte[] bytes = fory.serializeJavaObjectAndClass(object); Object result = fory.deserializeJavaObjectAndClass(bytes);   ","version":"0.15","tagName":"h2"},{"title":"Deserialize POJO into Another Type‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/java/troubleshooting#deserialize-pojo-into-another-type","content":" If you want to serialize one POJO and deserialize it into a different POJO type, you must use CompatibleMode.COMPATIBLE:  public class DeserializeIntoType { static class Struct1 { int f1; String f2; public Struct1(int f1, String f2) { this.f1 = f1; this.f2 = f2; } } static class Struct2 { int f1; String f2; double f3; } static ThreadSafeFory fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE).buildThreadSafeFory(); public static void main(String[] args) { Struct1 struct1 = new Struct1(10, &quot;abc&quot;); byte[] data = fory.serializeJavaObject(struct1); Struct2 struct2 = (Struct2) fory.deserializeJavaObject(data, Struct2.class); } }   ","version":"0.15","tagName":"h2"},{"title":"Common Error Messages‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/java/troubleshooting#common-error-messages","content":" ","version":"0.15","tagName":"h2"},{"title":"\"Class not registered\"‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/java/troubleshooting#class-not-registered","content":" Cause: Class registration is required but the class wasn't registered.  Solution: Register the class before serialization:  fory.register(MyClass.class); // or with explicit ID fory.register(MyClass.class, 100);   ","version":"0.15","tagName":"h3"},{"title":"\"ClassNotCompatibleException\"‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/java/troubleshooting#classnotcompatibleexception","content":" Cause: Class schema differs between serialization and deserialization.  Solution: Use compatible mode:  Fory fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .build();   ","version":"0.15","tagName":"h3"},{"title":"\"Max depth exceeded\"‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/java/troubleshooting#max-depth-exceeded","content":" Cause: Object graph is too deep, possibly indicating a circular reference attack.  Solution: Increase max depth if legitimate, or check for malicious data:  Fory fory = Fory.builder() .withMaxDepth(100) // Increase from default 50 .build();   ","version":"0.15","tagName":"h3"},{"title":"\"Serializer not found\"‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/java/troubleshooting#serializer-not-found","content":" Cause: No serializer registered for the type.  Solution: Register a custom serializer:  fory.registerSerializer(MyClass.class, new MyClassSerializer(fory));   ","version":"0.15","tagName":"h3"},{"title":"Performance Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/java/troubleshooting#performance-issues","content":" ","version":"0.15","tagName":"h2"},{"title":"Slow Initial Serialization‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/java/troubleshooting#slow-initial-serialization","content":" Cause: JIT compilation happening on first serialization.  Solution: Enable async compilation:  Fory fory = Fory.builder() .withAsyncCompilation(true) .build();   ","version":"0.15","tagName":"h3"},{"title":"High Memory Usage‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/java/troubleshooting#high-memory-usage","content":" Cause: Large object graphs or reference tracking overhead.  Solutions:  Disable reference tracking if not needed: .withRefTracking(false)Use custom memory allocator for poolingConsider row format for large datasets  ","version":"0.15","tagName":"h3"},{"title":"Large Serialized Size‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/java/troubleshooting#large-serialized-size","content":" Cause: Metadata overhead or uncompressed data.  Solutions:  Enable compression: .withIntCompressed(true), .withLongCompressed(true)Use compatible mode only when neededRegister classes to avoid class name serialization  ","version":"0.15","tagName":"h3"},{"title":"Debugging Tips‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/java/troubleshooting#debugging-tips","content":" Enable class version check to diagnose schema issuesCheck API pairing - ensure serialize/deserialize APIs matchVerify registration order - must be consistent across peersEnable logging to see internal operations:  LoggerFactory.setLogLevel(LogLevel.DEBUG_LEVEL);   ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/java/troubleshooting#related-topics","content":" Configuration Options - All ForyBuilder optionsSchema Evolution - Compatible mode detailsType Registration - Registration best practicesMigration Guide - Upgrading Fory versions ","version":"0.15","tagName":"h2"},{"title":"Type Registration & Security","type":0,"sectionRef":"#","url":"/docs/guide/java/type_registration","content":"","keywords":"","version":"0.15"},{"title":"Class Registration‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/guide/java/type_registration#class-registration","content":" ForyBuilder#requireClassRegistration can be used to disable class registration. This will allow deserializing objects of unknown types, which is more flexible but may be insecure if the classes contain malicious code.  Do not disable class registration unless you can ensure your environment is secure. Malicious code in init/equals/hashCode can be executed when deserializing unknown/untrusted types when this option is disabled.  Class registration can not only reduce security risks, but also avoid classname serialization cost.  ","version":"0.15","tagName":"h2"},{"title":"Register by ID‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/guide/java/type_registration#register-by-id","content":" You can register class with API Fory#register:  Fory fory = xxx; fory.register(SomeClass.class); fory.register(SomeClass1.class, 1);   Note that class registration order is important. Serialization and deserialization peers should have the same registration order.  Internal type IDs 0-32 are reserved for built-in xlang types. Java native built-ins start atTypes.NONE + 1, and user IDs are encoded as (user_id &lt;&lt; 8) | internal_type_id.  ","version":"0.15","tagName":"h3"},{"title":"Register by Name‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/guide/java/type_registration#register-by-name","content":" Register class by ID will have better performance and smaller space overhead. But in some cases, management for a bunch of type IDs is complex. In such cases, registering class by name using API register(Class&lt;?&gt; cls, String namespace, String typeName) is recommended:  fory.register(Foo.class, &quot;demo&quot;, &quot;Foo&quot;);   If there are no duplicate names for types, namespace can be left as empty to reduce serialized size.  Do not use this API to register class since it will increase serialized size a lot compared to registering class by ID.  ","version":"0.15","tagName":"h3"},{"title":"Security Configuration‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/guide/java/type_registration#security-configuration","content":" ","version":"0.15","tagName":"h2"},{"title":"Class Checker‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/guide/java/type_registration#class-checker","content":" If you invoke ForyBuilder#requireClassRegistration(false) to disable class registration check, you can set org.apache.fory.resolver.ClassChecker by ClassResolver#setClassChecker to control which classes are allowed for serialization.  For example, you can allow classes started with org.example.*:  Fory fory = xxx; fory.getClassResolver().setClassChecker( (classResolver, className) -&gt; className.startsWith(&quot;org.example.&quot;));   ","version":"0.15","tagName":"h3"},{"title":"AllowListChecker‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/guide/java/type_registration#allowlistchecker","content":" Fory provides a org.apache.fory.resolver.AllowListChecker which is an allowed/disallowed list based checker to simplify the customization of class check mechanism:  AllowListChecker checker = new AllowListChecker(AllowListChecker.CheckLevel.STRICT); ThreadSafeFory fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().requireClassRegistration(true).withClassLoader(classLoader).build(); f.getClassResolver().setClassChecker(checker); checker.addListener(f.getClassResolver()); return f; }); checker.allowClass(&quot;org.example.*&quot;);   You can use this checker or implement a more sophisticated checker by yourself.  ","version":"0.15","tagName":"h3"},{"title":"Limit Max Deserialization Depth‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/guide/java/type_registration#limit-max-deserialization-depth","content":" Fory provides ForyBuilder#withMaxDepth to limit max deserialization depth. The default max depth is 50.  If max depth is reached, Fory will throw ForyException. This can be used to prevent malicious data from causing stack overflow or other issues.  Fory fory = Fory.builder() .withLanguage(Language.JAVA) .withMaxDepth(100) // Set custom max depth .build();   ","version":"0.15","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/guide/java/type_registration#best-practices","content":" Always enable class registration in production: Use requireClassRegistration(true)Use ID-based registration for performance: Numeric IDs are faster than string namesMaintain consistent registration order: Same order on both serialization and deserialization sidesSet appropriate max depth: Prevent stack overflow attacksUse AllowListChecker for fine-grained control: When you need flexible class filtering  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/guide/java/type_registration#related-topics","content":" Configuration Options - ForyBuilder security optionsCustom Serializers - Register custom serializersTroubleshooting - Common registration issues ","version":"0.15","tagName":"h2"},{"title":"Kotlin Serialization Guide","type":0,"sectionRef":"#","url":"/docs/guide/kotlin/","content":"","keywords":"","version":"0.15"},{"title":"Features‚Äã","type":1,"pageTitle":"Kotlin Serialization Guide","url":"/docs/guide/kotlin/#features","content":" Fory Kotlin inherits all features from Fory Java, plus Kotlin-specific optimizations:  High Performance: JIT code generation, zero-copy, 20-170x faster than traditional serializationKotlin Type Support: Optimized serializers for data classes, unsigned types, ranges, and stdlib typesDefault Value Support: Automatic handling of Kotlin data class default parameters during schema evolutionSchema Evolution: Forward/backward compatibility for class schema changes  See Java Features for complete feature list.  ","version":"0.15","tagName":"h2"},{"title":"Installation‚Äã","type":1,"pageTitle":"Kotlin Serialization Guide","url":"/docs/guide/kotlin/#installation","content":" ","version":"0.15","tagName":"h2"},{"title":"Maven‚Äã","type":1,"pageTitle":"Kotlin Serialization Guide","url":"/docs/guide/kotlin/#maven","content":" &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-kotlin&lt;/artifactId&gt; &lt;version&gt;0.15.0&lt;/version&gt; &lt;/dependency&gt;   ","version":"0.15","tagName":"h3"},{"title":"Gradle‚Äã","type":1,"pageTitle":"Kotlin Serialization Guide","url":"/docs/guide/kotlin/#gradle","content":" implementation(&quot;org.apache.fory:fory-kotlin:0.15.0&quot;)   ","version":"0.15","tagName":"h3"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Kotlin Serialization Guide","url":"/docs/guide/kotlin/#quick-start","content":" import org.apache.fory.Fory import org.apache.fory.ThreadSafeFory import org.apache.fory.serializer.kotlin.KotlinSerializers data class Person(val name: String, val id: Long, val github: String) data class Point(val x: Int, val y: Int, val z: Int) fun main() { // Create Fory instance (should be reused) val fory: ThreadSafeFory = Fory.builder() .requireClassRegistration(true) .buildThreadSafeFory() // Register Kotlin serializers KotlinSerializers.registerSerializers(fory) // Register your classes fory.register(Person::class.java) fory.register(Point::class.java) val p = Person(&quot;Shawn Yang&quot;, 1, &quot;https://github.com/chaokunyang&quot;) println(fory.deserialize(fory.serialize(p))) println(fory.deserialize(fory.serialize(Point(1, 2, 3)))) }   ","version":"0.15","tagName":"h2"},{"title":"Built on Fory Java‚Äã","type":1,"pageTitle":"Kotlin Serialization Guide","url":"/docs/guide/kotlin/#built-on-fory-java","content":" Fory Kotlin is built on top of Fory Java. Most configuration options, features, and concepts from Fory Java apply directly to Kotlin. Refer to the Java documentation for:  Configuration Options - All ForyBuilder optionsBasic Serialization - Serialization patterns and APIsType Registration - Class registration and securitySchema Evolution - Forward/backward compatibilityCustom Serializers - Implement custom serializersCompression - Int, long, and string compressionTroubleshooting - Common issues and solutions  ","version":"0.15","tagName":"h2"},{"title":"Kotlin-Specific Documentation‚Äã","type":1,"pageTitle":"Kotlin Serialization Guide","url":"/docs/guide/kotlin/#kotlin-specific-documentation","content":" Fory Creation - Kotlin-specific Fory setup requirementsType Serialization - Serializing Kotlin typesDefault Values - Kotlin data class default values support ","version":"0.15","tagName":"h2"},{"title":"Custom Serializers","type":0,"sectionRef":"#","url":"/docs/guide/java/custom_serializers","content":"","keywords":"","version":"0.15"},{"title":"Basic Custom Serializer‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/java/custom_serializers#basic-custom-serializer","content":" In some cases, you may want to implement a serializer for your type, especially for classes that customize serialization using JDK writeObject/writeReplace/readObject/readResolve, which is very inefficient.  For example, if you don't want the following Foo#writeObject to be invoked, you can implement a custom serializer:  class Foo { public long f1; private void writeObject(ObjectOutputStream s) throws IOException { System.out.println(f1); s.defaultWriteObject(); } } class FooSerializer extends Serializer&lt;Foo&gt; { public FooSerializer(Fory fory) { super(fory, Foo.class); } @Override public void write(MemoryBuffer buffer, Foo value) { buffer.writeInt64(value.f1); } @Override public Foo read(MemoryBuffer buffer) { Foo foo = new Foo(); foo.f1 = buffer.readInt64(); return foo; } }   ","version":"0.15","tagName":"h2"},{"title":"Register the Serializer‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/java/custom_serializers#register-the-serializer","content":" Fory fory = getFory(); fory.registerSerializer(Foo.class, new FooSerializer(fory));   Besides registering serializers, you can also implement java.io.Externalizable for a class to customize serialization logic. Such types will be serialized by Fory's ExternalizableSerializer.  ","version":"0.15","tagName":"h3"},{"title":"Collection Serializer‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/java/custom_serializers#collection-serializer","content":" When implementing a serializer for a custom Collection type, you must extend CollectionSerializer or CollectionLikeSerializer. The key difference is that CollectionLikeSerializer can serialize a class which has a collection-like structure but is not a Java Collection subtype.  ","version":"0.15","tagName":"h2"},{"title":"supportCodegenHook Parameter‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/java/custom_serializers#supportcodegenhook-parameter","content":" This special parameter controls serialization behavior:  When true:  Enables optimized access to collection elements and JIT compilation for better performanceDirect serialization invocation and inline for collection items without dynamic serializer dispatch costBetter performance for standard collection typesRecommended for most collections  When false:  Uses interface-based element access and dynamic serializer dispatch for elements (higher cost)More flexible for custom collection typesRequired when collection has special serialization needsHandles complex collection implementations  ","version":"0.15","tagName":"h3"},{"title":"Collection Serializer with JIT Support‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/java/custom_serializers#collection-serializer-with-jit-support","content":" When implementing a Collection serializer with JIT support, leverage Fory's existing binary format and collection serialization infrastructure:  public class CustomCollectionSerializer&lt;T extends Collection&gt; extends CollectionSerializer&lt;T&gt; { public CustomCollectionSerializer(Fory fory, Class&lt;T&gt; cls) { // supportCodegenHook controls whether to use JIT compilation super(fory, cls, true); } @Override public Collection onCollectionWrite(MemoryBuffer buffer, T value) { // Write collection size buffer.writeVarUint32Small7(value.size()); // Write any additional collection metadata return value; } @Override public Collection newCollection(MemoryBuffer buffer) { // Create new collection instance Collection collection = super.newCollection(buffer); // Read and set collection size int numElements = getAndClearNumElements(); setNumElements(numElements); return collection; } }   Note: Invoke setNumElements when implementing newCollection to let Fory know how many elements to deserialize.  ","version":"0.15","tagName":"h3"},{"title":"Custom Collection Serializer without JIT‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/java/custom_serializers#custom-collection-serializer-without-jit","content":" For collections that use primitive arrays or have special requirements, implement a serializer with JIT disabled:  class IntList extends AbstractCollection&lt;Integer&gt; { private final int[] elements; private final int size; public IntList(int size) { this.elements = new int[size]; this.size = size; } public IntList(int[] elements, int size) { this.elements = elements; this.size = size; } @Override public Iterator&lt;Integer&gt; iterator() { return new Iterator&lt;Integer&gt;() { private int index = 0; @Override public boolean hasNext() { return index &lt; size; } @Override public Integer next() { if (!hasNext()) { throw new NoSuchElementException(); } return elements[index++]; } }; } @Override public int size() { return size; } public int get(int index) { if (index &gt;= size) { throw new IndexOutOfBoundsException(); } return elements[index]; } public void set(int index, int value) { if (index &gt;= size) { throw new IndexOutOfBoundsException(); } elements[index] = value; } public int[] getElements() { return elements; } } class IntListSerializer extends CollectionLikeSerializer&lt;IntList&gt; { public IntListSerializer(Fory fory) { // Disable JIT since we're handling serialization directly super(fory, IntList.class, false); } @Override public void write(MemoryBuffer buffer, IntList value) { // Write size buffer.writeVarUint32Small7(value.size()); // Write elements directly as primitive ints int[] elements = value.getElements(); for (int i = 0; i &lt; value.size(); i++) { buffer.writeVarInt32(elements[i]); } } @Override public IntList read(MemoryBuffer buffer) { // Read size int size = buffer.readVarUint32Small7(); // Create array and read elements int[] elements = new int[size]; for (int i = 0; i &lt; size; i++) { elements[i] = buffer.readVarInt32(); } return new IntList(elements, size); } // These methods are not used when JIT is disabled @Override public Collection onCollectionWrite(MemoryBuffer buffer, IntList value) { throw new UnsupportedOperationException(); } @Override public Collection newCollection(MemoryBuffer buffer) { throw new UnsupportedOperationException(); } @Override public IntList onCollectionRead(Collection collection) { throw new UnsupportedOperationException(); } }   When to use this approach:  Working with primitive typesNeed maximum performanceWant to minimize memory overheadHave special serialization requirements  ","version":"0.15","tagName":"h3"},{"title":"Collection-like Type Serializer‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/java/custom_serializers#collection-like-type-serializer","content":" For types that behave like collections but aren't standard Java Collections:  class CustomCollectionLike { private final Object[] elements; private final int size; public CustomCollectionLike(int size) { this.elements = new Object[size]; this.size = 0; } public CustomCollectionLike(Object[] elements, int size) { this.elements = elements; this.size = size; } public Object get(int index) { if (index &gt;= size) { throw new IndexOutOfBoundsException(); } return elements[index]; } public int size() { return size; } public Object[] getElements() { return elements; } } class CollectionView extends AbstractCollection&lt;Object&gt; { private final Object[] elements; private final int size; private int writeIndex; public CollectionView(CustomCollectionLike collection) { this.elements = collection.getElements(); this.size = collection.size(); } public CollectionView(int size) { this.size = size; this.elements = new Object[size]; } @Override public Iterator&lt;Object&gt; iterator() { return new Iterator&lt;Object&gt;() { private int index = 0; @Override public boolean hasNext() { return index &lt; size; } @Override public Object next() { if (!hasNext()) { throw new NoSuchElementException(); } return elements[index++]; } }; } @Override public boolean add(Object element) { if (writeIndex &gt;= size) { throw new IllegalStateException(&quot;Collection is full&quot;); } elements[writeIndex++] = element; return true; } @Override public int size() { return size; } public Object[] getElements() { return elements; } } class CustomCollectionSerializer extends CollectionLikeSerializer&lt;CustomCollectionLike&gt; { public CustomCollectionSerializer(Fory fory) { super(fory, CustomCollectionLike.class, true); } @Override public Collection onCollectionWrite(MemoryBuffer buffer, CustomCollectionLike value) { buffer.writeVarUint32Small7(value.size()); return new CollectionView(value); } @Override public Collection newCollection(MemoryBuffer buffer) { int numElements = buffer.readVarUint32Small7(); setNumElements(numElements); return new CollectionView(numElements); } @Override public CustomCollectionLike onCollectionRead(Collection collection) { CollectionView view = (CollectionView) collection; return new CustomCollectionLike(view.getElements(), view.size()); } }   ","version":"0.15","tagName":"h3"},{"title":"Map Serializer‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/java/custom_serializers#map-serializer","content":" When implementing a serializer for a custom Map type, extend MapSerializer or MapLikeSerializer. The key difference is that MapLikeSerializer can serialize a class which has a map-like structure but is not a Java Map subtype.  ","version":"0.15","tagName":"h2"},{"title":"Map Serializer with JIT Support‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/java/custom_serializers#map-serializer-with-jit-support","content":" public class CustomMapSerializer&lt;T extends Map&gt; extends MapSerializer&lt;T&gt; { public CustomMapSerializer(Fory fory, Class&lt;T&gt; cls) { // supportCodegenHook is a critical parameter that determines serialization behavior super(fory, cls, true); } @Override public Map onMapWrite(MemoryBuffer buffer, T value) { // Write map size buffer.writeVarUint32Small7(value.size()); // Write any additional map metadata here return value; } @Override public Map newMap(MemoryBuffer buffer) { // Read map size int numElements = buffer.readVarUint32Small7(); setNumElements(numElements); // Create and return new map instance T map = (T) new HashMap(numElements); fory.getRefResolver().reference(map); return map; } }   Note: Invoke setNumElements when implementing newMap to let Fory know how many elements to deserialize.  ","version":"0.15","tagName":"h3"},{"title":"Custom Map Serializer without JIT‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/java/custom_serializers#custom-map-serializer-without-jit","content":" For complete control over the serialization process:  class FixedValueMap extends AbstractMap&lt;String, Integer&gt; { private final Set&lt;String&gt; keys; private final int fixedValue; public FixedValueMap(Set&lt;String&gt; keys, int fixedValue) { this.keys = keys; this.fixedValue = fixedValue; } @Override public Set&lt;Entry&lt;String, Integer&gt;&gt; entrySet() { Set&lt;Entry&lt;String, Integer&gt;&gt; entries = new HashSet&lt;&gt;(); for (String key : keys) { entries.add(new SimpleEntry&lt;&gt;(key, fixedValue)); } return entries; } @Override public Integer get(Object key) { return keys.contains(key) ? fixedValue : null; } public Set&lt;String&gt; getKeys() { return keys; } public int getFixedValue() { return fixedValue; } } class FixedValueMapSerializer extends MapLikeSerializer&lt;FixedValueMap&gt; { public FixedValueMapSerializer(Fory fory) { // Disable codegen since we're handling serialization directly super(fory, FixedValueMap.class, false); } @Override public void write(MemoryBuffer buffer, FixedValueMap value) { // Write the fixed value buffer.writeInt32(value.getFixedValue()); // Write the number of keys buffer.writeVarUint32Small7(value.getKeys().size()); // Write each key for (String key : value.getKeys()) { buffer.writeString(key); } } @Override public FixedValueMap read(MemoryBuffer buffer) { // Read the fixed value int fixedValue = buffer.readInt32(); // Read the number of keys int size = buffer.readVarUint32Small7(); Set&lt;String&gt; keys = new HashSet&lt;&gt;(size); for (int i = 0; i &lt; size; i++) { keys.add(buffer.readString()); } return new FixedValueMap(keys, fixedValue); } // These methods are not used when supportCodegenHook is false @Override public Map onMapWrite(MemoryBuffer buffer, FixedValueMap value) { throw new UnsupportedOperationException(); } @Override public FixedValueMap onMapRead(Map map) { throw new UnsupportedOperationException(); } @Override public FixedValueMap onMapCopy(Map map) { throw new UnsupportedOperationException(); } }   ","version":"0.15","tagName":"h3"},{"title":"Map-like Type Serializer‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/java/custom_serializers#map-like-type-serializer","content":" For types that behave like maps but aren't standard Java Maps:  class CustomMapLike { private final Object[] keyArray; private final Object[] valueArray; private final int size; public CustomMapLike(int initialCapacity) { this.keyArray = new Object[initialCapacity]; this.valueArray = new Object[initialCapacity]; this.size = 0; } public CustomMapLike(Object[] keyArray, Object[] valueArray, int size) { this.keyArray = keyArray; this.valueArray = valueArray; this.size = size; } public Integer get(String key) { for (int i = 0; i &lt; size; i++) { if (key.equals(keyArray[i])) { return (Integer) valueArray[i]; } } return null; } public int size() { return size; } public Object[] getKeyArray() { return keyArray; } public Object[] getValueArray() { return valueArray; } } class MapView extends AbstractMap&lt;Object, Object&gt; { private final Object[] keyArray; private final Object[] valueArray; private final int size; private int writeIndex; public MapView(CustomMapLike mapLike) { this.size = mapLike.size(); this.keyArray = mapLike.getKeyArray(); this.valueArray = mapLike.getValueArray(); } public MapView(int size) { this.size = size; this.keyArray = new Object[size]; this.valueArray = new Object[size]; } @Override public Set&lt;Entry&lt;Object, Object&gt;&gt; entrySet() { return new AbstractSet&lt;Entry&lt;Object, Object&gt;&gt;() { @Override public Iterator&lt;Entry&lt;Object, Object&gt;&gt; iterator() { return new Iterator&lt;Entry&lt;Object, Object&gt;&gt;() { private int index = 0; @Override public boolean hasNext() { return index &lt; size; } @Override public Entry&lt;Object, Object&gt; next() { if (!hasNext()) { throw new NoSuchElementException(); } final int currentIndex = index++; return new SimpleEntry&lt;&gt;( keyArray[currentIndex], valueArray[currentIndex] ); } }; } @Override public int size() { return size; } }; } @Override public Object put(Object key, Object value) { if (writeIndex &gt;= size) { throw new IllegalStateException(&quot;Map is full&quot;); } keyArray[writeIndex] = key; valueArray[writeIndex] = value; writeIndex++; return null; } public Object[] getKeyArray() { return keyArray; } public Object[] getValueArray() { return valueArray; } public int size() { return size; } } class CustomMapLikeSerializer extends MapLikeSerializer&lt;CustomMapLike&gt; { public CustomMapLikeSerializer(Fory fory) { super(fory, CustomMapLike.class, true); } @Override public Map onMapWrite(MemoryBuffer buffer, CustomMapLike value) { buffer.writeVarUint32Small7(value.size()); return new MapView(value); } @Override public Map newMap(MemoryBuffer buffer) { int numElements = buffer.readVarUint32Small7(); setNumElements(numElements); return new MapView(numElements); } @Override public CustomMapLike onMapRead(Map map) { MapView view = (MapView) map; return new CustomMapLike(view.getKeyArray(), view.getValueArray(), view.size()); } @Override public CustomMapLike onMapCopy(Map map) { MapView view = (MapView) map; return new CustomMapLike(view.getKeyArray(), view.getValueArray(), view.size()); } }   ","version":"0.15","tagName":"h3"},{"title":"Registering Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/java/custom_serializers#registering-custom-serializers","content":" Fory fory = Fory.builder() .withLanguage(Language.JAVA) .build(); // Register map serializer fory.registerSerializer(CustomMap.class, new CustomMapSerializer&lt;&gt;(fory, CustomMap.class)); // Register collection serializer fory.registerSerializer(CustomCollection.class, new CustomCollectionSerializer&lt;&gt;(fory, CustomCollection.class));   ","version":"0.15","tagName":"h2"},{"title":"Key Points‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/java/custom_serializers#key-points","content":" When implementing custom map or collection serializers:  Always extend the appropriate base class (MapSerializer/MapLikeSerializer for maps, CollectionSerializer/CollectionLikeSerializer for collections)Consider the impact of supportCodegenHook on performance and functionalityProperly handle reference tracking if neededImplement proper size management using setNumElements and getAndClearNumElements when supportCodegenHook is true  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/java/custom_serializers#related-topics","content":" Type Registration - Register serializersSchema Evolution - Compatible mode considerationsConfiguration Options - Serialization options ","version":"0.15","tagName":"h2"},{"title":"Fory Creation","type":0,"sectionRef":"#","url":"/docs/guide/kotlin/fory_creation","content":"","keywords":"","version":"0.15"},{"title":"Basic Setup‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/guide/kotlin/fory_creation#basic-setup","content":" When using Fory for Kotlin serialization, register Kotlin serializers via KotlinSerializers.registerSerializers(fory):  import org.apache.fory.Fory import org.apache.fory.serializer.kotlin.KotlinSerializers val fory = Fory.builder() .requireClassRegistration(true) .build() // Register Kotlin serializers KotlinSerializers.registerSerializers(fory)   ","version":"0.15","tagName":"h2"},{"title":"Thread Safety‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/guide/kotlin/fory_creation#thread-safety","content":" Fory instance creation is not cheap. Instances should be shared between multiple serializations.  ","version":"0.15","tagName":"h2"},{"title":"Single-Thread Usage‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/guide/kotlin/fory_creation#single-thread-usage","content":" import org.apache.fory.Fory import org.apache.fory.serializer.kotlin.KotlinSerializers object ForyHolder { val fory: Fory = Fory.builder() .requireClassRegistration(true) .build().also { KotlinSerializers.registerSerializers(it) } }   ","version":"0.15","tagName":"h3"},{"title":"Multi-Thread Usage‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/guide/kotlin/fory_creation#multi-thread-usage","content":" For multi-threaded applications, use ThreadSafeFory:  import org.apache.fory.Fory import org.apache.fory.ThreadSafeFory import org.apache.fory.ThreadLocalFory import org.apache.fory.serializer.kotlin.KotlinSerializers object ForyHolder { val fory: ThreadSafeFory = ThreadLocalFory { classLoader -&gt; Fory.builder() .withClassLoader(classLoader) .requireClassRegistration(true) .build().also { KotlinSerializers.registerSerializers(it) } } }   ","version":"0.15","tagName":"h3"},{"title":"Using Builder Methods‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/guide/kotlin/fory_creation#using-builder-methods","content":" // Thread-safe Fory val fory: ThreadSafeFory = Fory.builder() .requireClassRegistration(true) .buildThreadSafeFory() KotlinSerializers.registerSerializers(fory)   ","version":"0.15","tagName":"h3"},{"title":"Configuration Options‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/guide/kotlin/fory_creation#configuration-options","content":" All configuration options from Fory Java are available. See Java Configuration Options for the complete list.  Common options for Kotlin:  import org.apache.fory.Fory import org.apache.fory.config.CompatibleMode import org.apache.fory.serializer.kotlin.KotlinSerializers val fory = Fory.builder() // Enable reference tracking for circular references .withRefTracking(true) // Enable schema evolution support .withCompatibleMode(CompatibleMode.COMPATIBLE) // Enable async compilation for better startup performance .withAsyncCompilation(true) // Compression options .withIntCompressed(true) .withLongCompressed(true) .build() KotlinSerializers.registerSerializers(fory)  ","version":"0.15","tagName":"h2"},{"title":"Default Values","type":0,"sectionRef":"#","url":"/docs/guide/kotlin/default_values","content":"","keywords":"","version":"0.15"},{"title":"Overview‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/guide/kotlin/default_values#overview","content":" When a Kotlin data class has parameters with default values, Fory can:  Detect default values using Kotlin reflectionApply default values during deserialization when fields are missing from serialized dataSupport schema evolution by allowing new fields with defaults to be added without breaking existing serialized data  ","version":"0.15","tagName":"h2"},{"title":"Usage‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/guide/kotlin/default_values#usage","content":" This feature is automatically enabled when:  Compatible mode is enabled (withCompatibleMode(CompatibleMode.COMPATIBLE))Kotlin serializers are registered (KotlinSerializers.registerSerializers(fory))A field is missing from the serialized data but exists in the target class with a default value  ","version":"0.15","tagName":"h2"},{"title":"Example‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/guide/kotlin/default_values#example","content":" import org.apache.fory.Fory import org.apache.fory.config.CompatibleMode import org.apache.fory.serializer.kotlin.KotlinSerializers // Original data class data class User(val name: String, val age: Int) // Evolved data class with new field and default value data class UserV2(val name: String, val age: Int, val email: String = &quot;default@example.com&quot;) fun main() { val fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .build() KotlinSerializers.registerSerializers(fory) fory.register(User::class.java) fory.register(UserV2::class.java) // Serialize with old schema val oldUser = User(&quot;John&quot;, 30) val serialized = fory.serialize(oldUser) // Deserialize with new schema - missing field gets default value val newUser = fory.deserialize(serialized) as UserV2 println(newUser) // UserV2(name=John, age=30, email=default@example.com) }   ","version":"0.15","tagName":"h2"},{"title":"Supported Default Value Types‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/guide/kotlin/default_values#supported-default-value-types","content":" The following types are supported for default values:  Primitive types: Int, Long, Double, Float, Boolean, Byte, Short, CharUnsigned types: UInt, ULong, UByte, UShortString: StringCollections: List, Set, Map (with default instances)Custom objects: Any object that can be instantiated via reflection  ","version":"0.15","tagName":"h2"},{"title":"Complex Default Values‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/guide/kotlin/default_values#complex-default-values","content":" Default values can be complex expressions:  data class ConfigV1(val name: String) data class ConfigV2( val name: String, val settings: Map&lt;String, String&gt; = mapOf(&quot;default&quot; to &quot;value&quot;), val tags: List&lt;String&gt; = listOf(&quot;default&quot;), val enabled: Boolean = true, val retryCount: Int = 3 ) val fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .build() KotlinSerializers.registerSerializers(fory) val original = ConfigV1(&quot;myConfig&quot;) val serialized = fory.serialize(original) val deserialized = fory.deserialize(serialized) as ConfigV2 // deserialized.name == &quot;myConfig&quot; // deserialized.settings == mapOf(&quot;default&quot; to &quot;value&quot;) // deserialized.tags == listOf(&quot;default&quot;) // deserialized.enabled == true // deserialized.retryCount == 3   ","version":"0.15","tagName":"h2"},{"title":"Nullable Fields with Defaults‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/guide/kotlin/default_values#nullable-fields-with-defaults","content":" Nullable fields with default values are also supported:  data class PersonV1(val name: String) data class PersonV2( val name: String, val nickname: String? = null, val age: Int? = null ) val original = PersonV1(&quot;John&quot;) val serialized = fory.serialize(original) val deserialized = fory.deserialize(serialized) as PersonV2 // deserialized.name == &quot;John&quot; // deserialized.nickname == null (default) // deserialized.age == null (default)   ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/guide/kotlin/default_values#related-topics","content":" Schema Evolution - Forward/backward compatibility in JavaFory Creation - Setting up Fory with compatible mode ","version":"0.15","tagName":"h2"},{"title":"Python Serialization Guide","type":0,"sectionRef":"#","url":"/docs/guide/python/","content":"","keywords":"","version":"0.15"},{"title":"Key Features‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/guide/python/#key-features","content":" ","version":"0.15","tagName":"h2"},{"title":"Flexible Serialization Modes‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/guide/python/#flexible-serialization-modes","content":" Python native Mode: Full Python compatibility, drop-in replacement for pickle/cloudpickleCross-Language Mode: Optimized for multi-language data exchangeRow Format: Zero-copy row format for analytics workloads  ","version":"0.15","tagName":"h3"},{"title":"Versatile Serialization Features‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/guide/python/#versatile-serialization-features","content":" Shared/circular reference support for complex object graphs in both Python-native and cross-language modesPolymorphism support for customized types with automatic type dispatchingSchema evolution support for backward/forward compatibility when using dataclasses in cross-language modeOut-of-band buffer support for zero-copy serialization of large data structures like NumPy arrays and Pandas DataFrames, compatible with pickle protocol 5  ","version":"0.15","tagName":"h3"},{"title":"Blazing Fast Performance‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/guide/python/#blazing-fast-performance","content":" Extremely fast performance compared to other serialization frameworksRuntime code generation and Cython-accelerated core implementation for optimal performance  ","version":"0.15","tagName":"h3"},{"title":"Compact Data Size‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/guide/python/#compact-data-size","content":" Compact object graph protocol with minimal space overhead‚Äîup to 3√ó size reduction compared to pickle/cloudpickleMeta packing and sharing to minimize type forward/backward compatibility space overhead  ","version":"0.15","tagName":"h3"},{"title":"Security & Safety‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/guide/python/#security--safety","content":" Strict mode prevents deserialization of untrusted types by type registration and checks.Reference tracking for handling circular references safely  ","version":"0.15","tagName":"h3"},{"title":"Installation‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/guide/python/#installation","content":" ","version":"0.15","tagName":"h2"},{"title":"Basic Installation‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/guide/python/#basic-installation","content":" pip install pyfory   ","version":"0.15","tagName":"h3"},{"title":"Optional Dependencies‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/guide/python/#optional-dependencies","content":" # Install with row format support (requires Apache Arrow) pip install pyfory[format] # Install from source for development git clone https://github.com/apache/fory.git cd fory/python pip install -e &quot;.[dev,format]&quot;   ","version":"0.15","tagName":"h3"},{"title":"Requirements‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/guide/python/#requirements","content":" Python: 3.8 or higherOS: Linux, macOS, Windows  ","version":"0.15","tagName":"h3"},{"title":"Thread Safety‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/guide/python/#thread-safety","content":" pyfory provides ThreadSafeFory for thread-safe serialization using a pooled wrapper:  import pyfory import threading from dataclasses import dataclass @dataclass class Person: name: str age: int # Create thread-safe Fory instance fory = pyfory.ThreadSafeFory(xlang=False, ref=True) fory.register(Person) # Use in multiple threads safely def serialize_in_thread(thread_id): person = Person(name=f&quot;User{thread_id}&quot;, age=25 + thread_id) data = fory.serialize(person) result = fory.deserialize(data) print(f&quot;Thread {thread_id}: {result}&quot;) threads = [threading.Thread(target=serialize_in_thread, args=(i,)) for i in range(10)] for t in threads: t.start() for t in threads: t.join()   Key Features:  Instance Pool: Maintains a pool of Fory instances protected by a lock for thread safetyShared Configuration: All registrations must be done upfront and are applied to all instancesSame API: Drop-in replacement for Fory class with identical methodsRegistration Safety: Prevents registration after first use to ensure consistency  When to Use:  Multi-threaded Applications: Web servers, concurrent workers, parallel processingShared Fory Instances: When multiple threads need to serialize/deserialize dataThread Pools: Applications using thread pools or concurrent.futures  ","version":"0.15","tagName":"h2"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/guide/python/#quick-start","content":" import pyfory from dataclasses import dataclass @dataclass class Person: name: str age: int # Create Fory instance fory = pyfory.Fory(xlang=False, ref=True) fory.register(Person) person = Person(&quot;Alice&quot;, 30) data = fory.serialize(person) result = fory.deserialize(data) print(result) # Person(name='Alice', age=30)   ","version":"0.15","tagName":"h2"},{"title":"Next Steps‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/guide/python/#next-steps","content":" Configuration - Fory parameters and modesBasic Serialization - Basic usage patternsPython Native Mode - Functions, lambdas, classesCross-Language - XLANG modeRow Format - Zero-copy row formatSecurity - Security best practices  ","version":"0.15","tagName":"h2"},{"title":"Links‚Äã","type":1,"pageTitle":"Python Serialization Guide","url":"/docs/guide/python/#links","content":" Documentation: https://fory.apache.org/docs/latest/python_guide/GitHub: https://github.com/apache/foryPyPI: https://pypi.org/project/pyfory/Issues: https://github.com/apache/fory/issuesSlack: https://join.slack.com/t/fory-project/shared_invite/zt-36g0qouzm-kcQSvV_dtfbtBKHRwT5gsw ","version":"0.15","tagName":"h2"},{"title":"Basic Serialization","type":0,"sectionRef":"#","url":"/docs/guide/python/basic_serialization","content":"","keywords":"","version":"0.15"},{"title":"Basic Object Serialization‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/python/basic_serialization#basic-object-serialization","content":" Serialize and deserialize Python objects with a simple API:  import pyfory # Create Fory instance fory = pyfory.Fory(xlang=True) # Serialize any Python object data = fory.dumps({&quot;name&quot;: &quot;Alice&quot;, &quot;age&quot;: 30, &quot;scores&quot;: [95, 87, 92]}) # Deserialize back to Python object obj = fory.loads(data) print(obj) # {'name': 'Alice', 'age': 30, 'scores': [95, 87, 92]}   Note: dumps()/loads() are aliases for serialize()/deserialize(). Both APIs are identical, use whichever feels more intuitive.  ","version":"0.15","tagName":"h2"},{"title":"Custom Class Serialization‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/python/basic_serialization#custom-class-serialization","content":" Fory automatically handles dataclasses and custom types:  import pyfory from dataclasses import dataclass from typing import List, Dict @dataclass class Person: name: str age: int scores: List[int] metadata: Dict[str, str] # Python mode - supports all Python types including dataclasses fory = pyfory.Fory(xlang=False, ref=True) fory.register(Person) person = Person(&quot;Bob&quot;, 25, [88, 92, 85], {&quot;team&quot;: &quot;engineering&quot;}) data = fory.serialize(person) result = fory.deserialize(data) print(result) # Person(name='Bob', age=25, ...)   ","version":"0.15","tagName":"h2"},{"title":"Reference Tracking & Circular References‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/python/basic_serialization#reference-tracking--circular-references","content":" Handle shared references and circular dependencies safely:  import pyfory f = pyfory.Fory(ref=True) # Enable reference tracking # Handle circular references safely class Node: def __init__(self, value): self.value = value self.children = [] self.parent = None root = Node(&quot;root&quot;) child = Node(&quot;child&quot;) child.parent = root # Circular reference root.children.append(child) # Serializes without infinite recursion data = f.serialize(root) result = f.deserialize(data) assert result.children[0].parent is result # Reference preserved   ","version":"0.15","tagName":"h2"},{"title":"API Reference‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/python/basic_serialization#api-reference","content":" ","version":"0.15","tagName":"h2"},{"title":"Serialization Methods‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/python/basic_serialization#serialization-methods","content":" # Serialize to bytes data: bytes = fory.serialize(obj) data: bytes = fory.dumps(obj) # Alias # Deserialize from bytes obj = fory.deserialize(data) obj = fory.loads(data) # Alias   ","version":"0.15","tagName":"h3"},{"title":"With Out-of-Band Buffers‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/python/basic_serialization#with-out-of-band-buffers","content":" # Serialize with buffer callback buffer_objects = [] data = fory.serialize(obj, buffer_callback=buffer_objects.append) # Deserialize with buffers buffers = [obj.getbuffer() for obj in buffer_objects] obj = fory.deserialize(data, buffers=buffers)   ","version":"0.15","tagName":"h3"},{"title":"Performance Tips‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/python/basic_serialization#performance-tips","content":" Disable ref=True if not needed: Reference tracking has overheadUse type_id instead of typename: Integer IDs are faster than string namesReuse Fory instances: Create once, use many timesEnable Cython: Make sure ENABLE_FORY_CYTHON_SERIALIZATION=1  # Good: Reuse instance fory = pyfory.Fory() for obj in objects: data = fory.dumps(obj) # Bad: Create new instance each time for obj in objects: fory = pyfory.Fory() # Wasteful! data = fory.dumps(obj)   ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/python/basic_serialization#related-topics","content":" Configuration - Fory parametersType Registration - Registration patternsPython Native Mode - Functions and lambdas ","version":"0.15","tagName":"h2"},{"title":"Type Serialization","type":0,"sectionRef":"#","url":"/docs/guide/kotlin/type_serialization","content":"","keywords":"","version":"0.15"},{"title":"Setup‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/kotlin/type_serialization#setup","content":" All examples assume the following setup:  import org.apache.fory.Fory import org.apache.fory.serializer.kotlin.KotlinSerializers val fory = Fory.builder() .requireClassRegistration(false) .build() KotlinSerializers.registerSerializers(fory)   ","version":"0.15","tagName":"h2"},{"title":"Data Class‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/kotlin/type_serialization#data-class","content":" data class Person(val name: String, val age: Int, val id: Long) fory.register(Person::class.java) val p = Person(&quot;John&quot;, 30, 1L) println(fory.deserialize(fory.serialize(p)))   ","version":"0.15","tagName":"h2"},{"title":"Unsigned Primitives‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/kotlin/type_serialization#unsigned-primitives","content":" Kotlin unsigned types are fully supported:  val uByte: UByte = 255u val uShort: UShort = 65535u val uInt: UInt = 4294967295u val uLong: ULong = 18446744073709551615u println(fory.deserialize(fory.serialize(uByte))) println(fory.deserialize(fory.serialize(uShort))) println(fory.deserialize(fory.serialize(uInt))) println(fory.deserialize(fory.serialize(uLong)))   ","version":"0.15","tagName":"h2"},{"title":"Unsigned Arrays‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/kotlin/type_serialization#unsigned-arrays","content":" val uByteArray = ubyteArrayOf(1u, 2u, 255u) val uShortArray = ushortArrayOf(1u, 2u, 65535u) val uIntArray = uintArrayOf(1u, 2u, 4294967295u) val uLongArray = ulongArrayOf(1u, 2u, 18446744073709551615u) println(fory.deserialize(fory.serialize(uByteArray)).contentToString()) println(fory.deserialize(fory.serialize(uShortArray)).contentToString()) println(fory.deserialize(fory.serialize(uIntArray)).contentToString()) println(fory.deserialize(fory.serialize(uLongArray)).contentToString())   ","version":"0.15","tagName":"h2"},{"title":"Stdlib Types‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/kotlin/type_serialization#stdlib-types","content":" ","version":"0.15","tagName":"h2"},{"title":"Pair and Triple‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/kotlin/type_serialization#pair-and-triple","content":" val pair = Pair(&quot;key&quot;, 42) val triple = Triple(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;) println(fory.deserialize(fory.serialize(pair))) println(fory.deserialize(fory.serialize(triple)))   ","version":"0.15","tagName":"h3"},{"title":"Result‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/kotlin/type_serialization#result","content":" val success: Result&lt;Int&gt; = Result.success(42) val failure: Result&lt;Int&gt; = Result.failure(Exception(&quot;error&quot;)) println(fory.deserialize(fory.serialize(success))) println(fory.deserialize(fory.serialize(failure)))   ","version":"0.15","tagName":"h3"},{"title":"Ranges and Progressions‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/kotlin/type_serialization#ranges-and-progressions","content":" val intRange = 1..10 val longRange = 1L..100L val charRange = 'a'..'z' println(fory.deserialize(fory.serialize(intRange))) println(fory.deserialize(fory.serialize(longRange))) println(fory.deserialize(fory.serialize(charRange))) // Progressions val intProgression = 1..10 step 2 val longProgression = 1L..100L step 10 println(fory.deserialize(fory.serialize(intProgression))) println(fory.deserialize(fory.serialize(longProgression)))   ","version":"0.15","tagName":"h2"},{"title":"Collections‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/kotlin/type_serialization#collections","content":" ","version":"0.15","tagName":"h2"},{"title":"ArrayDeque‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/kotlin/type_serialization#arraydeque","content":" val deque = ArrayDeque&lt;String&gt;() deque.addFirst(&quot;first&quot;) deque.addLast(&quot;last&quot;) println(fory.deserialize(fory.serialize(deque)))   ","version":"0.15","tagName":"h3"},{"title":"Empty Collections‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/kotlin/type_serialization#empty-collections","content":" val emptyList = emptyList&lt;String&gt;() val emptySet = emptySet&lt;Int&gt;() val emptyMap = emptyMap&lt;String, Int&gt;() println(fory.deserialize(fory.serialize(emptyList))) println(fory.deserialize(fory.serialize(emptySet))) println(fory.deserialize(fory.serialize(emptyMap)))   ","version":"0.15","tagName":"h3"},{"title":"Duration‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/kotlin/type_serialization#duration","content":" import kotlin.time.Duration import kotlin.time.Duration.Companion.hours import kotlin.time.Duration.Companion.minutes val duration: Duration = 2.hours + 30.minutes println(fory.deserialize(fory.serialize(duration)))   ","version":"0.15","tagName":"h2"},{"title":"Regex‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/kotlin/type_serialization#regex","content":" val regex = Regex(&quot;[a-zA-Z]+&quot;) println(fory.deserialize(fory.serialize(regex)))   ","version":"0.15","tagName":"h2"},{"title":"UUID (Kotlin 2.0+)‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/kotlin/type_serialization#uuid-kotlin-20","content":" import kotlin.uuid.Uuid val uuid = Uuid.random() println(fory.deserialize(fory.serialize(uuid)))   ","version":"0.15","tagName":"h2"},{"title":"Types Working Out of the Box‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/kotlin/type_serialization#types-working-out-of-the-box","content":" The following types work with the default Fory Java implementation without needing KotlinSerializers:  Primitives: Byte, Boolean, Int, Short, Long, Char, Float, DoubleString: StringCollections: ArrayList, HashMap, HashSet, LinkedHashSet, LinkedHashMapArrays: Array, BooleanArray, ByteArray, CharArray, DoubleArray, FloatArray, IntArray, LongArray, ShortArray  However, it's recommended to always call KotlinSerializers.registerSerializers(fory) to ensure all Kotlin types are properly supported. ","version":"0.15","tagName":"h2"},{"title":"Cross-Language Serialization","type":0,"sectionRef":"#","url":"/docs/guide/python/cross_language","content":"","keywords":"","version":"0.15"},{"title":"Enable Cross-Language Mode‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/python/cross_language#enable-cross-language-mode","content":" To use xlang mode, create Fory with xlang=True:  import pyfory fory = pyfory.Fory(xlang=True, ref=False, strict=True)   ","version":"0.15","tagName":"h2"},{"title":"Cross-Language Example‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/python/cross_language#cross-language-example","content":" ","version":"0.15","tagName":"h2"},{"title":"Python (Serializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/python/cross_language#python-serializer","content":" import pyfory from dataclasses import dataclass # Cross-language mode for interoperability f = pyfory.Fory(xlang=True, ref=True) # Register type for cross-language compatibility @dataclass class Person: name: str age: pyfory.int32 f.register(Person, typename=&quot;example.Person&quot;) person = Person(&quot;Charlie&quot;, 35) binary_data = f.serialize(person) # binary_data can now be sent to Java, Go, etc.   ","version":"0.15","tagName":"h3"},{"title":"Java (Deserializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/python/cross_language#java-deserializer","content":" import org.apache.fory.*; public class Person { public String name; public int age; } Fory fory = Fory.builder() .withLanguage(Language.XLANG) .withRefTracking(true) .build(); fory.register(Person.class, &quot;example.Person&quot;); Person person = (Person) fory.deserialize(binaryData);   ","version":"0.15","tagName":"h3"},{"title":"Rust (Deserializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/python/cross_language#rust-deserializer","content":" use fory::Fory; use fory::ForyObject; #[derive(ForyObject)] struct Person { name: String, age: i32, } let mut fory = Fory::default() .compatible(true) .xlang(true); fory.register_by_namespace::&lt;Person&gt;(&quot;example&quot;, &quot;Person&quot;); let person: Person = fory.deserialize(&amp;binary_data)?;   ","version":"0.15","tagName":"h3"},{"title":"Type Annotations for Cross-Language‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/python/cross_language#type-annotations-for-cross-language","content":" Use pyfory type annotations for explicit cross-language type mapping:  from dataclasses import dataclass import pyfory @dataclass class TypedData: int_value: pyfory.int32 # 32-bit integer long_value: pyfory.int64 # 64-bit integer float_value: pyfory.float32 # 32-bit float double_value: pyfory.float64 # 64-bit float   ","version":"0.15","tagName":"h2"},{"title":"Type Mapping‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/python/cross_language#type-mapping","content":" Python\tJava\tRust\tGostr\tString\tString\tstring int\tlong\ti64\tint64 pyfory.int32\tint\ti32\tint32 pyfory.int64\tlong\ti64\tint64 float\tdouble\tf64\tfloat64 pyfory.float32\tfloat\tf32\tfloat32 list\tList\tVec\t[]T dict\tMap\tHashMap\tmap[K]V  ","version":"0.15","tagName":"h2"},{"title":"Differences from Python Native Mode‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/python/cross_language#differences-from-python-native-mode","content":" The binary protocol and API are similar to pyfory's python-native mode, but Python-native mode can serialize any Python object‚Äîincluding global functions, local functions, lambdas, local classes, and types with customized serialization using __getstate__/__reduce__/__reduce_ex__, which are not allowed in xlang mode.  ","version":"0.15","tagName":"h2"},{"title":"See Also‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/python/cross_language#see-also","content":" Cross-Language Serialization SpecificationType Mapping ReferenceJava Cross-Language GuideRust Cross-Language Guide  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/python/cross_language#related-topics","content":" Configuration - XLANG mode settingsSchema Evolution - Compatible modeType Registration - Registration patterns ","version":"0.15","tagName":"h2"},{"title":"Configuration","type":0,"sectionRef":"#","url":"/docs/guide/python/configuration","content":"","keywords":"","version":"0.15"},{"title":"Fory Class‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/python/configuration#fory-class","content":" The main serialization interface:  class Fory: def __init__( self, xlang: bool = False, ref: bool = False, strict: bool = True, compatible: bool = False, max_depth: int = 50, policy: DeserializationPolicy = None, field_nullable: bool = False, meta_compressor=None, )   ","version":"0.15","tagName":"h2"},{"title":"ThreadSafeFory Class‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/python/configuration#threadsafefory-class","content":" Thread-safe serialization interface using a pooled wrapper:  class ThreadSafeFory: def __init__( self, fory_factory=None, **kwargs )   ","version":"0.15","tagName":"h2"},{"title":"Parameters‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/python/configuration#parameters","content":" Parameter\tType\tDefault\tDescriptionxlang\tbool\tFalse\tEnable cross-language serialization. When False, enables Python-native mode supporting all Python objects. When True, enables cross-language mode compatible with Java, Go, Rust, etc. ref\tbool\tFalse\tEnable reference tracking for shared/circular references. Disable for better performance if your data has no shared references. strict\tbool\tTrue\tRequire type registration for security. Highly recommended for production. Only disable in trusted environments. compatible\tbool\tFalse\tEnable schema evolution in cross-language mode, allowing fields to be added/removed while maintaining compatibility. max_depth\tint\t50\tMaximum deserialization depth for security, preventing stack overflow attacks. policy\tDeserializationPolicy | None\tNone\tDeserialization policy used for security checks. Strongly recommended when strict=False. field_nullable\tbool\tFalse\tIn Python-native mode (xlang=False), treat dataclass fields as nullable by default. Ignored in xlang mode. meta_compressor\tAny\tNone\tOptional metadata compressor used for compatible-mode metadata encoding. fory_factory\tCallable | None\tNone\tThreadSafeFory factory hook. When set, ThreadSafeFory creates instances via this callback; otherwise it forwards **kwargs to Fory construction.  ","version":"0.15","tagName":"h2"},{"title":"Key Methods‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/python/configuration#key-methods","content":" # Serialization (serialize/deserialize are identical to dumps/loads) data: bytes = fory.serialize(obj) obj = fory.deserialize(data) # Alternative API (aliases) data: bytes = fory.dumps(obj) obj = fory.loads(data) # Type registration by id (for Python mode) fory.register(MyClass, type_id=123) fory.register(MyClass, type_id=123, serializer=custom_serializer) # Type registration by name (for cross-language mode) fory.register(MyClass, typename=&quot;my.package.MyClass&quot;) fory.register(MyClass, typename=&quot;my.package.MyClass&quot;, serializer=custom_serializer)   ","version":"0.15","tagName":"h2"},{"title":"Language Modes Comparison‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/python/configuration#language-modes-comparison","content":" Feature\tPython Mode (xlang=False)\tCross-Language Mode (xlang=True)Use Case\tPure Python applications\tMulti-language systems Compatibility\tPython only\tJava, Go, Rust, C++, JavaScript, etc. Supported Types\tAll Python types\tCross-language compatible types only Functions/Lambdas\t‚úì Supported\t‚úó Not allowed Local Classes\t‚úì Supported\t‚úó Not allowed Dynamic Classes\t‚úì Supported\t‚úó Not allowed Schema Evolution\t‚úì Supported (with compatible=True)\t‚úì Supported (with compatible=True) Performance\tExtremely fast\tVery fast Data Size\tCompact\tCompact with type metadata  ","version":"0.15","tagName":"h2"},{"title":"Python Mode (xlang=False)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/python/configuration#python-mode-xlangfalse","content":" Python mode supports all Python types including functions, classes, and closures:  import pyfory # Full Python compatibility mode fory = pyfory.Fory(xlang=False, ref=True, strict=False) # Supports ALL Python objects: data = fory.dumps({ 'function': lambda x: x * 2, # Functions and lambdas 'class': type('Dynamic', (), {}), # Dynamic classes 'method': str.upper, # Methods 'nested': {'circular_ref': None} # Circular references (when ref=True) }) # Drop-in replacement for pickle/cloudpickle import pickle obj = [1, 2, {&quot;nested&quot;: [3, 4]}] assert fory.loads(fory.dumps(obj)) == pickle.loads(pickle.dumps(obj))   ","version":"0.15","tagName":"h2"},{"title":"Cross-Language Mode (xlang=True)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/python/configuration#cross-language-mode-xlangtrue","content":" Cross-language mode restricts types to those compatible across all Fory implementations:  import pyfory # Cross-language compatibility mode f = pyfory.Fory(xlang=True, ref=True) # Only supports cross-language compatible types f.register(MyDataClass, typename=&quot;com.example.MyDataClass&quot;) # Data can be read by Java, Go, Rust, etc. data = f.serialize(MyDataClass(field1=&quot;value&quot;, field2=42))   ","version":"0.15","tagName":"h2"},{"title":"Example Configurations‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/python/configuration#example-configurations","content":" ","version":"0.15","tagName":"h2"},{"title":"Production Configuration‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/python/configuration#production-configuration","content":" import pyfory # Recommended settings for production fory = pyfory.Fory( xlang=False, # Use True if you need cross-language support ref=False, # Enable if you have shared/circular references strict=True, # CRITICAL: Always True in production compatible=False, # Enable only if you need schema evolution max_depth=20 # Adjust based on your data structure depth ) # Register all types upfront fory.register(UserModel, type_id=100) fory.register(OrderModel, type_id=101) fory.register(ProductModel, type_id=102)   ","version":"0.15","tagName":"h3"},{"title":"Development Configuration‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/python/configuration#development-configuration","content":" import pyfory # Development settings (more permissive) fory = pyfory.Fory( xlang=False, ref=True, strict=False, # Allow any type for development max_depth=1000 # Higher limit for development )   ","version":"0.15","tagName":"h3"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/python/configuration#related-topics","content":" Basic Serialization - Using configured ForyType Registration - Registration patternsSecurity - Security best practices ","version":"0.15","tagName":"h2"},{"title":"Migration Guide","type":0,"sectionRef":"#","url":"/docs/guide/python/migration","content":"","keywords":"","version":"0.15"},{"title":"From Pickle‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/guide/python/migration#from-pickle","content":" Replace pickle with Fory for better performance while keeping the same API:  # Before (pickle) import pickle data = pickle.dumps(obj) result = pickle.loads(data) # After (Fory - drop-in replacement with better performance) import pyfory f = pyfory.Fory(xlang=False, ref=True, strict=False) data = f.dumps(obj) # Faster and more compact result = f.loads(data) # Faster deserialization # Benefits: # - 2-10x faster serialization # - 2-5x faster deserialization # - Up to 3x smaller data size # - Same API, better performance   ","version":"0.15","tagName":"h2"},{"title":"From JSON‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/guide/python/migration#from-json","content":" Unlike JSON, Fory supports arbitrary Python types including functions:  # Before (JSON - limited types) import json data = json.dumps({&quot;name&quot;: &quot;Alice&quot;, &quot;age&quot;: 30}) result = json.loads(data) # After (Fory - all Python types) import pyfory f = pyfory.Fory() data = f.dumps({&quot;name&quot;: &quot;Alice&quot;, &quot;age&quot;: 30, &quot;func&quot;: lambda x: x}) result = f.loads(data)   ","version":"0.15","tagName":"h2"},{"title":"Key Differences‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/guide/python/migration#key-differences","content":" Feature\tpickle\tJSON\tpyforyPerformance\tModerate\tSlow\tFast Data Size\tLarge\tLarge\tCompact Type Support\tAll Python\tLimited\tAll Python Cross-Language\tNo\tYes\tYes (xlang mode) Security\tLow\tHigh\tConfigurable  ","version":"0.15","tagName":"h2"},{"title":"Migration Tips‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/guide/python/migration#migration-tips","content":" Start with strict=False to ensure compatibilityAdd type registration for performance and securityTest thoroughly before deployingMonitor performance improvements  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Migration Guide","url":"/docs/guide/python/migration#related-topics","content":" Configuration - Fory parametersPython Native Mode - Pickle replacement featuresSecurity - Security best practices ","version":"0.15","tagName":"h2"},{"title":"Custom Serializers","type":0,"sectionRef":"#","url":"/docs/guide/python/custom_serializers","content":"","keywords":"","version":"0.15"},{"title":"Implementing Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/python/custom_serializers#implementing-custom-serializers","content":" Override write/read for Python mode, xwrite/xread for cross-language:  import pyfory from pyfory.serializer import Serializer from dataclasses import dataclass @dataclass class Foo: f1: int f2: str class FooSerializer(Serializer): def __init__(self, fory, cls): super().__init__(fory, cls) def write(self, buffer, obj: Foo): # Custom serialization logic buffer.write_varint32(obj.f1) buffer.write_string(obj.f2) def read(self, buffer): # Custom deserialization logic f1 = buffer.read_varint32() f2 = buffer.read_string() return Foo(f1, f2) # For cross-language mode def xwrite(self, buffer, obj: Foo): buffer.write_int32(obj.f1) buffer.write_string(obj.f2) def xread(self, buffer): return Foo(buffer.read_int32(), buffer.read_string()) f = pyfory.Fory() f.register(Foo, type_id=100, serializer=FooSerializer(f, Foo)) # Now Foo uses your custom serializer data = f.dumps(Foo(42, &quot;hello&quot;)) result = f.loads(data) print(result) # Foo(f1=42, f2='hello')   ","version":"0.15","tagName":"h2"},{"title":"Buffer API‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/python/custom_serializers#buffer-api","content":" ","version":"0.15","tagName":"h2"},{"title":"Write Methods‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/python/custom_serializers#write-methods","content":" # Integers buffer.write_int8(value) buffer.write_int16(value) buffer.write_int32(value) buffer.write_int64(value) # Variable-length integers buffer.write_varint32(value) buffer.write_varint64(value) # Floating point buffer.write_float32(value) buffer.write_float64(value) # Strings and bytes buffer.write_string(value) buffer.write_bytes(value) # Boolean buffer.write_bool(value)   ","version":"0.15","tagName":"h3"},{"title":"Read Methods‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/python/custom_serializers#read-methods","content":" # Integers value = buffer.read_int8() value = buffer.read_int16() value = buffer.read_int32() value = buffer.read_int64() # Variable-length integers value = buffer.read_varint32() value = buffer.read_varint64() # Floating point value = buffer.read_float32() value = buffer.read_float64() # Strings and bytes value = buffer.read_string() value = buffer.read_bytes(length) # Boolean value = buffer.read_bool()   ","version":"0.15","tagName":"h3"},{"title":"When to Use Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/python/custom_serializers#when-to-use-custom-serializers","content":" External types from other packagesTypes with special serialization requirementsLegacy data format compatibilityPerformance-critical custom encodingTypes that don't work well with automatic serialization  ","version":"0.15","tagName":"h2"},{"title":"Registering Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/python/custom_serializers#registering-custom-serializers","content":" fory = pyfory.Fory() # Register with type_id fory.register(MyClass, type_id=100, serializer=MySerializer(fory, MyClass)) # Register with typename (for xlang) fory.register(MyClass, typename=&quot;com.example.MyClass&quot;, serializer=MySerializer(fory, MyClass))   ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/python/custom_serializers#related-topics","content":" Type Registration - Registration patternsConfiguration - Fory parametersCross-Language - xwrite/xread for xlang ","version":"0.15","tagName":"h2"},{"title":"NumPy & Pandas","type":0,"sectionRef":"#","url":"/docs/guide/python/numpy_integration","content":"","keywords":"","version":"0.15"},{"title":"NumPy Array Serialization‚Äã","type":1,"pageTitle":"NumPy & Pandas","url":"/docs/guide/python/numpy_integration#numpy-array-serialization","content":" Large arrays use zero-copy when possible:  import pyfory import numpy as np f = pyfory.Fory() # Numpy arrays are supported natively arrays = { 'matrix': np.random.rand(1000, 1000), 'vector': np.arange(10000), 'bool_mask': np.random.choice([True, False], size=5000) } data = f.serialize(arrays) result = f.deserialize(data) # Zero-copy for compatible array types assert np.array_equal(arrays['matrix'], result['matrix'])   ","version":"0.15","tagName":"h2"},{"title":"Pandas DataFrames‚Äã","type":1,"pageTitle":"NumPy & Pandas","url":"/docs/guide/python/numpy_integration#pandas-dataframes","content":" Fory can serialize Pandas DataFrames efficiently:  import pyfory import pandas as pd import numpy as np f = pyfory.Fory(xlang=False, ref=False, strict=False) df = pd.DataFrame({ 'a': np.arange(1000, dtype=np.float64), 'b': np.arange(1000, dtype=np.int64), 'c': ['text'] * 1000 }) data = f.serialize(df) result = f.deserialize(data) assert df.equals(result)   ","version":"0.15","tagName":"h2"},{"title":"Zero-Copy with Out-of-Band Buffers‚Äã","type":1,"pageTitle":"NumPy & Pandas","url":"/docs/guide/python/numpy_integration#zero-copy-with-out-of-band-buffers","content":" For maximum performance with large arrays, use out-of-band serialization:  import pyfory import numpy as np f = pyfory.Fory(xlang=False, ref=False, strict=False) # Large array array = np.random.rand(10000, 1000) # Out-of-band for zero-copy buffer_objects = [] data = f.serialize(array, buffer_callback=buffer_objects.append) buffers = [obj.getbuffer() for obj in buffer_objects] result = f.deserialize(data, buffers=buffers) assert np.array_equal(array, result)   ","version":"0.15","tagName":"h2"},{"title":"Supported Array Types‚Äã","type":1,"pageTitle":"NumPy & Pandas","url":"/docs/guide/python/numpy_integration#supported-array-types","content":" np.ndarray (all dtypes)np.matrixStructured arraysRecord arrays  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"NumPy & Pandas","url":"/docs/guide/python/numpy_integration#related-topics","content":" Out-of-Band Serialization - Zero-copy buffersBasic Serialization - Standard usage ","version":"0.15","tagName":"h2"},{"title":"Python Native Mode","type":0,"sectionRef":"#","url":"/docs/guide/python/native_mode","content":"","keywords":"","version":"0.15"},{"title":"Overview‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/guide/python/native_mode#overview","content":" The binary protocol and API are similar to Fory's xlang mode, but Python-native mode can serialize any Python object‚Äîincluding global functions, local functions, lambdas, local classes and types with customized serialization using __getstate__/__reduce__/__reduce_ex__, which are not allowed in xlang mode.  To use Python-native mode, create Fory with xlang=False:  import pyfory fory = pyfory.Fory(xlang=False, ref=False, strict=True)   ","version":"0.15","tagName":"h2"},{"title":"Drop-in Replacement for Pickle/Cloudpickle‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/guide/python/native_mode#drop-in-replacement-for-picklecloudpickle","content":" pyfory can serialize any Python object with the following configuration:  For circular references: Set ref=True to enable reference trackingFor functions/classes: Set strict=False to allow deserialization of dynamic types  ‚ö†Ô∏è Security Warning: When strict=False, Fory will deserialize arbitrary types, which can pose security risks if data comes from untrusted sources. Only use strict=False in controlled environments where you trust the data source completely.  ","version":"0.15","tagName":"h2"},{"title":"Common Usage‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/guide/python/native_mode#common-usage","content":" import pyfory # Create Fory instance fory = pyfory.Fory(xlang=False, ref=True, strict=False) # serialize common Python objects data = fory.dumps({&quot;name&quot;: &quot;Alice&quot;, &quot;age&quot;: 30, &quot;scores&quot;: [95, 87, 92]}) print(fory.loads(data)) # serialize custom objects from dataclasses import dataclass @dataclass class Person: name: str age: int person = Person(&quot;Bob&quot;, 25) data = fory.dumps(person) print(fory.loads(data)) # Person(name='Bob', age=25)   ","version":"0.15","tagName":"h3"},{"title":"Serialize Global Functions‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/guide/python/native_mode#serialize-global-functions","content":" Capture and serialize functions defined at module level. Fory deserialize and return same function object:  import pyfory fory = pyfory.Fory(xlang=False, ref=True, strict=False) def my_global_function(x): return 10 * x data = fory.dumps(my_global_function) print(fory.loads(data)(10)) # 100   ","version":"0.15","tagName":"h2"},{"title":"Serialize Local Functions/Lambdas‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/guide/python/native_mode#serialize-local-functionslambdas","content":" Serialize functions with closures and lambda expressions. Fory captures the closure variables automatically:  import pyfory fory = pyfory.Fory(xlang=False, ref=True, strict=False) # Local functions with closures def my_function(): local_var = 10 def local_func(x): return x * local_var return local_func data = fory.dumps(my_function()) print(fory.loads(data)(10)) # 100 # Lambdas data = fory.dumps(lambda x: 10 * x) print(fory.loads(data)(10)) # 100   ","version":"0.15","tagName":"h2"},{"title":"Serialize Global Classes/Methods‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/guide/python/native_mode#serialize-global-classesmethods","content":" Serialize class objects, instance methods, class methods, and static methods:  from dataclasses import dataclass import pyfory fory = pyfory.Fory(xlang=False, ref=True, strict=False) @dataclass class Person: name: str age: int def f(self, x): return self.age * x @classmethod def g(cls, x): return 10 * x @staticmethod def h(x): return 10 * x # Serialize global class print(fory.loads(fory.dumps(Person))(&quot;Bob&quot;, 25)) # Person(name='Bob', age=25) # Serialize instance method print(fory.loads(fory.dumps(Person(&quot;Bob&quot;, 20).f))(10)) # 200 # Serialize class method print(fory.loads(fory.dumps(Person.g))(10)) # 100 # Serialize static method print(fory.loads(fory.dumps(Person.h))(10)) # 100   ","version":"0.15","tagName":"h2"},{"title":"Serialize Local Classes/Methods‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/guide/python/native_mode#serialize-local-classesmethods","content":" Serialize classes defined inside functions along with their methods:  from dataclasses import dataclass import pyfory fory = pyfory.Fory(xlang=False, ref=True, strict=False) def create_local_class(): class LocalClass: def f(self, x): return 10 * x @classmethod def g(cls, x): return 10 * x @staticmethod def h(x): return 10 * x return LocalClass # Serialize local class data = fory.dumps(create_local_class()) print(fory.loads(data)().f(10)) # 100 # Serialize local class instance method data = fory.dumps(create_local_class()().f) print(fory.loads(data)(10)) # 100 # Serialize local class method data = fory.dumps(create_local_class().g) print(fory.loads(data)(10)) # 100 # Serialize local class static method data = fory.dumps(create_local_class().h) print(fory.loads(data)(10)) # 100   ","version":"0.15","tagName":"h2"},{"title":"Performance Comparison‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/guide/python/native_mode#performance-comparison","content":" import pyfory import pickle import timeit fory = pyfory.Fory(xlang=False, ref=True, strict=False) obj = {f&quot;key{i}&quot;: f&quot;value{i}&quot; for i in range(10000)} print(f&quot;Fory: {timeit.timeit(lambda: fory.dumps(obj), number=1000):.3f}s&quot;) print(f&quot;Pickle: {timeit.timeit(lambda: pickle.dumps(obj), number=1000):.3f}s&quot;)   ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Python Native Mode","url":"/docs/guide/python/native_mode#related-topics","content":" Configuration - Python mode configurationOut-of-Band Serialization - Zero-copy buffersSecurity - DeserializationPolicy ","version":"0.15","tagName":"h2"},{"title":"Out-of-Band Serialization","type":0,"sectionRef":"#","url":"/docs/guide/python/out_of_band","content":"","keywords":"","version":"0.15"},{"title":"Overview‚Äã","type":1,"pageTitle":"Out-of-Band Serialization","url":"/docs/guide/python/out_of_band#overview","content":" Out-of-band serialization separates metadata from the actual data buffers, allowing for:  Zero-copy transfers when sending data over networks or IPC using memoryviewImproved performance for large datasetsPickle5 compatibility using pickle.PickleBufferFlexible stream support - write to any writable object (files, BytesIO, sockets, etc.)  ","version":"0.15","tagName":"h2"},{"title":"Basic Out-of-Band Serialization‚Äã","type":1,"pageTitle":"Out-of-Band Serialization","url":"/docs/guide/python/out_of_band#basic-out-of-band-serialization","content":" import pyfory import numpy as np fory = pyfory.Fory(xlang=False, ref=False, strict=False) # Large numpy array array = np.arange(10000, dtype=np.float64) # Serialize with out-of-band buffers buffer_objects = [] serialized_data = fory.serialize(array, buffer_callback=buffer_objects.append) # Convert buffer objects to memoryview for zero-copy transmission # For contiguous buffers (bytes, numpy arrays), this is zero-copy # For non-contiguous data, a copy may be created to ensure contiguity buffers = [obj.getbuffer() for obj in buffer_objects] # Deserialize with out-of-band buffers (accepts memoryview, bytes, or Buffer) deserialized_array = fory.deserialize(serialized_data, buffers=buffers) assert np.array_equal(array, deserialized_array)   ","version":"0.15","tagName":"h2"},{"title":"Out-of-Band with Pandas DataFrames‚Äã","type":1,"pageTitle":"Out-of-Band Serialization","url":"/docs/guide/python/out_of_band#out-of-band-with-pandas-dataframes","content":" import pyfory import pandas as pd import numpy as np fory = pyfory.Fory(xlang=False, ref=False, strict=False) # Create a DataFrame with numeric columns df = pd.DataFrame({ 'a': np.arange(1000, dtype=np.float64), 'b': np.arange(1000, dtype=np.int64), 'c': ['text'] * 1000 }) # Serialize with out-of-band buffers buffer_objects = [] serialized_data = fory.serialize(df, buffer_callback=buffer_objects.append) buffers = [obj.getbuffer() for obj in buffer_objects] # Deserialize deserialized_df = fory.deserialize(serialized_data, buffers=buffers) assert df.equals(deserialized_df)   ","version":"0.15","tagName":"h2"},{"title":"Selective Out-of-Band Serialization‚Äã","type":1,"pageTitle":"Out-of-Band Serialization","url":"/docs/guide/python/out_of_band#selective-out-of-band-serialization","content":" Control which buffers go out-of-band by providing a callback that returns True to keep data in-band or False to send it out-of-band:  import pyfory import numpy as np fory = pyfory.Fory(xlang=False, ref=True, strict=False) arr1 = np.arange(1000, dtype=np.float64) arr2 = np.arange(2000, dtype=np.float64) data = [arr1, arr2] buffer_objects = [] counter = 0 def selective_callback(buffer_object): global counter counter += 1 # Only send even-numbered buffers out-of-band if counter % 2 == 0: buffer_objects.append(buffer_object) return False # Out-of-band return True # In-band serialized = fory.serialize(data, buffer_callback=selective_callback) buffers = [obj.getbuffer() for obj in buffer_objects] deserialized = fory.deserialize(serialized, buffers=buffers)   ","version":"0.15","tagName":"h2"},{"title":"Pickle5 Compatibility‚Äã","type":1,"pageTitle":"Out-of-Band Serialization","url":"/docs/guide/python/out_of_band#pickle5-compatibility","content":" Fory's out-of-band serialization is fully compatible with pickle protocol 5:  import pyfory import pickle fory = pyfory.Fory(xlang=False, ref=False, strict=False) # PickleBuffer objects are automatically supported data = b&quot;Large binary data&quot; pickle_buffer = pickle.PickleBuffer(data) # Serialize with buffer callback for out-of-band handling buffer_objects = [] serialized = fory.serialize(pickle_buffer, buffer_callback=buffer_objects.append) buffers = [obj.getbuffer() for obj in buffer_objects] # Deserialize with buffers deserialized = fory.deserialize(serialized, buffers=buffers) assert bytes(deserialized.raw()) == data   ","version":"0.15","tagName":"h2"},{"title":"Writing Buffers to Different Streams‚Äã","type":1,"pageTitle":"Out-of-Band Serialization","url":"/docs/guide/python/out_of_band#writing-buffers-to-different-streams","content":" The BufferObject.write_to() method accepts any writable stream object:  import pyfory import numpy as np import io fory = pyfory.Fory(xlang=False, ref=False, strict=False) array = np.arange(1000, dtype=np.float64) # Collect out-of-band buffers buffer_objects = [] serialized = fory.serialize(array, buffer_callback=buffer_objects.append) # Write to different stream types for buffer_obj in buffer_objects: # Write to BytesIO (in-memory stream) bytes_stream = io.BytesIO() buffer_obj.write_to(bytes_stream) # Write to file with open('/tmp/buffer_data.bin', 'wb') as f: buffer_obj.write_to(f) # Get zero-copy memoryview (for contiguous buffers) mv = buffer_obj.getbuffer() assert isinstance(mv, memoryview)   Note: For contiguous memory buffers (like bytes, numpy arrays), getbuffer() returns a zero-copy memoryview. For non-contiguous data, a copy may be created to ensure contiguity.  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Out-of-Band Serialization","url":"/docs/guide/python/out_of_band#related-topics","content":" NumPy Integration - NumPy array serializationBasic Serialization - Standard serializationConfiguration - Fory parameters ","version":"0.15","tagName":"h2"},{"title":"Schema Evolution","type":0,"sectionRef":"#","url":"/docs/guide/python/schema_evolution","content":"","keywords":"","version":"0.15"},{"title":"Enable Compatible Mode‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/python/schema_evolution#enable-compatible-mode","content":" import pyfory f = pyfory.Fory(xlang=True, compatible=True)   ","version":"0.15","tagName":"h2"},{"title":"Disable Evolution for Stable Classes‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/python/schema_evolution#disable-evolution-for-stable-classes","content":" If a dataclass schema is stable and will not change, you can disable evolution for that class to avoid compatible metadata overhead. Use pyfory.dataclass with evolving=False:  import pyfory @pyfory.dataclass(evolving=False) class StableMessage: id: int name: str   pyfory.dataclass also supports slots=True:  @pyfory.dataclass(slots=True) class SlotMessage: id: int   ","version":"0.15","tagName":"h2"},{"title":"Schema Evolution Example‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/python/schema_evolution#schema-evolution-example","content":" import pyfory from dataclasses import dataclass # Version 1: Original class @dataclass class User: name: str age: int f = pyfory.Fory(xlang=True, compatible=True) f.register(User, typename=&quot;User&quot;) data = f.dumps(User(&quot;Alice&quot;, 30)) # Version 2: Add new field (backward compatible) @dataclass class User: name: str age: int email: str = &quot;unknown@example.com&quot; # New field with default # Can still deserialize old data user = f.loads(data) print(user.email) # &quot;unknown@example.com&quot;   ","version":"0.15","tagName":"h2"},{"title":"Supported Changes‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/python/schema_evolution#supported-changes","content":" Add new fields: With default valuesRemove fields: Old data with extra fields will be skippedReorder fields: Fields are matched by name, not position  ","version":"0.15","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/python/schema_evolution#best-practices","content":" Always provide default values for new fieldsUse typename for cross-language compatibilityTest schema changes before deployingDocument schema versions for your team  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/python/schema_evolution#related-topics","content":" Configuration - Compatible mode settingsCross-Language - Schema evolution across languagesType Registration - Registration patterns ","version":"0.15","tagName":"h2"},{"title":"Field Configuration","type":0,"sectionRef":"#","url":"/docs/guide/python/field_configuration","content":"","keywords":"","version":"0.15"},{"title":"Overview‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/python/field_configuration#overview","content":" Apache Fory‚Ñ¢ provides field-level configuration through:  pyfory.field(): Configure field metadata (id, nullable, ref, ignore, dynamic)Type annotations: Control integer encoding (varint, fixed, tagged)Optional[T]: Mark fields as nullable  This enables:  Tag IDs: Assign compact numeric IDs to reduce struct field meta size overheadNullability: Control whether fields can be nullReference Tracking: Enable reference tracking for shared objectsField Skipping: Exclude fields from serializationEncoding Control: Specify how integers are encoded (varint, fixed, tagged)Polymorphism: Control whether type info is written for struct fields  ","version":"0.15","tagName":"h2"},{"title":"Basic Syntax‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/python/field_configuration#basic-syntax","content":" Use @dataclass decorator with type annotations and pyfory.field():  from dataclasses import dataclass from typing import Optional import pyfory @dataclass class Person: name: str = pyfory.field(id=0) age: pyfory.int32 = pyfory.field(id=1, default=0) nickname: Optional[str] = pyfory.field(id=2, nullable=True, default=None)   ","version":"0.15","tagName":"h2"},{"title":"The pyfory.field() Function‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/python/field_configuration#the-pyforyfield-function","content":" Use pyfory.field() to configure field-level metadata:  @dataclass class User: id: pyfory.int64 = pyfory.field(id=0, default=0) name: str = pyfory.field(id=1, default=&quot;&quot;) email: Optional[str] = pyfory.field(id=2, nullable=True, default=None) friends: List[&quot;User&quot;] = pyfory.field(id=3, ref=True, default_factory=list) _cache: dict = pyfory.field(ignore=True, default_factory=dict)   ","version":"0.15","tagName":"h2"},{"title":"Parameters‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/python/field_configuration#parameters","content":" Parameter\tType\tDefault\tDescriptionid\tint\t-1\tField tag ID (-1 = use field name) nullable\tbool\tFalse\tWhether the field can be null ref\tbool\tFalse\tEnable reference tracking ignore\tbool\tFalse\tExclude field from serialization dynamic\tbool\tNone\tControl whether type info is written default\tAny\tMISSING\tDefault value for the field default_factory\tCallable\tMISSING\tFactory function for default value  ","version":"0.15","tagName":"h3"},{"title":"Field ID (id)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/python/field_configuration#field-id-id","content":" Assigns a numeric ID to a field to minimize struct field meta size overhead:  @dataclass class User: id: pyfory.int64 = pyfory.field(id=0, default=0) name: str = pyfory.field(id=1, default=&quot;&quot;) age: pyfory.int32 = pyfory.field(id=2, default=0)   Benefits:  Smaller serialized size (numeric IDs vs field names in metadata)Reduced struct field meta overheadAllows renaming fields without breaking binary compatibility  Recommendation: It is recommended to configure field IDs for compatible mode since it reduces serialization cost.  Notes:  IDs must be unique within a classIDs must be &gt;= 0 (use -1 to use field name encoding, which is the default)If not specified, field name is used in metadata (larger overhead)  Without field IDs (field names used in metadata):  @dataclass class User: id: pyfory.int64 = 0 name: str = &quot;&quot;   ","version":"0.15","tagName":"h2"},{"title":"Nullable Fields (nullable)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/python/field_configuration#nullable-fields-nullable","content":" Use nullable=True for fields that can be None:  from typing import Optional @dataclass class Record: # Nullable string field optional_name: Optional[str] = pyfory.field(id=0, nullable=True, default=None) # Nullable integer field optional_count: Optional[pyfory.int32] = pyfory.field(id=1, nullable=True, default=None)   Notes:  Optional[T] fields must have nullable=TrueNon-optional fields default to nullable=False  ","version":"0.15","tagName":"h2"},{"title":"Reference Tracking (ref)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/python/field_configuration#reference-tracking-ref","content":" Enable reference tracking for fields that may be shared or circular:  @dataclass class RefOuter: # Both fields may point to the same inner object inner1: Optional[RefInner] = pyfory.field(id=0, ref=True, nullable=True, default=None) inner2: Optional[RefInner] = pyfory.field(id=1, ref=True, nullable=True, default=None) @dataclass class CircularRef: name: str = pyfory.field(id=0, default=&quot;&quot;) # Self-referencing field for circular references self_ref: Optional[&quot;CircularRef&quot;] = pyfory.field(id=1, ref=True, nullable=True, default=None)   Use Cases:  Enable for fields that may be circular or sharedWhen the same object is referenced from multiple fields  Notes:  Reference tracking only takes effect when Fory(ref=True) is set globallyField-level ref=True AND global ref=True must both be enabled  ","version":"0.15","tagName":"h2"},{"title":"Skipping Fields (ignore)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/python/field_configuration#skipping-fields-ignore","content":" Exclude fields from serialization:  @dataclass class User: id: pyfory.int64 = pyfory.field(id=0, default=0) name: str = pyfory.field(id=1, default=&quot;&quot;) # Not serialized _cache: dict = pyfory.field(ignore=True, default_factory=dict) _internal_state: str = pyfory.field(ignore=True, default=&quot;&quot;)   ","version":"0.15","tagName":"h2"},{"title":"Dynamic Fields (dynamic)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/python/field_configuration#dynamic-fields-dynamic","content":" Control whether type information is written for struct fields. This is essential for polymorphism support:  from abc import ABC, abstractmethod class Shape(ABC): @abstractmethod def area(self) -&gt; float: pass @dataclass class Circle(Shape): radius: float = 0.0 def area(self) -&gt; float: return 3.14159 * self.radius * self.radius @dataclass class Container: # Abstract class: dynamic is always True (type info written) shape: Shape = pyfory.field(id=0) # Force type info for concrete type (support runtime subtypes) circle: Circle = pyfory.field(id=1, dynamic=True) # Skip type info for concrete type (use declared type directly) fixed_circle: Circle = pyfory.field(id=2, dynamic=False)   Default Behavior:  Mode\tAbstract Class\tConcrete Object Types\tNumeric/str/time TypesNative mode\tTrue\tTrue\tFalse Xlang mode\tTrue\tFalse\tFalse  Notes:  Abstract classes: dynamic is always True (type info must be written)Native mode: dynamic defaults to True for object types, False for numeric/str/time typesXlang mode: dynamic defaults to False for concrete typesUse dynamic=True when a concrete field may hold subclass instancesUse dynamic=False for performance optimization when type is known  ","version":"0.15","tagName":"h2"},{"title":"Integer Type Annotations‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/python/field_configuration#integer-type-annotations","content":" Fory provides type annotations to control integer encoding:  ","version":"0.15","tagName":"h2"},{"title":"Signed Integers‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/python/field_configuration#signed-integers","content":" @dataclass class SignedIntegers: byte_val: pyfory.int8 = 0 # 8-bit signed short_val: pyfory.int16 = 0 # 16-bit signed int_val: pyfory.int32 = 0 # 32-bit signed (varint encoding) long_val: pyfory.int64 = 0 # 64-bit signed (varint encoding)   ","version":"0.15","tagName":"h3"},{"title":"Unsigned Integers‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/python/field_configuration#unsigned-integers","content":" @dataclass class UnsignedIntegers: # Fixed-size encoding u8_val: pyfory.uint8 = 0 # 8-bit unsigned (fixed) u16_val: pyfory.uint16 = 0 # 16-bit unsigned (fixed) # Variable-length encoding (default for u32/u64) u32_var: pyfory.uint32 = 0 # 32-bit unsigned (varint) u64_var: pyfory.uint64 = 0 # 64-bit unsigned (varint) # Explicit fixed-size encoding u32_fixed: pyfory.fixed_uint32 = 0 # 32-bit unsigned (fixed 4 bytes) u64_fixed: pyfory.fixed_uint64 = 0 # 64-bit unsigned (fixed 8 bytes) # Tagged encoding (includes type tag) u64_tagged: pyfory.tagged_uint64 = 0 # 64-bit unsigned (tagged)   ","version":"0.15","tagName":"h3"},{"title":"Floating Point‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/python/field_configuration#floating-point","content":" @dataclass class FloatingPoint: float_val: pyfory.float32 = 0.0 # 32-bit float double_val: pyfory.float64 = 0.0 # 64-bit double   ","version":"0.15","tagName":"h3"},{"title":"Encoding Summary‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/python/field_configuration#encoding-summary","content":" Type\tEncoding\tSizepyfory.int8\tfixed\t1 byte pyfory.int16\tfixed\t2 bytes pyfory.int32\tvarint\t1-5 bytes pyfory.int64\tvarint\t1-10 bytes pyfory.uint8\tfixed\t1 byte pyfory.uint16\tfixed\t2 bytes pyfory.uint32\tvarint\t1-5 bytes pyfory.uint64\tvarint\t1-10 bytes pyfory.fixed_uint32\tfixed\t4 bytes pyfory.fixed_uint64\tfixed\t8 bytes pyfory.tagged_uint64\ttagged\t1-9 bytes pyfory.float32\tfixed\t4 bytes pyfory.float64\tfixed\t8 bytes  When to Use:  varint: Best for values that are often small (default for int32/int64/uint32/uint64)fixed: Best for values that use full range (e.g., timestamps, hashes)tagged: When type information needs to be preserved (uint64 only)  ","version":"0.15","tagName":"h3"},{"title":"Complete Example‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/python/field_configuration#complete-example","content":" from dataclasses import dataclass from typing import Optional, List, Dict, Set import pyfory @dataclass class Document: # Fields with tag IDs (recommended for compatible mode) title: str = pyfory.field(id=0, default=&quot;&quot;) version: pyfory.int32 = pyfory.field(id=1, default=0) # Nullable field description: Optional[str] = pyfory.field(id=2, nullable=True, default=None) # Collection fields tags: List[str] = pyfory.field(id=3, default_factory=list) metadata: Dict[str, str] = pyfory.field(id=4, default_factory=dict) categories: Set[str] = pyfory.field(id=5, default_factory=set) # Unsigned integers with different encodings view_count: pyfory.uint64 = pyfory.field(id=6, default=0) # varint encoding file_size: pyfory.fixed_uint64 = pyfory.field(id=7, default=0) # fixed encoding checksum: pyfory.tagged_uint64 = pyfory.field(id=8, default=0) # tagged encoding # Reference-tracked field for shared/circular references parent: Optional[&quot;Document&quot;] = pyfory.field(id=9, ref=True, nullable=True, default=None) # Ignored field (not serialized) _cache: dict = pyfory.field(ignore=True, default_factory=dict) def main(): fory = pyfory.Fory(xlang=True, compatible=True, ref=True) fory.register_type(Document, type_id=100) doc = Document( title=&quot;My Document&quot;, version=1, description=&quot;A sample document&quot;, tags=[&quot;tag1&quot;, &quot;tag2&quot;], metadata={&quot;key&quot;: &quot;value&quot;}, categories={&quot;cat1&quot;}, view_count=42, file_size=1024, checksum=123456789, parent=None, ) # Serialize data = fory.serialize(doc) # Deserialize decoded = fory.deserialize(data) assert decoded.title == doc.title assert decoded.version == doc.version if __name__ == &quot;__main__&quot;: main()   ","version":"0.15","tagName":"h2"},{"title":"Cross-Language Compatibility‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/python/field_configuration#cross-language-compatibility","content":" When serializing data to be read by other languages (Java, Rust, C++, Go), use field IDs and matching type annotations:  @dataclass class CrossLangData: # Use field IDs for cross-language compatibility int_var: pyfory.int32 = pyfory.field(id=0, default=0) long_fixed: pyfory.fixed_uint64 = pyfory.field(id=1, default=0) long_tagged: pyfory.tagged_uint64 = pyfory.field(id=2, default=0) optional_value: Optional[str] = pyfory.field(id=3, nullable=True, default=None)   ","version":"0.15","tagName":"h2"},{"title":"Schema Evolution‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/python/field_configuration#schema-evolution","content":" Compatible mode supports schema evolution. It is recommended to configure field IDs to reduce serialization cost:  # Version 1 @dataclass class DataV1: id: pyfory.int64 = pyfory.field(id=0, default=0) name: str = pyfory.field(id=1, default=&quot;&quot;) # Version 2: Added new field @dataclass class DataV2: id: pyfory.int64 = pyfory.field(id=0, default=0) name: str = pyfory.field(id=1, default=&quot;&quot;) email: Optional[str] = pyfory.field(id=2, nullable=True, default=None) # New field   Data serialized with V1 can be deserialized with V2 (new field will be None).  Alternatively, field IDs can be omitted (field names will be used in metadata with larger overhead):  @dataclass class Data: id: pyfory.int64 = 0 name: str = &quot;&quot;   ","version":"0.15","tagName":"h2"},{"title":"Native Mode vs Xlang Mode‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/python/field_configuration#native-mode-vs-xlang-mode","content":" Field configuration behaves differently depending on the serialization mode:  ","version":"0.15","tagName":"h2"},{"title":"Native Mode (Python-only)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/python/field_configuration#native-mode-python-only","content":" Native mode has relaxed default values for maximum compatibility:  Nullable: str and numeric types are non-nullable by default unless Optional is usedRef tracking: Enabled by default for object references (except str and numeric types)  In native mode, you typically don't need to configure field annotations unless you want to:  Reduce serialized size by using field IDsOptimize performance by disabling unnecessary ref tracking  # Native mode: works without field configuration @dataclass class User: id: int = 0 name: str = &quot;&quot; tags: List[str] = None   ","version":"0.15","tagName":"h3"},{"title":"Xlang Mode (Cross-language)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/python/field_configuration#xlang-mode-cross-language","content":" Xlang mode has stricter default values due to type system differences between languages:  Nullable: Fields are non-nullable by default (nullable=False)Ref tracking: Disabled by default (ref=False)  In xlang mode, you need to configure fields when:  A field can be None (use Optional[T] with nullable=True)A field needs reference tracking for shared/circular objects (use ref=True)Integer types need specific encoding for cross-language compatibilityYou want to reduce metadata size (use field IDs)  # Xlang mode: explicit configuration required for nullable/ref fields @dataclass class User: id: pyfory.int64 = pyfory.field(id=0, default=0) name: str = pyfory.field(id=1, default=&quot;&quot;) email: Optional[str] = pyfory.field(id=2, nullable=True, default=None) # Must declare nullable friend: Optional[&quot;User&quot;] = pyfory.field(id=3, ref=True, nullable=True, default=None) # Must declare ref   ","version":"0.15","tagName":"h3"},{"title":"Default Values Summary‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/python/field_configuration#default-values-summary","content":" Option\tNative Mode Default\tXlang Mode Defaultnullable\tFalse for str/numeric; others nullable by default\tFalse ref\tTrue (except str and numeric types)\tFalse dynamic\tTrue (except numeric/str/time types)\tFalse (concrete)  ","version":"0.15","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/python/field_configuration#best-practices","content":" Configure field IDs: Recommended for compatible mode to reduce serialization costUse Optional[T] with nullable=True: Required for nullable fields in xlang modeEnable ref tracking for shared objects: Use ref=True when objects are shared or circularUse ignore=True for sensitive data: Passwords, tokens, internal stateChoose appropriate encoding: varint for small values, fixed for full-range valuesKeep IDs stable: Once assigned, don't change field IDs  ","version":"0.15","tagName":"h2"},{"title":"Options Reference‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/python/field_configuration#options-reference","content":" Configuration\tDescriptionpyfory.field(id=N)\tField tag ID to reduce metadata size pyfory.field(nullable=True)\tMark field as nullable pyfory.field(ref=True)\tEnable reference tracking pyfory.field(ignore=True)\tExclude field from serialization pyfory.field(dynamic=True)\tForce type info to be written pyfory.field(dynamic=False)\tSkip type info (use declared type) Optional[T]\tType hint for nullable fields pyfory.int32, pyfory.int64\tSigned integers (varint encoding) pyfory.uint32, pyfory.uint64\tUnsigned integers (varint encoding) pyfory.fixed_uint32, pyfory.fixed_uint64\tFixed-size unsigned pyfory.tagged_uint64\tTagged encoding for uint64  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/python/field_configuration#related-topics","content":" Basic Serialization - Getting started with Fory serializationSchema Evolution - Compatible mode and schema evolutionCross-Language - Interoperability with Java, Rust, C++, Go ","version":"0.15","tagName":"h2"},{"title":"Row Format","type":0,"sectionRef":"#","url":"/docs/guide/python/row_format","content":"","keywords":"","version":"0.15"},{"title":"Overview‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/python/row_format#overview","content":" Row format drastically reduces overhead when working with large objects where only partial data access is needed. It also supports memory-mapped files for ultra-low memory footprint.  Key Benefits:  Feature\tDescriptionZero-Copy Access\tRead nested fields without deserializing entire object Memory Efficiency\tMemory-map large datasets directly from disk Cross-Language\tBinary format compatible between Python, Java, C++ Partial Deserialization\tDeserialize only specific elements you need High Performance\tSkip unnecessary data parsing for analytics workloads  ","version":"0.15","tagName":"h2"},{"title":"Basic Usage‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/python/row_format#basic-usage","content":" import pyfory import pyarrow as pa from dataclasses import dataclass from typing import List, Dict @dataclass class Bar: f1: str f2: List[pa.int64] @dataclass class Foo: f1: pa.int32 f2: List[pa.int32] f3: Dict[str, pa.int32] f4: List[Bar] # Create encoder for row format encoder = pyfory.encoder(Foo) # Create large dataset foo = Foo( f1=10, f2=list(range(1_000_000)), f3={f&quot;k{i}&quot;: i for i in range(1_000_000)}, f4=[Bar(f1=f&quot;s{i}&quot;, f2=list(range(10))) for i in range(1_000_000)] ) # Encode to row format binary: bytes = encoder.to_row(foo).to_bytes() # Zero-copy access - no full deserialization needed! foo_row = pyfory.RowData(encoder.schema, binary) print(foo_row.f2[100000]) # Access 100,000th element directly print(foo_row.f4[100000].f1) # Access nested field directly print(foo_row.f4[200000].f2[5]) # Access deeply nested field directly   ","version":"0.15","tagName":"h2"},{"title":"Cross-Language Compatibility‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/python/row_format#cross-language-compatibility","content":" Row format works seamlessly across languages. The same binary data can be accessed from Java and C++.  ","version":"0.15","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/python/row_format#java","content":" public class Bar { String f1; List&lt;Long&gt; f2; } public class Foo { int f1; List&lt;Integer&gt; f2; Map&lt;String, Integer&gt; f3; List&lt;Bar&gt; f4; } RowEncoder&lt;Foo&gt; encoder = Encoders.bean(Foo.class); // Encode to row format (cross-language compatible with Python) BinaryRow binaryRow = encoder.toRow(foo); // Zero-copy random access without full deserialization BinaryArray f2Array = binaryRow.getArray(1); // Access f2 list BinaryArray f4Array = binaryRow.getArray(3); // Access f4 list BinaryRow bar10 = f4Array.getStruct(10); // Access 11th Bar long value = bar10.getArray(1).getInt64(5); // Access 6th element of bar.f2 // Partial deserialization - only deserialize what you need RowEncoder&lt;Bar&gt; barEncoder = Encoders.bean(Bar.class); Bar bar1 = barEncoder.fromRow(f4Array.getStruct(10)); // Deserialize 11th Bar only Bar bar2 = barEncoder.fromRow(f4Array.getStruct(20)); // Deserialize 21st Bar only   ","version":"0.15","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/python/row_format#c","content":" #include &quot;fory/encoder/row_encoder.h&quot; #include &quot;fory/row/writer.h&quot; struct Bar { std::string f1; std::vector&lt;int64_t&gt; f2; FORY_STRUCT(Bar, f1, f2); }; struct Foo { int32_t f1; std::vector&lt;int32_t&gt; f2; std::map&lt;std::string, int32_t&gt; f3; std::vector&lt;Bar&gt; f4; FORY_STRUCT(Foo, f1, f2, f3, f4); }; fory::encoder::RowEncoder&lt;Foo&gt; encoder; encoder.Encode(foo); auto row = encoder.GetWriter().ToRow(); // Zero-copy random access without full deserialization auto f2_array = row-&gt;GetArray(1); // Access f2 list auto f4_array = row-&gt;GetArray(3); // Access f4 list auto bar10 = f4_array-&gt;GetStruct(10); // Access 11th Bar int64_t value = bar10-&gt;GetArray(1)-&gt;GetInt64(5); // Access 6th element of bar.f2 std::string str = bar10-&gt;GetString(0); // Access bar.f1   ","version":"0.15","tagName":"h3"},{"title":"Installation‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/python/row_format#installation","content":" Row format requires Apache Arrow:  pip install pyfory[format]   ","version":"0.15","tagName":"h2"},{"title":"When to Use Row Format‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/python/row_format#when-to-use-row-format","content":" Analytics workloads: When you only need to access specific fieldsLarge datasets: When full deserialization is too expensiveMemory-mapped files: Working with data larger than RAMData pipelines: Processing data without full object reconstructionCross-language data sharing: When data needs to be accessed from multiple languages  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/python/row_format#related-topics","content":" Cross-Language Serialization - XLANG modeBasic Serialization - Object serializationRow Format Specification - Protocol details ","version":"0.15","tagName":"h2"},{"title":"Security Best Practices","type":0,"sectionRef":"#","url":"/docs/guide/python/security","content":"","keywords":"","version":"0.15"},{"title":"Production Configuration‚Äã","type":1,"pageTitle":"Security Best Practices","url":"/docs/guide/python/security#production-configuration","content":" Never disable strict=True in production unless your environment is completely trusted:  import pyfory # Recommended production settings f = pyfory.Fory( xlang=False, # or True for cross-language ref=True, # Handle circular references strict=True, # IMPORTANT: Prevent malicious data max_depth=100 # Prevent deep recursion attacks ) # Explicitly register allowed types f.register(UserModel, type_id=100) f.register(OrderModel, type_id=101) # Never set strict=False in production with untrusted data!   ","version":"0.15","tagName":"h2"},{"title":"Development vs Production‚Äã","type":1,"pageTitle":"Security Best Practices","url":"/docs/guide/python/security#development-vs-production","content":" Use environment variables to switch between configurations:  import pyfory import os # Development configuration if os.getenv('ENV') == 'development': fory = pyfory.Fory( xlang=False, ref=True, strict=False, # Allow any type for development max_depth=1000 # Higher limit for development ) else: # Production configuration (security hardened) fory = pyfory.Fory( xlang=False, ref=True, strict=True, # CRITICAL: Require registration max_depth=100 # Reasonable limit ) # Register only known safe types for idx, model_class in enumerate([UserModel, ProductModel, OrderModel]): fory.register(model_class, type_id=100 + idx)   ","version":"0.15","tagName":"h2"},{"title":"DeserializationPolicy‚Äã","type":1,"pageTitle":"Security Best Practices","url":"/docs/guide/python/security#deserializationpolicy","content":" When strict=False is necessary (e.g., deserializing functions/lambdas), use DeserializationPolicy to implement fine-grained security controls during deserialization.  Why use DeserializationPolicy?  Block dangerous classes/modules (e.g., subprocess.Popen)Intercept and validate __reduce__ callables before invocationSanitize sensitive data during __setstate__Replace or reject deserialized objects based on custom rules  ","version":"0.15","tagName":"h2"},{"title":"Blocking Dangerous Classes‚Äã","type":1,"pageTitle":"Security Best Practices","url":"/docs/guide/python/security#blocking-dangerous-classes","content":" import pyfory from pyfory import DeserializationPolicy dangerous_modules = {'subprocess', 'os', '__builtin__'} class SafeDeserializationPolicy(DeserializationPolicy): &quot;&quot;&quot;Block potentially dangerous classes during deserialization.&quot;&quot;&quot; def validate_class(self, cls, is_local, **kwargs): # Block dangerous modules if cls.__module__ in dangerous_modules: raise ValueError(f&quot;Blocked dangerous class: {cls.__module__}.{cls.__name__}&quot;) return None def intercept_reduce_call(self, callable_obj, args, **kwargs): # Block specific callable invocations during __reduce__ if getattr(callable_obj, '__name__', &quot;&quot;) == 'Popen': raise ValueError(&quot;Blocked attempt to invoke subprocess.Popen&quot;) return None def intercept_setstate(self, obj, state, **kwargs): # Sanitize sensitive data if isinstance(state, dict) and 'password' in state: state['password'] = '***REDACTED***' return None # Create Fory with custom security policy policy = SafeDeserializationPolicy() fory = pyfory.Fory(xlang=False, ref=True, strict=False, policy=policy) # Now deserialization is protected by your custom policy data = fory.serialize(my_object) result = fory.deserialize(data) # Policy hooks will be invoked   ","version":"0.15","tagName":"h3"},{"title":"Available Policy Hooks‚Äã","type":1,"pageTitle":"Security Best Practices","url":"/docs/guide/python/security#available-policy-hooks","content":" Hook\tDescriptionvalidate_class(cls, is_local)\tValidate/block class types during deserialization validate_module(module, is_local)\tValidate/block module imports validate_function(func, is_local)\tValidate/block function references intercept_reduce_call(callable_obj, args)\tIntercept __reduce__ invocations inspect_reduced_object(obj)\tInspect/replace objects created via __reduce__ intercept_setstate(obj, state)\tSanitize state before __setstate__ authorize_instantiation(cls, args, kwargs)\tControl class instantiation  See also: pyfory/policy.py contains detailed documentation and examples for each hook.  ","version":"0.15","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Security Best Practices","url":"/docs/guide/python/security#best-practices","content":" Always use strict=True in productionUse DeserializationPolicy when strict=False is necessaryBlock dangerous modules (subprocess, os, etc.)Set appropriate max_depth to prevent stack overflowValidate data sources before deserializationLog security events for auditing  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Security Best Practices","url":"/docs/guide/python/security#related-topics","content":" Type Registration - Registration and strict modeConfiguration - Fory parametersPython Native Mode - Functions and lambdas ","version":"0.15","tagName":"h2"},{"title":"Troubleshooting","type":0,"sectionRef":"#","url":"/docs/guide/python/troubleshooting","content":"","keywords":"","version":"0.15"},{"title":"Common Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/python/troubleshooting#common-issues","content":" ","version":"0.15","tagName":"h2"},{"title":"ImportError with Format Features‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/python/troubleshooting#importerror-with-format-features","content":" # Solution: Install Row format support pip install pyfory[format] # Or install from source with format support pip install -e &quot;.[format]&quot;   ","version":"0.15","tagName":"h3"},{"title":"Slow Serialization Performance‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/python/troubleshooting#slow-serialization-performance","content":" # Check if Cython acceleration is enabled import pyfory print(pyfory.ENABLE_FORY_CYTHON_SERIALIZATION) # Should be True # If False, Cython extension may not be compiled correctly # Reinstall with: pip install --force-reinstall --no-cache-dir pyfory   ","version":"0.15","tagName":"h3"},{"title":"Cross-Language Compatibility Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/python/troubleshooting#cross-language-compatibility-issues","content":" # Use explicit type registration with consistent naming f = pyfory.Fory(xlang=True) f.register(MyClass, typename=&quot;com.package.MyClass&quot;) # Use same name in all languages   ","version":"0.15","tagName":"h3"},{"title":"Circular Reference Errors or Duplicate Data‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/python/troubleshooting#circular-reference-errors-or-duplicate-data","content":" # Enable reference tracking f = pyfory.Fory(ref=True) # Required for circular references # Example with circular reference class Node: def __init__(self, value): self.value = value self.next = None node1 = Node(1) node2 = Node(2) node1.next = node2 node2.next = node1 # Circular reference data = f.dumps(node1) result = f.loads(data) assert result.next.next is result # Circular reference preserved   ","version":"0.15","tagName":"h3"},{"title":"Schema Evolution Not Working‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/python/troubleshooting#schema-evolution-not-working","content":" # Enable compatible mode for schema evolution f = pyfory.Fory(xlang=True, compatible=True) # Version 1: Original class @dataclass class User: name: str age: int f.register(User, typename=&quot;User&quot;) data = f.dumps(User(&quot;Alice&quot;, 30)) # Version 2: Add new field (backward compatible) @dataclass class User: name: str age: int email: str = &quot;unknown@example.com&quot; # New field with default # Can still deserialize old data user = f.loads(data) print(user.email) # &quot;unknown@example.com&quot;   ","version":"0.15","tagName":"h3"},{"title":"Type Registration Errors in Strict Mode‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/python/troubleshooting#type-registration-errors-in-strict-mode","content":" # Register all custom types before serialization f = pyfory.Fory(strict=True) # Must register before use f.register(MyClass, type_id=100) f.register(AnotherClass, type_id=101) # Or disable strict mode (NOT recommended for production) f = pyfory.Fory(strict=False) # Use only in trusted environments   ","version":"0.15","tagName":"h3"},{"title":"Debug Mode‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/python/troubleshooting#debug-mode","content":" Set environment variable BEFORE importing pyfory to disable Cython for debugging:  import os os.environ['ENABLE_FORY_CYTHON_SERIALIZATION'] = '0' import pyfory # Now uses pure Python implementation # This is useful for: # 1. Debugging protocol issues # 2. Understanding serialization behavior # 3. Development without recompiling Cython   ","version":"0.15","tagName":"h2"},{"title":"Error Handling‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/python/troubleshooting#error-handling","content":" Handle common serialization errors gracefully:  import pyfory from pyfory.error import TypeUnregisteredError, TypeNotCompatibleError fory = pyfory.Fory(strict=True) try: data = fory.dumps(my_object) except TypeUnregisteredError as e: print(f&quot;Type not registered: {e}&quot;) # Register the type and retry fory.register(type(my_object), type_id=100) data = fory.dumps(my_object) except Exception as e: print(f&quot;Serialization failed: {e}&quot;) try: obj = fory.loads(data) except TypeNotCompatibleError as e: print(f&quot;Schema mismatch: {e}&quot;) # Handle version mismatch except Exception as e: print(f&quot;Deserialization failed: {e}&quot;)   ","version":"0.15","tagName":"h2"},{"title":"Development Setup‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/python/troubleshooting#development-setup","content":" git clone https://github.com/apache/fory.git cd fory/python # Install dependencies pip install -e &quot;.[dev,format]&quot; # Run tests pytest -v -s . # Run specific test pytest -v -s pyfory/tests/test_serializer.py # Format code ruff format . ruff check --fix .   ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/python/troubleshooting#related-topics","content":" Configuration - Fory parametersType Registration - Registration best practicesSecurity - Security configuration ","version":"0.15","tagName":"h2"},{"title":"Type Registration & Security","type":0,"sectionRef":"#","url":"/docs/guide/python/type_registration","content":"","keywords":"","version":"0.15"},{"title":"Type Registration‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/guide/python/type_registration#type-registration","content":" In strict mode, only registered types can be deserialized. This prevents arbitrary code execution:  import pyfory # Strict mode (recommended for production) f = pyfory.Fory(strict=True) class SafeClass: def __init__(self, data): self.data = data # Must register types in strict mode f.register(SafeClass, typename=&quot;com.example.SafeClass&quot;) # Now serialization works obj = SafeClass(&quot;safe data&quot;) data = f.serialize(obj) result = f.deserialize(data) # Unregistered types will raise an exception class UnsafeClass: pass # This will fail in strict mode try: f.serialize(UnsafeClass()) except Exception as e: print(&quot;Security protection activated!&quot;)   ","version":"0.15","tagName":"h2"},{"title":"Registration Patterns‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/guide/python/type_registration#registration-patterns","content":" ","version":"0.15","tagName":"h2"},{"title":"Pattern 1: Simple Registration‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/guide/python/type_registration#pattern-1-simple-registration","content":" fory.register(MyClass, type_id=100)   ","version":"0.15","tagName":"h3"},{"title":"Pattern 2: Cross-Language with Typename‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/guide/python/type_registration#pattern-2-cross-language-with-typename","content":" fory.register(MyClass, typename=&quot;com.example.MyClass&quot;)   ","version":"0.15","tagName":"h3"},{"title":"Pattern 3: With Custom Serializer‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/guide/python/type_registration#pattern-3-with-custom-serializer","content":" fory.register(MyClass, type_id=100, serializer=MySerializer(fory, MyClass))   ","version":"0.15","tagName":"h3"},{"title":"Pattern 4: Batch Registration‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/guide/python/type_registration#pattern-4-batch-registration","content":" type_id = 100 for model_class in [User, Order, Product, Invoice]: fory.register(model_class, type_id=type_id) type_id += 1   ","version":"0.15","tagName":"h3"},{"title":"Security Modes‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/guide/python/type_registration#security-modes","content":" ","version":"0.15","tagName":"h2"},{"title":"Strict Mode (Recommended)‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/guide/python/type_registration#strict-mode-recommended","content":" # Always use strict=True in production fory = pyfory.Fory(strict=True) # Explicitly register allowed types fory.register(UserModel, type_id=100) fory.register(OrderModel, type_id=101)   ","version":"0.15","tagName":"h3"},{"title":"Non-Strict Mode‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/guide/python/type_registration#non-strict-mode","content":" ‚ö†Ô∏è Security Warning: When strict=False, Fory will deserialize arbitrary types, which can pose security risks if data comes from untrusted sources. Only use strict=False in controlled environments where you trust the data source completely.  # Only in trusted environments fory = pyfory.Fory(xlang=False, ref=True, strict=False)   If you do need to use strict=False, configure a DeserializationPolicy:  from pyfory import DeserializationPolicy class SafePolicy(DeserializationPolicy): def validate_class(self, cls, is_local, **kwargs): # Block dangerous modules if cls.__module__ in {'subprocess', 'os', '__builtin__'}: raise ValueError(f&quot;Blocked: {cls}&quot;) return None fory = pyfory.Fory(xlang=False, strict=False, policy=SafePolicy())   ","version":"0.15","tagName":"h3"},{"title":"Max Depth Protection‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/guide/python/type_registration#max-depth-protection","content":" Limit deserialization depth to prevent stack overflow attacks:  fory = pyfory.Fory( strict=True, max_depth=100 # Adjust based on your data structure depth )   ","version":"0.15","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/guide/python/type_registration#best-practices","content":" Always use strict=True in productionUse type_id for performance, typename for flexibilityRegister all types upfront before any serializationSet appropriate max_depth based on your data structuresUse DeserializationPolicy when strict=False is necessary  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Type Registration & Security","url":"/docs/guide/python/type_registration#related-topics","content":" Configuration - Fory parametersSecurity - DeserializationPolicy detailsCustom Serializers - Custom serialization ","version":"0.15","tagName":"h2"},{"title":"Rust Serialization Guide","type":0,"sectionRef":"#","url":"/docs/guide/rust/","content":"","keywords":"","version":"0.15"},{"title":"Why Apache Fory‚Ñ¢ Rust?‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/guide/rust/#why-apache-fory-rust","content":" üî• Blazingly Fast: Zero-copy deserialization and optimized binary protocolsüåç Cross-Language: Seamlessly serialize/deserialize data across Java, Python, C++, Go, JavaScript, and RustüéØ Type-Safe: Compile-time type checking with derive macrosüîÑ Circular References: Automatic tracking of shared and circular references with Rc/Arc and weak pointersüß¨ Polymorphic: Serialize trait objects with Box&lt;dyn Trait&gt;, Rc&lt;dyn Trait&gt;, and Arc&lt;dyn Trait&gt;üì¶ Schema Evolution: Compatible mode for independent schema changes‚ö° Two Formats: Object graph serialization and zero-copy row-based format  ","version":"0.15","tagName":"h2"},{"title":"Crates‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/guide/rust/#crates","content":" Crate\tDescription\tVersionfory\tHigh-level API with derive macros fory-core\tCore serialization engine fory-derive\tProcedural macros\t  ","version":"0.15","tagName":"h2"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/guide/rust/#quick-start","content":" Add Apache Fory‚Ñ¢ to your Cargo.toml:  [dependencies] fory = &quot;0.13&quot;   ","version":"0.15","tagName":"h2"},{"title":"Basic Example‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/guide/rust/#basic-example","content":" use fory::{Fory, Error, Reader}; use fory::ForyObject; #[derive(ForyObject, Debug, PartialEq)] struct User { name: String, age: i32, email: String, } fn main() -&gt; Result&lt;(), Error&gt; { let mut fory = Fory::default(); fory.register::&lt;User&gt;(1)?; let user = User { name: &quot;Alice&quot;.to_string(), age: 30, email: &quot;alice@example.com&quot;.to_string(), }; // Serialize let bytes = fory.serialize(&amp;user)?; // Deserialize let decoded: User = fory.deserialize(&amp;bytes)?; assert_eq!(user, decoded); // Serialize to specified buffer let mut buf: Vec&lt;u8&gt; = vec![]; fory.serialize_to(&amp;mut buf, &amp;user)?; // Deserialize from specified buffer let mut reader = Reader::new(&amp;buf); let decoded: User = fory.deserialize_from(&amp;mut reader)?; assert_eq!(user, decoded); Ok(()) }   ","version":"0.15","tagName":"h3"},{"title":"Thread Safety‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/guide/rust/#thread-safety","content":" Apache Fory‚Ñ¢ Rust is fully thread-safe: Fory implements both Send and Sync, so one configured instance can be shared across threads for concurrent work. The internal read/write context pools are lazily initialized with thread-safe primitives, letting worker threads reuse buffers without coordination.  use fory::{Fory, Error}; use fory::ForyObject; use std::sync::Arc; use std::thread; #[derive(ForyObject, Clone, Copy, Debug, PartialEq)] struct Item { value: i32, } fn main() -&gt; Result&lt;(), Error&gt; { let mut fory = Fory::default(); fory.register::&lt;Item&gt;(1000)?; let fory = Arc::new(fory); let handles: Vec&lt;_&gt; = (0..8) .map(|i| { let shared = Arc::clone(&amp;fory); thread::spawn(move || { let item = Item { value: i }; shared.serialize(&amp;item) }) }) .collect(); for handle in handles { let bytes = handle.join().unwrap()?; let item: Item = fory.deserialize(&amp;bytes)?; assert!(item.value &gt;= 0); } Ok(()) }   Tip: Perform registrations (such as fory.register::&lt;T&gt;(id)) before spawning threads so every worker sees the same metadata. Once configured, wrapping the instance in Arc is enough to fan out serialization and deserialization tasks safely.  ","version":"0.15","tagName":"h2"},{"title":"Architecture‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/guide/rust/#architecture","content":" The Rust implementation consists of three main crates:  fory/ # High-level API ‚îú‚îÄ‚îÄ src/lib.rs # Public API exports fory-core/ # Core serialization engine ‚îú‚îÄ‚îÄ src/ ‚îÇ ‚îú‚îÄ‚îÄ fory.rs # Main serialization entry point ‚îÇ ‚îú‚îÄ‚îÄ buffer.rs # Binary buffer management ‚îÇ ‚îú‚îÄ‚îÄ serializer/ # Type-specific serializers ‚îÇ ‚îú‚îÄ‚îÄ resolver/ # Type resolution and metadata ‚îÇ ‚îú‚îÄ‚îÄ meta/ # Meta string compression ‚îÇ ‚îú‚îÄ‚îÄ row/ # Row format implementation ‚îÇ ‚îî‚îÄ‚îÄ types.rs # Type definitions fory-derive/ # Procedural macros ‚îú‚îÄ‚îÄ src/ ‚îÇ ‚îú‚îÄ‚îÄ object/ # ForyObject macro ‚îÇ ‚îî‚îÄ‚îÄ fory_row.rs # ForyRow macro   ","version":"0.15","tagName":"h2"},{"title":"Use Cases‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/guide/rust/#use-cases","content":" ","version":"0.15","tagName":"h2"},{"title":"Object Serialization‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/guide/rust/#object-serialization","content":" Complex data structures with nested objects and referencesCross-language communication in microservicesGeneral-purpose serialization with full type safetySchema evolution with compatible modeGraph-like data structures with circular references  ","version":"0.15","tagName":"h3"},{"title":"Row-Based Serialization‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/guide/rust/#row-based-serialization","content":" High-throughput data processingAnalytics workloads requiring fast field accessMemory-constrained environmentsReal-time data streaming applicationsZero-copy scenarios  ","version":"0.15","tagName":"h3"},{"title":"Next Steps‚Äã","type":1,"pageTitle":"Rust Serialization Guide","url":"/docs/guide/rust/#next-steps","content":" Configuration - Fory builder options and modesBasic Serialization - Object graph serializationReferences - Shared and circular referencesPolymorphism - Trait object serializationCross-Language - XLANG modeRow Format - Zero-copy row-based format ","version":"0.15","tagName":"h2"},{"title":"Configuration","type":0,"sectionRef":"#","url":"/docs/guide/rust/configuration","content":"","keywords":"","version":"0.15"},{"title":"Serialization Modes‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/rust/configuration#serialization-modes","content":" Apache Fory‚Ñ¢ supports two serialization modes:  ","version":"0.15","tagName":"h2"},{"title":"SchemaConsistent Mode (Default)‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/rust/configuration#schemaconsistent-mode-default","content":" Type declarations must match exactly between peers:  let fory = Fory::default(); // SchemaConsistent by default   ","version":"0.15","tagName":"h3"},{"title":"Compatible Mode‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/rust/configuration#compatible-mode","content":" Allows independent schema evolution:  let fory = Fory::default().compatible(true);   ","version":"0.15","tagName":"h3"},{"title":"Configuration Options‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/rust/configuration#configuration-options","content":" ","version":"0.15","tagName":"h2"},{"title":"Maximum Dynamic Object Nesting Depth‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/rust/configuration#maximum-dynamic-object-nesting-depth","content":" Apache Fory‚Ñ¢ provides protection against stack overflow from deeply nested dynamic objects during deserialization. By default, the maximum nesting depth is set to 5 levels for trait objects and containers.  Default configuration:  let fory = Fory::default(); // max_dyn_depth = 5   Custom depth limit:  let fory = Fory::default().max_dyn_depth(10); // Allow up to 10 levels   When to adjust:  Increase: For legitimate deeply nested data structuresDecrease: For stricter security requirements or shallow data structures  Protected types:  Box&lt;dyn Any&gt;, Rc&lt;dyn Any&gt;, Arc&lt;dyn Any&gt;Box&lt;dyn Trait&gt;, Rc&lt;dyn Trait&gt;, Arc&lt;dyn Trait&gt; (trait objects)RcWeak&lt;T&gt;, ArcWeak&lt;T&gt;Collection types (Vec, HashMap, HashSet)Nested struct types in Compatible mode  Note: Static data types (non-dynamic types) are secure by nature and not subject to depth limits, as their structure is known at compile time.  ","version":"0.15","tagName":"h3"},{"title":"Cross-Language Mode‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/rust/configuration#cross-language-mode","content":" Enable cross-language serialization:  let fory = Fory::default() .compatible(true) .xlang(true);   ","version":"0.15","tagName":"h3"},{"title":"Builder Pattern‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/rust/configuration#builder-pattern","content":" use fory::Fory; // Default configuration let fory = Fory::default(); // Compatible mode for schema evolution let fory = Fory::default().compatible(true); // Cross-language mode let fory = Fory::default() .compatible(true) .xlang(true); // Custom depth limit let fory = Fory::default().max_dyn_depth(10); // Combined configuration let fory = Fory::default() .compatible(true) .xlang(true) .max_dyn_depth(10);   ","version":"0.15","tagName":"h2"},{"title":"Configuration Summary‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/rust/configuration#configuration-summary","content":" Option\tDescription\tDefaultcompatible(bool)\tEnable schema evolution\tfalse xlang(bool)\tEnable cross-language mode\tfalse max_dyn_depth(u32)\tMaximum nesting depth for dynamic types\t5  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Configuration","url":"/docs/guide/rust/configuration#related-topics","content":" Basic Serialization - Using configured ForySchema Evolution - Compatible mode detailsCross-Language - XLANG mode ","version":"0.15","tagName":"h2"},{"title":"Basic Serialization","type":0,"sectionRef":"#","url":"/docs/guide/rust/basic_serialization","content":"","keywords":"","version":"0.15"},{"title":"Object Graph Serialization‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/rust/basic_serialization#object-graph-serialization","content":" Apache Fory‚Ñ¢ provides automatic serialization of complex object graphs, preserving the structure and relationships between objects. The #[derive(ForyObject)] macro generates efficient serialization code at compile time, eliminating runtime overhead.  Key capabilities:  Nested struct serialization with arbitrary depthCollection types (Vec, HashMap, HashSet, BTreeMap)Optional fields with Option&lt;T&gt;Automatic handling of primitive types and stringsEfficient binary encoding with variable-length integers  use fory::{Fory, Error}; use fory::ForyObject; use std::collections::HashMap; #[derive(ForyObject, Debug, PartialEq)] struct Person { name: String, age: i32, address: Address, hobbies: Vec&lt;String&gt;, metadata: HashMap&lt;String, String&gt;, } #[derive(ForyObject, Debug, PartialEq)] struct Address { street: String, city: String, country: String, } let mut fory = Fory::default(); fory.register::&lt;Address&gt;(100); fory.register::&lt;Person&gt;(200); let person = Person { name: &quot;John Doe&quot;.to_string(), age: 30, address: Address { street: &quot;123 Main St&quot;.to_string(), city: &quot;New York&quot;.to_string(), country: &quot;USA&quot;.to_string(), }, hobbies: vec![&quot;reading&quot;.to_string(), &quot;coding&quot;.to_string()], metadata: HashMap::from([ (&quot;role&quot;.to_string(), &quot;developer&quot;.to_string()), ]), }; let bytes = fory.serialize(&amp;person); let decoded: Person = fory.deserialize(&amp;bytes)?; assert_eq!(person, decoded);   ","version":"0.15","tagName":"h2"},{"title":"Supported Types‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/rust/basic_serialization#supported-types","content":" ","version":"0.15","tagName":"h2"},{"title":"Primitive Types‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/rust/basic_serialization#primitive-types","content":" Rust Type\tDescriptionbool\tBoolean i8, i16, i32, i64\tSigned integers f32, f64\tFloating point String\tUTF-8 string  ","version":"0.15","tagName":"h3"},{"title":"Collections‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/rust/basic_serialization#collections","content":" Rust Type\tDescriptionVec&lt;T&gt;\tDynamic array VecDeque&lt;T&gt;\tDouble-ended queue LinkedList&lt;T&gt;\tDoubly-linked list HashMap&lt;K, V&gt;\tHash map BTreeMap&lt;K, V&gt;\tOrdered map HashSet&lt;T&gt;\tHash set BTreeSet&lt;T&gt;\tOrdered set BinaryHeap&lt;T&gt;\tBinary heap Option&lt;T&gt;\tOptional value  ","version":"0.15","tagName":"h3"},{"title":"Smart Pointers‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/rust/basic_serialization#smart-pointers","content":" Rust Type\tDescriptionBox&lt;T&gt;\tHeap allocation Rc&lt;T&gt;\tReference counting (shared refs tracked) Arc&lt;T&gt;\tThread-safe reference counting (shared refs tracked) RcWeak&lt;T&gt;\tWeak reference to Rc&lt;T&gt; (breaks circular refs) ArcWeak&lt;T&gt;\tWeak reference to Arc&lt;T&gt; (breaks circular refs) RefCell&lt;T&gt;\tInterior mutability (runtime borrow checking) Mutex&lt;T&gt;\tThread-safe interior mutability  ","version":"0.15","tagName":"h3"},{"title":"Date and Time‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/rust/basic_serialization#date-and-time","content":" Rust Type\tDescriptionchrono::NaiveDate\tDate without timezone chrono::NaiveDateTime\tTimestamp without timezone  ","version":"0.15","tagName":"h3"},{"title":"Custom Types‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/rust/basic_serialization#custom-types","content":" Macro\tDescription#[derive(ForyObject)]\tObject graph serialization #[derive(ForyRow)]\tRow-based serialization  ","version":"0.15","tagName":"h3"},{"title":"Serialization APIs‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/rust/basic_serialization#serialization-apis","content":" use fory::{Fory, Reader}; let mut fory = Fory::default(); fory.register::&lt;MyStruct&gt;(1)?; let obj = MyStruct { /* ... */ }; // Basic serialize/deserialize let bytes = fory.serialize(&amp;obj)?; let decoded: MyStruct = fory.deserialize(&amp;bytes)?; // Serialize to existing buffer let mut buf: Vec&lt;u8&gt; = vec![]; fory.serialize_to(&amp;mut buf, &amp;obj)?; // Deserialize from reader let mut reader = Reader::new(&amp;buf); let decoded: MyStruct = fory.deserialize_from(&amp;mut reader)?;   ","version":"0.15","tagName":"h2"},{"title":"Performance Tips‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/rust/basic_serialization#performance-tips","content":" Zero-Copy Deserialization: Row format enables direct memory access without copyingBuffer Pre-allocation: Minimizes memory allocations during serializationCompact Encoding: Variable-length encoding for space efficiencyLittle-Endian: Optimized for modern CPU architecturesReference Deduplication: Shared objects serialized only once  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Basic Serialization","url":"/docs/guide/rust/basic_serialization#related-topics","content":" Type Registration - Registering typesReferences - Shared and circular referencesCustom Serializers - Manual serialization ","version":"0.15","tagName":"h2"},{"title":"Cross-Language Serialization","type":0,"sectionRef":"#","url":"/docs/guide/rust/cross_language","content":"","keywords":"","version":"0.15"},{"title":"Enable Cross-Language Mode‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/rust/cross_language#enable-cross-language-mode","content":" use fory::Fory; // Enable cross-language mode let mut fory = Fory::default() .compatible(true) .xlang(true); // Register types with consistent IDs across languages fory.register::&lt;MyStruct&gt;(100); // Or use namespace-based registration fory.register_by_namespace::&lt;MyStruct&gt;(&quot;com.example&quot;, &quot;MyStruct&quot;);   ","version":"0.15","tagName":"h2"},{"title":"Type Registration for Cross-Language‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/rust/cross_language#type-registration-for-cross-language","content":" ","version":"0.15","tagName":"h2"},{"title":"Register by ID‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/rust/cross_language#register-by-id","content":" For fast, compact serialization with consistent IDs across languages:  let mut fory = Fory::default() .compatible(true) .xlang(true); fory.register::&lt;User&gt;(100); // Same ID in Java, Python, etc.   ","version":"0.15","tagName":"h3"},{"title":"Register by Namespace‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/rust/cross_language#register-by-namespace","content":" For more flexible type naming:  fory.register_by_namespace::&lt;User&gt;(&quot;com.example&quot;, &quot;User&quot;);   ","version":"0.15","tagName":"h3"},{"title":"Cross-Language Example‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/rust/cross_language#cross-language-example","content":" ","version":"0.15","tagName":"h2"},{"title":"Rust (Serializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/rust/cross_language#rust-serializer","content":" use fory::Fory; use fory::ForyObject; #[derive(ForyObject)] struct Person { name: String, age: i32, } let mut fory = Fory::default() .compatible(true) .xlang(true); fory.register::&lt;Person&gt;(100); let person = Person { name: &quot;Alice&quot;.to_string(), age: 30, }; let bytes = fory.serialize(&amp;person)?; // bytes can be deserialized by Java, Python, etc.   ","version":"0.15","tagName":"h3"},{"title":"Java (Deserializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/rust/cross_language#java-deserializer","content":" import org.apache.fory.*; import org.apache.fory.config.*; public class Person { public String name; public int age; } Fory fory = Fory.builder() .withLanguage(Language.XLANG) .withRefTracking(true) .build(); fory.register(Person.class, 100); // Same ID as Rust Person person = (Person) fory.deserialize(bytesFromRust);   ","version":"0.15","tagName":"h3"},{"title":"Python (Deserializer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/rust/cross_language#python-deserializer","content":" import pyfory from dataclasses import dataclass @dataclass class Person: name: str age: pyfory.int32 fory = pyfory.Fory(xlang=True, ref=True) fory.register_type(Person, type_id=100) # Same ID as Rust person = fory.deserialize(bytes_from_rust)   ","version":"0.15","tagName":"h3"},{"title":"Type Mapping‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/rust/cross_language#type-mapping","content":" See xlang_type_mapping.md for complete type mapping across languages.  ","version":"0.15","tagName":"h2"},{"title":"Common Type Mappings‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/rust/cross_language#common-type-mappings","content":" Rust\tJava\tPythoni32\tint\tint32 i64\tlong\tint64 f32\tfloat\tfloat32 f64\tdouble\tfloat64 String\tString\tstr Vec&lt;T&gt;\tList&lt;T&gt;\tList[T] HashMap&lt;K,V&gt;\tMap&lt;K,V&gt;\tDict[K,V] Option&lt;T&gt;\tnullable T\tOptional[T]  ","version":"0.15","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/rust/cross_language#best-practices","content":" Use consistent type IDs across all languagesEnable compatible mode for schema evolutionRegister all types before serializationTest cross-language compatibility during development  ","version":"0.15","tagName":"h2"},{"title":"See Also‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/rust/cross_language#see-also","content":" Cross-Language Serialization SpecificationType Mapping ReferenceJava Cross-Language GuidePython Cross-Language Guide  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Cross-Language Serialization","url":"/docs/guide/rust/cross_language#related-topics","content":" Configuration - XLANG mode configurationSchema Evolution - Compatible modeType Registration - Registration methods ","version":"0.15","tagName":"h2"},{"title":"Custom Serializers","type":0,"sectionRef":"#","url":"/docs/guide/rust/custom_serializers","content":"","keywords":"","version":"0.15"},{"title":"When to Use Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/rust/custom_serializers#when-to-use-custom-serializers","content":" External types from other cratesTypes with special serialization requirementsLegacy data format compatibilityPerformance-critical custom encoding  ","version":"0.15","tagName":"h2"},{"title":"Implementing the Serializer Trait‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/rust/custom_serializers#implementing-the-serializer-trait","content":" use fory::{Fory, ReadContext, WriteContext, Serializer, ForyDefault, Error}; use std::any::Any; #[derive(Debug, PartialEq, Default)] struct CustomType { value: i32, name: String, } impl Serializer for CustomType { fn fory_write_data(&amp;self, context: &amp;mut WriteContext, is_field: bool) { context.writer.write_i32(self.value); context.writer.write_varuint32(self.name.len() as u32); context.writer.write_utf8_string(&amp;self.name); } fn fory_read_data(context: &amp;mut ReadContext, is_field: bool) -&gt; Result&lt;Self, Error&gt; { let value = context.reader.read_i32(); let len = context.reader.read_varuint32() as usize; let name = context.reader.read_utf8_string(len); Ok(Self { value, name }) } fn fory_type_id_dyn(&amp;self, type_resolver: &amp;TypeResolver) -&gt; u32 { Self::fory_get_type_id(type_resolver) } fn as_any(&amp;self) -&gt; &amp;dyn Any { self } } // ForyDefault delegates to Default impl ForyDefault for CustomType { fn fory_default() -&gt; Self { Self::default() } }   Note: When implementing ForyDefault manually, ensure your type also implements Default if you use Self::default(). Alternatively, you can construct a default instance directly in fory_default(). Tip: If your type supports #[derive(ForyObject)], you can use #[fory(generate_default)] to automatically generate both ForyDefault and Default implementations.  ","version":"0.15","tagName":"h2"},{"title":"Registering Custom Serializers‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/rust/custom_serializers#registering-custom-serializers","content":" let mut fory = Fory::default(); fory.register_serializer::&lt;CustomType&gt;(100); let custom = CustomType { value: 42, name: &quot;test&quot;.to_string(), }; let bytes = fory.serialize(&amp;custom); let decoded: CustomType = fory.deserialize(&amp;bytes)?; assert_eq!(custom, decoded);   ","version":"0.15","tagName":"h2"},{"title":"WriteContext and ReadContext‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/rust/custom_serializers#writecontext-and-readcontext","content":" The WriteContext and ReadContext provide access to:  writer/reader: Binary buffer operationstype_resolver: Type registration informationref_resolver: Reference tracking (for shared/circular references)  ","version":"0.15","tagName":"h2"},{"title":"Common Writer Methods‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/rust/custom_serializers#common-writer-methods","content":" // Primitive types context.writer.write_i8(value); context.writer.write_i16(value); context.writer.write_i32(value); context.writer.write_i64(value); context.writer.write_f32(value); context.writer.write_f64(value); context.writer.write_bool(value); // Variable-length integers context.writer.write_varint32(value); context.writer.write_varuint32(value); // Strings context.writer.write_utf8_string(&amp;string);   ","version":"0.15","tagName":"h3"},{"title":"Common Reader Methods‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/rust/custom_serializers#common-reader-methods","content":" // Primitive types let value = context.reader.read_i8(); let value = context.reader.read_i16(); let value = context.reader.read_i32(); let value = context.reader.read_i64(); let value = context.reader.read_f32(); let value = context.reader.read_f64(); let value = context.reader.read_bool(); // Variable-length integers let value = context.reader.read_varint32(); let value = context.reader.read_varuint32(); // Strings let string = context.reader.read_utf8_string(len);   ","version":"0.15","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/rust/custom_serializers#best-practices","content":" Use variable-length encoding for integers that may be smallWrite length first for variable-length dataHandle errors properly in read methodsImplement ForyDefault for schema evolution support  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Custom Serializers","url":"/docs/guide/rust/custom_serializers#related-topics","content":" Type Registration - Registering serializersBasic Serialization - Using ForyObject deriveSchema Evolution - Compatible mode ","version":"0.15","tagName":"h2"},{"title":"Field Configuration","type":0,"sectionRef":"#","url":"/docs/guide/rust/field_configuration","content":"","keywords":"","version":"0.15"},{"title":"Overview‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/rust/field_configuration#overview","content":" Apache Fory‚Ñ¢ provides the #[fory(...)] attribute macro to specify optional field-level metadata at compile time. This enables:  Tag IDs: Assign compact numeric IDs to minimize struct field meta size overheadNullability: Control whether fields can be nullReference Tracking: Enable reference tracking for shared ownership typesField Skipping: Exclude fields from serializationEncoding Control: Specify how integers are encoded (varint, fixed, tagged)  ","version":"0.15","tagName":"h2"},{"title":"Basic Syntax‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/rust/field_configuration#basic-syntax","content":" The #[fory(...)] attribute is placed on individual struct fields:  use fory::ForyObject; #[derive(ForyObject)] struct Person { #[fory(id = 0)] name: String, #[fory(id = 1)] age: i32, #[fory(id = 2, nullable)] nickname: Option&lt;String&gt;, }   Multiple options are separated by commas.  ","version":"0.15","tagName":"h2"},{"title":"Available Options‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/rust/field_configuration#available-options","content":" ","version":"0.15","tagName":"h2"},{"title":"Field ID (id = N)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/rust/field_configuration#field-id-id--n","content":" Assigns a numeric ID to a field to minimize struct field meta size overhead:  #[derive(ForyObject)] struct User { #[fory(id = 0)] id: i64, #[fory(id = 1)] name: String, #[fory(id = 2)] age: i32, }   Benefits:  Smaller serialized size (numeric IDs vs field names in metadata)Allows renaming fields without breaking binary compatibility  Recommendation: It is recommended to configure field IDs for compatible mode since it reduces serialization cost.  Notes:  IDs must be unique within a structIDs must be &gt;= 0 (use -1 to explicitly opt-out of tag ID encoding)If not specified, field name is used in metadata (larger overhead)  ","version":"0.15","tagName":"h3"},{"title":"Skipping Fields (skip)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/rust/field_configuration#skipping-fields-skip","content":" Excludes a field from serialization:  #[derive(ForyObject)] struct User { #[fory(id = 0)] id: i64, #[fory(id = 1)] name: String, #[fory(skip)] password: String, // Not serialized }   The password field will not be included in serialized output and will remain at its default value after deserialization.  ","version":"0.15","tagName":"h3"},{"title":"Nullable (nullable)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/rust/field_configuration#nullable-nullable","content":" Controls whether null flags are written for fields:  use fory::{Fory, RcWeak}; #[derive(ForyObject)] struct Record { // RcWeak is nullable by default, override to non-nullable #[fory(id = 0, nullable = false)] required_ref: RcWeak&lt;Data&gt;, }   Default Behavior:  Type\tDefault NullableOption&lt;T&gt;\ttrue RcWeak&lt;T&gt;, ArcWeak&lt;T&gt;\ttrue All other types\tfalse  Notes:  For Option&lt;T&gt;, RcWeak&lt;T&gt;, ArcWeak&lt;T&gt;, nullable defaults to trueFor all other types, nullable defaults to falseUse nullable = false to override defaults for types that are nullable by default  ","version":"0.15","tagName":"h3"},{"title":"Reference Tracking (ref)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/rust/field_configuration#reference-tracking-ref","content":" Controls per-field reference tracking for shared ownership types:  use std::rc::Rc; use std::sync::Arc; #[derive(ForyObject)] struct Container { // Enable reference tracking (default for Rc/Arc) #[fory(id = 0, ref = true)] shared_data: Rc&lt;Data&gt;, // Disable reference tracking #[fory(id = 1, ref = false)] unique_data: Rc&lt;Data&gt;, }   Default Behavior:  Type\tDefault Ref TrackingRc&lt;T&gt;, Arc&lt;T&gt;\ttrue RcWeak&lt;T&gt;, ArcWeak&lt;T&gt;\ttrue Option&lt;Rc&lt;T&gt;&gt;, Option&lt;Arc&lt;T&gt;&gt;\ttrue (inherited) All other types\tfalse  Use Cases:  Enable for fields that may be circular or sharedDisable for fields that are always unique (optimization)  ","version":"0.15","tagName":"h3"},{"title":"Encoding (encoding)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/rust/field_configuration#encoding-encoding","content":" Controls how integer fields are encoded:  #[derive(ForyObject)] struct Metrics { // Variable-length encoding (smaller for small values) #[fory(id = 0, encoding = &quot;varint&quot;)] count: i64, // Fixed-length encoding (consistent size) #[fory(id = 1, encoding = &quot;fixed&quot;)] timestamp: i64, // Tagged encoding (includes type tag, u64 only) #[fory(id = 2, encoding = &quot;tagged&quot;)] value: u64, }   Supported Encodings:  Type\tOptions\tDefaulti32, u32\tvarint, fixed\tvarint i64, u64\tvarint, fixed, tagged\tvarint  When to Use:  varint: Best for values that are often small (default)fixed: Best for values that use full range (e.g., timestamps, hashes)tagged: When type information needs to be preserved (u64 only)  ","version":"0.15","tagName":"h3"},{"title":"Compress (compress)‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/rust/field_configuration#compress-compress","content":" A convenience shorthand for controlling integer encoding:  #[derive(ForyObject)] struct Data { // compress = true -&gt; varint encoding (default) #[fory(id = 0, compress)] small_value: i32, // compress = false -&gt; fixed encoding #[fory(id = 1, compress = false)] fixed_value: u32, }   Notes:  compress or compress = true is equivalent to encoding = &quot;varint&quot;compress = false is equivalent to encoding = &quot;fixed&quot;If both compress and encoding are specified, they must not conflict  ","version":"0.15","tagName":"h3"},{"title":"Type Classification‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/rust/field_configuration#type-classification","content":" Fory classifies field types to determine default behavior:  Type Class\tExamples\tDefault Nullable\tDefault RefPrimitive\ti8, i32, f64, bool\tfalse\tfalse Option\tOption&lt;T&gt;\ttrue\tfalse Rc\tRc&lt;T&gt;\tfalse\ttrue Arc\tArc&lt;T&gt;\tfalse\ttrue RcWeak\tRcWeak&lt;T&gt; (fory type)\ttrue\ttrue ArcWeak\tArcWeak&lt;T&gt; (fory type)\ttrue\ttrue Other\tString, Vec&lt;T&gt;, user types\tfalse\tfalse  Special Case: Option&lt;Rc&lt;T&gt;&gt; and Option&lt;Arc&lt;T&gt;&gt; inherit the inner type's ref tracking behavior.  ","version":"0.15","tagName":"h2"},{"title":"Complete Example‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/rust/field_configuration#complete-example","content":" use fory::ForyObject; use std::rc::Rc; #[derive(ForyObject, Default)] struct Document { // Required fields with tag IDs #[fory(id = 0)] title: String, #[fory(id = 1)] version: i32, // Optional field (nullable by default for Option) #[fory(id = 2)] description: Option&lt;String&gt;, // Reference-tracked shared pointer #[fory(id = 3)] parent: Rc&lt;Document&gt;, // Nullable + reference-tracked #[fory(id = 4, nullable)] related: Option&lt;Rc&lt;Document&gt;&gt;, // Counter with varint encoding (small values) #[fory(id = 5, encoding = &quot;varint&quot;)] view_count: u64, // Timestamp with fixed encoding (full range values) #[fory(id = 6, encoding = &quot;fixed&quot;)] created_at: i64, // Skip sensitive field #[fory(skip)] internal_state: String, } fn main() { let fory = fory::Fory::default(); let doc = Document { title: &quot;My Document&quot;.to_string(), version: 1, description: Some(&quot;A sample document&quot;.to_string()), parent: Rc::new(Document::default()), related: None, // Allowed because nullable view_count: 42, created_at: 1704067200, internal_state: &quot;secret&quot;.to_string(), // Will be skipped }; let bytes = fory.serialize(&amp;doc); let decoded: Document = fory.deserialize(&amp;bytes).unwrap(); }   ","version":"0.15","tagName":"h2"},{"title":"Compile-Time Validation‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/rust/field_configuration#compile-time-validation","content":" Invalid configurations are caught at compile time:  // Error: duplicate field IDs #[derive(ForyObject)] struct Bad { #[fory(id = 0)] field1: String, #[fory(id = 0)] // Compile error: duplicate id field2: String, } // Error: invalid id value #[derive(ForyObject)] struct Bad2 { #[fory(id = -2)] // Compile error: id must be &gt;= -1 field: String, } // Error: conflicting encoding attributes #[derive(ForyObject)] struct Bad3 { #[fory(compress = true, encoding = &quot;fixed&quot;)] // Compile error: conflict field: i32, }   ","version":"0.15","tagName":"h2"},{"title":"Cross-Language Compatibility‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/rust/field_configuration#cross-language-compatibility","content":" When serializing data to be read by other languages (Java, C++, Go, Python), use field configuration to match encoding expectations:  #[derive(ForyObject)] struct CrossLangData { // Matches Java Integer with varint #[fory(id = 0, encoding = &quot;varint&quot;)] int_var: i32, // Matches Java Integer with fixed #[fory(id = 1, encoding = &quot;fixed&quot;)] int_fixed: i32, // Matches Java Long with tagged encoding #[fory(id = 2, encoding = &quot;tagged&quot;)] long_tagged: u64, // Nullable pointer matches Java nullable reference #[fory(id = 3, nullable)] optional: Option&lt;String&gt;, }   ","version":"0.15","tagName":"h2"},{"title":"Schema Evolution‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/rust/field_configuration#schema-evolution","content":" Compatible mode supports schema evolution. It is recommended to configure field IDs to reduce serialization cost:  // Version 1 #[derive(ForyObject)] struct DataV1 { #[fory(id = 0)] id: i64, #[fory(id = 1)] name: String, } // Version 2: Added new field #[derive(ForyObject)] struct DataV2 { #[fory(id = 0)] id: i64, #[fory(id = 1)] name: String, #[fory(id = 2)] email: Option&lt;String&gt;, // New nullable field }   Data serialized with V1 can be deserialized with V2 (new field will be None).  Alternatively, field IDs can be omitted (field names will be used in metadata with larger overhead):  #[derive(ForyObject)] struct Data { id: i64, name: String, }   ","version":"0.15","tagName":"h2"},{"title":"Default Values‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/rust/field_configuration#default-values","content":" Nullable: Option&lt;T&gt;, RcWeak&lt;T&gt;, and ArcWeak&lt;T&gt; are nullable by default; all other types are non-nullableRef tracking: Rc&lt;T&gt;, Arc&lt;T&gt;, RcWeak&lt;T&gt;, and ArcWeak&lt;T&gt; enable ref tracking by default; all other types are disabled  You need to configure fields when:  A field can be None (use Option&lt;T&gt;)A field needs reference tracking for shared/circular objects (use ref = true)Integer types need specific encoding for cross-language compatibilityYou want to reduce metadata size (use field IDs)  // Xlang mode: explicit configuration required #[derive(ForyObject)] struct User { #[fory(id = 0)] name: String, // Non-nullable by default #[fory(id = 1)] email: Option&lt;String&gt;, // Nullable (Option&lt;T&gt;) #[fory(id = 2, ref = true)] friend: Rc&lt;User&gt;, // Ref tracking (default for Rc) }   ","version":"0.15","tagName":"h2"},{"title":"Default Values Summary‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/rust/field_configuration#default-values-summary","content":" Type\tDefault Nullable\tDefault Ref TrackingPrimitives, String\tfalse\tfalse Option&lt;T&gt;\ttrue\tfalse Rc&lt;T&gt;, Arc&lt;T&gt;\tfalse\ttrue RcWeak&lt;T&gt;, ArcWeak&lt;T&gt;\ttrue\ttrue  ","version":"0.15","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/rust/field_configuration#best-practices","content":" Configure field IDs: Recommended for compatible mode to reduce serialization costUse skip for sensitive data: Passwords, tokens, internal stateEnable ref tracking for shared objects: When the same pointer appears multiple timesDisable ref tracking for unique fields: Optimization when you know the field is uniqueChoose appropriate encoding: varint for small values, fixed for full-range valuesKeep IDs stable: Once assigned, don't change field IDs  ","version":"0.15","tagName":"h2"},{"title":"Options Reference‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/rust/field_configuration#options-reference","content":" Option\tSyntax\tDescription\tValid Forid\tid = N\tField tag ID to reduce metadata size\tAll fields skip\tskip\tExclude field from serialization\tAll fields nullable\tnullable or nullable = bool\tControl null flag writing\tAll fields ref\tref or ref = bool\tControl reference tracking\tRc, Arc, weak types encoding\tencoding = &quot;varint/fixed/tagged&quot;\tInteger encoding method\ti32, u32, i64, u64 compress\tcompress or compress = bool\tShorthand for varint/fixed\ti32, u32  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Field Configuration","url":"/docs/guide/rust/field_configuration#related-topics","content":" Basic Serialization - Getting started with Fory serializationSchema Evolution - Compatible mode and schema evolutionCross-Language - Interoperability with Java, C++, Go, Python ","version":"0.15","tagName":"h2"},{"title":"Trait Object Serialization","type":0,"sectionRef":"#","url":"/docs/guide/rust/polymorphism","content":"","keywords":"","version":"0.15"},{"title":"Supported Trait Object Types‚Äã","type":1,"pageTitle":"Trait Object Serialization","url":"/docs/guide/rust/polymorphism#supported-trait-object-types","content":" Box&lt;dyn Trait&gt; - Owned trait objectsRc&lt;dyn Trait&gt; - Reference-counted trait objectsArc&lt;dyn Trait&gt; - Thread-safe reference-counted trait objectsVec&lt;Box&lt;dyn Trait&gt;&gt;, HashMap&lt;K, Box&lt;dyn Trait&gt;&gt; - Collections of trait objects  ","version":"0.15","tagName":"h2"},{"title":"Basic Trait Object Serialization‚Äã","type":1,"pageTitle":"Trait Object Serialization","url":"/docs/guide/rust/polymorphism#basic-trait-object-serialization","content":" use fory::{Fory, register_trait_type}; use fory::Serializer; use fory::ForyObject; trait Animal: Serializer { fn speak(&amp;self) -&gt; String; fn name(&amp;self) -&gt; &amp;str; } #[derive(ForyObject)] struct Dog { name: String, breed: String } impl Animal for Dog { fn speak(&amp;self) -&gt; String { &quot;Woof!&quot;.to_string() } fn name(&amp;self) -&gt; &amp;str { &amp;self.name } } #[derive(ForyObject)] struct Cat { name: String, color: String } impl Animal for Cat { fn speak(&amp;self) -&gt; String { &quot;Meow!&quot;.to_string() } fn name(&amp;self) -&gt; &amp;str { &amp;self.name } } // Register trait implementations register_trait_type!(Animal, Dog, Cat); #[derive(ForyObject)] struct Zoo { star_animal: Box&lt;dyn Animal&gt;, } let mut fory = Fory::default().compatible(true); fory.register::&lt;Dog&gt;(100); fory.register::&lt;Cat&gt;(101); fory.register::&lt;Zoo&gt;(102); let zoo = Zoo { star_animal: Box::new(Dog { name: &quot;Buddy&quot;.to_string(), breed: &quot;Labrador&quot;.to_string(), }), }; let bytes = fory.serialize(&amp;zoo); let decoded: Zoo = fory.deserialize(&amp;bytes)?; assert_eq!(decoded.star_animal.name(), &quot;Buddy&quot;); assert_eq!(decoded.star_animal.speak(), &quot;Woof!&quot;);   ","version":"0.15","tagName":"h2"},{"title":"Serializing dyn Any Trait Objects‚Äã","type":1,"pageTitle":"Trait Object Serialization","url":"/docs/guide/rust/polymorphism#serializing-dyn-any-trait-objects","content":" Apache Fory‚Ñ¢ supports serializing Rc&lt;dyn Any&gt; and Arc&lt;dyn Any&gt; for runtime type dispatch:  Key points:  Works with any type that implements SerializerRequires downcasting after deserialization to access the concrete typeType information is preserved during serializationUseful for plugin systems and dynamic type handling  use std::rc::Rc; use std::any::Any; let dog_rc: Rc&lt;dyn Animal&gt; = Rc::new(Dog { name: &quot;Rex&quot;.to_string(), breed: &quot;Golden&quot;.to_string() }); // Convert to Rc&lt;dyn Any&gt; for serialization let dog_any: Rc&lt;dyn Any&gt; = dog_rc.clone(); // Serialize the Any wrapper let bytes = fory.serialize(&amp;dog_any); let decoded: Rc&lt;dyn Any&gt; = fory.deserialize(&amp;bytes)?; // Downcast back to the concrete type let unwrapped = decoded.downcast_ref::&lt;Dog&gt;().unwrap(); assert_eq!(unwrapped.name, &quot;Rex&quot;);   For thread-safe scenarios, use Arc&lt;dyn Any&gt;:  use std::sync::Arc; use std::any::Any; let dog_arc: Arc&lt;dyn Animal&gt; = Arc::new(Dog { name: &quot;Buddy&quot;.to_string(), breed: &quot;Labrador&quot;.to_string() }); // Convert to Arc&lt;dyn Any&gt; let dog_any: Arc&lt;dyn Any&gt; = dog_arc.clone(); let bytes = fory.serialize(&amp;dog_any); let decoded: Arc&lt;dyn Any&gt; = fory.deserialize(&amp;bytes)?; // Downcast to concrete type let unwrapped = decoded.downcast_ref::&lt;Dog&gt;().unwrap(); assert_eq!(unwrapped.name, &quot;Buddy&quot;);   ","version":"0.15","tagName":"h2"},{"title":"Rc/Arc-Based Trait Objects in Structs‚Äã","type":1,"pageTitle":"Trait Object Serialization","url":"/docs/guide/rust/polymorphism#rcarc-based-trait-objects-in-structs","content":" For fields with Rc&lt;dyn Trait&gt; or Arc&lt;dyn Trait&gt;, Fory automatically handles the conversion:  use std::sync::Arc; use std::rc::Rc; use std::collections::HashMap; #[derive(ForyObject)] struct AnimalShelter { animals_rc: Vec&lt;Rc&lt;dyn Animal&gt;&gt;, animals_arc: Vec&lt;Arc&lt;dyn Animal&gt;&gt;, registry: HashMap&lt;String, Arc&lt;dyn Animal&gt;&gt;, } let mut fory = Fory::default().compatible(true); fory.register::&lt;Dog&gt;(100); fory.register::&lt;Cat&gt;(101); fory.register::&lt;AnimalShelter&gt;(102); let shelter = AnimalShelter { animals_rc: vec![ Rc::new(Dog { name: &quot;Rex&quot;.to_string(), breed: &quot;Golden&quot;.to_string() }), Rc::new(Cat { name: &quot;Mittens&quot;.to_string(), color: &quot;Gray&quot;.to_string() }), ], animals_arc: vec![ Arc::new(Dog { name: &quot;Buddy&quot;.to_string(), breed: &quot;Labrador&quot;.to_string() }), ], registry: HashMap::from([ (&quot;pet1&quot;.to_string(), Arc::new(Dog { name: &quot;Max&quot;.to_string(), breed: &quot;Shepherd&quot;.to_string() }) as Arc&lt;dyn Animal&gt;), ]), }; let bytes = fory.serialize(&amp;shelter); let decoded: AnimalShelter = fory.deserialize(&amp;bytes)?; assert_eq!(decoded.animals_rc[0].name(), &quot;Rex&quot;); assert_eq!(decoded.animals_arc[0].speak(), &quot;Woof!&quot;);   ","version":"0.15","tagName":"h2"},{"title":"Standalone Trait Object Serialization‚Äã","type":1,"pageTitle":"Trait Object Serialization","url":"/docs/guide/rust/polymorphism#standalone-trait-object-serialization","content":" Due to Rust's orphan rule, Rc&lt;dyn Trait&gt; and Arc&lt;dyn Trait&gt; cannot implement Serializer directly. For standalone serialization (not inside struct fields), the register_trait_type! macro generates wrapper types.  Note: If you don't want to use wrapper types, you can serialize as Rc&lt;dyn Any&gt; or Arc&lt;dyn Any&gt; instead (see the dyn Any section above).  The register_trait_type! macro generates AnimalRc and AnimalArc wrapper types:  // For Rc&lt;dyn Trait&gt; let dog_rc: Rc&lt;dyn Animal&gt; = Rc::new(Dog { name: &quot;Rex&quot;.to_string(), breed: &quot;Golden&quot;.to_string() }); let wrapper = AnimalRc::from(dog_rc); let bytes = fory.serialize(&amp;wrapper); let decoded: AnimalRc = fory.deserialize(&amp;bytes)?; // Unwrap back to Rc&lt;dyn Animal&gt; let unwrapped: Rc&lt;dyn Animal&gt; = decoded.unwrap(); assert_eq!(unwrapped.name(), &quot;Rex&quot;); // For Arc&lt;dyn Trait&gt; let dog_arc: Arc&lt;dyn Animal&gt; = Arc::new(Dog { name: &quot;Buddy&quot;.to_string(), breed: &quot;Labrador&quot;.to_string() }); let wrapper = AnimalArc::from(dog_arc); let bytes = fory.serialize(&amp;wrapper); let decoded: AnimalArc = fory.deserialize(&amp;bytes)?; let unwrapped: Arc&lt;dyn Animal&gt; = decoded.unwrap(); assert_eq!(unwrapped.name(), &quot;Buddy&quot;);   ","version":"0.15","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Trait Object Serialization","url":"/docs/guide/rust/polymorphism#best-practices","content":" Use register_trait_type! to register all trait implementationsEnable compatible mode for trait objects: .compatible(true)Register all concrete types before serializationPrefer dyn Any for simpler standalone serialization  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Trait Object Serialization","url":"/docs/guide/rust/polymorphism#related-topics","content":" References - Rc/Arc shared referencesSchema Evolution - Compatible modeType Registration - Registering types ","version":"0.15","tagName":"h2"},{"title":"Shared & Circular References","type":0,"sectionRef":"#","url":"/docs/guide/rust/references","content":"","keywords":"","version":"0.15"},{"title":"Shared References‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/guide/rust/references#shared-references","content":" When the same object is referenced multiple times, Fory serializes it only once and uses reference IDs for subsequent occurrences. This ensures:  Space efficiency: No data duplication in serialized outputReference identity preservation: Deserialized objects maintain the same sharing relationshipsCircular reference support: Use RcWeak&lt;T&gt; and ArcWeak&lt;T&gt; to break cycles  ","version":"0.15","tagName":"h2"},{"title":"Shared References with Rc‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/guide/rust/references#shared-references-with-rc","content":" use fory::Fory; use std::rc::Rc; let fory = Fory::default(); // Create a shared value let shared = Rc::new(String::from(&quot;shared_value&quot;)); // Reference it multiple times let data = vec![shared.clone(), shared.clone(), shared.clone()]; // The shared value is serialized only once let bytes = fory.serialize(&amp;data); let decoded: Vec&lt;Rc&lt;String&gt;&gt; = fory.deserialize(&amp;bytes)?; // Verify reference identity is preserved assert_eq!(decoded.len(), 3); assert_eq!(*decoded[0], &quot;shared_value&quot;); // All three Rc pointers point to the same object assert!(Rc::ptr_eq(&amp;decoded[0], &amp;decoded[1])); assert!(Rc::ptr_eq(&amp;decoded[1], &amp;decoded[2]));   ","version":"0.15","tagName":"h3"},{"title":"Shared References with Arc‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/guide/rust/references#shared-references-with-arc","content":" For thread-safe shared references, use Arc&lt;T&gt;:  use fory::Fory; use std::sync::Arc; let fory = Fory::default(); let shared = Arc::new(String::from(&quot;shared_value&quot;)); let data = vec![shared.clone(), shared.clone()]; let bytes = fory.serialize(&amp;data); let decoded: Vec&lt;Arc&lt;String&gt;&gt; = fory.deserialize(&amp;bytes)?; assert!(Arc::ptr_eq(&amp;decoded[0], &amp;decoded[1]));   ","version":"0.15","tagName":"h3"},{"title":"Circular References with Weak Pointers‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/guide/rust/references#circular-references-with-weak-pointers","content":" To serialize circular references like parent-child relationships or doubly-linked structures, use RcWeak&lt;T&gt; or ArcWeak&lt;T&gt; to break the cycle.  How it works:  Weak pointers serialize as references to their target objectsIf the strong pointer has been dropped, weak serializes as NullForward references (weak appearing before target) are resolved via callbacksAll clones of a weak pointer share the same internal cell for automatic updates  ","version":"0.15","tagName":"h2"},{"title":"Circular References with RcWeak‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/guide/rust/references#circular-references-with-rcweak","content":" use fory::{Fory, Error}; use fory::ForyObject; use fory::RcWeak; use std::rc::Rc; use std::cell::RefCell; #[derive(ForyObject, Debug)] struct Node { value: i32, parent: RcWeak&lt;RefCell&lt;Node&gt;&gt;, children: Vec&lt;Rc&lt;RefCell&lt;Node&gt;&gt;&gt;, } let mut fory = Fory::default(); fory.register::&lt;Node&gt;(2000); // Build a parent-child tree let parent = Rc::new(RefCell::new(Node { value: 1, parent: RcWeak::new(), children: vec![], })); let child1 = Rc::new(RefCell::new(Node { value: 2, parent: RcWeak::from(&amp;parent), children: vec![], })); let child2 = Rc::new(RefCell::new(Node { value: 3, parent: RcWeak::from(&amp;parent), children: vec![], })); parent.borrow_mut().children.push(child1.clone()); parent.borrow_mut().children.push(child2.clone()); // Serialize and deserialize the circular structure let bytes = fory.serialize(&amp;parent); let decoded: Rc&lt;RefCell&lt;Node&gt;&gt; = fory.deserialize(&amp;bytes)?; // Verify the circular relationship assert_eq!(decoded.borrow().children.len(), 2); for child in &amp;decoded.borrow().children { let upgraded_parent = child.borrow().parent.upgrade().unwrap(); assert!(Rc::ptr_eq(&amp;decoded, &amp;upgraded_parent)); }   ","version":"0.15","tagName":"h3"},{"title":"Thread-Safe Circular Graphs with Arc‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/guide/rust/references#thread-safe-circular-graphs-with-arc","content":" use fory::{Fory, Error}; use fory::ForyObject; use fory::ArcWeak; use std::sync::{Arc, Mutex}; #[derive(ForyObject)] struct Node { val: i32, parent: ArcWeak&lt;Mutex&lt;Node&gt;&gt;, children: Vec&lt;Arc&lt;Mutex&lt;Node&gt;&gt;&gt;, } let mut fory = Fory::default(); fory.register::&lt;Node&gt;(6000); let parent = Arc::new(Mutex::new(Node { val: 10, parent: ArcWeak::new(), children: vec![], })); let child1 = Arc::new(Mutex::new(Node { val: 20, parent: ArcWeak::from(&amp;parent), children: vec![], })); let child2 = Arc::new(Mutex::new(Node { val: 30, parent: ArcWeak::from(&amp;parent), children: vec![], })); parent.lock().unwrap().children.push(child1.clone()); parent.lock().unwrap().children.push(child2.clone()); let bytes = fory.serialize(&amp;parent); let decoded: Arc&lt;Mutex&lt;Node&gt;&gt; = fory.deserialize(&amp;bytes)?; assert_eq!(decoded.lock().unwrap().children.len(), 2); for child in &amp;decoded.lock().unwrap().children { let upgraded_parent = child.lock().unwrap().parent.upgrade().unwrap(); assert!(Arc::ptr_eq(&amp;decoded, &amp;upgraded_parent)); }   ","version":"0.15","tagName":"h3"},{"title":"Supported Smart Pointer Types‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/guide/rust/references#supported-smart-pointer-types","content":" Type\tDescriptionRc&lt;T&gt;\tReference counting, shared refs tracked Arc&lt;T&gt;\tThread-safe reference counting, shared refs tracked RcWeak&lt;T&gt;\tWeak reference to Rc&lt;T&gt;, breaks circular refs ArcWeak&lt;T&gt;\tWeak reference to Arc&lt;T&gt;, breaks circular refs RefCell&lt;T&gt;\tInterior mutability with runtime borrow checking Mutex&lt;T&gt;\tThread-safe interior mutability  ","version":"0.15","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/guide/rust/references#best-practices","content":" Use Rc/Arc for shared data: Let Fory handle deduplicationUse weak pointers for cycles: Prevent infinite recursionPrefer Arc for thread-safe scenarios: When data crosses thread boundariesCombine with RefCell/Mutex: For interior mutability  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Shared & Circular References","url":"/docs/guide/rust/references#related-topics","content":" Basic Serialization - Supported typesPolymorphism - Trait objects with Rc/ArcConfiguration - Reference tracking options ","version":"0.15","tagName":"h2"},{"title":"Row Format","type":0,"sectionRef":"#","url":"/docs/guide/rust/row_format","content":"","keywords":"","version":"0.15"},{"title":"Overview‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/rust/row_format#overview","content":" Unlike traditional object serialization that reconstructs entire objects in memory, row format enables random access to fields directly from binary data without full deserialization.  Key benefits:  Zero-copy access: Read fields without allocating or copying dataPartial deserialization: Access only the fields you needMemory-mapped files: Work with data larger than RAMCache-friendly: Sequential memory layout for better CPU cache utilizationLazy evaluation: Defer expensive operations until field access  ","version":"0.15","tagName":"h2"},{"title":"When to Use Row Format‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/rust/row_format#when-to-use-row-format","content":" Analytics workloads with selective field accessLarge datasets where only a subset of fields is neededMemory-constrained environmentsHigh-throughput data pipelinesReading from memory-mapped files or shared memory  ","version":"0.15","tagName":"h2"},{"title":"Basic Usage‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/rust/row_format#basic-usage","content":" use fory::{to_row, from_row}; use fory::ForyRow; use std::collections::BTreeMap; #[derive(ForyRow)] struct UserProfile { id: i64, username: String, email: String, scores: Vec&lt;i32&gt;, preferences: BTreeMap&lt;String, String&gt;, is_active: bool, } let profile = UserProfile { id: 12345, username: &quot;alice&quot;.to_string(), email: &quot;alice@example.com&quot;.to_string(), scores: vec![95, 87, 92, 88], preferences: BTreeMap::from([ (&quot;theme&quot;.to_string(), &quot;dark&quot;.to_string()), (&quot;language&quot;.to_string(), &quot;en&quot;.to_string()), ]), is_active: true, }; // Serialize to row format let row_data = to_row(&amp;profile); // Zero-copy deserialization - no object allocation! let row = from_row::&lt;UserProfile&gt;(&amp;row_data); // Access fields directly from binary data assert_eq!(row.id(), 12345); assert_eq!(row.username(), &quot;alice&quot;); assert_eq!(row.email(), &quot;alice@example.com&quot;); assert_eq!(row.is_active(), true); // Access collections efficiently let scores = row.scores(); assert_eq!(scores.size(), 4); assert_eq!(scores.get(0), 95); assert_eq!(scores.get(1), 87); let prefs = row.preferences(); assert_eq!(prefs.keys().size(), 2); assert_eq!(prefs.keys().get(0), &quot;language&quot;); assert_eq!(prefs.values().get(0), &quot;en&quot;);   ","version":"0.15","tagName":"h2"},{"title":"How It Works‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/rust/row_format#how-it-works","content":" Fields are encoded in a binary row with fixed offsets for primitivesVariable-length data (strings, collections) stored with offset pointersNull bitmap tracks which fields are presentNested structures supported through recursive row encoding  ","version":"0.15","tagName":"h2"},{"title":"Performance Comparison‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/rust/row_format#performance-comparison","content":" Operation\tObject Format\tRow FormatFull deserialization\tAllocates all objects\tZero allocation Single field access\tFull deserialization required\tDirect offset read Memory usage\tFull object graph in memory\tOnly accessed fields in memory Suitable for\tSmall objects, full access\tLarge objects, selective access  ","version":"0.15","tagName":"h2"},{"title":"ForyRow vs ForyObject‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/rust/row_format#foryrow-vs-foryobject","content":" Feature\t#[derive(ForyRow)]\t#[derive(ForyObject)]Deserialization\tZero-copy, lazy\tFull object reconstruction Field access\tDirect from binary\tNormal struct access Memory usage\tMinimal\tFull object Best for\tAnalytics, large data\tGeneral serialization  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/rust/row_format#related-topics","content":" Basic Serialization - Object graph serializationCross-Language - Row format across languagesRow Format Specification - Protocol details ","version":"0.15","tagName":"h2"},{"title":"Scala Serialization Guide","type":0,"sectionRef":"#","url":"/docs/guide/scala/","content":"","keywords":"","version":"0.15"},{"title":"Features‚Äã","type":1,"pageTitle":"Scala Serialization Guide","url":"/docs/guide/scala/#features","content":" Fory Scala inherits all features from Fory Java, plus Scala-specific optimizations:  High Performance: JIT code generation, zero-copy, 20-170x faster than traditional serializationScala Type Support: Optimized serializers for case classes, singletons, collections, tuples, Option, EitherDefault Value Support: Automatic handling of Scala class default parameters during schema evolutionSingleton Preservation: object singletons maintain referential equality after deserializationSchema Evolution: Forward/backward compatibility for class schema changes  See Java Features for complete feature list.  ","version":"0.15","tagName":"h2"},{"title":"Installation‚Äã","type":1,"pageTitle":"Scala Serialization Guide","url":"/docs/guide/scala/#installation","content":" Add the dependency with sbt:  libraryDependencies += &quot;org.apache.fory&quot; %% &quot;fory-scala&quot; % &quot;0.15.0&quot;   ","version":"0.15","tagName":"h2"},{"title":"Quick Start‚Äã","type":1,"pageTitle":"Scala Serialization Guide","url":"/docs/guide/scala/#quick-start","content":" import org.apache.fory.Fory import org.apache.fory.serializer.scala.ScalaSerializers case class Person(name: String, id: Long, github: String) case class Point(x: Int, y: Int, z: Int) object ScalaExample { // Create Fory with Scala optimization enabled val fory: Fory = Fory.builder() .withScalaOptimizationEnabled(true) .build() // Register optimized Fory serializers for Scala ScalaSerializers.registerSerializers(fory) // Register your classes fory.register(classOf[Person]) fory.register(classOf[Point]) def main(args: Array[String]): Unit = { val p = Person(&quot;Shawn Yang&quot;, 1, &quot;https://github.com/chaokunyang&quot;) println(fory.deserialize(fory.serialize(p))) println(fory.deserialize(fory.serialize(Point(1, 2, 3)))) } }   ","version":"0.15","tagName":"h2"},{"title":"Built on Fory Java‚Äã","type":1,"pageTitle":"Scala Serialization Guide","url":"/docs/guide/scala/#built-on-fory-java","content":" Fory Scala is built on top of Fory Java. Most configuration options, features, and concepts from Fory Java apply directly to Scala. Refer to the Java documentation for:  Configuration Options - All ForyBuilder optionsBasic Serialization - Serialization patterns and APIsType Registration - Class registration and securitySchema Evolution - Forward/backward compatibilityCustom Serializers - Implement custom serializersCompression - Int, long, and string compressionTroubleshooting - Common issues and solutions  ","version":"0.15","tagName":"h2"},{"title":"Scala-Specific Documentation‚Äã","type":1,"pageTitle":"Scala Serialization Guide","url":"/docs/guide/scala/#scala-specific-documentation","content":" Fory Creation - Scala-specific Fory setup requirementsType Serialization - Serializing Scala typesDefault Values - Scala class default values support ","version":"0.15","tagName":"h2"},{"title":"Troubleshooting","type":0,"sectionRef":"#","url":"/docs/guide/rust/troubleshooting","content":"","keywords":"","version":"0.15"},{"title":"Common Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/rust/troubleshooting#common-issues","content":" ","version":"0.15","tagName":"h2"},{"title":"Type Registry Errors‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/rust/troubleshooting#type-registry-errors","content":" Error: TypeId ... not found in type_info registry  Cause: The type was never registered with the current Fory instance.  Solution: Register the type before serialization:  let mut fory = Fory::default(); fory.register::&lt;MyStruct&gt;(100)?; // Register before use   Confirm that:  Every serializable struct or trait implementation calls fory.register::&lt;T&gt;(type_id)The same IDs are reused on the deserialize side  ","version":"0.15","tagName":"h3"},{"title":"Type Mismatch Errors‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/rust/troubleshooting#type-mismatch-errors","content":" Cause: Field types are incompatible or schema has changed.  Solution:  Enable compatible mode for schema evolutionEnsure field types match across versions  let fory = Fory::default().compatible(true);   ","version":"0.15","tagName":"h3"},{"title":"Debugging Techniques‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/rust/troubleshooting#debugging-techniques","content":" ","version":"0.15","tagName":"h2"},{"title":"Enable Panic on Error for Backtraces‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/rust/troubleshooting#enable-panic-on-error-for-backtraces","content":" Toggle FORY_PANIC_ON_ERROR=1 alongside RUST_BACKTRACE=1 to panic at the exact site an error is constructed:  RUST_BACKTRACE=1 FORY_PANIC_ON_ERROR=1 cargo test --features tests   Reset the variable afterwards to avoid aborting user-facing code paths.  ","version":"0.15","tagName":"h3"},{"title":"Struct Field Tracing‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/rust/troubleshooting#struct-field-tracing","content":" Add the #[fory(debug)] attribute alongside #[derive(ForyObject)] to emit hook invocations:  #[derive(ForyObject)] #[fory(debug)] struct MyStruct { field1: i32, field2: String, }   Once compiled with debug hooks, call these functions to plug in custom callbacks:  set_before_write_field_funcset_after_write_field_funcset_before_read_field_funcset_after_read_field_func  Use reset_struct_debug_hooks() when you want the defaults back.  ","version":"0.15","tagName":"h3"},{"title":"Lightweight Logging‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/rust/troubleshooting#lightweight-logging","content":" Without custom hooks, enable ENABLE_FORY_DEBUG_OUTPUT=1 to print field-level read/write events:  ENABLE_FORY_DEBUG_OUTPUT=1 cargo test --features tests   This is especially useful when investigating alignment or cursor mismatches.  ","version":"0.15","tagName":"h3"},{"title":"Inspect Generated Code‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/rust/troubleshooting#inspect-generated-code","content":" Use cargo expand to inspect code generated by Fory derive macros:  cargo expand --test mod $mod$::$file$ &gt; expanded.rs   ","version":"0.15","tagName":"h3"},{"title":"Running Tests‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/rust/troubleshooting#running-tests","content":" ","version":"0.15","tagName":"h2"},{"title":"Run All Tests‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/rust/troubleshooting#run-all-tests","content":" cargo test --features tests   ","version":"0.15","tagName":"h3"},{"title":"Run Specific Test‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/rust/troubleshooting#run-specific-test","content":" cargo test -p tests --test $test_file $test_method   ","version":"0.15","tagName":"h3"},{"title":"Run Test with Debugging‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/rust/troubleshooting#run-test-with-debugging","content":" RUST_BACKTRACE=1 FORY_PANIC_ON_ERROR=1 ENABLE_FORY_DEBUG_OUTPUT=1 \\ cargo test --test mod $dir$::$test_file::$test_method -- --nocapture   ","version":"0.15","tagName":"h3"},{"title":"Test-Time Hygiene‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/rust/troubleshooting#test-time-hygiene","content":" Some integration tests expect FORY_PANIC_ON_ERROR to remain unset. Export it only for focused debugging sessions:  # For specific debugging only FORY_PANIC_ON_ERROR=1 cargo test -p tests --test specific_test -- --nocapture # Normal test run (without panic on error) cargo test --features tests   ","version":"0.15","tagName":"h2"},{"title":"Error Handling Best Practices‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/rust/troubleshooting#error-handling-best-practices","content":" Prefer the static constructors on fory_core::error::Error:  Error::type_mismatchError::invalid_dataError::unknown  This keeps diagnostics consistent and makes opt-in panics work correctly.  ","version":"0.15","tagName":"h2"},{"title":"Quick Reference‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/rust/troubleshooting#quick-reference","content":" Environment Variable\tPurposeRUST_BACKTRACE=1\tEnable stack traces FORY_PANIC_ON_ERROR=1\tPanic at error site for debugging ENABLE_FORY_DEBUG_OUTPUT=1\tPrint field-level read/write events  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/rust/troubleshooting#related-topics","content":" Configuration - Fory optionsType Registration - Registration best practicesSchema Evolution - Compatible mode ","version":"0.15","tagName":"h2"},{"title":"Type Registration","type":0,"sectionRef":"#","url":"/docs/guide/rust/type_registration","content":"","keywords":"","version":"0.15"},{"title":"Register by ID‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/rust/type_registration#register-by-id","content":" Register types with a numeric ID for fast, compact serialization:  use fory::Fory; use fory::ForyObject; #[derive(ForyObject)] struct User { name: String, age: i32, } let mut fory = Fory::default(); fory.register::&lt;User&gt;(1)?; let user = User { name: &quot;Alice&quot;.to_string(), age: 30, }; let bytes = fory.serialize(&amp;user)?; let decoded: User = fory.deserialize(&amp;bytes)?;   ","version":"0.15","tagName":"h2"},{"title":"Register by Namespace‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/rust/type_registration#register-by-namespace","content":" For cross-language compatibility, register with namespace and type name:  let mut fory = Fory::default() .compatible(true) .xlang(true); // Register with namespace-based naming fory.register_by_namespace::&lt;MyStruct&gt;(&quot;com.example&quot;, &quot;MyStruct&quot;)?;   ","version":"0.15","tagName":"h2"},{"title":"Register Custom Serializer‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/rust/type_registration#register-custom-serializer","content":" For types that need custom serialization logic:  let mut fory = Fory::default(); fory.register_serializer::&lt;CustomType&gt;(100)?;   ","version":"0.15","tagName":"h2"},{"title":"Registration Consistency‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/rust/type_registration#registration-consistency","content":" Rust registration APIs use explicit IDs or explicit namespace/type names. Keep the same registration mapping on serializer and deserializer peers:  // Serializer side let mut fory = Fory::default(); fory.register::&lt;TypeA&gt;(1)?; fory.register::&lt;TypeB&gt;(2)?; fory.register::&lt;TypeC&gt;(3)?; // Deserializer side - MUST use the same ID mapping let mut fory = Fory::default(); fory.register::&lt;TypeA&gt;(1)?; fory.register::&lt;TypeB&gt;(2)?; fory.register::&lt;TypeC&gt;(3)?;   ","version":"0.15","tagName":"h2"},{"title":"Thread-Safe Registration‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/rust/type_registration#thread-safe-registration","content":" Perform all registrations before spawning threads:  use std::sync::Arc; use std::thread; let mut fory = Fory::default(); fory.register::&lt;User&gt;(1)?; fory.register::&lt;Order&gt;(2)?; // Now share across threads let fory = Arc::new(fory); let handles: Vec&lt;_&gt; = (0..4) .map(|_| { let shared = Arc::clone(&amp;fory); thread::spawn(move || { // Use fory for serialization }) }) .collect();   ","version":"0.15","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/rust/type_registration#best-practices","content":" Use consistent IDs: Same type ID across all languages for cross-language compatibilityRegister before threading: Complete all registrations before spawning threadsUse namespace for xlang: Makes type names consistent across languagesExplicit IDs for stability: Avoid auto-generated IDs in production  ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Type Registration","url":"/docs/guide/rust/type_registration#related-topics","content":" Configuration - Fory builder optionsCross-Language - XLANG mode registrationCustom Serializers - Custom serialization ","version":"0.15","tagName":"h2"},{"title":"Schema Evolution","type":0,"sectionRef":"#","url":"/docs/guide/rust/schema_evolution","content":"","keywords":"","version":"0.15"},{"title":"Compatible Mode‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/rust/schema_evolution#compatible-mode","content":" Enable schema evolution with compatible(true):  use fory::Fory; use fory::ForyObject; use std::collections::HashMap; #[derive(ForyObject, Debug)] struct PersonV1 { name: String, age: i32, address: String, } #[derive(ForyObject, Debug)] struct PersonV2 { name: String, age: i32, // address removed // phone added phone: Option&lt;String&gt;, metadata: HashMap&lt;String, String&gt;, } let mut fory1 = Fory::default().compatible(true); fory1.register::&lt;PersonV1&gt;(1); let mut fory2 = Fory::default().compatible(true); fory2.register::&lt;PersonV2&gt;(1); let person_v1 = PersonV1 { name: &quot;Alice&quot;.to_string(), age: 30, address: &quot;123 Main St&quot;.to_string(), }; // Serialize with V1 let bytes = fory1.serialize(&amp;person_v1); // Deserialize with V2 - missing fields get default values let person_v2: PersonV2 = fory2.deserialize(&amp;bytes)?; assert_eq!(person_v2.name, &quot;Alice&quot;); assert_eq!(person_v2.age, 30); assert_eq!(person_v2.phone, None);   ","version":"0.15","tagName":"h2"},{"title":"Disable Evolution for Stable Structs‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/rust/schema_evolution#disable-evolution-for-stable-structs","content":" If a struct schema is stable and will not change, you can disable evolution for that struct to avoid compatible metadata overhead. Use #[fory(evolving = false)]:  use fory::ForyObject; #[derive(ForyObject)] #[fory(evolving = false)] struct StableMessage { id: i32, }   ","version":"0.15","tagName":"h3"},{"title":"Schema Evolution Features‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/rust/schema_evolution#schema-evolution-features","content":" Add new fields with default valuesRemove obsolete fields (skipped during deserialization)Change field nullability (T ‚Üî Option&lt;T&gt;)Reorder fields (matched by name, not position)Type-safe fallback to default values for missing fields  ","version":"0.15","tagName":"h2"},{"title":"Compatibility Rules‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/rust/schema_evolution#compatibility-rules","content":" Field names must match (case-sensitive)Type changes are not supported (except nullable/non-nullable)Nested struct types must be registered on both sides  ","version":"0.15","tagName":"h2"},{"title":"Enum Support‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/rust/schema_evolution#enum-support","content":" Apache Fory‚Ñ¢ supports three types of enum variants with full schema evolution in Compatible mode:  Variant Types:  Unit: C-style enums (Status::Active)Unnamed: Tuple-like variants (Message::Pair(String, i32))Named: Struct-like variants (Event::Click { x: i32, y: i32 })  use fory::{Fory, ForyObject}; #[derive(Default, ForyObject, Debug, PartialEq)] enum Value { #[default] Null, Bool(bool), Number(f64), Text(String), Object { name: String, value: i32 }, } let mut fory = Fory::default(); fory.register::&lt;Value&gt;(1)?; let value = Value::Object { name: &quot;score&quot;.to_string(), value: 100 }; let bytes = fory.serialize(&amp;value)?; let decoded: Value = fory.deserialize(&amp;bytes)?; assert_eq!(value, decoded);   ","version":"0.15","tagName":"h2"},{"title":"Enum Schema Evolution‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/rust/schema_evolution#enum-schema-evolution","content":" Compatible mode enables robust schema evolution with variant type encoding (2 bits):  0b0 = Unit, 0b1 = Unnamed, 0b10 = Named  use fory::{Fory, ForyObject}; // Old version #[derive(ForyObject)] enum OldEvent { Click { x: i32, y: i32 }, Scroll { delta: f64 }, } // New version - added field and variant #[derive(Default, ForyObject)] enum NewEvent { #[default] Unknown, Click { x: i32, y: i32, timestamp: u64 }, // Added field Scroll { delta: f64 }, KeyPress(String), // New variant } let mut fory = Fory::default().compatible(true); // Serialize with old schema let old_bytes = fory.serialize(&amp;OldEvent::Click { x: 100, y: 200 })?; // Deserialize with new schema - timestamp gets default value (0) let new_event: NewEvent = fory.deserialize(&amp;old_bytes)?; assert!(matches!(new_event, NewEvent::Click { x: 100, y: 200, timestamp: 0 }));   Evolution capabilities:  Unknown variants ‚Üí Falls back to default variantNamed variant fields ‚Üí Add/remove fields (missing fields use defaults)Unnamed variant elements ‚Üí Add/remove elements (extras skipped, missing use defaults)Variant type mismatches ‚Üí Automatically uses default value for current variant  Best practices:  Always mark a default variant with #[default]Named variants provide better evolution than unnamedUse compatible mode for cross-version communication  ","version":"0.15","tagName":"h3"},{"title":"Tuple Support‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/rust/schema_evolution#tuple-support","content":" Apache Fory‚Ñ¢ supports tuples up to 22 elements out of the box with efficient serialization in both compatible and non-compatible modes.  Features:  Automatic serialization for tuples from 1 to 22 elementsHeterogeneous type support (each element can be a different type)Schema evolution in Compatible mode (handles missing/extra elements)  Serialization modes:  Non-compatible mode: Serializes elements sequentially without collection headers for minimal overheadCompatible mode: Uses collection protocol with type metadata for schema evolution  use fory::{Fory, Error}; let mut fory = Fory::default(); // Tuple with heterogeneous types let data: (i32, String, bool, Vec&lt;i32&gt;) = ( 42, &quot;hello&quot;.to_string(), true, vec![1, 2, 3], ); let bytes = fory.serialize(&amp;data)?; let decoded: (i32, String, bool, Vec&lt;i32&gt;) = fory.deserialize(&amp;bytes)?; assert_eq!(data, decoded);   ","version":"0.15","tagName":"h2"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Schema Evolution","url":"/docs/guide/rust/schema_evolution#related-topics","content":" Configuration - Enabling compatible modePolymorphism - Trait objects with schema evolutionCross-Language - Schema evolution across languages ","version":"0.15","tagName":"h2"},{"title":"Fory Creation","type":0,"sectionRef":"#","url":"/docs/guide/scala/fory_creation","content":"","keywords":"","version":"0.15"},{"title":"Basic Setup‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/guide/scala/fory_creation#basic-setup","content":" When using Fory for Scala serialization, you must:  Enable Scala optimization via withScalaOptimizationEnabled(true)Register Scala serializers via ScalaSerializers.registerSerializers(fory)  import org.apache.fory.Fory import org.apache.fory.serializer.scala.ScalaSerializers val fory = Fory.builder() .withScalaOptimizationEnabled(true) .build() // Register optimized Fory serializers for Scala ScalaSerializers.registerSerializers(fory)   ","version":"0.15","tagName":"h2"},{"title":"Registering Scala Internal Types‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/guide/scala/fory_creation#registering-scala-internal-types","content":" Depending on the object types you serialize, you may need to register some Scala internal types:  fory.register(Class.forName(&quot;scala.Enumeration.Val&quot;))   To avoid such registration, you can disable class registration:  val fory = Fory.builder() .withScalaOptimizationEnabled(true) .requireClassRegistration(false) .build()   Note: Disabling class registration allows deserialization of unknown types. This is more flexible but may be insecure if the classes contain malicious code.  ","version":"0.15","tagName":"h2"},{"title":"Reference Tracking‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/guide/scala/fory_creation#reference-tracking","content":" Circular references are common in Scala. Reference tracking should be enabled with withRefTracking(true):  val fory = Fory.builder() .withScalaOptimizationEnabled(true) .withRefTracking(true) .build()   Note: If you don't enable reference tracking, StackOverflowError may occur for some Scala versions when serializing Scala Enumeration.  ","version":"0.15","tagName":"h2"},{"title":"Thread Safety‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/guide/scala/fory_creation#thread-safety","content":" Fory instance creation is not cheap. Instances should be shared between multiple serializations.  ","version":"0.15","tagName":"h2"},{"title":"Single-Thread Usage‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/guide/scala/fory_creation#single-thread-usage","content":" import org.apache.fory.Fory import org.apache.fory.serializer.scala.ScalaSerializers object ForyHolder { val fory: Fory = { val f = Fory.builder() .withScalaOptimizationEnabled(true) .build() ScalaSerializers.registerSerializers(f) f } }   ","version":"0.15","tagName":"h3"},{"title":"Multi-Thread Usage‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/guide/scala/fory_creation#multi-thread-usage","content":" For multi-threaded applications, use ThreadSafeFory:  import org.apache.fory.ThreadSafeFory import org.apache.fory.ThreadLocalFory import org.apache.fory.serializer.scala.ScalaSerializers object ForyHolder { val fory: ThreadSafeFory = new ThreadLocalFory(classLoader =&gt; { val f = Fory.builder() .withScalaOptimizationEnabled(true) .withClassLoader(classLoader) .build() ScalaSerializers.registerSerializers(f) f }) }   ","version":"0.15","tagName":"h3"},{"title":"Configuration Options‚Äã","type":1,"pageTitle":"Fory Creation","url":"/docs/guide/scala/fory_creation#configuration-options","content":" All configuration options from Fory Java are available. See Java Configuration Options for the complete list.  Common options for Scala:  import org.apache.fory.Fory import org.apache.fory.config.CompatibleMode import org.apache.fory.serializer.scala.ScalaSerializers val fory = Fory.builder() .withScalaOptimizationEnabled(true) // Enable reference tracking for circular references .withRefTracking(true) // Enable schema evolution support .withCompatibleMode(CompatibleMode.COMPATIBLE) // Enable async compilation for better startup performance .withAsyncCompilation(true) .build() ScalaSerializers.registerSerializers(fory)  ","version":"0.15","tagName":"h2"},{"title":"Default Values","type":0,"sectionRef":"#","url":"/docs/guide/scala/default_values","content":"","keywords":"","version":"0.15"},{"title":"Overview‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/guide/scala/default_values#overview","content":" When a Scala class has default parameters, the Scala compiler generates methods in the companion object (for case classes) or in the class itself (for regular Scala classes) like apply$default$1, apply$default$2, etc. that return the default values. Fory can detect these methods and use them when deserializing objects where certain fields are missing from the serialized data.  ","version":"0.15","tagName":"h2"},{"title":"Supported Class Types‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/guide/scala/default_values#supported-class-types","content":" Fory supports default values for:  Case classes with default parametersRegular Scala classes with default parameters in their primary constructorNested case classes with default parameters  ","version":"0.15","tagName":"h2"},{"title":"How It Works‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/guide/scala/default_values#how-it-works","content":" Detection: Fory detects if a class is a Scala class by checking for the presence of default value methods (apply$default$N or $default$N). Default Value Discovery: For case classes: Fory scans the companion object for methods named apply$default$1, apply$default$2, etc.For regular Scala classes: Fory scans the class itself for methods named $default$1, $default$2, etc. Field Mapping: During deserialization, Fory identifies fields that exist in the target class but are missing from the serialized data. Value Application: After reading all available fields from the serialized data, Fory applies default values to any missing fields.  ","version":"0.15","tagName":"h2"},{"title":"Usage‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/guide/scala/default_values#usage","content":" This feature is automatically enabled when:  Compatible mode is enabled (withCompatibleMode(CompatibleMode.COMPATIBLE))The target class is detected as a Scala class with default valuesA field is missing from the serialized data but exists in the target class  No additional configuration is required.  ","version":"0.15","tagName":"h2"},{"title":"Examples‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/guide/scala/default_values#examples","content":" ","version":"0.15","tagName":"h2"},{"title":"Case Class with Default Values‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/guide/scala/default_values#case-class-with-default-values","content":" import org.apache.fory.Fory import org.apache.fory.config.CompatibleMode import org.apache.fory.serializer.scala.ScalaSerializers // Class WITHOUT default values (for serialization) case class PersonV1(name: String) // Class WITH default values (for deserialization) case class PersonV2(name: String, age: Int = 25, city: String = &quot;Unknown&quot;) val fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .withScalaOptimizationEnabled(true) .build() ScalaSerializers.registerSerializers(fory) // Serialize using class without default values val original = PersonV1(&quot;John&quot;) val serialized = fory.serialize(original) // Deserialize into class with default values // Missing fields will use defaults val deserialized = fory.deserialize(serialized).asInstanceOf[PersonV2] // deserialized.name == &quot;John&quot; // deserialized.age == 25 (default) // deserialized.city == &quot;Unknown&quot; (default)   ","version":"0.15","tagName":"h3"},{"title":"Regular Scala Class with Default Values‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/guide/scala/default_values#regular-scala-class-with-default-values","content":" // Class WITHOUT default values (for serialization) class EmployeeV1(val name: String) // Class WITH default values (for deserialization) class EmployeeV2( val name: String, val age: Int = 30, val department: String = &quot;Engineering&quot; ) val fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .withScalaOptimizationEnabled(true) .build() ScalaSerializers.registerSerializers(fory) // Serialize using class without default values val original = new EmployeeV1(&quot;Jane&quot;) val serialized = fory.serialize(original) // Deserialize into class with default values val deserialized = fory.deserialize(serialized).asInstanceOf[EmployeeV2] // deserialized.name == &quot;Jane&quot; // deserialized.age == 30 (default) // deserialized.department == &quot;Engineering&quot; (default)   ","version":"0.15","tagName":"h3"},{"title":"Complex Default Values‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/guide/scala/default_values#complex-default-values","content":" Default values can be complex expressions:  // Class WITHOUT default values (for serialization) case class ConfigV1(name: String) // Class WITH default values (for deserialization) case class ConfigV2( name: String, settings: Map[String, String] = Map(&quot;default&quot; -&gt; &quot;value&quot;), tags: List[String] = List(&quot;default&quot;), enabled: Boolean = true ) val fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .withScalaOptimizationEnabled(true) .build() ScalaSerializers.registerSerializers(fory) val original = ConfigV1(&quot;myConfig&quot;) val serialized = fory.serialize(original) val deserialized = fory.deserialize(serialized).asInstanceOf[ConfigV2] // deserialized.name == &quot;myConfig&quot; // deserialized.settings == Map(&quot;default&quot; -&gt; &quot;value&quot;) // deserialized.tags == List(&quot;default&quot;) // deserialized.enabled == true   ","version":"0.15","tagName":"h3"},{"title":"Nested Case Classes‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/guide/scala/default_values#nested-case-classes","content":" object Models { // Class WITHOUT default values (for serialization) case class PersonV1(name: String) // Classes WITH default values (for deserialization) case class Address(street: String, city: String = &quot;DefaultCity&quot;) case class PersonV2(name: String, address: Address = Address(&quot;DefaultStreet&quot;)) } val fory = Fory.builder() .withCompatibleMode(CompatibleMode.COMPATIBLE) .withScalaOptimizationEnabled(true) .build() ScalaSerializers.registerSerializers(fory) val original = Models.PersonV1(&quot;Alice&quot;) val serialized = fory.serialize(original) val deserialized = fory.deserialize(serialized).asInstanceOf[Models.PersonV2] // deserialized.name == &quot;Alice&quot; // deserialized.address == Address(&quot;DefaultStreet&quot;, &quot;DefaultCity&quot;)   ","version":"0.15","tagName":"h3"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Default Values","url":"/docs/guide/scala/default_values#related-topics","content":" Schema Evolution - Forward/backward compatibility in JavaFory Creation - Setting up Fory with compatible mode ","version":"0.15","tagName":"h2"},{"title":"Type Serialization","type":0,"sectionRef":"#","url":"/docs/guide/scala/type_serialization","content":"","keywords":"","version":"0.15"},{"title":"Setup‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/scala/type_serialization#setup","content":" All examples assume the following setup:  import org.apache.fory.Fory import org.apache.fory.serializer.scala.ScalaSerializers val fory = Fory.builder() .withScalaOptimizationEnabled(true) .build() ScalaSerializers.registerSerializers(fory)   ","version":"0.15","tagName":"h2"},{"title":"Case Class‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/scala/type_serialization#case-class","content":" case class Person(github: String, age: Int, id: Long) fory.register(classOf[Person]) val p = Person(&quot;https://github.com/chaokunyang&quot;, 18, 1) println(fory.deserialize(fory.serialize(p)))   ","version":"0.15","tagName":"h2"},{"title":"POJO Class‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/scala/type_serialization#pojo-class","content":" class Foo(f1: Int, f2: String) { override def toString: String = s&quot;Foo($f1, $f2)&quot; } fory.register(classOf[Foo]) println(fory.deserialize(fory.serialize(new Foo(1, &quot;chaokunyang&quot;))))   ","version":"0.15","tagName":"h2"},{"title":"Object Singleton‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/scala/type_serialization#object-singleton","content":" Scala object singletons are serialized and deserialized to the same instance:  object MySingleton { val value = 42 } fory.register(MySingleton.getClass) val o1 = fory.deserialize(fory.serialize(MySingleton)) val o2 = fory.deserialize(fory.serialize(MySingleton)) println(o1 == o2) // true   ","version":"0.15","tagName":"h2"},{"title":"Collection‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/scala/type_serialization#collection","content":" Scala collections are fully supported:  val seq = Seq(1, 2) val list = List(&quot;a&quot;, &quot;b&quot;) val map = Map(&quot;a&quot; -&gt; 1, &quot;b&quot; -&gt; 2) println(fory.deserialize(fory.serialize(seq))) println(fory.deserialize(fory.serialize(list))) println(fory.deserialize(fory.serialize(map)))   ","version":"0.15","tagName":"h2"},{"title":"Tuple‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/scala/type_serialization#tuple","content":" All Scala tuple types (Tuple1 through Tuple22) are supported:  val tuple2 = (100, 10000L) println(fory.deserialize(fory.serialize(tuple2))) val tuple4 = (100, 10000L, 10000L, &quot;str&quot;) println(fory.deserialize(fory.serialize(tuple4)))   ","version":"0.15","tagName":"h2"},{"title":"Enum‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/scala/type_serialization#enum","content":" ","version":"0.15","tagName":"h2"},{"title":"Scala 3 Enum‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/scala/type_serialization#scala-3-enum","content":" enum Color { case Red, Green, Blue } fory.register(classOf[Color]) println(fory.deserialize(fory.serialize(Color.Green)))   ","version":"0.15","tagName":"h3"},{"title":"Scala 2 Enumeration‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/scala/type_serialization#scala-2-enumeration","content":" object ColorEnum extends Enumeration { type ColorEnum = Value val Red, Green, Blue = Value } fory.register(Class.forName(&quot;scala.Enumeration.Val&quot;)) println(fory.deserialize(fory.serialize(ColorEnum.Green)))   Note: For Scala 2 Enumeration, you may need to register scala.Enumeration.Val or enable reference tracking to avoid StackOverflowError.  ","version":"0.15","tagName":"h3"},{"title":"Option‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/scala/type_serialization#option","content":" val some: Option[Long] = Some(100) println(fory.deserialize(fory.serialize(some))) val none: Option[Long] = None println(fory.deserialize(fory.serialize(none)))   ","version":"0.15","tagName":"h2"},{"title":"Either‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/scala/type_serialization#either","content":" val right: Either[String, Int] = Right(42) println(fory.deserialize(fory.serialize(right))) val left: Either[String, Int] = Left(&quot;error&quot;) println(fory.deserialize(fory.serialize(left)))   ","version":"0.15","tagName":"h2"},{"title":"Nested Types‚Äã","type":1,"pageTitle":"Type Serialization","url":"/docs/guide/scala/type_serialization#nested-types","content":" Complex nested structures are fully supported:  case class Address(street: String, city: String) case class Company(name: String, address: Address) case class Employee(name: String, company: Company, tags: List[String]) fory.register(classOf[Address]) fory.register(classOf[Company]) fory.register(classOf[Employee]) val employee = Employee( &quot;John&quot;, Company(&quot;Acme&quot;, Address(&quot;123 Main St&quot;, &quot;Springfield&quot;)), List(&quot;developer&quot;, &quot;scala&quot;) ) println(fory.deserialize(fory.serialize(employee)))  ","version":"0.15","tagName":"h2"},{"title":"GraalVM Guide","type":0,"sectionRef":"#","url":"/docs/guide/serialization","content":"","keywords":"","version":"0.15"},{"title":"GraalVM Native Image‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/guide/serialization#graalvm-native-image","content":" GraalVM native image compiles Java code into native executables ahead-of-time, resulting in faster startup and lower memory usage. However, native images don't support runtime JIT compilation or reflection without explicit configuration.  Apache Fory‚Ñ¢ works excellently with GraalVM native image by using codegen instead of reflection. All serializer code is generated at build time, eliminating the need for reflection configuration files in most cases.  ","version":"0.15","tagName":"h2"},{"title":"How It Works‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/guide/serialization#how-it-works","content":" Fory generates serialization code at GraalVM build time when you:  Create Fory as a static fieldRegister all classes in a static initializerCall fory.ensureSerializersCompiled() to compile serializersConfigure the class to initialize at build time via native-image.properties  The main benefit: You don't need to configure reflection json or serialization json for most serializable classes.  Note: Fory's asyncCompilationEnabled option is automatically disabled for GraalVM native image since runtime JIT is not supported.  ","version":"0.15","tagName":"h2"},{"title":"Basic Usage‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/guide/serialization#basic-usage","content":" ","version":"0.15","tagName":"h2"},{"title":"Step 1: Create Fory and Register Classes‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/guide/serialization#step-1-create-fory-and-register-classes","content":" import org.apache.fory.Fory; public class Example { // Must be static field static Fory fory; static { fory = Fory.builder().build(); fory.register(MyClass.class); fory.register(AnotherClass.class); // Compile all serializers at build time fory.ensureSerializersCompiled(); } public static void main(String[] args) { byte[] bytes = fory.serialize(new MyClass()); MyClass obj = (MyClass) fory.deserialize(bytes); } }   ","version":"0.15","tagName":"h3"},{"title":"Step 2: Configure Build-Time Initialization‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/guide/serialization#step-2-configure-build-time-initialization","content":" Create resources/META-INF/native-image/your-group/your-artifact/native-image.properties:  Args = --initialize-at-build-time=com.example.Example   ","version":"0.15","tagName":"h3"},{"title":"ForyGraalVMFeature (Optional)‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/guide/serialization#forygraalvmfeature-optional","content":" For most types with public constructors, the basic setup above is sufficient. However, some advanced cases require reflection registration:  Private constructors (classes without accessible no-arg constructor)Private inner classes/recordsDynamic proxy serialization  The fory-graalvm-feature module automatically handles these cases, eliminating the need for manual reflect-config.json configuration.  ","version":"0.15","tagName":"h2"},{"title":"Adding the Dependency‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/guide/serialization#adding-the-dependency","content":" &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-graalvm-feature&lt;/artifactId&gt; &lt;version&gt;${fory.version}&lt;/version&gt; &lt;/dependency&gt;   ","version":"0.15","tagName":"h3"},{"title":"Enabling the Feature‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/guide/serialization#enabling-the-feature","content":" Add to your native-image.properties:  Args = --initialize-at-build-time=com.example.Example \\ --features=org.apache.fory.graalvm.feature.ForyGraalVMFeature   ","version":"0.15","tagName":"h3"},{"title":"What ForyGraalVMFeature Handles‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/guide/serialization#what-forygraalvmfeature-handles","content":" Scenario\tWithout Feature\tWith FeaturePublic classes with no-arg ctor\t‚úÖ Works\t‚úÖ Works Private constructors\t‚ùå Needs reflect-config.json\t‚úÖ Auto-registered Private inner records\t‚ùå Needs reflect-config.json\t‚úÖ Auto-registered Dynamic proxies\t‚ùå Needs manual config\t‚úÖ Auto-registered  ","version":"0.15","tagName":"h3"},{"title":"Example with Private Record‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/guide/serialization#example-with-private-record","content":" public class Example { // Private inner record - requires ForyGraalVMFeature private record PrivateRecord(int id, String name) {} static Fory fory; static { fory = Fory.builder().build(); fory.register(PrivateRecord.class); fory.ensureSerializersCompiled(); } }   ","version":"0.15","tagName":"h3"},{"title":"Example with Dynamic Proxy‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/guide/serialization#example-with-dynamic-proxy","content":" import org.apache.fory.util.GraalvmSupport; public class ProxyExample { public interface MyService { String execute(); } static Fory fory; static { fory = Fory.builder().build(); // Register proxy interface for serialization GraalvmSupport.registerProxySupport(MyService.class); fory.ensureSerializersCompiled(); } }   ","version":"0.15","tagName":"h3"},{"title":"Thread-Safe Fory‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/guide/serialization#thread-safe-fory","content":" For multi-threaded applications, use ThreadLocalFory:  import org.apache.fory.Fory; import org.apache.fory.ThreadLocalFory; import org.apache.fory.ThreadSafeFory; public class ThreadSafeExample { public record Foo(int f1, String f2, List&lt;String&gt; f3) {} static ThreadSafeFory fory; static { fory = new ThreadLocalFory(classLoader -&gt; { Fory f = Fory.builder().build(); f.register(Foo.class); f.ensureSerializersCompiled(); return f; }); } public static void main(String[] args) { Foo foo = new Foo(10, &quot;abc&quot;, List.of(&quot;str1&quot;, &quot;str2&quot;)); byte[] bytes = fory.serialize(foo); Foo result = (Foo) fory.deserialize(bytes); } }   ","version":"0.15","tagName":"h2"},{"title":"Troubleshooting‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/guide/serialization#troubleshooting","content":" ","version":"0.15","tagName":"h2"},{"title":"\"Type is instantiated reflectively but was never registered\"‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/guide/serialization#type-is-instantiated-reflectively-but-was-never-registered","content":" If you see this error:  Type com.example.MyClass is instantiated reflectively but was never registered   Solution: Register the class with Fory (don't add to reflect-config.json):  fory.register(MyClass.class); fory.ensureSerializersCompiled();   If the class has a private constructor, either:  Add fory-graalvm-feature dependency, orCreate a reflect-config.json for that specific class  ","version":"0.15","tagName":"h3"},{"title":"Framework Integration‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/guide/serialization#framework-integration","content":" For framework developers integrating Fory:  Provide a configuration file for users to list serializable classesLoad those classes and call fory.register(Class&lt;?&gt;) for eachCall fory.ensureSerializersCompiled() after all registrationsConfigure your integration class for build-time initialization  ","version":"0.15","tagName":"h2"},{"title":"Benchmark‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/guide/serialization#benchmark","content":" Performance comparison between Fory and GraalVM JDK Serialization:  Type\tCompression\tSpeed\tSizeStruct\tOff\t46x faster\t43% Struct\tOn\t24x faster\t31% Pojo\tOff\t12x faster\t56% Pojo\tOn\t12x faster\t48%  See Benchmark.java for benchmark code.  ","version":"0.15","tagName":"h2"},{"title":"Struct Benchmark‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/guide/serialization#struct-benchmark","content":" Class Fields‚Äã  public class Struct implements Serializable { public int f1; public long f2; public float f3; public double f4; public int f5; public long f6; public float f7; public double f8; public int f9; public long f10; public float f11; public double f12; }   Benchmark Results‚Äã  No compression:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Struct Compress number: false Fory size: 76.0 JDK size: 178.0 Fory serialization took mills: 49 JDK serialization took mills: 2254 Compare speed: Fory is 45.70x speed of JDK Compare size: Fory is 0.43x size of JDK   Compress number:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Struct Compress number: true Fory size: 55.0 JDK size: 178.0 Fory serialization took mills: 130 JDK serialization took mills: 3161 Compare speed: Fory is 24.16x speed of JDK Compare size: Fory is 0.31x size of JDK   ","version":"0.15","tagName":"h3"},{"title":"Pojo Benchmark‚Äã","type":1,"pageTitle":"GraalVM Guide","url":"/docs/guide/serialization#pojo-benchmark","content":" Class Fields‚Äã  public class Foo implements Serializable { int f1; String f2; List&lt;String&gt; f3; Map&lt;String, Long&gt; f4; }   Benchmark Results‚Äã  No compression:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Foo Compress number: false Fory size: 541.0 JDK size: 964.0 Fory serialization took mills: 1663 JDK serialization took mills: 16266 Compare speed: Fory is 12.19x speed of JDK Compare size: Fory is 0.56x size of JDK   Compress number:  Benchmark repeat number: 400000 Object type: class org.apache.fory.graalvm.Foo Compress number: true Fory size: 459.0 JDK size: 964.0 Fory serialization took mills: 1289 JDK serialization took mills: 15069 Compare speed: Fory is 12.11x speed of JDK Compare size: Fory is 0.48x size of JDK  ","version":"0.15","tagName":"h3"},{"title":"Cross-Language Serialization Guide","type":0,"sectionRef":"#","url":"/docs/guide/xlang/","content":"","keywords":"","version":"0.15"},{"title":"Features‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/guide/xlang/#features","content":" No IDL Required: Serialize objects directly with native language typesMulti-Language Support: Java, Python, C++, Go, Rust, JavaScript all interoperate seamlesslyReference Support: Shared and circular references work across language boundariesSchema Evolution: Forward/backward compatibility when class definitions changeZero-Copy: Out-of-band serialization for large binary dataHigh Performance: JIT compilation and optimized binary protocol  ","version":"0.15","tagName":"h2"},{"title":"Supported Languages‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/guide/xlang/#supported-languages","content":" Language\tStatus\tPackageJava\t‚úÖ\torg.apache.fory:fory-core Python\t‚úÖ\tpyfory C++\t‚úÖ\tBazel/CMake build Go\t‚úÖ\tgithub.com/apache/fory/go/fory Rust\t‚úÖ\tfory crate JavaScript\t‚úÖ\t@apache-fory/fory  ","version":"0.15","tagName":"h2"},{"title":"When to Use Xlang Mode‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/guide/xlang/#when-to-use-xlang-mode","content":" Use xlang mode when:  Building multi-language microservicesCreating polyglot data pipelinesSharing data between frontend (JavaScript) and backend (Java/Python/Go)  Use language-native mode when:  All serialization/deserialization happens in the same languageMaximum performance is required (native mode is faster)You need language-specific features (Python pickle compatibility, Java serialization hooks)  ","version":"0.15","tagName":"h2"},{"title":"Quick Example‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/guide/xlang/#quick-example","content":" ","version":"0.15","tagName":"h2"},{"title":"Java (Producer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/guide/xlang/#java-producer","content":" import org.apache.fory.*; import org.apache.fory.config.*; public class Person { public String name; public int age; } Fory fory = Fory.builder() .withLanguage(Language.XLANG) .build(); fory.register(Person.class, &quot;example.Person&quot;); Person person = new Person(); person.name = &quot;Alice&quot;; person.age = 30; byte[] bytes = fory.serialize(person); // Send bytes to Python, Go, Rust, etc.   ","version":"0.15","tagName":"h3"},{"title":"Python (Consumer)‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/guide/xlang/#python-consumer","content":" import pyfory from dataclasses import dataclass @dataclass class Person: name: str age: pyfory.Int32Type fory = pyfory.Fory(xlang=True) fory.register_type(Person, typename=&quot;example.Person&quot;) # Receive bytes from Java person = fory.deserialize(bytes_from_java) print(f&quot;{person.name}, {person.age}&quot;) # Alice, 30   ","version":"0.15","tagName":"h3"},{"title":"Fory IDL‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/guide/xlang/#fory-idl","content":" For schema-first projects, Fory also provides Fory IDL and code generation.  Compiler docs: Fory IDL OverviewBest for large multi-language message contracts and long-lived schemas  ","version":"0.15","tagName":"h2"},{"title":"Minimal IDL Example‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/guide/xlang/#minimal-idl-example","content":" Create person.fdl:  package example; message Person { string name = 1; int32 age = 2; optional string email = 3; }   Generate code:  foryc person.fdl --lang java,python,go,rust,cpp --output ./generated   This generates native language types with consistent field/type mappings across all targets.  ","version":"0.15","tagName":"h3"},{"title":"When to Fory IDL‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/guide/xlang/#when-to-fory-idl","content":" Option\tUse When\tWhyNative xlang types (no IDL)\tYou only have a few message types and want to move quickly\tAvoids the integration/setup cost of introducing and operating the compiler Fory IDL (schema-first + codegen)\tYou have many messages across multiple languages/teams/services\tProvides a single contract, stronger consistency, and easier long-term evolution Hybrid (start native, move to IDL)\tProject starts small but message count and cross-team dependency grows\tLets you keep early velocity, then standardize once schema complexity increases  ","version":"0.15","tagName":"h2"},{"title":"Documentation‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/guide/xlang/#documentation","content":" Topic\tDescriptionGetting Started\tInstallation and basic setup for all languages Type Mapping\tCross-language type mapping reference Serialization\tBuilt-in types, custom types, reference handling Zero-Copy\tOut-of-band serialization for large data Row Format\tCache-friendly binary format with random access Troubleshooting\tCommon issues and solutions  ","version":"0.15","tagName":"h2"},{"title":"Language-Specific Guides‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/guide/xlang/#language-specific-guides","content":" For language-specific details and API reference:  Java Cross-Language GuidePython Cross-Language GuideC++ Cross-Language GuideRust Cross-Language Guide  ","version":"0.15","tagName":"h2"},{"title":"Specifications‚Äã","type":1,"pageTitle":"Cross-Language Serialization Guide","url":"/docs/guide/xlang/#specifications","content":" Xlang Serialization Specification - Binary protocol detailsType Mapping Specification - Complete type mapping reference ","version":"0.15","tagName":"h2"},{"title":"Field Type Meta","type":0,"sectionRef":"#","url":"/docs/guide/xlang/field_type_meta","content":"","keywords":"","version":"0.15"},{"title":"Overview‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/guide/xlang/field_type_meta#overview","content":" When serializing a struct field, Fory needs to determine whether to write type metadata:  Static typing: Use the declared field type's serializer directly (no type info written)Dynamic typing: Write type information to support runtime subtypes  ","version":"0.15","tagName":"h2"},{"title":"When Type Meta Is Needed‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/guide/xlang/field_type_meta#when-type-meta-is-needed","content":" Type metadata is required when:  Interface/abstract fields: The declared type is abstract, so concrete type must be recordedPolymorphic fields: The runtime type may be a subclass of the declared typeCross-language compatibility: When the receiver needs type information to deserialize correctly  Type metadata is NOT needed when:  Final/concrete types: The declared type is final/sealed and cannot be subclassedPrimitive types: Type is known at compile timePerformance optimization: When you know the runtime type always matches the declared type  ","version":"0.15","tagName":"h2"},{"title":"Language-Specific Configuration‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/guide/xlang/field_type_meta#language-specific-configuration","content":" ","version":"0.15","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/guide/xlang/field_type_meta#java","content":" Java requires explicit configuration because concrete classes can be subclassed unless marked final.  Use the @ForyField annotation with the dynamic parameter:  import org.apache.fory.annotation.ForyField; import org.apache.fory.annotation.ForyField.Dynamic; public class Container { // AUTO (default): Interface types write type info, concrete types don't @ForyField(id = 0) private Shape shape; // Interface - type info written // FALSE: Never write type info (use declared type's serializer) @ForyField(id = 1, dynamic = Dynamic.FALSE) private Circle circle; // Always treated as Circle // TRUE: Always write type info (support runtime subtypes) @ForyField(id = 2, dynamic = Dynamic.TRUE) private Shape concreteShape; // Type info written even if concrete }   Dynamic Options:  Value\tBehaviorAUTO\tInterface/abstract types are dynamic, concrete are not FALSE\tNever write type info, use declared type's serializer TRUE\tAlways write type info to support runtime subtypes  Use Cases:  AUTO: Default behavior, suitable for most casesFALSE: Performance optimization when you know the exact typeTRUE: When a concrete field may hold subclass instances  ","version":"0.15","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/guide/xlang/field_type_meta#c","content":" C++ uses the fory::dynamic&lt;V&gt; template tag or .dynamic(bool) builder method:  Using fory::field&lt;&gt; template:  #include &quot;fory/serialization/fory.h&quot; // Abstract base class with pure virtual methods struct Animal { virtual ~Animal() = default; virtual std::string speak() const = 0; }; struct Zoo { // Auto: type info written because Animal is polymorphic (std::is_polymorphic) fory::field&lt;std::shared_ptr&lt;Animal&gt;, 0, fory::nullable&gt; animal; // Force non-dynamic: skip type info even though Animal is polymorphic fory::field&lt;std::shared_ptr&lt;Animal&gt;, 1, fory::nullable, fory::dynamic&lt;false&gt;&gt; fixed_animal; // Force dynamic: write type info even for non-polymorphic types fory::field&lt;std::shared_ptr&lt;Data&gt;, 2, fory::dynamic&lt;true&gt;&gt; polymorphic_data; }; FORY_STRUCT(Zoo, animal, fixed_animal, polymorphic_data);   Using FORY_FIELD_CONFIG macro:  struct Zoo { std::shared_ptr&lt;Animal&gt; animal; std::shared_ptr&lt;Animal&gt; fixed_animal; std::shared_ptr&lt;Data&gt; polymorphic_data; }; FORY_STRUCT(Zoo, animal, fixed_animal, polymorphic_data); FORY_FIELD_CONFIG(Zoo, (animal, fory::F(0).nullable()), // Auto-detect polymorphism (fixed_animal, fory::F(1).nullable().dynamic(false)), // Skip type info (polymorphic_data, fory::F(2).dynamic(true)) // Force type info );   Default Behavior: Fory auto-detects polymorphism via std::is_polymorphic&lt;T&gt;. Types with pure virtual methods are treated as dynamic by default.  ","version":"0.15","tagName":"h3"},{"title":"Go and Rust‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/guide/xlang/field_type_meta#go-and-rust","content":" Go and Rust do not require explicit dynamic configuration because:  Go: Interface types are inherently dynamic - Fory can determine from the type whether it's an interfaceRust: Trait objects (dyn Trait) are explicitly marked in the type system  The type system in these languages already indicates whether a field is polymorphic:  // Go: interface types are automatically dynamic type Container struct { Shape Shape // Interface - type info written automatically Circle Circle // Concrete struct - no type info needed }   // Rust: trait objects are explicitly marked struct Container { shape: Box&lt;dyn Shape&gt;, // Trait object - type info written automatically circle: Circle, // Concrete type - no type info needed }   ","version":"0.15","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/guide/xlang/field_type_meta#python","content":" Use pyfory.field() with the dynamic parameter:  from dataclasses import dataclass from abc import ABC, abstractmethod import pyfory class Shape(ABC): @abstractmethod def area(self) -&gt; float: pass @dataclass class Circle(Shape): radius: float = 0.0 def area(self) -&gt; float: return 3.14159 * self.radius * self.radius @dataclass class Container: # Abstract class: dynamic is always True (type info written) shape: Shape = pyfory.field(id=0) # Concrete type with explicit dynamic=True (force type info) circle: Circle = pyfory.field(id=1, dynamic=True) # Concrete type with explicit dynamic=False (skip type info) fixed_circle: Circle = pyfory.field(id=2, dynamic=False)   Default Behavior:  Mode\tAbstract Class\tConcrete Object Types\tNumeric/str/time TypesNative mode\tTrue\tTrue\tFalse Xlang mode\tTrue\tFalse\tFalse  Abstract classes: dynamic is always True (type info must be written)Native mode: dynamic defaults to True for object types, False for numeric/str/time typesXlang mode: dynamic defaults to False for concrete types  ","version":"0.15","tagName":"h3"},{"title":"Default Behavior‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/guide/xlang/field_type_meta#default-behavior","content":" Language\tInterface/Abstract Types\tConcrete TypesJava\tDynamic (write type)\tStatic (no type) C++\tDynamic (virtual)\tStatic Go\tDynamic (interface)\tStatic (struct) Rust\tDynamic (dyn Trait)\tStatic Python\tDynamic (all objects)\tDynamic  ","version":"0.15","tagName":"h2"},{"title":"Performance Considerations‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/guide/xlang/field_type_meta#performance-considerations","content":" Writing type metadata has overhead:  Space: Type information adds bytes to serialized outputTime: Type resolution during serialization/deserialization  Use dynamic = FALSE (Java) or dynamic(false) (C++) when:  You're certain the runtime type matches the declared typePerformance is critical and polymorphism is not neededThe field type is effectively final  ","version":"0.15","tagName":"h2"},{"title":"Cross-Language Compatibility‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/guide/xlang/field_type_meta#cross-language-compatibility","content":" When serializing data for cross-language consumption:  Use consistent type registration: Register types with the same ID across languagesPrefer explicit configuration: Use dynamic = TRUE when unsure about receiver's expectationsDocument polymorphic fields: Make it clear which fields may contain subtypes  ","version":"0.15","tagName":"h2"},{"title":"Example: Polymorphic Container‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/guide/xlang/field_type_meta#example-polymorphic-container","content":" ","version":"0.15","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/guide/xlang/field_type_meta#java-1","content":" public interface Animal { String speak(); } public class Dog implements Animal { private String name; @Override public String speak() { return &quot;Woof!&quot;; } } public class Cat implements Animal { private String name; @Override public String speak() { return &quot;Meow!&quot;; } } public class Zoo { // Type info written because Animal is an interface @ForyField(id = 0) private Animal animal; // Force type info for concrete type that may hold subtypes @ForyField(id = 1, dynamic = Dynamic.TRUE) private Dog maybeMixedBreed; }   ","version":"0.15","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/guide/xlang/field_type_meta#c-1","content":" // Abstract base class with pure virtual methods class Animal { public: virtual std::string speak() const = 0; virtual ~Animal() = default; }; class Dog : public Animal { public: std::string name; std::string speak() const override { return &quot;Woof!&quot;; } }; struct Zoo { std::shared_ptr&lt;Animal&gt; animal; std::shared_ptr&lt;Dog&gt; maybe_mixed_breed; }; FORY_STRUCT(Zoo, animal, maybe_mixed_breed); FORY_FIELD_CONFIG(Zoo, (animal, fory::F(0).nullable()), // Auto-detect (Animal is polymorphic) (maybe_mixed_breed, fory::F(1).dynamic(true)) // Force dynamic for concrete type );   ","version":"0.15","tagName":"h3"},{"title":"Related Topics‚Äã","type":1,"pageTitle":"Field Type Meta","url":"/docs/guide/xlang/field_type_meta#related-topics","content":" Field Nullability - Controlling null handling for fieldsField Reference Tracking - Managing shared/circular referencesType Mapping - Cross-language type compatibility ","version":"0.15","tagName":"h2"},{"title":"Field Nullability","type":0,"sectionRef":"#","url":"/docs/guide/xlang/field_nullability","content":"","keywords":"","version":"0.15"},{"title":"Default Behavior‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/guide/xlang/field_nullability#default-behavior","content":" In xlang mode, fields are non-nullable by default. This means:  Values must always be present (non-null)No null flag byte is written for the fieldSerialization is more compact  The following types are nullable by default:  Optional&lt;T&gt; (Java, C++)Java boxed types (Integer, Long, Double, etc.)Go pointer types (*int32, *string, etc.)Rust Option&lt;T&gt;Python Optional[T]  Field Type\tDefault Nullable\tNull Flag WrittenPrimitives (int, bool, float, etc.)\tNo\tNo String\tNo\tNo List&lt;T&gt;, Map&lt;K,V&gt;, Set&lt;T&gt;\tNo\tNo Custom structs\tNo\tNo Enums\tNo\tNo Java boxed types (Integer, Long, etc.)\tYes\tYes Go pointer types (*int32, *string)\tYes\tYes Optional&lt;T&gt; / Option&lt;T&gt;\tYes\tYes  ","version":"0.15","tagName":"h2"},{"title":"Wire Format‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/guide/xlang/field_nullability#wire-format","content":" The nullable flag controls whether a null flag byte is written before the field value:  Non-nullable field: [value data] Nullable field: [null_flag] [value data if not null]   Where null_flag is:  -1 (NULL_FLAG): Value is null-2 (NOT_NULL_VALUE_FLAG): Value is present  ","version":"0.15","tagName":"h2"},{"title":"Nullable vs Reference Tracking‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/guide/xlang/field_nullability#nullable-vs-reference-tracking","content":" These are related but distinct concepts:  Concept\tPurpose\tFlag ValuesNullable\tAllow null values for a field\t-1 (null), -2 (not null) Reference Tracking\tDeduplicate shared object references\t-1 (null), -2 (not null), ‚â•0 (ref ID)  Key differences:  Nullable only: Writes -1 or -2 flag, no reference deduplicationReference tracking: Extends nullable semantics with reference IDs (‚â•0) for previously seen objectsBoth use the same flag byte position‚Äîref tracking is a superset of nullable  When refTracking=true, the null flag byte doubles as a ref flag:  ref_flag = -1 ‚Üí null value ref_flag = -2 ‚Üí new object (first occurrence) ref_flag &gt;= 0 ‚Üí reference to object at index ref_flag   For detailed reference tracking behavior, see Reference Tracking.  ","version":"0.15","tagName":"h2"},{"title":"Language-Specific Examples‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/guide/xlang/field_nullability#language-specific-examples","content":" ","version":"0.15","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/guide/xlang/field_nullability#java","content":" public class Person { // Non-nullable by default in xlang mode String name; // Must not be null int age; // Primitive, always non-nullable List&lt;String&gt; tags; // Must not be null // Explicitly nullable @ForyField(nullable = true) String nickname; // Can be null // Optional wrapper - nullable by default Optional&lt;String&gt; bio; // Can be empty/null } Fory fory = Fory.builder() .withLanguage(Language.XLANG) .build(); fory.register(Person.class, &quot;example.Person&quot;);   ","version":"0.15","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/guide/xlang/field_nullability#python","content":" from dataclasses import dataclass from typing import Optional, List import pyfory @dataclass class Person: # Non-nullable by default name: str # Must have a value age: pyfory.int32 # Primitive tags: List[str] # Must not be None # Optional makes it nullable nickname: Optional[str] = None # Can be None bio: Optional[str] = None # Can be None fory = pyfory.Fory(xlang=True) fory.register_type(Person, typename=&quot;example.Person&quot;)   ","version":"0.15","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/guide/xlang/field_nullability#rust","content":" use fory::{Fory, ForyObject}; #[derive(ForyObject)] struct Person { // Non-nullable by default name: String, age: i32, tags: Vec&lt;String&gt;, // Option&lt;T&gt; is nullable nickname: Option&lt;String&gt;, // Can be None bio: Option&lt;String&gt;, // Can be None }   ","version":"0.15","tagName":"h3"},{"title":"Go‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/guide/xlang/field_nullability#go","content":" type Person struct { // Non-nullable by default Name string Age int32 Tags []string // Pointer types for nullable fields Nickname *string // Can be nil Bio *string // Can be nil } fory := forygo.NewFory(forygo.WithXlang(true)) fory.RegisterNamedStruct(Person{}, &quot;example.Person&quot;)   ","version":"0.15","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/guide/xlang/field_nullability#c","content":" struct Person { // Non-nullable by default std::string name; int32_t age; std::vector&lt;std::string&gt; tags; // std::optional for nullable std::optional&lt;std::string&gt; nickname; std::optional&lt;std::string&gt; bio; }; FORY_STRUCT(Person, name, age, tags, nickname, bio);   ","version":"0.15","tagName":"h3"},{"title":"Customizing Nullability‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/guide/xlang/field_nullability#customizing-nullability","content":" ","version":"0.15","tagName":"h2"},{"title":"Java: @ForyField Annotation‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/guide/xlang/field_nullability#java-foryfield-annotation","content":" public class Config { @ForyField(nullable = true) String optionalSetting; // Explicitly nullable @ForyField(nullable = false) String requiredSetting; // Explicitly non-nullable (default) }   ","version":"0.15","tagName":"h3"},{"title":"C++: fory::field Wrapper‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/guide/xlang/field_nullability#c-foryfield-wrapper","content":" struct Config { // Explicitly mark as nullable fory::field&lt;std::string, 1, fory::nullable&lt;true&gt;&gt; optional_setting; // Explicitly mark as non-nullable (default) fory::field&lt;std::string, 2, fory::nullable&lt;false&gt;&gt; required_setting; }; FORY_STRUCT(Config, optional_setting, required_setting);   ","version":"0.15","tagName":"h3"},{"title":"Null Value Handling‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/guide/xlang/field_nullability#null-value-handling","content":" When a non-nullable field receives a null value:  Language\tBehaviorJava\tThrows NullPointerException or serialization error Python\tRaises TypeError or serialization error Rust\tCompile-time error (non-Option types can't be None) Go\tZero value is used (empty string, 0, etc.) C++\tDefault-constructed value or undefined behavior  ","version":"0.15","tagName":"h2"},{"title":"Schema Compatibility‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/guide/xlang/field_nullability#schema-compatibility","content":" The nullable flag is part of the struct schema fingerprint. Changing a field's nullability is a breaking change that will cause schema version mismatch errors.  Schema A: { name: String (non-nullable) } Schema B: { name: String (nullable) } // These have different fingerprints and are incompatible   ","version":"0.15","tagName":"h2"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/guide/xlang/field_nullability#best-practices","content":" Use non-nullable by default: Only make fields nullable when null is a valid semantic valueUse Optional/Option wrappers: Instead of raw types with nullable annotationBe consistent across languages: Use the same nullability for corresponding fieldsDocument nullable fields: Make it clear which fields can be null in your API  ","version":"0.15","tagName":"h2"},{"title":"See Also‚Äã","type":1,"pageTitle":"Field Nullability","url":"/docs/guide/xlang/field_nullability#see-also","content":" Reference Tracking - Shared and circular reference handlingSerialization - Basic cross-language serializationType Mapping - Cross-language type mapping referenceXlang Specification - Binary protocol details ","version":"0.15","tagName":"h2"},{"title":"Reference Tracking","type":0,"sectionRef":"#","url":"/docs/guide/xlang/reference_tracking","content":"","keywords":"","version":"0.15"},{"title":"Overview‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/guide/xlang/reference_tracking#overview","content":" Reference tracking enables:  Shared references: Same object referenced multiple times is serialized onceCircular references: Objects that reference themselves or form cyclesMemory efficiency: No duplicate data for repeated objects  ","version":"0.15","tagName":"h2"},{"title":"Enabling Reference Tracking‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/guide/xlang/reference_tracking#enabling-reference-tracking","content":" ","version":"0.15","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/guide/xlang/reference_tracking#java","content":" Fory fory = Fory.builder() .withLanguage(Language.XLANG) .withRefTracking(true) .build();   ","version":"0.15","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/guide/xlang/reference_tracking#python","content":" fory = pyfory.Fory(xlang=True, ref=True)   ","version":"0.15","tagName":"h3"},{"title":"Go‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/guide/xlang/reference_tracking#go","content":" fory := forygo.NewFory( forygo.WithXlang(true), forygo.WithTrackRef(true), )   ","version":"0.15","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/guide/xlang/reference_tracking#c","content":" auto fory = fory::Fory::builder().xlang(true).track_ref(true).build();   ","version":"0.15","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/guide/xlang/reference_tracking#rust","content":" let fory = Fory::default() .xlang(true) .track_ref(true);   ","version":"0.15","tagName":"h3"},{"title":"Wire Format‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/guide/xlang/reference_tracking#wire-format","content":" When reference tracking is enabled, nullable fields write a ref flag byte before the value:  [ref_flag] [value data if not null/ref]   Where ref_flag is:  Value\tMeaning-1 (NULL_FLAG)\tValue is null -2 (NOT_NULL_VALUE_FLAG)\tValue is present, first occurrence ‚â•0\tReference ID pointing to previously serialized object  ","version":"0.15","tagName":"h2"},{"title":"Reference Tracking vs Nullability‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/guide/xlang/reference_tracking#reference-tracking-vs-nullability","content":" These are independent concepts:  Concept\tPurpose\tControlled ByNullability\tWhether a field can hold null values\tField type (Optional&lt;T&gt;) or annotation Reference Tracking\tWhether duplicate objects are deduplicated\tGlobal refTracking option  Key behavior:  Ref flag bytes are only written for nullable fieldsNon-nullable fields skip ref flags entirely, even with refTracking=trueReference deduplication only applies to objects that appear multiple times  // Reference tracking enabled, but non-nullable fields still skip ref flags Fory fory = Fory.builder() .withLanguage(Language.XLANG) .withRefTracking(true) .build();   ","version":"0.15","tagName":"h2"},{"title":"Per-Field Reference Tracking‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/guide/xlang/reference_tracking#per-field-reference-tracking","content":" By default, most fields do not track references even when global refTracking=true. Only specific pointer/smart pointer types track references by default.  ","version":"0.15","tagName":"h2"},{"title":"Default Behavior by Language‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/guide/xlang/reference_tracking#default-behavior-by-language","content":" Language\tDefault Ref Tracking\tTypes That Track Refs by DefaultJava\tNo\tNone (use annotation to enable) Python\tNo\tNone (use annotation to enable) Go\tNo\tNone (use fory:&quot;ref&quot; to enable) C++\tYes\tstd::shared_ptr&lt;T&gt;, fory::serialization::SharedWeak&lt;T&gt; Rust\tNo\tRc&lt;T&gt;, Arc&lt;T&gt;, Weak&lt;T&gt;  ","version":"0.15","tagName":"h3"},{"title":"Customizing Per-Field Ref Tracking‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/guide/xlang/reference_tracking#customizing-per-field-ref-tracking","content":" Java: @ForyField Annotation‚Äã  public class Document { // Default: no ref tracking String title; // Enable ref tracking for this field @ForyField(trackingRef = true) Author author; // Shared across documents, track refs to avoid duplicates @ForyField(trackingRef = true) List&lt;Tag&gt; tags; }   C++: fory::field Wrapper‚Äã  struct Document { std::string title; // shared_ptr/SharedWeak track refs by default std::shared_ptr&lt;Author&gt; author; fory::serialization::SharedWeak&lt;Data&gt; data; // Explicitly mark ref tracking when using field wrappers (optional) fory::field&lt;std::shared_ptr&lt;Tag&gt;, 1, fory::ref&gt; tag_owner; }; FORY_STRUCT(Document, title, author, data, tag_owner);   To disable reference tracking for C++ entirely, setFory::builder().track_ref(false) on the serializer.  Rust: Field Attributes‚Äã  use fory::ForyObject; use std::rc::Rc; #[derive(ForyObject)] struct Document { title: String, // Rc/Arc track refs by default author: Rc&lt;Author&gt;, // Explicitly enable ref tracking #[fory(ref = true)] tags: Vec&lt;Tag&gt;, }   Go: Struct Tags‚Äã  type Document struct { Title string // Enable ref tracking for pointer to struct Author *Author `fory:&quot;ref&quot;` // Enable ref tracking for slice Tags []Tag `fory:&quot;ref&quot;` }   ","version":"0.15","tagName":"h3"},{"title":"When to Enable Per-Field Ref Tracking‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/guide/xlang/reference_tracking#when-to-enable-per-field-ref-tracking","content":" Enable ref tracking for fields that:  May contain the same object instance multiple timesAre part of circular reference chainsHold large objects that might be shared  Disable (or leave default) for fields that:  Always contain unique valuesAre primitives or simple value typesDon't participate in object sharing  ","version":"0.15","tagName":"h3"},{"title":"Example: Shared References‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/guide/xlang/reference_tracking#example-shared-references","content":" public class Container { List&lt;String&gt; data; List&lt;String&gt; sameData; // Points to same list } Container obj = new Container(); obj.data = Arrays.asList(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;); obj.sameData = obj.data; // Shared reference // With refTracking=true: data serialized once, sameData stores reference ID // With refTracking=false: data serialized twice (duplicate)   ","version":"0.15","tagName":"h2"},{"title":"Example: Circular References‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/guide/xlang/reference_tracking#example-circular-references","content":" public class Node { String value; Node next; } Node a = new Node(&quot;A&quot;); Node b = new Node(&quot;B&quot;); a.next = b; b.next = a; // Circular reference // With refTracking=true: works correctly // With refTracking=false: infinite recursion error   ","version":"0.15","tagName":"h2"},{"title":"Language Support‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/guide/xlang/reference_tracking#language-support","content":" Language\tShared Refs\tCircular RefsJava\tYes\tYes Python\tYes\tYes Go\tYes\tYes C++\tYes\tYes JavaScript\tYes\tYes Rust\tYes\tNo (ownership rules)  ","version":"0.15","tagName":"h2"},{"title":"Performance Considerations‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/guide/xlang/reference_tracking#performance-considerations","content":" Overhead: Reference tracking adds a hash map lookup per objectWhen to enable: Use when data has shared/circular referencesWhen to disable: Use for simple data structures without sharing  ","version":"0.15","tagName":"h2"},{"title":"See Also‚Äã","type":1,"pageTitle":"Reference Tracking","url":"/docs/guide/xlang/reference_tracking#see-also","content":" Field Nullability - How nullability affects serializationSerialization - Basic cross-language serialization examplesXlang Specification - Binary protocol details ","version":"0.15","tagName":"h2"},{"title":"Getting Started","type":0,"sectionRef":"#","url":"/docs/guide/xlang/getting_started","content":"","keywords":"","version":"0.15"},{"title":"Installation‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/guide/xlang/getting_started#installation","content":" ","version":"0.15","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/guide/xlang/getting_started#java","content":" Maven:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-core&lt;/artifactId&gt; &lt;version&gt;0.15.0&lt;/version&gt; &lt;/dependency&gt;   Gradle:  implementation 'org.apache.fory:fory-core:0.15.0'   ","version":"0.15","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/guide/xlang/getting_started#python","content":" pip install pyfory   ","version":"0.15","tagName":"h3"},{"title":"Go‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/guide/xlang/getting_started#go","content":" go get github.com/apache/fory/go/fory   ","version":"0.15","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/guide/xlang/getting_started#rust","content":" [dependencies] fory = &quot;0.13&quot;   ","version":"0.15","tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/guide/xlang/getting_started#javascript","content":" npm install @apache-fory/fory   ","version":"0.15","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/guide/xlang/getting_started#c","content":" Use Bazel or CMake to build from source. See C++ Guide for details.  ","version":"0.15","tagName":"h3"},{"title":"Enable Cross-Language Mode‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/guide/xlang/getting_started#enable-cross-language-mode","content":" Each language requires enabling xlang mode to ensure binary compatibility across languages.  ","version":"0.15","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/guide/xlang/getting_started#java-1","content":" import org.apache.fory.*; import org.apache.fory.config.*; Fory fory = Fory.builder() .withLanguage(Language.XLANG) // Enable cross-language mode .withRefTracking(true) // Optional: for circular references .build();   ","version":"0.15","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/guide/xlang/getting_started#python-1","content":" import pyfory # Cross-language mode must be enabled explicitly fory = pyfory.Fory(xlang=True) # Enable reference tracking when needed fory = pyfory.Fory(xlang=True, ref=True)   ","version":"0.15","tagName":"h3"},{"title":"Go‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/guide/xlang/getting_started#go-1","content":" import forygo &quot;github.com/apache/fory/go/fory&quot; fory := forygo.NewFory(forygo.WithXlang(true)) // Or with reference tracking fory := forygo.NewFory(forygo.WithXlang(true), forygo.WithTrackRef(true))   ","version":"0.15","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/guide/xlang/getting_started#rust-1","content":" use fory::Fory; let fory = Fory::default().xlang(true);   ","version":"0.15","tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/guide/xlang/getting_started#javascript-1","content":" import Fory from &quot;@apache-fory/fory&quot;; const fory = new Fory();   ","version":"0.15","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/guide/xlang/getting_started#c-1","content":" #include &quot;fory/serialization/fory.h&quot; using namespace fory::serialization; auto fory = Fory::builder() .xlang(true) .build();   ","version":"0.15","tagName":"h3"},{"title":"Type Registration‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/guide/xlang/getting_started#type-registration","content":" Custom types must be registered with consistent names or IDs across all languages.  ","version":"0.15","tagName":"h2"},{"title":"Register by Name (Recommended)‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/guide/xlang/getting_started#register-by-name-recommended","content":" Using string names is more flexible and less prone to conflicts:  Java:  fory.register(Person.class, &quot;example.Person&quot;);   Python:  fory.register_type(Person, typename=&quot;example.Person&quot;)   Go:  fory.RegisterNamedStruct(Person{}, &quot;example.Person&quot;)   Rust:  use fory::{Fory, ForyObject}; #[derive(ForyObject)] struct Person { name: String, age: i32, } let mut fory = Fory::default().xlang(true); fory .register_by_namespace::&lt;Person&gt;(&quot;example&quot;, &quot;Person&quot;) .expect(&quot;register Person&quot;);   JavaScript:  const description = Type.object(&quot;example.Person&quot;, { name: Type.string(), age: Type.int32(), }); fory.registerSerializer(description);   C++:  fory.register_struct&lt;Person&gt;(&quot;example.Person&quot;); // For enums, use register_enum: // fory.register_enum&lt;Color&gt;(&quot;example.Color&quot;);   ","version":"0.15","tagName":"h3"},{"title":"Register by ID‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/guide/xlang/getting_started#register-by-id","content":" Using numeric IDs is faster and produces smaller binary output:  Java:  fory.register(Person.class, 100);   Python:  fory.register_type(Person, type_id=100)   Go:  fory.RegisterStruct(Person{}, 100)   C++:  fory.register_struct&lt;Person&gt;(100); // For enums, use register_enum: // fory.register_enum&lt;Color&gt;(101);   ","version":"0.15","tagName":"h3"},{"title":"Hello World Example‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/guide/xlang/getting_started#hello-world-example","content":" A complete example showing serialization in Java and deserialization in Python:  ","version":"0.15","tagName":"h2"},{"title":"Java (Serializer)‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/guide/xlang/getting_started#java-serializer","content":" import org.apache.fory.*; import org.apache.fory.config.*; import java.nio.file.*; public class Person { public String name; public int age; } public class HelloWorld { public static void main(String[] args) throws Exception { Fory fory = Fory.builder() .withLanguage(Language.XLANG) .build(); fory.register(Person.class, &quot;example.Person&quot;); Person person = new Person(); person.name = &quot;Alice&quot;; person.age = 30; byte[] bytes = fory.serialize(person); Files.write(Path.of(&quot;person.bin&quot;), bytes); System.out.println(&quot;Serialized to person.bin&quot;); } }   ","version":"0.15","tagName":"h3"},{"title":"Python (Deserializer)‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/guide/xlang/getting_started#python-deserializer","content":" import pyfory from dataclasses import dataclass @dataclass class Person: name: str age: pyfory.Int32Type fory = pyfory.Fory(xlang=True) fory.register_type(Person, typename=&quot;example.Person&quot;) with open(&quot;person.bin&quot;, &quot;rb&quot;) as f: data = f.read() person = fory.deserialize(data) print(f&quot;Name: {person.name}, Age: {person.age}&quot;) # Output: Name: Alice, Age: 30   ","version":"0.15","tagName":"h3"},{"title":"Best Practices‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/guide/xlang/getting_started#best-practices","content":" Use consistent type names: Ensure all languages use the same type name or IDEnable reference tracking: If your data has circular or shared referencesReuse Fory instances: Creating Fory is expensive; reuse instancesUse type annotations: In Python, use pyfory.Int32Type etc. for precise type mappingTest cross-language: Verify serialization works across all target languages  ","version":"0.15","tagName":"h2"},{"title":"Next Steps‚Äã","type":1,"pageTitle":"Getting Started","url":"/docs/guide/xlang/getting_started#next-steps","content":" Type Mapping - Cross-language type mapping referenceSerialization - Detailed serialization examplesTroubleshooting - Common issues and solutions ","version":"0.15","tagName":"h2"},{"title":"Row Format","type":0,"sectionRef":"#","url":"/docs/guide/xlang/row_format","content":"","keywords":"","version":"0.15"},{"title":"Features‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/xlang/row_format#features","content":" Zero-Copy Random Access: Read specific fields directly from binary dataPartial Serialization: Skip unnecessary fields during serializationCross-Language Compatible: Row format data can be shared between Java, Python, and C++Apache Arrow Integration: Convert row format to/from Arrow RecordBatch for analytics (Java/Python)  ","version":"0.15","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/xlang/row_format#java","content":" public class Bar { String f1; List&lt;Long&gt; f2; } public class Foo { int f1; List&lt;Integer&gt; f2; Map&lt;String, Integer&gt; f3; List&lt;Bar&gt; f4; } RowEncoder&lt;Foo&gt; encoder = Encoders.bean(Foo.class); Foo foo = new Foo(); foo.f1 = 10; foo.f2 = IntStream.range(0, 1000000).boxed().collect(Collectors.toList()); foo.f3 = IntStream.range(0, 1000000).boxed().collect(Collectors.toMap(i -&gt; &quot;k&quot;+i, i-&gt;i)); List&lt;Bar&gt; bars = new ArrayList&lt;&gt;(1000000); for (int i = 0; i &lt; 1000000; i++) { Bar bar = new Bar(); bar.f1 = &quot;s&quot;+i; bar.f2 = LongStream.range(0, 10).boxed().collect(Collectors.toList()); bars.add(bar); } foo.f4 = bars; // Can be zero-copy read by Python BinaryRow binaryRow = encoder.toRow(foo); // Can be data from Python Foo newFoo = encoder.fromRow(binaryRow); // Zero-copy read List&lt;Integer&gt; f2 BinaryArray binaryArray2 = binaryRow.getArray(1); // Zero-copy read List&lt;Bar&gt; f4 BinaryArray binaryArray4 = binaryRow.getArray(3); // Zero-copy read 11th element of List&lt;Bar&gt; f4 BinaryRow barStruct = binaryArray4.getStruct(10); // Zero-copy read 6th element of f2 of 11th element of List&lt;Bar&gt; f4 barStruct.getArray(1).getInt64(5); RowEncoder&lt;Bar&gt; barEncoder = Encoders.bean(Bar.class); // Deserialize part of data Bar newBar = barEncoder.fromRow(barStruct); Bar newBar2 = barEncoder.fromRow(binaryArray4.getStruct(20));   ","version":"0.15","tagName":"h2"},{"title":"Python‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/xlang/row_format#python","content":" @dataclass class Bar: f1: str f2: List[pa.int64] @dataclass class Foo: f1: pa.int32 f2: List[pa.int32] f3: Dict[str, pa.int32] f4: List[Bar] encoder = pyfory.encoder(Foo) foo = Foo(f1=10, f2=list(range(1000_000)), f3={f&quot;k{i}&quot;: i for i in range(1000_000)}, f4=[Bar(f1=f&quot;s{i}&quot;, f2=list(range(10))) for i in range(1000_000)]) binary: bytes = encoder.to_row(foo).to_bytes() print(f&quot;start: {datetime.datetime.now()}&quot;) foo_row = pyfory.RowData(encoder.schema, binary) print(foo_row.f2[100000], foo_row.f4[100000].f1, foo_row.f4[200000].f2[5]) print(f&quot;end: {datetime.datetime.now()}&quot;) binary = pickle.dumps(foo) print(f&quot;pickle start: {datetime.datetime.now()}&quot;) new_foo = pickle.loads(binary) print(new_foo.f2[100000], new_foo.f4[100000].f1, new_foo.f4[200000].f2[5]) print(f&quot;pickle end: {datetime.datetime.now()}&quot;)   ","version":"0.15","tagName":"h2"},{"title":"Apache Arrow Support‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/xlang/row_format#apache-arrow-support","content":" Fory Row Format supports automatic conversion from/to Arrow Table/RecordBatch for analytics workloads.  ","version":"0.15","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/xlang/row_format#java-1","content":" Schema schema = TypeInference.inferSchema(BeanA.class); ArrowWriter arrowWriter = ArrowUtils.createArrowWriter(schema); Encoder&lt;BeanA&gt; encoder = Encoders.rowEncoder(BeanA.class); for (int i = 0; i &lt; 10; i++) { BeanA beanA = BeanA.createBeanA(2); arrowWriter.write(encoder.toRow(beanA)); } return arrowWriter.finishAsRecordBatch();   ","version":"0.15","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/xlang/row_format#python-1","content":" import pyfory encoder = pyfory.encoder(Foo) encoder.to_arrow_record_batch([foo] * 10000) encoder.to_arrow_table([foo] * 10000)   ","version":"0.15","tagName":"h3"},{"title":"Support for Interface and Extension Types‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/xlang/row_format#support-for-interface-and-extension-types","content":" Fory supports row format mapping for Java interface types and subclassed (extends) types, enabling more dynamic and flexible data schemas.  These enhancements were introduced in #2243, #2250, and #2256.  ","version":"0.15","tagName":"h2"},{"title":"Example: Interface Mapping with RowEncoder‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/xlang/row_format#example-interface-mapping-with-rowencoder","content":" public interface Animal { String speak(); } public class Dog implements Animal { public String name; @Override public String speak() { return &quot;Woof&quot;; } } // Encode and decode using RowEncoder with interface type RowEncoder&lt;Animal&gt; encoder = Encoders.bean(Animal.class); Dog dog = new Dog(); dog.name = &quot;Bingo&quot;; BinaryRow row = encoder.toRow(dog); Animal decoded = encoder.fromRow(row); System.out.println(decoded.speak()); // Woof   ","version":"0.15","tagName":"h3"},{"title":"Example: Extension Type with RowEncoder‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/xlang/row_format#example-extension-type-with-rowencoder","content":" public class Parent { public String parentField; } public class Child extends Parent { public String childField; } // Encode and decode using RowEncoder with parent class type RowEncoder&lt;Parent&gt; encoder = Encoders.bean(Parent.class); Child child = new Child(); child.parentField = &quot;Hello&quot;; child.childField = &quot;World&quot;; BinaryRow row = encoder.toRow(child); Parent decoded = encoder.fromRow(row);   ","version":"0.15","tagName":"h3"},{"title":"See Also‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/guide/xlang/row_format#see-also","content":" Row Format Specification - Binary format detailsJava Row Format Guide - Java-specific row format documentationPython Row Format Guide - Python-specific row format documentation ","version":"0.15","tagName":"h2"},{"title":"Troubleshooting","type":0,"sectionRef":"#","url":"/docs/guide/xlang/troubleshooting","content":"","keywords":"","version":"0.15"},{"title":"Type Registration Errors‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/xlang/troubleshooting#type-registration-errors","content":" ","version":"0.15","tagName":"h2"},{"title":"\"Type not registered\" Error‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/xlang/troubleshooting#type-not-registered-error","content":" Symptom:  Error: Type 'example.Person' is not registered   Cause: The type was not registered before deserialization, or the type name doesn't match.  Solution:  Ensure the type is registered with the same name on both sides: // Java fory.register(Person.class, &quot;example.Person&quot;); # Python fory.register_type(Person, typename=&quot;example.Person&quot;) Check for typos or case differences in type names Register types before any serialization/deserialization calls  ","version":"0.15","tagName":"h3"},{"title":"\"Type ID mismatch\" Error‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/xlang/troubleshooting#type-id-mismatch-error","content":" Symptom:  Error: Expected type ID 100, got 101   Cause: Different type IDs used across languages.  Solution: Use consistent type IDs:  // Java fory.register(Person.class, 100); fory.register(Address.class, 101);   # Python fory.register_type(Person, type_id=100) fory.register_type(Address, type_id=101)   ","version":"0.15","tagName":"h3"},{"title":"Type Mapping Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/xlang/troubleshooting#type-mapping-issues","content":" ","version":"0.15","tagName":"h2"},{"title":"Integer Overflow‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/xlang/troubleshooting#integer-overflow","content":" Symptom: Values are truncated or wrapped unexpectedly.  Cause: Using different integer sizes across languages.  Solution:  In Python, use explicit type annotations: @dataclass class Data: value: pyfory.Int32Type # Not just 'int' Ensure integer ranges are compatible: int8: -128 to 127int16: -32,768 to 32,767int32: -2,147,483,648 to 2,147,483,647  ","version":"0.15","tagName":"h3"},{"title":"Float Precision Loss‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/xlang/troubleshooting#float-precision-loss","content":" Symptom: Float values have unexpected precision.  Cause: Mixing float32 and float64 types.  Solution:  Use consistent float types: @dataclass class Data: value: pyfory.Float32Type # Explicit 32-bit float Be aware that Python's float maps to float64 by default  ","version":"0.15","tagName":"h3"},{"title":"String Encoding Errors‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/xlang/troubleshooting#string-encoding-errors","content":" Symptom:  Error: Invalid UTF-8 sequence   Cause: Non-UTF-8 encoded strings.  Solution:  Ensure all strings are valid UTF-8 In Python, decode bytes before serialization: text = raw_bytes.decode('utf-8')   ","version":"0.15","tagName":"h3"},{"title":"Field Order Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/xlang/troubleshooting#field-order-issues","content":" ","version":"0.15","tagName":"h2"},{"title":"\"Field mismatch\" Error‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/xlang/troubleshooting#field-mismatch-error","content":" Symptom: Deserialized objects have wrong field values.  Cause: Field order differs between languages.  Solution: Fory sorts fields by their snake_cased names. Ensure field names are consistent:  // Java - fields will be sorted: age, email, name public class Person { public String name; public int age; public String email; }   # Python - same field order @dataclass class Person: name: str age: pyfory.Int32Type email: str   ","version":"0.15","tagName":"h3"},{"title":"Reference Tracking Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/xlang/troubleshooting#reference-tracking-issues","content":" ","version":"0.15","tagName":"h2"},{"title":"Stack Overflow with Circular References‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/xlang/troubleshooting#stack-overflow-with-circular-references","content":" Symptom:  StackOverflowError or RecursionError   Cause: Reference tracking is disabled but data has circular references.  Solution: Enable reference tracking:  // Java Fory fory = Fory.builder() .withLanguage(Language.XLANG) .withRefTracking(true) .build();   # Python fory = pyfory.Fory(xlang=True, ref=True)   ","version":"0.15","tagName":"h3"},{"title":"Duplicate Objects‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/xlang/troubleshooting#duplicate-objects","content":" Symptom: Shared objects are duplicated after deserialization.  Cause: Reference tracking is disabled.  Solution: Enable reference tracking if objects are shared within the graph.  ","version":"0.15","tagName":"h3"},{"title":"Language Mode Issues‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/xlang/troubleshooting#language-mode-issues","content":" ","version":"0.15","tagName":"h2"},{"title":"Incompatible Types in Xlang Mode‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/xlang/troubleshooting#incompatible-types-in-xlang-mode","content":" Symptom:  Error: Type 'Optional' is not supported in xlang mode   Cause: Using Java-specific types that don't have cross-language equivalents.  Solution: Use compatible types:  // Instead of Optional&lt;String&gt; public String email; // nullable // Instead of BigDecimal public double amount; // Instead of EnumSet&lt;Status&gt; public Set&lt;Status&gt; statuses;   ","version":"0.15","tagName":"h3"},{"title":"Version Compatibility‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/xlang/troubleshooting#version-compatibility","content":" ","version":"0.15","tagName":"h2"},{"title":"Serialization Format Changed‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/xlang/troubleshooting#serialization-format-changed","content":" Symptom: Deserialization fails after upgrading Fory.  Cause: Breaking changes in serialization format.  Solution:  Ensure all services use compatible Fory versionsCheck release notes for breaking changesConsider using schema evolution (compatible mode) for gradual upgrades  ","version":"0.15","tagName":"h3"},{"title":"Debugging Tips‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/xlang/troubleshooting#debugging-tips","content":" ","version":"0.15","tagName":"h2"},{"title":"Enable Debug Logging‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/xlang/troubleshooting#enable-debug-logging","content":" Java:  // Add to JVM options -Dfory.debug=true   Python:  import logging logging.getLogger('pyfory').setLevel(logging.DEBUG)   ","version":"0.15","tagName":"h3"},{"title":"Inspect Serialized Data‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/xlang/troubleshooting#inspect-serialized-data","content":" Use hex dump to inspect the binary format:  data = fory.serialize(obj) print(data.hex())   ","version":"0.15","tagName":"h3"},{"title":"Test Round-Trip‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/xlang/troubleshooting#test-round-trip","content":" Always test round-trip serialization in each language:  byte[] bytes = fory.serialize(obj); Object result = fory.deserialize(bytes); assert obj.equals(result);   ","version":"0.15","tagName":"h3"},{"title":"Cross-Language Testing‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/xlang/troubleshooting#cross-language-testing","content":" Test serialization across all target languages before deployment:  # Serialize in Java java -jar serializer.jar &gt; data.bin # Deserialize in Python python deserializer.py data.bin   ","version":"0.15","tagName":"h3"},{"title":"Common Mistakes‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/xlang/troubleshooting#common-mistakes","content":" Not registering types: Always register custom types before useInconsistent type names/IDs: Use the same names/IDs across all languagesForgetting xlang mode: Use Language.XLANG in JavaWrong type annotations: Use pyfory.Int32Type etc. in PythonIgnoring reference tracking: Enable for circular/shared references  ","version":"0.15","tagName":"h2"},{"title":"See Also‚Äã","type":1,"pageTitle":"Troubleshooting","url":"/docs/guide/xlang/troubleshooting#see-also","content":" Type Mapping - Cross-language type mapping referenceGetting Started - Setup guideJava Troubleshooting - Java-specific issuesPython Troubleshooting - Python-specific issues ","version":"0.15","tagName":"h2"},{"title":"Benchmark","type":0,"sectionRef":"#","url":"/docs/introduction/benchmark","content":"","keywords":"","version":"0.15"},{"title":"Java Benchmark‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/introduction/benchmark#java-benchmark","content":" The following benchmarks compare Fory against popular Java serialization frameworks. Charts labeled &quot;compatible&quot; show schema evolution mode with forward/backward compatibility enabled, while others show schema consistent mode where class schemas must match.  Test Classes:  Struct: Class with 100 primitive fieldsMediaContent: Class from jvm-serializersSample: Class from Kryo benchmark  ","version":"0.15","tagName":"h2"},{"title":"Java Serialization‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/introduction/benchmark#java-serialization","content":"         ","version":"0.15","tagName":"h3"},{"title":"Java Deserialization‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/introduction/benchmark#java-deserialization","content":"         Important: Fory's runtime code generation requires proper warm-up for performance measurement:  For additional benchmarks covering type forward/backward compatibility, off-heap support, and zero-copy serialization, see Java Benchmarks.  ","version":"0.15","tagName":"h3"},{"title":"Rust Benchmark‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/introduction/benchmark#rust-benchmark","content":" Fory Rust demonstrates competitive performance compared to other Rust serialization frameworks.        Note: Results depend on hardware, dataset, and implementation versions. See the Rust guide for how to run benchmarks yourself: https://github.com/apache/fory/blob/main/benchmarks/rust_benchmark/README.md  ","version":"0.15","tagName":"h2"},{"title":"C++ Benchmark‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/introduction/benchmark#c-benchmark","content":" Fory C++ demonstrates competitive performance compared to Protobuf C++ serialization framework.    ","version":"0.15","tagName":"h2"},{"title":"JavaScript Benchmark‚Äã","type":1,"pageTitle":"Benchmark","url":"/docs/introduction/benchmark#javascript-benchmark","content":"   The data used for this bar graph includes a complex object that has many kinds of field types, and the size of the JSON data is 3KB.  See benchmarks for the benchmark code. ","version":"0.15","tagName":"h2"},{"title":"Zero-Copy Serialization","type":0,"sectionRef":"#","url":"/docs/guide/xlang/zero_copy","content":"","keywords":"","version":"0.15"},{"title":"When to Use Zero-Copy‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/guide/xlang/zero_copy#when-to-use-zero-copy","content":" Use zero-copy serialization when:  Serializing large byte arrays or binary blobsWorking with numeric arrays (int[], double[], etc.)Transferring data over high-performance networksMemory efficiency is critical  ","version":"0.15","tagName":"h2"},{"title":"How It Works‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/guide/xlang/zero_copy#how-it-works","content":" Serialization: Large buffers are extracted and returned separately via a callbackTransport: The main serialized data and buffer objects are transmitted separatelyDeserialization: Buffers are provided back to reconstruct the original object  This avoids copying large data into the main serialization buffer.  ","version":"0.15","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/guide/xlang/zero_copy#java","content":" import org.apache.fory.*; import org.apache.fory.config.*; import org.apache.fory.serializer.BufferObject; import org.apache.fory.memory.MemoryBuffer; import java.util.*; import java.util.stream.Collectors; public class ZeroCopyExample { public static void main(String[] args) { Fory fory = Fory.builder().withLanguage(Language.XLANG).build(); // Data with large arrays List&lt;Object&gt; list = List.of( &quot;str&quot;, new byte[1000], // Large byte array new int[100], // Large int array new double[100] // Large double array ); // Collect buffer objects during serialization Collection&lt;BufferObject&gt; bufferObjects = new ArrayList&lt;&gt;(); byte[] bytes = fory.serialize(list, e -&gt; !bufferObjects.add(e)); // Convert to buffers for transport List&lt;MemoryBuffer&gt; buffers = bufferObjects.stream() .map(BufferObject::toBuffer) .collect(Collectors.toList()); // Deserialize with buffers Object result = fory.deserialize(bytes, buffers); System.out.println(result); } }   ","version":"0.15","tagName":"h2"},{"title":"Python‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/guide/xlang/zero_copy#python","content":" import array import pyfory import numpy as np fory = pyfory.Fory(xlang=True) # Data with large arrays data = [ &quot;str&quot;, bytes(bytearray(1000)), # Large byte array array.array(&quot;i&quot;, range(100)), # Large int array np.full(100, 0.0, dtype=np.double) # Large numpy array ] # Collect buffer objects during serialization serialized_objects = [] serialized_data = fory.serialize(data, buffer_callback=serialized_objects.append) # Convert to buffers for transport buffers = [obj.to_buffer() for obj in serialized_objects] # Deserialize with buffers result = fory.deserialize(serialized_data, buffers=buffers) print(result)   ","version":"0.15","tagName":"h2"},{"title":"Go‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/guide/xlang/zero_copy#go","content":" package main import forygo &quot;github.com/apache/fory/go/fory&quot; import &quot;fmt&quot; func main() { serializer := forygo.NewFory(forygo.WithXlang(true)) // Data with large arrays list := []any{ &quot;str&quot;, make([]byte, 1000), // Large byte array } buf := forygo.NewByteBuffer(nil) var bufferObjects []forygo.BufferObject // Collect buffer objects during serialization if err := serializer.SerializeWithCallback(buf, list, func(o forygo.BufferObject) bool { bufferObjects = append(bufferObjects, o) return false }); err != nil { panic(err) } // Convert to buffers for transport var buffers []*forygo.ByteBuffer for _, o := range bufferObjects { buffers = append(buffers, o.ToBuffer()) } // Deserialize with buffers var newList []any if err := serializer.DeserializeWithCallbackBuffers(buf, &amp;newList, buffers); err != nil { panic(err) } fmt.Println(newList) }   ","version":"0.15","tagName":"h2"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/guide/xlang/zero_copy#javascript","content":" // Zero-copy support coming soon   ","version":"0.15","tagName":"h2"},{"title":"Use Cases‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/guide/xlang/zero_copy#use-cases","content":" ","version":"0.15","tagName":"h2"},{"title":"High-Performance Data Transfer‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/guide/xlang/zero_copy#high-performance-data-transfer","content":" When sending large datasets over the network:  // Sender Collection&lt;BufferObject&gt; buffers = new ArrayList&lt;&gt;(); byte[] metadata = fory.serialize(dataObject, e -&gt; !buffers.add(e)); // Send metadata and buffers separately network.sendMetadata(metadata); for (BufferObject buf : buffers) { network.sendBuffer(buf.toBuffer()); } // Receiver byte[] metadata = network.receiveMetadata(); List&lt;MemoryBuffer&gt; buffers = network.receiveBuffers(); Object data = fory.deserialize(metadata, buffers);   ","version":"0.15","tagName":"h3"},{"title":"Memory-Mapped Files‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/guide/xlang/zero_copy#memory-mapped-files","content":" Zero-copy works well with memory-mapped files:  // Write Collection&lt;BufferObject&gt; buffers = new ArrayList&lt;&gt;(); byte[] data = fory.serialize(largeObject, e -&gt; !buffers.add(e)); writeToFile(&quot;data.bin&quot;, data); for (int i = 0; i &lt; buffers.size(); i++) { writeToFile(&quot;buffer&quot; + i + &quot;.bin&quot;, buffers.get(i).toBuffer()); } // Read byte[] data = readFromFile(&quot;data.bin&quot;); List&lt;MemoryBuffer&gt; buffers = readBufferFiles(); Object result = fory.deserialize(data, buffers);   ","version":"0.15","tagName":"h3"},{"title":"Performance Considerations‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/guide/xlang/zero_copy#performance-considerations","content":" Threshold: Small arrays may not benefit from zero-copy due to callback overheadNetwork: Zero-copy is most beneficial when buffers can be sent without copyingMemory: Reduces peak memory usage by avoiding buffer copies  ","version":"0.15","tagName":"h2"},{"title":"See Also‚Äã","type":1,"pageTitle":"Zero-Copy Serialization","url":"/docs/guide/xlang/zero_copy#see-also","content":" Serialization - Standard serialization examplesPython Out-of-Band Guide - Python-specific zero-copy details ","version":"0.15","tagName":"h2"},{"title":"Features","type":0,"sectionRef":"#","url":"/docs/introduction/features","content":"","keywords":"","version":"0.15"},{"title":"Core Capabilities‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#core-capabilities","content":" ","version":"0.15","tagName":"h2"},{"title":"üöÄ High-Performance Serialization‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#-high-performance-serialization","content":" Apache Fory‚Ñ¢ delivers exceptional performance through advanced optimization techniques:  JIT Compilation: Runtime code generation for Java eliminates virtual method calls and inlines hot pathsStatic Code Generation: Compile-time code generation for Rust, C++, and Go delivers peak performance without runtime overheadZero-Copy Operations: Direct memory access without intermediate buffer copies; row format enables random access and partial serializationIntelligent Encoding: Variable-length compression for integers and strings; SIMD acceleration for arrays (Java 16+)Meta Sharing: Class metadata packing reduces redundant type information across serializations  ","version":"0.15","tagName":"h3"},{"title":"üåç Cross-Language Serialization‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#-cross-language-serialization","content":" The xlang serialization format enables seamless data exchange across programming languages:  Automatic Type Mapping: Intelligent conversion between language-specific types (type mapping)Reference Preservation: Shared and circular references work correctly across languagesPolymorphism: Objects serialize/deserialize with their actual runtime typesSchema Evolution: Optional forward/backward compatibility for evolving schemasAutomatic Serialization: No IDL or schema definitions required; serialize any object directly without code generation  ","version":"0.15","tagName":"h3"},{"title":"üìä Row Format‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#-row-format","content":" A cache-friendly row format optimized for analytics workloads:  Zero-Copy Random Access: Read individual fields without deserializing entire objectsPartial Operations: Selective field serialization and deserialization for efficiencyApache Arrow Integration: Seamless conversion to columnar format for analytics pipelinesMulti-Language: Available in Java, Python, Rust and C++  ","version":"0.15","tagName":"h3"},{"title":"üîí Security & Production-Readiness‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#-security--production-readiness","content":" Enterprise-grade security and compatibility:  Class Registration: Whitelist-based deserialization control (enabled by default)Depth Limiting: Protection against recursive object graph attacksConfigurable Policies: Custom class checkers and deserialization policiesPlatform Support: Java 8-24, GraalVM native image, multiple OS platforms  ","version":"0.15","tagName":"h3"},{"title":"Java Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#java-features","content":" ","version":"0.15","tagName":"h2"},{"title":"üöÄ High Performance‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#-high-performance","content":" JIT Code Generation: Highly-extensible JIT framework generates serializer code at runtime using async multi-threaded compilation, delivering 20-170x speedup through: Inlining variables to reduce memory accessInlining method calls to eliminate virtual dispatch overheadMinimizing conditional branchingEliminating hash lookups Zero-Copy: Direct memory access without intermediate buffer copies; row format supports random access and partial serializationVariable-Length Encoding: Optimized compression for integers, longsMeta Sharing: Cached class metadata reduces redundant type informationSIMD Acceleration: Java Vector API support for array operations (Java 16+)  ","version":"0.15","tagName":"h3"},{"title":"üîß Drop-in Replacement‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#-drop-in-replacement","content":" 100% JDK Serialization Compatible: Supports writeObject/readObject/writeReplace/readResolve/readObjectNoData/ExternalizableJava 8-24 Support: Works across all modern Java versions including Java 17+ recordsGraalVM Native Image: AOT compilation support without reflection configuration  ","version":"0.15","tagName":"h3"},{"title":"üîÑ Advanced Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#-advanced-features","content":" Reference Tracking: Automatic handling of shared and circular referencesSchema Evolution: Forward/backward compatibility for class schema changesPolymorphism: Full support for inheritance hierarchies and interfacesDeep Copy: Efficient deep cloning of complex object graphs with reference preservationSecurity: Class registration and configurable deserialization policies  ","version":"0.15","tagName":"h3"},{"title":"Python Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#python-features","content":" ","version":"0.15","tagName":"h2"},{"title":"üîß Flexible Serialization Modes‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#-flexible-serialization-modes","content":" Python native Mode: Full Python compatibility, drop-in replacement for pickle/cloudpickleCross-Language Mode: Optimized for multi-language data exchangeRow Format: Zero-copy row format for analytics workloads  ","version":"0.15","tagName":"h3"},{"title":"üéØ Versatile Serialization Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#-versatile-serialization-features","content":" Shared/circular reference support for complex object graphs in both Python-native and cross-language modesPolymorphism support for customized types with automatic type dispatchingSchema evolution support for backward/forward compatibility when using dataclasses in cross-language modeOut-of-band buffer support for zero-copy serialization of large data structures like NumPy arrays and Pandas DataFrames, compatible with pickle protocol 5  ","version":"0.15","tagName":"h3"},{"title":"‚ö° Blazing Fast Performance‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#-blazing-fast-performance","content":" Extremely fast performance compared to other serialization frameworksRuntime code generation and Cython-accelerated core implementation for optimal performance  ","version":"0.15","tagName":"h3"},{"title":"üì¶ Compact Data Size‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#-compact-data-size","content":" Compact object graph protocol with minimal space overhead‚Äîup to 3√ó size reduction compared to pickle/cloudpickleMeta packing and sharing to minimize type forward/backward compatibility space overhead  ","version":"0.15","tagName":"h3"},{"title":"üõ°Ô∏è Security & Safety‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#Ô∏è-security--safety","content":" Strict mode prevents deserialization of untrusted types by type registration and checks.Reference tracking for handling circular references safely  ","version":"0.15","tagName":"h3"},{"title":"Rust Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#rust-features","content":" ","version":"0.15","tagName":"h2"},{"title":"üöÄ Why Apache Fory‚Ñ¢ Rust?‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#-why-apache-fory-rust","content":" üî• Blazingly Fast: Zero-copy deserialization and optimized binary protocolsüåç Cross-Language: Seamlessly serialize/deserialize data across Java, Python, C++, Go, JavaScript, and RustüéØ Type-Safe: Compile-time type checking with derive macrosüîÑ Circular References: Automatic tracking of shared and circular references with Rc/Arc and weak pointersüß¨ Polymorphic: Serialize trait objects with Box&lt;dyn Trait&gt;, Rc&lt;dyn Trait&gt;, and Arc&lt;dyn Trait&gt;üì¶ Schema Evolution: Compatible mode for independent schema changes‚ö° Two Modes: Object graph serialization and zero-copy row-based format  ","version":"0.15","tagName":"h3"},{"title":"Object Graph Serialization‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#object-graph-serialization","content":" Automatic serialization of complex object graphs, preserving the structure and relationships between objects. The #[derive(ForyObject)] macro generates efficient serialization code at compile time, eliminating runtime overhead:  Nested struct serialization with arbitrary depthCollection types (Vec, HashMap, HashSet, BTreeMap)Enum type supportOptional fields with Option&lt;T&gt;Automatic handling of primitive types and stringsEfficient binary encoding with variable-length integers  ","version":"0.15","tagName":"h3"},{"title":"Shared and Circular References‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#shared-and-circular-references","content":" Automatically tracks and preserves reference identity for shared objects using Rc&lt;T&gt; and Arc&lt;T&gt;. When the same object is referenced multiple times, Fory serializes it only once and uses reference IDs for subsequent occurrences. This ensures:  Space efficiency: No data duplication in serialized outputReference identity preservation: Deserialized objects maintain the same sharing relationshipsCircular reference support: Use RcWeak&lt;T&gt; and ArcWeak&lt;T&gt; to break cycles  ","version":"0.15","tagName":"h3"},{"title":"Trait Object Serialization‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#trait-object-serialization","content":" Polymorphic serialization through trait objects, enabling dynamic dispatch and type flexibility. This is essential for plugin systems, heterogeneous collections, and extensible architectures. Supported trait object types:  Box&lt;dyn Trait&gt; - Owned trait objectsRc&lt;dyn Trait&gt; - Reference-counted trait objectsArc&lt;dyn Trait&gt; - Thread-safe reference-counted trait objectsVec&lt;Box&lt;dyn Trait&gt;&gt;, HashMap&lt;K, Box&lt;dyn Trait&gt;&gt; - Collections of trait objects  ","version":"0.15","tagName":"h3"},{"title":"Schema Evolution‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#schema-evolution","content":" Schema evolution in Compatible mode, allowing serialization and deserialization peers to have different type definitions. This enables independent evolution of services in distributed systems without breaking compatibility:  Add new fields with default valuesRemove obsolete fields (skipped during deserialization)Change field nullability (T ‚Üî Option&lt;T&gt;)Reorder fields (matched by name, not position)Type-safe fallback to default values for missing fields  ","version":"0.15","tagName":"h3"},{"title":"Custom Serializers‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#custom-serializers","content":" For types that don't support #[derive(ForyObject)], implement the Serializer trait manually. This is useful for:  External types from other cratesTypes with special serialization requirementsLegacy data format compatibilityPerformance-critical custom encoding  ","version":"0.15","tagName":"h3"},{"title":"Row-Based Serialization‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#row-based-serialization","content":" High-performance row format for zero-copy deserialization. Unlike traditional object serialization that reconstructs entire objects in memory, row format enables random access to fields directly from binary data without full deserialization.  Zero-copy access: Read fields without allocating or copying dataPartial deserialization: Access only the fields you needMemory-mapped files: Work with data larger than RAMCache-friendly: Sequential memory layout for better CPU cache utilizationLazy evaluation: Defer expensive operations until field access  ","version":"0.15","tagName":"h3"},{"title":"Scala Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#scala-features","content":" ","version":"0.15","tagName":"h2"},{"title":"Supported Types‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#supported-types","content":" Apache Fory‚Ñ¢ supports all scala object serialization:  case class serialization supportedpojo/bean class serialization supportedobject singleton serialization supportedcollection serialization supportedother types such as tuple/either and basic types are all supported too.  Scala 2 and 3 are both supported.  ","version":"0.15","tagName":"h3"},{"title":"Scala Class Default Values Support‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#scala-class-default-values-support","content":" Fory supports Scala class default values during deserialization when using compatible mode. This feature enables forward/backward compatibility when case classes or regular Scala classes have default parameters.  When a Scala class has default parameters, the Scala compiler generates methods in the companion object (for case classes) or in the class itself (for regular Scala classes) like apply$default$1, apply$default$2, etc. that return the default values. Fory can detect these methods and use them when deserializing objects where certain fields are missing from the serialized data.  ","version":"0.15","tagName":"h3"},{"title":"Kotlin Features‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#kotlin-features","content":" ","version":"0.15","tagName":"h2"},{"title":"Supported Types‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#supported-types-1","content":" primitives: Byte, Boolean, Int, Short, Long, Char, Float, Double, UByte, UShort, UInt, ULong.Byte, Boolean, Int, Short, Long, Char, Float, Double works out of the box with the default fory java implementation.stdlib collection: ArrayDeque, ArrayList, HashMap,HashSet, LinkedHashSet, LinkedHashMap.ArrayList, HashMap,HashSet, LinkedHashSet, LinkedHashMap works out of the box with the default fory java implementation.String works out of the box with the default fory java implementation.arrays: Array, BooleanArray, ByteArray, CharArray, DoubleArray, FloatArray, IntArray, LongArray, ShortArrayall standard array types work out of the box with the default fory java implementation.unsigned arrays: UByteArray, UShortArray, UIntArray, ULongArrayfrom stdlib: Pair, Triple, Resultkotlin.random: Randomkotlin.ranges: CharRange, CharProgression, IntRange, IntProgression, LongRange, LongProgression, UintRange, UintProgression, ULongRange, ULongProgressionkotlin.text: Regexkotlin.time: Durationkotlin.uuid: Uuid  Additional support is added for the following classes in kotlin:  Unsigned primitives: UByte, UShort, UInt, ULongUnsigned array types: UByteArray, UShortArray, UIntArray, ULongArrayEmpty collections: emptyList, emptyMap, emptySetCollections: ArrayDequekotlin.time: Durationkotlin.uuid: Uuid  ","version":"0.15","tagName":"h3"},{"title":"Data Class Default Value Support‚Äã","type":1,"pageTitle":"Features","url":"/docs/introduction/features#data-class-default-value-support","content":" Apache Fory‚Ñ¢ Kotlin provides support for Kotlin data class default values during serialization and deserialization. This feature allows for backward and forward compatibility when data class schemas evolve.  When a Kotlin data class has parameters with default values, Apache Fory‚Ñ¢ can:  Detect default values using Kotlin reflectionApply default values during deserialization when fields are missing from serialized dataSupport schema evolution by allowing new fields with defaults to be added without breaking existing serialized data ","version":"0.15","tagName":"h3"},{"title":"Overview","type":0,"sectionRef":"#","url":"/docs/introduction/overview","content":"","keywords":"","version":"0.15"},{"title":"Quick Example‚Äã","type":1,"pageTitle":"Overview","url":"/docs/introduction/overview#quick-example","content":" Cross-language serialization ‚Äî serialize in Rust, deserialize in Python:  Rust  use fory::{Fory, ForyObject}; #[derive(ForyObject, Debug, PartialEq)] struct User { name: String, age: i32, } fn main() { let mut fory = Fory::default().xlang(true); fory.register::&lt;User&gt;(1); let user = User { name: &quot;Alice&quot;.to_string(), age: 30 }; let bytes = fory.serialize(&amp;user).unwrap(); let decoded: User = fory.deserialize(&amp;bytes).unwrap(); println!(&quot;{:?}&quot;, decoded); // User { name: &quot;Alice&quot;, age: 30 } }   Python  import pyfory from dataclasses import dataclass @dataclass class User: name: str age: pyfory.int32 fory = pyfory.Fory(xlang=True) fory.register(User, type_id=1) user = User(name=&quot;Alice&quot;, age=30) data = fory.serialize(user) decoded = fory.deserialize(data) print(decoded) # User(name='Alice', age=30)   ","version":"0.15","tagName":"h2"},{"title":"Key Features‚Äã","type":1,"pageTitle":"Overview","url":"/docs/introduction/overview#key-features","content":" ","version":"0.15","tagName":"h2"},{"title":"üöÄ High-Performance Serialization‚Äã","type":1,"pageTitle":"Overview","url":"/docs/introduction/overview#-high-performance-serialization","content":" Apache Fory‚Ñ¢ delivers exceptional performance through advanced optimization techniques:  JIT Compilation: Runtime code generation for Java eliminates virtual method calls and inlines hot pathsStatic Code Generation: Compile-time code generation for Rust, C++, and Go delivers peak performance without runtime overheadZero-Copy Operations: Direct memory access without intermediate buffer copies; row format enables random access and partial serializationIntelligent Encoding: Variable-length compression for integers and strings; SIMD acceleration for arrays (Java 16+)Meta Sharing: Class metadata packing reduces redundant type information across serializations  ","version":"0.15","tagName":"h3"},{"title":"üîÑ Cross-Language Serialization‚Äã","type":1,"pageTitle":"Overview","url":"/docs/introduction/overview#-cross-language-serialization","content":" The xlang serialization format enables seamless data exchange across programming languages:  Automatic Type Mapping: Intelligent conversion between language-specific types (type mapping)Reference Preservation: Shared and circular references work correctly across languagesPolymorphism: Objects serialize/deserialize with their actual runtime typesSchema Evolution: Optional forward/backward compatibility for evolving schemasAutomatic Serialization: No IDL or schema definitions required; serialize any object directly without code generation  ","version":"0.15","tagName":"h3"},{"title":"üìä Row Format‚Äã","type":1,"pageTitle":"Overview","url":"/docs/introduction/overview#-row-format","content":" A cache-friendly row format optimized for analytics workloads:  Zero-Copy Random Access: Read individual fields without deserializing entire objectsPartial Operations: Selective field serialization and deserialization for efficiencyApache Arrow Integration: Seamless conversion to columnar format for analytics pipelinesMulti-Language: Available in Java, Python, Rust and C++  ","version":"0.15","tagName":"h3"},{"title":"üîí Security & Production-Readiness‚Äã","type":1,"pageTitle":"Overview","url":"/docs/introduction/overview#-security--production-readiness","content":" Enterprise-grade security and compatibility:  Class Registration: Whitelist-based deserialization control (enabled by default)Depth Limiting: Protection against recursive object graph attacksConfigurable Policies: Custom class checkers and deserialization policiesPlatform Support: Java 8-24, GraalVM native image, multiple OS platforms  ","version":"0.15","tagName":"h3"},{"title":"Protocols‚Äã","type":1,"pageTitle":"Overview","url":"/docs/introduction/overview#protocols","content":" Apache Fory‚Ñ¢ implements multiple binary protocols optimized for different scenarios:  Protocol\tUse Case\tKey FeaturesXlang Serialization\tCross-language object exchange\tAutomatic serialization, references, polymorphism Java Serialization\tHigh-performance Java-only\tDrop-in JDK serialization replacement, 100x faster Row Format\tAnalytics and data processing\tZero-copy random access, Arrow compatibility Python Native\tPython-specific serialization\tPickle/cloudpickle replacement with better performance  All protocols share the same optimized codebase, allowing improvements in one protocol to benefit others.  ","version":"0.15","tagName":"h2"},{"title":"Documentation‚Äã","type":1,"pageTitle":"Overview","url":"/docs/introduction/overview#documentation","content":" ","version":"0.15","tagName":"h2"},{"title":"User Guides‚Äã","type":1,"pageTitle":"Overview","url":"/docs/introduction/overview#user-guides","content":" Guide\tDescription\tSource\tWebsiteJava Serialization\tComprehensive guide for Java serialization\tJava Guide\tüìñ View Cross-Language Serialization\tMulti-language object exchange\tXlang Guide\tüìñ View Row Format\tZero-copy random access format\tJava Row Format\tüìñ View Python\tPython-specific features and usage\tPython Guide\tüìñ View Rust\tRust implementation and patterns\tRust Guide\tüìñ View Go\tGo implementation and usage\tGo Guide\tüìñ View Scala\tScala integration and best practices\tScala Guide\tüìñ View GraalVM\tNative image support and AOT compilation\tGraalVM Guide\tüìñ View Development\tBuilding and contributing to Fory\tDevelopment\tüìñ View  ","version":"0.15","tagName":"h3"},{"title":"Protocol Specifications‚Äã","type":1,"pageTitle":"Overview","url":"/docs/introduction/overview#protocol-specifications","content":" Specification\tDescription\tSource\tWebsiteXlang Serialization\tCross-language binary protocol\txlang_serialization_spec.md\tüìñ View Java Serialization\tJava-optimized protocol\tjava_serialization_spec.md\tüìñ View Row Format\tRow-based binary format\trow_format_spec.md\tüìñ View Type Mapping\tCross-language type conversion\txlang_type_mapping.md\tüìñ View  ","version":"0.15","tagName":"h3"},{"title":"Compatibility‚Äã","type":1,"pageTitle":"Overview","url":"/docs/introduction/overview#compatibility","content":" ","version":"0.15","tagName":"h2"},{"title":"Schema Compatibility‚Äã","type":1,"pageTitle":"Overview","url":"/docs/introduction/overview#schema-compatibility","content":" Apache Fory‚Ñ¢ supports class schema forward/backward compatibility across Java, Python, Rust, and Golang, enabling seamless schema evolution in production systems without requiring coordinated upgrades across all services. Fory provides two schema compatibility modes:  Schema Consistent Mode (Default): Assumes identical class schemas between serialization and deserialization peers. This mode offers minimal serialization overhead, smallest data size, and fastest performance: ideal for stable schemas or controlled environments. Compatible Mode: Supports independent schema evolution with forward and backward compatibility. This mode enables field addition/deletion, limited type evolution, and graceful handling of schema mismatches. Enable using withCompatibleMode(CompatibleMode.COMPATIBLE) in Java, compatible=True in Python, compatible_mode(true) in Rust, or NewFory(true) in Go.  ","version":"0.15","tagName":"h3"},{"title":"Binary Compatibility‚Äã","type":1,"pageTitle":"Overview","url":"/docs/introduction/overview#binary-compatibility","content":" Current Status: Binary compatibility is not guaranteed between Fory major releases as the protocol continues to evolve. However, compatibility is guaranteed between minor versions (e.g., 0.13.x).  Recommendations:  Version your serialized data by Fory major versionPlan migration strategies when upgrading major versionsSee upgrade guide for details  Future: Binary compatibility will be guaranteed starting from Fory 1.0 release.  ","version":"0.15","tagName":"h3"},{"title":"Security‚Äã","type":1,"pageTitle":"Overview","url":"/docs/introduction/overview#security","content":" ","version":"0.15","tagName":"h2"},{"title":"Overview‚Äã","type":1,"pageTitle":"Overview","url":"/docs/introduction/overview#overview","content":" Serialization security varies by protocol:  Row Format: Secure with predefined schemasObject Graph Serialization (Java/Python native): More flexible but requires careful security configuration  Dynamic serialization can deserialize arbitrary types, which may introduces risks. For example, the deserialization may invoke init constructor or equals/hashCode method, if the method body contains malicious code, the system will be at risk.  Fory enables class registration by default for dynamic protocols, allowing only trusted registered types.Do not disable class registration unless you can ensure your environment is secure.  If this option is disabled, you are responsible for serialization security. You should implement and configure a customized ClassChecker or DeserializationPolicy for fine-grained security control  To report security vulnerabilities in Apache Fory‚Ñ¢, please follow the ASF vulnerability reporting process.  ","version":"0.15","tagName":"h3"},{"title":"Community and Support‚Äã","type":1,"pageTitle":"Overview","url":"/docs/introduction/overview#community-and-support","content":" ","version":"0.15","tagName":"h2"},{"title":"Getting Help‚Äã","type":1,"pageTitle":"Overview","url":"/docs/introduction/overview#getting-help","content":" Slack: Join our Slack workspace for community discussionsTwitter/X: Follow @ApacheFory for updates and announcementsGitHub Issues: Report bugs and request features at apache/foryMailing Lists: Subscribe to Apache Fory mailing lists for development discussions  ","version":"0.15","tagName":"h3"},{"title":"Contributing‚Äã","type":1,"pageTitle":"Overview","url":"/docs/introduction/overview#contributing","content":" We welcome contributions! Please read our Contributing Guide to get started.  Ways to Contribute:  üêõ Report bugs and issuesüí° Propose new featuresüìù Improve documentationüîß Submit pull requestsüß™ Add test casesüìä Share benchmarks  See Development Guide for build instructions and development workflow. ","version":"0.15","tagName":"h3"},{"title":"Java Serialization Format","type":0,"sectionRef":"#","url":"/docs/specification/java_serialization_spec","content":"","keywords":"","version":"0.15"},{"title":"Spec overview‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#spec-overview","content":" Apache Fory Java serialization is a dynamic binary format for Java object graphs. It supports shared references, circular references, polymorphism, and optional schema evolution. The format is stream friendly: shared type metadata is written inline when needed and there is no meta start offset.  The Java native format is an extension of the xlang wire format and reuses the same core framing and encodings; see docs/specification/xlang_serialization_spec.md for the shared baseline.  Overall layout:  | fory header | object ref meta | object type meta | object value data |   All data is encoded in little endian byte order. When running on a big endian platform, array serializers swap byte order on write/read so the on-wire layout remains little endian.  ","version":"0.15","tagName":"h2"},{"title":"Fory header‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#fory-header","content":" Java native serialization writes a one byte bitmap header. The header layout mirrors the xlang bitmap and uses the same flag bits.  | 5 bits | 1 bit | 1 bit | 1 bit | +--------------+-------+-------+-------+ | reserved | oob | xlang | null |   null flag: 1 when object is null, 0 otherwise. If object is null, other bits are not set.xlang flag: 1 when serialization uses xlang format, 0 when serialization uses Java native format.oob flag: 1 when BufferCallback is not null, 0 otherwise.  The header is always a single byte; no language ID is written.  ","version":"0.15","tagName":"h2"},{"title":"Reference meta‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#reference-meta","content":" Reference tracking uses the same flags as the xlang specification.  Flag\tByte Value\tDescriptionNULL FLAG\t-3\tObject is null. No further bytes are written for this object. REF FLAG\t-2\tObject was already serialized. Followed by unsigned varint32 reference ID. NOT_NULL VALUE FLAG\t-1\tObject is non-null but reference tracking is disabled for this type. Object data follows immediately. REF VALUE FLAG\t0\tObject is referencable and this is its first occurrence. Object data follows. Assigns next reference ID.  When reference tracking is disabled globally or for a specific field/type, only NULL FLAG andNOT_NULL VALUE FLAG are used.  ","version":"0.15","tagName":"h2"},{"title":"Type system and type IDs‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#type-system-and-type-ids","content":" Java native serialization uses the unified type ID layout shared with xlang:  full_type_id = (user_type_id &lt;&lt; 8) | internal_type_id   internal_type_id is the low 8 bits describing the kind (enum/struct/ext, named variants, or a built-in type).user_type_id is the numeric registration ID (0-based) for user-defined enum/struct/ext types.Named types use NAMED_* internal IDs and carry names in metadata rather than embedding a user ID.  ","version":"0.15","tagName":"h2"},{"title":"Shared internal type IDs (0-63)‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#shared-internal-type-ids-0-63","content":" Java native mode shares the xlang internal IDs for all values below 64. IDs 0~56 are defined by the xlang spec, while 57~63 are reserved for future internal use. These IDs are stable across languages.  See the internal type ID table inXlang Serialization Format. Java shares all IDs &lt; 64, with 57~63 reserved for future internal use.  ","version":"0.15","tagName":"h3"},{"title":"Java native built-in type IDs‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#java-native-built-in-type-ids","content":" Java native serialization assigns Java-specific built-ins starting atTypes.BOUND + 5 (Types.BOUND is 64; 5 IDs are reserved for future use). Type IDs in 0~56 are shared with xlang; 57~63 are reserved; 64+ are only valid in Java native mode.  Type ID\tName\tDescription69\tVOID_ID\tjava.lang.Void 70\tCHAR_ID\tjava.lang.Character 71\tPRIMITIVE_VOID_ID\tvoid 72\tPRIMITIVE_BOOL_ID\tboolean 73\tPRIMITIVE_INT8_ID\tbyte 74\tPRIMITIVE_CHAR_ID\tchar 75\tPRIMITIVE_INT16_ID\tshort 76\tPRIMITIVE_INT32_ID\tint 77\tPRIMITIVE_FLOAT32_ID\tfloat 78\tPRIMITIVE_INT64_ID\tlong 79\tPRIMITIVE_FLOAT64_ID\tdouble 80\tPRIMITIVE_BOOLEAN_ARRAY_ID\tboolean[] 81\tPRIMITIVE_BYTE_ARRAY_ID\tbyte[] 82\tPRIMITIVE_CHAR_ARRAY_ID\tchar[] 83\tPRIMITIVE_SHORT_ARRAY_ID\tshort[] 84\tPRIMITIVE_INT_ARRAY_ID\tint[] 85\tPRIMITIVE_FLOAT_ARRAY_ID\tfloat[] 86\tPRIMITIVE_LONG_ARRAY_ID\tlong[] 87\tPRIMITIVE_DOUBLE_ARRAY_ID\tdouble[] 88\tSTRING_ARRAY_ID\tString[] 89\tOBJECT_ARRAY_ID\tObject[] 90\tARRAYLIST_ID\tjava.util.ArrayList 91\tHASHMAP_ID\tjava.util.HashMap 92\tHASHSET_ID\tjava.util.HashSet 93\tCLASS_ID\tjava.lang.Class 94\tEMPTY_OBJECT_ID\tempty object stub 95\tLAMBDA_STUB_ID\tlambda stub 96\tJDK_PROXY_STUB_ID\tJDK proxy stub 97\tREPLACE_STUB_ID\twriteReplace/readResolve stub 98\tNONEXISTENT_META_SHARED_ID\tmeta-shared unknown class stub  ","version":"0.15","tagName":"h3"},{"title":"Registration and named types‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#registration-and-named-types","content":" User-defined enum/struct/ext types can be registered by numeric ID or by name.  Numeric registration: full_type_id = (user_id &lt;&lt; 8) | internal_type_id.Name registration: type meta uses namespace and type name (see below).Unregistered types are encoded as named types using namespace = package name and type name = simple class name.  Named type selection rules for unregistered types:  enum -&gt; NAMED_ENUMstruct-like serializers -&gt; NAMED_STRUCT (or NAMED_COMPATIBLE_STRUCT in compatible mode)all other custom serializers -&gt; NAMED_EXT  ","version":"0.15","tagName":"h3"},{"title":"Type meta encoding‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#type-meta-encoding","content":" Every value is written with a type ID followed by optional type metadata:  Write type_id using varuint32 small7 encoding.For NAMED_ENUM, NAMED_STRUCT, NAMED_EXT, NAMED_COMPATIBLE_STRUCT: If meta share is enabled: write shared class meta (streaming format).Otherwise: write namespace and type name as meta strings. For COMPATIBLE_STRUCT: If meta share is enabled: write shared class meta (streaming format).Otherwise: no extra meta (type ID is sufficient). All other types: no extra meta.  ","version":"0.15","tagName":"h2"},{"title":"Shared class meta (streaming)‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#shared-class-meta-streaming","content":" When meta share is enabled, Java uses the streaming shared meta protocol and writes TypeDef bytes inline on first use.  | varuint32: index_marker | [class def bytes if new] | index_marker = (index &lt;&lt; 1) | flag flag = 1 -&gt; reference flag = 0 -&gt; new type   If flag == 1, this is a reference to a previously written type. No class def bytes follow.If flag == 0, this is a new type definition and class def bytes are written inline.  The index is assigned sequentially in the order types are first encountered.  ","version":"0.15","tagName":"h3"},{"title":"Schema modes‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#schema-modes","content":" Java native serialization supports two schema modes:  Schema consistent (compatible mode disabled): fields are serialized in a fixed order and no ClassDef is required. Type meta uses STRUCT or NAMED_STRUCT for user-defined classes.Schema evolution (compatible mode enabled): fields are serialized with schema evolution metadata (ClassDef). Type meta uses COMPATIBLE_STRUCT or NAMED_COMPATIBLE_STRUCT.  ","version":"0.15","tagName":"h2"},{"title":"ClassDef format (compatible mode)‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#classdef-format-compatible-mode","content":" ClassDef is the schema evolution metadata encoded for compatible structs. It is written inline when shared meta is enabled, or referenced by index when already seen.  ","version":"0.15","tagName":"h2"},{"title":"Binary layout‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#binary-layout","content":" | 8 bytes header | [varuint32 extra size] | class meta bytes |   Header layout (lower bits on the right):  | 50-bit hash | 4 bits reserved | 1 bit compress | 1 bit has_fields_meta | 8-bit size |   size: lower 8 bits. If size equals the mask (0xFF), write extra size as varuint32 and add it.compress: set when payload is compressed.has_fields_meta: set when field metadata is present.reserved: bits 10-13 are reserved for future use and must be zero.hash: 50-bit hash of the payload and flags.  ","version":"0.15","tagName":"h3"},{"title":"Class meta bytes‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#class-meta-bytes","content":" Class meta encodes a linearized class hierarchy (from parent to leaf) and field metadata:  | num_classes | class_layer_0 | class_layer_1 | ... | class_layer: | num_fields &lt;&lt; 1 | registered_flag | [type_id if registered] | | namespace | type_name | field_infos |   num_classes stores (num_layers - 1) in a single byte. If it equals 0b1111, read an extra varuint32 small7 and add it.The actual number of layers is num_classes + 1. registered_flag is 1 if the class is registered by numeric ID.If registered by ID, the class type ID follows (varuint32 small7).If registered by name or unregistered, namespace and type name are written as meta strings.  ","version":"0.15","tagName":"h3"},{"title":"Field info‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#field-info","content":" Each field uses a compact header followed by its name bytes (omitted when TAG_ID is used) and its type info:  | field_header | [field_name_bytes] | field_type |   field_header bits:  bit 0: trackingRefbit 1: nullablebits 2-3: field name encodingbits 4-6: name length (len-1), or tag ID when TAG_ID is used; value 7 indicates extended lengthbit 7: reserved (0)  Field name encoding:  0: UTF81: ALL_TO_LOWER_SPECIAL2: LOWER_UPPER_DIGIT_SPECIAL3: TAG_ID (field name omitted, tag ID stored in size field)  If length is extended (size==7), an extra varuint32 small7 storing (len-1) - 7 follows.  ","version":"0.15","tagName":"h3"},{"title":"Field type encoding‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#field-type-encoding","content":" Field types are encoded with a type tag and optional nested type info. For nested types, the header includes nullable/trackingRef flags in the low bits. Top-level field types use the tag only (no flags).  Type tags:  Tag\tField type0\tObject (ObjectFieldType) 1\tMap (MapFieldType) 2\tCollection/List/Set (CollectionFieldType) 3\tArray (ArrayFieldType) 4\tEnum (EnumFieldType) 5+\tRegistered type (RegisteredFieldType)  Encoding rules:  ObjectFieldType: write tag 0.MapFieldType: write tag 1, then key type, then value type.CollectionFieldType: write tag 2, then element type.ArrayFieldType: write tag 3, then dimensions, then component type.EnumFieldType: write tag 4.RegisteredFieldType: write tag 5 + type_id.  For nested types, nullable/trackingRef flags are stored in the low bits of the header as(type_tag &lt;&lt; 2) | (nullable &lt;&lt; 1) | tracking_ref.  ","version":"0.15","tagName":"h3"},{"title":"Meta string encoding‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#meta-string-encoding","content":" Namespace, type names, and field names use the same meta string encodings as the xlang spec.  ","version":"0.15","tagName":"h2"},{"title":"Package and type names‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#package-and-type-names","content":" Header format:  | 6 bits size | 2 bits encoding |   size is the byte length of the encoded name.if size == 63, write extra length (size - 63) as varuint32 small7.  Encodings:  Package name: UTF8, ALL_TO_LOWER_SPECIAL, LOWER_UPPER_DIGIT_SPECIALType name: UTF8, LOWER_UPPER_DIGIT_SPECIAL, FIRST_TO_LOWER_SPECIAL, ALL_TO_LOWER_SPECIAL  ","version":"0.15","tagName":"h3"},{"title":"Field names‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#field-names","content":" Field name encoding is described in the ClassDef field header section. When using TAG_ID, the field name bytes are omitted and the tag ID is stored in the size field.  ","version":"0.15","tagName":"h3"},{"title":"Encoding algorithms‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#encoding-algorithms","content":" See the xlang specification for encoding algorithms and tables:docs/specification/xlang_serialization_spec.md#meta-string.  ","version":"0.15","tagName":"h3"},{"title":"Value encodings‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#value-encodings","content":" This section describes the byte layouts for common built-in serializers used in Java native serialization. Custom serializers (EXT) may define additional formats but must still follow the reference and type meta rules described above.  ","version":"0.15","tagName":"h2"},{"title":"Primitives‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#primitives","content":" boolean: 1 byte (0x00 or 0x01).byte: 1 byte.short: 2 bytes little endian.char: 2 bytes little endian (UTF-16 code unit).int: fixed: 4 bytes little endian.varint: signed varint32 (ZigZag) when compressInt is enabled. long: fixed: 8 bytes little endian.varint: signed varint64 (ZigZag) when longEncoding=VARINT.tagged: tagged int64 when longEncoding=TAGGED. float: IEEE 754 float32, little endian.double: IEEE 754 float64, little endian.  Varint encodings follow the xlang spec:docs/specification/xlang_serialization_spec.md#unsigned-varint32.  ","version":"0.15","tagName":"h3"},{"title":"String‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#string","content":" Strings are encoded as:  | varuint36_small: (num_bytes &lt;&lt; 2) | coder | string bytes |   coder: 2-bit value 0: LATIN11: UTF162: UTF8 num_bytes: byte length of the encoded string payload.  UTF16 is encoded as little endian 2-byte code units.  ","version":"0.15","tagName":"h3"},{"title":"Enum‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#enum","content":" If serializeEnumByName is enabled: write enum name as a meta string.Otherwise: write enum ordinal as varuint32 small7.  ","version":"0.15","tagName":"h3"},{"title":"Binary (byte[])‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#binary-byte","content":" Primitive byte arrays are encoded as:  | varuint32: num_bytes | raw bytes |   ","version":"0.15","tagName":"h3"},{"title":"Primitive arrays‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#primitive-arrays","content":" Primitive arrays use writePrimitiveArrayWithSize unless compression is enabled:  | varuint32: byte_length | raw bytes |   compressIntArray: int[] encoded as | varuint32: length | varint32... |.compressLongArray: long[] encoded as | varuint32: length | varint64/tagged... |.  ","version":"0.15","tagName":"h3"},{"title":"Object arrays‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#object-arrays","content":" Object arrays encode length and a monomorphic flag:  | varuint32_small7: (length &lt;&lt; 1) | mono_flag |   If mono_flag == 1, all elements share a known component serializer. Each element uses ref flags and the component serializer writes the value.If mono_flag == 0, each element uses ref flags and writes its own class info and data.  ","version":"0.15","tagName":"h3"},{"title":"Collections (List/Set)‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#collections-listset","content":" Collections encode length and a one-byte elements header:  | varuint32_small7: length | elements_header | [elem_class_info] | elements... |   elements_header bits (see CollectionFlags):  bit 0: TRACKING_REFbit 1: HAS_NULLbit 2: IS_DECL_ELEMENT_TYPEbit 3: IS_SAME_TYPE  If IS_SAME_TYPE is set and IS_DECL_ELEMENT_TYPE is not set, the element class info is written once before the elements. Element values then follow with either ref flags (if TRACKING_REF) or per-element null flags (if HAS_NULL).  If IS_SAME_TYPE is not set, each element is written with its own class info and data (and optionally ref flags).  ","version":"0.15","tagName":"h3"},{"title":"Maps‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#maps","content":" Maps encode entry count and then a sequence of chunks. Each chunk groups entries that share key and value types.  | varuint32_small7: size | chunk_1 | chunk_2 | ... | chunk (non-null entries): | header | chunk_size | [key_class_info] | [value_class_info] | entries... |   header bits (see MapFlags):  bit 0: TRACKING_KEY_REFbit 1: KEY_HAS_NULLbit 2: KEY_DECL_TYPEbit 3: TRACKING_VALUE_REFbit 4: VALUE_HAS_NULLbit 5: VALUE_DECL_TYPE  If KEY_DECL_TYPE or VALUE_DECL_TYPE is unset, the corresponding class info is written once at the start of the chunk. chunk_size is a single byte (1..255) and MAX_CHUNK_SIZE is 255.  Null key/value entries‚Äã  Entries with null key or null value are encoded as special single-entry chunks without achunk_size byte:  null key, non-null value: NULL_KEY_VALUE_DECL_TYPE* flags, then value payloadnull value, non-null key: NULL_VALUE_KEY_DECL_TYPE* flags, then key payloadnull key and null value: KV_NULL header only  These chunks always represent exactly one entry.  ","version":"0.15","tagName":"h3"},{"title":"Objects and structs‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#objects-and-structs","content":" Object values are encoded as:  | ref meta | type meta | field data |   Field data is written by the serializer selected by the class info. For standard object serialization:  Fields are sorted deterministically using DescriptorGrouper order: primitives, boxed primitives, built-ins, collections, maps, then other fields, with names sorted within each category.For compatible mode, MetaSharedSerializer uses ClassDef field metadata to read and skip unknown fields.For each field, the serializer uses field metadata (nullable, trackingRef, polymorphic) to decide whether to write ref flags and/or type meta before the field value.  ","version":"0.15","tagName":"h3"},{"title":"Extensions (EXT)‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#extensions-ext","content":" Extension types are encoded by their registered serializer. Type meta is still written before the value as described above. The serializer is responsible for the value layout.  ","version":"0.15","tagName":"h3"},{"title":"Out-of-band buffers‚Äã","type":1,"pageTitle":"Java Serialization Format","url":"/docs/specification/java_serialization_spec#out-of-band-buffers","content":" When a BufferCallback is provided, the oob flag is set in the header and serializers may emit buffer references instead of inline bytes (for example, large primitive arrays). The out-of-band buffer protocol is specific to the callback implementation; the main stream only contains references to those buffers. ","version":"0.15","tagName":"h2"},{"title":"Row Format","type":0,"sectionRef":"#","url":"/docs/specification/row_format_spec","content":"","keywords":"","version":"0.15"},{"title":"Overview‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#overview","content":" Apache Fory Row Format is a cache-friendly, random-access binary format designed for high-performance data processing. Unlike traditional serialization formats that require full deserialization, the row format enables:  Random Field Access: Read individual fields without deserializing the entire rowZero-Copy Operations: Direct memory access without data transformationCache-Friendly Layout: Optimized memory layout for CPU cache efficiencyCross-Language Support: Consistent binary format across Java, C++, and Python  Fory provides two row format variants:  Format\tLanguages\tUse CaseStandard Format\tJava, C++, Python\tCross-language compatibility Compact Format\tJava only\tSpace efficiency, smaller rows  ","version":"0.15","tagName":"h2"},{"title":"Format Comparison‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#format-comparison","content":" Feature\tStandard Format\tCompact FormatField Slot Size\tFixed 8 bytes\tNatural width (1, 2, 4, or 8 bytes) Null Bitmap Size\t8-byte aligned\tByte-aligned, can borrow padding Null Bitmap Position\tBefore field slots\tAfter field slots (at end) Fixed-Size Structs\tVariable region (offset+size)\tInline in fixed region Field Ordering\tSchema-defined order\tSorted by alignment All Non-Nullable\tBitmap still present\tBitmap skipped entirely Alignment\tStrict 8-byte\tRelaxed (2, 4, or 8-byte)    ","version":"0.15","tagName":"h2"},{"title":"Standard Row Format‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#standard-row-format","content":" The standard format prioritizes cross-language compatibility and simplicity with uniform 8-byte field slots.  ","version":"0.15","tagName":"h2"},{"title":"Design Principles‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#design-principles","content":" 8-Byte Alignment: All major structures are aligned to 8-byte boundaries for optimal memory accessFixed-Width Field Slots: Every field uses an 8-byte slot for uniform offset calculationNull Bitmap: Compact null tracking using bit vectorsRelative Offsets: Variable-length data uses relative offsets for sub-buffer navigation  ","version":"0.15","tagName":"h3"},{"title":"Row Binary Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#row-binary-layout","content":" A row stores structured data with the following layout:  +----------------+------------------+------------------+-----+------------------+------------------+ | Null Bitmap | Field 0 Slot | Field 1 Slot | ... | Field N-1 Slot | Variable Data | +----------------+------------------+------------------+-----+------------------+------------------+ | B bytes | 8 bytes | 8 bytes | | 8 bytes | Variable size |   Null Bitmap‚Äã  The null bitmap tracks which fields contain null values:  Size: ((num_fields + 63) / 64) * 8 bytes (rounded up to nearest 8-byte word)Encoding: Each bit corresponds to a field index Bit value 1 = field is nullBit value 0 = field is not null Bit Order: Bit 0 of the first byte corresponds to field 0  Example: For 10 fields, bitmap size = ((10 + 63) / 64) * 8 = 8 bytes  Field Slots‚Äã  Each field occupies a fixed 8-byte slot regardless of its actual data type:  Slot Offset: bitmap_size + field_index * 8Total Fixed Region: bitmap_size + num_fields * 8 bytes  Field Slot Contents by Type:  Type Category\tSlot ContentsFixed-width\tValue stored directly (zero-padded) Variable-width\tOffset + Size encoding (see below)  Variable-Width Data Encoding‚Äã  Variable-length fields (strings, arrays, maps, nested structs) store an offset-size pair in their slot:  +---------------------------+---------------------------+ | Relative Offset | Size | | (32 bits) | (32 bits) | +---------------------------+---------------------------+ |&lt;-------------- 64-bit field slot value --------------&gt;|   Relative Offset (upper 32 bits): Offset from the row's base addressSize (lower 32 bits): Size of the variable-width data in bytes  Encoding:  offset_and_size = (relative_offset &lt;&lt; 32) | size   Decoding:  relative_offset = (offset_and_size &gt;&gt; 32) &amp; 0xFFFFFFFF size = offset_and_size &amp; 0xFFFFFFFF   Variable Data Region‚Äã  Variable-length data is stored after the fixed region:  Data is written sequentially as fields are setEach variable-length value is padded to 8-byte alignmentPadding bytes are zeroed for deterministic output  ","version":"0.15","tagName":"h3"},{"title":"Array Binary Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#array-binary-layout","content":" Arrays store homogeneous sequences of elements:  +------------------+------------------+------------------+ | Element Count | Null Bitmap | Element Data | +------------------+------------------+------------------+ | 8 bytes | B bytes | Variable size |   Array Header‚Äã  Field\tSize\tDescriptionElement Count\t8 bytes\tNumber of elements (uint64) Null Bitmap\t((count + 63) / 64) * 8 bytes\tPer-element null flags  Header Size: 8 + ((num_elements + 63) / 64) * 8 bytes  Array Element Data‚Äã  Elements are stored contiguously after the header:  Fixed-width elements: Stored with their natural width (1, 2, 4, or 8 bytes)Variable-width elements: Stored as 8-byte offset+size pairs  Element Offset: header_size + element_index * element_size  Data Region Size: Rounded up to nearest 8-byte boundary  Array Element Sizes‚Äã  Element Type\tElement Sizebool\t1 byte int8\t1 byte int16\t2 bytes int32\t4 bytes int64\t8 bytes float32\t4 bytes float64\t8 bytes string/binary\t8 bytes (offset+size) array/map/struct\t8 bytes (offset+size)  ","version":"0.15","tagName":"h3"},{"title":"Map Binary Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#map-binary-layout","content":" Maps store key-value pairs as two separate arrays:  +------------------+------------------+------------------+ | Keys Array Size | Keys Array | Values Array | +------------------+------------------+------------------+ | 8 bytes | Variable size | Variable size |   Map Structure‚Äã  Field\tSize\tDescriptionKeys Array Size\t8 bytes\tTotal size of keys array in bytes Keys Array\tVariable\tFull array structure for keys Values Array\tVariable\tFull array structure for values  Keys Array Offset: base_offset + 8Values Array Offset: base_offset + 8 + keys_array_size  Both keys and values arrays follow the standard array binary layout.  ","version":"0.15","tagName":"h3"},{"title":"Nested Struct Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#nested-struct-layout","content":" Nested structs are stored as complete row structures within the variable data region:  Parent field slot contains offset+size pointing to nested rowNested row has its own null bitmap and field slotsSupports arbitrary nesting depth  Parent Row: +----------------+------------------+------------------+ | Null Bitmap | ... Slots ... | Nested Row Data | +----------------+------------------+------------------+ | ^ | offset+size | +-------------------&gt;+ Nested Row: +----------------+------------------+------------------+ | Null Bitmap | Field Slots | Variable Data | +----------------+------------------+------------------+     ","version":"0.15","tagName":"h3"},{"title":"Compact Row Format (Java Only)‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#compact-row-format-java-only","content":" The compact format provides space-efficient encoding with additional optimizations. It is currently implemented in Java only.  Note: The compact format is still under development and may not be stable yet.  ","version":"0.15","tagName":"h2"},{"title":"Design Principles‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#design-principles-1","content":" Natural Width Storage: Fixed-size fields use their natural byte width instead of 8 bytesAlignment-Based Field Sorting: Fields are sorted by alignment requirements to minimize paddingConditional Null Bitmap: Null bitmap is omitted when all fields are non-nullableInline Fixed-Size Structs: Nested structs with all fixed-size fields are stored inline  ","version":"0.15","tagName":"h3"},{"title":"Compact Row Binary Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#compact-row-binary-layout","content":" +------------------+------------------+-----+------------------+----------------+------------------+ | Field 0 Value | Field 1 Value | ... | Field N-1 Value | Null Bitmap | Variable Data | +------------------+------------------+-----+------------------+----------------+------------------+ | W0 bytes | W1 bytes | | WN-1 bytes | B bytes (opt) | Variable size |   Key Differences from Standard Format‚Äã  Field Slot Sizes: Each field uses its natural width (Wi = type width or 8 for variable)Null Bitmap Position: Placed after field slots, can borrow alignment paddingField Order: Fields are sorted by alignment (8-byte ‚Üí 4-byte ‚Üí 2-byte ‚Üí 1-byte ‚Üí variable)Conditional Bitmap: Skipped entirely if all fields are non-nullable  Null Bitmap (Compact)‚Äã  Size: (num_nullable_fields + 7) / 8 bytes (byte-aligned, not 8-byte aligned)Skipped: When all fields are primitive/non-nullablePosition: After all fixed-size field slots, can use alignment padding space  Field Sorting Algorithm‚Äã  Fields are sorted to minimize padding and optimize alignment:  Priority order (highest to lowest): 1. Fields with 8-byte alignment (int64, float64, variable-width) 2. Fields with 4-byte alignment (int32, float32) 3. Fields with 2-byte alignment (int16) 4. Fields with 1-byte alignment (int8, bool)   Within each alignment group, larger fields come first.  Fixed-Size Struct Inlining‚Äã  Nested structs with all fixed-size fields are stored inline in the parent row:  Standard Format (nested struct with 2 int32 fields):  Parent slot: [offset (4 bytes) | size (4 bytes)] ‚Üí Points to nested row (8+ bytes elsewhere)   Compact Format (same nested struct):  Parent slot: [int32 field 0 | int32 field 1] ‚Üí 8 bytes total, inline   This eliminates the offset+size indirection for fixed-size nested structures.  Fixed-Width Calculation‚Äã  A field's fixed width is determined recursively:  Primitive types: Natural byte width (1, 2, 4, or 8)Struct types: Sum of all child fixed widths (if all children are fixed-width)Variable types (string, array, map): Returns -1 (uses 8-byte offset+size slot)  fixed_width(field) = if primitive: type_width if struct and all_children_fixed: header_bytes + sum(fixed_width(child) for each child) else: -1 (variable, uses 8-byte slot)   ","version":"0.15","tagName":"h3"},{"title":"Compact Array Binary Layout‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#compact-array-binary-layout","content":" +------------------+------------------+------------------+ | Element Count | Null Bitmap | Element Data | +------------------+------------------+------------------+ | 4 bytes | B bytes (opt) | Variable size |   Compact Array Header‚Äã  Field\tSize\tDescriptionElement Count\t4 bytes\tNumber of elements (int32) Null Bitmap\t(count + 7) / 8 bytes (opt)\tPer-element null flags  Header Size Calculation:  header_size = 4 + (element_nullable ? (num_elements + 7) / 8 : 0) // Round to 8-byte boundary only if element width is 8-byte aligned if (fixed_width % 8 == 0): header_size = round_to_8_bytes(header_size)   Key Differences from Standard Array‚Äã  Element Count: 4 bytes instead of 8 bytesNull Bitmap: Byte-aligned, skipped if elements are non-nullableFixed-Size Structs: Inline storage for fixed-width struct elements    ","version":"0.15","tagName":"h3"},{"title":"Common Specifications‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#common-specifications","content":" The following specifications apply to both standard and compact formats.  ","version":"0.15","tagName":"h2"},{"title":"Type Encoding‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#type-encoding","content":" Primitive Types‚Äã  Type\tWidth\tEncodingbool\t1 byte\t0x00 (false) or 0x01 (true) int8\t1 byte\tTwo's complement int16\t2 bytes\tTwo's complement, little-endian int32\t4 bytes\tTwo's complement, little-endian int64\t8 bytes\tTwo's complement, little-endian float32\t4 bytes\tIEEE 754 single precision float64\t8 bytes\tIEEE 754 double precision  Temporal Types‚Äã  Type\tWidth\tEncodingtimestamp\t8 bytes\tMicroseconds since Unix epoch (int64) date32\t4 bytes\tDays since Unix epoch (int32) duration\t8 bytes\tDuration in microseconds (int64)  String and Binary‚Äã  Encoding: UTF-8 for strings, raw bytes for binaryStorage: Offset+size pair in field slot, data in variable regionPadding: Data padded to 8-byte alignment (standard) or natural alignment (compact)  ","version":"0.15","tagName":"h3"},{"title":"Null Handling‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#null-handling","content":" Row Null Handling‚Äã  Null fields have their corresponding bit set to 1 in the null bitmapField slot contents are undefined for null fields (standard) or zeroed (compact)Reading a null field returns a null/empty value indicator  Array Null Handling‚Äã  Null elements have their corresponding bit set to 1 in the array's null bitmapElement data is undefined for null elementsCompact format: Bitmap skipped if elements are non-nullable  Variable-Width Null Semantics‚Äã  When reading variable-width data from a null field:  Returns size of -1 or equivalent null indicatorNo data access is performed  ","version":"0.15","tagName":"h3"},{"title":"Alignment and Padding‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#alignment-and-padding","content":" Standard Format Alignment‚Äã  Null Bitmap: Size rounded to 8-byte boundaryField Slots: Always 8 bytes eachVariable Data: Each value padded to 8-byte boundaryArray Data: Total data region padded to 8-byte boundary  Compact Format Alignment‚Äã  Field Slots: Natural width (1, 2, 4, or 8 bytes)Null Bitmap: Byte-aligned, placed after fieldsVariable Data: Padded to 8-byte boundary only when neededHeader: May use relaxed alignment for smaller overhead  Padding Bytes‚Äã  All padding bytes must be set to zeroEnsures deterministic serialization outputPrevents information leakage from uninitialized memory  ","version":"0.15","tagName":"h3"},{"title":"Size Calculations‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#size-calculations","content":" ","version":"0.15","tagName":"h2"},{"title":"Standard Row Size‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#standard-row-size","content":" row_size = bitmap_size + num_fields * 8 + variable_data_size where: bitmap_size = ((num_fields + 63) / 64) * 8 variable_data_size = sum of (padded_size for each variable field) padded_size = ((size + 7) / 8) * 8   ","version":"0.15","tagName":"h3"},{"title":"Compact Row Size‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#compact-row-size","content":" row_size = fixed_region_size + bitmap_size + variable_data_size where: fixed_region_size = sum of (fixed_width(field) or 8 for each field) bitmap_size = all_non_nullable ? 0 : (num_nullable_fields + 7) / 8 // May be rounded to 8-byte boundary if has variable fields   ","version":"0.15","tagName":"h3"},{"title":"Standard Array Size‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#standard-array-size","content":" array_size = header_size + data_size where: header_size = 8 + ((num_elements + 63) / 64) * 8 data_size = ((num_elements * element_size + 7) / 8) * 8   ","version":"0.15","tagName":"h3"},{"title":"Compact Array Size‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#compact-array-size","content":" array_size = header_size + data_size where: header_size = 4 + (element_nullable ? (num_elements + 7) / 8 : 0) // header_size rounded to 8 if element_width % 8 == 0 data_size = num_elements * element_width   ","version":"0.15","tagName":"h3"},{"title":"Map Size‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#map-size","content":" map_size = 8 + keys_array_size + values_array_size   ","version":"0.15","tagName":"h3"},{"title":"Summary Tables‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#summary-tables","content":" ","version":"0.15","tagName":"h2"},{"title":"Layout Summary‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#layout-summary","content":" Component\tStandard Format\tCompact FormatRow Header\t((N + 63) / 64) * 8 bytes\t0 or (N + 7) / 8 bytes (at end) Row Field Slots\tN * 8 bytes\tsum(field_widths) bytes Array Header\t8 + ((E + 63) / 64) * 8 bytes\t4 + (E + 7) / 8 bytes (if nullable) Array Elements\tE * element_size (8-aligned)\tE * element_width Map Header\t8 bytes\t8 bytes Offset+Size Pair\t8 bytes (32-bit offset + size)\t8 bytes (same)  Where N = number of fields, E = number of elements  ","version":"0.15","tagName":"h3"},{"title":"Type Width Summary‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#type-width-summary","content":" Category\tStorage Width\tStandard Slot\tCompact Slotbool\t1 byte\t8 bytes\t1 byte int8\t1 byte\t8 bytes\t1 byte int16\t2 bytes\t8 bytes\t2 bytes int32\t4 bytes\t8 bytes\t4 bytes int64\t8 bytes\t8 bytes\t8 bytes float32\t4 bytes\t8 bytes\t4 bytes float64\t8 bytes\t8 bytes\t8 bytes string/binary\tVariable\t8 bytes\t8 bytes array\tVariable\t8 bytes\t8 bytes map\tVariable\t8 bytes\t8 bytes struct\tVariable\t8 bytes\tinline or 8  ","version":"0.15","tagName":"h3"},{"title":"Implementation Notes‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#implementation-notes","content":" ","version":"0.15","tagName":"h2"},{"title":"Endianness‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#endianness","content":" All multi-byte integers are stored in little-endian formatFloating-point values use native IEEE 754 representation  ","version":"0.15","tagName":"h3"},{"title":"Memory Safety‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#memory-safety","content":" Writers must zero padding bytes to prevent information leakageReaders must validate offsets and sizes before accessing dataBuffer bounds checking is required for untrusted input  ","version":"0.15","tagName":"h3"},{"title":"Performance Considerations‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#performance-considerations","content":" Standard Format:  Fixed 8-byte slots enable O(1) field access with simple arithmetic8-byte alignment optimizes CPU cache line usageBest for cross-language interoperability  Compact Format:  Smaller row sizes reduce memory bandwidthField sorting minimizes padding wasteInline structs eliminate pointer chasingRelaxed alignment may have slight CPU overhead on some architectures  ","version":"0.15","tagName":"h3"},{"title":"When to Use Each Format‚Äã","type":1,"pageTitle":"Row Format","url":"/docs/specification/row_format_spec#when-to-use-each-format","content":" Scenario\tRecommended FormatCross-language data exchange\tStandard Java-only, memory-constrained\tCompact Many small primitive fields\tCompact Many nested fixed-size structs\tCompact Maximum read performance\tStandard Interoperability with C++/Python\tStandard ","version":"0.15","tagName":"h3"},{"title":"Xlang Implementation Guide","type":0,"sectionRef":"#","url":"/docs/specification/xlang_implementation_guide","content":"","keywords":"","version":"0.15"},{"title":"Implementation guidelines‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/specification/xlang_implementation_guide#implementation-guidelines","content":" ","version":"0.15","tagName":"h2"},{"title":"How to reduce memory read/write code‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/specification/xlang_implementation_guide#how-to-reduce-memory-readwrite-code","content":" Try to merge multiple bytes into an int/long write before writing to reduce memory IO and bound check cost.Read multiple bytes as an int/long, then split into multiple bytes to reduce memory IO and bound check cost.Try to use one varint/long to write flags and length together to save one byte cost and reduce memory io.Condition branches are less expensive compared to memory IO cost unless there are too many branches.  ","version":"0.15","tagName":"h3"},{"title":"Fast deserialization for static languages without runtime codegen support‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/specification/xlang_implementation_guide#fast-deserialization-for-static-languages-without-runtime-codegen-support","content":" For type evolution, the serializer will encode the type meta into the serialized data. The deserializer will compare this meta with class meta in the current process, and use the diff to determine how to deserialize the data.  For java/javascript/python, we can use the diff to generate serializer code at runtime and load it as class/function for deserialization. In this way, the type evolution will be as fast as type consist mode.  For C++/Rust, we can't generate the serializer code at runtime. So we need to generate the code at compile-time using meta programming. But at that time, we don't know the type schema in other processes, so we can't generate the serializer code for such inconsistent types. We may need to generate the code which has a loop and compare field name one by one to decide whether to deserialize and assign the field or skip the field value.  One fast way is that we can optimize the string comparison into jump instructions:  Assume the current type has n fields, and the peer type has n1 fields.Generate an auto growing field id from 0 for every sorted field in the current type at the compile time.Compare the received type meta with current type, generate same id if the field name is same, otherwise generate an auto growing id starting from n, cache this meta at runtime.Iterate the fields of received type meta, use a switch to compare the field id to deserialize data and assign/skip field value. Continuous field id will be optimized into jump in switch block, so it will very fast.  Here is an example, suppose process A has a class Foo with version 1 defined as Foo1, process B has a class Foowith version 2 defined as Foo2:  // class Foo with version 1 class Foo1 { int32_t v1; // id 0 std::string v2; // id 1 }; // class Foo with version 2 class Foo2 { // id 0, but will have id 2 in process A bool v0; // id 1, but will have id 0 in process A int32_t v1; // id 2, but will have id 3 in process A int64_t long_value; // id 3, but will have id 1 in process A std::string v2; // id 4, but will have id 4 in process A std::vector&lt;std::string&gt; list; };   When process A received serialized Foo2 from process B, here is how it deserialize the data:  Foo1 foo1 = ...; const std::vector&lt;fory::FieldInfo&gt; &amp;field_infos = type_meta.field_infos; for (const auto &amp;field_info : field_infos) { switch (field_info.field_id) { case 0: foo1.v1 = buffer.read_varint32(); break; case 1: foo1.v2 = fory.read_string(); break; default: fory.skip_data(field_info); } }   ","version":"0.15","tagName":"h3"},{"title":"Implementation Checklist for New Languages‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/specification/xlang_implementation_guide#implementation-checklist-for-new-languages","content":" This section provides a step-by-step guide for implementing Fory xlang serialization in a new language.  ","version":"0.15","tagName":"h2"},{"title":"Phase 1: Core Infrastructure‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/specification/xlang_implementation_guide#phase-1-core-infrastructure","content":" Buffer Implementation Create a byte buffer with read/write cursor tracking Implement little-endian byte order for all multi-byte writes Implement write_int8, write_int16, write_int32, write_int64 Implement write_float32, write_float64 Implement read_* counterparts for all write methods Implement buffer growth strategy (e.g., doubling) Varint Encoding Implement write_varuint32 / read_varuint32 Implement write_varint32 / read_varint32 (with ZigZag) Implement write_varuint64 / read_varuint64 Implement write_varint64 / read_varint64 (with ZigZag) Implement write_varuint36_small / read_varuint36_small (for strings) Optionally implement Hybrid encoding (TAGGED_INT64/TAGGED_UINT64) for int64 Header Handling Write/read bitmap flags (null, xlang, oob)  ","version":"0.15","tagName":"h3"},{"title":"Phase 2: Basic Type Serializers‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/specification/xlang_implementation_guide#phase-2-basic-type-serializers","content":" Primitive Types bool (1 byte: 0 or 1) int8, int16, int32, int64 (little endian) float32, float64 (IEEE 754, little endian) String Serialization Implement string header: (byte_length &lt;&lt; 2) | encoding Support UTF-8 encoding (required for xlang) Optionally support LATIN1 and UTF-16 Temporal Types Duration (seconds + nanoseconds) Timestamp (seconds + nanoseconds since epoch) Date (days since epoch) Reference Tracking Implement write-side object tracking (object ‚Üí ref_id map) Implement read-side object tracking (ref_id ‚Üí object list) Handle all four reference flags: NULL(-3), REF(-2), NOT_NULL(-1), REF_VALUE(0) Support disabling reference tracking per-type or globally  ","version":"0.15","tagName":"h3"},{"title":"Phase 3: Collection Types‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/specification/xlang_implementation_guide#phase-3-collection-types","content":" List/Array Serialization Write length as varuint32 Write elements header byte Handle homogeneous vs heterogeneous elements Handle null elements Map Serialization Write total size as varuint32 Implement chunk-based format (max 255 pairs per chunk) Write KV header byte per chunk Handle key and value type variations Set Serialization Same format as List (reuse implementation)  ","version":"0.15","tagName":"h3"},{"title":"Phase 4: Meta String Encoding‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/specification/xlang_implementation_guide#phase-4-meta-string-encoding","content":" Meta strings are required for enum and struct serialization (encoding field names, type names, namespaces).  Meta String Compression Implement LOWER_SPECIAL encoding (5 bits/char) Implement LOWER_UPPER_DIGIT_SPECIAL encoding (6 bits/char) Implement FIRST_TO_LOWER_SPECIAL encoding Implement ALL_TO_LOWER_SPECIAL encoding Implement encoding selection algorithm Implement meta string deduplication  ","version":"0.15","tagName":"h3"},{"title":"Phase 5: Enum Serialization‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/specification/xlang_implementation_guide#phase-5-enum-serialization","content":" Enum Serialization Write ordinal as varuint32 Support named enum (namespace + type name)  ","version":"0.15","tagName":"h3"},{"title":"Phase 6: Struct Serialization‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/specification/xlang_implementation_guide#phase-6-struct-serialization","content":" Type Registration Support registration by numeric ID Support registration by namespace + type name Maintain type ‚Üí serializer mapping Generate type IDs: write internal type ID, then user_type_id as varuint32 Field Ordering Implement the spec-defined grouping and ordering (primitive/boxed/built-in, collections/maps, other) Use a stable comparator within each group (type ID and name) Use tag ID or snake_case field name as field identifier for fingerprints Schema Consistent Mode If class-version check is enabled, compute schema hash from field identifiers Write 4-byte schema hash before fields Serialize fields in Fory order Compatible/Meta Share Mode Implement shared TypeDef stream (inline new TypeDefs, index references) Map fields by name or tag ID, skip unknown fields Apply nullable/ref flags from TypeDef metadata  ","version":"0.15","tagName":"h3"},{"title":"Phase 7: Other types‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/specification/xlang_implementation_guide#phase-7-other-types","content":" Binary/Array Types   Primitive arrays (direct buffer copy) Multi-dimensional arrays as nested lists (no tensor encoding)  ","version":"0.15","tagName":"h3"},{"title":"Testing Strategy‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/specification/xlang_implementation_guide#testing-strategy","content":" Cross-Language Compatibility Tests Serialize in new language, deserialize in Java/Python Serialize in Java/Python, deserialize in new language Test all primitive types Test strings with various encodings Test collections (empty, single, multiple elements) Test maps with various key/value types Test nested structs Test circular references (if supported)  ","version":"0.15","tagName":"h3"},{"title":"Language-Specific Implementation Notes‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/specification/xlang_implementation_guide#language-specific-implementation-notes","content":" ","version":"0.15","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/specification/xlang_implementation_guide#java","content":" Uses runtime code generation (JIT) for maximum performanceSupports all reference tracking modesUses internal String coder for encoding selectionThread-safe via ThreadSafeFory wrapper  ","version":"0.15","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/specification/xlang_implementation_guide#python","content":" Two modes: Pure Python (debugging) and Cython (performance)Uses id(obj) for reference trackingLatin1/UTF-16/UTF-8 encoding for all strings in xlang modedataclass support via code generation  ","version":"0.15","tagName":"h3"},{"title":"C++‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/specification/xlang_implementation_guide#c","content":" Compile-time reflection via macros (FORY_STRUCT)Template meta programming for type dispatch and serializer selectionUses std::shared_ptr for reference trackingCompile-time field orderingNo runtime code generation  ","version":"0.15","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/specification/xlang_implementation_guide#rust","content":" Derive macros for automatic serialization (#[derive(ForyObject)])Uses Rc&lt;T&gt; / Arc&lt;T&gt; for reference trackingThread-local context caching for performanceCompile-time field ordering  ","version":"0.15","tagName":"h3"},{"title":"Go‚Äã","type":1,"pageTitle":"Xlang Implementation Guide","url":"/docs/specification/xlang_implementation_guide#go","content":" Reflection-based and codegen-based modesStruct tags for field annotationsInterface types for polymorphism ","version":"0.15","tagName":"h3"},{"title":"Serialization","type":0,"sectionRef":"#","url":"/docs/guide/xlang/serialization","content":"","keywords":"","version":"0.15"},{"title":"Serialize Built-in Types‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/guide/xlang/serialization#serialize-built-in-types","content":" Common types can be serialized automatically without registration: primitive numeric types, string, binary, array, list, map, and more.  ","version":"0.15","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/guide/xlang/serialization#java","content":" import org.apache.fory.*; import org.apache.fory.config.*; import java.util.*; public class Example1 { public static void main(String[] args) { Fory fory = Fory.builder().withLanguage(Language.XLANG).build(); List&lt;Object&gt; list = ofArrayList(true, false, &quot;str&quot;, -1.1, 1, new int[100], new double[20]); byte[] bytes = fory.serialize(list); // bytes can be deserialized by other languages fory.deserialize(bytes); Map&lt;Object, Object&gt; map = new HashMap&lt;&gt;(); map.put(&quot;k1&quot;, &quot;v1&quot;); map.put(&quot;k2&quot;, list); map.put(&quot;k3&quot;, -1); bytes = fory.serialize(map); // bytes can be deserialized by other languages fory.deserialize(bytes); } }   ","version":"0.15","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/guide/xlang/serialization#python","content":" import pyfory import numpy as np fory = pyfory.Fory(xlang=True) object_list = [True, False, &quot;str&quot;, -1.1, 1, np.full(100, 0, dtype=np.int32), np.full(20, 0.0, dtype=np.double)] data = fory.serialize(object_list) # bytes can be deserialized by other languages new_list = fory.deserialize(data) object_map = {&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: object_list, &quot;k3&quot;: -1} data = fory.serialize(object_map) # bytes can be deserialized by other languages new_map = fory.deserialize(data) print(new_map)   ","version":"0.15","tagName":"h3"},{"title":"Go‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/guide/xlang/serialization#go","content":" package main import forygo &quot;github.com/apache/fory/go/fory&quot; import &quot;fmt&quot; func main() { list := []any{true, false, &quot;str&quot;, -1.1, 1, make([]int32, 10), make([]float64, 20)} fory := forygo.NewFory(forygo.WithXlang(true)) bytes, err := fory.Marshal(list) if err != nil { panic(err) } var newValue any // bytes can be deserialized by other languages if err := fory.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) dict := map[string]any{ &quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: list, &quot;k3&quot;: -1, } bytes, err = fory.Marshal(dict) if err != nil { panic(err) } // bytes can be deserialized by other languages if err := fory.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) }   ","version":"0.15","tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/guide/xlang/serialization#javascript","content":" import Fory from &quot;@apache-fory/fory&quot;; /** * @apache-fory/hps use v8's fast-calls-api that can be called directly by jit, * ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment. * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from &quot;@apache-fory/hps&quot;; const fory = new Fory({ hps }); const input = fory.serialize(&quot;hello fory&quot;); const result = fory.deserialize(input); console.log(result);   ","version":"0.15","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/guide/xlang/serialization#rust","content":" use fory::Fory; fn run() { let fory = Fory::default().xlang(true); let bin = fory.serialize(&amp;&quot;hello&quot;.to_string()).expect(&quot;serialize success&quot;); let obj: String = fory.deserialize(&amp;bin).expect(&quot;deserialize success&quot;); assert_eq!(&quot;hello&quot;.to_string(), obj); }   ","version":"0.15","tagName":"h3"},{"title":"Serialize Custom Types‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/guide/xlang/serialization#serialize-custom-types","content":" User-defined types must be registered using the register API to establish the mapping relationship between types in different languages. Use consistent type names across all languages.  ","version":"0.15","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/guide/xlang/serialization#java-1","content":" import org.apache.fory.*; import org.apache.fory.config.*; import java.util.*; public class Example2 { public static class SomeClass1 { Object f1; Map&lt;Byte, Integer&gt; f2; } public static class SomeClass2 { Object f1; String f2; List&lt;Object&gt; f3; Map&lt;Byte, Integer&gt; f4; Byte f5; Short f6; Integer f7; Long f8; Float f9; Double f10; short[] f11; List&lt;Short&gt; f12; } public static Object createObject() { SomeClass1 obj1 = new SomeClass1(); obj1.f1 = true; obj1.f2 = ofHashMap((byte) -1, 2); SomeClass2 obj = new SomeClass2(); obj.f1 = obj1; obj.f2 = &quot;abc&quot;; obj.f3 = ofArrayList(&quot;abc&quot;, &quot;abc&quot;); obj.f4 = ofHashMap((byte) 1, 2); obj.f5 = Byte.MAX_VALUE; obj.f6 = Short.MAX_VALUE; obj.f7 = Integer.MAX_VALUE; obj.f8 = Long.MAX_VALUE; obj.f9 = 1.0f / 2; obj.f10 = 1 / 3.0; obj.f11 = new short[]{(short) 1, (short) 2}; obj.f12 = ofArrayList((short) -1, (short) 4); return obj; } // mvn exec:java -Dexec.mainClass=&quot;org.apache.fory.examples.Example2&quot; public static void main(String[] args) { Fory fory = Fory.builder().withLanguage(Language.XLANG).build(); fory.register(SomeClass1.class, &quot;example.SomeClass1&quot;); fory.register(SomeClass2.class, &quot;example.SomeClass2&quot;); byte[] bytes = fory.serialize(createObject()); // bytes can be deserialized by other languages System.out.println(fory.deserialize(bytes)); } }   ","version":"0.15","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/guide/xlang/serialization#python-1","content":" from dataclasses import dataclass from typing import List, Dict, Any import pyfory, array @dataclass class SomeClass1: f1: Any f2: Dict[pyfory.Int8Type, pyfory.Int32Type] @dataclass class SomeClass2: f1: Any = None f2: str = None f3: List[str] = None f4: Dict[pyfory.Int8Type, pyfory.Int32Type] = None f5: pyfory.Int8Type = None f6: pyfory.Int16Type = None f7: pyfory.Int32Type = None # int type will be taken as `pyfory.Int64Type`. # use `pyfory.Int32Type` for type hint if peer uses more narrow type. f8: int = None f9: pyfory.Float32Type = None # float type will be taken as `pyfory.Float64Type` f10: float = None f11: pyfory.Int16ArrayType = None f12: List[pyfory.Int16Type] = None if __name__ == &quot;__main__&quot;: f = pyfory.Fory(xlang=True) f.register_type(SomeClass1, typename=&quot;example.SomeClass1&quot;) f.register_type(SomeClass2, typename=&quot;example.SomeClass2&quot;) obj1 = SomeClass1(f1=True, f2={-1: 2}) obj = SomeClass2( f1=obj1, f2=&quot;abc&quot;, f3=[&quot;abc&quot;, &quot;abc&quot;], f4={1: 2}, f5=2 ** 7 - 1, f6=2 ** 15 - 1, f7=2 ** 31 - 1, f8=2 ** 63 - 1, f9=1.0 / 2, f10=1 / 3.0, f11=array.array(&quot;h&quot;, [1, 2]), f12=[-1, 4], ) data = f.serialize(obj) # bytes can be deserialized by other languages print(f.deserialize(data))   ","version":"0.15","tagName":"h3"},{"title":"Go‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/guide/xlang/serialization#go-1","content":" package main import forygo &quot;github.com/apache/fory/go/fory&quot; import &quot;fmt&quot; func main() { type SomeClass1 struct { F1 any F2 map[int8]int32 } type SomeClass2 struct { F1 any F2 string F3 []any F4 map[int8]int32 F5 int8 F6 int16 F7 int32 F8 int64 F9 float32 F10 float64 F11 []int16 F12 []int16 } serializer := forygo.NewFory(forygo.WithXlang(true)) if err := serializer.RegisterNamedStruct(SomeClass1{}, &quot;example.SomeClass1&quot;); err != nil { panic(err) } if err := serializer.RegisterNamedStruct(SomeClass2{}, &quot;example.SomeClass2&quot;); err != nil { panic(err) } obj1 := &amp;SomeClass1{F1: true, F2: map[int8]int32{-1: 2}} obj := &amp;SomeClass2{ F1: obj1, F2: &quot;abc&quot;, F3: []any{&quot;abc&quot;, &quot;abc&quot;}, F4: map[int8]int32{1: 2}, F5: 127, F6: 32767, F7: 2147483647, F8: 9223372036854775807, F9: 1.0 / 2, F10: 1.0 / 3.0, F11: []int16{1, 2}, F12: []int16{-1, 4}, } bytes, err := serializer.Marshal(obj) if err != nil { panic(err) } var newValue any // bytes can be deserialized by other languages if err := serializer.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) }   ","version":"0.15","tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/guide/xlang/serialization#javascript-1","content":" import Fory, { Type, InternalSerializerType } from &quot;@apache-fory/fory&quot;; /** * @apache-fory/hps use v8's fast-calls-api that can be called directly by jit, * ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment. * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from &quot;@apache-fory/hps&quot;; // Describe data structures using JSON schema const description = Type.object(&quot;example.foo&quot;, { foo: Type.string(), }); const fory = new Fory({ hps }); const { serialize, deserialize } = fory.registerSerializer(description); const input = serialize({ foo: &quot;hello fory&quot; }); const result = deserialize(input); console.log(result);   ","version":"0.15","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/guide/xlang/serialization#rust-1","content":" use chrono::{NaiveDate, NaiveDateTime}; use fory::{Fory, ForyObject}; use std::collections::HashMap; #[test] fn complex_struct() { #[derive(ForyObject, Debug, PartialEq)] struct Animal { category: String, } #[derive(ForyObject, Debug, PartialEq)] struct Person { c1: Vec&lt;u8&gt;, // binary c2: Vec&lt;i16&gt;, // primitive array animal: Vec&lt;Animal&gt;, c3: Vec&lt;Vec&lt;u8&gt;&gt;, name: String, c4: HashMap&lt;String, String&gt;, age: u16, op: Option&lt;String&gt;, op2: Option&lt;String&gt;, date: NaiveDate, time: NaiveDateTime, c5: f32, c6: f64, } let person: Person = Person { c1: vec![1, 2, 3], c2: vec![5, 6, 7], c3: vec![vec![1, 2], vec![1, 3]], animal: vec![Animal { category: &quot;Dog&quot;.to_string(), }], c4: HashMap::from([ (&quot;hello1&quot;.to_string(), &quot;hello2&quot;.to_string()), (&quot;hello2&quot;.to_string(), &quot;hello3&quot;.to_string()), ]), age: 12, name: &quot;helo&quot;.to_string(), op: Some(&quot;option&quot;.to_string()), op2: None, date: NaiveDate::from_ymd_opt(2025, 12, 12).unwrap(), time: NaiveDateTime::from_timestamp_opt(1689912359, 0).unwrap(), c5: 2.0, c6: 4.0, }; let mut fory = Fory::default().xlang(true); fory .register_by_namespace::&lt;Animal&gt;(&quot;example&quot;, &quot;foo2&quot;) .expect(&quot;register Animal&quot;); fory .register_by_namespace::&lt;Person&gt;(&quot;example&quot;, &quot;foo&quot;) .expect(&quot;register Person&quot;); let bin = fory.serialize(&amp;person).expect(&quot;serialize success&quot;); let obj: Person = fory.deserialize(&amp;bin).expect(&quot;deserialize success&quot;); assert_eq!(person, obj); }   ","version":"0.15","tagName":"h3"},{"title":"Serialize Shared and Circular References‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/guide/xlang/serialization#serialize-shared-and-circular-references","content":" Shared references and circular references can be serialized automatically with no duplicate data or recursion errors. Enable reference tracking to use this feature.  ","version":"0.15","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/guide/xlang/serialization#java-2","content":" import org.apache.fory.*; import org.apache.fory.config.*; import java.util.*; public class ReferenceExample { public static class SomeClass { SomeClass f1; Map&lt;String, String&gt; f2; Map&lt;String, String&gt; f3; } public static Object createObject() { SomeClass obj = new SomeClass(); obj.f1 = obj; obj.f2 = ofHashMap(&quot;k1&quot;, &quot;v1&quot;, &quot;k2&quot;, &quot;v2&quot;); obj.f3 = obj.f2; return obj; } // mvn exec:java -Dexec.mainClass=&quot;org.apache.fory.examples.ReferenceExample&quot; public static void main(String[] args) { Fory fory = Fory.builder().withLanguage(Language.XLANG) .withRefTracking(true).build(); fory.register(SomeClass.class, &quot;example.SomeClass&quot;); byte[] bytes = fory.serialize(createObject()); // bytes can be deserialized by other languages System.out.println(fory.deserialize(bytes)); } }   ","version":"0.15","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/guide/xlang/serialization#python-2","content":" from typing import Dict import pyfory class SomeClass: f1: &quot;SomeClass&quot; f2: Dict[str, str] f3: Dict[str, str] fory = pyfory.Fory(xlang=True, ref=True) fory.register_type(SomeClass, typename=&quot;example.SomeClass&quot;) obj = SomeClass() obj.f2 = {&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: &quot;v2&quot;} obj.f1, obj.f3 = obj, obj.f2 data = fory.serialize(obj) # bytes can be deserialized by other languages print(fory.deserialize(data))   ","version":"0.15","tagName":"h3"},{"title":"Go‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/guide/xlang/serialization#go-2","content":" package main import forygo &quot;github.com/apache/fory/go/fory&quot; import &quot;fmt&quot; func main() { type SomeClass struct { F1 *SomeClass F2 map[string]string F3 map[string]string } fory := forygo.NewFory( forygo.WithXlang(true), forygo.WithTrackRef(true), ) if err := fory.RegisterStruct(SomeClass{}, 65); err != nil { panic(err) } value := &amp;SomeClass{F2: map[string]string{&quot;k1&quot;: &quot;v1&quot;, &quot;k2&quot;: &quot;v2&quot;}} value.F3 = value.F2 value.F1 = value bytes, err := fory.Marshal(value) if err != nil { panic(err) } var newValue any // bytes can be deserialized by other languages if err := fory.Unmarshal(bytes, &amp;newValue); err != nil { panic(err) } fmt.Println(newValue) }   ","version":"0.15","tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/guide/xlang/serialization#javascript-2","content":" import Fory, { Type } from &quot;@apache-fory/fory&quot;; /** * @apache-fory/hps use v8's fast-calls-api that can be called directly by jit, * ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment. * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from &quot;@apache-fory/hps&quot;; const description = Type.object(&quot;example.foo&quot;, { foo: Type.string(), bar: Type.object(&quot;example.foo&quot;), }); const fory = new Fory({ hps }); const { serialize, deserialize } = fory.registerSerializer(description); const data: any = { foo: &quot;hello fory&quot;, }; data.bar = data; const input = serialize(data); const result = deserialize(input); console.log(result.bar.foo === result.foo);   ","version":"0.15","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/guide/xlang/serialization#rust-2","content":" Circular references cannot be implemented in Rust due to ownership restrictions.  ","version":"0.15","tagName":"h3"},{"title":"See Also‚Äã","type":1,"pageTitle":"Serialization","url":"/docs/guide/xlang/serialization#see-also","content":" Zero-Copy Serialization - Out-of-band serialization for large dataType Mapping - Cross-language type mapping referenceGetting Started - Installation and setupXlang Serialization Specification - Binary protocol details ","version":"0.15","tagName":"h2"},{"title":"Xlang Type Mapping","type":0,"sectionRef":"#","url":"/docs/specification/xlang_type_mapping","content":"","keywords":"","version":"0.15"},{"title":"User Type IDs‚Äã","type":1,"pageTitle":"Xlang Type Mapping","url":"/docs/specification/xlang_type_mapping#user-type-ids","content":" When registering user types (struct/ext/enum/union), the internal type ID is written as the 8-bit kind, and the user type ID is written separately as an unsigned varint32. There is no bit shift/packing, and user_type_id can be in the range 0~0xFFFFFFFE.  Examples:  User ID\tType\tInternal ID\tEncoded User ID\tDecimal0\tSTRUCT\t27\t0\t0 0\tENUM\t25\t0\t0 1\tSTRUCT\t27\t1\t1 1\tCOMPATIBLE_STRUCT\t28\t1\t1 2\tNAMED_STRUCT\t29\t2\t2  When reading type IDs:  Read internal type ID from the type ID field.If the internal type is a user-registered kind, read user_type_id as varuint32.  ","version":"0.15","tagName":"h2"},{"title":"Type Mapping‚Äã","type":1,"pageTitle":"Xlang Type Mapping","url":"/docs/specification/xlang_type_mapping#type-mapping","content":" Fory Type\tFory Type ID\tJava\tPython\tJavascript\tC++\tGolang\tRustbool\t1\tbool/Boolean\tbool\tBoolean\tbool\tbool\tbool int8\t2\tbyte/Byte\tint/pyfory.int8\tType.int8()\tint8_t\tint8\ti8 int16\t3\tshort/Short\tint/pyfory.int16\tType.int16()\tint16_t\tint16\ti16 int32\t4\tint/Integer\tint/pyfory.fixed_int32\tType.int32()\tint32_t\tint32\ti32 varint32\t5\tint/Integer\tint/pyfory.int32\tType.varint32()\tint32_t\tint32\ti32 int64\t6\tlong/Long\tint/pyfory.fixed_int64\tType.int64()\tint64_t\tint64\ti64 varint64\t7\tlong/Long\tint/pyfory.int64\tType.varint64()\tint64_t\tint64\ti64 tagged_int64\t8\tlong/Long\tint/pyfory.tagged_int64\tType.tagged_int64()\tint64_t\tint64\ti64 uint8\t9\tshort/Short\tint/pyfory.uint8\tType.uint8()\tuint8_t\tuint8\tu8 uint16\t10\tint/Integer\tint/pyfory.uint16\tType.uint16()\tuint16_t\tuint16\tu16 uint32\t11\tlong/Long\tint/pyfory.fixed_uint32\tType.uint32()\tuint32_t\tuint32\tu32 var_uint32\t12\tlong/Long\tint/pyfory.uint32\tType.varUInt32()\tuint32_t\tuint32\tu32 uint64\t13\tlong/Long\tint/pyfory.fixed_uint64\tType.uint64()\tuint64_t\tuint64\tu64 var_uint64\t14\tlong/Long\tint/pyfory.uint64\tType.varUInt64()\tuint64_t\tuint64\tu64 tagged_uint64\t15\tlong/Long\tint/pyfory.tagged_uint64\tType.taggedUInt64()\tuint64_t\tuint64\tu64 float8\t16\t/\t/\t/\t/\t/\t/ float16\t17\tfloat/Float\tfloat/pyfory.float16\tType.float16()\tfory::float16_t\tfory.float16\tfory::f16 bfloat16\t18\t/\t/\t/\t/\t/\t/ float32\t19\tfloat/Float\tfloat/pyfory.float32\tType.float32()\tfloat\tfloat32\tf32 float64\t20\tdouble/Double\tfloat/pyfory.float64\tType.float64()\tdouble\tfloat64\tf64 string\t21\tString\tstr\tString\tstring\tstring\tString/str list\t22\tList/Collection\tlist/tuple\tarray\tvector\tslice\tVec set\t23\tSet\tset\t/\tset\tfory.Set\tSet map\t24\tMap\tdict\tMap\tunordered_map\tmap\tHashMap enum\t25\tEnum subclasses\tenum subclasses\t/\tenum\t/\tenum named_enum\t26\tEnum subclasses\tenum subclasses\t/\tenum\t/\tenum struct\t27\tpojo/record\tdata class\tobject\tstruct/class\tstruct\tstruct compatible_struct\t28\tpojo/record\tdata class\tobject\tstruct/class\tstruct\tstruct named_struct\t29\tpojo/record\tdata class\tobject\tstruct/class\tstruct\tstruct named_compatible_struct\t30\tpojo/record\tdata class\tobject\tstruct/class\tstruct\tstruct ext\t31\tpojo/record\tdata class\tobject\tstruct/class\tstruct\tstruct named_ext\t32\tpojo/record\tdata class\tobject\tstruct/class\tstruct\tstruct union\t33\tUnion\ttyping.Union\t/\tstd::variant&lt;Ts...&gt;\t/\ttagged union enum none\t36\tnull\tNone\tnull\tstd::monostate\tnil\t() duration\t37\tDuration\ttimedelta\tNumber\tduration\tDuration\tDuration timestamp\t38\tInstant\tdatetime\tNumber\tstd::chrono::nanoseconds\tTime\tDateTime date\t39\tDate\tdatetime\tNumber\tfory::serialization::Date\tTime\tDateTime decimal\t40\tBigDecimal\tDecimal\tbigint\t/\t/\t/ binary\t41\tbyte[]\tbytes\t/\tuint8_t[n]/vector&lt;T&gt;\t[n]uint8/[]T\tVec&lt;uint8_t&gt; array\t42\tarray\tnp.ndarray\t/\t/\tarray/slice\tVec bool_array\t43\tbool[]\tndarray(np.bool_)\t/\tbool[n]\t[n]bool/[]T\tVec&lt;bool&gt; int8_array\t44\tbyte[]\tndarray(int8)\t/\tint8_t[n]/vector&lt;T&gt;\t[n]int8/[]T\tVec&lt;i8&gt; int16_array\t45\tshort[]\tndarray(int16)\t/\tint16_t[n]/vector&lt;T&gt;\t[n]int16/[]T\tVec&lt;i16&gt; int32_array\t46\tint[]\tndarray(int32)\t/\tint32_t[n]/vector&lt;T&gt;\t[n]int32/[]T\tVec&lt;i32&gt; int64_array\t47\tlong[]\tndarray(int64)\t/\tint64_t[n]/vector&lt;T&gt;\t[n]int64/[]T\tVec&lt;i64&gt; uint8_array\t48\tshort[]\tndarray(uint8)\t/\tuint8_t[n]/vector&lt;T&gt;\t[n]uint8/[]T\tVec&lt;u8&gt; uint16_array\t49\tint[]\tndarray(uint16)\t/\tuint16_t[n]/vector&lt;T&gt;\t[n]uint16/[]T\tVec&lt;u16&gt; uint32_array\t50\tlong[]\tndarray(uint32)\t/\tuint32_t[n]/vector&lt;T&gt;\t[n]uint32/[]T\tVec&lt;u32&gt; uint64_array\t51\tlong[]\tndarray(uint64)\t/\tuint64_t[n]/vector&lt;T&gt;\t[n]uint64/[]T\tVec&lt;u64&gt; float8_array\t52\t/\t/\t/\t/\t/\t/ float16_array\t53\tfloat[]\tndarray(float16)\t/\tfory::float16_t[n]/vector&lt;T&gt;\t[n]float16/[]T\tVec&lt;fory::f16&gt; bfloat16_array\t54\t/\t/\t/\t/\t/\t/ float32_array\t55\tfloat[]\tndarray(float32)\t/\tfloat[n]/vector&lt;T&gt;\t[n]float32/[]T\tVec&lt;f32&gt; float64_array\t56\tdouble[]\tndarray(float64)\t/\tdouble[n]/vector&lt;T&gt;\t[n]float64/[]T\tVec&lt;f64&gt;  ","version":"0.15","tagName":"h2"},{"title":"Type info(not implemented currently)‚Äã","type":1,"pageTitle":"Xlang Type Mapping","url":"/docs/specification/xlang_type_mapping#type-infonot-implemented-currently","content":" Due to differences between type systems of languages, those types can't be mapped one-to-one between languages.  If the user notices that one type on a language corresponds to multiple types in Fory type systems, for example, longin java has type int64/varint64/h64, it means the language lacks some types, and the user must provide extra type info when using Fory.  ","version":"0.15","tagName":"h2"},{"title":"Type annotation‚Äã","type":1,"pageTitle":"Xlang Type Mapping","url":"/docs/specification/xlang_type_mapping#type-annotation","content":" If the type is a field of another class, users can provide meta hints for fields of a type, or for the whole type. Such information can be provided in other languages too:  java: use annotation.cpp: use macro and template.golang: use struct tag.python: use typehint.rust: use macro.  Here is en example:  Java: class Foo { @Int32Type(varint = true) int f1; List&lt;@Int32Type(varint = true) Integer&gt; f2; } Python: class Foo: f1: pyfory.varint32 f2: List[pyfory.varint32]  ","version":"0.15","tagName":"h2"},{"title":"Install","type":0,"sectionRef":"#","url":"/docs/start/install","content":"","keywords":"","version":"0.15"},{"title":"Java‚Äã","type":1,"pageTitle":"Install","url":"/docs/start/install#java","content":" To add a dependency on Apache Fory‚Ñ¢ using Maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-core&lt;/artifactId&gt; &lt;version&gt;0.15.0&lt;/version&gt; &lt;/dependency&gt; &lt;!-- Optional row format support --&gt; &lt;!-- &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-format&lt;/artifactId&gt; &lt;version&gt;0.13.1&lt;/version&gt; &lt;/dependency&gt; --&gt; &lt;!-- SIMD acceleration for array compression (Java 16+) --&gt; &lt;!-- &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-simd&lt;/artifactId&gt; &lt;version&gt;0.13.1&lt;/version&gt; &lt;/dependency&gt; --&gt;   ","version":"0.15","tagName":"h2"},{"title":"Scala‚Äã","type":1,"pageTitle":"Install","url":"/docs/start/install#scala","content":" To add a dependency on Apache Fory‚Ñ¢ scala for scala 2.13 with maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-scala_2.13&lt;/artifactId&gt; &lt;version&gt;0.15.0&lt;/version&gt; &lt;/dependency&gt;   To add a dependency on Apache Fory‚Ñ¢ scala for scala 3 with maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-scala_3&lt;/artifactId&gt; &lt;version&gt;0.15.0&lt;/version&gt; &lt;/dependency&gt;   To add a dependency on Apache Fory‚Ñ¢ scala for scala 2.13 with sbt, use the following:  libraryDependencies += &quot;org.apache.fory&quot; % &quot;fory-scala_2.13&quot; % &quot;0.15.0&quot;   To add a dependency on Apache Fory‚Ñ¢ scala for scala 3 with sbt, use the following:  libraryDependencies += &quot;org.apache.fory&quot; % &quot;fory-scala_3&quot; % &quot;0.15.0&quot;   ","version":"0.15","tagName":"h2"},{"title":"Kotlin‚Äã","type":1,"pageTitle":"Install","url":"/docs/start/install#kotlin","content":" To add a dependency on Apache Fory‚Ñ¢ kotlin with maven, use the following:  &lt;dependency&gt; &lt;groupId&gt;org.apache.fory&lt;/groupId&gt; &lt;artifactId&gt;fory-kotlin&lt;/artifactId&gt; &lt;version&gt;0.15.0&lt;/version&gt; &lt;/dependency&gt;   ","version":"0.15","tagName":"h2"},{"title":"Python‚Äã","type":1,"pageTitle":"Install","url":"/docs/start/install#python","content":" python -m pip install --upgrade pip pip install pyfory==0.15.0   ","version":"0.15","tagName":"h2"},{"title":"Rust‚Äã","type":1,"pageTitle":"Install","url":"/docs/start/install#rust","content":" [dependencies] fory = &quot;0.14&quot;   or just execute command:  cargo add fory@0.15.0   ","version":"0.15","tagName":"h2"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Install","url":"/docs/start/install#javascript","content":" Apache Fory‚Ñ¢ is NOT yet available on npm, please install from source code now. ","version":"0.15","tagName":"h2"},{"title":"Xlang Serialization Format","type":0,"sectionRef":"#","url":"/docs/specification/xlang_serialization_spec","content":"","keywords":"","version":"0.15"},{"title":"Cross-language Serialization Specification‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#cross-language-serialization-specification","content":" Apache Fory‚Ñ¢ xlang serialization enables automatic cross-language object serialization with support for shared references, circular references, and polymorphism. Unlike traditional serialization frameworks that require IDL definitions and schema compilation, Fory serializes objects directly without any intermediate steps.  Key characteristics:  Automatic: No IDL definition, no schema compilation, no manual object-to-protocol conversionCross-language: Same binary format works seamlessly across Java, Python, C++, Rust, Go, JavaScript, and moreReference-aware: Handles shared references and circular references without duplication or infinite recursionPolymorphic: Supports object polymorphism with runtime type resolution  This specification defines the Fory xlang binary format. The format is dynamic rather than static, which enables flexibility and ease of use at the cost of additional complexity in the wire format.  ","version":"0.15","tagName":"h2"},{"title":"Type Systems‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#type-systems","content":" ","version":"0.15","tagName":"h2"},{"title":"Data Types‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#data-types","content":" bool: a boolean value (true or false).int8: a 8-bit signed integer.int16: a 16-bit signed integer.int32: a 32-bit signed integer.varint32: a 32-bit signed integer which use fory variable-length encoding.int64: a 64-bit signed integer.varint64: a 64-bit signed integer which use fory PVL encoding.tagged_int64: a 64-bit signed integer which use fory Hybrid encoding.uint8: an 8-bit unsigned integer.uint16: a 16-bit unsigned integer.uint32: a 32-bit unsigned integer.var_uint32: a 32-bit unsigned integer which use fory variable-length encoding.uint64: a 64-bit unsigned integer.var_uint64: a 64-bit unsigned integer which use fory PVL encoding.tagged_uint64: a 64-bit unsigned integer which use fory Hybrid encoding.float8: an 8-bit floating point number.float16: a 16-bit floating point number.bfloat16: a 16-bit brain floating point number.float32: a 32-bit floating point number.float64: a 64-bit floating point number including NaN and Infinity.string: a text string encoded using Latin1/UTF16/UTF-8 encoding.enum: a data type consisting of a set of named values. Rust enum with non-predefined field values are not supported as an enum.named_enum: an enum whose value will be serialized as the registered name.struct: a dynamic(final) type serialized by Fory Struct serializer. i.e. it doesn't have subclasses. Suppose we're deserializing List&lt;SomeClass&gt;, we can save dynamic serializer dispatch since SomeClass is dynamic(final).compatible_struct: a dynamic(final) type serialized by Fory compatible Struct serializer.named_struct: a struct whose type mapping will be encoded as a name.named_compatible_struct: a compatible_struct whose type mapping will be encoded as a name.ext: a type which will be serialized by a customized serializer.named_ext: an ext type whose type mapping will be encoded as a name.list: a sequence of objects.set: an unordered set of unique elements.map: a map of key-value pairs. Mutable types such as list/map/set/array are not allowed as key of map.duration: an absolute length of time, independent of any calendar/timezone, as a count of nanoseconds.timestamp: a point in time, independent of any calendar/timezone, encoded as seconds (int64) and nanoseconds (uint32) since the epoch at UTC midnight on January 1, 1970.date: a naive date without timezone. The count is days relative to an epoch at UTC midnight on Jan 1, 1970.decimal: exact decimal value represented as an integer value in two's complement.binary: an variable-length array of bytes.array: only allow 1d numeric components. Other arrays will be taken as List. The implementation should support the interoperability between array and list. bool_array: one dimensional bool array.int8_array: one dimensional int8 array.int16_array: one dimensional int16 array.int32_array: one dimensional int32 array.int64_array: one dimensional int64 array.float8_array: one dimensional float8 array.float16_array: one dimensional half_float_16 array.bfloat16_array: one dimensional bfloat16 array.float32_array: one dimensional float32 array.float64_array: one dimensional float64 array. union: a tagged union type that can hold one of several alternative types. The active alternative is identified by an index.typed_union: a union value with registered numeric union type ID.named_union: a union value with embedded union type name or shared TypeDef.none: represents an empty/unit value with no data (e.g., for empty union alternatives).  Note:  Unsigned integer types use the same byte sizes as their signed counterparts; the difference is in value interpretation. See Type mapping for language-specific type mappings.  ","version":"0.15","tagName":"h3"},{"title":"Polymorphisms‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#polymorphisms","content":" For polymorphism, if one non-final class is registered, and only one subclass is registered, then we can take all elements in List/Map have same type, thus reduce runtime check cost.  Collection/Array polymorphism are not fully supported, since some languages such as golang have only one collection type. If users want to get exactly the type he passed, he must pass that type when deserializing or annotate that type to the field of struct.  ","version":"0.15","tagName":"h3"},{"title":"Type disambiguation‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#type-disambiguation","content":" Due to differences between type systems of languages, those types can't be mapped one-to-one between languages. When deserializing, Fory use the target data structure type and the data type in the data jointly to determine how to deserialize and populate the target data structure. For example:  class Foo { int[] intArray; Object[] objects; List&lt;Object&gt; objectList; } class Foo2 { int[] intArray; List&lt;Object&gt; objects; List&lt;Object&gt; objectList; }   intArray has an int32_array type. But both objects and objectList fields in the serialize data have list data type. When deserializing, the implementation will create an Object array for objects, but create a ArrayListfor objectList to populate its elements. And the serialized data of Foo can be deserialized into Foo2 too.  Users can also provide meta hints for fields of a type, or the type whole. Here is an example in java which use annotation to provide such information.  @ForyObject(fieldsNullable = false, trackingRef = false) class Foo { @ForyField(trackingRef = false) int[] intArray; @ForyField(polymorphic = true) Object object; @ForyField(tagId = 1, nullable = true) List&lt;Object&gt; objectList; }   Such information can be provided in other languages too:  cpp: use macro and template.golang: use struct tag.python: use typehint.rust: use macro.  ","version":"0.15","tagName":"h3"},{"title":"Type ID‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#type-id","content":" All internal data types use an 8-bit internal ID (0~255, with 0~56 defined here). Users can register types by numeric ID (0~0xFFFFFFFE in current implementations). User IDs are encoded separately from the internal type ID; there is no bit shifting/packing.  Named types (NAMED_*) do not embed a user ID; their names are carried in metadata instead.  Internal Type ID Table‚Äã  Type ID\tName\tDescription0\tUNKNOWN\tUnknown type, used for dynamic typing 1\tBOOL\tBoolean value 2\tINT8\t8-bit signed integer 3\tINT16\t16-bit signed integer 4\tINT32\t32-bit signed integer 5\tVARINT32\tVariable-length encoded 32-bit signed integer 6\tINT64\t64-bit signed integer 7\tVARINT64\tVariable-length encoded 64-bit signed integer 8\tTAGGED_INT64\tHybrid encoded 64-bit signed integer 9\tUINT8\t8-bit unsigned integer 10\tUINT16\t16-bit unsigned integer 11\tUINT32\t32-bit unsigned integer 12\tVAR_UINT32\tVariable-length encoded 32-bit unsigned integer 13\tUINT64\t64-bit unsigned integer 14\tVAR_UINT64\tVariable-length encoded 64-bit unsigned integer 15\tTAGGED_UINT64\tHybrid encoded 64-bit unsigned integer 16\tFLOAT8\t8-bit floating point (float8) 17\tFLOAT16\t16-bit floating point (half precision) 18\tBFLOAT16\t16-bit brain floating point 19\tFLOAT32\t32-bit floating point (single precision) 20\tFLOAT64\t64-bit floating point (double precision) 21\tSTRING\tUTF-8/UTF-16/Latin1 encoded string 22\tLIST\tOrdered collection (List, Array, Vector) 23\tSET\tUnordered collection of unique elements 24\tMAP\tKey-value mapping 25\tENUM\tEnum registered by numeric ID 26\tNAMED_ENUM\tEnum registered by namespace + type name 27\tSTRUCT\tStruct registered by numeric ID (schema consistent) 28\tCOMPATIBLE_STRUCT\tStruct with schema evolution support (by ID) 29\tNAMED_STRUCT\tStruct registered by namespace + type name 30\tNAMED_COMPATIBLE_STRUCT\tStruct with schema evolution (by name) 31\tEXT\tExtension type registered by numeric ID 32\tNAMED_EXT\tExtension type registered by namespace + type name 33\tUNION\tUnion value, schema identity not embedded 34\tTYPED_UNION\tUnion value with registered numeric type ID 35\tNAMED_UNION\tUnion value with embedded type name/TypeDef 36\tNONE\tEmpty/unit type (no data) 37\tDURATION\tTime duration (seconds + nanoseconds) 38\tTIMESTAMP\tPoint in time (seconds + nanoseconds since epoch) 39\tDATE\tDate without timezone (days since epoch) 40\tDECIMAL\tArbitrary precision decimal 41\tBINARY\tRaw binary data 42\tARRAY\tGeneric array type 43\tBOOL_ARRAY\t1D boolean array 44\tINT8_ARRAY\t1D int8 array 45\tINT16_ARRAY\t1D int16 array 46\tINT32_ARRAY\t1D int32 array 47\tINT64_ARRAY\t1D int64 array 48\tUINT8_ARRAY\t1D uint8 array 49\tUINT16_ARRAY\t1D uint16 array 50\tUINT32_ARRAY\t1D uint32 array 51\tUINT64_ARRAY\t1D uint64 array 52\tFLOAT8_ARRAY\t1D float8 array 53\tFLOAT16_ARRAY\t1D float16 array 54\tBFLOAT16_ARRAY\t1D bfloat16 array 55\tFLOAT32_ARRAY\t1D float32 array 56\tFLOAT64_ARRAY\t1D float64 array  Type ID Encoding for User Types‚Äã  When registering user types (struct/ext/enum/union), the internal type ID is written as the 8-bit kind. The user type ID is written separately as an unsigned varint32 (small7); there is no bit shift or packing.  Examples:  User ID\tType\tInternal ID\tEncoded User ID\tDecimal0\tSTRUCT\t27\t0\t0 0\tENUM\t25\t0\t0 1\tSTRUCT\t27\t1\t1 1\tCOMPATIBLE_STRUCT\t28\t1\t1 2\tNAMED_STRUCT\t29\t2\t2  When reading type IDs:  Read internal type ID from the type ID field.If the internal type is a user-registered kind, read user_type_id as varuint32.  ","version":"0.15","tagName":"h3"},{"title":"Type mapping‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#type-mapping","content":" See Type mapping  ","version":"0.15","tagName":"h3"},{"title":"Spec overview‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#spec-overview","content":" Here is the overall format:  | fory header | object ref meta | object type meta | object value data |   The data are serialized using little endian byte order for all types.  ","version":"0.15","tagName":"h2"},{"title":"Fory header‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#fory-header","content":" Fory header format for xlang serialization:  | 1 byte bitmap | +--------------------------------+ | flags |   Detailed byte layout:  Byte 0: Bitmap flags - Bit 0: null flag (0x01) - Bit 1: xlang flag (0x02) - Bit 2: oob flag (0x04) - Bits 3-7: reserved   null flag (bit 0): 1 when object is null, 0 otherwise. If an object is null, only this flag is set.xlang flag (bit 1): 1 when serialization uses Fory xlang format, 0 when serialization uses Fory language-native format.oob flag (bit 2): 1 when out-of-band serialization is enabled (BufferCallback is not null), 0 otherwise.  All data is encoded in little-endian format.  ","version":"0.15","tagName":"h2"},{"title":"Reference Meta‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#reference-meta","content":" Reference tracking handles whether the object is null, and whether to track reference for the object by writing corresponding flags and maintaining internal state.  ","version":"0.15","tagName":"h2"},{"title":"Reference Flags‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#reference-flags","content":" Flag\tByte Value (int8)\tHex\tDescriptionNULL FLAG\t-3\t0xFD\tObject is null. No further bytes are written for this object. REF FLAG\t-2\t0xFE\tObject was already serialized. Followed by unsigned varint32 reference ID. NOT_NULL VALUE FLAG\t-1\t0xFF\tObject is non-null but reference tracking is disabled for this type. Object data follows immediately. REF VALUE FLAG\t0\t0x00\tObject is referencable and this is its first occurrence. Object data follows. Assigns next reference ID.  ","version":"0.15","tagName":"h3"},{"title":"Reference Tracking Algorithm‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#reference-tracking-algorithm","content":" Writing:  function write_ref_or_null(buffer, obj): if obj is null: buffer.write_int8(NULL_FLAG) // -3 return true // done, no more data to write if reference_tracking_enabled: ref_id = lookup_written_objects(obj) if ref_id exists: buffer.write_int8(REF_FLAG) // -2 buffer.write_varuint32(ref_id) return true // done, reference written else: buffer.write_int8(REF_VALUE_FLAG) // 0 add_to_written_objects(obj, next_ref_id++) return false // continue to serialize object data else: buffer.write_int8(NOT_NULL_VALUE_FLAG) // -1 return false // continue to serialize object data   Reading:  function read_ref_or_null(buffer): flag = buffer.read_int8() switch flag: case NULL_FLAG (-3): return (null, true) // null object, done case REF_FLAG (-2): ref_id = buffer.read_varuint32() obj = get_from_read_objects(ref_id) return (obj, true) // referenced object, done case NOT_NULL_VALUE_FLAG (-1): return (null, false) // non-null, continue reading case REF_VALUE_FLAG (0): reserve_ref_slot() // will be filled after reading return (null, false) // non-null, continue reading   ","version":"0.15","tagName":"h3"},{"title":"Reference ID Assignment‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#reference-id-assignment","content":" Reference IDs are assigned sequentially starting from 0The ID is assigned when REF_VALUE_FLAG is written (first occurrence)Objects are stored in a list/map indexed by their reference IDFor reading, a placeholder slot is reserved before deserializing the object, then filled after  ","version":"0.15","tagName":"h3"},{"title":"When Reference Tracking is Disabled‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#when-reference-tracking-is-disabled","content":" When reference tracking is disabled globally or for specific types, only the NULL and NOT_NULL VALUE flags will be used for reference meta. This reduces overhead for types that are known not to have references.  ","version":"0.15","tagName":"h3"},{"title":"Language-Specific Considerations‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#language-specific-considerations","content":" Languages with nullable and reference types by default (Java, Python, JavaScript):  In xlang mode, for cross-language compatibility:  All fields are treated as not-null by defaultReference tracking is disabled by defaultUsers can explicitly mark fields as nullable or enable reference tracking via annotationsOptional types (e.g., java.util.Optional, typing.Optional) are treated as nullable  Annotation examples:  // Java: use @ForyField annotation public class MyClass { @ForyField(nullable = true, ref = true) private Object refField; @ForyField(nullable = false) private String requiredField; }   # Python: use typing with fory field descriptors from pyfory import Fory, ForyField class MyClass: ref_field: ForyField(SomeType, nullable=True, ref=True) required_field: ForyField(str, nullable=False)   Languages with non-nullable types by default:  Language\tNull Representation\tReference Tracking SupportRust\tOption::None\tVia Rc&lt;T&gt;, Arc&lt;T&gt;, Weak&lt;T&gt; C++\tstd::nullopt, nullptr\tVia std::shared_ptr&lt;T&gt;, weak_ptr&lt;T&gt; Go\tnil interface/pointer\tVia pointer/interface types  Important: For languages like Rust that don't have implicit reference semantics, reference tracking must use explicit smart pointers (Rc, Arc).  ","version":"0.15","tagName":"h3"},{"title":"Type Meta‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#type-meta","content":" Every non-primitive value begins with a type ID that identifies its concrete type. The type ID is followed by optional type-specific metadata.  ","version":"0.15","tagName":"h2"},{"title":"Type ID encoding‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#type-id-encoding","content":" The type ID is written as an unsigned varint32 (small7).Internal types use their internal type ID directly (low 8 bits).User-registered types write the internal type ID, then write user_type_id as varuint32. user_type_id is a numeric ID (0~0xFFFFFFFE in current implementations).internal_type_id is one of ENUM, STRUCT, COMPATIBLE_STRUCT, EXT, or TYPED_UNION. Named types do not embed a user ID. They use NAMED_* internal type IDs and carry a namespace and type name (or shared TypeDef) instead.  ","version":"0.15","tagName":"h3"},{"title":"Type meta payload‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#type-meta-payload","content":" After the type ID:  ENUM / STRUCT / EXT / TYPED_UNION: no extra bytes beyond the user_type_id (registration by ID required on both sides).COMPATIBLE_STRUCT: If meta share is enabled, write a shared TypeDef entry (see below).If meta share is disabled, no extra bytes. NAMED_ENUM / NAMED_STRUCT / NAMED_COMPATIBLE_STRUCT / NAMED_EXT / NAMED_UNION: If meta share is disabled, write namespace and type_name as meta strings.If meta share is enabled, write a shared TypeDef entry (see below). UNION: no extra bytes at this layer.LIST / SET / MAP / ARRAY / primitives: no extra bytes at this layer.  Unregistered types are serialized as named types:  Enums -&gt; NAMED_ENUMStruct-like classes -&gt; NAMED_STRUCT (or NAMED_COMPATIBLE_STRUCT when meta share is enabled)Custom extension types -&gt; NAMED_EXTUnions -&gt; NAMED_UNION  The namespace is the package/module name and the type name is the simple class name.  ","version":"0.15","tagName":"h3"},{"title":"Shared Type Meta (streaming)‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#shared-type-meta-streaming","content":" When meta share is enabled, TypeDef metadata is written inline the first time a type is encountered, and subsequent occurrences only reference it.  Encoding:  marker = (index &lt;&lt; 1) | flagflag = 0: new type definition followsflag = 1: reference to a previously written type definitionindex is the sequential index assigned to this type (starting from 0).  Write algorithm:  Look up the class in the per-stream meta context map.If found, write (index &lt;&lt; 1) | 1.If not found: assign index = next_idwrite (index &lt;&lt; 1)write the encoded TypeDef bytes immediately after  Read algorithm:  Read marker as varuint32.flag = marker &amp; 1, index = marker &gt;&gt;&gt; 1.If flag == 1, use the cached TypeDef at index.If flag == 0, read a TypeDef, cache it at index, and use it.  TypeDef bytes include the 8-byte global header and optional size extension.  ","version":"0.15","tagName":"h3"},{"title":"TypeDef (schema evolution metadata)‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#typedef-schema-evolution-metadata","content":" TypeDef describes a struct-like type (or a named enum/ext) for schema evolution and name resolution. It is encoded as:  | 8-byte global header | [optional size varuint] | TypeDef body |   Global header‚Äã  The 8-byte header is a little-endian uint64:  Low 8 bits: meta size (number of bytes in the TypeDef body). If meta size &gt;= 0xFF, the low 8 bits are set to 0xFF and an extravaruint32(meta_size - 0xFF) follows immediately after the header. Bit 8: HAS_FIELDS_META (1 = fields metadata present).Bit 9: COMPRESS_META (1 = body is compressed; decompress before parsing).Bits 10-13: reserved for future extension (must be zero).High 50 bits: hash of the TypeDef body.  TypeDef body‚Äã  TypeDef body has a single layer (fields are flattened in class hierarchy order):  | meta header (1 byte) | type spec | field info ... |   Meta header byte:  Bits 0-4: num_fields (0-30). If num_fields == 31, read an extra varuint32 and add it. Bit 5: REGISTER_BY_NAME (1 = namespace + type name, 0 = numeric type ID).Bits 6-7: reserved.  Type spec:  If REGISTER_BY_NAME is set: namespace meta stringtype_name meta string Otherwise: type_id as varuint32 (small7)  Field info list:  Each field is encoded as:  | field header (1 byte) | field type info | [field name bytes] |   Field header layout:  Bits 6-7: field name encoding (UTF8, ALL_TO_LOWER_SPECIAL,LOWER_UPPER_DIGIT_SPECIAL, or TAG_ID)Bits 2-5: size For name encoding: size = (name_bytes_length - 1)For tag ID: size = tag_idIf size == 0b1111, read varuint32(size - 15) and add it Bit 1: nullable flagBit 0: reference tracking flag  Field type info:  The top-level field type is written as varuint32(type_id) (small7) without flags.For LIST / SET, an element type follows, encoded as(nested_type_id &lt;&lt; 2) | (nullable &lt;&lt; 1) | tracking_ref.For MAP, key type and value type follow, both encoded the same way.One-dimensional primitive arrays use *_ARRAY type IDs; other arrays are encoded as LIST.  Field names:  If TAG_ID encoding is used, no name bytes are written.Otherwise, write the encoded field name bytes as a meta string.For xlang, field names are converted to snake_case before encoding for cross-language compatibility.  Field order:  Field order is implementation-defined. Decoders must match fields by name or tag ID rather than position. Fory uses a stable grouping and sorting order to produce deterministic TypeDefs.  ","version":"0.15","tagName":"h3"},{"title":"Meta String‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#meta-string","content":" Meta string is a compressed encoding for metadata strings such as field names, type names, and namespaces. This compression significantly reduces the size of type metadata in serialized data.  ","version":"0.15","tagName":"h2"},{"title":"Encoding Type IDs‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#encoding-type-ids","content":" ID\tName\tBits/Char\tCharacter Set0\tUTF8\t8\tAny UTF-8 character 1\tLOWER_SPECIAL\t5\ta-z . _ $ | 2\tLOWER_UPPER_DIGIT_SPECIAL\t6\ta-z A-Z 0-9 . _ 3\tFIRST_TO_LOWER_SPECIAL\t5\tFirst char uppercase, rest a-z . _ 4\tALL_TO_LOWER_SPECIAL\t5\ta-z A-Z . _ (uppercase escaped)  ","version":"0.15","tagName":"h3"},{"title":"Character Mapping Tables‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#character-mapping-tables","content":" LOWER_SPECIAL (5 bits per character)‚Äã  Character\tCode (binary)\tCode (decimal)a-z\t00000-11001\t0-25 .\t11010\t26 _\t11011\t27 $\t11100\t28 |\t11101\t29  Note: The | character is used as an escape sequence in ALL_TO_LOWER_SPECIAL encoding.  LOWER_UPPER_DIGIT_SPECIAL (6 bits per character)‚Äã  Character\tCode (binary)\tCode (decimal)a-z\t000000-011001\t0-25 A-Z\t011010-110011\t26-51 0-9\t110100-111101\t52-61 .\t111110\t62 _\t111111\t63  ","version":"0.15","tagName":"h3"},{"title":"Encoding Algorithms‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#encoding-algorithms","content":" LOWER_SPECIAL Encoding‚Äã  For strings containing only a-z, ., _, $, |:  function encode_lower_special(str): bits = [] for char in str: bits.append(lookup_lower_special[char]) // 5 bits each // Pad to byte boundary total_bits = len(str) * 5 padding_bits = (8 - (total_bits % 8)) % 8 // First bit indicates if last char should be stripped (due to padding) strip_last = (padding_bits &gt;= 5) if strip_last: prepend bit 1 else: prepend bit 0 return pack_bits_to_bytes(bits)   FIRST_TO_LOWER_SPECIAL Encoding‚Äã  For strings like MyFieldName where only the first character is uppercase:  function encode_first_to_lower_special(str): // Convert first char to lowercase modified = str[0].lower() + str[1:] // Then use LOWER_SPECIAL encoding return encode_lower_special(modified)   ALL_TO_LOWER_SPECIAL Encoding‚Äã  For strings with multiple uppercase characters like MyTypeName:  function encode_all_to_lower_special(str): result = &quot;&quot; for char in str: if char.is_upper(): result += &quot;|&quot; + char.lower() // Escape uppercase with | else: result += char return encode_lower_special(result)   Example: MyType ‚Üí |my|type ‚Üí encoded with LOWER_SPECIAL  ","version":"0.15","tagName":"h3"},{"title":"Encoding Selection Algorithm‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#encoding-selection-algorithm","content":" function choose_encoding(str): if all chars in str are in [a-z . _ $ |]: return LOWER_SPECIAL if first char is uppercase AND rest are in [a-z . _]: return FIRST_TO_LOWER_SPECIAL if all chars are in [a-z A-Z . _]: lower_special_size = encode_all_to_lower_special(str).size luds_size = encode_lower_upper_digit_special(str).size if lower_special_size &lt;= luds_size: return ALL_TO_LOWER_SPECIAL else: return LOWER_UPPER_DIGIT_SPECIAL if all chars are in [a-z A-Z 0-9 . _]: return LOWER_UPPER_DIGIT_SPECIAL return UTF8   ","version":"0.15","tagName":"h3"},{"title":"Meta String Header Format‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#meta-string-header-format","content":" Meta strings are written with a header that includes the encoding type:  | 3 bits encoding | 5+ bits length | encoded bytes |   Or for larger strings:  | varuint: (length &lt;&lt; 3) | encoding | encoded bytes |   ","version":"0.15","tagName":"h3"},{"title":"Special Character Sets by Context‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#special-character-sets-by-context","content":" Different contexts use different special characters:  Context\tSpecial Chars\tNotesField Name\t. _ $ |\t$ for inner classes, | for escape Namespace\t. _\tPackage/module separators Type Name\t$ _\t$ for inner classes in Java  ","version":"0.15","tagName":"h3"},{"title":"Deduplication‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#deduplication","content":" Meta strings are deduplicated within a serialization session:  First occurrence: | (length &lt;&lt; 1) | [hash if large] | encoding | bytes | Reference: | ((id + 1) &lt;&lt; 1) | 1 |   Bit 0 of the header indicates: 0 = new string, 1 = reference to previousLarge strings (&gt; 16 bytes) include 64-bit hash for content-based deduplicationSmall strings use exact byte comparison  ","version":"0.15","tagName":"h3"},{"title":"Value Format‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#value-format","content":" ","version":"0.15","tagName":"h2"},{"title":"Basic types‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#basic-types","content":" bool‚Äã  size: 1 byteformat: 0 for false, 1 for true  int8‚Äã  size: 1 byteformat: write as pure byte.  int16‚Äã  size: 2 bytebyte order: raw bytes of little endian order  unsigned int32‚Äã  size: 4 bytebyte order: raw bytes of little endian order  unsigned varint32‚Äã  size: 1~5 bytesFormat: The most significant bit (MSB) in every byte indicates whether to have the next byte. If the continuation bit is set (i.e. b &amp; 0x80 == 0x80), then the next byte should be read until a byte with unset continuation bit.  Encoding Algorithm:  function write_varuint32(value): while value &gt;= 0x80: buffer.write_byte((value &amp; 0x7F) | 0x80) // 7 bits of data + continuation bit value = value &gt;&gt; 7 buffer.write_byte(value) // final byte without continuation bit   Decoding Algorithm:  function read_varuint32(): result = 0 shift = 0 while true: byte = buffer.read_byte() result = result | ((byte &amp; 0x7F) &lt;&lt; shift) if (byte &amp; 0x80) == 0: break shift = shift + 7 return result   Byte sizes by value range:  Value Range\tBytes0 ~ 127\t1 128 ~ 16383\t2 16384 ~ 2097151\t3 2097152 ~ 268435455\t4 268435456 ~ 4294967295\t5  signed int32‚Äã  size: 4 bytesbyte order: raw bytes of little endian order  signed varint32‚Äã  size: 1~5 bytesFormat: First convert the number into positive unsigned int using ZigZag encoding, then encode as unsigned varint.  ZigZag Encoding:  // Encode: convert signed to unsigned zigzag_value = (value &lt;&lt; 1) ^ (value &gt;&gt; 31) // Decode: convert unsigned back to signed original = (zigzag_value &gt;&gt; 1) ^ (-(zigzag_value &amp; 1)) // Or equivalently: original = (zigzag_value &gt;&gt; 1) ^ (~(zigzag_value &amp; 1) + 1)   ZigZag encoding maps signed integers to unsigned integers so that small absolute values (positive or negative) have small encoded values:  Original\tZigZag Encoded0\t0 -1\t1 1\t2 -2\t3 2\t4 ...\t...  unsigned int64‚Äã  size: 8 bytesbyte order: raw bytes of little endian order  unsigned varint64‚Äã  size: 1~9 bytes  Uses PVL (Progressive Variable-Length) encoding:  function write_varuint64(value): while value &gt;= 0x80: buffer.write_byte((value &amp; 0x7F) | 0x80) value = value &gt;&gt; 7 buffer.write_byte(value)   Value Range\tBytes0 ~ 127\t1 128 ~ 16383\t2 ...\t... 2^56 ~ 2^63-1\t9  unsigned hybrid int64 (TAGGED_UINT64)‚Äã  size: 4 or 9 bytes  Optimized for unsigned values that fit in 31 bits (common case for IDs, sizes, counts, etc.):  if value in [0, 2147483647]: // fits in 31 bits (2^31 - 1), full unsigned range write 4 bytes: ((int32) value) &lt;&lt; 1 // bit 0 is 0, indicating 4-byte encoding else: write 1 byte: 0x01 // bit 0 is 1, indicating 9-byte encoding write 8 bytes: value as little-endian uint64   Reading:  first_int32 = read_int32_le() if (first_int32 &amp; 1) == 0: return (uint64)(first_int32 &gt;&gt; 1) // 4-byte encoding, unsigned else: return read_uint64_le() // read remaining 8 bytes   Note: TAGGED_UINT64 uses the full 31 bits for positive values [0, 2^31-1], compared to TAGGED_INT64 which splits the range for signed values [-2^30, 2^30-1].  VarUint36Small‚Äã  A specialized encoding used for string headers that combines size (up to 36 bits) with encoding flags:  // Write: encodes (size &lt;&lt; 2) | encoding_flags function write_varuint36_small(value): if value &lt; 0x80: buffer.write_byte(value) else: // Standard varint encoding for values &gt;= 128 write_varuint64(value)   This encoding is optimized for the common case where string length fits in 7 bits (strings &lt; 32 characters).  signed int64‚Äã  size: 8 bytesbyte order: raw bytes of little endian order  signed varint64‚Äã  size: 1~9 bytes  Uses ZigZag encoding first, then PVL varint:  // Encode zigzag_value = (value &lt;&lt; 1) ^ (value &gt;&gt; 63) write_varuint64(zigzag_value) // Decode zigzag_value = read_varuint64() value = (zigzag_value &gt;&gt; 1) ^ (-(zigzag_value &amp; 1))   signed hybrid int64 (TAGGED_INT64)‚Äã  size: 4 or 9 bytes  Optimized for small signed values:  if value in [-1073741824, 1073741823]: // fits in 30 bits + sign ([-2^30, 2^30-1]) write 4 bytes: ((int32) value) &lt;&lt; 1 // bit 0 is 0, indicating 4-byte encoding else: write 1 byte: 0x01 // bit 0 is 1, indicating 9-byte encoding write 8 bytes: value as little-endian int64   Reading:  first_int32 = read_int32_le() if (first_int32 &amp; 1) == 0: return (int64)(first_int32 &gt;&gt; 1) // 4-byte encoding, sign-extended else: return read_int64_le() // read remaining 8 bytes   Note: TAGGED_INT64 uses 30 bits + sign for values [-2^30, 2^30-1], while TAGGED_UINT64 uses full 31 bits for unsigned values [0, 2^31-1].  float8‚Äã  size: 1 byteformat: float8 has 4 kinds: float8 kind enum: float8_e4m3fn, float8_e4m3fnuz, float8_e5m2, float8_e5m2fnuzwhen serialize as field, write raw 8 bits as one byte directlywhen serialize as an object: write type kind as a byte, then write value byte  float16‚Äã  size: 2 bytesformat: encode the specified floating-point value according to the IEEE 754 standard binary16 format, preserving NaN values, then write as binary by little endian order.  bfloat16‚Äã  size: 2 bytesformat: encode the specified floating-point value according to the IEEE 754 standard bfloat16 format, preserving NaN values, then write as binary by little endian order.  float32‚Äã  size: 4 byteformat: encode the specified floating-point value according to the IEEE 754 floating-point &quot;single format&quot; bit layout, preserving Not-a-Number (NaN) values, then write as binary by little endian order.  float64‚Äã  size: 8 byteformat: encode the specified floating-point value according to the IEEE 754 floating-point &quot;double format&quot; bit layout, preserving Not-a-Number (NaN) values. then write as binary by little endian order.  ","version":"0.15","tagName":"h3"},{"title":"string‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#string","content":" Format:  | varuint36_small: (size &lt;&lt; 2) | encoding | binary data |   String Header‚Äã  The header is encoded using varuint36_small format, which combines the byte length and encoding type:  header = (byte_length &lt;&lt; 2) | encoding_type   Encoding Type\tValue\tDescriptionLATIN1\t0\tISO-8859-1 single-byte encoding UTF16\t1\tUTF-16 encoding (2 bytes per code unit) UTF8\t2\tUTF-8 variable-length encoding Reserved\t3\tReserved for future use  Encoding Algorithm‚Äã  Writing:  function write_string(str): bytes = encode_to_bytes(str, chosen_encoding) header = (bytes.length &lt;&lt; 2) | encoding_type buffer.write_varuint36_small(header) buffer.write_bytes(bytes)   Reading:  function read_string(): header = buffer.read_varuint36_small() encoding = header &amp; 0x03 byte_length = header &gt;&gt; 2 bytes = buffer.read_bytes(byte_length) return decode_bytes(bytes, encoding)   Encoding Selection by Language‚Äã  Writing:  Language\tEncoding StrategyJava (JDK8)\tDetect at runtime: LATIN1 if all chars &lt; 256, else UTF16 Java (JDK9+)\tUse String's internal coder: LATIN1 or UTF16 Python\tCan write LATIN1, UTF16, or UTF8 based on string content C++\tUTF8 (std::string) or UTF16 (std::u16string) Rust\tUTF8 (String) Go\tUTF8 (string) JavaScript\tUTF8  Reading: All languages support decoding all three encodings (LATIN1, UTF16, UTF8).  Recommendation: Select encoding based on maximum performance - use the encoding that matches the language's native string representation to avoid conversion overhead.  Empty String‚Äã  Empty strings are encoded with header 0 (length 0, any encoding) followed by no data bytes.  ","version":"0.15","tagName":"h3"},{"title":"duration‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#duration","content":" Duration is an absolute length of time, independent of any calendar/timezone, as a count of seconds and nanoseconds.  Format:  | signed varint64: seconds | signed int32: nanoseconds |   seconds: Number of seconds in the duration, encoded as a signed varint64. Can be positive or negative.nanoseconds: Nanosecond adjustment to the duration, encoded as a signed int32. Value range is [0, 999,999,999] for positive durations, and [-999,999,999, 0] for negative durations.  Notes:  The duration is stored as two separate fields to maintain precision and avoid overflow issues.Seconds are encoded using varint64 for compact representation of common duration values.Nanoseconds are stored as a fixed int32 since the range is limited.The sign of the duration is determined by the seconds field. When seconds is 0, the sign is determined by nanoseconds.  ","version":"0.15","tagName":"h3"},{"title":"collection/list‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#collectionlist","content":" Format:  | varuint32: length | 1 byte elements header | [optional type info] | elements data |   Elements Header‚Äã  The elements header is a single byte that encodes metadata about the collection elements to optimize serialization:  | bit 7-4 (reserved) | bit 3 | bit 2 | bit 1 | bit 0 | +--------------------+-------------+------------------+----------+-----------+ | reserved | is_same_type| is_decl_elem_type| has_null | track_ref |   Bit\tName\tValue\tMeaning when SET (1)\tMeaning when UNSET (0)0\ttrack_ref\t0x01\tTrack references for elements\tDon't track element references 1\thas_null\t0x02\tCollection may contain null elements\tNo null elements (skip null checks) 2\tis_decl_elem_type\t0x04\tElements are the declared generic type\tElement types differ from declared type 3\tis_same_type\t0x08\tAll elements have the same runtime type\tElements have different runtime types  Common header values:  Header\tHex\tMeaning0x0C\t12\tDeclared type + same type, non-null, no ref tracking (optimal) 0x0D\t13\tDeclared type + same type, non-null, with ref tracking 0x0E\t14\tDeclared type + same type, may have nulls, no ref tracking 0x08\t8\tSame type but not declared type (type info written once) 0x00\t0\tDifferent types, non-null, no ref tracking (type per element)  Type Info After Header‚Äã  When is_decl_elem_type (bit 2) is NOT set, the element type info is written once after the header if is_same_type (bit 3) is set:  | header (0x08) | type_id (varuint32) | elements... |   When both is_decl_elem_type and is_same_type are NOT set, type info is written per element.  Element Serialization Based on Header‚Äã  The header determines how each element is serialized:  elements data‚Äã  Based on the elements header, the serialization of elements data may skip ref flag/null flag/element type info.  fory = ... buffer = ... elems = ... if element_type_is_same: if not is_declared_type: fory.write_type(buffer, elem_type) elem_serializer = get_serializer(...) if track_ref: for elem in elems: if not ref_resolver.write_ref_or_null(buffer, elem): elem_serializer.write(buffer, elem) elif has_null: for elem in elems: if elem is None: buffer.write_byte(null_flag) else: buffer.write_byte(not_null_flag) elem_serializer.write(buffer, elem) else: for elem in elems: elem_serializer.write(buffer, elem) else: if track_ref: for elem in elems: fory.write_ref(buffer, elem) elif has_null: for elem in elems: fory.write_nullable(buffer, elem) else: for elem in elems: fory.write_value(buffer, elem)   CollectionSerializer#writeElementscan be taken as an example.  ","version":"0.15","tagName":"h3"},{"title":"array‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#array","content":" primitive array‚Äã  Primitive array are taken as a binary buffer, serialization will just write the length of array size as an unsigned int, then copy the whole buffer into the stream.  Such serialization won't compress the array. If users want to compress primitive array, users need to register custom serializers for such types or mark it as list type.  Float array specifics:  float16/bfloat16 array: write varuint length, then raw bytes in little endian order.float8 array: write element type kind as a byte, then varuint length, then raw bytes in little endian order.  Multi-dimensional arrays‚Äã  Xlang does not define a dedicated tensor encoding. Multi-dimensional arrays are serialized as nested lists, while one-dimensional primitive arrays use the *_ARRAY type IDs.  object array‚Äã  Object array is serialized using the list format. Object component type will be taken as list element generic type.  ","version":"0.15","tagName":"h3"},{"title":"map‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#map","content":" Map uses a chunk-based format to handle heterogeneous key-value pairs efficiently:  | varuint32: total_size | chunk_1 | chunk_2 | ... | chunk_n |   Map Chunk Format‚Äã  Each chunk contains up to 255 key-value pairs with the same metadata characteristics:  | 1 byte | 1 byte | variable bytes | +--------------+----------------+------------------------------+ | KV header | chunk size N | N key-value pairs (N*2 obj) |   KV Header Bits‚Äã  The KV header is a single byte encoding metadata for both keys and values:  | bit 7-6 | bit 5 | bit 4 | bit 3 | bit 2 | bit 1 | bit 0 | +------------+---------------+--------------+---------------+---------------+--------------+---------------+ | reserved | val_decl_type | val_has_null | val_track_ref | key_decl_type | key_has_null | key_track_ref |   Bit\tName\tValue\tMeaning when SET (1)0\tkey_track_ref\t0x01\tTrack references for keys 1\tkey_has_null\t0x02\tKeys may be null (rare, usually invalid) 2\tkey_decl_type\t0x04\tKey is the declared generic type 3\tval_track_ref\t0x08\tTrack references for values 4\tval_has_null\t0x10\tValues may be null 5\tval_decl_type\t0x20\tValue is the declared generic type  Common KV header values:  Header\tHex\tMeaning0x24\t36\tKey + value are declared types, non-null, no ref tracking (optimal) 0x2C\t44\tKey + value declared types, value tracks refs 0x34\t52\tKey + value declared types, value may be null 0x00\t0\tKey + value not declared types, non-null, no ref tracking  Chunk Size‚Äã  Maximum chunk size: 255 pairs (fits in 1 byte)When key or value is null, that entry is serialized as a separate chunk with implicit size 1 (chunk size byte is skipped)Reader tracks accumulated count against total map size to know when to stop reading chunks  Why Chunk-Based Format?‚Äã  Map iteration is expensive. Computing a single header for all pairs would require two passes. The chunk-based approach allows:  Optimistic prediction: Use first key-value pair to predict headerAdaptive chunking: Start new chunk if prediction fails for a pairEfficient reading: Most maps fit in single chunk (&lt; 255 pairs)Memory efficiency: Minimal overhead for common homogeneous maps  Why serialize chunk by chunk?‚Äã  When fory will use first key-value pair to predict header optimistically, it can't know how many pairs have same meta(tracking kef ref, key has null and so on). If we don't write chunk by chunk with max chunk size, we must write at least X bytes to take up a place for later to update the number which has same elements, X is the num_bytes for encoding varint encoding of map size.  And most map size are smaller than 255, if all pairs have same data, the chunk will be 1. This is common in golang/rust, which object are not reference by default.  Also, if only one or two keys have different meta, we can make it into a different chunk, so that most pairs can share meta.  The implementation can accumulate read count with map size to decide whether to read more chunks.  ","version":"0.15","tagName":"h3"},{"title":"enum‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#enum","content":" Enums are serialized as an unsigned var int. If the order of enum values change, the deserialized enum value may not be the value users expect. In such cases, users must register enum serializer by make it write enum value as an enumerated string with unique hash disabled.  ","version":"0.15","tagName":"h3"},{"title":"timestamp‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#timestamp","content":" Timestamp represents a point in time independent of any calendar/timezone. It is encoded as:  seconds (int64): seconds since Unix epoch (1970-01-01T00:00:00Z)nanos (uint32): nanosecond adjustment within the second  On write, implementations must normalize negative timestamps so that nanos is always in [0, 1_000_000_000). This is a fixed-size 12-byte payload (8 bytes seconds + 4 bytes nanos).  ","version":"0.15","tagName":"h3"},{"title":"date‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#date","content":" Date represents a date without timezone. It is encoded as an int32 count of days since the Unix epoch (1970-01-01). This is a fixed-size 4-byte payload.  ","version":"0.15","tagName":"h3"},{"title":"decimal‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#decimal","content":" Not supported for now.  ","version":"0.15","tagName":"h3"},{"title":"struct‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#struct","content":" Struct means object of class/pojo/struct/bean/record type. Struct values are serialized by writing fields in Fory order. The type meta before the value is written according to the rules inType Meta.  Field order‚Äã  Field order must be deterministic and identical across languages. This section defines the language-neutral ordering algorithm; implementations must follow the rules here rather than any language-specific helper classes.  Step 1: Field identifier‚Äã  For every field, compute a stable identifier used for ordering:  If a tag ID is configured (e.g., @ForyField(id=...)), use the tag ID as a decimal string.Otherwise, use the field name converted to snake_case.  Tag IDs must be unique within a type; duplicate tag IDs are invalid.  Step 2: Group assignment‚Äã  Assign each field to exactly one group in the following order:  Primitive (non-nullable): primitive or boxed numeric/boolean types with nullable=false.Primitive (nullable): primitive or boxed numeric/boolean types with nullable=true.Built-in (non-container): internal type IDs that are not user-defined and not UNKNOWN, excluding collections and maps (for example: STRING, TIME types, UNION/TYPED_UNION/NAMED_UNION, primitive arrays).Collection: list/set/object-array fields. Non-primitive arrays are treated as LIST for ordering purposes.Map: map fields.Other: user-defined enum/struct/ext and UNKNOWN types.  Step 3: Intra-group ordering‚Äã  Within each group, apply the following sort keys in order until a difference is found:  Primitive groups (1 and 2):  Compression category: fixed-size numeric and boolean types first, then compressed numeric types (VARINT32, VAR_UINT32, VARINT64, VAR_UINT64, TAGGED_INT64, TAGGED_UINT64).Primitive size (descending): 8-byte &gt; 4-byte &gt; 2-byte &gt; 1-byte.Internal type ID (descending) as a tie-breaker for equal sizes.Field identifier (lexicographic ascending).  Built-in / Collection / Map groups (3-5):  Internal type ID (ascending).Field identifier (lexicographic ascending).  Other group (6):  Field identifier (lexicographic ascending).  If two fields still compare equal after the rules above, preserve a deterministic order by comparing declaring class name and then the original field name. This tie-breaker should be reachable only in invalid schemas (e.g., duplicate tag IDs).  Notes‚Äã  The ordering above is used for serialization order and TypeDef field lists. Schema hashes use the field identifier ordering described in the schema hash section.Collection/map normalization is required so peers with different concrete types (e.g.,List vs Collection) still agree on ordering.The compressed numeric rule is critical for cross-language consistency: compressed integer fields are always placed after all fixed-width integer fields.  Schema consistent (meta share disabled)‚Äã  Object value layout:  | [optional 4-byte schema hash] | field values |   The schema hash is written only when class-version checking is enabled. It is the low 32 bits of a MurmurHash3 x64_128 of the struct fingerprint string:  For each field, build &lt;field_id_or_name&gt;,&lt;type_id&gt;,&lt;ref&gt;,&lt;nullable&gt;;.Field identifier is the tag ID if present, otherwise the snake_case field name.Sort by field identifier lexicographically before concatenation.  Field values are serialized in Fory order. Primitive fields are written as raw values (nullable primitives include a null flag). Non-primitive fields write ref/null flags as needed and then the value; polymorphic fields include type meta.  Compatible mode (meta share enabled)‚Äã  The field value layout is the same as schema-consistent mode, but the type meta forCOMPATIBLE_STRUCT and NAMED_COMPATIBLE_STRUCT uses shared TypeDef entries. Deserializers use TypeDef to map fields by name or tag ID and to honor nullable/ref flags from metadata; unknown fields are skipped.  ","version":"0.15","tagName":"h3"},{"title":"Union‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#union","content":" Union values are encoded using three union type IDs so the union schema identity lives in type meta (likeSTRUCT/ENUM/EXT) and is easy to carry inside Any.  IDL syntax‚Äã  union Contact [id=0] { string email = 1; int32 phone = 2; }   Rules:  Each union alternative MUST have a stable tag number (= 1, = 2, ...).Tag numbers MUST be unique within the union and MUST NOT be reused.  Type IDs and type meta‚Äã  Type ID\tName\tMeaning33\tUNION\tUnion value, schema identity not embedded 34\tTYPED_UNION\tUnion value with registered numeric type ID 35\tNAMED_UNION\tUnion value with embedded type name / shared TypeDef  Type meta encoding:  UNION (33): no additional type meta payload.TYPED_UNION (34): write user_type_id as varuint32 after the type ID.NAMED_UNION (35): followed by named type meta (namespace + type name, or shared TypeDef marker/body).  Union value payload‚Äã  A union payload is:  | case_id (varuint32) | case_value (Any-style value) |   case_id is the union alternative tag number.  case_value MUST be encoded as a full xlang value:  | field_ref_meta | field_value_type_meta | field_value_bytes |   This is required even for primitives so unknown alternatives can be skipped safely.  Wire layouts‚Äã  UNION (schema known from context)  | ... outer ref meta ... | type_id=UNION(33) | case_id | case_value |   TYPED_UNION (schema identified by numeric id)  | ... outer ref meta ... | type_id=TYPED_UNION(34) | user_type_id | case_id | case_value |   user_type_id: varuint32 numeric registration ID for the union schema.  NAMED_UNION (schema embedded by name/typedef)  | ... outer ref meta ... | type_id=NAMED_UNION(35) | name_or_typedef | case_id | case_value |   Decoding rules‚Äã  Read outer ref meta and type_id.If TYPED_UNION, read user_type_id and resolve the union schema by ID.If NAMED_UNION, read named type meta and resolve the union schema.Read case_id.Read case_value as Any-style value (ref meta + type meta + value).  If case_id is unknown, the decoder MUST still consume the case value using field_value_type_meta and standard skipValue(type_id).  When to use each type ID‚Äã  Use UNION when the union schema is known from context.Use TYPED_UNION for dynamic containers when numeric registration is available.Use NAMED_UNION when name-based resolution is preferred or required.  Compatibility notes‚Äã  case_id is a stable identifier; added alternatives are forward compatible and unknown cases can be skipped.  ","version":"0.15","tagName":"h3"},{"title":"Type‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#type","content":" Type will be serialized using type meta format.  ","version":"0.15","tagName":"h3"},{"title":"Common Pitfalls‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#common-pitfalls","content":" Byte Order: Always use little-endian for multi-byte valuesVarint Sign Extension: Ensure proper handling of signed vs unsigned varintsReference ID Ordering: IDs must be assigned in serialization orderField Order Consistency: Must match exactly across languages in schema-consistent mode; in compatible mode, match by TypeDef field names or tag IDsString Encoding: Use best encoding for current languageNull Handling: Different languages represent null differentlyEmpty Collections: Still write length (0) and header byteSchema Hash Calculation: Must use the same fingerprint and MurmurHash3 algorithm across languages when enabled  ","version":"0.15","tagName":"h2"},{"title":"Language Implementation Guidelines‚Äã","type":1,"pageTitle":"Xlang Serialization Format","url":"/docs/specification/xlang_serialization_spec#language-implementation-guidelines","content":" See Xlang Implementation Guide documentation. ","version":"0.15","tagName":"h2"},{"title":"Usage","type":0,"sectionRef":"#","url":"/docs/start/usage","content":"","keywords":"","version":"0.15"},{"title":"Native Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/start/usage#native-serialization","content":" Always use native mode when working with a single language. Native mode delivers optimal performance by avoiding the type metadata overhead required for cross-language compatibility.  Xlang mode introduces additional metadata encoding costs and restricts serialization to types that are common across all supported languages. Language-specific types will be rejected during serialization in xlang-mode.  ","version":"0.15","tagName":"h2"},{"title":"Java Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/start/usage#java-serialization","content":" When you don't need cross-language support, use Java mode for optimal performance.  import org.apache.fory.*; import org.apache.fory.config.*; public class Example { public static class Person { String name; int age; } public static void main(String[] args) { // Create Fory instance - should be reused across serializations BaseFory fory = Fory.builder() .withLanguage(Language.JAVA) .requireClassRegistration(true) // replace `build` with `buildThreadSafeFory` for Thread-Safe Usage .build(); // Register your classes (required when class registration is enabled) fory.register(Person.class); // Serialize Person person = new Person(); person.name = &quot;chaokunyang&quot;; person.age = 28; byte[] bytes = fory.serialize(person); Person result = (Person) fory.deserialize(bytes); System.out.println(result.name + &quot; &quot; + result.age); // Output: chaokunyang 28 } }   For detailed Java usage including compatibility modes, compression, and advanced features, see Java Serialization Guide.  ","version":"0.15","tagName":"h3"},{"title":"Python Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/start/usage#python-serialization","content":" Python native mode provides a high-performance drop-in replacement for pickle/cloudpickle with better speed and compatibility.  from dataclasses import dataclass import pyfory @dataclass class Person: name: str age: pyfory.int32 # Create Fory instance - should be reused across serializations fory = pyfory.Fory() # Register your classes (required when class registration is enabled) fory.register_type(Person) person = Person(name=&quot;chaokunyang&quot;, age=28) data = fory.serialize(person) result = fory.deserialize(data) print(result.name, result.age) # Output: chaokunyang 28   For detailed Python usage including type hints, compatibility modes, and advanced features, see Python Guide.  ","version":"0.15","tagName":"h3"},{"title":"Scala Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/start/usage#scala-serialization","content":" Scala native mode provides optimized serialization for Scala-specific types including case classes, collections, and Option types.  import org.apache.fory.Fory import org.apache.fory.config.Language import org.apache.fory.serializer.scala.ScalaSerializers case class Person(name: String, age: Int) object Example { def main(args: Array[String]): Unit = { // Create Fory instance - should be reused across serializations val fory = Fory.builder() .withLanguage(Language.JAVA) .requireClassRegistration(true) .build() // Register Scala serializers for Scala-specific types ScalaSerializers.registerSerializers(fory) // Register your case classes fory.register(classOf[Person]) val bytes = fory.serialize(Person(&quot;chaokunyang&quot;, 28)) val result = fory.deserialize(bytes).asInstanceOf[Person] println(s&quot;${result.name} ${result.age}&quot;) // Output: chaokunyang 28 } }   For detailed Scala usage including collection serialization and integration patterns, see Scala Guide.  ","version":"0.15","tagName":"h3"},{"title":"Kotlin Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/start/usage#kotlin-serialization","content":" Kotlin native mode provides optimized serialization for Kotlin-specific types including data classes, nullable types, and Kotlin collections.  import org.apache.fory.Fory import org.apache.fory.config.Language import org.apache.fory.serializer.kotlin.KotlinSerializers data class Person(val name: String, val age: Int) fun main() { // Create Fory instance - should be reused across serializations val fory = Fory.builder() .withLanguage(Language.JAVA) .requireClassRegistration(true) .build() // Register Kotlin serializers for Kotlin-specific types KotlinSerializers.registerSerializers(fory) // Register your data classes fory.register(Person::class.java) val bytes = fory.serialize(Person(&quot;chaokunyang&quot;, 28)) val result = fory.deserialize(bytes) as Person println(&quot;${result.name} ${result.age}&quot;) // Output: chaokunyang 28 }   For detailed Kotlin usage including null safety and default value support, see kotlin/README.md.  ","version":"0.15","tagName":"h3"},{"title":"Cross-Language Serialization‚Äã","type":1,"pageTitle":"Usage","url":"/docs/start/usage#cross-language-serialization","content":" Only use xlang mode when you need cross-language data exchange. Xlang mode adds type metadata overhead for cross-language compatibility and only supports types that can be mapped across all languages. For single-language use cases, always prefer native mode for better performance.  The following examples demonstrate serializing a Person object across Java and Rust. For other languages (Python, Go, JavaScript, etc.), simply set the language mode to XLANG and follow the same pattern.  ","version":"0.15","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Usage","url":"/docs/start/usage#java","content":" import org.apache.fory.*; import org.apache.fory.config.*; public class XlangExample { public record Person(String name, int age) {} public static void main(String[] args) { // Create Fory instance with XLANG mode Fory fory = Fory.builder() .withLanguage(Language.XLANG) .build(); // Register with cross-language type id/name fory.register(Person.class, 1); // fory.register(Person.class, &quot;example.Person&quot;); Person person = new Person(&quot;chaokunyang&quot;, 28); byte[] bytes = fory.serialize(person); // bytes can be deserialized by Rust, Python, Go, or other languages Person result = (Person) fory.deserialize(bytes); System.out.println(result.name + &quot; &quot; + result.age); // Output: chaokunyang 28 } }   ","version":"0.15","tagName":"h3"},{"title":"Rust‚Äã","type":1,"pageTitle":"Usage","url":"/docs/start/usage#rust","content":" use fory::{Fory, ForyObject}; #[derive(ForyObject, Debug)] struct Person { name: String, age: i32, } fn main() -&gt; Result&lt;(), Error&gt; { let mut fory = Fory::default(); fory.register::&lt;Person&gt;(1)?; // fory.register_by_name::&lt;Person&gt;(&quot;example.Person&quot;)?; let person = Person { name: &quot;chaokunyang&quot;.to_string(), age: 28, }; let bytes = fory.serialize(&amp;person); // bytes can be deserialized by Java, Python, Go, or other languages let result: Person = fory.deserialize(&amp;bytes)?; println!(&quot;{} {}&quot;, result.name, result.age); // Output: chaokunyang 28 }   ","version":"0.15","tagName":"h3"},{"title":"Golang‚Äã","type":1,"pageTitle":"Usage","url":"/docs/start/usage#golang","content":" type Person struct { name: string age: i32 } fory := fory.NewFory(true) fory.Register(Person{}, 1) person := Person{&quot;chaokunyang&quot;, 28} bytes, err := fory.Marshal(person) var p Person err = fory.Unmarshal(bytes, &amp;p)   ","version":"0.15","tagName":"h3"},{"title":"JavaScript‚Äã","type":1,"pageTitle":"Usage","url":"/docs/start/usage#javascript","content":" import Fory, { Type } from &quot;@apache-fory/fory&quot;; /** * @apache-fory/hps use v8's fast-calls-api that can be called directly by jit, ensure that the version of Node is 20 or above. * Experimental feature, installation success cannot be guaranteed at this moment * If you are unable to install the module, replace it with `const hps = null;` **/ import hps from &quot;@apache-fory/hps&quot;; // Now we describe data structures using JSON, but in the future, we will use more ways. const description = Type.object(&quot;example.Person&quot;, { name: Type.string(), age: Type.int32(), }); const fory = new Fory({ hps }); const { serialize, deserialize } = fory.registerSerializer(description); const input = serialize({ name: &quot;chaokunyang&quot;, age: 28 }); const result = deserialize(input); console.log(result);   ","version":"0.15","tagName":"h3"},{"title":"Key Points‚Äã","type":1,"pageTitle":"Usage","url":"/docs/start/usage#key-points","content":" Use Language.XLANG mode in all languagesRegister types with consistent IDs or names across all languages: By ID (fory.register(Person.class, 1)): Faster serialization, more compact encoding, but requires coordination to avoid ID conflictsBy name (fory.register(Person.class, &quot;example.Person&quot;)): More flexible, less prone to conflicts, easier to manage across teams, but slightly larger encoding Type IDs/names must match across all languages for successful deserializationOnly use types that have cross-language mappings (see Type Mapping)  For examples with circular references, shared references, and polymorphism across languages, see:  Cross-Language Serialization GuideJava Serialization Guide - Cross LanguagePython Guide - Cross Language  ","version":"0.15","tagName":"h3"},{"title":"Row Format Encoding‚Äã","type":1,"pageTitle":"Usage","url":"/docs/start/usage#row-format-encoding","content":" Row format provides zero-copy random access to serialized data, making it ideal for analytics workloads and data processing pipelines.  ","version":"0.15","tagName":"h2"},{"title":"Java‚Äã","type":1,"pageTitle":"Usage","url":"/docs/start/usage#java-1","content":" import org.apache.fory.format.*; import java.util.*; import java.util.stream.*; public class Bar { String f1; List&lt;Long&gt; f2; } public class Foo { int f1; List&lt;Integer&gt; f2; Map&lt;String, Integer&gt; f3; List&lt;Bar&gt; f4; } RowEncoder&lt;Foo&gt; encoder = Encoders.bean(Foo.class); Foo foo = new Foo(); foo.f1 = 10; foo.f2 = IntStream.range(0, 1000000).boxed().collect(Collectors.toList()); foo.f3 = IntStream.range(0, 1000000).boxed().collect(Collectors.toMap(i -&gt; &quot;k&quot;+i, i -&gt; i)); List&lt;Bar&gt; bars = new ArrayList&lt;&gt;(1000000); for (int i = 0; i &lt; 1000000; i++) { Bar bar = new Bar(); bar.f1 = &quot;s&quot; + i; bar.f2 = LongStream.range(0, 10).boxed().collect(Collectors.toList()); bars.add(bar); } foo.f4 = bars; // Serialize to row format (can be zero-copy read by Python) BinaryRow binaryRow = encoder.toRow(foo); // Deserialize entire object Foo newFoo = encoder.fromRow(binaryRow); // Zero-copy access to nested fields without full deserialization BinaryArray binaryArray2 = binaryRow.getArray(1); // Access f2 field BinaryArray binaryArray4 = binaryRow.getArray(3); // Access f4 field BinaryRow barStruct = binaryArray4.getStruct(10); // Access 11th Bar element long value = barStruct.getArray(1).getInt64(5); // Access nested value // Partial deserialization RowEncoder&lt;Bar&gt; barEncoder = Encoders.bean(Bar.class); Bar newBar = barEncoder.fromRow(barStruct); Bar newBar2 = barEncoder.fromRow(binaryArray4.getStruct(20));   ","version":"0.15","tagName":"h3"},{"title":"Python‚Äã","type":1,"pageTitle":"Usage","url":"/docs/start/usage#python","content":" from dataclasses import dataclass from typing import List, Dict import pyarrow as pa import pyfory @dataclass class Bar: f1: str f2: List[pa.int64] @dataclass class Foo: f1: pa.int32 f2: List[pa.int32] f3: Dict[str, pa.int32] f4: List[Bar] encoder = pyfory.encoder(Foo) foo = Foo( f1=10, f2=list(range(1000_000)), f3={f&quot;k{i}&quot;: i for i in range(1000_000)}, f4=[Bar(f1=f&quot;s{i}&quot;, f2=list(range(10))) for i in range(1000_000)] ) # Serialize to row format binary: bytes = encoder.to_row(foo).to_bytes() # Zero-copy random access without full deserialization foo_row = pyfory.RowData(encoder.schema, binary) print(foo_row.f2[100000]) # Access element directly print(foo_row.f4[100000].f1) # Access nested field print(foo_row.f4[200000].f2[5]) # Access deeply nested field   For more details on row format, see Java Row Format Guide or Python Row Format Guide. ","version":"0.15","tagName":"h3"}],"options":{"id":"default"}}