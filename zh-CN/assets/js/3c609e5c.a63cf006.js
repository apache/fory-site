"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[75554],{61007:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>f,frontMatter:()=>t,metadata:()=>o,toc:()=>d});var i=r(85893),s=r(11151);const t={title:"\u5e26\u5916\u5e8f\u5217\u5316",sidebar_position:7,id:"out_of_band",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},a=void 0,o={id:"guide/python/out_of_band",title:"\u5e26\u5916\u5e8f\u5217\u5316",description:"Fory \u652f\u6301 pickle5 \u517c\u5bb9\u7684\u5e26\u5916\u7f13\u51b2\u533a\u5e8f\u5217\u5316\uff0c\u7528\u4e8e\u9ad8\u6548\u96f6\u62f7\u8d1d\u5904\u7406\u5927\u578b\u6570\u636e\u7ed3\u6784\u3002",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/version-0.15/guide/python/out-of-band.md",sourceDirName:"guide/python",slug:"/guide/python/out_of_band",permalink:"/zh-CN/docs/guide/python/out_of_band",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/i18n/zh-CN/docusaurus-plugin-content-docs/version-0.15/guide/python/out-of-band.md",tags:[],version:"0.15",sidebarPosition:7,frontMatter:{title:"\u5e26\u5916\u5e8f\u5217\u5316",sidebar_position:7,id:"out_of_band",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"Schema \u6f14\u5316",permalink:"/zh-CN/docs/guide/python/schema_evolution"},next:{title:"NumPy \u4e0e\u79d1\u5b66\u8ba1\u7b97",permalink:"/zh-CN/docs/guide/python/numpy_integration"}},l={},d=[{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:2},{value:"\u57fa\u7840\u5e26\u5916\u5e8f\u5217\u5316",id:"\u57fa\u7840\u5e26\u5916\u5e8f\u5217\u5316",level:2},{value:"\u4f7f\u7528 Pandas DataFrame \u7684\u5e26\u5916\u5e8f\u5217\u5316",id:"\u4f7f\u7528-pandas-dataframe-\u7684\u5e26\u5916\u5e8f\u5217\u5316",level:2},{value:"\u9009\u62e9\u6027\u5e26\u5916\u5e8f\u5217\u5316",id:"\u9009\u62e9\u6027\u5e26\u5916\u5e8f\u5217\u5316",level:2},{value:"Pickle5 \u517c\u5bb9\u6027",id:"pickle5-\u517c\u5bb9\u6027",level:2},{value:"\u5c06\u7f13\u51b2\u533a\u5199\u5165\u4e0d\u540c\u7684\u6d41",id:"\u5c06\u7f13\u51b2\u533a\u5199\u5165\u4e0d\u540c\u7684\u6d41",level:2},{value:"\u76f8\u5173\u4e3b\u9898",id:"\u76f8\u5173\u4e3b\u9898",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Fory \u652f\u6301 pickle5 \u517c\u5bb9\u7684\u5e26\u5916\u7f13\u51b2\u533a\u5e8f\u5217\u5316\uff0c\u7528\u4e8e\u9ad8\u6548\u96f6\u62f7\u8d1d\u5904\u7406\u5927\u578b\u6570\u636e\u7ed3\u6784\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u6982\u8ff0",children:"\u6982\u8ff0"}),"\n",(0,i.jsx)(n.p,{children:"\u5e26\u5916\u5e8f\u5217\u5316\u5c06\u5143\u6570\u636e\u4e0e\u5b9e\u9645\u6570\u636e\u7f13\u51b2\u533a\u5206\u79bb\uff0c\u5141\u8bb8\uff1a"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u96f6\u62f7\u8d1d\u4f20\u8f93"}),"\uff1a\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"memoryview"})," \u901a\u8fc7\u7f51\u7edc\u6216 IPC \u53d1\u9001\u6570\u636e\u65f6"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u63d0\u9ad8\u6027\u80fd"}),"\uff1a\u7528\u4e8e\u5927\u578b\u6570\u636e\u96c6"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Pickle5 \u517c\u5bb9\u6027"}),"\uff1a\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"pickle.PickleBuffer"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u7075\u6d3b\u7684\u6d41\u652f\u6301"}),"\uff1a\u5199\u5165\u4efb\u4f55\u53ef\u5199\u5bf9\u8c61\uff08\u6587\u4ef6\u3001BytesIO\u3001\u5957\u63a5\u5b57\u7b49\uff09"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u57fa\u7840\u5e26\u5916\u5e8f\u5217\u5316",children:"\u57fa\u7840\u5e26\u5916\u5e8f\u5217\u5316"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import pyfory\nimport numpy as np\n\nfory = pyfory.Fory(xlang=False, ref=False, strict=False)\n\n# \u5927\u578b numpy \u6570\u7ec4\narray = np.arange(10000, dtype=np.float64)\n\n# \u4f7f\u7528\u5e26\u5916\u7f13\u51b2\u533a\u5e8f\u5217\u5316\nbuffer_objects = []\nserialized_data = fory.serialize(array, buffer_callback=buffer_objects.append)\n\n# \u5c06\u7f13\u51b2\u533a\u5bf9\u8c61\u8f6c\u6362\u4e3a memoryview \u4ee5\u8fdb\u884c\u96f6\u62f7\u8d1d\u4f20\u8f93\n# \u5bf9\u4e8e\u8fde\u7eed\u7f13\u51b2\u533a\uff08bytes\u3001numpy \u6570\u7ec4\uff09\uff0c\u8fd9\u662f\u96f6\u62f7\u8d1d\n# \u5bf9\u4e8e\u975e\u8fde\u7eed\u6570\u636e\uff0c\u53ef\u80fd\u4f1a\u521b\u5efa\u526f\u672c\u4ee5\u786e\u4fdd\u8fde\u7eed\u6027\nbuffers = [obj.getbuffer() for obj in buffer_objects]\n\n# \u4f7f\u7528\u5e26\u5916\u7f13\u51b2\u533a\u53cd\u5e8f\u5217\u5316\uff08\u63a5\u53d7 memoryview\u3001bytes \u6216 Buffer\uff09\ndeserialized_array = fory.deserialize(serialized_data, buffers=buffers)\n\nassert np.array_equal(array, deserialized_array)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u4f7f\u7528-pandas-dataframe-\u7684\u5e26\u5916\u5e8f\u5217\u5316",children:"\u4f7f\u7528 Pandas DataFrame \u7684\u5e26\u5916\u5e8f\u5217\u5316"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import pyfory\nimport pandas as pd\nimport numpy as np\n\nfory = pyfory.Fory(xlang=False, ref=False, strict=False)\n\n# \u521b\u5efa\u5e26\u6570\u503c\u5217\u7684 DataFrame\ndf = pd.DataFrame({\n    'a': np.arange(1000, dtype=np.float64),\n    'b': np.arange(1000, dtype=np.int64),\n    'c': ['text'] * 1000\n})\n\n# \u4f7f\u7528\u5e26\u5916\u7f13\u51b2\u533a\u5e8f\u5217\u5316\nbuffer_objects = []\nserialized_data = fory.serialize(df, buffer_callback=buffer_objects.append)\nbuffers = [obj.getbuffer() for obj in buffer_objects]\n\n# \u53cd\u5e8f\u5217\u5316\ndeserialized_df = fory.deserialize(serialized_data, buffers=buffers)\n\nassert df.equals(deserialized_df)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u9009\u62e9\u6027\u5e26\u5916\u5e8f\u5217\u5316",children:"\u9009\u62e9\u6027\u5e26\u5916\u5e8f\u5217\u5316"}),"\n",(0,i.jsxs)(n.p,{children:["\u901a\u8fc7\u63d0\u4f9b\u56de\u8c03\u6765\u63a7\u5236\u54ea\u4e9b\u7f13\u51b2\u533a\u5e26\u5916\u4f20\u8f93\uff0c\u8be5\u56de\u8c03\u8fd4\u56de ",(0,i.jsx)(n.code,{children:"True"})," \u4fdd\u6301\u6570\u636e\u5185\u8054\u6216\u8fd4\u56de ",(0,i.jsx)(n.code,{children:"False"})," \u5e26\u5916\u53d1\u9001\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import pyfory\nimport numpy as np\n\nfory = pyfory.Fory(xlang=False, ref=True, strict=False)\n\narr1 = np.arange(1000, dtype=np.float64)\narr2 = np.arange(2000, dtype=np.float64)\ndata = [arr1, arr2]\n\nbuffer_objects = []\ncounter = 0\n\ndef selective_callback(buffer_object):\n    global counter\n    counter += 1\n    # \u53ea\u6709\u5076\u6570\u7f16\u53f7\u7684\u7f13\u51b2\u533a\u5e26\u5916\u53d1\u9001\n    if counter % 2 == 0:\n        buffer_objects.append(buffer_object)\n        return False  # \u5e26\u5916\n    return True  # \u5185\u8054\n\nserialized = fory.serialize(data, buffer_callback=selective_callback)\nbuffers = [obj.getbuffer() for obj in buffer_objects]\ndeserialized = fory.deserialize(serialized, buffers=buffers)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"pickle5-\u517c\u5bb9\u6027",children:"Pickle5 \u517c\u5bb9\u6027"}),"\n",(0,i.jsx)(n.p,{children:"Fory \u7684\u5e26\u5916\u5e8f\u5217\u5316\u5b8c\u5168\u517c\u5bb9 pickle \u534f\u8bae 5\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import pyfory\nimport pickle\n\nfory = pyfory.Fory(xlang=False, ref=False, strict=False)\n\n# \u81ea\u52a8\u652f\u6301 PickleBuffer \u5bf9\u8c61\ndata = b"Large binary data"\npickle_buffer = pickle.PickleBuffer(data)\n\n# \u4f7f\u7528\u7f13\u51b2\u533a\u56de\u8c03\u5e8f\u5217\u5316\u4ee5\u8fdb\u884c\u5e26\u5916\u5904\u7406\nbuffer_objects = []\nserialized = fory.serialize(pickle_buffer, buffer_callback=buffer_objects.append)\nbuffers = [obj.getbuffer() for obj in buffer_objects]\n\n# \u4f7f\u7528\u7f13\u51b2\u533a\u53cd\u5e8f\u5217\u5316\ndeserialized = fory.deserialize(serialized, buffers=buffers)\nassert bytes(deserialized.raw()) == data\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u5c06\u7f13\u51b2\u533a\u5199\u5165\u4e0d\u540c\u7684\u6d41",children:"\u5c06\u7f13\u51b2\u533a\u5199\u5165\u4e0d\u540c\u7684\u6d41"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"BufferObject.write_to()"})," \u65b9\u6cd5\u63a5\u53d7\u4efb\u4f55\u53ef\u5199\u6d41\u5bf9\u8c61\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import pyfory\nimport numpy as np\nimport io\n\nfory = pyfory.Fory(xlang=False, ref=False, strict=False)\n\narray = np.arange(1000, dtype=np.float64)\n\n# \u6536\u96c6\u5e26\u5916\u7f13\u51b2\u533a\nbuffer_objects = []\nserialized = fory.serialize(array, buffer_callback=buffer_objects.append)\n\n# \u5199\u5165\u4e0d\u540c\u7684\u6d41\u7c7b\u578b\nfor buffer_obj in buffer_objects:\n    # \u5199\u5165 BytesIO\uff08\u5185\u5b58\u6d41\uff09\n    bytes_stream = io.BytesIO()\n    buffer_obj.write_to(bytes_stream)\n\n    # \u5199\u5165\u6587\u4ef6\n    with open('/tmp/buffer_data.bin', 'wb') as f:\n        buffer_obj.write_to(f)\n\n    # \u83b7\u53d6\u96f6\u62f7\u8d1d memoryview\uff08\u7528\u4e8e\u8fde\u7eed\u7f13\u51b2\u533a\uff09\n    mv = buffer_obj.getbuffer()\n    assert isinstance(mv, memoryview)\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u6ce8\u610f"}),"\uff1a\u5bf9\u4e8e\u8fde\u7eed\u5185\u5b58\u7f13\u51b2\u533a\uff08\u5982 bytes\u3001numpy \u6570\u7ec4\uff09\uff0c",(0,i.jsx)(n.code,{children:"getbuffer()"})," \u8fd4\u56de\u96f6\u62f7\u8d1d ",(0,i.jsx)(n.code,{children:"memoryview"}),"\u3002\u5bf9\u4e8e\u975e\u8fde\u7eed\u6570\u636e\uff0c\u53ef\u80fd\u4f1a\u521b\u5efa\u526f\u672c\u4ee5\u786e\u4fdd\u8fde\u7eed\u6027\u3002"]}),"\n",(0,i.jsx)(n.h2,{id:"\u76f8\u5173\u4e3b\u9898",children:"\u76f8\u5173\u4e3b\u9898"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/zh-CN/docs/guide/python/numpy_integration",children:"NumPy \u96c6\u6210"})," - NumPy \u6570\u7ec4\u5e8f\u5217\u5316"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/zh-CN/docs/guide/python/basic_serialization",children:"\u57fa\u7840\u5e8f\u5217\u5316"})," - \u6807\u51c6\u5e8f\u5217\u5316"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/zh-CN/docs/guide/python/configuration",children:"\u914d\u7f6e"})," - Fory \u53c2\u6570"]}),"\n"]})]})}function f(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},11151:(e,n,r)=>{r.d(n,{Z:()=>o,a:()=>a});var i=r(67294);const s={},t=i.createContext(s);function a(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);