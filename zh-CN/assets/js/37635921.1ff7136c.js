"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[54946],{80680:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>t,toc:()=>c});var r=i(85893),a=i(11151);const o={title:"GraalVM \u5e8f\u5217\u5316",sidebar_position:6,id:"graalvm_serialization",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},s=void 0,t={id:"guide/graalvm_serialization",title:"GraalVM \u5e8f\u5217\u5316",description:"GraalVM Native Image",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/version-0.11/guide/graalvm_guide.md",sourceDirName:"guide",slug:"/guide/graalvm_serialization",permalink:"/zh-CN/docs/0.11/guide/graalvm_serialization",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/i18n/zh-CN/docusaurus-plugin-content-docs/version-0.11/guide/graalvm_guide.md",tags:[],version:"0.11",sidebarPosition:6,frontMatter:{title:"GraalVM \u5e8f\u5217\u5316",sidebar_position:6,id:"graalvm_serialization",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"Scala \u5e8f\u5217\u5316",permalink:"/zh-CN/docs/0.11/guide/serialization"},next:{title:"\u5f00\u53d1\u6307\u5357",permalink:"/zh-CN/docs/0.11/guide/development"}},l={},c=[{value:"GraalVM Native Image",id:"graalvm-native-image",level:2},{value:"\u975e\u7ebf\u7a0b\u5b89\u5168 Fory",id:"\u975e\u7ebf\u7a0b\u5b89\u5168-fory",level:2},{value:"\u7ebf\u7a0b\u5b89\u5168 Fory",id:"\u7ebf\u7a0b\u5b89\u5168-fory",level:2},{value:"\u6846\u67b6\u96c6\u6210",id:"\u6846\u67b6\u96c6\u6210",level:2},{value:"Benchmark",id:"benchmark",level:2},{value:"Struct \u57fa\u51c6\u6d4b\u8bd5",id:"struct-\u57fa\u51c6\u6d4b\u8bd5",level:3},{value:"\u7c7b\u5b57\u6bb5",id:"\u7c7b\u5b57\u6bb5",level:4},{value:"Benchmark \u7ed3\u679c",id:"benchmark-\u7ed3\u679c",level:4},{value:"Pojo \u57fa\u51c6\u6d4b\u8bd5",id:"pojo-\u57fa\u51c6\u6d4b\u8bd5",level:3},{value:"\u7c7b\u5b57\u6bb5",id:"\u7c7b\u5b57\u6bb5-1",level:4},{value:"Benchmark \u7ed3\u679c",id:"benchmark-\u7ed3\u679c-1",level:4}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"graalvm-native-image",children:"GraalVM Native Image"}),"\n",(0,r.jsxs)(n.p,{children:["GraalVM \u7684 ",(0,r.jsx)(n.code,{children:"native image"})," \u80fd\u5c06 Java \u4ee3\u7801\u63d0\u524d\u7f16\u8bd1\u4e3a\u672c\u5730\u4ee3\u7801\uff0c\u4ece\u800c\u6784\u5efa\u66f4\u5feb\u3001\u66f4\u5c0f\u3001\u66f4\u7cbe\u7b80\u7684\u5e94\u7528\u3002\nNative image \u4e0d\u5305\u542b JIT \u7f16\u8bd1\u5668\uff0c\u65e0\u6cd5\u5728\u8fd0\u884c\u65f6\u5c06\u5b57\u8282\u7801\u7f16\u8bd1\u4e3a\u673a\u5668\u7801\uff0c\u4e5f\u4e0d\u652f\u6301\u53cd\u5c04\uff0c\u9664\u975e\u914d\u7f6e\u53cd\u5c04\u5143\u6570\u636e\u6587\u4ef6\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["Apache Fory\u2122 \u5728GraalVM native image \u4e0b\u8fd0\u884c\u826f\u597d\u3002Fory \u4f1a\u5728 graalvm \u6784\u5efa\u9636\u6bb5\u4e3a ",(0,r.jsx)(n.code,{children:"Fory JIT framework"})," \u548c ",(0,r.jsx)(n.code,{children:"MethodHandle/LambdaMetafactory"})," \u751f\u6210\u6240\u6709\u5e8f\u5217\u5316\u5668\u4ee3\u7801\uff0c\u8fd0\u884c\u65f6\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e9b\u751f\u6210\u7684\u4ee3\u7801\u8fdb\u884c\u5e8f\u5217\u5316\uff0c\u65e0\u9700\u989d\u5916\u5f00\u9500\uff0c\u6027\u80fd\u4f18\u5f02\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5728 graalvm native image \u4e0b\u4f7f\u7528 Fory \u65f6\uff0c\u5fc5\u987b\u5c06 Fory \u521b\u5efa\u4e3a\u7c7b\u7684",(0,r.jsx)(n.strong,{children:"\u9759\u6001"}),"\u5b57\u6bb5\uff0c\u5e76\u5728\u7c7b\u521d\u59cb\u5316\u65f6",(0,r.jsx)(n.strong,{children:"\u6ce8\u518c"}),"\u6240\u6709\u7c7b\u578b\u3002\u7136\u540e\u5728 ",(0,r.jsx)(n.code,{children:"resources/META-INF/native-image/$xxx/native-image.properties"})," \u4e0b\u914d\u7f6e ",(0,r.jsx)(n.code,{children:"native-image.properties"}),"\uff0c\u544a\u77e5 graalvm \u5728 native image \u6784\u5efa\u65f6\u521d\u59cb\u5316\u8be5\u7c7b\u3002\u4f8b\u5982\uff0c\u914d\u7f6e ",(0,r.jsx)(n.code,{children:"org.apache.fory.graalvm.Example"})," \u7c7b\u5728\u6784\u5efa\u65f6\u521d\u59cb\u5316\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-properties",children:"Args = --initialize-at-build-time=org.apache.fory.graalvm.Example\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u4f7f\u7528 fory \u7684\u53e6\u4e00\u4e2a\u597d\u5904\u662f\u65e0\u9700\u914d\u7f6e\u7e41\u7410\u7684 ",(0,r.jsx)(n.a,{href:"https://www.graalvm.org/latest/reference-manual/native-image/metadata/#specifying-reflection-metadata-in-json",children:"reflection json"})," \u548c ",(0,r.jsx)(n.a,{href:"https://www.graalvm.org/latest/reference-manual/native-image/metadata/#serialization",children:"serialization json"}),"\u3002\u53ea\u9700\u5bf9\u6bcf\u4e2a\u9700\u8981\u5e8f\u5217\u5316\u7684\u7c7b\u578b\u8c03\u7528 ",(0,r.jsx)(n.code,{children:"org.apache.fory.Fory.register(Class<?>, boolean)"})," \u5373\u53ef\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u6ce8\u610f\uff1aFory \u7684 ",(0,r.jsx)(n.code,{children:"asyncCompilationEnabled"})," \u9009\u9879\u5728 graalvm native image \u4e0b\u4f1a\u81ea\u52a8\u7981\u7528\uff0c\u56e0\u4e3a native image \u8fd0\u884c\u65f6\u4e0d\u652f\u6301 JIT\u3002"]}),"\n",(0,r.jsx)(n.h2,{id:"\u975e\u7ebf\u7a0b\u5b89\u5168-fory",children:"\u975e\u7ebf\u7a0b\u5b89\u5168 Fory"}),"\n",(0,r.jsx)(n.p,{children:"\u793a\u4f8b\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'import org.apache.fory.Fory;\nimport org.apache.fory.util.Preconditions;\n\nimport java.util.List;\nimport java.util.Map;\n\npublic class Example {\n  public record Record (\n    int f1,\n    String f2,\n    List<String> f3,\n    Map<String, Long> f4) {\n  }\n\n  static Fory fory;\n\n  static {\n    fory = Fory.builder().build();\n    // \u6ce8\u518c\u5e76\u751f\u6210\u5e8f\u5217\u5316\u5668\u4ee3\u7801\u3002\n    fory.register(Record.class, true);\n  }\n\n  public static void main(String[] args) {\n    Record record = new Record(10, "abc", List.of("str1", "str2"), Map.of("k1", 10L, "k2", 20L));\n    System.out.println(record);\n    byte[] bytes = fory.serialize(record);\n    Object o = fory.deserialize(bytes);\n    System.out.println(o);\n    Preconditions.checkArgument(record.equals(o));\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u7136\u540e\u5728 ",(0,r.jsx)(n.code,{children:"native-image.properties"})," \u914d\u7f6e\u4e2d\u6dfb\u52a0 ",(0,r.jsx)(n.code,{children:"org.apache.fory.graalvm.Example"})," \u7684\u6784\u5efa\u65f6\u521d\u59cb\u5316\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-properties",children:"Args = --initialize-at-build-time=org.apache.fory.graalvm.Example\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u7ebf\u7a0b\u5b89\u5168-fory",children:"\u7ebf\u7a0b\u5b89\u5168 Fory"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'import org.apache.fory.Fory;\nimport org.apache.fory.ThreadLocalFory;\nimport org.apache.fory.ThreadSafeFory;\nimport org.apache.fory.util.Preconditions;\n\nimport java.util.List;\nimport java.util.Map;\n\npublic class ThreadSafeExample {\n  public record Foo (\n    int f1,\n    String f2,\n    List<String> f3,\n    Map<String, Long> f4) {\n  }\n\n  static ThreadSafeFory fory;\n\n  static {\n    fory = new ThreadLocalFory(classLoader -> {\n      Fory f = Fory.builder().build();\n      // \u6ce8\u518c\u5e76\u751f\u6210\u5e8f\u5217\u5316\u5668\u4ee3\u7801\u3002\n      f.register(Foo.class, true);\n      return f;\n    });\n  }\n\n  public static void main(String[] args) {\n    System.out.println(fory.deserialize(fory.serialize("abc")));\n    System.out.println(fory.deserialize(fory.serialize(List.of(1,2,3))));\n    System.out.println(fory.deserialize(fory.serialize(Map.of("k1", 1, "k2", 2))));\n    Foo foo = new Foo(10, "abc", List.of("str1", "str2"), Map.of("k1", 10L, "k2", 20L));\n    System.out.println(foo);\n    byte[] bytes = fory.serialize(foo);\n    Object o = fory.deserialize(bytes);\n    System.out.println(o);\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u7136\u540e\u5728 ",(0,r.jsx)(n.code,{children:"native-image.properties"})," \u914d\u7f6e\u4e2d\u6dfb\u52a0 ",(0,r.jsx)(n.code,{children:"org.apache.fory.graalvm.ThreadSafeExample"})," \u7684\u6784\u5efa\u65f6\u521d\u59cb\u5316\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-properties",children:"Args = --initialize-at-build-time=org.apache.fory.graalvm.ThreadSafeExample\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u6846\u67b6\u96c6\u6210",children:"\u6846\u67b6\u96c6\u6210"}),"\n",(0,r.jsxs)(n.p,{children:["\u5bf9\u4e8e\u6846\u67b6\u5f00\u53d1\u8005\uff0c\u5982\u679c\u5e0c\u671b\u96c6\u6210 fory \u4f5c\u4e3a\u5e8f\u5217\u5316\u65b9\u6848\uff0c\u53ef\u4ee5\u63d0\u4f9b\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u8ba9\u7528\u6237\u5217\u51fa\u6240\u6709\u9700\u8981\u5e8f\u5217\u5316\u7684\u7c7b\uff0c\u7136\u540e\u52a0\u8f7d\u8fd9\u4e9b\u7c7b\u5e76\u5728 Fory \u96c6\u6210\u7c7b\u4e2d\u8c03\u7528 ",(0,r.jsx)(n.code,{children:"org.apache.fory.Fory.register(Class<?>, boolean)"})," \u8fdb\u884c\u6ce8\u518c\uff0c\u5e76\u914d\u7f6e\u8be5\u7c7b\u5728 graalvm native image \u6784\u5efa\u65f6\u521d\u59cb\u5316\u3002"]}),"\n",(0,r.jsx)(n.h2,{id:"benchmark",children:"Benchmark"}),"\n",(0,r.jsx)(n.p,{children:"\u8fd9\u91cc\u7ed9\u51fa Fory \u4e0e Graalvm Serialization \u7684\u4e24\u4e2a\u7c7b\u7684\u57fa\u51c6\u6d4b\u8bd5\u3002"}),"\n",(0,r.jsx)(n.p,{children:"Fory \u672a\u5f00\u542f\u538b\u7f29\u65f6\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Struct\uff1aFory \u4e3a JDK \u7684 ",(0,r.jsx)(n.code,{children:"46x \u901f\u5ea6\uff0c43% \u5927\u5c0f"})]}),"\n",(0,r.jsxs)(n.li,{children:["Pojo\uff1aFory \u4e3a JDK \u7684 ",(0,r.jsx)(n.code,{children:"12x \u901f\u5ea6\uff0c56% \u5927\u5c0f"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Fory \u5f00\u542f\u538b\u7f29\u65f6\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Struct\uff1aFory \u4e3a JDK \u7684 ",(0,r.jsx)(n.code,{children:"24x \u901f\u5ea6\uff0c31% \u5927\u5c0f"})]}),"\n",(0,r.jsxs)(n.li,{children:["Pojo\uff1aFory \u4e3a JDK \u7684 ",(0,r.jsx)(n.code,{children:"12x \u901f\u5ea6\uff0c48% \u5927\u5c0f"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u57fa\u51c6\u6d4b\u8bd5\u4ee3\u7801\u89c1 [",(0,r.jsx)(n.a,{href:"https://github.com/apache/fory/blob/main/integration_tests/graalvm_tests/src/main/java/org/apache/fory/graalvm/Benchmark.java",children:"Benchmark.java"}),"]\u3002"]}),"\n",(0,r.jsx)(n.h3,{id:"struct-\u57fa\u51c6\u6d4b\u8bd5",children:"Struct \u57fa\u51c6\u6d4b\u8bd5"}),"\n",(0,r.jsx)(n.h4,{id:"\u7c7b\u5b57\u6bb5",children:"\u7c7b\u5b57\u6bb5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"public class Struct implements Serializable {\n  public int f1;\n  public long f2;\n  public float f3;\n  public double f4;\n  public int f5;\n  public long f6;\n  public float f7;\n  public double f8;\n  public int f9;\n  public long f10;\n  public float f11;\n  public double f12;\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"benchmark-\u7ed3\u679c",children:"Benchmark \u7ed3\u679c"}),"\n",(0,r.jsx)(n.p,{children:"\u672a\u538b\u7f29\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Benchmark repeat number: 400000\nObject type: class org.apache.fory.graalvm.Struct\nCompress number: false\nFory size: 76.0\nJDK size: 178.0\nFory serialization took mills: 49\nJDK serialization took mills: 2254\nCompare speed: Fory is 45.70x speed of JDK\nCompare size: Fory is 0.43x size of JDK\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u538b\u7f29\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Benchmark repeat number: 400000\nObject type: class org.apache.fory.graalvm.Struct\nCompress number: true\nFory size: 55.0\nJDK size: 178.0\nFory serialization took mills: 130\nJDK serialization took mills: 3161\nCompare speed: Fory is 24.16x speed of JDK\nCompare size: Fory is 0.31x size of JDK\n"})}),"\n",(0,r.jsx)(n.h3,{id:"pojo-\u57fa\u51c6\u6d4b\u8bd5",children:"Pojo \u57fa\u51c6\u6d4b\u8bd5"}),"\n",(0,r.jsx)(n.h4,{id:"\u7c7b\u5b57\u6bb5-1",children:"\u7c7b\u5b57\u6bb5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"public class Foo implements Serializable {\n  int f1;\n  String f2;\n  List<String> f3;\n  Map<String, Long> f4;\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"benchmark-\u7ed3\u679c-1",children:"Benchmark \u7ed3\u679c"}),"\n",(0,r.jsx)(n.p,{children:"\u672a\u538b\u7f29\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Benchmark repeat number: 400000\nObject type: class org.apache.fory.graalvm.Foo\nCompress number: false\nFory size: 541.0\nJDK size: 964.0\nFory serialization took mills: 1663\nJDK serialization took mills: 16266\nCompare speed: Fory is 12.19x speed of JDK\nCompare size: Fory is 0.56x size of JDK\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u538b\u7f29\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Benchmark repeat number: 400000\nObject type: class org.apache.fory.graalvm.Foo\nCompress number: true\nFory size: 459.0\nJDK size: 964.0\nFory serialization took mills: 1289\nJDK serialization took mills: 15069\nCompare speed: Fory is 12.11x speed of JDK\nCompare size: Fory is 0.48x size of JDK\n"})})]})}function p(e={}){const{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},11151:(e,n,i)=>{i.d(n,{Z:()=>t,a:()=>s});var r=i(67294);const a={},o=r.createContext(a);function s(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);