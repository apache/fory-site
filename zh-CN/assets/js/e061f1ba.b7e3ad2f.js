"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[32174],{37656:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>o,toc:()=>t});var a=i(85893),r=i(11151);const l={title:"Scala \u5e8f\u5217\u5316",sidebar_position:4,id:"serialization",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},s=void 0,o={id:"guide/serialization",title:"Scala \u5e8f\u5217\u5316",description:"Apache Fory\u2122 \u652f\u6301\u6240\u6709 Scala \u5bf9\u8c61\u7684\u5e8f\u5217\u5316\uff1a",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/version-0.12/guide/scala_guide.md",sourceDirName:"guide",slug:"/guide/serialization",permalink:"/zh-CN/docs/0.12/guide/serialization",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/i18n/zh-CN/docusaurus-plugin-content-docs/version-0.12/guide/scala_guide.md",tags:[],version:"0.12",sidebarPosition:4,frontMatter:{title:"Scala \u5e8f\u5217\u5316",sidebar_position:4,id:"serialization",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"\u8de8\u8bed\u8a00\u7c7b\u578b\u6620\u5c04",permalink:"/zh-CN/docs/0.12/guide/xlang_type_mapping"},next:{title:"Scala \u5e8f\u5217\u5316",permalink:"/zh-CN/docs/0.12/guide/serialization"}},c={},t=[{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:2},{value:"\u5feb\u901f\u5f00\u59cb",id:"\u5feb\u901f\u5f00\u59cb",level:2},{value:"Fory \u5b9e\u4f8b\u521b\u5efa",id:"fory-\u5b9e\u4f8b\u521b\u5efa",level:2},{value:"\u5e8f\u5217\u5316 case class",id:"\u5e8f\u5217\u5316-case-class",level:2},{value:"\u5e8f\u5217\u5316 pojo",id:"\u5e8f\u5217\u5316-pojo",level:2},{value:"\u5e8f\u5217\u5316 object \u5355\u4f8b\u5bf9\u8c61",id:"\u5e8f\u5217\u5316-object-\u5355\u4f8b\u5bf9\u8c61",level:2},{value:"\u5e8f\u5217\u5316\u96c6\u5408\uff08Collection\uff09",id:"\u5e8f\u5217\u5316\u96c6\u5408collection",level:2},{value:"\u5e8f\u5217\u5316 Tuple",id:"\u5e8f\u5217\u5316-tuple",level:2},{value:"\u5e8f\u5217\u5316 Enum",id:"\u5e8f\u5217\u5316-enum",level:2},{value:"Scala3 Enum",id:"scala3-enum",level:3},{value:"Scala2 Enum",id:"scala2-enum",level:3},{value:"\u5e8f\u5217\u5316 Option",id:"\u5e8f\u5217\u5316-option",level:2},{value:"\u6027\u80fd",id:"\u6027\u80fd",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"Apache Fory\u2122 \u652f\u6301\u6240\u6709 Scala \u5bf9\u8c61\u7684\u5e8f\u5217\u5316\uff1a"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\u652f\u6301 ",(0,a.jsx)(n.code,{children:"case"})," class \u5e8f\u5217\u5316"]}),"\n",(0,a.jsxs)(n.li,{children:["\u652f\u6301 ",(0,a.jsx)(n.code,{children:"pojo/bean"})," class \u5e8f\u5217\u5316"]}),"\n",(0,a.jsxs)(n.li,{children:["\u652f\u6301 ",(0,a.jsx)(n.code,{children:"object"})," \u5355\u4f8b\u5bf9\u8c61\u5e8f\u5217\u5316"]}),"\n",(0,a.jsxs)(n.li,{children:["\u652f\u6301 ",(0,a.jsx)(n.code,{children:"collection"})," \u96c6\u5408\u5e8f\u5217\u5316"]}),"\n",(0,a.jsxs)(n.li,{children:["\u5176\u4ed6\u7c7b\u578b\u5982 ",(0,a.jsx)(n.code,{children:"tuple/either"})," \u4ee5\u53ca\u57fa\u7840\u7c7b\u578b\u4e5f\u90fd\u652f\u6301"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"\u540c\u65f6\u652f\u6301 Scala 2 \u548c Scala 3\u3002"}),"\n",(0,a.jsx)(n.h2,{id:"\u5b89\u88c5",children:"\u5b89\u88c5"}),"\n",(0,a.jsx)(n.p,{children:"\u5982\u679c\u4f60\u4f7f\u7528 sbt \u5e76\u5e0c\u671b\u5728 Scala 2 \u9879\u76ee\u4e2d\u5f15\u5165 Fory Scala \u4f9d\u8d56\uff0c\u8bf7\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sbt",children:'libraryDependencies += "org.apache.fory" % "fory-scala_2.13" % "0.12.0"\n'})}),"\n",(0,a.jsx)(n.p,{children:"\u5982\u679c\u4f60\u4f7f\u7528 sbt \u5e76\u5e0c\u671b\u5728 Scala 3 \u9879\u76ee\u4e2d\u5f15\u5165 Fory Scala \u4f9d\u8d56\uff0c\u8bf7\u6dfb\u52a0\u5982\u4e0b\u5185\u5bb9\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sbt",children:'libraryDependencies += "org.apache.fory" % "fory-scala_3" % "0.12.0"\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u5feb\u901f\u5f00\u59cb",children:"\u5feb\u901f\u5f00\u59cb"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-scala",children:'case class Person(name: String, id: Long, github: String)\ncase class Point(x : Int, y : Int, z : Int)\n\nobject ScalaExample {\n  val fory: Fory = Fory.builder().withScalaOptimizationEnabled(true).build()\n  // \u6ce8\u518c\u9488\u5bf9 Scala \u4f18\u5316\u7684 fory \u5e8f\u5217\u5316\u5668\n  ScalaSerializers.registerSerializers(fory)\n  fory.register(classOf[Person])\n  fory.register(classOf[Point])\n\n  def main(args: Array[String]): Unit = {\n    val p = Person("Shawn Yang", 1, "https://github.com/chaokunyang")\n    println(fory.deserialize(fory.serialize(p)))\n    println(fory.deserialize(fory.serialize(Point(1, 2, 3))))\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"fory-\u5b9e\u4f8b\u521b\u5efa",children:"Fory \u5b9e\u4f8b\u521b\u5efa"}),"\n",(0,a.jsx)(n.p,{children:"\u5728\u4f7f\u7528 fory \u8fdb\u884c Scala \u5e8f\u5217\u5316\u65f6\uff0c\u5efa\u8bae\u81f3\u5c11\u4ee5\u5982\u4e0b\u65b9\u5f0f\u521b\u5efa fory \u5b9e\u4f8b\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-scala",children:"import org.apache.fory.Fory\nimport org.apache.fory.serializer.scala.ScalaSerializers\n\nval fory = Fory.builder().withScalaOptimizationEnabled(true).build()\n\n// \u6ce8\u518c\u9488\u5bf9 Scala \u4f18\u5316\u7684 fory \u5e8f\u5217\u5316\u5668\nScalaSerializers.registerSerializers(fory)\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u6839\u636e\u4f60\u9700\u8981\u5e8f\u5217\u5316\u7684\u5bf9\u8c61\u7c7b\u578b\uff0c\u53ef\u80fd\u8fd8\u9700\u8981\u6ce8\u518c\u4e00\u4e9b Scala \u5185\u90e8\u7c7b\u578b\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-scala",children:'fory.register(Class.forName("scala.Enumeration.Val"))\n'})}),"\n",(0,a.jsxs)(n.p,{children:["\u5982\u679c\u4f60\u5e0c\u671b\u907f\u514d\u624b\u52a8\u6ce8\u518c\u8fd9\u4e9b\u7c7b\u578b\uff0c\u53ef\u4ee5\u901a\u8fc7 ",(0,a.jsx)(n.code,{children:"ForyBuilder#requireClassRegistration(false)"})," \u5173\u95ed\u7c7b\u6ce8\u518c\u529f\u80fd\u3002\n\u6ce8\u610f\uff1a\u5173\u95ed\u7c7b\u6ce8\u518c\u540e\uff0c\u53ef\u4ee5\u53cd\u5e8f\u5217\u5316\u672a\u77e5\u7c7b\u578b\u7684\u5bf9\u8c61\uff0c\u7075\u6d3b\u6027\u66f4\u9ad8\uff0c\u4f46\u5982\u679c\u53cd\u5e8f\u5217\u5316\u7684\u7c7b\u5305\u542b\u6076\u610f\u4ee3\u7801\uff0c\u53ef\u80fd\u5b58\u5728\u5b89\u5168\u98ce\u9669\u3002"]}),"\n",(0,a.jsxs)(n.p,{children:["Scala \u4e2d\u5faa\u73af\u5f15\u7528\u8f83\u4e3a\u5e38\u89c1\uff0c\u5efa\u8bae\u901a\u8fc7 ",(0,a.jsx)(n.code,{children:"ForyBuilder#withRefTracking(true)"})," \u542f\u7528\u5f15\u7528\u8ddf\u8e2a\uff08Reference tracking\uff09\u3002\u5982\u679c\u672a\u542f\u7528\u5f15\u7528\u8ddf\u8e2a\uff0c\u5728\u67d0\u4e9b Scala \u7248\u672c\u4e0b\u5e8f\u5217\u5316 Scala Enumeration \u65f6\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0 ",(0,a.jsx)(n.a,{href:"https://github.com/apache/fory/issues/1032",children:"StackOverflowError"}),"\u3002"]}),"\n",(0,a.jsx)(n.p,{children:"\u6ce8\u610f\uff1afory \u5b9e\u4f8b\u5e94\u5728\u591a\u6b21\u5e8f\u5217\u5316\u64cd\u4f5c\u95f4\u590d\u7528\uff0cfory \u5b9e\u4f8b\u7684\u521b\u5efa\u5f00\u9500\u8f83\u5927\u3002"}),"\n",(0,a.jsxs)(n.p,{children:["\u5982\u679c\u4f60\u9700\u8981\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u5171\u4eab fory \u5b9e\u4f8b\uff0c\u5e94\u901a\u8fc7 ",(0,a.jsx)(n.code,{children:"ForyBuilder#buildThreadSafeFory()"})," \u521b\u5efa ",(0,a.jsx)(n.code,{children:"ThreadSafeFory"})," \u5b9e\u4f8b\u3002"]}),"\n",(0,a.jsx)(n.h2,{id:"\u5e8f\u5217\u5316-case-class",children:"\u5e8f\u5217\u5316 case class"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-scala",children:'case class Person(github: String, age: Int, id: Long)\nval p = Person("https://github.com/chaokunyang", 18, 1)\nprintln(fory.deserialize(fory.serialize(p)))\nprintln(fory.deserializeJavaObject(fory.serializeJavaObject(p)))\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u5e8f\u5217\u5316-pojo",children:"\u5e8f\u5217\u5316 pojo"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-scala",children:'class Foo(f1: Int, f2: String) {\n  override def toString: String = s"Foo($f1, $f2)"\n}\nprintln(fory.deserialize(fory.serialize(Foo(1, "chaokunyang"))))\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u5e8f\u5217\u5316-object-\u5355\u4f8b\u5bf9\u8c61",children:"\u5e8f\u5217\u5316 object \u5355\u4f8b\u5bf9\u8c61"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-scala",children:"object singleton {\n}\nval o1 = fory.deserialize(fory.serialize(singleton))\nval o2 = fory.deserialize(fory.serialize(singleton))\nprintln(o1 == o2)\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u5e8f\u5217\u5316\u96c6\u5408collection",children:"\u5e8f\u5217\u5316\u96c6\u5408\uff08Collection\uff09"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-scala",children:'val seq = Seq(1,2)\nval list = List("a", "b")\nval map = Map("a" -> 1, "b" -> 2)\nprintln(fory.deserialize(fory.serialize(seq)))\nprintln(fory.deserialize(fory.serialize(list)))\nprintln(fory.deserialize(fory.serialize(map)))\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u5e8f\u5217\u5316-tuple",children:"\u5e8f\u5217\u5316 Tuple"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-scala",children:'val tuple = Tuple2(100, 10000L)\nprintln(fory.deserialize(fory.serialize(tuple)))\nval tuple = Tuple4(100, 10000L, 10000L, "str")\nprintln(fory.deserialize(fory.serialize(tuple)))\n'})}),"\n",(0,a.jsx)(n.h2,{id:"\u5e8f\u5217\u5316-enum",children:"\u5e8f\u5217\u5316 Enum"}),"\n",(0,a.jsx)(n.h3,{id:"scala3-enum",children:"Scala3 Enum"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-scala",children:"enum Color { case Red, Green, Blue }\nprintln(fory.deserialize(fory.serialize(Color.Green)))\n"})}),"\n",(0,a.jsx)(n.h3,{id:"scala2-enum",children:"Scala2 Enum"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-scala",children:"object ColorEnum extends Enumeration {\n  type ColorEnum = Value\n  val Red, Green, Blue = Value\n}\nprintln(fory.deserialize(fory.serialize(ColorEnum.Green)))\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u5e8f\u5217\u5316-option",children:"\u5e8f\u5217\u5316 Option"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-scala",children:"val opt: Option[Long] = Some(100)\nprintln(fory.deserialize(fory.serialize(opt)))\nval opt1: Option[Long] = None\nprintln(fory.deserialize(fory.serialize(opt1)))\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u6027\u80fd",children:"\u6027\u80fd"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"pojo/bean/case/object"})," Scala \u5bf9 Apache Fory\u2122 JIT \u7684\u652f\u6301\u5f88\u597d\uff0c\u6027\u80fd\u4e0e Apache Fory\u2122 Java \u4e00\u6837\u4f18\u5f02\u3002"]}),"\n",(0,a.jsx)(n.p,{children:"Scala \u96c6\u5408\u548c\u6cdb\u578b\u4e0d\u9075\u5faa Java \u96c6\u5408\u6846\u67b6\uff0c\u5e76\u4e14\u672a\u4e0e\u5f53\u524d\u53d1\u884c\u7248\u4e2d\u7684 Apache Fory\u2122 JIT \u5b8c\u5168\u96c6\u6210\u3002\u6027\u80fd\u4e0d\u4f1a\u50cf Java \u7684 Fory collections \u5e8f\u5217\u5316\u90a3\u4e48\u597d\u3002"}),"\n",(0,a.jsxs)(n.p,{children:["scala \u96c6\u5408\u7684\u6267\u884c\u5c06\u8c03\u7528 Java \u5e8f\u5217\u5316 API ",(0,a.jsx)(n.code,{children:"writeObject/readObject/writeReplace/readResolve/readObjectNoData/Externalizable"})," \u548c Fory ",(0,a.jsx)(n.code,{children:"ObjectStream"})," \u5b9e\u73b0\u3002\u867d\u7136 ",(0,a.jsx)(n.code,{children:"org.apache.fory.serializer.ObjectStreamSerializer"})," \u6bd4 JDK ",(0,a.jsx)(n.code,{children:"ObjectOutputStream/ObjectInputStream"})," \u5feb\u5f88\u591a\uff0c\u4f46\u5b83\u4ecd\u7136\u4e0d\u77e5\u9053\u5982\u4f55\u4f7f\u7528 Scala \u96c6\u5408\u6cdb\u578b\u3002"]}),"\n",(0,a.jsxs)(n.p,{children:["\u672a\u6765\u6211\u4eec\u8ba1\u5212\u4e3a Scala \u7c7b\u578b\u63d0\u4f9b\u66f4\u591a\u4f18\u5316\uff0c\u656c\u8bf7\u671f\u5f85\uff0c\u66f4\u591a\u4fe1\u606f\u8bf7\u53c2\u770b ",(0,a.jsx)(n.a,{href:"https://github.com/apache/fory/issues/682",children:"#682"}),"\uff01"]}),"\n",(0,a.jsxs)(n.p,{children:["Scala \u96c6\u5408\u5e8f\u5217\u5316\u5df2\u5728 ",(0,a.jsx)(n.a,{href:"https://github.com/apache/fory/pull/1073",children:"#1073"})," \u5b8c\u6210 \uff0c\u5982\u679c\u60a8\u60f3\u83b7\u5f97\u66f4\u597d\u7684\u6027\u80fd\uff0c\u8bf7\u4f7f\u7528 Apache Fory\u2122 snapshot \u7248\u672c\u3002"]})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},11151:(e,n,i)=>{i.d(n,{Z:()=>o,a:()=>s});var a=i(67294);const r={},l=a.createContext(r);function s(e){const n=a.useContext(l);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),a.createElement(l.Provider,{value:n},e.children)}}}]);