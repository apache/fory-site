"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[26370],{25244:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>c,toc:()=>o});var t=r(85893),i=r(11151);const s={title:"\u884c\u683c\u5f0f",sidebar_position:7,id:"row_format",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},d=void 0,c={id:"guide/cpp/row_format",title:"\u884c\u683c\u5f0f",description:"\u672c\u9875\u4ecb\u7ecd\u7528\u4e8e\u9ad8\u6027\u80fd\u3001\u7f13\u5b58\u53cb\u597d\u7684\u6570\u636e\u8bbf\u95ee\u7684\u884c\u683c\u5f0f\u5e8f\u5217\u5316\u3002",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/version-0.15/guide/cpp/row-format.md",sourceDirName:"guide/cpp",slug:"/guide/cpp/row_format",permalink:"/zh-CN/docs/guide/cpp/row_format",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/i18n/zh-CN/docusaurus-plugin-content-docs/version-0.15/guide/cpp/row-format.md",tags:[],version:"0.15",sidebarPosition:7,frontMatter:{title:"\u884c\u683c\u5f0f",sidebar_position:7,id:"row_format",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"\u81ea\u5b9a\u4e49\u5e8f\u5217\u5316\u5668",permalink:"/zh-CN/docs/guide/cpp/custom_serializers"},next:{title:"Go \u5e8f\u5217\u5316\u6307\u5357",permalink:"/zh-CN/docs/guide/go/"}},l={},o=[{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:2},{value:"\u4f55\u65f6\u4f7f\u7528\u884c\u683c\u5f0f",id:"\u4f55\u65f6\u4f7f\u7528\u884c\u683c\u5f0f",level:2},{value:"\u5feb\u901f\u5f00\u59cb",id:"\u5feb\u901f\u5f00\u59cb",level:2},{value:"\u884c\u7f16\u7801\u5668",id:"\u884c\u7f16\u7801\u5668",level:2},{value:"\u57fa\u672c\u7528\u6cd5",id:"\u57fa\u672c\u7528\u6cd5",level:3},{value:"\u5d4c\u5957\u7ed3\u6784\u4f53",id:"\u5d4c\u5957\u7ed3\u6784\u4f53",level:3},{value:"\u6570\u7ec4 / \u5217\u8868",id:"\u6570\u7ec4--\u5217\u8868",level:3},{value:"\u76f4\u63a5\u7f16\u7801\u6570\u7ec4",id:"\u76f4\u63a5\u7f16\u7801\u6570\u7ec4",level:3},{value:"\u884c\u6570\u636e\u8bbf\u95ee",id:"\u884c\u6570\u636e\u8bbf\u95ee",level:2},{value:"Row \u7c7b",id:"row-\u7c7b",level:3},{value:"ArrayData \u7c7b",id:"arraydata-\u7c7b",level:3},{value:"MapData \u7c7b",id:"mapdata-\u7c7b",level:3},{value:"Schema \u548c\u7c7b\u578b",id:"schema-\u548c\u7c7b\u578b",level:2},{value:"Schema \u5b9a\u4e49",id:"schema-\u5b9a\u4e49",level:3},{value:"\u7c7b\u578b\u7cfb\u7edf",id:"\u7c7b\u578b\u7cfb\u7edf",level:3},{value:"\u7c7b\u578b\u63a8\u65ad",id:"\u7c7b\u578b\u63a8\u65ad",level:3},{value:"\u884c\u5199\u5165\u5668",id:"\u884c\u5199\u5165\u5668",level:2},{value:"RowWriter",id:"rowwriter",level:3},{value:"ArrayWriter",id:"arraywriter",level:3},{value:"\u7a7a\u503c",id:"\u7a7a\u503c",level:3},{value:"\u5185\u5b58\u5e03\u5c40",id:"\u5185\u5b58\u5e03\u5c40",level:2},{value:"\u884c\u5e03\u5c40",id:"\u884c\u5e03\u5c40",level:3},{value:"\u6570\u7ec4\u5e03\u5c40",id:"\u6570\u7ec4\u5e03\u5c40",level:3},{value:"Map \u5e03\u5c40",id:"map-\u5e03\u5c40",level:3},{value:"\u6027\u80fd\u63d0\u793a",id:"\u6027\u80fd\u63d0\u793a",level:2},{value:"1. \u590d\u7528\u7f16\u7801\u5668",id:"1-\u590d\u7528\u7f16\u7801\u5668",level:3},{value:"2. \u9884\u5206\u914d\u7f13\u51b2\u533a",id:"2-\u9884\u5206\u914d\u7f13\u51b2\u533a",level:3},{value:"3. \u6279\u91cf\u5904\u7406",id:"3-\u6279\u91cf\u5904\u7406",level:3},{value:"4. \u96f6\u62f7\u8d1d\u8bfb\u53d6",id:"4-\u96f6\u62f7\u8d1d\u8bfb\u53d6",level:3},{value:"\u652f\u6301\u7c7b\u578b\u6c47\u603b",id:"\u652f\u6301\u7c7b\u578b\u6c47\u603b",level:2},{value:"\u76f8\u5173\u4e3b\u9898",id:"\u76f8\u5173\u4e3b\u9898",level:2}];function a(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"\u672c\u9875\u4ecb\u7ecd\u7528\u4e8e\u9ad8\u6027\u80fd\u3001\u7f13\u5b58\u53cb\u597d\u7684\u6570\u636e\u8bbf\u95ee\u7684\u884c\u683c\u5f0f\u5e8f\u5217\u5316\u3002"}),"\n",(0,t.jsx)(n.h2,{id:"\u6982\u8ff0",children:"\u6982\u8ff0"}),"\n",(0,t.jsx)(n.p,{children:"Apache Fory\u2122 \u884c\u683c\u5f0f\u662f\u4e00\u79cd\u9488\u5bf9\u4ee5\u4e0b\u573a\u666f\u4f18\u5316\u7684\u4e8c\u8fdb\u5236\u683c\u5f0f\uff1a"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u968f\u673a\u8bbf\u95ee"}),"\uff1a\u65e0\u9700\u53cd\u5e8f\u5217\u5316\u6574\u4e2a\u5bf9\u8c61\u5373\u53ef\u8bfb\u53d6\u4efb\u610f\u5b57\u6bb5"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u96f6\u62f7\u8d1d"}),"\uff1a\u65e0\u6570\u636e\u590d\u5236\u7684\u76f4\u63a5\u5185\u5b58\u8bbf\u95ee"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u7f13\u5b58\u53cb\u597d"}),"\uff1a\u8fde\u7eed\u5185\u5b58\u5e03\u5c40\u63d0\u9ad8 CPU \u7f13\u5b58\u6548\u7387"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u5217\u5f0f\u8f6c\u6362"}),"\uff1a\u6613\u4e8e\u8f6c\u6362\u4e3a Apache Arrow \u683c\u5f0f"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u90e8\u5206\u5e8f\u5217\u5316"}),"\uff1a\u53ea\u5e8f\u5217\u5316\u9700\u8981\u7684\u5b57\u6bb5"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"\u4f55\u65f6\u4f7f\u7528\u884c\u683c\u5f0f",children:"\u4f55\u65f6\u4f7f\u7528\u884c\u683c\u5f0f"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\u4f7f\u7528\u573a\u666f"}),(0,t.jsx)(n.th,{children:"\u884c\u683c\u5f0f"}),(0,t.jsx)(n.th,{children:"\u5bf9\u8c61\u56fe"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u5206\u6790/OLAP"}),(0,t.jsx)(n.td,{children:"\u2705"}),(0,t.jsx)(n.td,{children:"\u274c"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u968f\u673a\u5b57\u6bb5\u8bbf\u95ee"}),(0,t.jsx)(n.td,{children:"\u2705"}),(0,t.jsx)(n.td,{children:"\u274c"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u5b8c\u6574\u5bf9\u8c61\u5e8f\u5217\u5316"}),(0,t.jsx)(n.td,{children:"\u274c"}),(0,t.jsx)(n.td,{children:"\u2705"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u590d\u6742\u5bf9\u8c61\u56fe"}),(0,t.jsx)(n.td,{children:"\u274c"}),(0,t.jsx)(n.td,{children:"\u2705"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u5f15\u7528\u8ddf\u8e2a"}),(0,t.jsx)(n.td,{children:"\u274c"}),(0,t.jsx)(n.td,{children:"\u2705"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u8de8\u8bed\u8a00\uff08\u7b80\u5355\u7c7b\u578b\uff09"}),(0,t.jsx)(n.td,{children:"\u2705"}),(0,t.jsx)(n.td,{children:"\u2705"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"\u5feb\u901f\u5f00\u59cb",children:"\u5feb\u901f\u5f00\u59cb"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:'#include "fory/encoder/row_encoder.h"\n#include "fory/row/writer.h"\n\nusing namespace fory::row;\nusing namespace fory::row::encoder;\n\n// \u5b9a\u4e49\u7ed3\u6784\u4f53\nstruct Person {\n  int32_t id;\n  std::string name;\n  float score;\n};\n\n// \u6ce8\u518c\u5b57\u6bb5\u5143\u6570\u636e\uff08\u884c\u7f16\u7801\u5fc5\u9700\uff09\nFORY_FIELD_INFO(Person, id, name, score);\n\nint main() {\n  // \u521b\u5efa\u7f16\u7801\u5668\n  RowEncoder<Person> encoder;\n\n  // \u7f16\u7801\u4e00\u4e2a person\n  Person person{1, "Alice", 95.5f};\n  encoder.Encode(person);\n\n  // \u83b7\u53d6\u7f16\u7801\u540e\u7684\u884c\n  auto row = encoder.GetWriter().ToRow();\n\n  // \u968f\u673a\u8bbf\u95ee\u5b57\u6bb5\n  int32_t id = row->GetInt32(0);\n  std::string name = row->GetString(1);\n  float score = row->GetFloat(2);\n\n  assert(id == 1);\n  assert(name == "Alice");\n  assert(score == 95.5f);\n\n  return 0;\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\u884c\u7f16\u7801\u5668",children:"\u884c\u7f16\u7801\u5668"}),"\n",(0,t.jsx)(n.h3,{id:"\u57fa\u672c\u7528\u6cd5",children:"\u57fa\u672c\u7528\u6cd5"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"RowEncoder<T>"})," \u6a21\u677f\u7c7b\u63d0\u4f9b\u7c7b\u578b\u5b89\u5168\u7684\u7f16\u7801\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:'#include "fory/encoder/row_encoder.h"\n\n// \u4f7f\u7528 FORY_FIELD_INFO \u5b9a\u4e49\u7ed3\u6784\u4f53\nstruct Point {\n  double x;\n  double y;\n};\nFORY_FIELD_INFO(Point, x, y);\n\n// \u521b\u5efa\u7f16\u7801\u5668\nRowEncoder<Point> encoder;\n\n// \u8bbf\u95ee schema\uff08\u7528\u4e8e\u68c0\u67e5\uff09\nconst Schema& schema = encoder.GetSchema();\nstd::cout << "Fields: " << schema.field_names().size() << std::endl;\n\n// \u7f16\u7801\u503c\nPoint p{1.0, 2.0};\nencoder.Encode(p);\n\n// \u83b7\u53d6\u7ed3\u679c\u4f5c\u4e3a Row\nauto row = encoder.GetWriter().ToRow();\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u5d4c\u5957\u7ed3\u6784\u4f53",children:"\u5d4c\u5957\u7ed3\u6784\u4f53"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:'struct Address {\n  std::string city;\n  std::string country;\n};\nFORY_FIELD_INFO(Address, city, country);\n\nstruct Person {\n  std::string name;\n  Address address;\n};\nFORY_FIELD_INFO(Person, name, address);\n\n// \u7f16\u7801\u5d4c\u5957\u7ed3\u6784\u4f53\nRowEncoder<Person> encoder;\nPerson person{"Alice", {"New York", "USA"}};\nencoder.Encode(person);\n\nauto row = encoder.GetWriter().ToRow();\nstd::string name = row->GetString(0);\n\n// \u8bbf\u95ee\u5d4c\u5957\u7ed3\u6784\u4f53\nauto address_row = row->GetStruct(1);\nstd::string city = address_row->GetString(0);\nstd::string country = address_row->GetString(1);\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u6570\u7ec4--\u5217\u8868",children:"\u6570\u7ec4 / \u5217\u8868"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:'struct Record {\n  std::vector<int32_t> values;\n  std::string label;\n};\nFORY_FIELD_INFO(Record, values, label);\n\nRowEncoder<Record> encoder;\nRecord record{{1, 2, 3, 4, 5}, "test"};\nencoder.Encode(record);\n\nauto row = encoder.GetWriter().ToRow();\nauto array = row->GetArray(0);\n\nint count = array->num_elements();\nfor (int i = 0; i < count; i++) {\n  int32_t value = array->GetInt32(i);\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u76f4\u63a5\u7f16\u7801\u6570\u7ec4",children:"\u76f4\u63a5\u7f16\u7801\u6570\u7ec4"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:'// \u76f4\u63a5\u7f16\u7801 vector\uff08\u4e0d\u5728\u7ed3\u6784\u4f53\u5185\uff09\nstd::vector<Person> people{\n    {"Alice", {"NYC", "USA"}},\n    {"Bob", {"London", "UK"}}\n};\n\nRowEncoder<decltype(people)> encoder;\nencoder.Encode(people);\n\n// \u83b7\u53d6\u6570\u7ec4\u6570\u636e\nauto array = encoder.GetWriter().CopyToArrayData();\nauto first_person = array->GetStruct(0);\nstd::string first_name = first_person->GetString(0);\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\u884c\u6570\u636e\u8bbf\u95ee",children:"\u884c\u6570\u636e\u8bbf\u95ee"}),"\n",(0,t.jsx)(n.h3,{id:"row-\u7c7b",children:"Row \u7c7b"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"Row"})," \u7c7b\u63d0\u4f9b\u5bf9\u7ed3\u6784\u4f53\u5b57\u6bb5\u7684\u968f\u673a\u8bbf\u95ee\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"class Row {\npublic:\n  // \u7a7a\u503c\u68c0\u67e5\n  bool IsNullAt(int i) const;\n\n  // \u57fa\u672c\u7c7b\u578b getter\n  bool GetBoolean(int i) const;\n  int8_t GetInt8(int i) const;\n  int16_t GetInt16(int i) const;\n  int32_t GetInt32(int i) const;\n  int64_t GetInt64(int i) const;\n  float GetFloat(int i) const;\n  double GetDouble(int i) const;\n\n  // \u5b57\u7b26\u4e32/\u4e8c\u8fdb\u5236 getter\n  std::string GetString(int i) const;\n  std::vector<uint8_t> GetBinary(int i) const;\n\n  // \u5d4c\u5957\u7c7b\u578b\n  std::shared_ptr<Row> GetStruct(int i) const;\n  std::shared_ptr<ArrayData> GetArray(int i) const;\n  std::shared_ptr<MapData> GetMap(int i) const;\n\n  // \u5143\u6570\u636e\n  int num_fields() const;\n  SchemaPtr schema() const;\n\n  // \u8c03\u8bd5\n  std::string ToString() const;\n};\n"})}),"\n",(0,t.jsx)(n.h3,{id:"arraydata-\u7c7b",children:"ArrayData \u7c7b"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"ArrayData"})," \u7c7b\u63d0\u4f9b\u5bf9\u5217\u8868/\u6570\u7ec4\u5143\u7d20\u7684\u8bbf\u95ee\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"class ArrayData {\npublic:\n  // \u7a7a\u503c\u68c0\u67e5\n  bool IsNullAt(int i) const;\n\n  // \u5143\u7d20\u6570\u91cf\n  int num_elements() const;\n\n  // \u57fa\u672c\u7c7b\u578b getter\uff08\u4e0e Row \u76f8\u540c\uff09\n  int32_t GetInt32(int i) const;\n  // ... \u5176\u4ed6\u57fa\u672c\u7c7b\u578b\n\n  // \u5b57\u7b26\u4e32 getter\n  std::string GetString(int i) const;\n\n  // \u5d4c\u5957\u7c7b\u578b\n  std::shared_ptr<Row> GetStruct(int i) const;\n  std::shared_ptr<ArrayData> GetArray(int i) const;\n  std::shared_ptr<MapData> GetMap(int i) const;\n\n  // \u7c7b\u578b\u4fe1\u606f\n  ListTypePtr type() const;\n};\n"})}),"\n",(0,t.jsx)(n.h3,{id:"mapdata-\u7c7b",children:"MapData \u7c7b"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"MapData"})," \u7c7b\u63d0\u4f9b\u5bf9 map \u952e\u503c\u5bf9\u7684\u8bbf\u95ee\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"class MapData {\npublic:\n  // \u5143\u7d20\u6570\u91cf\n  int num_elements();\n\n  // \u4ee5\u6570\u7ec4\u5f62\u5f0f\u8bbf\u95ee\u952e\u548c\u503c\n  std::shared_ptr<ArrayData> keys_array();\n  std::shared_ptr<ArrayData> values_array();\n\n  // \u7c7b\u578b\u4fe1\u606f\n  MapTypePtr type();\n};\n"})}),"\n",(0,t.jsx)(n.h2,{id:"schema-\u548c\u7c7b\u578b",children:"Schema \u548c\u7c7b\u578b"}),"\n",(0,t.jsx)(n.h3,{id:"schema-\u5b9a\u4e49",children:"Schema \u5b9a\u4e49"}),"\n",(0,t.jsx)(n.p,{children:"Schema \u5b9a\u4e49\u884c\u6570\u636e\u7684\u7ed3\u6784\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:'#include "fory/row/schema.h"\n\nusing namespace fory::row;\n\n// \u4ee5\u7f16\u7a0b\u65b9\u5f0f\u521b\u5efa schema\nauto person_schema = schema({\n    field("id", int32()),\n    field("name", utf8()),\n    field("score", float32()),\n    field("active", boolean())\n});\n\n// \u8bbf\u95ee schema \u4fe1\u606f\nfor (const auto& f : person_schema->fields()) {\n  std::cout << f->name() << ": " << f->type()->name() << std::endl;\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u7c7b\u578b\u7cfb\u7edf",children:"\u7c7b\u578b\u7cfb\u7edf"}),"\n",(0,t.jsx)(n.p,{children:"\u884c\u683c\u5f0f\u53ef\u7528\u7684\u7c7b\u578b\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"// \u57fa\u672c\u7c7b\u578b\nDataTypePtr boolean();    // bool\nDataTypePtr int8();       // int8_t\nDataTypePtr int16();      // int16_t\nDataTypePtr int32();      // int32_t\nDataTypePtr int64();      // int64_t\nDataTypePtr float32();    // float\nDataTypePtr float64();    // double\n\n// \u5b57\u7b26\u4e32\u548c\u4e8c\u8fdb\u5236\nDataTypePtr utf8();       // std::string\nDataTypePtr binary();     // std::vector<uint8_t>\n\n// \u590d\u6742\u7c7b\u578b\nDataTypePtr list(DataTypePtr element_type);\nDataTypePtr map(DataTypePtr key_type, DataTypePtr value_type);\nDataTypePtr struct_(std::vector<FieldPtr> fields);\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u7c7b\u578b\u63a8\u65ad",children:"\u7c7b\u578b\u63a8\u65ad"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"RowEncodeTrait"})," \u6a21\u677f\u81ea\u52a8\u63a8\u65ad\u7c7b\u578b\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"// \u57fa\u672c\u7c7b\u578b\u7684\u7c7b\u578b\u63a8\u65ad\nRowEncodeTrait<int32_t>::Type();  // \u8fd4\u56de int32()\nRowEncodeTrait<float>::Type();    // \u8fd4\u56de float32()\nRowEncodeTrait<std::string>::Type();  // \u8fd4\u56de utf8()\n\n// \u96c6\u5408\u7684\u7c7b\u578b\u63a8\u65ad\nRowEncodeTrait<std::vector<int32_t>>::Type();  // \u8fd4\u56de list(int32())\n\n// map \u7684\u7c7b\u578b\u63a8\u65ad\nRowEncodeTrait<std::map<std::string, int32_t>>::Type();\n// \u8fd4\u56de map(utf8(), int32())\n\n// \u7ed3\u6784\u4f53\u7684\u7c7b\u578b\u63a8\u65ad\uff08\u9700\u8981 FORY_FIELD_INFO\uff09\nRowEncodeTrait<Person>::Type();  // \u8fd4\u56de struct_({...})\nRowEncodeTrait<Person>::Schema();  // \u8fd4\u56de schema({...})\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u884c\u5199\u5165\u5668",children:"\u884c\u5199\u5165\u5668"}),"\n",(0,t.jsx)(n.h3,{id:"rowwriter",children:"RowWriter"}),"\n",(0,t.jsx)(n.p,{children:"\u7528\u4e8e\u624b\u52a8\u6784\u9020\u884c\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:'#include "fory/row/writer.h"\n\n// \u521b\u5efa schema\nauto my_schema = schema({\n    field("x", int32()),\n    field("y", float64()),\n    field("name", utf8())\n});\n\n// \u521b\u5efa\u5199\u5165\u5668\nRowWriter writer(my_schema);\nwriter.Reset();\n\n// \u5199\u5165\u5b57\u6bb5\nwriter.Write(0, 42);          // x = 42\nwriter.Write(1, 3.14);        // y = 3.14\nwriter.WriteString(2, "test"); // name = "test"\n\n// \u83b7\u53d6\u7ed3\u679c\nauto row = writer.ToRow();\n'})}),"\n",(0,t.jsx)(n.h3,{id:"arraywriter",children:"ArrayWriter"}),"\n",(0,t.jsx)(n.p,{children:"\u7528\u4e8e\u624b\u52a8\u6784\u9020\u6570\u7ec4\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"// \u521b\u5efa\u6570\u7ec4\u7c7b\u578b\nauto array_type = list(int32());\n\n// \u521b\u5efa\u5199\u5165\u5668\nArrayWriter writer(array_type);\nwriter.Reset(5);  // 5 \u4e2a\u5143\u7d20\n\n// \u5199\u5165\u5143\u7d20\nfor (int i = 0; i < 5; i++) {\n  writer.Write(i, i * 10);\n}\n\n// \u83b7\u53d6\u7ed3\u679c\nauto array = writer.CopyToArrayData();\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u7a7a\u503c",children:"\u7a7a\u503c"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"// \u5728\u7279\u5b9a\u7d22\u5f15\u5904\u8bbe\u7f6e\u7a7a\u503c\nwriter.SetNullAt(2);  // \u5b57\u6bb5 2 \u4e3a\u7a7a\n\n// \u8bfb\u53d6\u65f6\u68c0\u67e5\u7a7a\u503c\nif (!row->IsNullAt(2)) {\n  std::string value = row->GetString(2);\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u5185\u5b58\u5e03\u5c40",children:"\u5185\u5b58\u5e03\u5c40"}),"\n",(0,t.jsx)(n.h3,{id:"\u884c\u5e03\u5c40",children:"\u884c\u5e03\u5c40"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"+------------------+--------------------+--------------------+\n|    \u7a7a\u503c\u4f4d\u56fe      |    \u56fa\u5b9a\u5927\u5c0f\u6570\u636e     |    \u53d8\u957f\u6570\u636e        |\n+------------------+--------------------+--------------------+\n|   ceil(n/8) B    |     8 * n \u5b57\u8282     |       \u53ef\u53d8         |\n+------------------+--------------------+--------------------+\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u7a7a\u503c\u4f4d\u56fe"}),"\uff1a\u6bcf\u5b57\u6bb5\u4e00\u4f4d\uff0c\u6307\u793a\u7a7a\u503c"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u56fa\u5b9a\u5927\u5c0f\u6570\u636e"}),"\uff1a\u6bcf\u5b57\u6bb5 8 \u5b57\u8282\uff08\u57fa\u672c\u7c7b\u578b\u76f4\u63a5\u5b58\u50a8\uff0c\u53d8\u957f\u7c7b\u578b\u5b58\u50a8\u504f\u79fb\u91cf+\u5927\u5c0f\uff09"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u53d8\u957f\u6570\u636e"}),"\uff1a\u5b57\u7b26\u4e32\u3001\u6570\u7ec4\u3001\u5d4c\u5957\u7ed3\u6784\u4f53"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"\u6570\u7ec4\u5e03\u5c40",children:"\u6570\u7ec4\u5e03\u5c40"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"+------------+------------------+--------------------+--------------------+\n| \u5143\u7d20\u6570\u91cf   |    \u7a7a\u503c\u4f4d\u56fe      |    \u56fa\u5b9a\u5927\u5c0f\u6570\u636e     |    \u53d8\u957f\u6570\u636e        |\n+------------+------------------+--------------------+--------------------+\n|   8 \u5b57\u8282   |  ceil(n/8) \u5b57\u8282  |   elem_size * n    |       \u53ef\u53d8         |\n+------------+------------------+--------------------+--------------------+\n"})}),"\n",(0,t.jsx)(n.h3,{id:"map-\u5e03\u5c40",children:"Map \u5e03\u5c40"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"+------------------+------------------+\n|    \u952e\u6570\u7ec4        |    \u503c\u6570\u7ec4        |\n+------------------+------------------+\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u6027\u80fd\u63d0\u793a",children:"\u6027\u80fd\u63d0\u793a"}),"\n",(0,t.jsx)(n.h3,{id:"1-\u590d\u7528\u7f16\u7801\u5668",children:"1. \u590d\u7528\u7f16\u7801\u5668"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"RowEncoder<Person> encoder;\n\n// \u7f16\u7801\u591a\u6761\u8bb0\u5f55\nfor (const auto& person : people) {\n  encoder.Encode(person);\n  auto row = encoder.GetWriter().ToRow();\n  // \u5904\u7406 row...\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-\u9884\u5206\u914d\u7f13\u51b2\u533a",children:"2. \u9884\u5206\u914d\u7f13\u51b2\u533a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"// \u83b7\u53d6\u7f13\u51b2\u533a\u5f15\u7528\u8fdb\u884c\u9884\u5206\u914d\nauto& buffer = encoder.GetWriter().buffer();\nbuffer->Reserve(expected_size);\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-\u6279\u91cf\u5904\u7406",children:"3. \u6279\u91cf\u5904\u7406"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"// \u6279\u91cf\u5904\u7406\u4ee5\u63d0\u9ad8\u7f13\u5b58\u5229\u7528\u7387\nstd::vector<Person> batch;\nbatch.reserve(BATCH_SIZE);\n\nwhile (hasMore()) {\n  batch.clear();\n  fillBatch(batch);\n\n  for (const auto& person : batch) {\n    encoder.Encode(person);\n    process(encoder.GetWriter().ToRow());\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"4-\u96f6\u62f7\u8d1d\u8bfb\u53d6",children:"4. \u96f6\u62f7\u8d1d\u8bfb\u53d6"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"// \u6307\u5411\u73b0\u6709\u7f13\u51b2\u533a\uff08\u96f6\u62f7\u8d1d\uff09\nRow row(schema);\nrow.PointTo(buffer, offset, size);\n\n// \u76f4\u63a5\u4ece\u7f13\u51b2\u533a\u8bbf\u95ee\u5b57\u6bb5\nint32_t id = row.GetInt32(0);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u652f\u6301\u7c7b\u578b\u6c47\u603b",children:"\u652f\u6301\u7c7b\u578b\u6c47\u603b"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"C++ \u7c7b\u578b"}),(0,t.jsx)(n.th,{children:"\u884c\u7c7b\u578b"}),(0,t.jsx)(n.th,{children:"\u56fa\u5b9a\u5927\u5c0f"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"bool"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"boolean()"})}),(0,t.jsx)(n.td,{children:"1 \u5b57\u8282"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"int8_t"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"int8()"})}),(0,t.jsx)(n.td,{children:"1 \u5b57\u8282"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"int16_t"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"int16()"})}),(0,t.jsx)(n.td,{children:"2 \u5b57\u8282"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"int32_t"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"int32()"})}),(0,t.jsx)(n.td,{children:"4 \u5b57\u8282"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"int64_t"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"int64()"})}),(0,t.jsx)(n.td,{children:"8 \u5b57\u8282"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"float"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"float32()"})}),(0,t.jsx)(n.td,{children:"4 \u5b57\u8282"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"double"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"float64()"})}),(0,t.jsx)(n.td,{children:"8 \u5b57\u8282"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"std::string"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"utf8()"})}),(0,t.jsx)(n.td,{children:"\u53ef\u53d8"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"std::vector<T>"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"list(T)"})}),(0,t.jsx)(n.td,{children:"\u53ef\u53d8"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"std::map<K,V>"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"map(K,V)"})}),(0,t.jsx)(n.td,{children:"\u53ef\u53d8"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"std::optional<T>"})}),(0,t.jsx)(n.td,{children:"\u5185\u90e8\u7c7b\u578b"}),(0,t.jsx)(n.td,{children:"\u53ef\u7a7a"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"\u7ed3\u6784\u4f53 (FORY_FIELD_INFO)"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"struct_({...})"})}),(0,t.jsx)(n.td,{children:"\u53ef\u53d8"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"\u76f8\u5173\u4e3b\u9898",children:"\u76f8\u5173\u4e3b\u9898"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/zh-CN/docs/guide/cpp/basic_serialization",children:"\u57fa\u7840\u5e8f\u5217\u5316"})," - \u5bf9\u8c61\u56fe\u5e8f\u5217\u5316"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/zh-CN/docs/guide/cpp/configuration",children:"\u914d\u7f6e"})," - \u6784\u5efa\u5668\u9009\u9879"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/zh-CN/docs/guide/cpp/supported_types",children:"\u652f\u6301\u7684\u7c7b\u578b"})," - \u6240\u6709\u652f\u6301\u7684\u7c7b\u578b"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},11151:(e,n,r)=>{r.d(n,{Z:()=>c,a:()=>d});var t=r(67294);const i={},s=t.createContext(i);function d(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);