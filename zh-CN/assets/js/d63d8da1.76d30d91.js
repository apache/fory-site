"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[42522],{85450:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>f,frontMatter:()=>s,metadata:()=>o,toc:()=>l});var r=i(85893),t=i(11151);const s={title:"Shared and Circular References",sidebar_position:6,id:"references",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},a=void 0,o={id:"guide/swift/references",title:"Shared and Circular References",description:"Swift reference tracking is controlled by ForyConfig.trackRef.",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/guide/swift/references.md",sourceDirName:"guide/swift",slug:"/guide/swift/references",permalink:"/zh-CN/docs/next/guide/swift/references",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/i18n/zh-CN/docusaurus-plugin-content-docs/current/guide/swift/references.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{title:"Shared and Circular References",sidebar_position:6,id:"references",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"Field Configuration",permalink:"/zh-CN/docs/next/guide/swift/field_configuration"},next:{title:"Polymorphism and Dynamic Types",permalink:"/zh-CN/docs/next/guide/swift/polymorphism"}},c={},l=[{value:"Enable Reference Tracking",id:"enable-reference-tracking",level:2},{value:"Shared Reference Example",id:"shared-reference-example",level:2},{value:"Circular Reference Example (Use <code>weak</code>)",id:"circular-reference-example-use-weak",level:2},{value:"Notes",id:"notes",level:2}];function d(e){const n={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["Swift reference tracking is controlled by ",(0,r.jsx)(n.code,{children:"ForyConfig.trackRef"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"enable-reference-tracking",children:"Enable Reference Tracking"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-swift",children:"let fory = Fory(xlang: true, trackRef: true, compatible: false)\n"})}),"\n",(0,r.jsx)(n.p,{children:"When enabled, reference-trackable types preserve identity and cycles."}),"\n",(0,r.jsx)(n.h2,{id:"shared-reference-example",children:"Shared Reference Example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-swift",children:'import Fory\n\n@ForyObject\nfinal class Animal {\n    var name: String = ""\n\n    required init() {}\n\n    init(name: String) {\n        self.name = name\n    }\n}\n\n@ForyObject\nfinal class AnimalPair {\n    var first: Animal? = nil\n    var second: Animal? = nil\n\n    required init() {}\n\n    init(first: Animal? = nil, second: Animal? = nil) {\n        self.first = first\n        self.second = second\n    }\n}\n\nlet fory = Fory(xlang: true, trackRef: true)\nfory.register(Animal.self, id: 200)\nfory.register(AnimalPair.self, id: 201)\n\nlet shared = Animal(name: "cat")\nlet input = AnimalPair(first: shared, second: shared)\n\nlet data = try fory.serialize(input)\nlet decoded: AnimalPair = try fory.deserialize(data)\n\nassert(decoded.first === decoded.second)\n'})}),"\n",(0,r.jsxs)(n.h2,{id:"circular-reference-example-use-weak",children:["Circular Reference Example (Use ",(0,r.jsx)(n.code,{children:"weak"}),")"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"trackRef"})," preserves the reference graph, but it does not change ARC ownership.\nUse ",(0,r.jsx)(n.code,{children:"weak"})," on at least one edge in a cycle to avoid leaks."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-swift",children:"import Fory\n\n@ForyObject\nfinal class Node {\n    var value: Int32 = 0\n    weak var next: Node? = nil\n\n    required init() {}\n\n    init(value: Int32, next: Node? = nil) {\n        self.value = value\n        self.next = next\n    }\n}\n\nlet fory = Fory(xlang: true, trackRef: true)\nfory.register(Node.self, id: 300)\n\nlet node = Node(value: 7)\nnode.next = node\n\nlet data = try fory.serialize(node)\nlet decoded: Node = try fory.deserialize(data)\n\nassert(decoded.next === decoded)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Value types (",(0,r.jsx)(n.code,{children:"struct"}),", primitive values) do not carry identity semantics"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"trackRef"})," controls serialization graph identity, not ARC memory ownership"]}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"trackRef=false"})," for purely value-based payloads to reduce overhead"]}),"\n"]})]})}function f(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},11151:(e,n,i)=>{i.d(n,{Z:()=>o,a:()=>a});var r=i(67294);const t={},s=r.createContext(t);function a(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);