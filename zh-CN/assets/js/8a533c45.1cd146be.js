"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[5747],{69103:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>s,default:()=>o,frontMatter:()=>r,metadata:()=>t,toc:()=>c});var l=i(85893),d=i(11151);const r={title:"Xlang \u5e8f\u5217\u5316\u683c\u5f0f",sidebar_position:4,id:"xlang_serialization_spec",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},s=void 0,t={id:"specification/xlang_serialization_spec",title:"Xlang \u5e8f\u5217\u5316\u683c\u5f0f",description:"\u8de8\u8bed\u8a00\u5e8f\u5217\u5316\u89c4\u8303",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/specification/xlang_serialization_spec.md",sourceDirName:"specification",slug:"/specification/xlang_serialization_spec",permalink:"/zh-CN/docs/next/specification/xlang_serialization_spec",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/i18n/zh-CN/docusaurus-plugin-content-docs/current/specification/xlang_serialization_spec.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"Xlang \u5e8f\u5217\u5316\u683c\u5f0f",sidebar_position:4,id:"xlang_serialization_spec",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"specificationSidebar",previous:{title:"Row \u683c\u5f0f",permalink:"/zh-CN/docs/next/specification/row_format_spec"},next:{title:"Xlang \u7c7b\u578b\u6620\u5c04",permalink:"/zh-CN/docs/next/specification/xlang_type_mapping"}},a={},c=[{value:"\u8de8\u8bed\u8a00\u5e8f\u5217\u5316\u89c4\u8303",id:"\u8de8\u8bed\u8a00\u5e8f\u5217\u5316\u89c4\u8303",level:2},{value:"\u7c7b\u578b\u7cfb\u7edf",id:"\u7c7b\u578b\u7cfb\u7edf",level:2},{value:"\u6570\u636e\u7c7b\u578b",id:"\u6570\u636e\u7c7b\u578b",level:3},{value:"Polymorphisms",id:"polymorphisms",level:3},{value:"Type disambiguation",id:"type-disambiguation",level:3},{value:"Type ID",id:"type-id",level:3},{value:"Internal Type ID Table",id:"internal-type-id-table",level:4},{value:"Type ID Encoding for User Types",id:"type-id-encoding-for-user-types",level:4},{value:"Type mapping",id:"type-mapping",level:3},{value:"\u89c4\u8303\u6982\u89c8",id:"\u89c4\u8303\u6982\u89c8",level:2},{value:"Fory \u5934\u90e8",id:"fory-\u5934\u90e8",level:2},{value:"Reference Meta",id:"reference-meta",level:2},{value:"Reference Flags",id:"reference-flags",level:3},{value:"Reference Tracking Algorithm",id:"reference-tracking-algorithm",level:3},{value:"Reference ID Assignment",id:"reference-id-assignment",level:3},{value:"When Reference Tracking is Disabled",id:"when-reference-tracking-is-disabled",level:3},{value:"Language-Specific Considerations",id:"language-specific-considerations",level:3},{value:"Type Meta",id:"type-meta",level:2},{value:"Type ID encoding",id:"type-id-encoding",level:3},{value:"Type meta payload",id:"type-meta-payload",level:3},{value:"Shared Type Meta (streaming)",id:"shared-type-meta-streaming",level:3},{value:"TypeDef (schema evolution metadata)",id:"typedef-schema-evolution-metadata",level:3},{value:"Global header",id:"global-header",level:4},{value:"TypeDef body",id:"typedef-body",level:4},{value:"Meta String",id:"meta-string",level:2},{value:"Encoding Type IDs",id:"encoding-type-ids",level:3},{value:"Character Mapping Tables",id:"character-mapping-tables",level:3},{value:"LOWER_SPECIAL (5 bits per character)",id:"lower_special-5-bits-per-character",level:4},{value:"LOWER_UPPER_DIGIT_SPECIAL (6 bits per character)",id:"lower_upper_digit_special-6-bits-per-character",level:4},{value:"Encoding Algorithms",id:"encoding-algorithms",level:3},{value:"LOWER_SPECIAL Encoding",id:"lower_special-encoding",level:4},{value:"FIRST_TO_LOWER_SPECIAL Encoding",id:"first_to_lower_special-encoding",level:4},{value:"ALL_TO_LOWER_SPECIAL Encoding",id:"all_to_lower_special-encoding",level:4},{value:"Encoding Selection Algorithm",id:"encoding-selection-algorithm",level:3},{value:"Meta String Header Format",id:"meta-string-header-format",level:3},{value:"Special Character Sets by Context",id:"special-character-sets-by-context",level:3},{value:"Deduplication",id:"deduplication",level:3},{value:"Value Format",id:"value-format",level:2},{value:"Basic types",id:"basic-types",level:3},{value:"bool",id:"bool",level:4},{value:"int8",id:"int8",level:4},{value:"int16",id:"int16",level:4},{value:"unsigned int32",id:"unsigned-int32",level:4},{value:"unsigned varint32",id:"unsigned-varint32",level:4},{value:"signed int32",id:"signed-int32",level:4},{value:"signed varint32",id:"signed-varint32",level:4},{value:"unsigned int64",id:"unsigned-int64",level:4},{value:"unsigned varint64",id:"unsigned-varint64",level:4},{value:"unsigned hybrid int64 (TAGGED_UINT64)",id:"unsigned-hybrid-int64-tagged_uint64",level:4},{value:"VarUint36Small",id:"varuint36small",level:4},{value:"signed int64",id:"signed-int64",level:4},{value:"signed varint64",id:"signed-varint64",level:4},{value:"signed hybrid int64 (TAGGED_INT64)",id:"signed-hybrid-int64-tagged_int64",level:4},{value:"float8",id:"float8",level:4},{value:"float16",id:"float16",level:4},{value:"bfloat16",id:"bfloat16",level:4},{value:"float32",id:"float32",level:4},{value:"float64",id:"float64",level:4},{value:"string",id:"string",level:3},{value:"String Header",id:"string-header",level:4},{value:"Encoding Algorithm",id:"encoding-algorithm",level:4},{value:"Encoding Selection by Language",id:"encoding-selection-by-language",level:4},{value:"Empty String",id:"empty-string",level:4},{value:"duration",id:"duration",level:3},{value:"collection/list",id:"collectionlist",level:3},{value:"Elements Header",id:"elements-header",level:4},{value:"Type Info After Header",id:"type-info-after-header",level:4},{value:"Element Serialization Based on Header",id:"element-serialization-based-on-header",level:4},{value:"elements data",id:"elements-data",level:4},{value:"array",id:"array",level:3},{value:"primitive array",id:"primitive-array",level:4},{value:"Multi-dimensional arrays",id:"multi-dimensional-arrays",level:4},{value:"object array",id:"object-array",level:4},{value:"map",id:"map",level:3},{value:"Map Chunk Format",id:"map-chunk-format",level:4},{value:"KV Header Bits",id:"kv-header-bits",level:4},{value:"Chunk Size",id:"chunk-size",level:4},{value:"Why Chunk-Based Format?",id:"why-chunk-based-format",level:4},{value:"Why serialize chunk by chunk?",id:"why-serialize-chunk-by-chunk",level:4},{value:"enum",id:"enum",level:3},{value:"timestamp",id:"timestamp",level:3},{value:"date",id:"date",level:3},{value:"decimal",id:"decimal",level:3},{value:"struct",id:"struct",level:3},{value:"Field order",id:"field-order",level:4},{value:"Step 1: Field identifier",id:"step-1-field-identifier",level:5},{value:"Step 2: Group assignment",id:"step-2-group-assignment",level:5},{value:"Step 3: Intra-group ordering",id:"step-3-intra-group-ordering",level:5},{value:"Notes",id:"notes",level:5},{value:"Schema consistent (meta share disabled)",id:"schema-consistent-meta-share-disabled",level:4},{value:"Compatible mode (meta share enabled)",id:"compatible-mode-meta-share-enabled",level:4},{value:"Union",id:"union",level:3},{value:"IDL syntax",id:"idl-syntax",level:4},{value:"Type IDs and type meta",id:"type-ids-and-type-meta",level:4},{value:"Union value payload",id:"union-value-payload",level:4},{value:"Wire layouts",id:"wire-layouts",level:4},{value:"Decoding rules",id:"decoding-rules",level:4},{value:"When to use each type ID",id:"when-to-use-each-type-id",level:4},{value:"Compatibility notes",id:"compatibility-notes",level:4},{value:"Type",id:"type",level:3},{value:"Common Pitfalls",id:"common-pitfalls",level:2},{value:"Language Implementation Guidelines",id:"language-implementation-guidelines",level:2}];function h(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.a)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"\u8de8\u8bed\u8a00\u5e8f\u5217\u5316\u89c4\u8303",children:"\u8de8\u8bed\u8a00\u5e8f\u5217\u5316\u89c4\u8303"}),"\n",(0,l.jsx)(n.p,{children:"\u672c\u6587\u5b9a\u4e49 Apache Fory xlang \u4e8c\u8fdb\u5236\u534f\u8bae\u7684\u901a\u7528\u7ebf\u683c\u5f0f\uff0c\u9002\u7528\u4e8e\u591a\u8bed\u8a00\u4e92\u64cd\u4f5c\u573a\u666f\u3002"}),"\n",(0,l.jsx)(n.p,{children:"\u76ee\u6807\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4e8c\u8fdb\u5236\u5e03\u5c40\u8de8\u8bed\u8a00\u7a33\u5b9a"}),"\n",(0,l.jsx)(n.li,{children:"\u652f\u6301\u5f15\u7528\u8ddf\u8e2a\u3001\u7c7b\u578b\u5143\u4fe1\u606f\u548c schema \u6f14\u8fdb"}),"\n",(0,l.jsx)(n.li,{children:"\u5728\u6d41\u5f0f\u5e8f\u5217\u5316\u4e2d\u652f\u6301\u589e\u91cf\u5199\u5165\u5171\u4eab\u5143\u4fe1\u606f"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u7c7b\u578b\u7cfb\u7edf",children:"\u7c7b\u578b\u7cfb\u7edf"}),"\n",(0,l.jsx)(n.h3,{id:"\u6570\u636e\u7c7b\u578b",children:"\u6570\u636e\u7c7b\u578b"}),"\n",(0,l.jsx)(n.p,{children:"xlang \u7c7b\u578b\u5206\u4e3a\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u57fa\u7840\u7c7b\u578b\uff1abool\u3001\u6574\u6570\u3001\u6d6e\u70b9\u3001string\u3001binary"}),"\n",(0,l.jsx)(n.li,{children:"\u5bb9\u5668\u7c7b\u578b\uff1alist\u3001set\u3001map\u3001array"}),"\n",(0,l.jsx)(n.li,{children:"\u7ed3\u6784\u7c7b\u578b\uff1aenum\u3001struct\u3001union\u3001ext"}),"\n",(0,l.jsx)(n.li,{children:"\u65f6\u95f4\u7c7b\u578b\uff1aduration\u3001timestamp\u3001date"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"polymorphisms",children:"Polymorphisms"}),"\n",(0,l.jsx)(n.p,{children:"\u534f\u8bae\u652f\u6301\u591a\u6001\u5bf9\u8c61\u3002\u89e3\u7801\u7aef\u53ef\u4f9d\u636e type meta \u5224\u65ad\u8fd0\u884c\u65f6\u771f\u5b9e\u7c7b\u578b\uff0c\u5e76\u9009\u62e9\u5bf9\u5e94 serializer\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"type-disambiguation",children:"Type disambiguation"}),"\n",(0,l.jsx)(n.p,{children:"\u5f53\u67d0\u8bed\u8a00\u7c7b\u578b\u53ef\u6620\u5c04\u5230\u591a\u4e2a Fory \u7c7b\u578b\uff08\u5982 fixed/varint/tagged \u6574\u6570\uff09\u65f6\uff0c\u5fc5\u987b\u901a\u8fc7\u5b57\u6bb5\u5143\u4fe1\u606f\u6216\u7c7b\u578b\u6ce8\u89e3\u6d88\u6b67\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"type-id",children:"Type ID"}),"\n",(0,l.jsxs)(n.p,{children:["\u7c7b\u578b\u7531 ",(0,l.jsx)(n.code,{children:"internal_type_id"})," \u4e0e\uff08\u53ef\u9009\uff09",(0,l.jsx)(n.code,{children:"user_type_id"})," \u5171\u540c\u8868\u8fbe\uff1a"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5185\u5efa\u7c7b\u578b\u901a\u5e38\u76f4\u63a5\u7531 internal ID \u552f\u4e00\u8868\u793a"}),"\n",(0,l.jsx)(n.li,{children:"\u7528\u6237\u7c7b\u578b\u901a\u8fc7 internal kind + user ID\uff08\u6216\u547d\u540d\u7c7b\u578b\uff09\u8868\u793a"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"internal-type-id-table",children:"Internal Type ID Table"}),"\n",(0,l.jsx)(n.p,{children:"\u6838\u5fc3 internal IDs\uff08\u793a\u4f8b\uff09\uff1a"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"ID"}),(0,l.jsx)(n.th,{children:"\u7c7b\u578b"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"1"}),(0,l.jsx)(n.td,{children:"bool"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"2-20"}),(0,l.jsx)(n.td,{children:"\u5404\u7c7b\u6570\u5b57\u7c7b\u578b"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"21"}),(0,l.jsx)(n.td,{children:"string"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"22"}),(0,l.jsx)(n.td,{children:"list"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"23"}),(0,l.jsx)(n.td,{children:"set"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"24"}),(0,l.jsx)(n.td,{children:"map"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"25"}),(0,l.jsx)(n.td,{children:"enum"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"27"}),(0,l.jsx)(n.td,{children:"struct"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"28"}),(0,l.jsx)(n.td,{children:"compatible_struct"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"31"}),(0,l.jsx)(n.td,{children:"ext"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"33"}),(0,l.jsx)(n.td,{children:"union"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"36"}),(0,l.jsx)(n.td,{children:"none"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"37"}),(0,l.jsx)(n.td,{children:"duration"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"38"}),(0,l.jsx)(n.td,{children:"timestamp"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"39"}),(0,l.jsx)(n.td,{children:"date"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"40+"}),(0,l.jsx)(n.td,{children:"decimal/binary/array \u7b49"})]})]})]}),"\n",(0,l.jsxs)(n.p,{children:["\u5b8c\u6574\u6620\u5c04\u89c1 ",(0,l.jsx)(n.a,{href:"/zh-CN/docs/next/specification/xlang_type_mapping",children:"Xlang \u7c7b\u578b\u6620\u5c04"}),"\u3002"]}),"\n",(0,l.jsx)(n.h4,{id:"type-id-encoding-for-user-types",children:"Type ID Encoding for User Types"}),"\n",(0,l.jsx)(n.p,{children:"\u7528\u6237\u7c7b\u578b\u91c7\u7528\u62c6\u5206\u7f16\u7801\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5148\u5199 internal type ID\uff088-bit kind\uff09"}),"\n",(0,l.jsxs)(n.li,{children:["\u518d\u5199 ",(0,l.jsx)(n.code,{children:"user_type_id"}),"\uff08varuint32\uff09"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u4e0d\u505a bit packing\uff0c\u4fbf\u4e8e\u5b9e\u73b0\u4e0e\u8c03\u8bd5\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"type-mapping",children:"Type mapping"}),"\n",(0,l.jsxs)(n.p,{children:["\u8de8\u8bed\u8a00\u7c7b\u578b\u6620\u5c04\u603b\u8868\u89c1 ",(0,l.jsx)(n.a,{href:"/zh-CN/docs/next/specification/xlang_type_mapping",children:"xlang_type_mapping.md"}),"\u3002"]}),"\n",(0,l.jsx)(n.h2,{id:"\u89c4\u8303\u6982\u89c8",children:"\u89c4\u8303\u6982\u89c8"}),"\n",(0,l.jsx)(n.p,{children:"\u9876\u5c42\u5e03\u5c40\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"| fory header | reference meta | type meta | value payload |\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u534f\u8bae\u9ed8\u8ba4 little-endian\u3002"}),"\n",(0,l.jsx)(n.h2,{id:"fory-\u5934\u90e8",children:"Fory \u5934\u90e8"}),"\n",(0,l.jsx)(n.p,{children:"\u5934\u90e8\u662f 1-byte bitmap\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"| reserved(5) | oob(1) | xlang(1) | null(1) |\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"null=1"})," \u65f6\u503c\u4e3a\u7a7a\uff0c\u4e0d\u518d\u5199\u503c\u6570\u636e"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"xlang=1"})," \u8868\u793a\u91c7\u7528 xlang \u683c\u5f0f"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"oob=1"})," \u8868\u793a\u5b58\u5728 out-of-band \u7f13\u51b2\u533a\u5f15\u7528"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"reference-meta",children:"Reference Meta"}),"\n",(0,l.jsx)(n.h3,{id:"reference-flags",children:"Reference Flags"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u6807\u8bb0"}),(0,l.jsx)(n.th,{children:"\u503c"}),(0,l.jsx)(n.th,{children:"\u542b\u4e49"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"NULL_FLAG"}),(0,l.jsx)(n.td,{children:"-3"}),(0,l.jsx)(n.td,{children:"null"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"REF_FLAG"}),(0,l.jsx)(n.td,{children:"-2"}),(0,l.jsx)(n.td,{children:"\u5df2\u51fa\u73b0\u5bf9\u8c61\uff0c\u540e\u63a5 ref id"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"NOT_NULL_VALUE_FLAG"}),(0,l.jsx)(n.td,{children:"-1"}),(0,l.jsx)(n.td,{children:"\u975e\u7a7a\u4f46\u4e0d\u8ddf\u8e2a\u5f15\u7528"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"REF_VALUE_FLAG"}),(0,l.jsx)(n.td,{children:"0"}),(0,l.jsx)(n.td,{children:"\u9996\u6b21\u51fa\u73b0\u7684\u53ef\u5f15\u7528\u5bf9\u8c61"})]})]})]}),"\n",(0,l.jsx)(n.h3,{id:"reference-tracking-algorithm",children:"Reference Tracking Algorithm"}),"\n",(0,l.jsx)(n.p,{children:"\u5199\u4fa7\uff1a"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"\u5148\u5224\u65ad null"}),"\n",(0,l.jsxs)(n.li,{children:["\u82e5\u53ef\u5f15\u7528\u4e14\u5df2\u51fa\u73b0\uff0c\u5199 ",(0,l.jsx)(n.code,{children:"REF_FLAG + ref_id"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u82e5\u53ef\u5f15\u7528\u4e14\u9996\u6b21\u51fa\u73b0\uff0c\u5199 ",(0,l.jsx)(n.code,{children:"REF_VALUE_FLAG"})," \u5e76\u767b\u8bb0"]}),"\n",(0,l.jsxs)(n.li,{children:["\u82e5\u4e0d\u53ef\u5f15\u7528\uff0c\u5199 ",(0,l.jsx)(n.code,{children:"NOT_NULL_VALUE_FLAG"})]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\u8bfb\u4fa7\uff1a"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"\u8bfb\u53d6\u6807\u8bb0"}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"REF_FLAG"})," \u65f6\u6309 ref_id \u56de\u8868"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"REF_VALUE_FLAG"})," \u65f6\u5148\u6784\u9020\u5bf9\u8c61\u518d\u767b\u8bb0"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"NOT_NULL_VALUE_FLAG"})," \u65f6\u76f4\u63a5\u8bfb\u503c"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"reference-id-assignment",children:"Reference ID Assignment"}),"\n",(0,l.jsx)(n.p,{children:"ref id \u6309\u5bf9\u8c61\u9996\u6b21\u51fa\u73b0\u987a\u5e8f\u9012\u589e\u5206\u914d\uff0c\u4ece 0 \u5f00\u59cb\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"when-reference-tracking-is-disabled",children:"When Reference Tracking is Disabled"}),"\n",(0,l.jsx)(n.p,{children:"\u7981\u7528\u5f15\u7528\u8ddf\u8e2a\u65f6\uff0c\u4ec5\u4f7f\u7528 null / not-null \u4e24\u7c7b\u6807\u8bb0\uff0c\u4e0d\u7ef4\u62a4 ref \u8868\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"language-specific-considerations",children:"Language-Specific Considerations"}),"\n",(0,l.jsx)(n.p,{children:"\u4e0d\u540c\u8bed\u8a00\u5e94\u4fdd\u8bc1\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5bf9\u8c61\u8eab\u4efd\u5224\u5b9a\u4e00\u81f4\uff08\u8eab\u4efd\u800c\u975e\u503c\u76f8\u7b49\uff09"}),"\n",(0,l.jsx)(n.li,{children:"\u5bb9\u5668\u5143\u7d20\u5f15\u7528\u8bed\u4e49\u4e00\u81f4"}),"\n",(0,l.jsx)(n.li,{children:"\u5faa\u73af\u5f15\u7528\u573a\u666f\u5148\u5360\u4f4d\u540e\u586b\u5145"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"type-meta",children:"Type Meta"}),"\n",(0,l.jsx)(n.h3,{id:"type-id-encoding",children:"Type ID encoding"}),"\n",(0,l.jsx)(n.p,{children:"type id \u4f7f\u7528 varuint \u7f16\u7801\u5199\u5165\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"type-meta-payload",children:"Type meta payload"}),"\n",(0,l.jsx)(n.p,{children:"\u5728\u4ee5\u4e0b\u60c5\u51b5\u5199\u989d\u5916 type meta\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u547d\u540d\u7c7b\u578b\uff08",(0,l.jsx)(n.code,{children:"NAMED_*"}),"\uff09"]}),"\n",(0,l.jsx)(n.li,{children:"compatible struct \u9700\u8981 TypeDef"}),"\n",(0,l.jsx)(n.li,{children:"\u8fd0\u884c\u65f6\u672a\u58f0\u660e\u7c7b\u578b\u9700\u8981\u52a8\u6001 type info"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"shared-type-meta-streaming",children:"Shared Type Meta (streaming)"}),"\n",(0,l.jsx)(n.p,{children:"\u5171\u4eab type meta \u91c7\u7528\u201c\u7d22\u5f15 + \u53ef\u9009\u5b9a\u4e49\u4f53\u201d\u6d41\u5f0f\u5199\u6cd5\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"index_marker = (index << 1) | is_ref\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"is_ref=1"}),"\uff1a\u5f15\u7528\u5df2\u6709 type"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"is_ref=0"}),"\uff1a\u65b0 type\uff0c\u540e\u63a5\u5b9a\u4e49\u4f53"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"typedef-schema-evolution-metadata",children:"TypeDef (schema evolution metadata)"}),"\n",(0,l.jsx)(n.p,{children:"TypeDef \u7528\u4e8e\u63cf\u8ff0 compatible \u6a21\u5f0f\u7684\u5b57\u6bb5\u5143\u4fe1\u606f\uff08\u5b57\u6bb5\u540d/tag\u3001nullable/ref\u3001\u5b57\u6bb5\u7c7b\u578b\uff09\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"global-header",children:"Global header"}),"\n",(0,l.jsx)(n.p,{children:"TypeDef \u5934\u90e8\u5305\u542b\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"payload size"}),"\n",(0,l.jsx)(n.li,{children:"flags\uff08\u5982 compress\u3001has_fields_meta\uff09"}),"\n",(0,l.jsx)(n.li,{children:"payload hash"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"typedef-body",children:"TypeDef body"}),"\n",(0,l.jsx)(n.p,{children:"\u4e3b\u4f53\u5305\u542b\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"class \u5c42\u6b21\u4fe1\u606f\uff08\u7236\u7c7b\u5230\u5b50\u7c7b\uff09"}),"\n",(0,l.jsx)(n.li,{children:"\u6bcf\u5c42\u5b57\u6bb5\u6570\u91cf\u4e0e\u7c7b\u578b\u6807\u8bc6"}),"\n",(0,l.jsx)(n.li,{children:"\u5b57\u6bb5\u7ea7\u5143\u4fe1\u606f\uff08\u540d\u79f0\u7f16\u7801/tag\u3001nullable/ref\u3001field type\uff09"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"meta-string",children:"Meta String"}),"\n",(0,l.jsx)(n.p,{children:"meta string \u7528\u4e8e namespace\u3001typename\u3001fieldname \u7684\u538b\u7f29\u8868\u793a\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"encoding-type-ids",children:"Encoding Type IDs"}),"\n",(0,l.jsx)(n.p,{children:"\u5e38\u89c1\u7f16\u7801\u65cf\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"UTF8"}),"\n",(0,l.jsx)(n.li,{children:"LOWER_SPECIAL"}),"\n",(0,l.jsx)(n.li,{children:"LOWER_UPPER_DIGIT_SPECIAL"}),"\n",(0,l.jsx)(n.li,{children:"FIRST_TO_LOWER_SPECIAL"}),"\n",(0,l.jsx)(n.li,{children:"ALL_TO_LOWER_SPECIAL"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"character-mapping-tables",children:"Character Mapping Tables"}),"\n",(0,l.jsx)(n.h4,{id:"lower_special-5-bits-per-character",children:"LOWER_SPECIAL (5 bits per character)"}),"\n",(0,l.jsx)(n.p,{children:"\u9002\u7528\u4e8e\u5c0f\u5199\u5b57\u6bcd + \u9ad8\u9891\u7279\u6b8a\u5b57\u7b26\u96c6\u5408\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"lower_upper_digit_special-6-bits-per-character",children:"LOWER_UPPER_DIGIT_SPECIAL (6 bits per character)"}),"\n",(0,l.jsx)(n.p,{children:"\u9002\u7528\u4e8e\u5927\u5c0f\u5199\u5b57\u6bcd\u3001\u6570\u5b57\u4e0e\u7279\u6b8a\u5b57\u7b26\u6df7\u5408\u573a\u666f\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"encoding-algorithms",children:"Encoding Algorithms"}),"\n",(0,l.jsx)(n.h4,{id:"lower_special-encoding",children:"LOWER_SPECIAL Encoding"}),"\n",(0,l.jsx)(n.p,{children:"\u6309 5-bit \u6620\u5c04\u9010\u5b57\u7b26\u7f16\u7801\uff0c\u65e0\u6cd5\u6620\u5c04\u7684\u5b57\u7b26\u9700\u56de\u9000\u81f3\u5176\u4ed6\u7f16\u7801\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"first_to_lower_special-encoding",children:"FIRST_TO_LOWER_SPECIAL Encoding"}),"\n",(0,l.jsx)(n.p,{children:"\u9996\u5b57\u7b26\u5355\u72ec\u5904\u7406\uff0c\u5176\u4f59\u5b57\u7b26\u6309 LOWER_SPECIAL \u7f16\u7801\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"all_to_lower_special-encoding",children:"ALL_TO_LOWER_SPECIAL Encoding"}),"\n",(0,l.jsx)(n.p,{children:"\u5148\u5f52\u4e00\u5316\uff0c\u518d\u6309 LOWER_SPECIAL \u7f16\u7801\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"encoding-selection-algorithm",children:"Encoding Selection Algorithm"}),"\n",(0,l.jsx)(n.p,{children:"\u7f16\u7801\u9009\u62e9\u7b56\u7565\uff1a"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"\u5c1d\u8bd5\u6700\u7d27\u51d1\u7f16\u7801"}),"\n",(0,l.jsx)(n.li,{children:"\u82e5\u5b57\u7b26\u96c6\u5408\u4e0d\u6ee1\u8db3\u5219\u964d\u7ea7"}),"\n",(0,l.jsx)(n.li,{children:"\u5fc5\u8981\u65f6\u56de\u9000 UTF8"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"meta-string-header-format",children:"Meta String Header Format"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"| size_bits | encoding_bits |\n"})}),"\n",(0,l.jsxs)(n.p,{children:["\u5f53 ",(0,l.jsx)(n.code,{children:"size"})," \u8d85\u8fc7\u77ed\u5934\u8303\u56f4\u65f6\u8ffd\u52a0 varuint \u6269\u5c55\u957f\u5ea6\u3002"]}),"\n",(0,l.jsx)(n.h3,{id:"special-character-sets-by-context",children:"Special Character Sets by Context"}),"\n",(0,l.jsx)(n.p,{children:"\u4e0d\u540c\u4e0a\u4e0b\u6587\uff08\u5305\u540d\u3001\u7c7b\u578b\u540d\u3001\u5b57\u6bb5\u540d\uff09\u5141\u8bb8\u5b57\u7b26\u96c6\u5408\u53ef\u4e0d\u540c\uff0c\u7f16\u7801\u5668\u9700\u6309\u4e0a\u4e0b\u6587\u9009\u62e9\u5408\u6cd5\u8868\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"deduplication",children:"Deduplication"}),"\n",(0,l.jsx)(n.p,{children:"meta string \u53ef\u6309\u4f1a\u8bdd\u53bb\u91cd\uff0c\u51cf\u5c11\u91cd\u590d\u5199\u5165\u3002"}),"\n",(0,l.jsx)(n.h2,{id:"value-format",children:"Value Format"}),"\n",(0,l.jsx)(n.h3,{id:"basic-types",children:"Basic types"}),"\n",(0,l.jsx)(n.h4,{id:"bool",children:"bool"}),"\n",(0,l.jsxs)(n.p,{children:["1 \u5b57\u8282\uff1a",(0,l.jsx)(n.code,{children:"0x00/0x01"}),"\u3002"]}),"\n",(0,l.jsx)(n.h4,{id:"int8",children:"int8"}),"\n",(0,l.jsx)(n.p,{children:"1 \u5b57\u8282\u6709\u7b26\u53f7\u6574\u578b\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"int16",children:"int16"}),"\n",(0,l.jsx)(n.p,{children:"2 \u5b57\u8282 little-endian\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"unsigned-int32",children:"unsigned int32"}),"\n",(0,l.jsx)(n.p,{children:"\u56fa\u5b9a 4 \u5b57\u8282\u65e0\u7b26\u53f7\u6574\u578b\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"unsigned-varint32",children:"unsigned varint32"}),"\n",(0,l.jsx)(n.p,{children:"varint32\uff08\u65e0\u7b26\u53f7\uff09\u7f16\u7801\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"signed-int32",children:"signed int32"}),"\n",(0,l.jsx)(n.p,{children:"\u56fa\u5b9a 4 \u5b57\u8282\u6709\u7b26\u53f7\u6574\u578b\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"signed-varint32",children:"signed varint32"}),"\n",(0,l.jsx)(n.p,{children:"ZigZag + varint32\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"unsigned-int64",children:"unsigned int64"}),"\n",(0,l.jsx)(n.p,{children:"\u56fa\u5b9a 8 \u5b57\u8282\u65e0\u7b26\u53f7\u6574\u578b\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"unsigned-varint64",children:"unsigned varint64"}),"\n",(0,l.jsx)(n.p,{children:"varint64\uff08\u65e0\u7b26\u53f7\uff09\u7f16\u7801\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"unsigned-hybrid-int64-tagged_uint64",children:"unsigned hybrid int64 (TAGGED_UINT64)"}),"\n",(0,l.jsx)(n.p,{children:"tagged \u7f16\u7801\uff0c\u517c\u987e\u5c0f\u503c\u7a7a\u95f4\u6548\u7387\u4e0e\u5927\u503c\u8868\u793a\u8303\u56f4\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"varuint36small",children:"VarUint36Small"}),"\n",(0,l.jsx)(n.p,{children:"\u7528\u4e8e\u5b57\u7b26\u4e32\u5934\u7b49\u573a\u666f\u7684\u7d27\u51d1\u957f\u5ea6\u7f16\u7801\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"signed-int64",children:"signed int64"}),"\n",(0,l.jsx)(n.p,{children:"\u56fa\u5b9a 8 \u5b57\u8282\u6709\u7b26\u53f7\u6574\u578b\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"signed-varint64",children:"signed varint64"}),"\n",(0,l.jsx)(n.p,{children:"ZigZag + varint64\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"signed-hybrid-int64-tagged_int64",children:"signed hybrid int64 (TAGGED_INT64)"}),"\n",(0,l.jsx)(n.p,{children:"tagged int64 \u7f16\u7801\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"float8",children:"float8"}),"\n",(0,l.jsx)(n.p,{children:"\u9884\u7559/\u5b9e\u9a8c\u7c7b\u578b\uff0c\u751f\u4ea7\u4e92\u64cd\u4f5c\u9700\u8c28\u614e\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"float16",children:"float16"}),"\n",(0,l.jsx)(n.p,{children:"16-bit \u6d6e\u70b9\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"bfloat16",children:"bfloat16"}),"\n",(0,l.jsx)(n.p,{children:"bfloat16 \u8868\u793a\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"float32",children:"float32"}),"\n",(0,l.jsx)(n.p,{children:"IEEE 754 float32 little-endian\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"float64",children:"float64"}),"\n",(0,l.jsx)(n.p,{children:"IEEE 754 float64 little-endian\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"string",children:"string"}),"\n",(0,l.jsx)(n.p,{children:"\u5b57\u7b26\u4e32\u7f16\u7801\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"| header(varuint36_small) | bytes |\n"})}),"\n",(0,l.jsx)(n.p,{children:"header \u4e2d\u5305\u542b byte length \u4e0e coder \u4fe1\u606f\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"string-header",children:"String Header"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"(byte_length << 2) | coder"}),"\uff0ccoder \u8868\u793a UTF8/LATIN1/UTF16 \u7b49\u3002"]}),"\n",(0,l.jsx)(n.h4,{id:"encoding-algorithm",children:"Encoding Algorithm"}),"\n",(0,l.jsx)(n.p,{children:"\u6309\u5019\u9009\u7f16\u7801\u5c1d\u8bd5\uff0c\u4f18\u5148\u9009\u62e9\u66f4\u7d27\u51d1\u4e14\u53ef\u65e0\u635f\u8868\u793a\u7684\u7f16\u7801\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"encoding-selection-by-language",children:"Encoding Selection by Language"}),"\n",(0,l.jsx)(n.p,{children:"\u5404\u8bed\u8a00\u5b9e\u73b0\u53ef\u6309\u672c\u5730\u5b57\u7b26\u4e32\u5185\u90e8\u8868\u793a\u4f18\u5316\uff0c\u4f46\u7ebf\u4e0a\u7f16\u7801\u7ed3\u679c\u5fc5\u987b\u4e0e\u89c4\u8303\u4e00\u81f4\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"empty-string",children:"Empty String"}),"\n",(0,l.jsx)(n.p,{children:"\u7a7a\u4e32\u957f\u5ea6\u4e3a 0\uff0c\u4ecd\u5e94\u5199\u5408\u6cd5 header\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"duration",children:"duration"}),"\n",(0,l.jsxs)(n.p,{children:["\u901a\u5e38\u5199 ",(0,l.jsx)(n.code,{children:"seconds + nanos"}),"\u3002"]}),"\n",(0,l.jsx)(n.h3,{id:"collectionlist",children:"collection/list"}),"\n",(0,l.jsx)(n.p,{children:"\u5217\u8868\u5e03\u5c40\uff1a"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"\u957f\u5ea6"}),"\n",(0,l.jsx)(n.li,{children:"elements header"}),"\n",(0,l.jsx)(n.li,{children:"\uff08\u53ef\u9009\uff09\u5143\u7d20\u7c7b\u578b\u4fe1\u606f"}),"\n",(0,l.jsx)(n.li,{children:"\u5143\u7d20\u6570\u636e"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"elements-header",children:"Elements Header"}),"\n",(0,l.jsx)(n.p,{children:"header \u4f4d\u7528\u4e8e\u8868\u8fbe\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u662f\u5426\u8ddf\u8e2a\u5143\u7d20\u5f15\u7528"}),"\n",(0,l.jsx)(n.li,{children:"\u662f\u5426\u542b null"}),"\n",(0,l.jsx)(n.li,{children:"\u662f\u5426\u540c\u6784"}),"\n",(0,l.jsx)(n.li,{children:"\u662f\u5426\u4f7f\u7528\u58f0\u660e\u7c7b\u578b"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"type-info-after-header",children:"Type Info After Header"}),"\n",(0,l.jsx)(n.p,{children:"\u5728\u540c\u6784\u4e14\u975e\u58f0\u660e\u7c7b\u578b\u573a\u666f\uff0c\u53ef\u5728 header \u540e\u4e00\u6b21\u6027\u5199 element type info\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"element-serialization-based-on-header",children:"Element Serialization Based on Header"}),"\n",(0,l.jsx)(n.p,{children:"\u6839\u636e header \u8d70\u4e0d\u540c\u5143\u7d20\u5e8f\u5217\u5316\u8def\u5f84\uff08\u540c\u6784\u5feb\u8def\u5f84 / \u5f02\u6784\u6162\u8def\u5f84\uff09\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"elements-data",children:"elements data"}),"\n",(0,l.jsx)(n.p,{children:"\u5143\u7d20\u6570\u636e\u6309\u987a\u5e8f\u7f16\u7801\uff1bnull \u4e0e ref \u6807\u8bb0\u6309\u914d\u7f6e\u63d2\u5165\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"array",children:"array"}),"\n",(0,l.jsx)(n.h4,{id:"primitive-array",children:"primitive array"}),"\n",(0,l.jsx)(n.p,{children:"\u57fa\u7840\u7c7b\u578b\u6570\u7ec4\u53ef\u76f4\u63a5\u6309\u5185\u5b58\u5757\u62f7\u8d1d\uff08\u6ce8\u610f endian \u4e0e\u5bf9\u9f50\uff09\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"multi-dimensional-arrays",children:"Multi-dimensional arrays"}),"\n",(0,l.jsx)(n.p,{children:"\u591a\u7ef4\u6570\u7ec4\u6309\u5d4c\u5957 array/list \u9012\u5f52\u8868\u8fbe\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"object-array",children:"object array"}),"\n",(0,l.jsx)(n.p,{children:"\u5bf9\u8c61\u6570\u7ec4\u5143\u7d20\u9010\u4e2a\u7f16\u7801\uff0c\u652f\u6301\u5f15\u7528\u4e0e\u591a\u6001\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"map",children:"map"}),"\n",(0,l.jsx)(n.p,{children:"map \u4f7f\u7528\u5206\u5757\u7f16\u7801\uff08chunk-based\uff09\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"map-chunk-format",children:"Map Chunk Format"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"| map_size | chunk_1 | chunk_2 | ... |\n"})}),"\n",(0,l.jsx)(n.h4,{id:"kv-header-bits",children:"KV Header Bits"}),"\n",(0,l.jsx)(n.p,{children:"header \u4f4d\u63cf\u8ff0 key/value \u7684\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u662f\u5426\u8ddf\u8e2a\u5f15\u7528"}),"\n",(0,l.jsx)(n.li,{children:"\u662f\u5426\u542b null"}),"\n",(0,l.jsx)(n.li,{children:"\u662f\u5426\u4f7f\u7528\u58f0\u660e\u7c7b\u578b"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"chunk-size",children:"Chunk Size"}),"\n",(0,l.jsx)(n.p,{children:"\u6bcf\u4e2a chunk \u5927\u5c0f\u4e0a\u9650\u901a\u5e38\u4e3a 255 entries\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"why-chunk-based-format",children:"Why Chunk-Based Format?"}),"\n",(0,l.jsx)(n.p,{children:"\u51cf\u5c11\u6bcf\u4e2a entry \u91cd\u590d\u5199 type info \u7684\u6210\u672c\uff0c\u63d0\u5347\u541e\u5410\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"why-serialize-chunk-by-chunk",children:"Why serialize chunk by chunk?"}),"\n",(0,l.jsx)(n.p,{children:"\u5728 key/value \u7c7b\u578b\u5c40\u90e8\u4e00\u81f4\u65f6\u53ef\u6279\u91cf\u8d70\u5feb\u8def\u5f84\uff0c\u5e76\u7b80\u5316\u89e3\u7801\u5206\u652f\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"enum",children:"enum"}),"\n",(0,l.jsx)(n.p,{children:"enum \u53ef\u6309 ordinal \u6216\u540d\u79f0\u7f16\u7801\uff08\u53d6\u51b3\u4e8e\u914d\u7f6e\u4e0e\u76ee\u6807\u517c\u5bb9\u8981\u6c42\uff09\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"timestamp",children:"timestamp"}),"\n",(0,l.jsxs)(n.p,{children:["\u901a\u5e38\u5199 ",(0,l.jsx)(n.code,{children:"seconds + nanos"})," \u6216\u7edf\u4e00 epoch \u7cbe\u5ea6\u8868\u793a\u3002"]}),"\n",(0,l.jsx)(n.h3,{id:"date",children:"date"}),"\n",(0,l.jsx)(n.p,{children:"\u901a\u5e38\u5199 epoch day\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"decimal",children:"decimal"}),"\n",(0,l.jsx)(n.p,{children:"decimal \u7531 scale + unscaled value \u8868\u793a\uff08\u5b9e\u73b0\u53ef\u7528\u5927\u6574\u6570\uff09\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"struct",children:"struct"}),"\n",(0,l.jsx)(n.p,{children:"struct \u7f16\u7801\uff1a\u5b57\u6bb5\u6309\u7a33\u5b9a\u987a\u5e8f\u5199\u5165\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"field-order",children:"Field order"}),"\n",(0,l.jsx)(n.p,{children:"\u63a8\u8350\u4f7f\u7528\u89c4\u8303\u5b9a\u4e49\u7684\u7a33\u5b9a\u5206\u7ec4\u6392\u5e8f\uff0c\u907f\u514d\u8bed\u8a00\u5b9e\u73b0\u5dee\u5f02\u5bfc\u81f4 hash \u4e0d\u4e00\u81f4\u3002"}),"\n",(0,l.jsx)(n.h5,{id:"step-1-field-identifier",children:"Step 1: Field identifier"}),"\n",(0,l.jsx)(n.p,{children:"\u5b57\u6bb5\u6807\u8bc6\u4f18\u5148\u4f7f\u7528 tag ID\uff1b\u5426\u5219\u4f7f\u7528\u6807\u51c6\u5316\u5b57\u6bb5\u540d\uff08\u5982 snake_case\uff09\u3002"}),"\n",(0,l.jsx)(n.h5,{id:"step-2-group-assignment",children:"Step 2: Group assignment"}),"\n",(0,l.jsx)(n.p,{children:"\u6309\u5b57\u6bb5\u7c7b\u522b\u5206\u7ec4\uff08primitive\u3001builtin\u3001collection/map\u3001other\uff09\u3002"}),"\n",(0,l.jsx)(n.h5,{id:"step-3-intra-group-ordering",children:"Step 3: Intra-group ordering"}),"\n",(0,l.jsx)(n.p,{children:"\u7ec4\u5185\u4f7f\u7528\u7a33\u5b9a\u6bd4\u8f83\u5668\uff08type + name/tag\uff09\u6392\u5e8f\u3002"}),"\n",(0,l.jsx)(n.h5,{id:"notes",children:"Notes"}),"\n",(0,l.jsx)(n.p,{children:"\u5b9e\u73b0\u5fc5\u987b\u4fdd\u8bc1\u6392\u5e8f\u786e\u5b9a\u6027\uff08deterministic\uff09\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"schema-consistent-meta-share-disabled",children:"Schema consistent (meta share disabled)"}),"\n",(0,l.jsx)(n.p,{children:"\u4e0d\u5171\u4eab meta \u65f6\uff0c\u53cc\u65b9 schema \u9700\u4e00\u81f4\uff1b\u901a\u5e38\u76f4\u63a5\u6309\u56fa\u5b9a\u987a\u5e8f\u5199\u5b57\u6bb5\u503c\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"compatible-mode-meta-share-enabled",children:"Compatible mode (meta share enabled)"}),"\n",(0,l.jsx)(n.p,{children:"\u5171\u4eab TypeDef \u540e\u53ef\u6309\u5b57\u6bb5\u540d/tag \u505a\u6620\u5c04\uff0c\u672a\u77e5\u5b57\u6bb5\u8df3\u8fc7\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"union",children:"Union"}),"\n",(0,l.jsx)(n.h4,{id:"idl-syntax",children:"IDL syntax"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-protobuf",children:"union Animal {\n  Dog dog = 1;\n  Cat cat = 2;\n}\n"})}),"\n",(0,l.jsx)(n.h4,{id:"type-ids-and-type-meta",children:"Type IDs and type meta"}),"\n",(0,l.jsx)(n.p,{children:"union \u672c\u4f53\u6709\u72ec\u7acb type id\uff0ccase \u4f7f\u7528 case id \u533a\u5206\u5206\u652f\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"union-value-payload",children:"Union value payload"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"| case_id | case_value |\n"})}),"\n",(0,l.jsx)(n.h4,{id:"wire-layouts",children:"Wire layouts"}),"\n",(0,l.jsx)(n.p,{children:"\u6839\u636e case \u7c7b\u578b\u662f\u5426\u9700\u8981\u5f15\u7528/\u7c7b\u578b\u5143\u4fe1\u606f\u51b3\u5b9a\u5177\u4f53\u5e03\u5c40\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"decoding-rules",children:"Decoding rules"}),"\n",(0,l.jsx)(n.p,{children:"\u5148\u8bfb case_id\uff0c\u518d\u6309 case \u7c7b\u578b\u89c4\u5219\u8bfb payload\uff1b\u672a\u77e5 case \u53ef\u6309\u517c\u5bb9\u7b56\u7565\u8df3\u8fc7\u6216\u62a5\u9519\u3002"}),"\n",(0,l.jsx)(n.h4,{id:"when-to-use-each-type-id",children:"When to use each type ID"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u7ed3\u6784\u7a33\u5b9a\u3001\u8de8\u8bed\u8a00\u5e38\u9a7b\u7c7b\u578b\uff1a\u5efa\u8bae\u56fa\u5b9a\u6570\u503c type id"}),"\n",(0,l.jsx)(n.li,{children:"\u52a8\u6001\u7c7b\u578b/\u672a\u6ce8\u518c\u7c7b\u578b\uff1a\u4f7f\u7528\u547d\u540d\u7c7b\u578b\u8def\u5f84"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"compatibility-notes",children:"Compatibility notes"}),"\n",(0,l.jsx)(n.p,{children:"\u65b0\u589e union case \u5e94\u4f7f\u7528\u65b0 case id\uff0c\u4e0d\u5e94\u590d\u7528\u65e7 id\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"type",children:"Type"}),"\n",(0,l.jsxs)(n.p,{children:["\u52a8\u6001 ",(0,l.jsx)(n.code,{children:"type"})," \u503c\u5e94\u643a\u5e26\u8db3\u591f type meta\uff0c\u786e\u4fdd\u63a5\u6536\u7aef\u53ef\u5224\u522b\u5e76\u89e3\u7801\u3002"]}),"\n",(0,l.jsx)(n.h2,{id:"common-pitfalls",children:"Common Pitfalls"}),"\n",(0,l.jsx)(n.p,{children:"\u5e38\u89c1\u95ee\u9898\uff1a"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"\u5b57\u6bb5\u6392\u5e8f\u4e0d\u7a33\u5b9a\u5bfc\u81f4 schema/hash \u4e0d\u4e00\u81f4"}),"\n",(0,l.jsx)(n.li,{children:"varint \u4e0e fixed/tagged \u914d\u7f6e\u4e0d\u4e00\u81f4"}),"\n",(0,l.jsx)(n.li,{children:"null \u4e0e\u7a7a\u503c\u8bed\u4e49\u6df7\u6dc6"}),"\n",(0,l.jsx)(n.li,{children:"\u5f15\u7528\u8ddf\u8e2a\u5f00\u5173\u4e24\u7aef\u4e0d\u4e00\u81f4"}),"\n",(0,l.jsx)(n.li,{children:"\u547d\u540d\u7c7b\u578b namespace/typename \u4e0d\u7a33\u5b9a"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"language-implementation-guidelines",children:"Language Implementation Guidelines"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u7edf\u4e00 little-endian"}),"\n",(0,l.jsx)(n.li,{children:"\u660e\u786e\u5bf9\u8c61\u8eab\u4efd\u8bed\u4e49\uff08\u7528\u4e8e ref tracking\uff09"}),"\n",(0,l.jsx)(n.li,{children:"\u5bf9\u6240\u6709 offset/size \u505a\u8fb9\u754c\u4e0e\u6ea2\u51fa\u68c0\u67e5"}),"\n",(0,l.jsx)(n.li,{children:"\u7ef4\u62a4\u8de8\u7248\u672c\u56de\u5f52\u7528\u4f8b\uff08\u542b\u6f14\u8fdb\u3001\u5faa\u73af\u5f15\u7528\u3001\u590d\u6742\u5bb9\u5668\uff09"}),"\n",(0,l.jsx)(n.li,{children:"\u4e0e Java/Python/C++/Rust/Go \u505a\u53cc\u5411\u4e92\u6d4b"}),"\n"]})]})}function o(e={}){const{wrapper:n}={...(0,d.a)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}},11151:(e,n,i)=>{i.d(n,{Z:()=>t,a:()=>s});var l=i(67294);const d={},r=l.createContext(d);function s(e){const n=l.useContext(r);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:s(e.components),l.createElement(r.Provider,{value:n},e.children)}}}]);