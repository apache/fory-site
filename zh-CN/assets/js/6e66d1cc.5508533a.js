"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[27773],{22663:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>t,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>l});var r=i(85893),o=i(11151);const s={title:"\u8fc1\u79fb\u6307\u5357",sidebar_position:10,id:"migration",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},t=void 0,a={id:"guide/java/migration",title:"\u8fc1\u79fb\u6307\u5357",description:"\u672c\u9875\u4ecb\u7ecd\u4ece JDK \u5e8f\u5217\u5316\u8fc1\u79fb\u4ee5\u53ca\u5728 Fory \u7248\u672c\u4e4b\u95f4\u5347\u7ea7\u7684\u7b56\u7565\u3002",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/version-0.14/guide/java/migration.md",sourceDirName:"guide/java",slug:"/guide/java/migration",permalink:"/zh-CN/docs/0.14/guide/java/migration",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/i18n/zh-CN/docusaurus-plugin-content-docs/version-0.14/guide/java/migration.md",tags:[],version:"0.14",sidebarPosition:10,frontMatter:{title:"\u8fc1\u79fb\u6307\u5357",sidebar_position:10,id:"migration",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"\u884c\u683c\u5f0f",permalink:"/zh-CN/docs/0.14/guide/java/row_format"},next:{title:"\u6545\u969c\u6392\u9664",permalink:"/zh-CN/docs/0.14/guide/java/troubleshooting"}},d={},l=[{value:"JDK \u5e8f\u5217\u5316\u8fc1\u79fb",id:"jdk-\u5e8f\u5217\u5316\u8fc1\u79fb",level:2},{value:"\u5347\u7ea7 Fory",id:"\u5347\u7ea7-fory",level:2},{value:"\u5c0f\u7248\u672c\u5347\u7ea7",id:"\u5c0f\u7248\u672c\u5347\u7ea7",level:3},{value:"\u5927\u7248\u672c\u5347\u7ea7",id:"\u5927\u7248\u672c\u5347\u7ea7",level:3},{value:"\u4e3a\u5e8f\u5217\u5316\u6570\u636e\u6dfb\u52a0\u7248\u672c",id:"\u4e3a\u5e8f\u5217\u5316\u6570\u636e\u6dfb\u52a0\u7248\u672c",level:3},{value:"\u5e26\u7248\u672c\u5934\u7684\u5e8f\u5217\u5316",id:"\u5e26\u7248\u672c\u5934\u7684\u5e8f\u5217\u5316",level:4},{value:"\u5e26\u7248\u672c\u5934\u7684\u53cd\u5e8f\u5217\u5316",id:"\u5e26\u7248\u672c\u5934\u7684\u53cd\u5e8f\u5217\u5316",level:4},{value:"Shading \u793a\u4f8b",id:"shading-\u793a\u4f8b",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"\u76f8\u5173\u4e3b\u9898",id:"\u76f8\u5173\u4e3b\u9898",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"\u672c\u9875\u4ecb\u7ecd\u4ece JDK \u5e8f\u5217\u5316\u8fc1\u79fb\u4ee5\u53ca\u5728 Fory \u7248\u672c\u4e4b\u95f4\u5347\u7ea7\u7684\u7b56\u7565\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"jdk-\u5e8f\u5217\u5316\u8fc1\u79fb",children:"JDK \u5e8f\u5217\u5316\u8fc1\u79fb"}),"\n",(0,r.jsxs)(n.p,{children:["\u5982\u679c\u4f60\u4e4b\u524d\u4f7f\u7528 JDK \u5e8f\u5217\u5316\uff0c\u5e76\u4e14\u65e0\u6cd5\u540c\u65f6\u5347\u7ea7\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\uff08\u8fd9\u5bf9\u4e8e\u5728\u7ebf\u5e94\u7528\u7a0b\u5e8f\u5f88\u5e38\u89c1\uff09\uff0cFory \u63d0\u4f9b\u4e86\u4e00\u4e2a\u5b9e\u7528\u65b9\u6cd5 ",(0,r.jsx)(n.code,{children:"org.apache.fory.serializer.JavaSerializer.serializedByJDK"})," \u6765\u68c0\u67e5\u4e8c\u8fdb\u5236\u662f\u5426\u7531 JDK \u5e8f\u5217\u5316\u751f\u6210\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u4f60\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u6a21\u5f0f\u4f7f\u73b0\u6709\u5e8f\u5217\u5316\u534f\u8bae\u611f\u77e5\uff0c\u7136\u540e\u4ee5\u5f02\u6b65\u6eda\u52a8\u65b9\u5f0f\u5347\u7ea7\u5e8f\u5217\u5316\u5230 Fory\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"if (JavaSerializer.serializedByJDK(bytes)) {\n  ObjectInputStream objectInputStream = xxx;\n  return objectInputStream.readObject();\n} else {\n  return fory.deserialize(bytes);\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u8fd9\u5141\u8bb8\u4f60\uff1a"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"\u90e8\u7f72\u53ef\u4ee5\u540c\u65f6\u8bfb\u53d6 JDK \u548c Fory \u5e8f\u5217\u5316\u6570\u636e\u7684\u65b0\u4ee3\u7801"}),"\n",(0,r.jsx)(n.li,{children:"\u9010\u6b65\u5c06\u5e8f\u5217\u5316\u8fc1\u79fb\u5230 Fory"}),"\n",(0,r.jsx)(n.li,{children:"\u6700\u7ec8\u79fb\u9664 JDK \u5e8f\u5217\u5316\u652f\u6301"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u5347\u7ea7-fory",children:"\u5347\u7ea7 Fory"}),"\n",(0,r.jsx)(n.h3,{id:"\u5c0f\u7248\u672c\u5347\u7ea7",children:"\u5c0f\u7248\u672c\u5347\u7ea7"}),"\n",(0,r.jsxs)(n.p,{children:["\u76ee\u524d\uff0c\u4ec5\u4e3a\u5c0f\u7248\u672c\u63d0\u4f9b\u4e8c\u8fdb\u5236\u517c\u5bb9\u6027\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4f60\u4f7f\u7528 Fory ",(0,r.jsx)(n.code,{children:"v0.2.0"}),"\uff0c\u5982\u679c\u5347\u7ea7\u5230 Fory ",(0,r.jsx)(n.code,{children:"v0.2.1"}),"\uff0c\u5c06\u63d0\u4f9b\u4e8c\u8fdb\u5236\u517c\u5bb9\u6027\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u4f60\u6309\u5c0f\u7248\u672c\u5347\u7ea7\uff0c\u6216\u8005\u4f60\u4e0d\u4f1a\u6709\u65e7\u7248 Fory \u5e8f\u5217\u5316\u7684\u6570\u636e\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u5347\u7ea7 Fory\uff0c\u65e0\u9700\u4efb\u4f55\u7279\u6b8a\u5904\u7406\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"\u5927\u7248\u672c\u5347\u7ea7",children:"\u5927\u7248\u672c\u5347\u7ea7"}),"\n",(0,r.jsxs)(n.p,{children:["\u5982\u679c\u4f60\u4ece ",(0,r.jsx)(n.code,{children:"v0.2.x"})," \u5347\u7ea7\u5230 Fory ",(0,r.jsx)(n.code,{children:"v0.4.1"}),"\uff0c\u5219\u4e0d\u4fdd\u8bc1\u4e8c\u8fdb\u5236\u517c\u5bb9\u6027\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u5927\u591a\u6570\u65f6\u5019\u4e0d\u9700\u8981\u5347\u7ea7 Fory \u5230\u66f4\u65b0\u7684\u5927\u7248\u672c\u2014\u2014\u5f53\u524d\u7248\u672c\u5df2\u7ecf\u8db3\u591f\u5feb\u901f\u548c\u7d27\u51d1\uff0c\u6211\u4eec\u4e3a\u6700\u8fd1\u7684\u65e7\u7248\u672c\u63d0\u4f9b\u4e00\u4e9b\u5c0f\u4fee\u590d\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"\u4e3a\u5e8f\u5217\u5316\u6570\u636e\u6dfb\u52a0\u7248\u672c",children:"\u4e3a\u5e8f\u5217\u5316\u6570\u636e\u6dfb\u52a0\u7248\u672c"}),"\n",(0,r.jsx)(n.p,{children:"\u5982\u679c\u4f60\u786e\u5b9e\u60f3\u5347\u7ea7 Fory \u4ee5\u83b7\u5f97\u66f4\u597d\u7684\u6027\u80fd\u548c\u66f4\u5c0f\u7684\u5927\u5c0f\uff0c\u4f60\u9700\u8981\u5c06 Fory \u7248\u672c\u4f5c\u4e3a\u5934\u90e8\u5199\u5165\u5e8f\u5217\u5316\u6570\u636e\uff0c\u4f7f\u7528\u5982\u4e0b\u4ee3\u7801\u6765\u4fdd\u6301\u4e8c\u8fdb\u5236\u517c\u5bb9\u6027\uff1a"}),"\n",(0,r.jsx)(n.h4,{id:"\u5e26\u7248\u672c\u5934\u7684\u5e8f\u5217\u5316",children:"\u5e26\u7248\u672c\u5934\u7684\u5e8f\u5217\u5316"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"MemoryBuffer buffer = xxx;\nbuffer.writeVarInt32(2);  // \u5199\u5165 Fory \u7248\u672c\nfory.serialize(buffer, obj);\n"})}),"\n",(0,r.jsx)(n.h4,{id:"\u5e26\u7248\u672c\u5934\u7684\u53cd\u5e8f\u5217\u5316",children:"\u5e26\u7248\u672c\u5934\u7684\u53cd\u5e8f\u5217\u5316"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"MemoryBuffer buffer = xxx;\nint foryVersion = buffer.readVarInt32();\nFory fory = getFory(foryVersion);\nfory.deserialize(buffer);\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"getFory"})," \u662f\u4e00\u4e2a\u52a0\u8f7d\u76f8\u5e94 Fory \u7248\u672c\u7684\u65b9\u6cd5\u3002\u4f60\u53ef\u4ee5\u5c06\u4e0d\u540c\u7248\u672c\u7684 Fory shade \u548c relocate \u5230\u4e0d\u540c\u7684\u5305\uff0c\u5e76\u6309\u7248\u672c\u52a0\u8f7d Fory\u3002"]}),"\n",(0,r.jsx)(n.h3,{id:"shading-\u793a\u4f8b",children:"Shading \u793a\u4f8b"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"\x3c!-- Maven Shade Plugin \u914d\u7f6e\u7528\u4e8e\u591a\u4e2a Fory \u7248\u672c --\x3e\n<plugin>\n  <groupId>org.apache.maven.plugins</groupId>\n  <artifactId>maven-shade-plugin</artifactId>\n  <executions>\n    <execution>\n      <id>shade-fory-v1</id>\n      <phase>package</phase>\n      <goals>\n        <goal>shade</goal>\n      </goals>\n      <configuration>\n        <relocations>\n          <relocation>\n            <pattern>org.apache.fory</pattern>\n            <shadedPattern>com.myapp.fory.v1</shadedPattern>\n          </relocation>\n        </relocations>\n      </configuration>\n    </execution>\n  </executions>\n</plugin>\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u5347\u7ea7\u524d\u5f7b\u5e95\u6d4b\u8bd5"}),"\uff1a\u786e\u4fdd\u4e0e\u73b0\u6709\u5e8f\u5217\u5316\u6570\u636e\u7684\u517c\u5bb9\u6027"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u5bf9\u957f\u671f\u5b58\u50a8\u4f7f\u7528\u7248\u672c\u5934"}),"\uff1a\u5982\u679c\u6570\u636e\u5728 Fory \u7248\u672c\u4e4b\u95f4\u6301\u4e45\u5316"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u4fdd\u6301\u5411\u540e\u517c\u5bb9\u6027"}),"\uff1a\u4fdd\u7559\u65e7\u7248\u672c Fory \u4ee5\u8bfb\u53d6\u9057\u7559\u6570\u636e"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u5347\u7ea7\u540e\u76d1\u63a7"}),"\uff1a\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u6ce8\u610f\u53cd\u5e8f\u5217\u5316\u9519\u8bef"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u76f8\u5173\u4e3b\u9898",children:"\u76f8\u5173\u4e3b\u9898"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/zh-CN/docs/0.14/guide/java/configuration",children:"\u914d\u7f6e\u9009\u9879"})," - ForyBuilder \u9009\u9879"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/zh-CN/docs/0.14/guide/java/schema_evolution",children:"Schema \u6f14\u5316"})," - \u5904\u7406\u7c7b\u53d8\u66f4"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/zh-CN/docs/0.14/guide/java/troubleshooting",children:"\u6545\u969c\u6392\u9664"})," - \u5e38\u89c1\u8fc1\u79fb\u95ee\u9898"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},11151:(e,n,i)=>{i.d(n,{Z:()=>a,a:()=>t});var r=i(67294);const o={},s=r.createContext(o);function t(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);