"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[32864],{72107:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>d});var i=r(85893),o=r(11151);const s={title:"Python \u539f\u751f\u6a21\u5f0f",sidebar_position:5,id:"native_mode",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},t=void 0,a={id:"guide/python/native_mode",title:"Python \u539f\u751f\u6a21\u5f0f",description:"pyfory \u63d0\u4f9b\u4e86 Python \u539f\u751f\u5e8f\u5217\u5316\u6a21\u5f0f\uff0c\u63d0\u4f9b\u4e0e pickle/cloudpickle \u76f8\u540c\u7684\u529f\u80fd\uff0c\u4f46\u5177\u6709\u663e\u8457\u66f4\u597d\u7684\u6027\u80fd\u3001\u66f4\u5c0f\u7684\u6570\u636e\u5927\u5c0f\u548c\u589e\u5f3a\u7684\u5b89\u5168\u7279\u6027\u3002",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/version-0.15/guide/python/python-native.md",sourceDirName:"guide/python",slug:"/guide/python/native_mode",permalink:"/zh-CN/docs/guide/python/native_mode",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/i18n/zh-CN/docusaurus-plugin-content-docs/version-0.15/guide/python/python-native.md",tags:[],version:"0.15",sidebarPosition:5,frontMatter:{title:"Python \u539f\u751f\u6a21\u5f0f",sidebar_position:5,id:"native_mode",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"\u5b57\u6bb5\u914d\u7f6e",permalink:"/zh-CN/docs/guide/python/field_configuration"},next:{title:"Schema \u6f14\u5316",permalink:"/zh-CN/docs/guide/python/schema_evolution"}},l={},d=[{value:"\u6982\u8ff0",id:"\u6982\u8ff0",level:2},{value:"\u53ef\u76f4\u63a5\u66ff\u4ee3 Pickle/Cloudpickle",id:"\u53ef\u76f4\u63a5\u66ff\u4ee3-picklecloudpickle",level:2},{value:"\u5e38\u89c1\u7528\u6cd5",id:"\u5e38\u89c1\u7528\u6cd5",level:3},{value:"\u5e8f\u5217\u5316\u5168\u5c40\u51fd\u6570",id:"\u5e8f\u5217\u5316\u5168\u5c40\u51fd\u6570",level:2},{value:"\u5e8f\u5217\u5316\u5c40\u90e8\u51fd\u6570/Lambda",id:"\u5e8f\u5217\u5316\u5c40\u90e8\u51fd\u6570lambda",level:2},{value:"\u5e8f\u5217\u5316\u5168\u5c40\u7c7b/\u65b9\u6cd5",id:"\u5e8f\u5217\u5316\u5168\u5c40\u7c7b\u65b9\u6cd5",level:2},{value:"\u5e8f\u5217\u5316\u5c40\u90e8\u7c7b/\u65b9\u6cd5",id:"\u5e8f\u5217\u5316\u5c40\u90e8\u7c7b\u65b9\u6cd5",level:2},{value:"\u6027\u80fd\u6bd4\u8f83",id:"\u6027\u80fd\u6bd4\u8f83",level:2},{value:"\u76f8\u5173\u4e3b\u9898",id:"\u76f8\u5173\u4e3b\u9898",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"pyfory"})," \u63d0\u4f9b\u4e86 Python \u539f\u751f\u5e8f\u5217\u5316\u6a21\u5f0f\uff0c\u63d0\u4f9b\u4e0e pickle/cloudpickle \u76f8\u540c\u7684\u529f\u80fd\uff0c\u4f46\u5177\u6709",(0,i.jsx)(n.strong,{children:"\u663e\u8457\u66f4\u597d\u7684\u6027\u80fd\u3001\u66f4\u5c0f\u7684\u6570\u636e\u5927\u5c0f\u548c\u589e\u5f3a\u7684\u5b89\u5168\u7279\u6027"}),"\u3002"]}),"\n",(0,i.jsx)(n.h2,{id:"\u6982\u8ff0",children:"\u6982\u8ff0"}),"\n",(0,i.jsxs)(n.p,{children:["\u4e8c\u8fdb\u5236\u534f\u8bae\u548c API \u4e0e Fory \u7684 xlang \u6a21\u5f0f\u7c7b\u4f3c\uff0c\u4f46 Python \u539f\u751f\u6a21\u5f0f\u53ef\u4ee5\u5e8f\u5217\u5316\u4efb\u4f55 Python \u5bf9\u8c61\u2014\u2014\u5305\u62ec\u5168\u5c40\u51fd\u6570\u3001\u5c40\u90e8\u51fd\u6570\u3001lambda\u3001\u5c40\u90e8\u7c7b\u4ee5\u53ca\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"__getstate__/__reduce__/__reduce_ex__"})," \u81ea\u5b9a\u4e49\u5e8f\u5217\u5316\u7684\u7c7b\u578b\uff0c\u8fd9\u4e9b\u5728 xlang \u6a21\u5f0f\u4e2d\u662f\u4e0d\u5141\u8bb8\u7684\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u8981\u4f7f\u7528 Python \u539f\u751f\u6a21\u5f0f\uff0c\u521b\u5efa ",(0,i.jsx)(n.code,{children:"Fory"})," \u65f6\u8bbe\u7f6e ",(0,i.jsx)(n.code,{children:"xlang=False"}),"\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import pyfory\nfory = pyfory.Fory(xlang=False, ref=False, strict=True)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u53ef\u76f4\u63a5\u66ff\u4ee3-picklecloudpickle",children:"\u53ef\u76f4\u63a5\u66ff\u4ee3 Pickle/Cloudpickle"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"pyfory"})," \u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u914d\u7f6e\u5e8f\u5217\u5316\u4efb\u4f55 Python \u5bf9\u8c61\uff1a"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u5bf9\u4e8e\u5faa\u73af\u5f15\u7528"}),"\uff1a\u8bbe\u7f6e ",(0,i.jsx)(n.code,{children:"ref=True"})," \u542f\u7528\u5f15\u7528\u8ddf\u8e2a"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u5bf9\u4e8e\u51fd\u6570/\u7c7b"}),"\uff1a\u8bbe\u7f6e ",(0,i.jsx)(n.code,{children:"strict=False"})," \u5141\u8bb8\u53cd\u5e8f\u5217\u5316\u52a8\u6001\u7c7b\u578b"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u26a0\ufe0f \u5b89\u5168\u8b66\u544a"}),"\uff1a\u5f53 ",(0,i.jsx)(n.code,{children:"strict=False"})," \u65f6\uff0cFory \u5c06\u53cd\u5e8f\u5217\u5316\u4efb\u610f\u7c7b\u578b\uff0c\u5982\u679c\u6570\u636e\u6765\u81ea\u4e0d\u53d7\u4fe1\u4efb\u7684\u6e90\uff0c\u8fd9\u53ef\u80fd\u5e26\u6765\u5b89\u5168\u98ce\u9669\u3002\u4ec5\u5728\u5b8c\u5168\u4fe1\u4efb\u6570\u636e\u6e90\u7684\u53d7\u63a7\u73af\u5883\u4e2d\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"strict=False"}),"\u3002"]}),"\n",(0,i.jsx)(n.h3,{id:"\u5e38\u89c1\u7528\u6cd5",children:"\u5e38\u89c1\u7528\u6cd5"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import pyfory\n\n# \u521b\u5efa Fory \u5b9e\u4f8b\nfory = pyfory.Fory(xlang=False, ref=True, strict=False)\n\n# \u5e8f\u5217\u5316\u5e38\u89c1 Python \u5bf9\u8c61\ndata = fory.dumps({"name": "Alice", "age": 30, "scores": [95, 87, 92]})\nprint(fory.loads(data))\n\n# \u5e8f\u5217\u5316\u81ea\u5b9a\u4e49\u5bf9\u8c61\nfrom dataclasses import dataclass\n\n@dataclass\nclass Person:\n    name: str\n    age: int\n\nperson = Person("Bob", 25)\ndata = fory.dumps(person)\nprint(fory.loads(data))  # Person(name=\'Bob\', age=25)\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u5e8f\u5217\u5316\u5168\u5c40\u51fd\u6570",children:"\u5e8f\u5217\u5316\u5168\u5c40\u51fd\u6570"}),"\n",(0,i.jsx)(n.p,{children:"\u6355\u83b7\u5e76\u5e8f\u5217\u5316\u5728\u6a21\u5757\u7ea7\u522b\u5b9a\u4e49\u7684\u51fd\u6570\u3002Fory \u53cd\u5e8f\u5217\u5316\u5e76\u8fd4\u56de\u76f8\u540c\u7684\u51fd\u6570\u5bf9\u8c61\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import pyfory\n\nfory = pyfory.Fory(xlang=False, ref=True, strict=False)\n\ndef my_global_function(x):\n    return 10 * x\n\ndata = fory.dumps(my_global_function)\nprint(fory.loads(data)(10))  # 100\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u5e8f\u5217\u5316\u5c40\u90e8\u51fd\u6570lambda",children:"\u5e8f\u5217\u5316\u5c40\u90e8\u51fd\u6570/Lambda"}),"\n",(0,i.jsx)(n.p,{children:"\u5e8f\u5217\u5316\u5e26\u95ed\u5305\u7684\u51fd\u6570\u548c lambda \u8868\u8fbe\u5f0f\u3002Fory \u81ea\u52a8\u6355\u83b7\u95ed\u5305\u53d8\u91cf\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import pyfory\n\nfory = pyfory.Fory(xlang=False, ref=True, strict=False)\n\n# \u5e26\u95ed\u5305\u7684\u5c40\u90e8\u51fd\u6570\ndef my_function():\n    local_var = 10\n    def local_func(x):\n        return x * local_var\n    return local_func\n\ndata = fory.dumps(my_function())\nprint(fory.loads(data)(10))  # 100\n\n# Lambda\ndata = fory.dumps(lambda x: 10 * x)\nprint(fory.loads(data)(10))  # 100\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u5e8f\u5217\u5316\u5168\u5c40\u7c7b\u65b9\u6cd5",children:"\u5e8f\u5217\u5316\u5168\u5c40\u7c7b/\u65b9\u6cd5"}),"\n",(0,i.jsx)(n.p,{children:"\u5e8f\u5217\u5316\u7c7b\u5bf9\u8c61\u3001\u5b9e\u4f8b\u65b9\u6cd5\u3001\u7c7b\u65b9\u6cd5\u548c\u9759\u6001\u65b9\u6cd5\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from dataclasses import dataclass\nimport pyfory\nfory = pyfory.Fory(xlang=False, ref=True, strict=False)\n\n@dataclass\nclass Person:\n    name: str\n    age: int\n\n    def f(self, x):\n        return self.age * x\n\n    @classmethod\n    def g(cls, x):\n        return 10 * x\n\n    @staticmethod\n    def h(x):\n        return 10 * x\n\n# \u5e8f\u5217\u5316\u5168\u5c40\u7c7b\nprint(fory.loads(fory.dumps(Person))("Bob", 25))  # Person(name=\'Bob\', age=25)\n\n# \u5e8f\u5217\u5316\u5b9e\u4f8b\u65b9\u6cd5\nprint(fory.loads(fory.dumps(Person("Bob", 20).f))(10))  # 200\n\n# \u5e8f\u5217\u5316\u7c7b\u65b9\u6cd5\nprint(fory.loads(fory.dumps(Person.g))(10))  # 100\n\n# \u5e8f\u5217\u5316\u9759\u6001\u65b9\u6cd5\nprint(fory.loads(fory.dumps(Person.h))(10))  # 100\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u5e8f\u5217\u5316\u5c40\u90e8\u7c7b\u65b9\u6cd5",children:"\u5e8f\u5217\u5316\u5c40\u90e8\u7c7b/\u65b9\u6cd5"}),"\n",(0,i.jsx)(n.p,{children:"\u5e8f\u5217\u5316\u5728\u51fd\u6570\u5185\u5b9a\u4e49\u7684\u7c7b\u53ca\u5176\u65b9\u6cd5\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from dataclasses import dataclass\nimport pyfory\nfory = pyfory.Fory(xlang=False, ref=True, strict=False)\n\ndef create_local_class():\n    class LocalClass:\n        def f(self, x):\n            return 10 * x\n\n        @classmethod\n        def g(cls, x):\n            return 10 * x\n\n        @staticmethod\n        def h(x):\n            return 10 * x\n    return LocalClass\n\n# \u5e8f\u5217\u5316\u5c40\u90e8\u7c7b\ndata = fory.dumps(create_local_class())\nprint(fory.loads(data)().f(10))  # 100\n\n# \u5e8f\u5217\u5316\u5c40\u90e8\u7c7b\u5b9e\u4f8b\u65b9\u6cd5\ndata = fory.dumps(create_local_class()().f)\nprint(fory.loads(data)(10))  # 100\n\n# \u5e8f\u5217\u5316\u5c40\u90e8\u7c7b\u65b9\u6cd5\ndata = fory.dumps(create_local_class().g)\nprint(fory.loads(data)(10))  # 100\n\n# \u5e8f\u5217\u5316\u5c40\u90e8\u7c7b\u9759\u6001\u65b9\u6cd5\ndata = fory.dumps(create_local_class().h)\nprint(fory.loads(data)(10))  # 100\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u6027\u80fd\u6bd4\u8f83",children:"\u6027\u80fd\u6bd4\u8f83"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'import pyfory\nimport pickle\nimport timeit\n\nfory = pyfory.Fory(xlang=False, ref=True, strict=False)\n\nobj = {f"key{i}": f"value{i}" for i in range(10000)}\nprint(f"Fory: {timeit.timeit(lambda: fory.dumps(obj), number=1000):.3f}s")\nprint(f"Pickle: {timeit.timeit(lambda: pickle.dumps(obj), number=1000):.3f}s")\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u76f8\u5173\u4e3b\u9898",children:"\u76f8\u5173\u4e3b\u9898"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/zh-CN/docs/guide/python/configuration",children:"\u914d\u7f6e"})," - Python \u6a21\u5f0f\u914d\u7f6e"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/zh-CN/docs/guide/python/out_of_band",children:"\u5e26\u5916\u5e8f\u5217\u5316"})," - \u96f6\u62f7\u8d1d\u7f13\u51b2\u533a"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/zh-CN/docs/guide/python/security",children:"\u5b89\u5168\u6027"})," - DeserializationPolicy"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},11151:(e,n,r)=>{r.d(n,{Z:()=>a,a:()=>t});var i=r(67294);const o={},s=i.createContext(o);function t(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);