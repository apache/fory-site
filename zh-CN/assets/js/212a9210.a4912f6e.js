"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[85924],{34999:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>s,metadata:()=>l,toc:()=>d});var t=r(85893),i=r(11151);const s={title:"\u57fa\u7840\u5e8f\u5217\u5316",sidebar_position:2,id:"basic_serialization",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},o=void 0,l={id:"guide/cpp/basic_serialization",title:"\u57fa\u7840\u5e8f\u5217\u5316",description:"\u672c\u9875\u4ecb\u7ecd\u57fa\u7840\u5bf9\u8c61\u56fe\u5e8f\u5217\u5316\u548c\u6838\u5fc3\u5e8f\u5217\u5316 API\u3002",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/guide/cpp/basic-serialization.md",sourceDirName:"guide/cpp",slug:"/guide/cpp/basic_serialization",permalink:"/zh-CN/docs/next/guide/cpp/basic_serialization",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/i18n/zh-CN/docusaurus-plugin-content-docs/current/guide/cpp/basic-serialization.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"\u57fa\u7840\u5e8f\u5217\u5316",sidebar_position:2,id:"basic_serialization",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"\u914d\u7f6e",permalink:"/zh-CN/docs/next/guide/cpp/configuration"},next:{title:"Schema \u6f14\u5316",permalink:"/zh-CN/docs/next/guide/cpp/schema_evolution"}},c={},d=[{value:"\u5bf9\u8c61\u56fe\u5e8f\u5217\u5316",id:"\u5bf9\u8c61\u56fe\u5e8f\u5217\u5316",level:2},{value:"\u5e8f\u5217\u5316 API",id:"\u5e8f\u5217\u5316-api",level:2},{value:"\u5e8f\u5217\u5316\u5230\u65b0 Vector",id:"\u5e8f\u5217\u5316\u5230\u65b0-vector",level:3},{value:"\u5e8f\u5217\u5316\u5230\u73b0\u6709\u7f13\u51b2\u533a",id:"\u5e8f\u5217\u5316\u5230\u73b0\u6709\u7f13\u51b2\u533a",level:3},{value:"\u4ece\u5b57\u8282\u6570\u7ec4\u53cd\u5e8f\u5217\u5316",id:"\u4ece\u5b57\u8282\u6570\u7ec4\u53cd\u5e8f\u5217\u5316",level:3},{value:"\u9519\u8bef\u5904\u7406",id:"\u9519\u8bef\u5904\u7406",level:2},{value:"FORY_STRUCT \u5b8f",id:"fory_struct-\u5b8f",level:2},{value:"\u5d4c\u5957\u7ed3\u6784\u4f53",id:"\u5d4c\u5957\u7ed3\u6784\u4f53",level:2},{value:"\u6027\u80fd\u63d0\u793a",id:"\u6027\u80fd\u63d0\u793a",level:2},{value:"\u76f8\u5173\u4e3b\u9898",id:"\u76f8\u5173\u4e3b\u9898",level:2}];function a(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"\u672c\u9875\u4ecb\u7ecd\u57fa\u7840\u5bf9\u8c61\u56fe\u5e8f\u5217\u5316\u548c\u6838\u5fc3\u5e8f\u5217\u5316 API\u3002"}),"\n",(0,t.jsx)(n.h2,{id:"\u5bf9\u8c61\u56fe\u5e8f\u5217\u5316",children:"\u5bf9\u8c61\u56fe\u5e8f\u5217\u5316"}),"\n",(0,t.jsxs)(n.p,{children:["Apache Fory\u2122 \u63d0\u4f9b\u590d\u6742\u5bf9\u8c61\u56fe\u7684\u81ea\u52a8\u5e8f\u5217\u5316\uff0c\u4fdd\u7559\u5bf9\u8c61\u4e4b\u95f4\u7684\u7ed3\u6784\u548c\u5173\u7cfb\u3002",(0,t.jsx)(n.code,{children:"FORY_STRUCT"})," \u5b8f\u5728\u7f16\u8bd1\u65f6\u751f\u6210\u9ad8\u6548\u7684\u5e8f\u5217\u5316\u4ee3\u7801\uff0c\u6d88\u9664\u8fd0\u884c\u65f6\u5f00\u9500\u3002"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\u6838\u5fc3\u529f\u80fd\uff1a"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u652f\u6301\u4efb\u610f\u6df1\u5ea6\u7684\u5d4c\u5957\u7ed3\u6784\u4f53\u5e8f\u5217\u5316"}),"\n",(0,t.jsx)(n.li,{children:"\u96c6\u5408\u7c7b\u578b\uff08vector\u3001set\u3001map\uff09"}),"\n",(0,t.jsxs)(n.li,{children:["\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"std::optional<T>"})," \u7684\u53ef\u9009\u5b57\u6bb5"]}),"\n",(0,t.jsxs)(n.li,{children:["\u667a\u80fd\u6307\u9488\uff08",(0,t.jsx)(n.code,{children:"std::shared_ptr"}),"\u3001",(0,t.jsx)(n.code,{children:"std::unique_ptr"}),"\uff09"]}),"\n",(0,t.jsx)(n.li,{children:"\u81ea\u52a8\u5904\u7406\u57fa\u672c\u7c7b\u578b\u548c\u5b57\u7b26\u4e32"}),"\n",(0,t.jsx)(n.li,{children:"\u4f7f\u7528\u53d8\u957f\u6574\u6570\u7684\u9ad8\u6548\u4e8c\u8fdb\u5236\u7f16\u7801"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:'#include "fory/serialization/fory.h"\n#include <vector>\n#include <map>\n\nusing namespace fory::serialization;\n\n// \u5b9a\u4e49\u7ed3\u6784\u4f53\nstruct Address {\n  std::string street;\n  std::string city;\n  std::string country;\n\n  bool operator==(const Address &other) const {\n    return street == other.street && city == other.city &&\n           country == other.country;\n  }\n};\nFORY_STRUCT(Address, street, city, country);\n\nstruct Person {\n  std::string name;\n  int32_t age;\n  Address address;\n  std::vector<std::string> hobbies;\n  std::map<std::string, std::string> metadata;\n\n  bool operator==(const Person &other) const {\n    return name == other.name && age == other.age &&\n           address == other.address && hobbies == other.hobbies &&\n           metadata == other.metadata;\n  }\n};\nFORY_STRUCT(Person, name, age, address, hobbies, metadata);\n\nint main() {\n  auto fory = Fory::builder().xlang(true).build();\n  fory.register_struct<Address>(100);\n  fory.register_struct<Person>(200);\n\n  Person person{\n      "John Doe",\n      30,\n      {"123 Main St", "New York", "USA"},\n      {"reading", "coding"},\n      {{"role", "developer"}}\n  };\n\n  auto result = fory.serialize(person);\n  auto decoded = fory.deserialize<Person>(result.value());\n  assert(person == decoded.value());\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\u5e8f\u5217\u5316-api",children:"\u5e8f\u5217\u5316 API"}),"\n",(0,t.jsx)(n.h3,{id:"\u5e8f\u5217\u5316\u5230\u65b0-vector",children:"\u5e8f\u5217\u5316\u5230\u65b0 Vector"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"auto fory = Fory::builder().xlang(true).build();\nfory.register_struct<MyStruct>(1);\n\nMyStruct obj{/* ... */};\n\n// \u5e8f\u5217\u5316 - \u8fd4\u56de Result<std::vector<uint8_t>, Error>\nauto result = fory.serialize(obj);\nif (result.ok()) {\n  std::vector<uint8_t> bytes = std::move(result).value();\n  // \u4f7f\u7528 bytes...\n} else {\n  // \u5904\u7406\u9519\u8bef\n  std::cerr << result.error().to_string() << std::endl;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u5e8f\u5217\u5316\u5230\u73b0\u6709\u7f13\u51b2\u533a",children:"\u5e8f\u5217\u5316\u5230\u73b0\u6709\u7f13\u51b2\u533a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"// \u5e8f\u5217\u5316\u5230\u73b0\u6709 Buffer\uff08\u6700\u5feb\u8def\u5f84\uff09\nBuffer buffer;\nauto result = fory.serialize_to(buffer, obj);\nif (result.ok()) {\n  size_t bytes_written = result.value();\n  // buffer \u73b0\u5728\u5305\u542b\u5e8f\u5217\u5316\u6570\u636e\n}\n\n// \u5e8f\u5217\u5316\u5230\u73b0\u6709 vector\uff08\u96f6\u62f7\u8d1d\uff09\nstd::vector<uint8_t> output;\nauto result = fory.serialize_to(output, obj);\nif (result.ok()) {\n  size_t bytes_written = result.value();\n  // output \u73b0\u5728\u5305\u542b\u5e8f\u5217\u5316\u6570\u636e\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u4ece\u5b57\u8282\u6570\u7ec4\u53cd\u5e8f\u5217\u5316",children:"\u4ece\u5b57\u8282\u6570\u7ec4\u53cd\u5e8f\u5217\u5316"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"// \u4ece\u539f\u59cb\u6307\u9488\u53cd\u5e8f\u5217\u5316\nauto result = fory.deserialize<MyStruct>(data_ptr, data_size);\nif (result.ok()) {\n  MyStruct obj = std::move(result).value();\n}\n\n// \u4ece vector \u53cd\u5e8f\u5217\u5316\nstd::vector<uint8_t> data = /* ... */;\nauto result = fory.deserialize<MyStruct>(data);\n\n// \u4ece Buffer \u53cd\u5e8f\u5217\u5316\uff08\u66f4\u65b0 reader_index\uff09\nBuffer buffer(data);\nauto result = fory.deserialize<MyStruct>(buffer);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u9519\u8bef\u5904\u7406",children:"\u9519\u8bef\u5904\u7406"}),"\n",(0,t.jsxs)(n.p,{children:["Fory \u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"Result<T, Error>"})," \u7c7b\u578b\u8fdb\u884c\u9519\u8bef\u5904\u7406\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:'auto result = fory.serialize(obj);\n\n// \u68c0\u67e5\u64cd\u4f5c\u662f\u5426\u6210\u529f\nif (result.ok()) {\n  auto value = std::move(result).value();\n  // \u4f7f\u7528 value...\n} else {\n  Error error = result.error();\n  std::cerr << "Error: " << error.to_string() << std::endl;\n}\n\n// \u6216\u4f7f\u7528 FORY_TRY \u5b8f\u8fdb\u884c\u63d0\u524d\u8fd4\u56de\nFORY_TRY(bytes, fory.serialize(obj));\n// \u76f4\u63a5\u4f7f\u7528 bytes...\n'})}),"\n",(0,t.jsx)(n.p,{children:"\u5e38\u89c1\u9519\u8bef\u7c7b\u578b\uff1a"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Error::type_mismatch"})," - \u53cd\u5e8f\u5217\u5316\u65f6\u7c7b\u578b ID \u4e0d\u5339\u914d"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Error::invalid_data"})," - \u65e0\u6548\u6216\u635f\u574f\u7684\u6570\u636e"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Error::buffer_out_of_bound"})," - \u7f13\u51b2\u533a\u6ea2\u51fa/\u4e0b\u6ea2"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Error::type_error"})," - \u7c7b\u578b\u6ce8\u518c\u9519\u8bef"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"fory_struct-\u5b8f",children:"FORY_STRUCT \u5b8f"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"FORY_STRUCT"})," \u5b8f\u7528\u4e8e\u6ce8\u518c\u7ed3\u6784\u4f53\u4ee5\u8fdb\u884c\u5e8f\u5217\u5316\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"struct MyStruct {\n  int32_t x;\n  std::string y;\n  std::vector<int32_t> z;\n};\n\n// \u5fc5\u987b\u4e0e\u7ed3\u6784\u4f53\u5728\u540c\u4e00\u547d\u540d\u7a7a\u95f4\u4e2d\nFORY_STRUCT(MyStruct, x, y, z);\n"})}),"\n",(0,t.jsx)(n.p,{children:"\u8be5\u5b8f\uff1a"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"\u751f\u6210\u7f16\u8bd1\u65f6\u5b57\u6bb5\u5143\u6570\u636e"}),"\n",(0,t.jsx)(n.li,{children:"\u542f\u7528 ADL\uff08\u53c2\u6570\u4f9d\u8d56\u67e5\u627e\uff09\u8fdb\u884c\u5e8f\u5217\u5316"}),"\n",(0,t.jsx)(n.li,{children:"\u901a\u8fc7\u6a21\u677f\u7279\u5316\u521b\u5efa\u9ad8\u6548\u7684\u5e8f\u5217\u5316\u4ee3\u7801"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\u8981\u6c42\uff1a"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5fc5\u987b\u653e\u5728\u4e0e\u7ed3\u6784\u4f53\u76f8\u540c\u7684\u547d\u540d\u7a7a\u95f4\u4e2d\uff08\u7528\u4e8e ADL\uff09"}),"\n",(0,t.jsx)(n.li,{children:"\u6240\u6709\u5217\u51fa\u7684\u5b57\u6bb5\u5fc5\u987b\u662f\u53ef\u5e8f\u5217\u5316\u7c7b\u578b"}),"\n",(0,t.jsx)(n.li,{children:"\u5b8f\u4e2d\u7684\u5b57\u6bb5\u987a\u5e8f\u51b3\u5b9a\u5e8f\u5217\u5316\u987a\u5e8f"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"\u5d4c\u5957\u7ed3\u6784\u4f53",children:"\u5d4c\u5957\u7ed3\u6784\u4f53"}),"\n",(0,t.jsx)(n.p,{children:"\u5b8c\u5168\u652f\u6301\u5d4c\u5957\u7ed3\u6784\u4f53\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"struct Inner {\n  int32_t value;\n};\nFORY_STRUCT(Inner, value);\n\nstruct Outer {\n  Inner inner;\n  std::string label;\n};\nFORY_STRUCT(Outer, inner, label);\n\n// \u4e24\u8005\u90fd\u5fc5\u987b\u6ce8\u518c\nfory.register_struct<Inner>(1);\nfory.register_struct<Outer>(2);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u6027\u80fd\u63d0\u793a",children:"\u6027\u80fd\u63d0\u793a"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u7f13\u51b2\u533a\u590d\u7528"}),"\uff1a\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"serialize_to(buffer, obj)"})," \u914d\u5408\u9884\u5206\u914d\u7684\u7f13\u51b2\u533a"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u9884\u6ce8\u518c"}),"\uff1a\u5728\u5e8f\u5217\u5316\u5f00\u59cb\u524d\u6ce8\u518c\u6240\u6709\u7c7b\u578b"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u5355\u7ebf\u7a0b"}),"\uff1a\u5c3d\u53ef\u80fd\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"build()"})," \u800c\u4e0d\u662f ",(0,t.jsx)(n.code,{children:"build_thread_safe()"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u7981\u7528\u8ddf\u8e2a"}),"\uff1a\u5f53\u4e0d\u9700\u8981\u5f15\u7528\u8ddf\u8e2a\u65f6\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"track_ref(false)"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u7d27\u51d1\u7f16\u7801"}),"\uff1a\u4f7f\u7528\u53d8\u957f\u7f16\u7801\u63d0\u9ad8\u7a7a\u95f4\u6548\u7387"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"\u76f8\u5173\u4e3b\u9898",children:"\u76f8\u5173\u4e3b\u9898"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/zh-CN/docs/next/guide/cpp/configuration",children:"\u914d\u7f6e"})," - \u6784\u5efa\u5668\u9009\u9879"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/zh-CN/docs/next/guide/cpp/type_registration",children:"\u7c7b\u578b\u6ce8\u518c"})," - \u6ce8\u518c\u7c7b\u578b"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/zh-CN/docs/next/guide/cpp/supported_types",children:"\u652f\u6301\u7684\u7c7b\u578b"})," - \u6240\u6709\u652f\u6301\u7684\u7c7b\u578b"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},11151:(e,n,r)=>{r.d(n,{Z:()=>l,a:()=>o});var t=r(67294);const i={},s=t.createContext(i);function o(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);