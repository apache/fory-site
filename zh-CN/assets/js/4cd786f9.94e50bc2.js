"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[32295],{78035:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>l,toc:()=>a});var r=s(85893),i=s(11151);const t={title:"Schema \u6f14\u5316",sidebar_position:3,id:"schema_evolution",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},d=void 0,l={id:"guide/cpp/schema_evolution",title:"Schema \u6f14\u5316",description:"Apache Fory\u2122 \u5728 Compatible \u6a21\u5f0f\u4e0b\u652f\u6301 schema \u6f14\u5316\uff0c\u5141\u8bb8\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u53cc\u65b9\u62e5\u6709\u4e0d\u540c\u7684\u7c7b\u578b\u5b9a\u4e49\u3002",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/version-0.15/guide/cpp/schema-evolution.md",sourceDirName:"guide/cpp",slug:"/guide/cpp/schema_evolution",permalink:"/zh-CN/docs/guide/cpp/schema_evolution",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/i18n/zh-CN/docusaurus-plugin-content-docs/version-0.15/guide/cpp/schema-evolution.md",tags:[],version:"0.15",sidebarPosition:3,frontMatter:{title:"Schema \u6f14\u5316",sidebar_position:3,id:"schema_evolution",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"\u57fa\u7840\u5e8f\u5217\u5316",permalink:"/zh-CN/docs/guide/cpp/basic_serialization"},next:{title:"\u7c7b\u578b\u6ce8\u518c",permalink:"/zh-CN/docs/guide/cpp/type_registration"}},c={},a=[{value:"Compatible \u6a21\u5f0f",id:"compatible-\u6a21\u5f0f",level:2},{value:"Schema \u6f14\u5316\u7279\u6027",id:"schema-\u6f14\u5316\u7279\u6027",level:2},{value:"\u6dfb\u52a0\u5b57\u6bb5\uff08\u5411\u540e\u517c\u5bb9\uff09",id:"\u6dfb\u52a0\u5b57\u6bb5\u5411\u540e\u517c\u5bb9",level:2},{value:"\u5220\u9664\u5b57\u6bb5\uff08\u5411\u524d\u517c\u5bb9\uff09",id:"\u5220\u9664\u5b57\u6bb5\u5411\u524d\u517c\u5bb9",level:2},{value:"\u5b57\u6bb5\u91cd\u6392",id:"\u5b57\u6bb5\u91cd\u6392",level:2},{value:"\u5d4c\u5957\u7ed3\u6784\u4f53\u6f14\u5316",id:"\u5d4c\u5957\u7ed3\u6784\u4f53\u6f14\u5316",level:2},{value:"\u53cc\u5411\u6f14\u5316",id:"\u53cc\u5411\u6f14\u5316",level:2},{value:"\u9ed8\u8ba4\u503c",id:"\u9ed8\u8ba4\u503c",level:2},{value:"SchemaConsistent \u6a21\u5f0f\uff08\u9ed8\u8ba4\uff09",id:"schemaconsistent-\u6a21\u5f0f\u9ed8\u8ba4",level:2},{value:"\u7c7b\u578b ID \u8981\u6c42",id:"\u7c7b\u578b-id-\u8981\u6c42",level:2},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. \u4e3a\u6f14\u5316\u505a\u89c4\u5212",id:"1-\u4e3a\u6f14\u5316\u505a\u89c4\u5212",level:3},{value:"2. \u4f7f\u7528\u6709\u610f\u4e49\u7684\u9ed8\u8ba4\u503c",id:"2-\u4f7f\u7528\u6709\u610f\u4e49\u7684\u9ed8\u8ba4\u503c",level:3},{value:"3. \u8bb0\u5f55 Schema \u7248\u672c",id:"3-\u8bb0\u5f55-schema-\u7248\u672c",level:3},{value:"4. \u6d4b\u8bd5\u6f14\u5316\u8def\u5f84",id:"4-\u6d4b\u8bd5\u6f14\u5316\u8def\u5f84",level:3},{value:"\u8de8\u8bed\u8a00 Schema \u6f14\u5316",id:"\u8de8\u8bed\u8a00-schema-\u6f14\u5316",level:2},{value:"\u76f8\u5173\u4e3b\u9898",id:"\u76f8\u5173\u4e3b\u9898",level:2}];function o(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["Apache Fory\u2122 \u5728 ",(0,r.jsx)(n.strong,{children:"Compatible \u6a21\u5f0f"}),"\u4e0b\u652f\u6301 schema \u6f14\u5316\uff0c\u5141\u8bb8\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u53cc\u65b9\u62e5\u6709\u4e0d\u540c\u7684\u7c7b\u578b\u5b9a\u4e49\u3002"]}),"\n",(0,r.jsx)(n.h2,{id:"compatible-\u6a21\u5f0f",children:"Compatible \u6a21\u5f0f"}),"\n",(0,r.jsxs)(n.p,{children:["\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"compatible(true)"})," \u542f\u7528 schema \u6f14\u5316\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:'#include "fory/serialization/fory.h"\n\nusing namespace fory::serialization;\n\n// \u7248\u672c 1\uff1a\u539f\u59cb schema\nstruct PersonV1 {\n  std::string name;\n  int32_t age;\n};\nFORY_STRUCT(PersonV1, name, age);\n\n// \u7248\u672c 2\uff1a\u6dfb\u52a0 email \u5b57\u6bb5\nstruct PersonV2 {\n  std::string name;\n  int32_t age;\n  std::string email;  // \u65b0\u5b57\u6bb5\n};\nFORY_STRUCT(PersonV2, name, age, email);\n\nint main() {\n  // \u4e3a\u6bcf\u4e2a schema \u7248\u672c\u521b\u5efa\u5355\u72ec\u7684 Fory \u5b9e\u4f8b\n  auto fory_v1 = Fory::builder()\n      .compatible(true)  // \u542f\u7528 schema \u6f14\u5316\n      .xlang(true)\n      .build();\n\n  auto fory_v2 = Fory::builder()\n      .compatible(true)\n      .xlang(true)\n      .build();\n\n  // \u4f7f\u7528\u76f8\u540c\u7684\u7c7b\u578b ID \u8fdb\u884c schema \u6f14\u5316\n  constexpr uint32_t PERSON_TYPE_ID = 100;\n  fory_v1.register_struct<PersonV1>(PERSON_TYPE_ID);\n  fory_v2.register_struct<PersonV2>(PERSON_TYPE_ID);\n\n  // \u4f7f\u7528 V1 \u5e8f\u5217\u5316\n  PersonV1 v1{"Alice", 30};\n  auto bytes = fory_v1.serialize(v1).value();\n\n  // \u53cd\u5e8f\u5217\u5316\u4e3a V2 - email \u83b7\u5f97\u9ed8\u8ba4\u503c\uff08\u7a7a\u5b57\u7b26\u4e32\uff09\n  auto v2 = fory_v2.deserialize<PersonV2>(bytes).value();\n  assert(v2.name == "Alice");\n  assert(v2.age == 30);\n  assert(v2.email == "");  // \u7f3a\u5931\u5b57\u6bb5\u7684\u9ed8\u8ba4\u503c\n\n  return 0;\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"schema-\u6f14\u5316\u7279\u6027",children:"Schema \u6f14\u5316\u7279\u6027"}),"\n",(0,r.jsx)(n.p,{children:"Compatible \u6a21\u5f0f\u652f\u6301\u4ee5\u4e0b schema \u53d8\u66f4\uff1a"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u53d8\u66f4\u7c7b\u578b"}),(0,r.jsx)(n.th,{children:"\u652f\u6301"}),(0,r.jsx)(n.th,{children:"\u884c\u4e3a"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u6dfb\u52a0\u65b0\u5b57\u6bb5"}),(0,r.jsx)(n.td,{children:"\u2705"}),(0,r.jsx)(n.td,{children:"\u7f3a\u5931\u5b57\u6bb5\u4f7f\u7528\u9ed8\u8ba4\u503c"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u5220\u9664\u5b57\u6bb5"}),(0,r.jsx)(n.td,{children:"\u2705"}),(0,r.jsx)(n.td,{children:"\u989d\u5916\u5b57\u6bb5\u88ab\u8df3\u8fc7"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u91cd\u6392\u5b57\u6bb5\u987a\u5e8f"}),(0,r.jsx)(n.td,{children:"\u2705"}),(0,r.jsx)(n.td,{children:"\u6309\u540d\u79f0\u5339\u914d\u5b57\u6bb5\uff0c\u800c\u975e\u4f4d\u7f6e"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u66f4\u6539\u53ef\u7a7a\u6027"}),(0,r.jsx)(n.td,{children:"\u2705"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"T"})," \u2194 ",(0,r.jsx)(n.code,{children:"std::optional<T>"})]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u66f4\u6539\u5b57\u6bb5\u7c7b\u578b"}),(0,r.jsx)(n.td,{children:"\u274c"}),(0,r.jsx)(n.td,{children:"\u7c7b\u578b\u5fc5\u987b\u517c\u5bb9"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u91cd\u547d\u540d\u5b57\u6bb5"}),(0,r.jsx)(n.td,{children:"\u274c"}),(0,r.jsx)(n.td,{children:"\u5b57\u6bb5\u540d\u5fc5\u987b\u5339\u914d\uff08\u533a\u5206\u5927\u5c0f\u5199\uff09"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"\u6dfb\u52a0\u5b57\u6bb5\u5411\u540e\u517c\u5bb9",children:"\u6dfb\u52a0\u5b57\u6bb5\uff08\u5411\u540e\u517c\u5bb9\uff09"}),"\n",(0,r.jsx)(n.p,{children:"\u5f53\u4f7f\u7528\u5177\u6709\u989d\u5916\u5b57\u6bb5\u7684\u65b0 schema \u53cd\u5e8f\u5217\u5316\u65e7\u6570\u636e\u65f6\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:'// \u65e7 schema (V1)\nstruct ProductV1 {\n  std::string name;\n  double price;\n};\nFORY_STRUCT(ProductV1, name, price);\n\n// \u65b0 schema (V2) \u5e26\u6709\u989d\u5916\u5b57\u6bb5\nstruct ProductV2 {\n  std::string name;\n  double price;\n  std::vector<std::string> tags;       // \u65b0\u5b57\u6bb5\n  std::map<std::string, std::string> attributes;  // \u65b0\u5b57\u6bb5\n};\nFORY_STRUCT(ProductV2, name, price, tags, attributes);\n\n// \u5e8f\u5217\u5316 V1\nProductV1 v1{"Laptop", 999.99};\nauto bytes = fory_v1.serialize(v1).value();\n\n// \u53cd\u5e8f\u5217\u5316\u4e3a V2\nauto v2 = fory_v2.deserialize<ProductV2>(bytes).value();\nassert(v2.name == "Laptop");\nassert(v2.price == 999.99);\nassert(v2.tags.empty());        // \u9ed8\u8ba4\uff1a\u7a7a vector\nassert(v2.attributes.empty());  // \u9ed8\u8ba4\uff1a\u7a7a map\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u5220\u9664\u5b57\u6bb5\u5411\u524d\u517c\u5bb9",children:"\u5220\u9664\u5b57\u6bb5\uff08\u5411\u524d\u517c\u5bb9\uff09"}),"\n",(0,r.jsx)(n.p,{children:"\u5f53\u4f7f\u7528\u5177\u6709\u8f83\u5c11\u5b57\u6bb5\u7684\u65e7 schema \u53cd\u5e8f\u5217\u5316\u65b0\u6570\u636e\u65f6\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:'// \u5b8c\u6574 schema\nstruct UserFull {\n  int64_t id;\n  std::string username;\n  std::string email;\n  std::string password_hash;\n  int32_t login_count;\n};\nFORY_STRUCT(UserFull, id, username, email, password_hash, login_count);\n\n// \u7cbe\u7b80 schema\uff08\u5220\u9664\u4e86 3 \u4e2a\u5b57\u6bb5\uff09\nstruct UserMinimal {\n  int64_t id;\n  std::string username;\n};\nFORY_STRUCT(UserMinimal, id, username);\n\n// \u5e8f\u5217\u5316\u5b8c\u6574\u7248\u672c\nUserFull full{12345, "johndoe", "john@example.com", "hash123", 42};\nauto bytes = fory_full.serialize(full).value();\n\n// \u53cd\u5e8f\u5217\u5316\u4e3a\u7cbe\u7b80\u7248\u672c - \u989d\u5916\u5b57\u6bb5\u88ab\u8df3\u8fc7\nauto minimal = fory_minimal.deserialize<UserMinimal>(bytes).value();\nassert(minimal.id == 12345);\nassert(minimal.username == "johndoe");\n// email\u3001password_hash\u3001login_count \u88ab\u8df3\u8fc7\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u5b57\u6bb5\u91cd\u6392",children:"\u5b57\u6bb5\u91cd\u6392"}),"\n",(0,r.jsx)(n.p,{children:"\u5728 compatible \u6a21\u5f0f\u4e0b\uff0c\u5b57\u6bb5\u6309\u540d\u79f0\u5339\u914d\uff0c\u800c\u975e\u4f4d\u7f6e\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:'// \u539f\u59cb\u5b57\u6bb5\u987a\u5e8f\nstruct ConfigOriginal {\n  std::string host;\n  int32_t port;\n  bool enable_ssl;\n  std::string protocol;\n};\nFORY_STRUCT(ConfigOriginal, host, port, enable_ssl, protocol);\n\n// \u91cd\u6392\u540e\u7684\u5b57\u6bb5\nstruct ConfigReordered {\n  bool enable_ssl;      // \u79fb\u5230\u7b2c\u4e00\u4f4d\n  std::string protocol; // \u79fb\u5230\u7b2c\u4e8c\u4f4d\n  std::string host;     // \u79fb\u5230\u7b2c\u4e09\u4f4d\n  int32_t port;         // \u79fb\u5230\u6700\u540e\n};\nFORY_STRUCT(ConfigReordered, enable_ssl, protocol, host, port);\n\n// \u4f7f\u7528\u539f\u59cb\u987a\u5e8f\u5e8f\u5217\u5316\nConfigOriginal orig{"localhost", 8080, true, "https"};\nauto bytes = fory_orig.serialize(orig).value();\n\n// \u4f7f\u7528\u4e0d\u540c\u5b57\u6bb5\u987a\u5e8f\u53cd\u5e8f\u5217\u5316 - \u6b63\u5e38\u5de5\u4f5c\nauto reordered = fory_reord.deserialize<ConfigReordered>(bytes).value();\nassert(reordered.host == "localhost");\nassert(reordered.port == 8080);\nassert(reordered.enable_ssl == true);\nassert(reordered.protocol == "https");\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u5d4c\u5957\u7ed3\u6784\u4f53\u6f14\u5316",children:"\u5d4c\u5957\u7ed3\u6784\u4f53\u6f14\u5316"}),"\n",(0,r.jsx)(n.p,{children:"Schema \u6f14\u5316\u9012\u5f52\u652f\u6301\u5d4c\u5957\u7ed3\u6784\u4f53\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:'// V1 Address\nstruct AddressV1 {\n  std::string street;\n  std::string city;\n};\nFORY_STRUCT(AddressV1, street, city);\n\n// V2 Address \u5e26\u6709\u65b0\u5b57\u6bb5\nstruct AddressV2 {\n  std::string street;\n  std::string city;\n  std::string country;  // \u65b0\u5b57\u6bb5\n  std::string zipcode;  // \u65b0\u5b57\u6bb5\n};\nFORY_STRUCT(AddressV2, street, city, country, zipcode);\n\n// V1 Employee \u4f7f\u7528 V1 Address\nstruct EmployeeV1 {\n  std::string name;\n  AddressV1 home_address;\n};\nFORY_STRUCT(EmployeeV1, name, home_address);\n\n// V2 Employee \u4f7f\u7528 V2 Address \u548c\u65b0\u5b57\u6bb5\nstruct EmployeeV2 {\n  std::string name;\n  AddressV2 home_address;  // \u5d4c\u5957\u7ed3\u6784\u4f53\u5df2\u6f14\u5316\n  std::string employee_id; // \u65b0\u5b57\u6bb5\n};\nFORY_STRUCT(EmployeeV2, name, home_address, employee_id);\n\n// \u4f7f\u7528\u76f8\u540c ID \u6ce8\u518c\u7c7b\u578b\nconstexpr uint32_t ADDRESS_TYPE_ID = 100;\nconstexpr uint32_t EMPLOYEE_TYPE_ID = 101;\n\nfory_v1.register_struct<AddressV1>(ADDRESS_TYPE_ID);\nfory_v1.register_struct<EmployeeV1>(EMPLOYEE_TYPE_ID);\nfory_v2.register_struct<AddressV2>(ADDRESS_TYPE_ID);\nfory_v2.register_struct<EmployeeV2>(EMPLOYEE_TYPE_ID);\n\n// \u5e8f\u5217\u5316 V1\nEmployeeV1 emp_v1{"Jane Doe", {"123 Main St", "NYC"}};\nauto bytes = fory_v1.serialize(emp_v1).value();\n\n// \u53cd\u5e8f\u5217\u5316\u4e3a V2\nauto emp_v2 = fory_v2.deserialize<EmployeeV2>(bytes).value();\nassert(emp_v2.name == "Jane Doe");\nassert(emp_v2.home_address.street == "123 Main St");\nassert(emp_v2.home_address.city == "NYC");\nassert(emp_v2.home_address.country == "");  // \u9ed8\u8ba4\u503c\nassert(emp_v2.home_address.zipcode == "");  // \u9ed8\u8ba4\u503c\nassert(emp_v2.employee_id == "");           // \u9ed8\u8ba4\u503c\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u53cc\u5411\u6f14\u5316",children:"\u53cc\u5411\u6f14\u5316"}),"\n",(0,r.jsx)(n.p,{children:"Schema \u6f14\u5316\u53cc\u5411\u5de5\u4f5c\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:'// V2 -> V1\uff08\u964d\u7ea7\uff09\nPersonV2 v2{"Charlie", 35, "charlie@example.com"};\nauto bytes = fory_v2.serialize(v2).value();\n\nauto v1 = fory_v1.deserialize<PersonV1>(bytes).value();\nassert(v1.name == "Charlie");\nassert(v1.age == 35);\n// email \u5b57\u6bb5\u5728\u53cd\u5e8f\u5217\u5316\u65f6\u88ab\u4e22\u5f03\n'})}),"\n",(0,r.jsx)(n.h2,{id:"\u9ed8\u8ba4\u503c",children:"\u9ed8\u8ba4\u503c"}),"\n",(0,r.jsx)(n.p,{children:"\u5f53\u5b57\u6bb5\u7f3a\u5931\u65f6\uff0c\u4f7f\u7528 C++ \u9ed8\u8ba4\u521d\u59cb\u5316\uff1a"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,r.jsx)(n.th,{children:"\u9ed8\u8ba4\u503c"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"int8_t"}),"\u3001",(0,r.jsx)(n.code,{children:"int16_t"}),"..."]}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"0"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"float"}),"\u3001",(0,r.jsx)(n.code,{children:"double"})]}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"0.0"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"bool"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"false"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"std::string"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:'""'})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"std::vector<T>"})}),(0,r.jsx)(n.td,{children:"\u7a7a vector"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"std::map<K,V>"})}),(0,r.jsx)(n.td,{children:"\u7a7a map"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"std::set<T>"})}),(0,r.jsx)(n.td,{children:"\u7a7a set"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"std::optional<T>"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"std::nullopt"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"\u7ed3\u6784\u4f53\u7c7b\u578b"}),(0,r.jsx)(n.td,{children:"\u9ed8\u8ba4\u6784\u9020"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"schemaconsistent-\u6a21\u5f0f\u9ed8\u8ba4",children:"SchemaConsistent \u6a21\u5f0f\uff08\u9ed8\u8ba4\uff09"}),"\n",(0,r.jsx)(n.p,{children:"\u4e0d\u4f7f\u7528 compatible \u6a21\u5f0f\u65f6\uff0cschema \u5fc5\u987b\u5b8c\u5168\u5339\u914d\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"// \u4e25\u683c\u6a21\u5f0f\uff08\u9ed8\u8ba4\uff09\nauto fory = Fory::builder()\n    .compatible(false)  // \u9ed8\u8ba4\uff1aschema \u5fc5\u987b\u5339\u914d\n    .xlang(true)\n    .build();\n\n// \u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316\u8981\u6c42\u76f8\u540c\u7684 schema\n// Schema \u4e0d\u5339\u914d\u53ef\u80fd\u5bfc\u81f4\u9519\u8bef\u6216\u672a\u5b9a\u4e49\u884c\u4e3a\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u4f55\u65f6\u4f7f\u7528 SchemaConsistent \u6a21\u5f0f\uff1a"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Schema \u4fdd\u8bc1\u5339\u914d\uff08\u76f8\u540c\u7684\u4e8c\u8fdb\u5236\u7248\u672c\uff09"}),"\n",(0,r.jsx)(n.li,{children:"\u9700\u8981\u6700\u9ad8\u6027\u80fd\uff08\u66f4\u5c11\u7684\u5143\u6570\u636e\u5f00\u9500\uff09"}),"\n",(0,r.jsx)(n.li,{children:"\u60a8\u540c\u65f6\u63a7\u5236\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"\u4f55\u65f6\u4f7f\u7528 Compatible \u6a21\u5f0f\uff1a"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Schema \u53ef\u80fd\u72ec\u7acb\u6f14\u5316"}),"\n",(0,r.jsx)(n.li,{children:"\u9700\u8981\u8de8\u7248\u672c\u517c\u5bb9\u6027"}),"\n",(0,r.jsx)(n.li,{children:"\u4e0d\u540c\u670d\u52a1\u53ef\u80fd\u6709\u4e0d\u540c\u7684 schema \u7248\u672c"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u7c7b\u578b-id-\u8981\u6c42",children:"\u7c7b\u578b ID \u8981\u6c42"}),"\n",(0,r.jsx)(n.p,{children:"\u8981\u4f7f schema \u6f14\u5316\u6b63\u5e38\u5de5\u4f5c\uff1a"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u76f8\u540c\u7c7b\u578b ID"}),"\uff1a\u540c\u4e00\u7ed3\u6784\u4f53\u7684\u4e0d\u540c\u7248\u672c\u5fc5\u987b\u4f7f\u7528\u76f8\u540c\u7684\u7c7b\u578b ID"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u4e00\u81f4\u7684 ID"}),"\uff1a\u7c7b\u578b ID \u5fc5\u987b\u5728\u6240\u6709 Fory \u5b9e\u4f8b\u4e2d\u4fdd\u6301\u4e00\u81f4"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u6ce8\u518c\u6240\u6709\u7248\u672c"}),"\uff1a\u6bcf\u4e2a Fory \u5b9e\u4f8b\u6ce8\u518c\u81ea\u5df1\u7684\u7ed3\u6784\u4f53\u7248\u672c"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"constexpr uint32_t PERSON_TYPE_ID = 100;\n\n// \u5b9e\u4f8b 1 \u4f7f\u7528 PersonV1\nfory_v1.register_struct<PersonV1>(PERSON_TYPE_ID);\n\n// \u5b9e\u4f8b 2 \u4f7f\u7528 PersonV2\nfory_v2.register_struct<PersonV2>(PERSON_TYPE_ID);\n\n// \u76f8\u540c\u7684\u7c7b\u578b ID \u542f\u7528 schema \u6f14\u5316\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,r.jsx)(n.h3,{id:"1-\u4e3a\u6f14\u5316\u505a\u89c4\u5212",children:"1. \u4e3a\u6f14\u5316\u505a\u89c4\u5212"}),"\n",(0,r.jsx)(n.p,{children:"\u8bbe\u8ba1 schema \u65f6\u8003\u8651\u672a\u6765\u7684\u53d8\u66f4\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"// \u597d\u7684\u505a\u6cd5\uff1a\u5bf9\u53ef\u80fd\u5220\u9664\u7684\u5b57\u6bb5\u4f7f\u7528 optional\nstruct Config {\n  std::string host;\n  int32_t port;\n  std::optional<std::string> deprecated_field;  // \u4ee5\u540e\u53ef\u4ee5\u5220\u9664\n};\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-\u4f7f\u7528\u6709\u610f\u4e49\u7684\u9ed8\u8ba4\u503c",children:"2. \u4f7f\u7528\u6709\u610f\u4e49\u7684\u9ed8\u8ba4\u503c"}),"\n",(0,r.jsx)(n.p,{children:"\u8003\u8651\u65b0\u5b57\u6bb5\u4f7f\u7528\u4ec0\u4e48\u9ed8\u8ba4\u503c\u624d\u6709\u610f\u4e49\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:'struct Settings {\n  int32_t timeout_ms;      // \u9ed8\u8ba4\uff1a0\uff08\u53ef\u80fd\u9700\u8981\u4e00\u4e2a\u5408\u7406\u7684\u9ed8\u8ba4\u503c\uff09\n  bool enabled;            // \u9ed8\u8ba4\uff1afalse\n  std::string mode;        // \u9ed8\u8ba4\uff1a""\uff08\u53ef\u80fd\u9700\u8981 "default"\uff09\n};\n'})}),"\n",(0,r.jsx)(n.h3,{id:"3-\u8bb0\u5f55-schema-\u7248\u672c",children:"3. \u8bb0\u5f55 Schema \u7248\u672c"}),"\n",(0,r.jsx)(n.p,{children:"\u8ddf\u8e2a schema \u53d8\u66f4\u4ee5\u4fbf\u8c03\u8bd5\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"// V1\uff1a\u521d\u59cb schema\uff082024-01-01\uff09\n// V2\uff1a\u6dfb\u52a0 email \u5b57\u6bb5\uff082024-02-01\uff09\n// V3\uff1a\u6dfb\u52a0 phone\u3001address \u5b57\u6bb5\uff082024-03-01\uff09\n"})}),"\n",(0,r.jsx)(n.h3,{id:"4-\u6d4b\u8bd5\u6f14\u5316\u8def\u5f84",children:"4. \u6d4b\u8bd5\u6f14\u5316\u8def\u5f84"}),"\n",(0,r.jsx)(n.p,{children:"\u6d4b\u8bd5\u5347\u7ea7\u548c\u964d\u7ea7\u573a\u666f\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"// \u6d4b\u8bd5 V1 -> V2\n// \u6d4b\u8bd5 V2 -> V1\n// \u6d4b\u8bd5 V1 -> V3\n// \u6d4b\u8bd5 V3 -> V1\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u8de8\u8bed\u8a00-schema-\u6f14\u5316",children:"\u8de8\u8bed\u8a00 Schema \u6f14\u5316"}),"\n",(0,r.jsx)(n.p,{children:"\u4f7f\u7528 xlang \u6a21\u5f0f\u65f6\uff0cschema \u6f14\u5316\u8de8\u8bed\u8a00\u5de5\u4f5c\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"// \u4f7f\u7528 compatible \u6a21\u5f0f\u7684 C++\nauto fory = Fory::builder()\n    .compatible(true)\n    .xlang(true)\n    .build();\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"// \u4f7f\u7528 compatible \u6a21\u5f0f\u7684 Java\nFory fory = Fory.builder()\n    .withCompatibleMode(CompatibleMode.COMPATIBLE)\n    .withLanguage(Language.XLANG)\n    .build();\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u5373\u4f7f schema \u7248\u672c\u4e0d\u540c\uff0c\u4e24\u4e2a\u5b9e\u4f8b\u4e5f\u53ef\u4ee5\u4ea4\u6362\u6570\u636e\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"\u76f8\u5173\u4e3b\u9898",children:"\u76f8\u5173\u4e3b\u9898"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/zh-CN/docs/guide/cpp/configuration",children:"\u914d\u7f6e"})," - \u542f\u7528 compatible \u6a21\u5f0f"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/zh-CN/docs/guide/cpp/type_registration",children:"\u7c7b\u578b\u6ce8\u518c"})," - \u7c7b\u578b ID \u7ba1\u7406"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"/zh-CN/docs/guide/cpp/cross_language",children:"\u8de8\u8bed\u8a00"})," - \u8de8\u8bed\u8a00\u6ce8\u610f\u4e8b\u9879"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},11151:(e,n,s)=>{s.d(n,{Z:()=>l,a:()=>d});var r=s(67294);const i={},t=r.createContext(i);function d(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);