"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[2709],{98201:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>o});var c=r(85893),d=r(11151);const i={title:"\u5171\u4eab\u548c\u5faa\u73af\u5f15\u7528",sidebar_position:5,id:"references",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},s=void 0,t={id:"guide/rust/references",title:"\u5171\u4eab\u548c\u5faa\u73af\u5f15\u7528",description:"Apache Fory\u2122 \u4f7f\u7528 Rc \u548c Arc \u81ea\u52a8\u8ddf\u8e2a\u548c\u4fdd\u7559\u5171\u4eab\u5bf9\u8c61\u7684\u5f15\u7528\u8eab\u4efd\u3002",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/version-0.14/guide/rust/references.md",sourceDirName:"guide/rust",slug:"/guide/rust/references",permalink:"/zh-CN/docs/0.14/guide/rust/references",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/i18n/zh-CN/docusaurus-plugin-content-docs/version-0.14/guide/rust/references.md",tags:[],version:"0.14",sidebarPosition:5,frontMatter:{title:"\u5171\u4eab\u548c\u5faa\u73af\u5f15\u7528",sidebar_position:5,id:"references",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"\u81ea\u5b9a\u4e49\u5e8f\u5217\u5316\u5668",permalink:"/zh-CN/docs/0.14/guide/rust/custom_serializers"},next:{title:"Trait \u5bf9\u8c61\u5e8f\u5217\u5316",permalink:"/zh-CN/docs/0.14/guide/rust/polymorphism"}},l={},o=[{value:"\u5171\u4eab\u5f15\u7528",id:"\u5171\u4eab\u5f15\u7528",level:2},{value:"\u4f7f\u7528 Rc \u7684\u5171\u4eab\u5f15\u7528",id:"\u4f7f\u7528-rc-\u7684\u5171\u4eab\u5f15\u7528",level:3},{value:"\u4f7f\u7528 Arc \u7684\u5171\u4eab\u5f15\u7528",id:"\u4f7f\u7528-arc-\u7684\u5171\u4eab\u5f15\u7528",level:3},{value:"\u4f7f\u7528\u5f31\u6307\u9488\u7684\u5faa\u73af\u5f15\u7528",id:"\u4f7f\u7528\u5f31\u6307\u9488\u7684\u5faa\u73af\u5f15\u7528",level:2},{value:"\u4f7f\u7528 RcWeak \u7684\u5faa\u73af\u5f15\u7528",id:"\u4f7f\u7528-rcweak-\u7684\u5faa\u73af\u5f15\u7528",level:3},{value:"\u4f7f\u7528 Arc \u7684\u7ebf\u7a0b\u5b89\u5168\u5faa\u73af\u56fe",id:"\u4f7f\u7528-arc-\u7684\u7ebf\u7a0b\u5b89\u5168\u5faa\u73af\u56fe",level:3},{value:"\u652f\u6301\u7684\u667a\u80fd\u6307\u9488\u7c7b\u578b",id:"\u652f\u6301\u7684\u667a\u80fd\u6307\u9488\u7c7b\u578b",level:2},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"\u76f8\u5173\u4e3b\u9898",id:"\u76f8\u5173\u4e3b\u9898",level:2}];function a(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.a)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(n.p,{children:["Apache Fory\u2122 \u4f7f\u7528 ",(0,c.jsx)(n.code,{children:"Rc<T>"})," \u548c ",(0,c.jsx)(n.code,{children:"Arc<T>"})," \u81ea\u52a8\u8ddf\u8e2a\u548c\u4fdd\u7559\u5171\u4eab\u5bf9\u8c61\u7684\u5f15\u7528\u8eab\u4efd\u3002"]}),"\n",(0,c.jsx)(n.h2,{id:"\u5171\u4eab\u5f15\u7528",children:"\u5171\u4eab\u5f15\u7528"}),"\n",(0,c.jsx)(n.p,{children:"\u5f53\u540c\u4e00\u5bf9\u8c61\u88ab\u591a\u6b21\u5f15\u7528\u65f6\uff0cFory \u4ec5\u5e8f\u5217\u5316\u4e00\u6b21\uff0c\u5e76\u5bf9\u540e\u7eed\u51fa\u73b0\u4f7f\u7528\u5f15\u7528 ID\u3002\u8fd9\u786e\u4fdd\u4e86\uff1a"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u7a7a\u95f4\u6548\u7387"}),"\uff1a\u5e8f\u5217\u5316\u8f93\u51fa\u4e2d\u65e0\u6570\u636e\u91cd\u590d"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u5f15\u7528\u8eab\u4efd\u4fdd\u7559"}),"\uff1a\u53cd\u5e8f\u5217\u5316\u7684\u5bf9\u8c61\u4fdd\u6301\u76f8\u540c\u7684\u5171\u4eab\u5173\u7cfb"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u5faa\u73af\u5f15\u7528\u652f\u6301"}),"\uff1a\u4f7f\u7528 ",(0,c.jsx)(n.code,{children:"RcWeak<T>"})," \u548c ",(0,c.jsx)(n.code,{children:"ArcWeak<T>"})," \u6253\u7834\u5faa\u73af"]}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"\u4f7f\u7528-rc-\u7684\u5171\u4eab\u5f15\u7528",children:"\u4f7f\u7528 Rc \u7684\u5171\u4eab\u5f15\u7528"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-rust",children:'use fory::Fory;\nuse std::rc::Rc;\n\nlet fory = Fory::default();\n\n// \u521b\u5efa\u5171\u4eab\u503c\nlet shared = Rc::new(String::from("shared_value"));\n\n// \u591a\u6b21\u5f15\u7528\u5b83\nlet data = vec![shared.clone(), shared.clone(), shared.clone()];\n\n// \u5171\u4eab\u503c\u4ec5\u5e8f\u5217\u5316\u4e00\u6b21\nlet bytes = fory.serialize(&data);\nlet decoded: Vec<Rc<String>> = fory.deserialize(&bytes)?;\n\n// \u9a8c\u8bc1\u5f15\u7528\u8eab\u4efd\u88ab\u4fdd\u7559\nassert_eq!(decoded.len(), 3);\nassert_eq!(*decoded[0], "shared_value");\n\n// \u6240\u6709\u4e09\u4e2a Rc \u6307\u9488\u6307\u5411\u540c\u4e00\u5bf9\u8c61\nassert!(Rc::ptr_eq(&decoded[0], &decoded[1]));\nassert!(Rc::ptr_eq(&decoded[1], &decoded[2]));\n'})}),"\n",(0,c.jsx)(n.h3,{id:"\u4f7f\u7528-arc-\u7684\u5171\u4eab\u5f15\u7528",children:"\u4f7f\u7528 Arc \u7684\u5171\u4eab\u5f15\u7528"}),"\n",(0,c.jsxs)(n.p,{children:["\u5bf9\u4e8e\u7ebf\u7a0b\u5b89\u5168\u7684\u5171\u4eab\u5f15\u7528\uff0c\u4f7f\u7528 ",(0,c.jsx)(n.code,{children:"Arc<T>"}),"\uff1a"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-rust",children:'use fory::Fory;\nuse std::sync::Arc;\n\nlet fory = Fory::default();\n\nlet shared = Arc::new(String::from("shared_value"));\nlet data = vec![shared.clone(), shared.clone()];\n\nlet bytes = fory.serialize(&data);\nlet decoded: Vec<Arc<String>> = fory.deserialize(&bytes)?;\n\nassert!(Arc::ptr_eq(&decoded[0], &decoded[1]));\n'})}),"\n",(0,c.jsx)(n.h2,{id:"\u4f7f\u7528\u5f31\u6307\u9488\u7684\u5faa\u73af\u5f15\u7528",children:"\u4f7f\u7528\u5f31\u6307\u9488\u7684\u5faa\u73af\u5f15\u7528"}),"\n",(0,c.jsxs)(n.p,{children:["\u8981\u5e8f\u5217\u5316\u7c7b\u4f3c\u7236\u5b50\u5173\u7cfb\u6216\u53cc\u5411\u94fe\u8868\u7ed3\u6784\u7684\u5faa\u73af\u5f15\u7528\uff0c\u4f7f\u7528 ",(0,c.jsx)(n.code,{children:"RcWeak<T>"})," \u6216 ",(0,c.jsx)(n.code,{children:"ArcWeak<T>"})," \u6765\u6253\u7834\u5faa\u73af\u3002"]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u5de5\u4f5c\u539f\u7406\uff1a"})}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"\u5f31\u6307\u9488\u5e8f\u5217\u5316\u4e3a\u5bf9\u5176\u76ee\u6807\u5bf9\u8c61\u7684\u5f15\u7528"}),"\n",(0,c.jsxs)(n.li,{children:["\u5982\u679c\u5f3a\u6307\u9488\u5df2\u88ab\u4e22\u5f03\uff0c\u5f31\u6307\u9488\u5e8f\u5217\u5316\u4e3a ",(0,c.jsx)(n.code,{children:"Null"})]}),"\n",(0,c.jsx)(n.li,{children:"\u524d\u5411\u5f15\u7528\uff08\u5f31\u6307\u9488\u51fa\u73b0\u5728\u76ee\u6807\u4e4b\u524d\uff09\u901a\u8fc7\u56de\u8c03\u89e3\u6790"}),"\n",(0,c.jsx)(n.li,{children:"\u5f31\u6307\u9488\u7684\u6240\u6709\u514b\u9686\u5171\u4eab\u76f8\u540c\u7684\u5185\u90e8\u5355\u5143\u4ee5\u8fdb\u884c\u81ea\u52a8\u66f4\u65b0"}),"\n"]}),"\n",(0,c.jsx)(n.h3,{id:"\u4f7f\u7528-rcweak-\u7684\u5faa\u73af\u5f15\u7528",children:"\u4f7f\u7528 RcWeak \u7684\u5faa\u73af\u5f15\u7528"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-rust",children:"use fory::{Fory, Error};\nuse fory::ForyObject;\nuse fory::RcWeak;\nuse std::rc::Rc;\nuse std::cell::RefCell;\n\n#[derive(ForyObject, Debug)]\nstruct Node {\n    value: i32,\n    parent: RcWeak<RefCell<Node>>,\n    children: Vec<Rc<RefCell<Node>>>,\n}\n\nlet mut fory = Fory::default();\nfory.register::<Node>(2000);\n\n// \u6784\u5efa\u7236\u5b50\u6811\nlet parent = Rc::new(RefCell::new(Node {\n    value: 1,\n    parent: RcWeak::new(),\n    children: vec![],\n}));\n\nlet child1 = Rc::new(RefCell::new(Node {\n    value: 2,\n    parent: RcWeak::from(&parent),\n    children: vec![],\n}));\n\nlet child2 = Rc::new(RefCell::new(Node {\n    value: 3,\n    parent: RcWeak::from(&parent),\n    children: vec![],\n}));\n\nparent.borrow_mut().children.push(child1.clone());\nparent.borrow_mut().children.push(child2.clone());\n\n// \u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u5faa\u73af\u7ed3\u6784\nlet bytes = fory.serialize(&parent);\nlet decoded: Rc<RefCell<Node>> = fory.deserialize(&bytes)?;\n\n// \u9a8c\u8bc1\u5faa\u73af\u5173\u7cfb\nassert_eq!(decoded.borrow().children.len(), 2);\nfor child in &decoded.borrow().children {\n    let upgraded_parent = child.borrow().parent.upgrade().unwrap();\n    assert!(Rc::ptr_eq(&decoded, &upgraded_parent));\n}\n"})}),"\n",(0,c.jsx)(n.h3,{id:"\u4f7f\u7528-arc-\u7684\u7ebf\u7a0b\u5b89\u5168\u5faa\u73af\u56fe",children:"\u4f7f\u7528 Arc \u7684\u7ebf\u7a0b\u5b89\u5168\u5faa\u73af\u56fe"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-rust",children:"use fory::{Fory, Error};\nuse fory::ForyObject;\nuse fory::ArcWeak;\nuse std::sync::{Arc, Mutex};\n\n#[derive(ForyObject)]\nstruct Node {\n    val: i32,\n    parent: ArcWeak<Mutex<Node>>,\n    children: Vec<Arc<Mutex<Node>>>,\n}\n\nlet mut fory = Fory::default();\nfory.register::<Node>(6000);\n\nlet parent = Arc::new(Mutex::new(Node {\n    val: 10,\n    parent: ArcWeak::new(),\n    children: vec![],\n}));\n\nlet child1 = Arc::new(Mutex::new(Node {\n    val: 20,\n    parent: ArcWeak::from(&parent),\n    children: vec![],\n}));\n\nlet child2 = Arc::new(Mutex::new(Node {\n    val: 30,\n    parent: ArcWeak::from(&parent),\n    children: vec![],\n}));\n\nparent.lock().unwrap().children.push(child1.clone());\nparent.lock().unwrap().children.push(child2.clone());\n\nlet bytes = fory.serialize(&parent);\nlet decoded: Arc<Mutex<Node>> = fory.deserialize(&bytes)?;\n\nassert_eq!(decoded.lock().unwrap().children.len(), 2);\nfor child in &decoded.lock().unwrap().children {\n    let upgraded_parent = child.lock().unwrap().parent.upgrade().unwrap();\n    assert!(Arc::ptr_eq(&decoded, &upgraded_parent));\n}\n"})}),"\n",(0,c.jsx)(n.h2,{id:"\u652f\u6301\u7684\u667a\u80fd\u6307\u9488\u7c7b\u578b",children:"\u652f\u6301\u7684\u667a\u80fd\u6307\u9488\u7c7b\u578b"}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,c.jsx)(n.th,{children:"\u63cf\u8ff0"})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"Rc<T>"})}),(0,c.jsx)(n.td,{children:"\u5f15\u7528\u8ba1\u6570\uff0c\u8ddf\u8e2a\u5171\u4eab\u5f15\u7528"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"Arc<T>"})}),(0,c.jsx)(n.td,{children:"\u7ebf\u7a0b\u5b89\u5168\u5f15\u7528\u8ba1\u6570\uff0c\u8ddf\u8e2a\u5171\u4eab\u5f15\u7528"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"RcWeak<T>"})}),(0,c.jsxs)(n.td,{children:["\u6307\u5411 ",(0,c.jsx)(n.code,{children:"Rc<T>"})," \u7684\u5f31\u5f15\u7528\uff0c\u6253\u7834\u5faa\u73af\u5f15\u7528"]})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"ArcWeak<T>"})}),(0,c.jsxs)(n.td,{children:["\u6307\u5411 ",(0,c.jsx)(n.code,{children:"Arc<T>"})," \u7684\u5f31\u5f15\u7528\uff0c\u6253\u7834\u5faa\u73af\u5f15\u7528"]})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"RefCell<T>"})}),(0,c.jsx)(n.td,{children:"\u5185\u90e8\u53ef\u53d8\u6027\uff0c\u8fd0\u884c\u65f6\u501f\u7528\u68c0\u67e5"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"Mutex<T>"})}),(0,c.jsx)(n.td,{children:"\u7ebf\u7a0b\u5b89\u5168\u5185\u90e8\u53ef\u53d8\u6027"})]})]})]}),"\n",(0,c.jsx)(n.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,c.jsxs)(n.ol,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u4f7f\u7528 Rc/Arc \u5171\u4eab\u6570\u636e"}),"\uff1a\u8ba9 Fory \u5904\u7406\u53bb\u91cd"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u4f7f\u7528\u5f31\u6307\u9488\u5904\u7406\u5faa\u73af"}),"\uff1a\u9632\u6b62\u65e0\u9650\u9012\u5f52"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u5bf9\u7ebf\u7a0b\u5b89\u5168\u573a\u666f\u4f18\u5148\u4f7f\u7528 Arc"}),"\uff1a\u5f53\u6570\u636e\u8de8\u8d8a\u7ebf\u7a0b\u8fb9\u754c\u65f6"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.strong,{children:"\u4e0e RefCell/Mutex \u7ed3\u5408\u4f7f\u7528"}),"\uff1a\u7528\u4e8e\u5185\u90e8\u53ef\u53d8\u6027"]}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"\u76f8\u5173\u4e3b\u9898",children:"\u76f8\u5173\u4e3b\u9898"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.a,{href:"/zh-CN/docs/0.14/guide/rust/basic_serialization",children:"\u57fa\u7840\u5e8f\u5217\u5316"})," - \u652f\u6301\u7684\u7c7b\u578b"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.a,{href:"/zh-CN/docs/0.14/guide/rust/polymorphism",children:"\u591a\u6001"})," - \u4f7f\u7528 Rc/Arc \u7684 Trait \u5bf9\u8c61"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.a,{href:"/zh-CN/docs/0.14/guide/rust/configuration",children:"\u914d\u7f6e"})," - \u5f15\u7528\u8ddf\u8e2a\u9009\u9879"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,d.a)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(a,{...e})}):a(e)}},11151:(e,n,r)=>{r.d(n,{Z:()=>t,a:()=>s});var c=r(67294);const d={},i=c.createContext(d);function s(e){const n=c.useContext(i);return c.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:s(e.components),c.createElement(i.Provider,{value:n},e.children)}}}]);