"use strict";(self.webpackChunkfory_site=self.webpackChunkfory_site||[]).push([[6911],{34148:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>c});var i=r(85893),t=r(11151);const s={title:"Trait \u5bf9\u8c61\u5e8f\u5217\u5316",sidebar_position:6,id:"polymorphism",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},d=void 0,a={id:"guide/rust/polymorphism",title:"Trait \u5bf9\u8c61\u5e8f\u5217\u5316",description:"Apache Fory\u2122 \u901a\u8fc7 trait \u5bf9\u8c61\u652f\u6301\u591a\u6001\u5e8f\u5217\u5316\uff0c\u5b9e\u73b0\u52a8\u6001\u5206\u53d1\u548c\u7c7b\u578b\u7075\u6d3b\u6027\u3002",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/guide/rust/polymorphism.md",sourceDirName:"guide/rust",slug:"/guide/rust/polymorphism",permalink:"/zh-CN/docs/next/guide/rust/polymorphism",draft:!1,unlisted:!1,editUrl:"https://github.com/apache/fory-site/tree/main/i18n/zh-CN/docusaurus-plugin-content-docs/current/guide/rust/polymorphism.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{title:"Trait \u5bf9\u8c61\u5e8f\u5217\u5316",sidebar_position:6,id:"polymorphism",license:'Licensed to the Apache Software Foundation (ASF) under one or more\ncontributor license agreements.  See the NOTICE file distributed with\nthis work for additional information regarding copyright ownership.\nThe ASF licenses this file to You under the Apache License, Version 2.0\n(the "License"); you may not use this file except in compliance with\nthe License.  You may obtain a copy of the License at\n\n   http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n'},sidebar:"docsSidebar",previous:{title:"\u5171\u4eab\u548c\u5faa\u73af\u5f15\u7528",permalink:"/zh-CN/docs/next/guide/rust/references"},next:{title:"Schema \u6f14\u5316",permalink:"/zh-CN/docs/next/guide/rust/schema_evolution"}},o={},c=[{value:"\u652f\u6301\u7684 Trait \u5bf9\u8c61\u7c7b\u578b",id:"\u652f\u6301\u7684-trait-\u5bf9\u8c61\u7c7b\u578b",level:2},{value:"\u57fa\u7840 Trait \u5bf9\u8c61\u5e8f\u5217\u5316",id:"\u57fa\u7840-trait-\u5bf9\u8c61\u5e8f\u5217\u5316",level:2},{value:"\u5e8f\u5217\u5316 dyn Any Trait \u5bf9\u8c61",id:"\u5e8f\u5217\u5316-dyn-any-trait-\u5bf9\u8c61",level:2},{value:"\u7ed3\u6784\u4f53\u4e2d\u57fa\u4e8e Rc/Arc \u7684 Trait \u5bf9\u8c61",id:"\u7ed3\u6784\u4f53\u4e2d\u57fa\u4e8e-rcarc-\u7684-trait-\u5bf9\u8c61",level:2},{value:"\u72ec\u7acb Trait \u5bf9\u8c61\u5e8f\u5217\u5316",id:"\u72ec\u7acb-trait-\u5bf9\u8c61\u5e8f\u5217\u5316",level:2},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"\u76f8\u5173\u4e3b\u9898",id:"\u76f8\u5173\u4e3b\u9898",level:2}];function l(e){const n={a:"a",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Apache Fory\u2122 \u901a\u8fc7 trait \u5bf9\u8c61\u652f\u6301\u591a\u6001\u5e8f\u5217\u5316\uff0c\u5b9e\u73b0\u52a8\u6001\u5206\u53d1\u548c\u7c7b\u578b\u7075\u6d3b\u6027\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u652f\u6301\u7684-trait-\u5bf9\u8c61\u7c7b\u578b",children:"\u652f\u6301\u7684 Trait \u5bf9\u8c61\u7c7b\u578b"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Box<dyn Trait>"})," - \u62e5\u6709\u6240\u6709\u6743\u7684 trait \u5bf9\u8c61"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Rc<dyn Trait>"})," - \u5f15\u7528\u8ba1\u6570 trait \u5bf9\u8c61"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Arc<dyn Trait>"})," - \u7ebf\u7a0b\u5b89\u5168\u5f15\u7528\u8ba1\u6570 trait \u5bf9\u8c61"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Vec<Box<dyn Trait>>"}),"\u3001",(0,i.jsx)(n.code,{children:"HashMap<K, Box<dyn Trait>>"})," - trait \u5bf9\u8c61\u96c6\u5408"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u57fa\u7840-trait-\u5bf9\u8c61\u5e8f\u5217\u5316",children:"\u57fa\u7840 Trait \u5bf9\u8c61\u5e8f\u5217\u5316"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'use fory::{Fory, register_trait_type};\nuse fory::Serializer;\nuse fory::ForyObject;\n\ntrait Animal: Serializer {\n    fn speak(&self) -> String;\n    fn name(&self) -> &str;\n}\n\n#[derive(ForyObject)]\nstruct Dog { name: String, breed: String }\n\nimpl Animal for Dog {\n    fn speak(&self) -> String { "Woof!".to_string() }\n    fn name(&self) -> &str { &self.name }\n}\n\n#[derive(ForyObject)]\nstruct Cat { name: String, color: String }\n\nimpl Animal for Cat {\n    fn speak(&self) -> String { "Meow!".to_string() }\n    fn name(&self) -> &str { &self.name }\n}\n\n// \u6ce8\u518c trait \u5b9e\u73b0\nregister_trait_type!(Animal, Dog, Cat);\n\n#[derive(ForyObject)]\nstruct Zoo {\n    star_animal: Box<dyn Animal>,\n}\n\nlet mut fory = Fory::default().compatible(true);\nfory.register::<Dog>(100);\nfory.register::<Cat>(101);\nfory.register::<Zoo>(102);\n\nlet zoo = Zoo {\n    star_animal: Box::new(Dog {\n        name: "Buddy".to_string(),\n        breed: "Labrador".to_string(),\n    }),\n};\n\nlet bytes = fory.serialize(&zoo);\nlet decoded: Zoo = fory.deserialize(&bytes)?;\n\nassert_eq!(decoded.star_animal.name(), "Buddy");\nassert_eq!(decoded.star_animal.speak(), "Woof!");\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u5e8f\u5217\u5316-dyn-any-trait-\u5bf9\u8c61",children:"\u5e8f\u5217\u5316 dyn Any Trait \u5bf9\u8c61"}),"\n",(0,i.jsxs)(n.p,{children:["Apache Fory\u2122 \u652f\u6301\u5e8f\u5217\u5316 ",(0,i.jsx)(n.code,{children:"Rc<dyn Any>"})," \u548c ",(0,i.jsx)(n.code,{children:"Arc<dyn Any>"})," \u4ee5\u5b9e\u73b0\u8fd0\u884c\u65f6\u7c7b\u578b\u5206\u53d1\uff1a"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u8981\u70b9\uff1a"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u9002\u7528\u4e8e\u4efb\u4f55\u5b9e\u73b0 ",(0,i.jsx)(n.code,{children:"Serializer"})," \u7684\u7c7b\u578b"]}),"\n",(0,i.jsx)(n.li,{children:"\u53cd\u5e8f\u5217\u5316\u540e\u9700\u8981\u5411\u4e0b\u8f6c\u578b\u4ee5\u8bbf\u95ee\u5177\u4f53\u7c7b\u578b"}),"\n",(0,i.jsx)(n.li,{children:"\u5e8f\u5217\u5316\u671f\u95f4\u4fdd\u7559\u7c7b\u578b\u4fe1\u606f"}),"\n",(0,i.jsx)(n.li,{children:"\u5bf9\u63d2\u4ef6\u7cfb\u7edf\u548c\u52a8\u6001\u7c7b\u578b\u5904\u7406\u5f88\u6709\u7528"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'use std::rc::Rc;\nuse std::any::Any;\n\nlet dog_rc: Rc<dyn Animal> = Rc::new(Dog {\n    name: "Rex".to_string(),\n    breed: "Golden".to_string()\n});\n\n// \u8f6c\u6362\u4e3a Rc<dyn Any> \u4ee5\u8fdb\u884c\u5e8f\u5217\u5316\nlet dog_any: Rc<dyn Any> = dog_rc.clone();\n\n// \u5e8f\u5217\u5316 Any \u5305\u88c5\u5668\nlet bytes = fory.serialize(&dog_any);\nlet decoded: Rc<dyn Any> = fory.deserialize(&bytes)?;\n\n// \u5411\u4e0b\u8f6c\u578b\u56de\u5177\u4f53\u7c7b\u578b\nlet unwrapped = decoded.downcast_ref::<Dog>().unwrap();\nassert_eq!(unwrapped.name, "Rex");\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\u5bf9\u4e8e\u7ebf\u7a0b\u5b89\u5168\u573a\u666f\uff0c\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"Arc<dyn Any>"}),"\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'use std::sync::Arc;\nuse std::any::Any;\n\nlet dog_arc: Arc<dyn Animal> = Arc::new(Dog {\n    name: "Buddy".to_string(),\n    breed: "Labrador".to_string()\n});\n\n// \u8f6c\u6362\u4e3a Arc<dyn Any>\nlet dog_any: Arc<dyn Any> = dog_arc.clone();\n\nlet bytes = fory.serialize(&dog_any);\nlet decoded: Arc<dyn Any> = fory.deserialize(&bytes)?;\n\n// \u5411\u4e0b\u8f6c\u578b\u4e3a\u5177\u4f53\u7c7b\u578b\nlet unwrapped = decoded.downcast_ref::<Dog>().unwrap();\nassert_eq!(unwrapped.name, "Buddy");\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u7ed3\u6784\u4f53\u4e2d\u57fa\u4e8e-rcarc-\u7684-trait-\u5bf9\u8c61",children:"\u7ed3\u6784\u4f53\u4e2d\u57fa\u4e8e Rc/Arc \u7684 Trait \u5bf9\u8c61"}),"\n",(0,i.jsxs)(n.p,{children:["\u5bf9\u4e8e\u5177\u6709 ",(0,i.jsx)(n.code,{children:"Rc<dyn Trait>"})," \u6216 ",(0,i.jsx)(n.code,{children:"Arc<dyn Trait>"})," \u7684\u5b57\u6bb5\uff0cFory \u81ea\u52a8\u5904\u7406\u8f6c\u6362\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'use std::sync::Arc;\nuse std::rc::Rc;\nuse std::collections::HashMap;\n\n#[derive(ForyObject)]\nstruct AnimalShelter {\n    animals_rc: Vec<Rc<dyn Animal>>,\n    animals_arc: Vec<Arc<dyn Animal>>,\n    registry: HashMap<String, Arc<dyn Animal>>,\n}\n\nlet mut fory = Fory::default().compatible(true);\nfory.register::<Dog>(100);\nfory.register::<Cat>(101);\nfory.register::<AnimalShelter>(102);\n\nlet shelter = AnimalShelter {\n    animals_rc: vec![\n        Rc::new(Dog { name: "Rex".to_string(), breed: "Golden".to_string() }),\n        Rc::new(Cat { name: "Mittens".to_string(), color: "Gray".to_string() }),\n    ],\n    animals_arc: vec![\n        Arc::new(Dog { name: "Buddy".to_string(), breed: "Labrador".to_string() }),\n    ],\n    registry: HashMap::from([\n        ("pet1".to_string(), Arc::new(Dog {\n            name: "Max".to_string(),\n            breed: "Shepherd".to_string()\n        }) as Arc<dyn Animal>),\n    ]),\n};\n\nlet bytes = fory.serialize(&shelter);\nlet decoded: AnimalShelter = fory.deserialize(&bytes)?;\n\nassert_eq!(decoded.animals_rc[0].name(), "Rex");\nassert_eq!(decoded.animals_arc[0].speak(), "Woof!");\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u72ec\u7acb-trait-\u5bf9\u8c61\u5e8f\u5217\u5316",children:"\u72ec\u7acb Trait \u5bf9\u8c61\u5e8f\u5217\u5316"}),"\n",(0,i.jsxs)(n.p,{children:["\u7531\u4e8e Rust \u7684\u5b64\u513f\u89c4\u5219\uff0c",(0,i.jsx)(n.code,{children:"Rc<dyn Trait>"})," \u548c ",(0,i.jsx)(n.code,{children:"Arc<dyn Trait>"})," \u4e0d\u80fd\u76f4\u63a5\u5b9e\u73b0 ",(0,i.jsx)(n.code,{children:"Serializer"}),"\u3002\u5bf9\u4e8e\u72ec\u7acb\u5e8f\u5217\u5316\uff08\u4e0d\u5728\u7ed3\u6784\u4f53\u5b57\u6bb5\u5185\uff09\uff0c",(0,i.jsx)(n.code,{children:"register_trait_type!"})," \u5b8f\u751f\u6210\u5305\u88c5\u7c7b\u578b\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u6ce8\u610f\uff1a"})," \u5982\u679c\u4e0d\u60f3\u4f7f\u7528\u5305\u88c5\u7c7b\u578b\uff0c\u53ef\u4ee5\u6539\u4e3a\u5e8f\u5217\u5316\u4e3a ",(0,i.jsx)(n.code,{children:"Rc<dyn Any>"})," \u6216 ",(0,i.jsx)(n.code,{children:"Arc<dyn Any>"}),"\uff08\u53c2\u89c1\u4e0a\u9762\u7684 dyn Any \u90e8\u5206\uff09\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"register_trait_type!"})," \u5b8f\u751f\u6210 ",(0,i.jsx)(n.code,{children:"AnimalRc"})," \u548c ",(0,i.jsx)(n.code,{children:"AnimalArc"})," \u5305\u88c5\u7c7b\u578b\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-rust",children:'// \u5bf9\u4e8e Rc<dyn Trait>\nlet dog_rc: Rc<dyn Animal> = Rc::new(Dog {\n    name: "Rex".to_string(),\n    breed: "Golden".to_string()\n});\nlet wrapper = AnimalRc::from(dog_rc);\n\nlet bytes = fory.serialize(&wrapper);\nlet decoded: AnimalRc = fory.deserialize(&bytes)?;\n\n// \u89e3\u5305\u56de Rc<dyn Animal>\nlet unwrapped: Rc<dyn Animal> = decoded.unwrap();\nassert_eq!(unwrapped.name(), "Rex");\n\n// \u5bf9\u4e8e Arc<dyn Trait>\nlet dog_arc: Arc<dyn Animal> = Arc::new(Dog {\n    name: "Buddy".to_string(),\n    breed: "Labrador".to_string()\n});\nlet wrapper = AnimalArc::from(dog_arc);\n\nlet bytes = fory.serialize(&wrapper);\nlet decoded: AnimalArc = fory.deserialize(&bytes)?;\n\nlet unwrapped: Arc<dyn Animal> = decoded.unwrap();\nassert_eq!(unwrapped.name(), "Buddy");\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsxs)(n.strong,{children:["\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:"register_trait_type!"})]})," \u6ce8\u518c\u6240\u6709 trait \u5b9e\u73b0"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u542f\u7528 compatible \u6a21\u5f0f"}),"\uff1a\u5bf9 trait \u5bf9\u8c61\u4f7f\u7528 ",(0,i.jsx)(n.code,{children:".compatible(true)"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u6ce8\u518c\u6240\u6709\u5177\u4f53\u7c7b\u578b"}),"\uff1a\u5728\u5e8f\u5217\u5316\u4e4b\u524d"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u4f18\u5148\u4f7f\u7528 dyn Any"}),"\uff1a\u5bf9\u4e8e\u66f4\u7b80\u5355\u7684\u72ec\u7acb\u5e8f\u5217\u5316"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u76f8\u5173\u4e3b\u9898",children:"\u76f8\u5173\u4e3b\u9898"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/zh-CN/docs/next/guide/rust/references",children:"\u5f15\u7528"})," - Rc/Arc \u5171\u4eab\u5f15\u7528"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/zh-CN/docs/next/guide/rust/schema_evolution",children:"Schema \u6f14\u5316"})," - Compatible \u6a21\u5f0f"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/zh-CN/docs/next/guide/rust/type_registration",children:"\u7c7b\u578b\u6ce8\u518c"})," - \u6ce8\u518c\u7c7b\u578b"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},11151:(e,n,r)=>{r.d(n,{Z:()=>a,a:()=>d});var i=r(67294);const t={},s=i.createContext(t);function d(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);