<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-0.15 docs-doc-page docs-doc-id-specification/java_serialization_spec" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Java 序列化格式 | Apache Fory™</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" property="og:url" content="https://fory.apache.org/zh-CN/docs/specification/java_serialization_spec"><meta data-rh="true" property="og:locale" content="zh_CN"><meta data-rh="true" property="og:locale:alternate" content="en_US"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" http-equiv="Content-Security-Policy" content="frame-src &#x27;self&#x27; https://ghbtns.com/;"><meta data-rh="true" property="og:image" content="https://fory.apache.org/img/logo.png"><meta data-rh="true" property="og:image:width" content="1500"><meta data-rh="true" property="og:image:height" content="1500"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" name="twitter:image" content="https://fory.apache.org/img/logo.png"><meta data-rh="true" name="docusaurus_version" content="0.15"><meta data-rh="true" name="docusaurus_tag" content="docs-default-0.15"><meta data-rh="true" name="docsearch:version" content="0.15"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-0.15"><meta data-rh="true" property="og:title" content="Java 序列化格式 | Apache Fory™"><meta data-rh="true" name="description" content="本文定义 Apache Fory Java 原生序列化格式的编码格式细节。"><meta data-rh="true" property="og:description" content="本文定义 Apache Fory Java 原生序列化格式的编码格式细节。"><link data-rh="true" rel="icon" href="/zh-CN/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://fory.apache.org/zh-CN/docs/specification/java_serialization_spec"><link data-rh="true" rel="alternate" href="https://fory.apache.org/docs/specification/java_serialization_spec" hreflang="en-US"><link data-rh="true" rel="alternate" href="https://fory.apache.org/zh-CN/docs/specification/java_serialization_spec" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://fory.apache.org/docs/specification/java_serialization_spec" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/zh-CN/blog/rss.xml" title="Apache Fory™ RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh-CN/blog/atom.xml" title="Apache Fory™ Atom Feed">




<script>"fury.apache.org"===window.location.host&&(window.location.href="https://fory.apache.org"),function(){for(var o=window.location.pathname,a=["guide","introduction","start"],n=0;n<a.length;n++){var t=a[n],i=new RegExp("^((?:/[a-z]{2}-[A-Z]{2})?/docs(?:/(?:next|[0-9]+.[0-9]+))?)/docs/"+t+"(/.*)?$"),c=o.match(i);if(c){var r=c[1]+"/"+t+(c[2]||"");return void window.location.replace(r+window.location.search+window.location.hash)}}}()</script><link rel="stylesheet" href="/zh-CN/assets/css/styles.66efb2f1.css">
<script src="/zh-CN/assets/js/runtime~main.8f4693ed.js" defer="defer"></script>
<script src="/zh-CN/assets/js/main.e908ebb8.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh-CN/"><div class="navbar__logo"><img src="/zh-CN/img/fory-logo-light.png" alt="Fory Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/zh-CN/img/fory-logo-dark.png" alt="Fory Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/zh-CN/docs/introduction/overview">文档</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/zh-CN/docs/specification/java_serialization_spec">规范</a><a class="navbar__item navbar__link" href="/zh-CN/docs/community/">社区</a><a class="navbar__item navbar__link" href="/zh-CN/user">Users</a><a class="navbar__item navbar__link" href="/zh-CN/download">下载</a><a class="navbar__item navbar__link" href="/zh-CN/blog">博客</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ASF</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">基金会</a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">许可证</a></li><li><a href="https://www.apache.org/events/current-event.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">事件</a></li><li><a href="https://privacy.apache.org/policies/privacy-policy-public.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">隐私</a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">安全</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">赞助</a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">感谢</a></li><li><a href="https://www.apache.org/foundation/policies/conduct.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">行为准则</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/zh-CN/docs/introduction/overview">0.15</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh-CN/docs/next/specification/java_serialization_spec">dev</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/zh-CN/docs/specification/java_serialization_spec">0.15</a></li><li><a class="dropdown__link" href="/zh-CN/docs/0.14/specification/java_serialization_spec">0.14</a></li><li><a class="dropdown__link" href="/zh-CN/docs/0.13/specification/java_serialization_spec">0.13</a></li><li><a class="dropdown__link" href="/zh-CN/docs/0.12/specification/java_serialization_spec">0.12</a></li><li><a class="dropdown__link" href="/zh-CN/docs/0.11/specification/java_serialization_spec">0.11</a></li><li><a class="dropdown__link" href="/zh-CN/docs/0.10/specification/java_serialization_spec">0.10</a></li></ul></div><a href="https://github.com/apache/fory" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>简体中文</a><ul class="dropdown__menu"><li><a href="/docs/specification/java_serialization_spec" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en-US">English</a></li><li><a href="/zh-CN/docs/specification/java_serialization_spec" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-CN">简体中文</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/zh-CN/docs/specification/java_serialization_spec">Java 序列化格式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-CN/docs/specification/row_format_spec">Row 格式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-CN/docs/specification/xlang_serialization_spec">Xlang 序列化格式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-CN/docs/specification/xlang_type_mapping">Xlang 类型映射</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/zh-CN/docs/specification/xlang_implementation_guide">Xlang 实现指南</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/zh-CN/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Java 序列化格式</span><meta itemprop="position" content="1"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">版本：0.15</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Java 序列化格式</h1></header><p>本文定义 Apache Fory Java 原生序列化格式的编码格式细节。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="规范概览">规范概览<a href="#规范概览" class="hash-link" aria-label="规范概览的直接链接" title="规范概览的直接链接">​</a></h2>
<p>Fory Java 原生 格式面向 Java 对象图，支持：</p>
<ul>
<li>共享引用与循环引用</li>
<li>多态对象</li>
<li>可选 schema 演进</li>
<li>流式写入（共享 type meta 按需内联，不要求预先 meta 区）</li>
</ul>
<p>Java native 是 xlang 编码格式的扩展，复用相同核心帧与基础编码。</p>
<p>总体布局：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| fory header | object ref meta | object type meta | object value data |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>字节序统一为 little-endian。大端平台实现需在数组等路径做字节序转换，确保线上格式一致。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="fory-头部">Fory 头部<a href="#fory-头部" class="hash-link" aria-label="Fory 头部的直接链接" title="Fory 头部的直接链接">​</a></h2>
<p>Java 原生序列化头部是 1-byte 位图：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">|     5 bits    | 1 bit | 1 bit | 1 bit |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">+--------------+-------+-------+-------+</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| reserved     |  oob  | xlang | null  |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>含义：</p>
<ul>
<li><code>null</code>：对象是否为 null（为 1 时其余位不应置位）</li>
<li><code>xlang</code>：1 表示 xlang 格式，0 表示 Java native</li>
<li><code>oob</code>：1 表示存在 <code>BufferCallback</code></li>
</ul>
<p>头部始终 1 字节，不额外写 language ID。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="引用元信息">引用元信息<a href="#引用元信息" class="hash-link" aria-label="引用元信息的直接链接" title="引用元信息的直接链接">​</a></h2>
<p>引用跟踪标记与 xlang 一致：</p>
<table><thead><tr><th>标记</th><th>字节值</th><th>说明</th></tr></thead><tbody><tr><td>NULL FLAG</td><td><code>-3</code></td><td>对象为 null，后续不写对象内容</td></tr><tr><td>REF FLAG</td><td><code>-2</code></td><td>已出现对象，后接 <code>varuint32</code> 的 reference ID</td></tr><tr><td>NOT_NULL VALUE FLAG</td><td><code>-1</code></td><td>非空但  该类型未启用引用跟踪，后接对象内容</td></tr><tr><td>REF VALUE FLAG</td><td><code>0</code></td><td>可引用对象首次出现，后接对象内容，并分配新 reference ID</td></tr></tbody></table>
<p>当全局或字段级禁用引用跟踪时，仅使用 <code>NULL FLAG</code> 与 <code>NOT_NULL VALUE FLAG</code>。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="type-system-and-type-ids">Type system and type IDs<a href="#type-system-and-type-ids" class="hash-link" aria-label="Type system and type IDs的直接链接" title="Type system and type IDs的直接链接">​</a></h2>
<p>Java native 使用与 xlang 统一的类型 ID 组合方式：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">full_type_id = (user_type_id &lt;&lt; 8) | internal_type_id</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>internal_type_id</code>：低 8 位，表示类型种类</li>
<li><code>user_type_id</code>：用户注册数值 ID（适用于用户 enum/struct/ext）</li>
<li>named 类型使用 <code>NAMED_*</code>，其标识来自元信息（命名空间+类型名）</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="shared-internal-type-ids-0-63">Shared internal type IDs (0-63)<a href="#shared-internal-type-ids-0-63" class="hash-link" aria-label="Shared internal type IDs (0-63)的直接链接" title="Shared internal type IDs (0-63)的直接链接">​</a></h3>
<p>Java native 与 xlang 共享 <code>&lt; 64</code> 的 internal IDs：</p>
<ul>
<li><code>0~56</code> 已定义</li>
<li><code>57~63</code> 预留</li>
</ul>
<p>详见 <a href="/zh-CN/docs/specification/xlang_serialization_spec#internal-type-id-table">Xlang Serialization Format</a>。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="java-native-built-in-type-ids">Java native built-in type IDs<a href="#java-native-built-in-type-ids" class="hash-link" aria-label="Java native built-in type IDs的直接链接" title="Java native built-in type IDs的直接链接">​</a></h3>
<p>Java 专有内建类型从 <code>Types.BOUND + 5</code> 开始（<code>Types.BOUND=64</code>，预留 5 个）。</p>
<table><thead><tr><th>Type ID</th><th>Name</th><th>Description</th></tr></thead><tbody><tr><td>69</td><td>VOID_ID</td><td>java.lang.Void</td></tr><tr><td>70</td><td>CHAR_ID</td><td>java.lang.Character</td></tr><tr><td>71</td><td>PRIMITIVE_VOID_ID</td><td>void</td></tr><tr><td>72</td><td>PRIMITIVE_BOOL_ID</td><td>boolean</td></tr><tr><td>73</td><td>PRIMITIVE_INT8_ID</td><td>byte</td></tr><tr><td>74</td><td>PRIMITIVE_CHAR_ID</td><td>char</td></tr><tr><td>75</td><td>PRIMITIVE_INT16_ID</td><td>short</td></tr><tr><td>76</td><td>PRIMITIVE_INT32_ID</td><td>int</td></tr><tr><td>77</td><td>PRIMITIVE_FLOAT32_ID</td><td>float</td></tr><tr><td>78</td><td>PRIMITIVE_INT64_ID</td><td>long</td></tr><tr><td>79</td><td>PRIMITIVE_FLOAT64_ID</td><td>double</td></tr><tr><td>80</td><td>PRIMITIVE_BOOLEAN_ARRAY_ID</td><td>boolean[]</td></tr><tr><td>81</td><td>PRIMITIVE_BYTE_ARRAY_ID</td><td>byte[]</td></tr><tr><td>82</td><td>PRIMITIVE_CHAR_ARRAY_ID</td><td>char[]</td></tr><tr><td>83</td><td>PRIMITIVE_SHORT_ARRAY_ID</td><td>short[]</td></tr><tr><td>84</td><td>PRIMITIVE_INT_ARRAY_ID</td><td>int[]</td></tr><tr><td>85</td><td>PRIMITIVE_FLOAT_ARRAY_ID</td><td>float[]</td></tr><tr><td>86</td><td>PRIMITIVE_LONG_ARRAY_ID</td><td>long[]</td></tr><tr><td>87</td><td>PRIMITIVE_DOUBLE_ARRAY_ID</td><td>double[]</td></tr><tr><td>88</td><td>STRING_ARRAY_ID</td><td>String[]</td></tr><tr><td>89</td><td>OBJECT_ARRAY_ID</td><td>Object[]</td></tr><tr><td>90</td><td>ARRAYLIST_ID</td><td>java.util.ArrayList</td></tr><tr><td>91</td><td>HASHMAP_ID</td><td>java.util.HashMap</td></tr><tr><td>92</td><td>HASHSET_ID</td><td>java.util.HashSet</td></tr><tr><td>93</td><td>CLASS_ID</td><td>java.lang.Class</td></tr><tr><td>94</td><td>EMPTY_OBJECT_ID</td><td>empty object stub</td></tr><tr><td>95</td><td>LAMBDA_STUB_ID</td><td>lambda stub</td></tr><tr><td>96</td><td>JDK_PROXY_STUB_ID</td><td>JDK proxy stub</td></tr><tr><td>97</td><td>REPLACE_STUB_ID</td><td>writeReplace/readResolve stub</td></tr><tr><td>98</td><td>NONEXISTENT_META_SHARED_ID</td><td>meta-shared unknown class stub</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="registration-and-named-types">Registration and named types<a href="#registration-and-named-types" class="hash-link" aria-label="Registration and named types的直接链接" title="Registration and named types的直接链接">​</a></h3>
<p>用户类型可按数值或名称注册：</p>
<ul>
<li>数值注册：<code>full_type_id = (user_id &lt;&lt; 8) | internal_type_id</code></li>
<li>名称注册：通过 namespace + typename</li>
<li>未注册类型按 named 类型写出（namespace=包名，typename=类名）</li>
</ul>
<p>未注册时命名类型选择：</p>
<ul>
<li>enum -&gt; <code>NAMED_ENUM</code></li>
<li>struct-like -&gt; <code>NAMED_STRUCT</code>（兼容模式下 <code>NAMED_COMPATIBLE_STRUCT</code>）</li>
<li>其他自定义 serializer -&gt; <code>NAMED_EXT</code></li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="type-meta-encoding">Type meta encoding<a href="#type-meta-encoding" class="hash-link" aria-label="Type meta encoding的直接链接" title="Type meta encoding的直接链接">​</a></h2>
<p>每个值写入流程：</p>
<ol>
<li>写 <code>type_id</code>（varuint32 small7）</li>
<li>对 <code>NAMED_*</code> / <code>COMPATIBLE_STRUCT</code> 等类型按规则写额外元信息</li>
<li>其余类型无需额外 meta</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="shared-class-meta-streaming">Shared class meta (streaming)<a href="#shared-class-meta-streaming" class="hash-link" aria-label="Shared class meta (streaming)的直接链接" title="Shared class meta (streaming)的直接链接">​</a></h3>
<p>开启 meta share 时，使用流式共享 class meta：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| varuint32: index_marker | [class def bytes if new] |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">index_marker = (index &lt;&lt; 1) | flag</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flag = 1 -&gt; reference</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flag = 0 -&gt; new type</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>flag=1</code>：引用历史 type，后续无 class def bytes</li>
<li><code>flag=0</code>：新 type，后续内联 class def</li>
<li>index 按首次出现顺序递增</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="schema-modes">Schema modes<a href="#schema-modes" class="hash-link" aria-label="Schema modes的直接链接" title="Schema modes的直接链接">​</a></h2>
<p>Java native 支持两种模式：</p>
<ul>
<li><strong>Schema consistent</strong>（compatible 关闭）：字段按固定顺序写，不需要 ClassDef</li>
<li><strong>Schema evolution</strong>（compatible 开启）：按 ClassDef 元信息支持演进</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="classdef-format-compatible-mode">ClassDef format (compatible mode)<a href="#classdef-format-compatible-mode" class="hash-link" aria-label="ClassDef format (compatible mode)的直接链接" title="ClassDef format (compatible mode)的直接链接">​</a></h2>
<p>ClassDef 是 compatible struct 的演进元信息。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="binary-layout">Binary layout<a href="#binary-layout" class="hash-link" aria-label="Binary layout的直接链接" title="Binary layout的直接链接">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| 8 bytes header | [varuint32 extra size] | class meta bytes |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>header 位布局：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| 50-bit hash | 4 bits reserved | 1 bit compress | 1 bit has_fields_meta | 8-bit size |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>规则：</p>
<ul>
<li><code>size</code> 为低 8 位；若为 <code>0xFF</code>，后接扩展长度</li>
<li><code>compress</code>：payload 是否压缩</li>
<li><code>has_fields_meta</code>：是否含字段元信息</li>
<li><code>reserved</code> 必须为 0</li>
<li><code>hash</code> 为 payload + flags 的 50-bit 哈希</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="class-meta-bytes">Class meta bytes<a href="#class-meta-bytes" class="hash-link" aria-label="Class meta bytes的直接链接" title="Class meta bytes的直接链接">​</a></h3>
<p>表示线性化继承层次（父 -&gt; 子）与字段信息：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| num_classes | class_layer_0 | class_layer_1 | ... |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class_layer:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| num_fields &lt;&lt; 1 | registered_flag | [type_id if registered] |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| namespace | type_name | field_infos |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="field-info">Field info<a href="#field-info" class="hash-link" aria-label="Field info的直接链接" title="Field info的直接链接">​</a></h3>
<p>每个字段：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| field_header | [field_name_bytes] | field_type |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>field_header</code>：</p>
<ul>
<li>bit0: trackingRef</li>
<li>bit1: nullable</li>
<li>bit2-3: 字段名编码</li>
<li>bit4-6: name length/tag ID（7 表示扩展）</li>
<li>bit7: reserved=0</li>
</ul>
<p>字段名编码：</p>
<ul>
<li>0: UTF8</li>
<li>1: ALL_TO_LOWER_SPECIAL</li>
<li>2: LOWER_UPPER_DIGIT_SPECIAL</li>
<li>3: TAG_ID（省略字段名，存 tag）</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="field-type-encoding">Field type encoding<a href="#field-type-encoding" class="hash-link" aria-label="Field type encoding的直接链接" title="Field type encoding的直接链接">​</a></h3>
<p>字段类型使用 type tag + 可选嵌套类型信息：</p>
<table><thead><tr><th>Tag</th><th>字段类型</th></tr></thead><tbody><tr><td>0</td><td>Object (ObjectFieldType)</td></tr><tr><td>1</td><td>Map (MapFieldType)</td></tr><tr><td>2</td><td>Collection/List/Set (CollectionFieldType)</td></tr><tr><td>3</td><td>Array (ArrayFieldType)</td></tr><tr><td>4</td><td>Enum (EnumFieldType)</td></tr><tr><td>5+</td><td>Registered type (RegisteredFieldType)</td></tr></tbody></table>
<p>嵌套类型头部低位可携带 <code>nullable/tracking_ref</code> 标志。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="meta-string-encoding">Meta string encoding<a href="#meta-string-encoding" class="hash-link" aria-label="Meta string encoding的直接链接" title="Meta string encoding的直接链接">​</a></h2>
<p>namespace、type name、field name 复用 xlang 的 meta string 编码。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="package-and-type-names">Package and type names<a href="#package-and-type-names" class="hash-link" aria-label="Package and type names的直接链接" title="Package and type names的直接链接">​</a></h3>
<p>头部：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| 6 bits size | 2 bits encoding |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>size=63</code> 时追加扩展长度</li>
<li>package 支持：UTF8 / ALL_TO_LOWER_SPECIAL / LOWER_UPPER_DIGIT_SPECIAL</li>
<li>type name 支持：UTF8 / LOWER_UPPER_DIGIT_SPECIAL / FIRST_TO_LOWER_SPECIAL / ALL_TO_LOWER_SPECIAL</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="field-names">Field names<a href="#field-names" class="hash-link" aria-label="Field names的直接链接" title="Field names的直接链接">​</a></h3>
<p>字段名编码与 ClassDef 的 field header 规则一致；若使用 TAG_ID，则不写名字字节。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="encoding-algorithms">Encoding algorithms<a href="#encoding-algorithms" class="hash-link" aria-label="Encoding algorithms的直接链接" title="Encoding algorithms的直接链接">​</a></h3>
<p>具体算法参见 xlang 规范 <code>#meta-string</code>。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="value-encodings">Value encodings<a href="#value-encodings" class="hash-link" aria-label="Value encodings的直接链接" title="Value encodings的直接链接">​</a></h2>
<p>以下为 Java native 常见内建 serializer 的值布局。自定义 <code>EXT</code> 可定义自身值格式，但必须遵循“引用元信息 + 类型元信息”通道规则。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="primitives">Primitives<a href="#primitives" class="hash-link" aria-label="Primitives的直接链接" title="Primitives的直接链接">​</a></h3>
<ul>
<li>boolean: 1 byte（0/1）</li>
<li>byte: 1 byte</li>
<li>short: 2 bytes little-endian</li>
<li>char: 2 bytes little-endian（UTF-16 code unit）</li>
<li>int: fixed(4 bytes) 或 varint32(ZigZag)</li>
<li>long: fixed(8 bytes) / varint64(ZigZag) / tagged int64</li>
<li>float: IEEE754 float32</li>
<li>double: IEEE754 float64</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="string">String<a href="#string" class="hash-link" aria-label="String的直接链接" title="String的直接链接">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| varuint36_small: (num_bytes &lt;&lt; 2) | coder | string bytes |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>coder(2 bits)：LATIN1 / UTF16 / UTF8</li>
<li>UTF16 采用 little-endian code unit</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="enum">Enum<a href="#enum" class="hash-link" aria-label="Enum的直接链接" title="Enum的直接链接">​</a></h3>
<ul>
<li><code>serializeEnumByName=true</code>：写 enum 名称（meta string）</li>
<li>否则：写 ordinal（varuint32 small7）</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="binary-byte">Binary (byte[])<a href="#binary-byte" class="hash-link" aria-label="Binary (byte[])的直接链接" title="Binary (byte[])的直接链接">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| varuint32: num_bytes | raw bytes |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="primitive-arrays">Primitive arrays<a href="#primitive-arrays" class="hash-link" aria-label="Primitive arrays的直接链接" title="Primitive arrays的直接链接">​</a></h3>
<p>默认：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| varuint32: byte_length | raw bytes |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可选压缩：</p>
<ul>
<li><code>compressIntArray</code>：<code>| length | varint32... |</code></li>
<li><code>compressLongArray</code>：<code>| length | varint64/tagged... |</code></li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="object-arrays">Object arrays<a href="#object-arrays" class="hash-link" aria-label="Object arrays 的直接链接" title="Object arrays的直接链接">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| varuint32_small7: (length &lt;&lt; 1) | mono_flag |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li><code>mono_flag=1</code>：单态数组，共享组件 serializer</li>
<li><code>mono_flag=0</code>：每元素独立 class info + data</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="collections-listset">Collections (List/Set)<a href="#collections-listset" class="hash-link" aria-label="Collections (List/Set)的直接链接" title="Collections (List/Set)的直接链接">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| varuint32_small7: length | elements_header | [elem_class_info] | elements... |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>elements_header</code>：</p>
<ul>
<li>bit0: TRACKING_REF</li>
<li>bit1: HAS_NULL</li>
<li>bit2: IS_DECL_ELEMENT_TYPE</li>
<li>bit3: IS_SAME_TYPE</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="maps">Maps<a href="#maps" class="hash-link" aria-label="Maps的直接链接" title="Maps的直接链接">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| varuint32_small7: size | chunk_1 | chunk_2 | ... |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chunk:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| header | chunk_size | [key_class_info] | [value_class_info] | entries... |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Map 采用 chunk 编码，每块最多 255 entries；key/value 的引用跟踪与类型声明按 header 位图控制。</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="null-keyvalue-entries">Null key/value entries<a href="#null-keyvalue-entries" class="hash-link" aria-label="Null key/value entries的直接链接" title="Null key/value entries的直接链接">​</a></h4>
<p><code>null key</code> 或 <code>null value</code> 使用特殊单条 chunk，不写 <code>chunk_size</code>，只写对应 payload。</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="objects-and-structs">Objects and structs<a href="#objects-and-structs" class="hash-link" aria-label="Objects and structs的直接链接" title="Objects and structs的直接链接">​</a></h3>
<p>对象值通道：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">| ref meta | type meta | field data |</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>标准对象序列化中：</p>
<ul>
<li>字段按稳定顺序（DescriptorGrouper）排序</li>
<li>compatible 模式可借助 ClassDef 映射字段并跳过未知字段</li>
<li>字段是否写 ref/type meta 由 nullable/ref/polymorphic 策略决定</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="extensions-ext">Extensions (EXT)<a href="#extensions-ext" class="hash-link" aria-label="Extensions (EXT)的直接链接" title="Extensions (EXT)的直接链接">​</a></h3>
<p>EXT 类型值由注册 serializer 定义；但其外层仍遵循统一的引用与类型元信息协议。</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="out-of-band-buffers">Out-of-band buffers<a href="#out-of-band-buffers" class="hash-link" aria-label="Out-of-band buffers的直接链接" title="Out-of-band buffers的直接链接">​</a></h2>
<p>当提供 <code>BufferCallback</code> 时，header 的 <code>oob</code> 位置 1。此时 serializer 可输出“缓冲区引用”而非内联字节（如大数组）。
主流中仅保留引用信息，具体 OOB 缓冲区协议由 callback 实现定义。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/fory-site/tree/main/i18n/zh-CN/docusaurus-plugin-content-docs/version-0.15/specification/java_serialization_spec.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--next" href="/zh-CN/docs/specification/row_format_spec"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Row 格式</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#规范概览" class="table-of-contents__link toc-highlight">规范概览</a></li><li><a href="#fory-头部" class="table-of-contents__link toc-highlight">Fory 头部</a></li><li><a href="#引用元信息" class="table-of-contents__link toc-highlight">引用元信息</a></li><li><a href="#type-system-and-type-ids" class="table-of-contents__link toc-highlight">Type system and type IDs</a><ul><li><a href="#shared-internal-type-ids-0-63" class="table-of-contents__link toc-highlight">Shared internal type IDs (0-63)</a></li><li><a href="#java-native-built-in-type-ids" class="table-of-contents__link toc-highlight">Java native built-in type IDs</a></li><li><a href="#registration-and-named-types" class="table-of-contents__link toc-highlight">Registration and named types</a></li></ul></li><li><a href="#type-meta-encoding" class="table-of-contents__link toc-highlight">Type meta encoding</a><ul><li><a href="#shared-class-meta-streaming" class="table-of-contents__link toc-highlight">Shared class meta (streaming)</a></li></ul></li><li><a href="#schema-modes" class="table-of-contents__link toc-highlight">Schema modes</a></li><li><a href="#classdef-format-compatible-mode" class="table-of-contents__link toc-highlight">ClassDef format (compatible mode)</a><ul><li><a href="#binary-layout" class="table-of-contents__link toc-highlight">Binary layout</a></li><li><a href="#class-meta-bytes" class="table-of-contents__link toc-highlight">Class meta bytes</a></li><li><a href="#field-info" class="table-of-contents__link toc-highlight">Field info</a></li><li><a href="#field-type-encoding" class="table-of-contents__link toc-highlight">Field type encoding</a></li></ul></li><li><a href="#meta-string-encoding" class="table-of-contents__link toc-highlight">Meta string encoding</a><ul><li><a href="#package-and-type-names" class="table-of-contents__link toc-highlight">Package and type names</a></li><li><a href="#field-names" class="table-of-contents__link toc-highlight">Field names</a></li><li><a href="#encoding-algorithms" class="table-of-contents__link toc-highlight">Encoding algorithms</a></li></ul></li><li><a href="#value-encodings" class="table-of-contents__link toc-highlight">Value encodings</a><ul><li><a href="#primitives" class="table-of-contents__link toc-highlight">Primitives</a></li><li><a href="#string" class="table-of-contents__link toc-highlight">String</a></li><li><a href="#enum" class="table-of-contents__link toc-highlight">Enum</a></li><li><a href="#binary-byte" class="table-of-contents__link toc-highlight">Binary (byte[])</a></li><li><a href="#primitive-arrays" class="table-of-contents__link toc-highlight">Primitive arrays</a></li><li><a href="#object-arrays" class="table-of-contents__link toc-highlight">Object arrays</a></li><li><a href="#collections-listset" class="table-of-contents__link toc-highlight">Collections (List/Set)</a></li><li><a href="#maps" class="table-of-contents__link toc-highlight">Maps</a></li><li><a href="#objects-and-structs" class="table-of-contents__link toc-highlight">Objects and structs</a></li><li><a href="#extensions-ext" class="table-of-contents__link toc-highlight">Extensions (EXT)</a></li></ul></li><li><a href="#out-of-band-buffers" class="table-of-contents__link toc-highlight">Out-of-band buffers</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://lists.apache.org/list.html?dev@fory.apache.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">邮件列表<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://join.slack.com/t/fory-project/shared_invite/zt-1u8soj4qc-ieYEu7ciHOqA2mo47llS8A" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/ApacheFory" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">文档</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/zh-CN/docs/start/install">安装</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/docs/start/usage">使用</a></li><li class="footer__item"><a class="footer__link-item" href="/zh-CN/docs/introduction/benchmark">基准测试</a></li></ul></div><div class="col footer__col"><div class="footer__title">代码库</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/apache/fory" target="_blank" rel="noopener noreferrer" class="footer__link-item">Apache Fory™<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/apache/fory-site" target="_blank" rel="noopener noreferrer" class="footer__link-item">网站<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://apache.org/" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/zh-CN/img/asf_logo.svg" alt="Apache Incubator 标志" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE" width="200"><img src="/zh-CN/img/asf_logo.svg" alt="Apache Incubator 标志" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" width="200"></a></div><div class="footer__copyright"><div>
      <p> 版权所有 © 2025 The Apache Software Foundation，许可证：Apache License, Version 2.0。 <br>
        Apache Fory、Fory、Apache、Apache Logo、Apache Fory Logo 是 Apache 软件基金会在美国和/或其他国家的注册商标或商标。
      </p>
      </div></div></div></div></footer></div>
</body>
</html>